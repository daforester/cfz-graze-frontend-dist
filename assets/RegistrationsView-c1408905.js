import{p as ut,n as rt,e as ie,t as Ee,c as dt,G as mt,v as a,H as N,x as we,I as ue,a3 as Oe,a4 as Ye,r as T,K as me,M as i,N as L,O as n,a1 as he,W as Q,a9 as Be,a0 as K,S as W,w as Se,X as w,Q as M,V as R,P as G,_ as tt,a5 as At,a2 as Ut}from"./index-d1ed2f9f.js";import{e as _t,T as ct,d as vt,c as Tt}from"./FormRenderer.vue_vue_type_style_index_0_lang-dd6628e5.js";import{a as Et,F as se}from"./form-29fd1dbb.js";import{_ as He}from"./ModelDialog.vue_vue_type_script_setup_true_lang-a6b02819.js";import{m as St,k as Rt,l as Dt,n as It,o as Ot,p as ft,q as pt,u as Ct,r as gt,s as yt,t as Mt,v as ht,w as Nt,x as Vt,y as bt,z as ze,A as Xe,B as Qe,a as Lt,_ as Ft,f as Ze,g as kt,h as Pt,i as $t,j as wt}from"./VWindowItem-c22d8f78.js";import{a as ee,V as $}from"./VRow-91a32c7c.js";import{V as Ce}from"./VTextField-27e79e9d.js";import{V as ae}from"./copyToClipboard-9ba28968.js";import{u as Gt,j as De,V as Bt}from"./VContainer-9e55c7f5.js";import{V as Yt,u as at}from"./VCheckbox-60753f5f.js";import{v as ge}from"./v4-a960c1f4.js";import{V as Fe,a as ye}from"./VList-56e202ed.js";import{V as Ie}from"./VBtn-e552d20b.js";import{a as ot,b as xe}from"./submission-fa749080.js";import{V as Ht}from"./VAvatar-2f0c5fe1.js";import{c as qt,e as lt}from"./VCard-a6bcbc99.js";import{V as jt}from"./VDialog-6c5b4f3f.js";import{s as be}from"./sortSubmissions-8ed80f07.js";import{V as Kt,u as Jt}from"./VSpacer-89c30b92.js";import{_ as Wt}from"./VChip-5ebd6a5c.js";import{u as Ge,V as zt}from"./VToolbar-aedae1d8.js";import{V as et,a as Xt}from"./VTable-8092c082.js";import"./index-26b71cef.js";import"./VTextarea-69f7a011.js";import"./userData-1cbb769d.js";import"./VForm-c37d2eee.js";import"./VToolbarItems-c31b75cc.js";import"./VDivider-be52353b.js";import"./scopeId-b42f5db7.js";var nt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(nt||{});const Qt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Me=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Me||{});const Zt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var P=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(P||{});const xt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var q=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(q||{});const ea=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],ta=ut({itemsLength:{type:[Number,String],required:!0},...St(),...Rt(),...Dt()},"VDataTableServer"),aa=rt()({name:"VDataTableServer",props:ta(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,F)=>!0},setup(e,F){let{emit:D,slots:o}=F;const{groupBy:d}=It(e),{sortBy:u,multiSort:C,mustSort:O}=Ot(e),{page:f,itemsPerPage:g}=ft(e),m=ie(()=>parseInt(e.itemsLength,10)),{columns:t,headers:l}=pt(e,{groupBy:d,showSelect:Ee(e,"showSelect"),showExpand:Ee(e,"showExpand")}),{items:U}=Ct(e,t),{toggleSort:_}=gt({sortBy:u,multiSort:C,mustSort:O,page:f}),{opened:x,isGroupOpen:k,toggleGroup:re,extractRows:Re}=yt({groupBy:d,sortBy:u}),{pageCount:Z,setItemsPerPage:X}=Mt({page:f,itemsPerPage:g,itemsLength:m}),{flatItems:oe}=ht(U,d,x),{isSelected:Ae,select:Ue,selectAll:E,toggleSelect:S,someSelected:p,allSelected:c}=Nt(e,{allItems:U,currentPage:U}),{isExpanded:y,toggleExpand:j}=Vt(e),J=ie(()=>Re(U.value));bt({page:f,itemsPerPage:g,sortBy:u,groupBy:d,search:Ee(e,"search")}),dt("v-data-table",{toggleSort:_,sortBy:u}),mt({VDataTableRows:{hideNoData:Ee(e,"hideNoData"),noDataText:Ee(e,"noDataText"),loading:Ee(e,"loading"),loadingText:Ee(e,"loadingText")}});const B=ie(()=>({page:f.value,itemsPerPage:g.value,sortBy:u.value,pageCount:Z.value,toggleSort:_,setItemsPerPage:X,someSelected:p.value,allSelected:c.value,isSelected:Ae,select:Ue,selectAll:E,toggleSelect:S,isExpanded:y,toggleExpand:j,isGroupOpen:k,toggleGroup:re,items:J.value,groupedItems:oe.value,columns:t.value,headers:l.value}));Gt(()=>{const[le]=ze.filterProps(e),[_e]=Xe.filterProps(e),[ce]=Qe.filterProps(e),[ke]=et.filterProps(e);return a(et,we({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ke),{top:()=>{var de;return(de=o.top)==null?void 0:de.call(o,B.value)},default:()=>{var de,fe,Ne,Ve;return o.default?o.default(B.value):a(N,null,[(de=o.colgroup)==null?void 0:de.call(o,B.value),a("thead",{class:"v-data-table__thead",role:"rowgroup"},[a(Xe,we(_e,{sticky:e.fixedHeader}),o)]),(fe=o.thead)==null?void 0:fe.call(o,B.value),a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[o.body?o.body(B.value):a(Qe,we(ce,{items:oe.value}),o)]),(Ne=o.tbody)==null?void 0:Ne.call(o,B.value),(Ve=o.tfoot)==null?void 0:Ve.call(o,B.value)])},bottom:()=>o.bottom?o.bottom(B.value):a(ze,le,{prepend:o["footer.prepend"]})})})}}),oa=ue({__name:"EditAdminLayout",props:Oe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Oe(["save"],["update:modelValue"]),setup(e,{emit:F}){const D=Ye(e,"modelValue"),o=T(me(e.layout)),d=T([]),u=he(),C=({callback:m})=>{const t=()=>{m&&m("Failed to Save Layout")},l=()=>{m&&m("Layout Saved")};u.saveAdminLayout(o.value).then(U=>{U?(l(),F("save",U)):t()}).catch(()=>{t()})},O=()=>({ID:0,LayoutPanelUUID:ge(),AdminLayoutID:o.value.ID,AdminLayoutUUID:o.value.AdminLayoutUUID,Name:"",Order:o.value.Panels.length+1,Items:[],RequiredFormType:se.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),f=m=>()=>({ID:0,LayoutItemUUID:ge(),LayoutPanelID:m.ID,LayoutPanelUUID:m.LayoutPanelUUID,Label:"",SourceType:Me.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:m.Items.length+1,DefaultSort:!1}),g=m=>{const t=d.value.find(l=>l.value===m.SectionFieldUUID);t&&(m.SectionFieldID=t.object.ID,m.SectionField=t.object)};return u.getConventionForms(e.layout.ConventionUUID).then(m=>{m.forEach(t=>t.Sections.forEach(l=>l.Fields&&d.value.push(...l.Fields.map(U=>{var x;return{title:`${t.Name} - ${l.Name} - ${(x=U.Field)==null?void 0:x.Name}`,value:U.SectionFieldUUID,object:U}})))),d.value.sort(_t("title"))}),(m,t)=>(i(),L(He,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=l=>D.value=l),onSave:C,title:m.title,color:"primary"},{default:n(()=>[a(De,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(ee,null,{default:n(()=>[a($,{cols:"12",sm:"6"},{default:n(()=>[a(Ce,{modelValue:o.value.Name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.Name=l),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a($,{cols:"12",sm:"6"},{default:n(()=>[a(ae,{modelValue:o.value.Type,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.Type=l),label:"Layout Type",items:Q(Qt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),a(Ze,{modelValue:o.value.Panels,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.Panels=l),"new-item":O,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Be({_:2},[K(o.value.Panels,(l,U)=>({name:`panel_${U}`,fn:n(()=>[a(De,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(ee,null,{default:n(()=>[a($,{cols:"12",sm:"6"},{default:n(()=>[a(Ce,{modelValue:l.Name,"onUpdate:modelValue":_=>l.Name=_,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a($,{cols:"12",sm:"6"},{default:n(()=>[a(ae,{modelValue:l.RequiredFormType,"onUpdate:modelValue":_=>l.RequiredFormType=_,items:Q(Et),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),a(ee,null,{default:n(()=>[a($,{cols:"12",sm:"6"},{default:n(()=>[a(Lt,{label:"Required Groups",variant:"outlined",modelValue:l.RequiredGroupMemberships,"onUpdate:modelValue":_=>l.RequiredGroupMemberships=_,convention:o.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),a($,{cols:"12",sm:"6"},{default:n(()=>[a(Ft,{label:"Registration Tags",variant:"outlined",modelValue:l.RequiredRegistrationTags,"onUpdate:modelValue":_=>l.RequiredRegistrationTags=_,convention:o.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(Ze,{modelValue:l.Items,"onUpdate:modelValue":_=>l.Items=_,"new-item":f(l),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Be({_:2},[K(l.Items,(_,x)=>({name:`item_${x}`,fn:n(()=>[a(De,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(ee,null,{default:n(()=>[a($,{cols:"12",sm:"6"},{default:n(()=>[a(Ce,{modelValue:_.Label,"onUpdate:modelValue":k=>_.Label=k,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(ee,null,{default:n(()=>[a($,{cols:"12",sm:"6"},{default:n(()=>[a(ae,{modelValue:_.SourceType,"onUpdate:modelValue":k=>_.SourceType=k,label:"Source Type",items:Q(Zt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),a($,{cols:"12",sm:"6"},{default:n(()=>[_.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),L(ae,{key:0,modelValue:_.SectionFieldUUID,"onUpdate:modelValue":k=>_.SectionFieldUUID=k,label:"Form Data",items:d.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:k=>g(_)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):_.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),L(ae,{key:1,modelValue:_.MetaField,"onUpdate:modelValue":k=>_.MetaField=k,label:"Miscellaneous Data",items:Q(xt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):_.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),L(ae,{key:2,modelValue:_.UserField,"onUpdate:modelValue":k=>_.UserField=k,label:"User Profile Data",items:Q(ea),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):W("",!0)]),_:2},1024)]),_:2},1024),a(ee,null,{default:n(()=>[a($,null,{default:n(()=>[a(Yt,{modelValue:_.DefaultSort,"onUpdate:modelValue":k=>_.DefaultSort=k,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Le=e=>(typeof e=="string"&&(e=new Date(e)),`${e.toLocaleString("default",{weekday:"long"})} ${e.getDate()}${la(e.getDate())} ${e.toLocaleString("default",{month:"long"})}`),la=e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},na=w("br",null,null,-1),ia=w("h3",null,"Assigned Accommodation",-1),sa=w("br",null,null,-1),ua=w("br",null,null,-1),ra=w("h3",null,"Accommodation Preferences",-1),da=w("h3",null,"Selected Tickets",-1),ma=w("br",null,null,-1),Aa=ue({__name:"EditAccommodationAssignmentDialog",props:Oe({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Oe(["update:field"],["update:modelValue"]),setup(e,{emit:F}){const D=e,{convention:o,registration:d,title:u=""}=D,C=he(),O=Ye(e,"modelValue"),f=T({capacity:{max:E=>{var c;const S=Z.value.find(y=>y.room.RoomUUID===E);return!S||S.room.MaximumCapacity===0?!0:(((c=l.value)==null?void 0:c.Members.length)||0)<=S.room.MaximumCapacity||"Too many people in the group for this room"},min:E=>{var c;const S=Z.value.find(y=>y.room.RoomUUID===E);return!S||S.room.MinimumCapacity===0?!0:(((c=l.value)==null?void 0:c.Members.length)||0)>=S.room.MinimumCapacity||"Not enough people in the group for this room"}}}),g=T([]),m=at(D,F,void 0,void 0,"field"),t=T(me(m.value));Se(m,()=>{t.value=me(m.value)});const l=T(),U=T(""),_=T(""),x=T([]),k=T({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),re=async()=>{var c;const E=await C.getConventionAvailableAccommodation(o.ConventionUUID);E&&(g.value=E);const S=await C.getRegistrationGroup(d.RegistrationUUID||"");S&&(l.value=S);const p=await C.getConventionTickets(o.ConventionUUID);p&&(x.value=p);try{k.value=JSON.parse(((c=l.value)==null?void 0:c.TicketData)||"")}catch{}};Se(U,()=>{_.value=Z.value.length>0?Z.value[0].value:""});const Re=ie(()=>{const E=X.value;return g.value.map(S=>{let p;return E.forEach(c=>{S.Costs.forEach(y=>{y.DateStart===(c==null?void 0:c.DateStart)&&y.DateEnd===c.DateEnd&&(p===void 0||p>y.Availability)&&(p=y.Availability)})}),{label:`${S.Name}`,title:`${S.Name} (${p} Available)`,value:S.AccommodationUUID}})}),Z=ie(()=>{const E=X.value,S=g.value.find(p=>p.AccommodationUUID===U.value);return(S==null?void 0:S.Pool.map(p=>{var y,j;let c;return E.forEach(J=>{p.Costs.forEach(B=>{B.DateStart===(J==null?void 0:J.DateStart)&&B.DateEnd===J.DateEnd&&(c===void 0||c>B.Availability)&&(c=B.Availability)})}),{label:`${(y=p.Venue)==null?void 0:y.Name} - ${p.Name}`,title:`${(j=p.Venue)==null?void 0:j.Name} - ${p.Name} (${c} Available)`,value:p.RoomUUID,room:p}}))||[]}),X=ie(()=>[...k.value.Ticket,...k.value.AddonsChecked,...k.value.ComponentsChecked].map(E=>x.value.find(S=>S.TicketUUID===E)).filter(E=>E!==void 0&&E.RequiresAccommodation)),oe=E=>{var S;C.assignAccommodation(((S=l.value)==null?void 0:S.Registration.RegistrationUUID)||"",U.value,_.value,!1).then(p=>{p?(re(),E&&E("Room Assigned")):E&&E("Room not assigned")}).catch(()=>{E&&E("Room not assigned")})},Ae=E=>{var S,p;(S=l.value)!=null&&S.Registration.AllocationUUID?C.deleteAllocation(((p=l.value)==null?void 0:p.Registration.AllocationUUID)||"").then(c=>{c?(re(),E&&E("Allocation Deleted")):E&&E("Allocation not deleted")}).catch(()=>{E&&E("Allocation not deleted")}):E&&E("Nothing to Delete")},Ue=E=>{var p,c;const S=(p=g.value.find(y=>y.AccommodationUUID===E.AccommodationUUID))==null?void 0:p.Pool;if(S){const y=S.find(j=>j.RoomUUID===E.RoomUUID);if(y)return`${(c=y.Venue)==null?void 0:c.Name} - ${y.Name}`}return""};return re(),(E,S)=>{var p;return i(),L(He,{modelValue:O.value,"onUpdate:modelValue":S[2]||(S[2]=c=>O.value=c),title:Q(u),color:"primary","show-close-action":!0,"show-delete-action":!!((p=l.value)!=null&&p.Registration.Allocation),"show-save-action":!!_.value,"save-button-label":"Assign Room",onDelete:Ae,onSave:oe},{default:n(()=>[a(De,{class:"pa-0",fluid:!0},{default:n(()=>[a(ee,null,{default:n(()=>{var c;return[a($,{cols:"12",md:"6"},{default:n(()=>{var y,j;return[w("h3",null,"Group Members ("+M((y=l.value)==null?void 0:y.Members.length)+")",1),(i(!0),R(N,null,K((j=l.value)==null?void 0:j.Members,J=>(i(),R(N,{key:J.UUID},[G(" #"+M(J.Reference)+" "+M(J.Name),1),na],64))),128))]}),_:1}),(c=l.value)!=null&&c.Registration.Allocation?(i(),L($,{key:0,cols:"12",md:"6"},{default:n(()=>[ia,a(Fe,null,{default:n(()=>{var y;return[(i(!0),R(N,null,K((y=l.value)==null?void 0:y.Registration.Allocation.Periods,j=>(i(),L(ye,{key:j.AllocationPeriodUUID},{default:n(()=>{var J;return[G(M((J=g.value.find(B=>B.AccommodationUUID===j.AccommodationUUID))==null?void 0:J.Name)+" ",1),sa,G(" "+M(Ue(j))+" ",1),ua,w("small",null,"("+M(Q(Le)(j.DateStart))+" - "+M(Q(Le)(j.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):W("",!0)]}),_:1}),a(ee,null,{default:n(()=>[a($,{cols:"12",md:"6"},{default:n(()=>[E.selectedAccommodation.length?(i(),R(N,{key:0},[ra,a(Fe,null,{default:n(()=>[(i(!0),R(N,null,K(E.selectedAccommodation,(c,y)=>(i(),L(ye,{key:c.AccommodationUUID},{default:n(()=>[G(M(y+1)+". "+M(c.Name),1)]),_:2},1024))),128))]),_:1})],64)):W("",!0)]),_:1}),a($,{cosl:"12",md:"6"},{default:n(()=>[da,a(Fe,null,{default:n(()=>[(i(!0),R(N,null,K(X.value,c=>(i(),L(ye,{key:c==null?void 0:c.TicketUUID},{default:n(()=>[G(M(c.Name)+" ",1),ma,w("small",null,"("+M(Q(Le)(c.DateStart))+" - "+M(Q(Le)(c.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(ee,null,{default:n(()=>[a($,{cols:"12",md:"6"},{default:n(()=>[a(ae,{modelValue:U.value,"onUpdate:modelValue":S[0]||(S[0]=c=>U.value=c),items:Re.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),a($,{cols:"12",md:"6"},{default:n(()=>[a(ae,{modelValue:_.value,"onUpdate:modelValue":S[1]||(S[1]=c=>_.value=c),items:Z.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[f.value.capacity.min,f.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Ua={key:0,class:"accommodationList"},_a={key:0,class:"text-orange-darken-2"},ca=ue({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},registration:{},value:{default:""},venues:{}},setup(e){const F=T(!1),D=ie(()=>{if(!e.value)return[];const o=JSON.parse(e.value),d=e.accommodations.filter(u=>o.includes(u.AccommodationUUID)).sort((u,C)=>{const O=o.findIndex(g=>g===u.AccommodationUUID),f=o.findIndex(g=>g===C.AccommodationUUID);return O>f?1:-1});return me(d)});return(o,d)=>(i(),R(N,null,[o.value?(i(),R("ol",Ua,[(i(!0),R(N,null,K(D.value,u=>(i(),R("li",{key:u.AccommodationUUID},[o.registration&&o.registration.Allocation&&o.registration.Allocation.Periods.find(C=>C.AccommodationUUID===u.AccommodationUUID)?(i(),R("strong",_a,M(u.Name),1)):(i(),R(N,{key:1},[G(M(u.Name),1)],64))]))),128))])):W("",!0),a(Ie,{onClick:d[0]||(d[0]=u=>F.value=!0),variant:"flat",color:"success"},{default:n(()=>[G("Assign Accommodation")]),_:1}),o.convention&&F.value?(i(),L(Aa,{key:1,modelValue:F.value,"onUpdate:modelValue":d[1]||(d[1]=u=>F.value=u),title:"Accommodation Allocation",convention:o.convention,registration:o.registration,"selected-accommodation":D.value},null,8,["modelValue","convention","registration","selected-accommodation"])):W("",!0)],64))}});const va=tt(ca,[["__scopeId","data-v-c426aacc"]]),Ta={key:0,class:"addonList"},Ea={key:0},Sa={key:0},Ra=ue({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const F=ie(()=>{if(!e.value)return;const D=JSON.parse(e.value),o=Object.keys(D),d=me(e.extras);return d.forEach(u=>{u.Options=u.Options.filter(C=>o.includes(C.OptionUUID)?(C.Choices=C.Choices.filter(O=>O.TagUUID===D[C.OptionUUID].choiceId),D[C.OptionUUID].checked):!1)}),d.filter(u=>u.Options.length>0),d});return(D,o)=>D.value?(i(),R("ul",Ta,[(i(!0),R(N,null,K(F.value,d=>(i(),R(N,{key:d.ExtraUUID},[d.Options.length?(i(),R("li",Ea,[w("strong",null,M(d.Name),1),w("ul",null,[(i(!0),R(N,null,K(d.Options,u=>(i(),R("li",{key:u.OptionUUID},[G(M(u.Name)+" ",1),u.Choices.length==1?(i(),R("small",Sa,"("+M(u.Choices[0].Title)+")",1)):W("",!0)]))),128))])])):W("",!0)],64))),128))])):W("",!0)}});const Da=tt(Ra,[["__scopeId","data-v-55786e01"]]),Ia={key:0},Oa=ue({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const F=ie(()=>{if(!e.value)return;const D=JSON.parse(e.value);return Object.entries(D).filter(([,o])=>o).map(([o,d])=>e.interests.find(u=>u.InterestUUID===o)).filter(o=>o!==void 0)});return(D,o)=>D.value?(i(),R("ul",Ia,[(i(!0),R(N,null,K(F.value,d=>(i(),R("li",{key:d.InterestUUID},M(d.Name),1))),128))])):W("",!0)}}),fa=w("br",null,null,-1),pa=w("small",null,"Options:",-1),Ca=w("br",null,null,-1),ga=w("small",null,"Addons:",-1),ya=ue({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const F=ie(()=>{if(!e.value)return;let D={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{D=JSON.parse(e.value),"ticket"in D&&(D.Ticket=D.ticket),"addonsChecked"in D&&(D.AddonsChecked=D.addonsChecked),"componentsChecked"in D&&(D.ComponentsChecked=D.componentsChecked)}catch{}return D.Ticket.filter(o=>{const d=e.tickets.find(u=>u.TicketUUID===o);return!(!d||d.Type!==ct.TICKET_TYPE_TICKET)}).map(o=>{const d=e.tickets.find(C=>C.TicketUUID===o),u=me(d);return u.TicketComponents=d.TicketComponents.filter(C=>D.ComponentsChecked.includes(C.TicketUUID)),u.AddonTickets=d.AddonTickets.filter(C=>D.AddonsChecked.includes(C.TicketUUID)),u})});return(D,o)=>D.value?(i(!0),R(N,{key:0},K(F.value,d=>(i(),R("div",{key:d.TicketUUID},[w("strong",null,M(d.Name),1),d.TicketComponents.length>0?(i(),R(N,{key:0},[fa,pa,G("  "),(i(!0),R(N,null,K(d.TicketComponents,u=>(i(),R(N,{key:u.TicketUUID},[w("small",null,M(u.Name),1),G("  ")],64))),128))],64)):W("",!0),d.AddonTickets.length>0?(i(),R(N,{key:1},[Ca,ga,G("  "),(i(!0),R(N,null,K(d.AddonTickets,u=>(i(),R("small",{key:u.TicketUUID},[G("("),w("em",null,M(u.Name),1),G(")")]))),128))],64)):W("",!0)]))),128)):W("",!0)}}),Ma={key:0},ha={key:0},Na=w("strong",null,"Total:",-1),Va=ue({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","reload"],setup(e,{emit:F}){const D=he(),o=T(),d=T(),u=T(),C=T(),O=T(!1),f=t=>{console.log(t)},g=(t,l,U)=>{d.value=t,D.getRegistrationGroup(U.RegistrationUUID||"").then(_=>{u.value=_,o.value=l,C.value=U,O.value=!0})},m=t=>{F("openActions",t)};return(t,l)=>(i(),R(N,null,[t.header.key=="actions"?(i(),L(Ie,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:l[0]||(l[0]=U=>f(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(i(),L(va,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,convention:t.convention,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","convention","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(i(),L(Da,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(i(),L(Oa,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(i(),L(ya,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(i(!0),R(N,{key:5},K(t.item.raw[t.header.key],U=>(i(),R("ul",{key:U.Heading},[w("li",null,[w("strong",null,M(U.Heading)+":",1),G(" "+M(Q(ot)(U.Submission.Status))+" ",1),a(Ie,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:_=>g(U.Registration,U.Form,U.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),L(Ht,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(i(),L(Ie,{key:7,icon:"mdi:mdi-email-fast",variant:"flat",onClick:l[1]||(l[1]=U=>m(t.item.raw[t.header.key]))})):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(i(),R(N,{key:8},[t.item.raw[t.header.key].length===1?(i(),R("em",Ma," Not in a group ")):(i(),R(N,{key:1},[w("ul",null,[(i(!0),R(N,null,K(t.item.raw[t.header.key],U=>(i(),R("li",{key:U.UUID,class:"ml-0"},[G(" #"+M(U.Reference)+" : "+M(U.Name)+" ",1),U.IsLeader?(i(),R("strong",ha,"(Leader)")):W("",!0)]))),128))]),Na,G(" "+M(t.item.raw[t.header.key].length),1)],64))],64)):(i(),R(N,{key:9},[G(M(t.item.raw[t.header.key]),1)],64)),O.value&&C.value&&o.value?(i(),L(jt,{key:10,modelValue:O.value,"onUpdate:modelValue":l[4]||(l[4]=U=>O.value=U),scrollable:!0},{default:n(()=>[a(lt,{class:"bg-red-darken-4"},{default:n(()=>[a(qt,null,{default:n(()=>[a(vt,{modelValue:o.value,"onUpdate:modelValue":l[2]||(l[2]=U=>o.value=U),admin:!0,convention:t.convention,data:C.value,editable:!0,"registration-group":u.value,onClose:l[3]||(l[3]=U=>{O.value=!1,F("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):W("",!0)],64))}}),ba=ue({__name:"RegistrationActions",props:Oe({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Oe(["update:registration"],["update:modelValue"]),setup(e,{emit:F}){const D=e,o=Ye(e,"modelValue"),d=at(D,F,void 0,void 0,"registration"),u=T(me(d.value));Se(d,()=>{u.value=me(d.value)});const C=he(),O=(f,g)=>{const m=u.value.Submissions.find(t=>t.SubmissionUUID==g);if(!m){f&&f("Submission not found");return}C.setSubmissionStatus(g,m.Status).then(t=>{t?(u.value.Submissions.forEach((l,U)=>{d.value.Submissions[U].Status=l.Status}),f&&f("Status Saved")):f&&f("Status not saved")}).catch(()=>{f&&f("Status not saved")})};return(f,g)=>(i(),L(He,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=m=>o.value=m),title:f.title,"show-close-action":!0,color:"primary","close-action-label":"Close"},{default:n(()=>[a(De,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(Fe,null,{default:n(()=>[(i(!0),R(N,null,K(u.value.Submissions,m=>(i(),L(ye,{key:m.SubmissionUUID,class:"pa-0"},{default:n(()=>[a(ee,{class:"py-2 align-center"},{default:n(()=>[a($,{cols:"8"},{default:n(()=>{var t;return[a(ae,{modelValue:m.Status,"onUpdate:modelValue":l=>m.Status=l,items:Q(xe),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((t=f.forms.find(l=>l.FormUUID==m.FormUUID))==null?void 0:t.Name)||""},{selection:n(()=>[a(Bt,{class:"mr-4"},{default:n(()=>{var l;return[G(M((l=Q(xe).find(U=>U.value===m.Status))==null?void 0:l.icon),1)]}),_:2},1024),G(" "+M(Q(ot)(m.Status)),1)]),item:n(({item:l,props:{onClick:U}})=>[a(ye,{title:l.title,"prepend-icon":l.raw.icon,onClick:U},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),a($,{cols:"4"},{default:n(()=>[a(Wt,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:t=>O(t.callback,m.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(ee,null,{default:n(()=>[a($,{cols:"12"},{default:n(()=>[a(Ie,{"prepend-icon":"mdi:mdi-email",color:"primary"},{default:n(()=>[G("Send Email")]),_:1}),G(" <-- WORK IN PROGRESS - NOT FUNCTIONAL ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),ro=ue({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:F}){var qe;const D=Jt();F("pageTitle","Registration Manager");const o=At(),d=Ut(),u=T(!0);let C=((qe=o.params.convention)==null?void 0:qe.toString())||"";const O=T({ID:0,ConventionUUID:ge(),OrganisationID:0,OrganisationUUID:Ge,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),f=he(),g=T({ID:0,AdminLayoutUUID:ge(),ConventionID:O.value.ID,ConventionUUID:O.value.ConventionUUID,Name:"Registration Table",Type:nt.ADMIN_LAYOUT_TABLE,Panels:[]}),m=T([]),t=T([]),l=T([]),U=T([]),_=T([]),x=T(1),k=T(10),re=T([]),Re=T(0),Z=T(!1),X=T(""),oe=T(""),Ae=T(""),Ue=T(""),E=T(""),S=T(""),p=T([]),c=T([]),y=T([]),j=T([]),J=T([]),B=T([]),le=T(0),_e=T(),ce=T(!1);Se(le,s=>{s===7&&fe()}),Se(E,()=>{oe.value=Date.now().toString()}),Se(S,()=>{oe.value=Date.now().toString()});const ke=()=>{m.value=[],l.value=[],_.value=[];try{f.getConventionAdminLayoutByName(O.value.ConventionUUID,"Registration Table").then(s=>{le.value+=1,s?g.value=s:(g.value.ConventionID=O.value.ID,g.value.ConventionUUID=O.value.ConventionUUID)})}catch{g.value.ConventionID=O.value.ID,g.value.ConventionUUID=O.value.ConventionUUID}try{f.getConventionForms(O.value.ConventionUUID).then(s=>{le.value+=1,s&&(m.value=s)})}catch{}try{f.getConventionAccommodation(O.value.ConventionUUID).then(s=>{le.value+=1,s&&(c.value=s)})}catch{}try{f.getConventionVenues(O.value.ConventionUUID).then(s=>{le.value+=1,s&&(B.value=s)})}catch{}try{f.getConventionExtras(O.value.ConventionUUID).then(s=>{le.value+=1,s&&(y.value=s)})}catch{}try{f.getConventionInterests(O.value.ConventionUUID).then(s=>{le.value+=1,s&&(j.value=s)})}catch{}try{f.getConventionTickets(O.value.ConventionUUID).then(s=>{le.value+=1,s&&(J.value=s)})}catch{}try{f.getConventionGroups(O.value.ConventionUUID).then(s=>{s&&(t.value=s.sort((r,A)=>r.Name.localeCompare(A.Name)))})}catch{}try{f.getConventionTags(O.value.ConventionUUID).then(s=>{s&&(U.value=s.sort((r,A)=>r.Title.localeCompare(A.Title)).map(r=>(r.Title=`${r.Title} [${r.Key}]`,r)))})}catch{}},de=({page:s,itemsPerPage:r,sortBy:A})=>{u.value=!0,x.value=s,re.value=A;const v=_.value.find(Y=>Y.uuid==X.value),ne=v==null?void 0:v.layout.Items;let z="",je="";if(A&&ne&&A.length>=1){const Y=ne.find(pe=>pe.LayoutItemUUID==A[0].key);switch(je=A[0].order,Y==null?void 0:Y.MetaField){case P.META_DATA_SOURCE_ACCOMMODATION_FORM:z="submission.status";break;case P.META_DATA_SOURCE_BADGE_FORM:z="submission.status";break;case P.META_DATA_SOURCE_DEALER_FORM:z="submission.status";break;case P.META_DATA_SOURCE_REGISTRATION_FORM:z="submission.status";break;case P.META_DATA_SOURCE_REGISTRATION_REFERENCE:z="reference";break;case P.META_DATA_SOURCE_SUBMISSION_DATE:z="created";break;case P.META_DATA_SOURCE_SUBMISSION_STATUS:z="submission.status";break}switch(Y==null?void 0:Y.UserField){case q.USER_DATA_SOURCE_DISPLAY_NAME:z="user.display_name";break;case q.USER_DATA_SOURCE_EMAIL:z="user.email";break;case q.USER_DATA_SOURCE_FIRST_NAME:z="user.firstname";break;case q.USER_DATA_SOURCE_HANDLE:z="user.handle";break;case q.USER_DATA_SOURCE_LAST_NAME:z="user.lastname";break}}try{const Y={Direction:je,Limit:r,Offset:(s-1)*r,Order:z};v&&v.layout.RequiredRegistrationTags.length>0&&(Y.PanelUUID=v==null?void 0:v.layout.LayoutPanelUUID),(v==null?void 0:v.layout.RequiredFormType)===se.FORM_TYPE_ACCOMMODATION&&(Y.Accommodation=!0),(v==null?void 0:v.layout.RequiredFormType)===se.FORM_TYPE_BADGE&&(Y.Badge=!0),(v==null?void 0:v.layout.RequiredFormType)===se.FORM_TYPE_DEALER&&(Y.Dealer=!0),(v==null?void 0:v.layout.RequiredFormType)===se.FORM_TYPE_REGISTRATION&&(Y.Registration=!0),Y.GroupUUID=E.value||Ge,Y.TagUUID=S.value||Ge,Y.Email=Ue.value,Y.Reference=Ae.value,f.searchConventionRegistrations(O.value.ConventionUUID,Y).then(pe=>{pe&&(Re.value=pe.Total,l.value=pe.Registrations,_.value.forEach(Pe=>{const st=Pe.layout;Pe.items=l.value.map(V=>{const H={};return Pe.headers.forEach(Ke=>{var Je;const h=st.Items.find(ve=>ve.LayoutItemUUID===Ke.key);if(h){if(h.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&h.SectionField)V.Submissions.forEach(ve=>{const te=ve.Data.find($e=>$e.SectionFieldUUID===h.SectionFieldUUID);if(te){Ke.type===Tt.ACCOMMODATION?H[h.LayoutItemUUID]={Data:te.Data,Registration:V}:H[h.LayoutItemUUID]=te.Data;return}});else if(h.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&h.UserField)switch(h.UserField){case q.USER_DATA_SOURCE_AVATAR:H[h.LayoutItemUUID]=D.GetProfileImageURL(V.UserUUID);break;case q.USER_DATA_SOURCE_DISPLAY_NAME:H[h.LayoutItemUUID]=V.User.DisplayName;break;case q.USER_DATA_SOURCE_EMAIL:H[h.LayoutItemUUID]=V.User.Additional.Email;break;case q.USER_DATA_SOURCE_HANDLE:H[h.LayoutItemUUID]=V.User.Handle;break;case q.USER_DATA_SOURCE_DATE_OF_BIRTH:H[h.LayoutItemUUID]=V.User.Additional.DOB;break;case q.USER_DATA_SOURCE_FIRST_NAME:H[h.LayoutItemUUID]=V.User.Additional.FirstName;break;case q.USER_DATA_SOURCE_LAST_NAME:H[h.LayoutItemUUID]=V.User.Additional.LastName;break;case q.USER_DATA_SOURCE_TELEGRAM:H[h.LayoutItemUUID]="";break}else if(h.SourceType==="LAYOUT_ITEM_SOURCE_META"&&h.MetaField){const ve=[];let te;const $e=(Je=m.value.find(I=>I.Type===se.FORM_TYPE_REGISTRATION))==null?void 0:Je.FormUUID,We=V.Submissions.find(I=>I.FormUUID===$e);switch(h.MetaField){case P.META_DATA_SOURCE_REGISTRATION_ACTIONS:H[h.LayoutItemUUID]=V;break;case P.META_DATA_SOURCE_REGISTRATION_GROUP:V.Leader?te=V:te=V.Primary,ve.push({Name:te.User.DisplayName,UUID:te.UserUUID,UserUUID:te.User.UserUUID,IsLeader:!0,Reference:te.Reference}),ve.push(...te.Members.map(I=>({Name:I.User.DisplayName,UUID:I.UserUUID,UserUUID:I.User.UserUUID,IsLeader:!1,Reference:I.Reference}))),H[h.LayoutItemUUID]=ve;break;case P.META_DATA_SOURCE_REGISTRATION_REFERENCE:H[h.LayoutItemUUID]=V.Reference;break;case P.META_DATA_SOURCE_SUBMISSION_DATE:if(We){const I=new Date(We.CreatedAt||"");H[h.LayoutItemUUID]=`${I.getFullYear()}-${(I.getMonth()+1).toString().padStart(2,"0")}-${I.getDate().toString().padStart(2,"0")} ${I.getHours().toString().padStart(2,"0")}:${I.getMinutes().toString().padStart(2,"0")}:${I.getSeconds().toString().padStart(2,"0")}`}else{const I=new Date(V.CreatedAt||"");H[h.LayoutItemUUID]=`${I.getFullYear()}-${(I.getMonth()+1).toString().padStart(2,"0")}-${I.getDate().toString().padStart(2,"0")} ${I.getHours().toString().padStart(2,"0")}:${I.getMinutes().toString().padStart(2,"0")}:${I.getSeconds().toString().padStart(2,"0")}`}break;case P.META_DATA_SOURCE_ACCOMMODATION_FORM:be(V.Submissions,m.value),H[h.LayoutItemUUID]=V.Submissions.map(I=>{const b=m.value.find(Te=>Te.FormUUID===I.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:I,Registration:V}}).filter(I=>{var b;return((b=I.Form)==null?void 0:b.Type)===se.FORM_TYPE_ACCOMMODATION});break;case P.META_DATA_SOURCE_BADGE_FORM:be(V.Submissions,m.value),H[h.LayoutItemUUID]=V.Submissions.map(I=>{const b=m.value.find(Te=>Te.FormUUID===I.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:I,Registration:V}}).filter(I=>{var b;return((b=I.Form)==null?void 0:b.Type)===se.FORM_TYPE_BADGE});break;case P.META_DATA_SOURCE_DEALER_FORM:be(V.Submissions,m.value),H[h.LayoutItemUUID]=V.Submissions.map(I=>{const b=m.value.find(Te=>Te.FormUUID===I.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:I,Registration:V}}).filter(I=>{var b;return((b=I.Form)==null?void 0:b.Type)===se.FORM_TYPE_DEALER});break;case P.META_DATA_SOURCE_SUBMISSION_STATUS:be(V.Submissions,m.value),H[h.LayoutItemUUID]=V.Submissions.map(I=>{const b=m.value.find(Te=>Te.FormUUID===I.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:I,Registration:V}});break}}}}),H})}),u.value=!1)})}catch{}},fe=()=>{g.value.Panels.forEach(s=>{s.Items.forEach(r=>{(r.SectionField==null||r.SectionField.Field==null)&&m.value.find(A=>{A.Sections.find(v=>{if(v.Fields){const ne=v.Fields.find(z=>z.SectionFieldUUID===r.SectionFieldUUID);if(ne)return r.SectionField=ne,!0}})})})}),g.value.Panels.length>0&&(_.value=[],g.value.Panels.forEach(s=>{const r={uuid:ge(),order:s.Order,name:s.Name,headers:[],items:[],layout:s};s.Items.sort((A,v)=>A.Order>v.Order?1:A.Order==v.Order?0:-1),r.headers=s.Items.map(A=>{var v,ne;return A.DefaultSort&&p.value.push({key:A.LayoutItemUUID,order:"asc"}),{key:A.LayoutItemUUID,title:A.Label||((ne=(v=A.SectionField)==null?void 0:v.Field)==null?void 0:ne.Label)||"",align:A.Align==="end"?"end":"start",sortable:Ve(A),type:Ne(A)}}),_.value.push(r)})),(X.value==null||X.value=="")&&_.value.length>0&&(X.value=_.value[0].uuid)};C?f.getConvention(C).then(s=>{s&&(O.value=s,ke())}).catch(()=>{d.push("/")}):d.push("/");const Ne=s=>{var r,A;if(s.SourceType===Me.LAYOUT_ITEM_SOURCE_META)return`${s.SourceType}.${s.MetaField}`;if(s.SourceType===Me.LAYOUT_ITEM_SOURCE_FORM)return(A=(r=s.SectionField)==null?void 0:r.Field)==null?void 0:A.Type;if(s.SourceType===Me.LAYOUT_ITEM_SOURCE_USER)return`${s.SourceType}.${s.UserField}`},Ve=s=>{const r=[P.META_DATA_SOURCE_ACCOMMODATION_FORM,P.META_DATA_SOURCE_BADGE_FORM,P.META_DATA_SOURCE_DEALER_FORM,P.META_DATA_SOURCE_REGISTRATION_FORM,P.META_DATA_SOURCE_REGISTRATION_REFERENCE,P.META_DATA_SOURCE_SUBMISSION_DATE,P.META_DATA_SOURCE_SUBMISSION_STATUS],A=[q.USER_DATA_SOURCE_DISPLAY_NAME,q.USER_DATA_SOURCE_EMAIL,q.USER_DATA_SOURCE_HANDLE,q.USER_DATA_SOURCE_DATE_OF_BIRTH,q.USER_DATA_SOURCE_FIRST_NAME,q.USER_DATA_SOURCE_LAST_NAME];return r.includes(s.MetaField)||A.includes(s.UserField)},it=s=>{_e.value=s,ce.value=!0};return Se(ce,s=>{s||(_e.value=void 0)}),(s,r)=>(i(),L(Xt,null,{default:n(()=>[a(zt,{color:"blue-darken-4"},{default:n(()=>[a(kt,{modelValue:X.value,"onUpdate:modelValue":r[0]||(r[0]=A=>X.value=A),"show-arrows":""},{default:n(()=>[(i(!0),R(N,null,K(_.value,A=>(i(),L(Pt,{key:A.uuid,value:A.uuid},{default:n(()=>[G(M(A.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(Kt),a(Ie,{icon:"mdi:mdi-cog-outline",onClick:r[1]||(r[1]=A=>Z.value=!0)})]),_:1}),a(wt,{modelValue:X.value,"onUpdate:modelValue":r[11]||(r[11]=A=>X.value=A),disabled:!0},{default:n(()=>[(i(!0),R(N,null,K(_.value,A=>(i(),L($t,{key:A.uuid,value:A.uuid},{default:n(()=>[A.uuid===X.value?(i(),L(lt,{key:0,class:"pa-2"},{default:n(()=>[a(Q(aa),{"items-per-page":k.value,"onUpdate:itemsPerPage":r[9]||(r[9]=v=>k.value=v),"sort-by":p.value,"onUpdate:sortBy":r[10]||(r[10]=v=>p.value=v),headers:A.headers,"items-length":Re.value,items:A.items,"item-value":"LayoutItemUUID",loading:u.value,search:oe.value,"onUpdate:options":de},Be({top:n(()=>[a(De,null,{default:n(()=>[a(ee,null,{default:n(()=>[a($,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(Ce,{modelValue:Ae.value,"onUpdate:modelValue":r[2]||(r[2]=v=>Ae.value=v),label:"Search by Badge",clearable:!0,"hide-details":"",onInput:r[3]||(r[3]=v=>oe.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),a($,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(Ce,{modelValue:Ue.value,"onUpdate:modelValue":r[4]||(r[4]=v=>Ue.value=v),label:"Search By Email",clearable:!0,"hide-details":"",onInput:r[5]||(r[5]=v=>oe.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),a($,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(ae,{modelValue:E.value,"onUpdate:modelValue":r[6]||(r[6]=v=>E.value=v),label:"Search By Group",clearable:!0,"hide-details":"",items:t.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),a($,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(ae,{modelValue:S.value,"onUpdate:modelValue":r[7]||(r[7]=v=>S.value=v),label:"Search By Tag",clearable:!0,"hide-details":"",items:U.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[K(A.headers,v=>({name:`item.${v.key}`,fn:n(({item:ne})=>[a(Va,{header:v,item:ne,accommodations:c.value,convention:O.value,extras:y.value,interests:j.value,tickets:J.value,venues:B.value,onOpenActions:it,onReload:r[8]||(r[8]=z=>de({page:x.value,itemsPerPage:k.value,sortBy:re.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):W("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),Z.value?(i(),L(oa,{key:0,title:"Edit Layout",modelValue:Z.value,"onUpdate:modelValue":r[12]||(r[12]=A=>Z.value=A),layout:g.value,onSave:r[13]||(r[13]=A=>{Z.value=!1,fe()})},null,8,["modelValue","layout"])):W("",!0),ce.value&&_e.value?(i(),L(ba,{key:1,modelValue:ce.value,"onUpdate:modelValue":r[14]||(r[14]=A=>ce.value=A),registration:_e.value,"onUpdate:registration":r[15]||(r[15]=A=>_e.value=A),accommodations:c.value,convention:O.value,extras:y.value,forms:m.value,interests:j.value,tickets:J.value,title:"Registration Status & Communications",venues:B.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):W("",!0)]),_:1}))}});export{ro as default};
