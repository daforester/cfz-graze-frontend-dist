import{p as Et,n as St,e as me,t as Re,c as ft,G as Rt,v as a,H as V,x as Be,I as se,a3 as Oe,a4 as xe,r as _,K as Ae,M as d,N as $,O as n,a1 as ye,W as Z,a9 as je,a0 as W,S as Q,w as ie,X as G,Q as L,V as g,P as Y,_ as dt,ab as Dt,E as Ze,k as It,f as gt,d as pt,o as Ot,ac as et,a5 as yt,a2 as Ct}from"./index-9e1e0cf1.js";import{e as Mt,T as ht,d as bt,c as Vt}from"./FormRenderer.vue_vue_type_style_index_0_lang-7798a815.js";import{a as Lt,F as ce}from"./form-29fd1dbb.js";import{_ as Ke}from"./ModelDialog.vue_vue_type_script_setup_true_lang-dcec9369.js";import{m as Nt,k as kt,l as Ft,n as Pt,o as wt,p as $t,q as Gt,u as Bt,r as Yt,s as Ht,t as jt,v as qt,w as xt,x as Kt,y as zt,z as tt,A as at,B as ot,a as Jt,_ as Wt,f as nt,c as Qt,d as Xt,e as Zt,b as ea,V as ta,g as aa,h as oa,i as na,j as la}from"./VWindowItem-213061f6.js";import{a as te,V as w}from"./VRow-85e4a152.js";import{V as ge}from"./VTextField-71961477.js";import{V as ne}from"./copyToClipboard-40451f23.js";import{u as ia,j as pe,V as sa}from"./VContainer-8a05e74a.js";import{V as ua,u as mt}from"./VCheckbox-eea352cd.js";import{v as he}from"./v4-a960c1f4.js";import{V as Pe,a as be}from"./VList-1d06261a.js";import{V as Ie}from"./VBtn-bfb14b7c.js";import{a as ct,b as lt}from"./submission-b99d8912.js";import{V as ra}from"./VAvatar-66e9f05a.js";import{c as da,e as vt}from"./VCard-5ec94f50.js";import{V as ma}from"./VDialog-564cb55c.js";import{s as ke}from"./sortSubmissions-8ed80f07.js";import{V as ca,u as va}from"./VSpacer-4835c0b3.js";import{_ as qe}from"./VChip-459acc82.js";import{u as Ye,V as Aa}from"./VToolbar-9de99e52.js";import{V as it,a as Ua}from"./VTable-1fe95ed8.js";import"./index-26b71cef.js";import"./VTextarea-1dec9661.js";import"./userData-c4e3c736.js";import"./VForm-6ed83ac2.js";import"./VToolbarItems-5bb02d33.js";import"./VDivider-30eff305.js";import"./scopeId-a0ad1161.js";var At=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(At||{});const _a=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Ve=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Ve||{});const Ta=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var B=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(B||{});const Ea=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var z=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(z||{});const Sa=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],fa=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Send Error"}return"Unknown"},Ra=Et({itemsLength:{type:[Number,String],required:!0},...Nt(),...kt(),...Ft()},"VDataTableServer"),Da=St()({name:"VDataTableServer",props:Ra(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,T)=>!0},setup(e,T){let{emit:i,slots:o}=T;const{groupBy:s}=Pt(e),{sortBy:l,multiSort:A,mustSort:U}=wt(e),{page:S,itemsPerPage:R}=$t(e),E=me(()=>parseInt(e.itemsLength,10)),{columns:t,headers:r}=Gt(e,{groupBy:s,showSelect:Re(e,"showSelect"),showExpand:Re(e,"showExpand")}),{items:c}=Bt(e,t),{toggleSort:u}=Yt({sortBy:l,multiSort:A,mustSort:U,page:S}),{opened:b,isGroupOpen:y,toggleGroup:ae,extractRows:H}=Ht({groupBy:s,sortBy:l}),{pageCount:N,setItemsPerPage:j}=jt({page:S,itemsPerPage:R,itemsLength:E}),{flatItems:oe}=qt(c,s,b),{isSelected:Ue,select:_e,selectAll:p,toggleSelect:O,someSelected:M,allSelected:D}=xt(e,{allItems:c,currentPage:c}),{isExpanded:h,toggleExpand:J}=Kt(e),X=me(()=>H(c.value));zt({page:S,itemsPerPage:R,sortBy:l,groupBy:s,search:Re(e,"search")}),ft("v-data-table",{toggleSort:u,sortBy:l}),Rt({VDataTableRows:{hideNoData:Re(e,"hideNoData"),noDataText:Re(e,"noDataText"),loading:Re(e,"loading"),loadingText:Re(e,"loadingText")}});const q=me(()=>({page:S.value,itemsPerPage:R.value,sortBy:l.value,pageCount:N.value,toggleSort:u,setItemsPerPage:j,someSelected:M.value,allSelected:D.value,isSelected:Ue,select:_e,selectAll:p,toggleSelect:O,isExpanded:h,toggleExpand:J,isGroupOpen:y,toggleGroup:ae,items:X.value,groupedItems:oe.value,columns:t.value,headers:r.value}));ia(()=>{const[ue]=tt.filterProps(e),[Te]=at.filterProps(e),[Ee]=ot.filterProps(e),[we]=it.filterProps(e);return a(it,Be({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},we),{top:()=>{var ve;return(ve=o.top)==null?void 0:ve.call(o,q.value)},default:()=>{var ve,Ce,Le,Ne;return o.default?o.default(q.value):a(V,null,[(ve=o.colgroup)==null?void 0:ve.call(o,q.value),a("thead",{class:"v-data-table__thead",role:"rowgroup"},[a(at,Be(Te,{sticky:e.fixedHeader}),o)]),(Ce=o.thead)==null?void 0:Ce.call(o,q.value),a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[o.body?o.body(q.value):a(ot,Be(Ee,{items:oe.value}),o)]),(Le=o.tbody)==null?void 0:Le.call(o,q.value),(Ne=o.tfoot)==null?void 0:Ne.call(o,q.value)])},bottom:()=>o.bottom?o.bottom(q.value):a(tt,ue,{prepend:o["footer.prepend"]})})})}}),Ia=se({__name:"EditAdminLayout",props:Oe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Oe(["save"],["update:modelValue"]),setup(e,{emit:T}){const i=xe(e,"modelValue"),o=_(Ae(e.layout)),s=_([]),l=ye(),A=({callback:E})=>{const t=()=>{E&&E("Failed to Save Layout")},r=()=>{E&&E("Layout Saved")};l.saveAdminLayout(o.value).then(c=>{c?(r(),T("save",c)):t()}).catch(()=>{t()})},U=()=>({ID:0,LayoutPanelUUID:he(),AdminLayoutID:o.value.ID,AdminLayoutUUID:o.value.AdminLayoutUUID,Name:"",Order:o.value.Panels.length+1,Items:[],RequiredFormType:ce.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),S=E=>()=>({ID:0,LayoutItemUUID:he(),LayoutPanelID:E.ID,LayoutPanelUUID:E.LayoutPanelUUID,Label:"",SourceType:Ve.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:E.Items.length+1,DefaultSort:!1}),R=E=>{const t=s.value.find(r=>r.value===E.SectionFieldUUID);t&&(E.SectionFieldID=t.object.ID,E.SectionField=t.object)};return l.getConventionForms(e.layout.ConventionUUID).then(E=>{E.forEach(t=>t.Sections.forEach(r=>r.Fields&&s.value.push(...r.Fields.map(c=>{var b;return{title:`${t.Name} - ${r.Name} - ${(b=c.Field)==null?void 0:b.Name}`,value:c.SectionFieldUUID,object:c}})))),s.value.sort(Mt("title"))}),(E,t)=>(d(),$(Ke,{modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=r=>i.value=r),onSave:A,title:E.title,color:"primary"},{default:n(()=>[a(pe,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(te,null,{default:n(()=>[a(w,{cols:"12",sm:"6"},{default:n(()=>[a(ge,{modelValue:o.value.Name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.Name=r),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a(w,{cols:"12",sm:"6"},{default:n(()=>[a(ne,{modelValue:o.value.Type,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.Type=r),label:"Layout Type",items:Z(_a),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),a(nt,{modelValue:o.value.Panels,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.Panels=r),"new-item":U,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},je({_:2},[W(o.value.Panels,(r,c)=>({name:`panel_${c}`,fn:n(()=>[a(pe,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(te,null,{default:n(()=>[a(w,{cols:"12",sm:"6"},{default:n(()=>[a(ge,{modelValue:r.Name,"onUpdate:modelValue":u=>r.Name=u,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(w,{cols:"12",sm:"6"},{default:n(()=>[a(ne,{modelValue:r.RequiredFormType,"onUpdate:modelValue":u=>r.RequiredFormType=u,items:Z(Lt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),a(te,null,{default:n(()=>[a(w,{cols:"12",sm:"6"},{default:n(()=>[a(Jt,{label:"Required Groups",variant:"outlined",modelValue:r.RequiredGroupMemberships,"onUpdate:modelValue":u=>r.RequiredGroupMemberships=u,convention:o.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),a(w,{cols:"12",sm:"6"},{default:n(()=>[a(Wt,{label:"Registration Tags",variant:"outlined",modelValue:r.RequiredRegistrationTags,"onUpdate:modelValue":u=>r.RequiredRegistrationTags=u,convention:o.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(nt,{modelValue:r.Items,"onUpdate:modelValue":u=>r.Items=u,"new-item":S(r),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},je({_:2},[W(r.Items,(u,b)=>({name:`item_${b}`,fn:n(()=>[a(pe,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(te,null,{default:n(()=>[a(w,{cols:"12",sm:"6"},{default:n(()=>[a(ge,{modelValue:u.Label,"onUpdate:modelValue":y=>u.Label=y,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(te,null,{default:n(()=>[a(w,{cols:"12",sm:"6"},{default:n(()=>[a(ne,{modelValue:u.SourceType,"onUpdate:modelValue":y=>u.SourceType=y,label:"Source Type",items:Z(Ta),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),a(w,{cols:"12",sm:"6"},{default:n(()=>[u.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(d(),$(ne,{key:0,modelValue:u.SectionFieldUUID,"onUpdate:modelValue":y=>u.SectionFieldUUID=y,label:"Form Data",items:s.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:y=>R(u)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):u.SourceType==="LAYOUT_ITEM_SOURCE_META"?(d(),$(ne,{key:1,modelValue:u.MetaField,"onUpdate:modelValue":y=>u.MetaField=y,label:"Miscellaneous Data",items:Z(Ea),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):u.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(d(),$(ne,{key:2,modelValue:u.UserField,"onUpdate:modelValue":y=>u.UserField=y,label:"User Profile Data",items:Z(Sa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):Q("",!0)]),_:2},1024)]),_:2},1024),a(te,null,{default:n(()=>[a(w,null,{default:n(()=>[a(ua,{modelValue:u.DefaultSort,"onUpdate:modelValue":y=>u.DefaultSort=y,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),ga=e=>(typeof e=="string"&&(e=new Date(e)),`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`),Fe=e=>(typeof e=="string"&&(e=new Date(e)),`${e.toLocaleString("default",{weekday:"long"})} ${e.getDate()}${pa(e.getDate())} ${e.toLocaleString("default",{month:"long"})}`),pa=e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},Oa=G("br",null,null,-1),ya=G("h3",null,"Assigned Accommodation",-1),Ca=G("br",null,null,-1),Ma=G("br",null,null,-1),ha=G("h3",null,"Accommodation Preferences",-1),ba=G("h3",null,"Selected Tickets",-1),Va=G("br",null,null,-1),La=se({__name:"EditAccommodationAssignmentDialog",props:Oe({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Oe(["update:field"],["update:modelValue"]),setup(e,{emit:T}){const i=e,{convention:o,registration:s,title:l=""}=i,A=ye(),U=xe(e,"modelValue"),S=_({capacity:{max:p=>{var D;const O=N.value.find(h=>h.room.RoomUUID===p);return!O||O.room.MaximumCapacity===0?!0:(((D=r.value)==null?void 0:D.Members.length)||0)<=O.room.MaximumCapacity||"Too many people in the group for this room"},min:p=>{var D;const O=N.value.find(h=>h.room.RoomUUID===p);return!O||O.room.MinimumCapacity===0?!0:(((D=r.value)==null?void 0:D.Members.length)||0)>=O.room.MinimumCapacity||"Not enough people in the group for this room"}}}),R=_([]),E=mt(i,T,void 0,void 0,"field"),t=_(Ae(E.value));ie(E,()=>{t.value=Ae(E.value)});const r=_(),c=_(""),u=_(""),b=_([]),y=_({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),ae=async()=>{var D;const p=await A.getConventionAvailableAccommodation(o.ConventionUUID);p&&(R.value=p);const O=await A.getRegistrationGroup(s.RegistrationUUID||"");O&&(r.value=O);const M=await A.getConventionTickets(o.ConventionUUID);M&&(b.value=M);try{y.value=JSON.parse(((D=r.value)==null?void 0:D.TicketData)||"")}catch{}};ie(c,()=>{u.value=N.value.length>0?N.value[0].value:""});const H=me(()=>{const p=j.value;return R.value.map(O=>{let M;return p.forEach(D=>{O.Costs.forEach(h=>{h.DateStart===(D==null?void 0:D.DateStart)&&h.DateEnd===D.DateEnd&&(M===void 0||M>h.Availability)&&(M=h.Availability)})}),{label:`${O.Name}`,title:`${O.Name} (${M} Available)`,value:O.AccommodationUUID}})}),N=me(()=>{const p=j.value,O=R.value.find(M=>M.AccommodationUUID===c.value);return(O==null?void 0:O.Pool.map(M=>{var h,J;let D;return p.forEach(X=>{M.Costs.forEach(q=>{q.DateStart===(X==null?void 0:X.DateStart)&&q.DateEnd===X.DateEnd&&(D===void 0||D>q.Availability)&&(D=q.Availability)})}),{label:`${(h=M.Venue)==null?void 0:h.Name} - ${M.Name}`,title:`${(J=M.Venue)==null?void 0:J.Name} - ${M.Name} (${D} Available)`,value:M.RoomUUID,room:M}}))||[]}),j=me(()=>[...y.value.Ticket,...y.value.AddonsChecked,...y.value.ComponentsChecked].map(p=>b.value.find(O=>O.TicketUUID===p)).filter(p=>p!==void 0&&p.RequiresAccommodation)),oe=p=>{var O;A.assignAccommodation(((O=r.value)==null?void 0:O.Registration.RegistrationUUID)||"",c.value,u.value,!1).then(M=>{M?(ae(),p&&p("Room Assigned")):p&&p("Room not assigned")}).catch(()=>{p&&p("Room not assigned")})},Ue=p=>{var O,M;(O=r.value)!=null&&O.Registration.AllocationUUID?A.deleteAllocation(((M=r.value)==null?void 0:M.Registration.AllocationUUID)||"").then(D=>{D?(ae(),p&&p("Allocation Deleted")):p&&p("Allocation not deleted")}).catch(()=>{p&&p("Allocation not deleted")}):p&&p("Nothing to Delete")},_e=p=>{var M,D;const O=(M=R.value.find(h=>h.AccommodationUUID===p.AccommodationUUID))==null?void 0:M.Pool;if(O){const h=O.find(J=>J.RoomUUID===p.RoomUUID);if(h)return`${(D=h.Venue)==null?void 0:D.Name} - ${h.Name}`}return""};return ae(),(p,O)=>{var M;return d(),$(Ke,{modelValue:U.value,"onUpdate:modelValue":O[2]||(O[2]=D=>U.value=D),title:Z(l),color:"primary","show-close-action":!0,"show-delete-action":!!((M=r.value)!=null&&M.Registration.Allocation),"show-save-action":!!u.value,"save-button-label":"Assign Room",onDelete:Ue,onSave:oe},{default:n(()=>[a(pe,{class:"pa-0",fluid:!0},{default:n(()=>[a(te,null,{default:n(()=>{var D;return[a(w,{cols:"12",md:"6"},{default:n(()=>{var h,J;return[G("h3",null,"Group Members ("+L((h=r.value)==null?void 0:h.Members.length)+")",1),(d(!0),g(V,null,W((J=r.value)==null?void 0:J.Members,X=>(d(),g(V,{key:X.UUID},[Y(" #"+L(X.Reference)+" "+L(X.Name),1),Oa],64))),128))]}),_:1}),(D=r.value)!=null&&D.Registration.Allocation?(d(),$(w,{key:0,cols:"12",md:"6"},{default:n(()=>[ya,a(Pe,null,{default:n(()=>{var h;return[(d(!0),g(V,null,W((h=r.value)==null?void 0:h.Registration.Allocation.Periods,J=>(d(),$(be,{key:J.AllocationPeriodUUID},{default:n(()=>{var X;return[Y(L((X=R.value.find(q=>q.AccommodationUUID===J.AccommodationUUID))==null?void 0:X.Name)+" ",1),Ca,Y(" "+L(_e(J))+" ",1),Ma,G("small",null,"("+L(Z(Fe)(J.DateStart))+" - "+L(Z(Fe)(J.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):Q("",!0)]}),_:1}),a(te,null,{default:n(()=>[a(w,{cols:"12",md:"6"},{default:n(()=>[p.selectedAccommodation.length?(d(),g(V,{key:0},[ha,a(Pe,null,{default:n(()=>[(d(!0),g(V,null,W(p.selectedAccommodation,(D,h)=>(d(),$(be,{key:D.AccommodationUUID},{default:n(()=>[Y(L(h+1)+". "+L(D.Name),1)]),_:2},1024))),128))]),_:1})],64)):Q("",!0)]),_:1}),a(w,{cosl:"12",md:"6"},{default:n(()=>[ba,a(Pe,null,{default:n(()=>[(d(!0),g(V,null,W(j.value,D=>(d(),$(be,{key:D==null?void 0:D.TicketUUID},{default:n(()=>[Y(L(D.Name)+" ",1),Va,G("small",null,"("+L(Z(Fe)(D.DateStart))+" - "+L(Z(Fe)(D.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(te,null,{default:n(()=>[a(w,{cols:"12",md:"6"},{default:n(()=>[a(ne,{modelValue:c.value,"onUpdate:modelValue":O[0]||(O[0]=D=>c.value=D),items:H.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),a(w,{cols:"12",md:"6"},{default:n(()=>[a(ne,{modelValue:u.value,"onUpdate:modelValue":O[1]||(O[1]=D=>u.value=D),items:N.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[S.value.capacity.min,S.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Na={key:0,class:"accommodationList"},ka={key:0,class:"text-orange-darken-2"},Fa=se({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},registration:{},value:{default:""},venues:{}},setup(e){const T=_(!1),i=me(()=>{if(!e.value)return[];const o=JSON.parse(e.value),s=e.accommodations.filter(l=>o.includes(l.AccommodationUUID)).sort((l,A)=>{const U=o.findIndex(R=>R===l.AccommodationUUID),S=o.findIndex(R=>R===A.AccommodationUUID);return U>S?1:-1});return Ae(s)});return(o,s)=>(d(),g(V,null,[o.value?(d(),g("ol",Na,[(d(!0),g(V,null,W(i.value,l=>(d(),g("li",{key:l.AccommodationUUID},[o.registration&&o.registration.Allocation&&o.registration.Allocation.Periods.find(A=>A.AccommodationUUID===l.AccommodationUUID)?(d(),g("strong",ka,L(l.Name),1)):(d(),g(V,{key:1},[Y(L(l.Name),1)],64))]))),128))])):Q("",!0),a(Ie,{onClick:s[0]||(s[0]=l=>T.value=!0),variant:"flat",color:"success"},{default:n(()=>[Y("Assign Accommodation")]),_:1}),o.convention&&T.value?(d(),$(La,{key:1,modelValue:T.value,"onUpdate:modelValue":s[1]||(s[1]=l=>T.value=l),title:"Accommodation Allocation",convention:o.convention,registration:o.registration,"selected-accommodation":i.value},null,8,["modelValue","convention","registration","selected-accommodation"])):Q("",!0)],64))}});const Pa=dt(Fa,[["__scopeId","data-v-c426aacc"]]),wa={key:0,class:"addonList"},$a={key:0},Ga={key:0},Ba=se({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const T=me(()=>{if(!e.value)return;const i=JSON.parse(e.value),o=Object.keys(i),s=Ae(e.extras);return s.forEach(l=>{l.Options=l.Options.filter(A=>o.includes(A.OptionUUID)?(A.Choices=A.Choices.filter(U=>U.TagUUID===i[A.OptionUUID].choiceId),i[A.OptionUUID].checked):!1)}),s.filter(l=>l.Options.length>0),s});return(i,o)=>i.value?(d(),g("ul",wa,[(d(!0),g(V,null,W(T.value,s=>(d(),g(V,{key:s.ExtraUUID},[s.Options.length?(d(),g("li",$a,[G("strong",null,L(s.Name),1),G("ul",null,[(d(!0),g(V,null,W(s.Options,l=>(d(),g("li",{key:l.OptionUUID},[Y(L(l.Name)+" ",1),l.Choices.length==1?(d(),g("small",Ga,"("+L(l.Choices[0].Title)+")",1)):Q("",!0)]))),128))])])):Q("",!0)],64))),128))])):Q("",!0)}});const Ya=dt(Ba,[["__scopeId","data-v-55786e01"]]),Ha={key:0},ja=se({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const T=me(()=>{if(!e.value)return;const i=JSON.parse(e.value);return Object.entries(i).filter(([,o])=>o).map(([o,s])=>e.interests.find(l=>l.InterestUUID===o)).filter(o=>o!==void 0)});return(i,o)=>i.value?(d(),g("ul",Ha,[(d(!0),g(V,null,W(T.value,s=>(d(),g("li",{key:s.InterestUUID},L(s.Name),1))),128))])):Q("",!0)}}),qa=G("br",null,null,-1),xa=G("small",null,"Options:",-1),Ka=G("br",null,null,-1),za=G("small",null,"Addons:",-1),Ja=se({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const T=me(()=>{if(!e.value)return;let i={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{i=JSON.parse(e.value),"ticket"in i&&(i.Ticket=i.ticket),"addonsChecked"in i&&(i.AddonsChecked=i.addonsChecked),"componentsChecked"in i&&(i.ComponentsChecked=i.componentsChecked)}catch{}return i.Ticket.filter(o=>{const s=e.tickets.find(l=>l.TicketUUID===o);return!(!s||s.Type!==ht.TICKET_TYPE_TICKET)}).map(o=>{const s=e.tickets.find(A=>A.TicketUUID===o),l=Ae(s);return l.TicketComponents=s.TicketComponents.filter(A=>i.ComponentsChecked.includes(A.TicketUUID)),l.AddonTickets=s.AddonTickets.filter(A=>i.AddonsChecked.includes(A.TicketUUID)),l})});return(i,o)=>i.value?(d(!0),g(V,{key:0},W(T.value,s=>(d(),g("div",{key:s.TicketUUID},[G("strong",null,L(s.Name),1),s.TicketComponents.length>0?(d(),g(V,{key:0},[qa,xa,Y("  "),(d(!0),g(V,null,W(s.TicketComponents,l=>(d(),g(V,{key:l.TicketUUID},[G("small",null,L(l.Name),1),Y("  ")],64))),128))],64)):Q("",!0),s.AddonTickets.length>0?(d(),g(V,{key:1},[Ka,za,Y("  "),(d(!0),g(V,null,W(s.AddonTickets,l=>(d(),g("small",{key:l.TicketUUID},[Y("("),G("em",null,L(l.Name),1),Y(")")]))),128))],64)):Q("",!0)]))),128)):Q("",!0)}}),Wa={key:0},Qa={key:0},Xa=G("strong",null,"Total:",-1),Za=se({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","reload"],setup(e,{emit:T}){const i=ye(),o=_(),s=_(),l=_(),A=_(),U=_(!1),S=t=>{console.log(t)},R=(t,r,c)=>{s.value=t,i.getRegistrationGroup(c.RegistrationUUID||"").then(u=>{l.value=u,o.value=r,A.value=c,U.value=!0})},E=t=>{T("openActions",t)};return(t,r)=>(d(),g(V,null,[t.header.key=="actions"?(d(),$(Ie,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:r[0]||(r[0]=c=>S(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(d(),$(Pa,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,convention:t.convention,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","convention","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(d(),$(Ya,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(d(),$(ja,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(d(),$(Ja,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(d(!0),g(V,{key:5},W(t.item.raw[t.header.key],c=>(d(),g("ul",{key:c.Heading},[G("li",null,[G("strong",null,L(c.Heading)+":",1),Y(" "+L(Z(ct)(c.Submission.Status))+" ",1),a(Ie,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:u=>R(c.Registration,c.Form,c.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(d(),$(ra,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(d(),$(Ie,{key:7,icon:"mdi:mdi-email-fast",variant:"flat",onClick:r[1]||(r[1]=c=>E(t.item.raw[t.header.key]))})):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(d(),g(V,{key:8},[t.item.raw[t.header.key].length===1?(d(),g("em",Wa," Not in a group ")):(d(),g(V,{key:1},[G("ul",null,[(d(!0),g(V,null,W(t.item.raw[t.header.key],c=>(d(),g("li",{key:c.UUID,class:"ml-0"},[Y(" #"+L(c.Reference)+" : "+L(c.Name)+" ",1),c.IsLeader?(d(),g("strong",Qa,"(Leader)")):Q("",!0)]))),128))]),Xa,Y(" "+L(t.item.raw[t.header.key].length),1)],64))],64)):(d(),g(V,{key:9},[Y(L(t.item.raw[t.header.key]),1)],64)),U.value&&A.value&&o.value?(d(),$(ma,{key:10,modelValue:U.value,"onUpdate:modelValue":r[4]||(r[4]=c=>U.value=c),scrollable:!0},{default:n(()=>[a(vt,{class:"bg-red-darken-4"},{default:n(()=>[a(da,null,{default:n(()=>[a(bt,{modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=c=>o.value=c),admin:!0,convention:t.convention,data:A.value,editable:!0,"registration-group":l.value,onClose:r[3]||(r[3]=c=>{U.value=!1,T("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Q("",!0)],64))}});var eo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],to=function(e){return eo.map(function(T){return T.toLowerCase()}).indexOf(e.toLowerCase())!==-1},ao=function(e,T,i){Object.keys(T).filter(to).forEach(function(o){var s=T[o];typeof s=="function"&&(o==="onInit"?s(e,i):i.on(o.substring(2),function(l){return s(l,i)}))})},oo=function(e,T,i,o){var s=e.modelEvents?e.modelEvents:null,l=Array.isArray(s)?s.join(" "):s;ie(o,function(A,U){i&&typeof A=="string"&&A!==U&&A!==i.getContent({format:e.outputFormat})&&i.setContent(A)}),i.on(l||"change input undo redo",function(){T.emit("update:modelValue",i.getContent({format:e.outputFormat}))})},no=function(e,T,i,o,s,l){o.setContent(l()),i.attrs["onUpdate:modelValue"]&&oo(T,i,o,s),ao(e,i.attrs,o)},st=0,Ut=function(e){var T=Date.now(),i=Math.floor(Math.random()*1e9);return st++,e+"_"+i+st+String(T)},lo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},ut=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},io=function(e,T){return ut(e).concat(ut(T))},so=function(e){return e==null},rt=function(){return{listeners:[],scriptId:Ut("tiny-script"),scriptLoaded:!1}},uo=function(){var e=rt(),T=function(s,l,A,U){var S=l.createElement("script");S.referrerPolicy="origin",S.type="application/javascript",S.id=s,S.src=A;var R=function(){S.removeEventListener("load",R),U()};S.addEventListener("load",R),l.head&&l.head.appendChild(S)},i=function(s,l,A){e.scriptLoaded?A():(e.listeners.push(A),s.getElementById(e.scriptId)||T(e.scriptId,s,l,function(){e.listeners.forEach(function(U){return U()}),e.scriptLoaded=!0}))},o=function(){e=rt()};return{load:i,reinitialize:o}},ro=uo(),mo=function(){return typeof window<"u"?window:global},De=function(){var e=mo();return e&&e.tinymce?e.tinymce:null},co={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},de=globalThis&&globalThis.__assign||function(){return de=Object.assign||function(e){for(var T,i=1,o=arguments.length;i<o;i++){T=arguments[i];for(var s in T)Object.prototype.hasOwnProperty.call(T,s)&&(e[s]=T[s])}return e},de.apply(this,arguments)},vo=function(e,T,i,o){return e(o||"div",{id:T,ref:i})},Ao=function(e,T,i){return e("textarea",{id:T,visibility:"hidden",ref:i})},He={selector:void 0,target:void 0},Uo=se({props:co,setup:function(e,T){var i=e.init?de(de({},e.init),He):de({},He),o=Dt(e),s=o.disabled,l=o.modelValue,A=o.tagName,U=_(null),S=null,R=e.id||Ut("tiny-vue"),E=e.init&&e.init.inline||e.inline,t=!!T.attrs["onUpdate:modelValue"],r=!0,c=e.initialValue?e.initialValue:"",u="",b=function(H){return t?function(){return l!=null&&l.value?l.value:""}:function(){return H?c:u}},y=function(){var H=b(r),N=de(de({},i),{readonly:e.disabled,target:U.value,plugins:io(i.plugins,e.plugins),toolbar:e.toolbar||i.toolbar,inline:E,setup:function(j){S=j,j.on("init",function(oe){return no(oe,e,T,j,l,H)}),typeof i.setup=="function"&&i.setup(j)}});lo(U.value)&&(U.value.style.visibility=""),De().init(N),r=!1};ie(s,function(H){var N;S!==null&&(typeof((N=S.mode)===null||N===void 0?void 0:N.set)=="function"?S.mode.set(H?"readonly":"design"):S.setMode(H?"readonly":"design"))}),ie(A,function(H){var N;t||(u=S.getContent()),(N=De())===null||N===void 0||N.remove(S),Ze(function(){return y()})}),It(function(){if(De()!==null)y();else if(U.value&&U.value.ownerDocument){var H=e.cloudChannel?e.cloudChannel:"6",N=e.apiKey?e.apiKey:"no-api-key",j=so(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(N,"/tinymce/").concat(H,"/tinymce.min.js"):e.tinymceScriptSrc;ro.load(U.value.ownerDocument,j,y)}}),gt(function(){De()!==null&&De().remove(S)}),E||(pt(function(){r||y()}),Ot(function(){var H;t||(u=S.getContent()),(H=De())===null||H===void 0||H.remove(S)}));var ae=function(H){var N;u=S.getContent(),(N=De())===null||N===void 0||N.remove(S),i=de(de(de({},i),H),He),Ze(function(){return y()})};return T.expose({rerender:ae,getEditor:function(){return S}}),function(){return E?vo(et,R,U,e.tagName):Ao(et,R,U)}}});const _o=["colspan"],To=G("strong",null,"E-Mail Content",-1),Eo=["innerHTML"],So=se({__name:"Communications",props:{registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:T}){const i=ye(),o=_([]),s=_({Subject:"",HTML:""}),l=_(""),A=_(""),U=_(!1),S=_([]),R=_([]),E=_([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]);ie(s,u=>{A.value=u.Subject||A.value||"",l.value=u.HTML||l.value||""});const t=()=>{i.getRegistrationEmails(e.registration.RegistrationUUID).then(u=>{u&&(u.forEach(b=>{b.CreatedAt=ga(new Date(b.CreatedAt||"")),b.Status=fa(b.Status)}),R.value=u)})};t(),(()=>{i.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(u=>{u&&(o.value=u)})})();const c=({callback:u})=>{i.sendRegistrationEmail(e.registration.RegistrationUUID,A.value,l.value).then(b=>{b?u&&(u("Email Sent"),t(),setTimeout(()=>{U.value=!1},2e3)):u&&u("Not sent")}).catch(()=>{u&&u("Not sent")})};return(u,b)=>(d(),g(V,null,[u.showEditor?(d(),g(V,{key:0},[a(te,null,{default:n(()=>[a(w,null,{default:n(()=>[a(ne,{items:o.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=y=>s.value=y),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),a(te,null,{default:n(()=>[a(w,{cols:"12"},{default:n(()=>[a(ge,{modelValue:A.value,"onUpdate:modelValue":b[1]||(b[1]=y=>A.value=y),label:"Subject",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(w,{cols:"12"},{default:n(()=>[a(Z(Uo),{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=y=>l.value=y),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),a(te,null,{default:n(()=>[a(w,null,{default:n(()=>[a(qe,{onClick:b[3]||(b[3]=y=>T("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),a(w,{class:"text-right"},{default:n(()=>[a(qe,{onClick:c,label:"Send",color:"error"})]),_:1})]),_:1})],64)):Q("",!0),R.value.length?(d(),$(ta,{key:1,class:"my-2"},{default:n(()=>[a(ea,null,{default:n(()=>[a(Qt,null,{default:n(()=>[Y(" Email History ")]),_:1}),a(Xt,null,{default:n(()=>[a(Z(Zt),{items:R.value,headers:E.value,"show-expand":!0,"item-value":"EmailUUID",expanded:S.value,"onUpdate:expanded":b[4]||(b[4]=y=>S.value=y)},{"expanded-row":n(({columns:y,item:ae})=>[G("tr",null,[G("td",{colspan:y.length},[To,G("div",{innerHTML:ae.raw.HTML},null,8,Eo)],8,_o)])]),"footer.prepend":n(()=>[a(Ie,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:t},{default:n(()=>[Y("Refresh")]),_:1})]),_:1},8,["items","headers","expanded"])]),_:1})]),_:1})]),_:1})):Q("",!0)],64))}});const fo=se({__name:"RegistrationActions",props:Oe({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Oe(["update:registration"],["update:modelValue"]),setup(e,{emit:T}){const i=e,o=xe(e,"modelValue"),s=_(!1),l=mt(i,T,void 0,void 0,"registration"),A=_(Ae(l.value));ie(l,()=>{A.value=Ae(l.value)});const U=ye(),S=(R,E)=>{const t=A.value.Submissions.find(r=>r.SubmissionUUID==E);if(!t){R&&R("Submission not found");return}U.setSubmissionStatus(E,t.Status).then(r=>{r?(A.value.Submissions.forEach((c,u)=>{l.value.Submissions[u].Status=c.Status}),R&&R("Status Saved")):R&&R("Status not saved")}).catch(()=>{R&&R("Status not saved")})};return(R,E)=>(d(),$(Ke,{modelValue:o.value,"onUpdate:modelValue":E[2]||(E[2]=t=>o.value=t),title:R.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0},{default:n(()=>[a(pe,{class:"px-0 mx-0",fluid:!0},{default:n(()=>[a(Pe,null,{default:n(()=>[(d(!0),g(V,null,W(A.value.Submissions,t=>(d(),$(be,{key:t.SubmissionUUID,class:"pa-0"},{default:n(()=>[a(te,{class:"py-2 align-center"},{default:n(()=>[a(w,{cols:"8"},{default:n(()=>{var r;return[a(ne,{modelValue:t.Status,"onUpdate:modelValue":c=>t.Status=c,items:Z(lt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((r=R.forms.find(c=>c.FormUUID==t.FormUUID))==null?void 0:r.Name)||""},{selection:n(()=>[a(sa,{class:"mr-4"},{default:n(()=>{var c;return[Y(L((c=Z(lt).find(u=>u.value===t.Status))==null?void 0:c.icon),1)]}),_:2},1024),Y(" "+L(Z(ct)(t.Status)),1)]),item:n(({item:c,props:{onClick:u}})=>[a(be,{title:c.title,"prepend-icon":c.raw.icon,onClick:u},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),a(w,{cols:"4"},{default:n(()=>[a(qe,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:r=>S(r.callback,t.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(te,null,{default:n(()=>[a(w,{cols:"12"},{default:n(()=>[a(Ie,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:E[0]||(E[0]=t=>s.value=!0)},{default:n(()=>[Y("Prepare Email")]),_:1})]),_:1})]),_:1}),a(So,{registration:R.registration,"show-editor":s.value,onCloseEditor:E[1]||(E[1]=t=>s.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const Wo=se({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:T}){var ze;const i=va();T("pageTitle","Registration Manager");const o=yt(),s=Ct(),l=_(!0);let A=((ze=o.params.convention)==null?void 0:ze.toString())||"";const U=_({ID:0,ConventionUUID:he(),OrganisationID:0,OrganisationUUID:Ye,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),S=ye(),R=_({ID:0,AdminLayoutUUID:he(),ConventionID:U.value.ID,ConventionUUID:U.value.ConventionUUID,Name:"Registration Table",Type:At.ADMIN_LAYOUT_TABLE,Panels:[]}),E=_([]),t=_([]),r=_([]),c=_([]),u=_([]),b=_(1),y=_(10),ae=_([]),H=_(0),N=_(!1),j=_(""),oe=_(""),Ue=_(""),_e=_(""),p=_(""),O=_(""),M=_([]),D=_([]),h=_([]),J=_([]),X=_([]),q=_([]),ue=_(0),Te=_(),Ee=_(!1);ie(ue,m=>{m===7&&Ce()}),ie(p,()=>{oe.value=Date.now().toString()}),ie(O,()=>{oe.value=Date.now().toString()});const we=()=>{E.value=[],r.value=[],u.value=[];try{S.getConventionAdminLayoutByName(U.value.ConventionUUID,"Registration Table").then(m=>{ue.value+=1,m?R.value=m:(R.value.ConventionID=U.value.ID,R.value.ConventionUUID=U.value.ConventionUUID)})}catch{R.value.ConventionID=U.value.ID,R.value.ConventionUUID=U.value.ConventionUUID}try{S.getConventionForms(U.value.ConventionUUID).then(m=>{ue.value+=1,m&&(E.value=m)})}catch{}try{S.getConventionAccommodation(U.value.ConventionUUID).then(m=>{ue.value+=1,m&&(D.value=m)})}catch{}try{S.getConventionVenues(U.value.ConventionUUID).then(m=>{ue.value+=1,m&&(q.value=m)})}catch{}try{S.getConventionExtras(U.value.ConventionUUID).then(m=>{ue.value+=1,m&&(h.value=m)})}catch{}try{S.getConventionInterests(U.value.ConventionUUID).then(m=>{ue.value+=1,m&&(J.value=m)})}catch{}try{S.getConventionTickets(U.value.ConventionUUID).then(m=>{ue.value+=1,m&&(X.value=m)})}catch{}try{S.getConventionGroups(U.value.ConventionUUID).then(m=>{m&&(t.value=m.sort((v,f)=>v.Name.localeCompare(f.Name)))})}catch{}try{S.getConventionTags(U.value.ConventionUUID).then(m=>{m&&(c.value=m.sort((v,f)=>v.Title.localeCompare(f.Title)).map(v=>(v.Title=`${v.Title} [${v.Key}]`,v)))})}catch{}},ve=({page:m,itemsPerPage:v,sortBy:f})=>{l.value=!0,b.value=m,ae.value=f;const I=u.value.find(x=>x.uuid==j.value),re=I==null?void 0:I.layout.Items;let ee="",Je="";if(f&&re&&f.length>=1){const x=re.find(Me=>Me.LayoutItemUUID==f[0].key);switch(Je=f[0].order,x==null?void 0:x.MetaField){case B.META_DATA_SOURCE_ACCOMMODATION_FORM:ee="submission.status";break;case B.META_DATA_SOURCE_BADGE_FORM:ee="submission.status";break;case B.META_DATA_SOURCE_DEALER_FORM:ee="submission.status";break;case B.META_DATA_SOURCE_REGISTRATION_FORM:ee="submission.status";break;case B.META_DATA_SOURCE_REGISTRATION_REFERENCE:ee="reference";break;case B.META_DATA_SOURCE_SUBMISSION_DATE:ee="created";break;case B.META_DATA_SOURCE_SUBMISSION_STATUS:ee="submission.status";break}switch(x==null?void 0:x.UserField){case z.USER_DATA_SOURCE_DISPLAY_NAME:ee="user.display_name";break;case z.USER_DATA_SOURCE_EMAIL:ee="user.email";break;case z.USER_DATA_SOURCE_FIRST_NAME:ee="user.firstname";break;case z.USER_DATA_SOURCE_HANDLE:ee="user.handle";break;case z.USER_DATA_SOURCE_LAST_NAME:ee="user.lastname";break}}try{const x={Direction:Je,Limit:v,Offset:(m-1)*v,Order:ee};I&&I.layout.RequiredRegistrationTags.length>0&&(x.PanelUUID=I==null?void 0:I.layout.LayoutPanelUUID),(I==null?void 0:I.layout.RequiredFormType)===ce.FORM_TYPE_ACCOMMODATION&&(x.Accommodation=!0),(I==null?void 0:I.layout.RequiredFormType)===ce.FORM_TYPE_BADGE&&(x.Badge=!0),(I==null?void 0:I.layout.RequiredFormType)===ce.FORM_TYPE_DEALER&&(x.Dealer=!0),(I==null?void 0:I.layout.RequiredFormType)===ce.FORM_TYPE_REGISTRATION&&(x.Registration=!0),x.GroupUUID=p.value||Ye,x.TagUUID=O.value||Ye,x.Email=_e.value,x.Reference=Ue.value,S.searchConventionRegistrations(U.value.ConventionUUID,x).then(Me=>{Me&&(H.value=Me.Total,r.value=Me.Registrations,u.value.forEach($e=>{const Tt=$e.layout;$e.items=r.value.map(F=>{const K={};return $e.headers.forEach(We=>{var Qe;const k=Tt.Items.find(Se=>Se.LayoutItemUUID===We.key);if(k){if(k.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&k.SectionField)F.Submissions.forEach(Se=>{const le=Se.Data.find(Ge=>Ge.SectionFieldUUID===k.SectionFieldUUID);if(le){We.type===Vt.ACCOMMODATION?K[k.LayoutItemUUID]={Data:le.Data,Registration:F}:K[k.LayoutItemUUID]=le.Data;return}});else if(k.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&k.UserField)switch(k.UserField){case z.USER_DATA_SOURCE_AVATAR:K[k.LayoutItemUUID]=i.GetProfileImageURL(F.UserUUID);break;case z.USER_DATA_SOURCE_DISPLAY_NAME:K[k.LayoutItemUUID]=F.User.DisplayName;break;case z.USER_DATA_SOURCE_EMAIL:K[k.LayoutItemUUID]=F.User.Additional.Email;break;case z.USER_DATA_SOURCE_HANDLE:K[k.LayoutItemUUID]=F.User.Handle;break;case z.USER_DATA_SOURCE_DATE_OF_BIRTH:K[k.LayoutItemUUID]=F.User.Additional.DOB;break;case z.USER_DATA_SOURCE_FIRST_NAME:K[k.LayoutItemUUID]=F.User.Additional.FirstName;break;case z.USER_DATA_SOURCE_LAST_NAME:K[k.LayoutItemUUID]=F.User.Additional.LastName;break;case z.USER_DATA_SOURCE_TELEGRAM:K[k.LayoutItemUUID]="";break}else if(k.SourceType==="LAYOUT_ITEM_SOURCE_META"&&k.MetaField){const Se=[];let le;const Ge=(Qe=E.value.find(C=>C.Type===ce.FORM_TYPE_REGISTRATION))==null?void 0:Qe.FormUUID,Xe=F.Submissions.find(C=>C.FormUUID===Ge);switch(k.MetaField){case B.META_DATA_SOURCE_REGISTRATION_ACTIONS:K[k.LayoutItemUUID]=F;break;case B.META_DATA_SOURCE_REGISTRATION_GROUP:F.Leader?le=F:le=F.Primary,Se.push({Name:le.User.DisplayName,UUID:le.UserUUID,UserUUID:le.User.UserUUID,IsLeader:!0,Reference:le.Reference}),Se.push(...le.Members.map(C=>({Name:C.User.DisplayName,UUID:C.UserUUID,UserUUID:C.User.UserUUID,IsLeader:!1,Reference:C.Reference}))),K[k.LayoutItemUUID]=Se;break;case B.META_DATA_SOURCE_REGISTRATION_REFERENCE:K[k.LayoutItemUUID]=F.Reference;break;case B.META_DATA_SOURCE_SUBMISSION_DATE:if(Xe){const C=new Date(Xe.CreatedAt||"");K[k.LayoutItemUUID]=`${C.getFullYear()}-${(C.getMonth()+1).toString().padStart(2,"0")}-${C.getDate().toString().padStart(2,"0")} ${C.getHours().toString().padStart(2,"0")}:${C.getMinutes().toString().padStart(2,"0")}:${C.getSeconds().toString().padStart(2,"0")}`}else{const C=new Date(F.CreatedAt||"");K[k.LayoutItemUUID]=`${C.getFullYear()}-${(C.getMonth()+1).toString().padStart(2,"0")}-${C.getDate().toString().padStart(2,"0")} ${C.getHours().toString().padStart(2,"0")}:${C.getMinutes().toString().padStart(2,"0")}:${C.getSeconds().toString().padStart(2,"0")}`}break;case B.META_DATA_SOURCE_ACCOMMODATION_FORM:ke(F.Submissions,E.value),K[k.LayoutItemUUID]=F.Submissions.map(C=>{const P=E.value.find(fe=>fe.FormUUID===C.FormUUID);return{Heading:P==null?void 0:P.Heading,Form:P,Submission:C,Registration:F}}).filter(C=>{var P;return((P=C.Form)==null?void 0:P.Type)===ce.FORM_TYPE_ACCOMMODATION});break;case B.META_DATA_SOURCE_BADGE_FORM:ke(F.Submissions,E.value),K[k.LayoutItemUUID]=F.Submissions.map(C=>{const P=E.value.find(fe=>fe.FormUUID===C.FormUUID);return{Heading:P==null?void 0:P.Heading,Form:P,Submission:C,Registration:F}}).filter(C=>{var P;return((P=C.Form)==null?void 0:P.Type)===ce.FORM_TYPE_BADGE});break;case B.META_DATA_SOURCE_DEALER_FORM:ke(F.Submissions,E.value),K[k.LayoutItemUUID]=F.Submissions.map(C=>{const P=E.value.find(fe=>fe.FormUUID===C.FormUUID);return{Heading:P==null?void 0:P.Heading,Form:P,Submission:C,Registration:F}}).filter(C=>{var P;return((P=C.Form)==null?void 0:P.Type)===ce.FORM_TYPE_DEALER});break;case B.META_DATA_SOURCE_SUBMISSION_STATUS:ke(F.Submissions,E.value),K[k.LayoutItemUUID]=F.Submissions.map(C=>{const P=E.value.find(fe=>fe.FormUUID===C.FormUUID);return{Heading:P==null?void 0:P.Heading,Form:P,Submission:C,Registration:F}});break}}}}),K})}),l.value=!1)})}catch{}},Ce=()=>{R.value.Panels.forEach(m=>{m.Items.forEach(v=>{(v.SectionField==null||v.SectionField.Field==null)&&E.value.find(f=>{f.Sections.find(I=>{if(I.Fields){const re=I.Fields.find(ee=>ee.SectionFieldUUID===v.SectionFieldUUID);if(re)return v.SectionField=re,!0}})})})}),R.value.Panels.length>0&&(u.value=[],R.value.Panels.forEach(m=>{const v={uuid:he(),order:m.Order,name:m.Name,headers:[],items:[],layout:m};m.Items.sort((f,I)=>f.Order>I.Order?1:f.Order==I.Order?0:-1),v.headers=m.Items.map(f=>{var I,re;return f.DefaultSort&&M.value.push({key:f.LayoutItemUUID,order:"asc"}),{key:f.LayoutItemUUID,title:f.Label||((re=(I=f.SectionField)==null?void 0:I.Field)==null?void 0:re.Label)||"",align:f.Align==="end"?"end":"start",sortable:Ne(f),type:Le(f)}}),u.value.push(v)})),(j.value==null||j.value=="")&&u.value.length>0&&(j.value=u.value[0].uuid)};A?S.getConvention(A).then(m=>{m&&(U.value=m,we())}).catch(()=>{s.push("/")}):s.push("/");const Le=m=>{var v,f;if(m.SourceType===Ve.LAYOUT_ITEM_SOURCE_META)return`${m.SourceType}.${m.MetaField}`;if(m.SourceType===Ve.LAYOUT_ITEM_SOURCE_FORM)return(f=(v=m.SectionField)==null?void 0:v.Field)==null?void 0:f.Type;if(m.SourceType===Ve.LAYOUT_ITEM_SOURCE_USER)return`${m.SourceType}.${m.UserField}`},Ne=m=>{const v=[B.META_DATA_SOURCE_ACCOMMODATION_FORM,B.META_DATA_SOURCE_BADGE_FORM,B.META_DATA_SOURCE_DEALER_FORM,B.META_DATA_SOURCE_REGISTRATION_FORM,B.META_DATA_SOURCE_REGISTRATION_REFERENCE,B.META_DATA_SOURCE_SUBMISSION_DATE,B.META_DATA_SOURCE_SUBMISSION_STATUS],f=[z.USER_DATA_SOURCE_DISPLAY_NAME,z.USER_DATA_SOURCE_EMAIL,z.USER_DATA_SOURCE_HANDLE,z.USER_DATA_SOURCE_DATE_OF_BIRTH,z.USER_DATA_SOURCE_FIRST_NAME,z.USER_DATA_SOURCE_LAST_NAME];return v.includes(m.MetaField)||f.includes(m.UserField)},_t=m=>{Te.value=m,Ee.value=!0};return ie(Ee,m=>{m||(Te.value=void 0)}),(m,v)=>(d(),$(Ua,null,{default:n(()=>[a(Aa,{color:"blue-darken-4"},{default:n(()=>[a(aa,{modelValue:j.value,"onUpdate:modelValue":v[0]||(v[0]=f=>j.value=f),"show-arrows":""},{default:n(()=>[(d(!0),g(V,null,W(u.value,f=>(d(),$(oa,{key:f.uuid,value:f.uuid},{default:n(()=>[Y(L(f.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(ca),a(Ie,{icon:"mdi:mdi-cog-outline",onClick:v[1]||(v[1]=f=>N.value=!0)})]),_:1}),a(la,{modelValue:j.value,"onUpdate:modelValue":v[11]||(v[11]=f=>j.value=f),disabled:!0},{default:n(()=>[(d(!0),g(V,null,W(u.value,f=>(d(),$(na,{key:f.uuid,value:f.uuid},{default:n(()=>[f.uuid===j.value?(d(),$(vt,{key:0,class:"pa-2"},{default:n(()=>[a(Z(Da),{"items-per-page":y.value,"onUpdate:itemsPerPage":v[9]||(v[9]=I=>y.value=I),"sort-by":M.value,"onUpdate:sortBy":v[10]||(v[10]=I=>M.value=I),headers:f.headers,"items-length":H.value,items:f.items,"item-value":"LayoutItemUUID",loading:l.value,search:oe.value,"onUpdate:options":ve},je({top:n(()=>[a(pe,null,{default:n(()=>[a(te,null,{default:n(()=>[a(w,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(ge,{modelValue:Ue.value,"onUpdate:modelValue":v[2]||(v[2]=I=>Ue.value=I),label:"Search by Badge",clearable:!0,"hide-details":"",onInput:v[3]||(v[3]=I=>oe.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),a(w,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(ge,{modelValue:_e.value,"onUpdate:modelValue":v[4]||(v[4]=I=>_e.value=I),label:"Search By Email",clearable:!0,"hide-details":"",onInput:v[5]||(v[5]=I=>oe.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),a(w,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(ne,{modelValue:p.value,"onUpdate:modelValue":v[6]||(v[6]=I=>p.value=I),label:"Search By Group",clearable:!0,"hide-details":"",items:t.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),a(w,{cols:"12",sm:"6",lg:"3"},{default:n(()=>[a(ne,{modelValue:O.value,"onUpdate:modelValue":v[7]||(v[7]=I=>O.value=I),label:"Search By Tag",clearable:!0,"hide-details":"",items:c.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[W(f.headers,I=>({name:`item.${I.key}`,fn:n(({item:re})=>[a(Za,{header:I,item:re,accommodations:D.value,convention:U.value,extras:h.value,interests:J.value,tickets:X.value,venues:q.value,onOpenActions:_t,onReload:v[8]||(v[8]=ee=>ve({page:b.value,itemsPerPage:y.value,sortBy:ae.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):Q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),N.value?(d(),$(Ia,{key:0,title:"Edit Layout",modelValue:N.value,"onUpdate:modelValue":v[12]||(v[12]=f=>N.value=f),layout:R.value,onSave:v[13]||(v[13]=f=>{N.value=!1,Ce()})},null,8,["modelValue","layout"])):Q("",!0),Ee.value&&Te.value?(d(),$(fo,{key:1,modelValue:Ee.value,"onUpdate:modelValue":v[14]||(v[14]=f=>Ee.value=f),registration:Te.value,"onUpdate:registration":v[15]||(v[15]=f=>Te.value=f),accommodations:D.value,convention:U.value,extras:h.value,forms:E.value,interests:J.value,tickets:X.value,title:"Registration Status & Communications",venues:q.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):Q("",!0)]),_:1}))}});export{Wo as default};
