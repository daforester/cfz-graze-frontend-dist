import{m as h,u as $,n as B,A as F,_ as G}from"./useTokenManager-rnUNJ-SJ.js";import{i as N,r as n,b as J,B as S,q as U,A as R,v as t,F as q,P as z,V as j,U as H,n as f,f as a,x as d,y as K,C as Y}from"./index-RBqBaP6c.js";import{a as Q}from"./SaveButton.vue_vue_type_script_setup_true_lang-E--A86N2.js";import{a as x}from"./VContainer-UJS08MV_.js";import{V as w,a as E,b as L,c as M,d as W,e as O}from"./VCard-XXAH-KPn.js";import{V as I,a as X}from"./VBtn-eMdl6Irw.js";import{a as Z,V as ee}from"./VRow-Ew16xbUz.js";import{a as te}from"./VTable-4l8rjVl5.js";import"./useModel-d6dcbO9U.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-Yrz3UQKA.js";import"./forwardRefs-k-s8_fJk.js";import"./VDialog-SMrbYf-A.js";import"./VOverlay-ep9HxnA2.js";import"./scopeId--6Ny2ln6.js";import"./VAvatar-Q6pYFwxJ.js";import"./VToolbar-ddYr_OV4.js";import"./VSpacer-QKUQCuji.js";import"./createSimpleFunctional-VSTxAf3o.js";import"./useDisplayTransactions-f6D0xku8.js";import"./VList-bYs0YvO7.js";import"./VDivider-uMXrCIw7.js";import"./VSelect-4F3veCNL.js";import"./VTextField-MLfS1HrX.js";import"./VCheckboxBtn-8djmjaRM.js";import"./VChip-LXTHnfxy.js";import"./userData-Qx7aMthU.js";import"./canEditRegistrations-PHKxD3Wu.js";import"./group-7fhbY6WJ.js";import"./canDo-8w-iwWYc.js";import"./nil-rxyd0N8M.js";import"./VAutocomplete-pq879-6G.js";import"./filter-VlDok18K.js";import"./form-0fJbSFPv.js";import"./submission-40fey8Hx.js";import"./v4-yQnnJER4.js";import"./VDataTable-4NlPSVk7.js";import"./DeleteDialog.vue_vue_type_script_setup_true_lang-1Sn_tvvO.js";import"./SelectGroups.vue_vue_type_script_setup_true_lang-k1toYlxk.js";import"./VTextarea-ebmfYZ2x.js";import"./VForm-8K7RZwN_.js";import"./VNavigationDrawer-ZHg2PGhd.js";const ae=N({__name:"RunnerSocket",emits:["data","ready","updating","updated"],setup(P,{emit:D}){const A=z(),g=j(),c=H(),m=D,y=n(),V=n(),p=n(),i=n(!1),C=n(!1),_=n(""),u=n(!1),s=h({mode:"host",wsUri:A.getRunnerSocketURL()}),T=B();s.on("authenticated",()=>{r()}),s.on("auth_failed",()=>{i.value=!1}),s.on("convention_data",o=>{if(!o)return;const e=o;y.value=e.Convention,m("updated",e),m("ready")}),s.on("error",o=>{const e=o;_.value=`Error: ${$(e.Message)}`,u.value=!0,i.value||(C.value=!0)}),s.on("joined",()=>{i.value=!0;const o={Command:"GET_CURRENT_REGISTRATION",Params:new Map,Data:""};s.JSON(o),m("ready")}),s.on("kicked",()=>{c.push("/")}),s.on("open",()=>{const o=T.getTokenByService("GrazeAPI");s.send(`AUTH ${o==null?void 0:o.AccessToken}`)}),s.on("runner_data",o=>{if(!o)return;const e=o;if(!(!e.RunnerLayout||!e.Registration)){if(m("data",e),V.value=e.RunnerLayout,p.value=e.Registration,!y.value||e.RunnerLayout.ConventionUUID!==y.value.ConventionUUID){m("updating"),l(e.RunnerLayout.ConventionUUID);return}m("ready")}});const r=()=>{const o={Key:g.params.session||"",Mode:"runner",UserUUID:g.params.user||""},e={Command:"SET_MODE",Params:new Map,Data:JSON.stringify(o)};s.JSON(e)},l=o=>{const k={Command:"GET_CONVENTION_DATA",Params:new Map,Data:JSON.stringify({ConventionUUID:o})};s.JSON(k)};J(()=>{s.destroy()});const v=()=>{c.push("/")},b=()=>{location.reload()};return(o,e)=>(f(),S(q,null,[u.value?(f(),U(Q,{key:0,modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=k=>u.value=k),message:_.value,timeout:1e4},null,8,["modelValue","message"])):R("",!0),C.value?(f(),U(x,{key:1},{default:t(()=>[a(O,{"max-width":"620",class:"mx-auto",elevation:"10"},{default:t(()=>[a(w,{class:"bg-red-darken-4"},{default:t(()=>[a(E,null,{default:t(()=>[d(" Connection Failure ")]),_:1}),a(L,{style:{opacity:"0.8"}},{default:t(()=>[d(" Failed to establish connection to host ")]),_:1})]),_:1}),a(M,{class:"mt-4"},{default:t(()=>[d(K(_.value),1)]),_:1}),a(W,{class:"justify-space-between"},{default:t(()=>[a(I,{"prepend-icon":"mdi:mdi-home",variant:"flat",color:"primary",onClick:e[1]||(e[1]=k=>Y(c).push("/"))},{default:t(()=>[d(" Dashboard ")]),_:1}),a(I,{"prepend-icon":"mdi:mdi-reload",variant:"flat",color:"success",onClick:b},{default:t(()=>[d(" Retry ")]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0),i.value?(f(),U(x,{key:2,fluid:!0},{default:t(()=>[a(ee,null,{default:t(()=>[a(Z,{class:"text-center"},{default:t(()=>[a(I,{"prepend-icon":"mdi:mdi-link-variant-remove",variant:"flat",color:"error",onClick:v,elevation:"10"},{default:t(()=>[d(" Disconnect ")]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0)],64))}}),qe=N({__name:"RunnerView",emits:["pageTitle"],setup(P,{emit:D}){D("pageTitle","Registration Runner");const g=n([]),c=n(),m=n([]),y=n([]),V=n([]),p=n({ID:0,AdminLayoutUUID:"",ConventionID:0,ConventionUUID:"",Name:"",RunnerLayoutUUID:"",Type:F.ADMIN_LAYOUT_PANELS,Panels:[]}),i=n(),C=n([]),_=n([]),u=n(!1),s=r=>{i.value=void 0,setTimeout(()=>{p.value=r.RunnerLayout,i.value=r.Registration},200)},T=r=>{g.value=r.Accommodations,c.value=r.Convention,m.value=r.Extras,y.value=r.Forms,V.value=r.Interests,C.value=r.Tickets,_.value=r.Venues,p.value&&(u.value=!0)};return(r,l)=>(f(),S("div",null,[u.value&&p.value&&c.value&&i.value?(f(),U(te,{key:0},{default:t(()=>[a(G,{convention:c.value,tickets:C.value,accommodations:g.value,extras:m.value,venues:_.value,interests:V.value,forms:y.value,layout:p.value,"onUpdate:layout":l[0]||(l[0]=v=>p.value=v),modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=v=>i.value=v)},null,8,["convention","tickets","accommodations","extras","venues","interests","forms","layout","modelValue"])]),_:1})):u.value?(f(),U(x,{key:1},{default:t(()=>[a(O,{"max-width":"620",class:"mx-auto",elevation:"10"},{default:t(()=>[a(w,{class:"bg-orange-darken-3"},{default:t(()=>[a(E,null,{default:t(()=>[d(" Awaiting Data ")]),_:1}),a(L,{style:{opacity:"0.9"}},{default:t(()=>[d(" Display will update as soon as host provides registration details ")]),_:1})]),_:1}),a(M,{class:"mt-4 text-center"},{default:t(()=>[a(X,{indeterminate:!0,size:60,width:"8",color:"orange"})]),_:1})]),_:1})]),_:1})):R("",!0),a(ae,{onData:s,onReady:l[2]||(l[2]=v=>u.value=!0),onUpdating:l[3]||(l[3]=v=>u.value=!1),onUpdated:T})]))}});export{qe as default};
