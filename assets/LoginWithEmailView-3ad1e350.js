import{I as S,a0 as O,r as o,K as r,L as b,M as a,v as t,N as i,O as E,Q as g,S as s,P as H,R as L,H as G,U as f,$ as K,V as Q,W as J,_ as X}from"./index-9d3a325e.js";import{s as I}from"./index-26b71cef.js";import{S as q}from"./setupLogin-1345a9c3.js";import{E as d}from"./emailFormVariant-e5e0aad4.js";import{V as h,a as C}from"./VRow-b100d76b.js";import{V as B}from"./VTextField-d79b9b94.js";import{V as N}from"./VBtn-e221c10a.js";import{j as $}from"./VContainer-0af990dc.js";import{V as Y}from"./VForm-5baeb7c5.js";import{G as ee}from"./userData-ba6a6ed8.js";import{b as ae,V as te,c as le,e as re}from"./VCard-e045d9c6.js";import"./VAvatar-a08eb85a.js";const y=w=>(Q("data-v-4075b2db"),w=w(),J(),w),se={key:1,class:"ma-auto text-left"},oe={key:2,class:"ma-auto text-left"},ne={key:3,class:"ma-auto text-left"},ue=y(()=>f("br",null,null,-1)),ie=y(()=>f("br",null,null,-1)),de={class:"text-red-darken-1 font-weight-bold"},ce=y(()=>f("br",null,null,-1)),me=y(()=>f("br",null,null,-1)),ve=y(()=>f("br",null,null,-1)),fe=y(()=>f("span",{class:"text-red-darken-4"}," Please contact registration for further assistance. ",-1)),pe=S({__name:"EmailLoginForm",props:{variant:{default:()=>d.COMBINED}},setup(w){const A=O(),p=K(),_=o(!0),M=o(!1),R=o(!1),V=o(!1),c=o(""),k=o(""),D=o(!1),m=o({required:e=>!!e||"Required.",min:e=>e.length>=8||"Min 8 characters",email:e=>!!e.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),n=o(""),u=o(!1),T=new URL(location.href).searchParams.get("token")||"";T!==""&&(_.value=!1,V.value=!0,p.validateAccount(T).then(({created:e,tokens:l,user:v})=>{try{q(l,v,A,e)}catch(F){console.error(F)}}).catch(e=>{n.value=e.ErrorMessage}));const x=()=>(n.value="",!(m.value.required(c.value)!==!0||m.value.email(c.value)!==!0||m.value.required(k.value)!==!0||m.value.min(k.value)!==!0)),W=e=>{if(e.preventDefault(),!x())return;const v=new URL(location.href).searchParams.get("state");u.value=!0,p.oAuthLogin("internal",c.value,k.value,v||"").then(({created:F,tokens:j,user:Z})=>{q(j,Z,A,F)}).catch(()=>{n.value="Login failed, check credentials or register",u.value=!1})},U=e=>{e.preventDefault(),x()&&(u.value=!0,p.registerAccount(c.value,k.value).then(l=>{_.value=!1,l&&(R.value=!0)}).catch(()=>{n.value="Unable to register, address may be in use",u.value=!1}))},z=()=>{p.requestLoginLink(c.value).then(e=>{_.value=!1,e&&(M.value=!0)}).catch(()=>{n.value="A problem was encountered, please try again",u.value=!1})};return(e,l)=>_.value?(r(),b(Y,{key:0,onSubmit:l[3]||(l[3]=H(()=>{},["stop"])),class:"ma-auto vForm",disabled:u.value},{default:a(()=>[t(C,null,{default:a(()=>[t(h,null,{default:a(()=>[t(B,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=v=>c.value=v),rules:[m.value.required,m.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(h,null,{default:a(()=>[t(B,{margin:"normal",required:"",name:"password",label:"Password",type:D.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=v=>k.value=v),"append-icon":D.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":l[2]||(l[2]=v=>D.value=!D.value),counter:"",hint:"At least 8 characters",rules:[m.value.required,m.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),n.value?(r(),b(C,{key:0},{default:a(()=>[t(h,{class:"text-red-darken-1 font-weight-bold"},{default:a(()=>[i(E(n.value),1)]),_:1})]),_:1})):g("",!0),t(C,{justify:"space-between"},{default:a(()=>[e.variant===s(d).COMBINED||e.variant===s(d).REGISTER?(r(),b(h,{key:0,cols:"12",sm:"6"},{default:a(()=>[t(N,{onClick:U,color:"orange-darken-2",disabled:u.value},{default:a(()=>[i(" Register ")]),_:1},8,["disabled"])]),_:1})):g("",!0),e.variant===s(d).COMBINED||e.variant===s(d).LOGIN?(r(),b(h,{key:1,cols:"12",sm:"6"},{default:a(()=>[t(N,{onClick:W,color:"primary",disabled:u.value,type:"submit"},{default:a(()=>[i(" Sign In ")]),_:1},8,["disabled"])]),_:1})):g("",!0),e.variant===s(d).ADD_CREDENTIAL?(r(),b(h,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:a(()=>[t(N,{onClick:U,color:"orange-darken-2",disabled:u.value},{default:a(()=>[i(" Add Email ")]),_:1},8,["disabled"])]),_:1})):g("",!0)]),_:1}),e.variant===s(d).COMBINED||e.variant===s(d).LOGIN?(r(),b($,{key:1},{default:a(()=>[t(C,null,{default:a(()=>[t(h,null,{default:a(()=>[t(N,{variant:"text",onClick:z},{default:a(()=>[i(E(s(I).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["disabled"])):M.value?(r(),L("p",se,E(s(I).messageResetEmail),1)):R.value?(r(),L("p",oe,E(s(I).messageVerifyNewAccountEmail),1)):V.value?(r(),L("p",ne,[i(E(s(I).messageVerifiedNewAccountMessage)+" ",1),n.value?(r(),L(G,{key:0},[ue,ie,f("span",de,[i(" An error occurred creating or recovering account:"),ce,i(" "+E(n.value),1)]),me,ve,fe],64)):g("",!0)])):g("",!0)}});const P=X(pe,[["__scopeId","data-v-4075b2db"]]),_e=f("h2",null,"Email",-1),Ie=S({__name:"LoginWithEmailView",props:{variant:{default:()=>d.COMBINED}},emits:["pageTitle"],setup(w,{emit:A}){A("pageTitle","Email Login");const p=O(),_=ee(),R=new URL(location.href).searchParams.get("token")||"";return _&&w.variant!=="ADD_CREDENTIAL"&&!R&&(Date.now()-new Date(_.CreatedAt||"").getTime()>2e4?p.push("/"):p.push("/profile")),(V,c)=>V.variant=="ADD_CREDENTIAL"?(r(),b($,{key:0,style:{"max-width":"550px"}},{default:a(()=>[t(re,null,{default:a(()=>[t(ae,{class:"text-center"},{default:a(()=>[t(te,null,{default:a(()=>[i("Add an E-Mail Address")]),_:1})]),_:1}),t(le,null,{default:a(()=>[t(P,{variant:V.variant},null,8,["variant"])]),_:1})]),_:1})]),_:1})):(r(),L(G,{key:1},[_e,t(P,{variant:V.variant},null,8,["variant"])],64))}});export{Ie as default};
