import{_}from"./FormField.vue_vue_type_script_setup_true_lang-63e72ec7.js";import{d as g,X as k,Y as C,y as $,R as q,o as n,b as f,w as D,N as u,G as U,K as l,O as v,F as c,c as S,e as w}from"./index-629d6ed3.js";import{_ as B}from"./SaveButton.vue_vue_type_script_setup_true_lang-922758a2.js";import{u as E}from"./useGrazeAPI-41a94fc6.js";import{G}from"./userData-d733b0cf.js";import{v as p}from"./v4-a960c1f4.js";import{V as H}from"./VContainer-10e79729.js";import{a as F,V}from"./VRow-bbf645cf.js";const N={key:0,class:"my-2"},R={key:1,class:"my-2"},M={key:0,class:"my-2"},x={key:1,class:"my-2"},Y=g({__name:"FormRenderer",props:k({convention:{},data:{},editable:{type:Boolean,default:!0},preview:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(r){const o=C(r,"modelValue"),d=G(),y=E(),m=$((()=>{if(r.data!==void 0){const i=q(r.data);return o.value.Sections.forEach(e=>{e.Fields&&e.Fields.forEach(t=>{const s=r.data.Data.find(I=>I.SectionFieldUUID===t.SectionFieldUUID&&I.SectionFieldUUID==t.SectionFieldUUID);if(s)t.Value=s.Data;else{const I={ID:0,SubmissionDataUUID:p(),SubmissionID:r.data.ID,SubmissionUUID:r.data.SubmissionUUID,SectionID:e.ID,SectionUUID:e.SectionUUID,SectionFieldID:t.ID,SectionFieldUUID:t.SectionFieldUUID,Data:t.Value};i.Data.push(I)}})}),i}const a={ID:0,SubmissionUUID:p(),FormID:o.value.ID,FormUUID:o.value.FormUUID,UserID:(d==null?void 0:d.ID)||0,UserUUID:(d==null?void 0:d.UserUUID)||"",Data:[]};return a.Data=o.value.Sections.map(i=>i.Fields?i.Fields.map(e=>({ID:0,SubmissionDataUUID:p(),SubmissionID:a.ID,SubmissionUUID:a.SubmissionUUID,SectionID:i.ID,SectionUUID:i.SectionUUID,SectionFieldID:e.ID,SectionFieldUUID:e.SectionFieldUUID,Data:e.Value})):[]).flat(),a})()),h=(a,i,e)=>{const t=m.value.Data.find(s=>s.SectionUUID===a&&s.SectionFieldUUID===i);t&&(t.Data=e)},b=({callback:a})=>{y.saveSubmission(m.value).then(i=>{i?(m.value=i,a&&a("Saved")):a&&a("Failed to process request")}).catch(()=>{a&&a("Failed to process request")})};return(a,i)=>(n(),f(H,null,{default:D(()=>[o.value.Heading?(n(),u("h2",N,U(o.value.Heading),1)):l("",!0),o.value.Description?(n(),u("p",R,U(o.value.Description),1)):l("",!0),(n(!0),u(c,null,v(o.value.Sections,e=>(n(),u(c,{key:`section_${o.value.ID}.${e.ID}`},[e.Heading?(n(),u("h3",M,U(e.Heading),1)):l("",!0),e.Description?(n(),u("p",x,U(e.Description),1)):l("",!0),e.Fields?(n(!0),u(c,{key:2},v(e.Fields,t=>(n(),u(c,{key:`field_${o.value.ID}.${e.ID}.${t.ID}`},[t.Field?(n(),f(F,{key:0},{default:D(()=>[S(V,null,{default:D(()=>[S(_,{field:t.Field,modelValue:t.Value,"onUpdate:modelValue":s=>t.Value=s,convention:a.convention,required:t.Required,"persistent-hint":!0,disabled:!a.editable,onChange:s=>h(e.SectionUUID,t.SectionFieldUUID,t.Value)},null,8,["field","modelValue","onUpdate:modelValue","convention","required","disabled","onChange"])]),_:2},1024)]),_:2},1024)):l("",!0)],64))),128)):l("",!0)],64))),128)),a.editable&&!a.preview?(n(),f(F,{key:2},{default:D(()=>[S(V,null,{default:D(()=>[S(B,{onClick:b})]),_:1})]),_:1})):l("",!0),w(" "+U(m.value),1)]),_:1}))}});export{Y as _};
