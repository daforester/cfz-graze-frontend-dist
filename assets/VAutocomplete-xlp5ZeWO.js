import{m as we,u as be,a as Ce,b as Se}from"./VSelect-l0mvoSj-.js";import{c as xe,V as le}from"./VTextField-CWx-2kjN.js";import{j as pe,u as Ie,V as te,A as Me}from"./VContainer-59qX0LuM.js";import{p as re,r as L,c as M,C as N,h as Ae,aE as Z,aI as Pe,R as _e,d as De,af as Ke,s as j,u as X,w as Q,Y as ae,ab as Re,f as s,F as Y,m as W,aO as Le,x as Te,aP as Oe,aQ as ue}from"./index-BD7ibzFp.js";import{u as Ee,f as Ne}from"./forwardRefs-V3oX-JQ5.js";import{e as je,V as Be,a as ne}from"./VList-KL5jmi9i.js";import{m as Ue,a as ze}from"./VAvatar-1tWckwvs.js";import{V as He}from"./VCheckboxBtn-YFA4cTQ6.js";import{a as Qe}from"./VChip-MMeuZ91u.js";const We=(e,c,t)=>e==null||c==null?-1:e.toString().toLocaleLowerCase().indexOf(c.toString().toLocaleLowerCase()),Ye=re({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function $e(e,c,t){var x;const m=[],v=(t==null?void 0:t.default)??We,h=t!=null&&t.filterKeys?Z(t.filterKeys):!1,k=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return m;e:for(let d=0;d<e.length;d++){const[w,p=w]=Z(e[d]),r={},u={};let y=-1;if(c&&!(t!=null&&t.noFilter)){if(typeof w=="object"){const T=h||Object.keys(p);for(const I of T){const B=Pe(p,I,p),O=(x=t==null?void 0:t.customKeyFilter)==null?void 0:x[I];if(y=O?O(B,c,w):v(B,c,w),y!==-1&&y!==!1)O?r[I]=y:u[I]=y;else if((t==null?void 0:t.filterMode)==="every")continue e}}else y=v(w,c,w),y!==-1&&y!==!1&&(u.title=y);const A=Object.keys(u).length,P=Object.keys(r).length;if(!A&&!P||(t==null?void 0:t.filterMode)==="union"&&P!==k&&!A||(t==null?void 0:t.filterMode)==="intersection"&&(P!==k||!A))continue}m.push({index:d,matches:{...u,...r}})}return m}function Ge(e,c,t,m){const v=L([]),h=L(new Map),k=M(()=>m!=null&&m.transform?N(c).map(d=>[d,m.transform(d)]):N(c));Ae(()=>{const d=typeof t=="function"?t():N(t),w=typeof d!="string"&&typeof d!="number"?"":String(d),p=$e(k.value,w,{customKeyFilter:{...e.customKeyFilter,...N(m==null?void 0:m.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),r=N(c),u=[],y=new Map;p.forEach(A=>{let{index:P,matches:T}=A;const I=r[P];u.push(I),y.set(I.value,T)}),v.value=u,h.value=y});function x(d){return h.value.get(d.value)}return{filteredItems:v,filteredMatches:h,getMatches:x}}function Je(e,c,t){if(c==null)return e;if(Array.isArray(c))throw new Error("Multiple matches is not implemented");return typeof c=="number"&&~c?s(Y,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,c)]),s("span",{class:"v-autocomplete__mask"},[e.substr(c,t)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(c+t)])]):e}const Xe=re({autoSelectFirst:{type:[Boolean,String]},search:String,...Ye({filterKeys:["title"]}),...we(),..._e(xe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ue({transition:!1})},"VAutocomplete"),ol=De()({name:"VAutocomplete",props:Xe(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,c){let{slots:t}=c;const{t:m}=Ke(),v=L(),h=j(!1),k=j(!0),x=j(!1),d=L(),w=L(),p=X(e,"menu"),r=M({get:()=>p.value,set:l=>{var a;p.value&&!l&&((a=d.value)!=null&&a.Î¨openChildren)||(p.value=l)}}),u=j(-1),y=M(()=>{var l;return(l=v.value)==null?void 0:l.color}),A=M(()=>r.value?e.closeText:e.openText),{items:P,transformIn:T,transformOut:I}=je(e),{textColorClasses:B,textColorStyles:O}=pe(y),g=X(e,"search",""),o=X(e,"modelValue",[],l=>T(l===null?[null]:Z(l)),l=>{const a=I(l);return e.multiple?a:a[0]??null}),oe=M(()=>typeof e.counterValue=="function"?e.counterValue(o.value):typeof e.counterValue=="number"?e.counterValue:o.value.length),R=Ee(),{filteredItems:$,getMatches:se}=Ge(e,P,()=>k.value?"":g.value),b=M(()=>e.hideSelected?$.value.filter(l=>!o.value.some(a=>a.value===l.value)):$.value),ce=M(()=>o.value.map(l=>l.props.value)),U=M(()=>{var a;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&g.value===((a=b.value[0])==null?void 0:a.title))&&b.value.length>0&&!k.value&&!x.value}),G=M(()=>e.hideNoData&&!b.value.length||e.readonly||(R==null?void 0:R.isReadonly.value)),J=L(),{onListScroll:ie,onListKeydown:fe}=be(J,v);function ve(l){e.openOnClear&&(r.value=!0),g.value=""}function de(){G.value||(r.value=!0)}function me(l){G.value||(h.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function he(l){var C,n,V;if(e.readonly||R!=null&&R.isReadonly.value)return;const a=v.value.selectionStart,f=o.value.length;if((u.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),U.value&&["Enter","Tab"].includes(l.key)&&_(b.value[0]),l.key==="ArrowDown"&&U.value&&((C=J.value)==null||C.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(u.value<0){l.key==="Backspace"&&!g.value&&(u.value=f-1);return}const i=u.value,S=o.value[u.value];S&&!S.props.disabled&&_(S),u.value=i>=f-1?f-2:i}if(l.key==="ArrowLeft"){if(u.value<0&&a>0)return;const i=u.value>-1?u.value-1:f-1;o.value[i]?u.value=i:(u.value=-1,v.value.setSelectionRange((n=g.value)==null?void 0:n.length,(V=g.value)==null?void 0:V.length))}if(l.key==="ArrowRight"){if(u.value<0)return;const i=u.value+1;o.value[i]?u.value=i:(u.value=-1,v.value.setSelectionRange(0,0))}}}function ge(l){if(ue(v.value,":autofill")||ue(v.value,":-webkit-autofill")){const a=P.value.find(f=>f.title===l.target.value);a&&_(a)}}function ye(){var l;h.value&&(k.value=!0,(l=v.value)==null||l.focus())}function Ve(l){h.value=!0,setTimeout(()=>{x.value=!0})}function Fe(l){x.value=!1}function ke(l){(l==null||l===""&&!e.multiple)&&(o.value=[])}const E=j(!1);function _(l){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!l.props.disabled)if(e.multiple){const f=o.value.findIndex(C=>e.valueComparator(C.value,l.value));if(f===-1)o.value=[...o.value,l];else{const C=[...o.value];C.splice(f,1),o.value=C}}else o.value=a?[l]:[],E.value=!0,g.value=a?l.title:"",r.value=!1,k.value=!0,ae(()=>E.value=!1)}return Q(h,(l,a)=>{var f;l!==a&&(l?(E.value=!0,g.value=e.multiple?"":String(((f=o.value.at(-1))==null?void 0:f.props.title)??""),k.value=!0,ae(()=>E.value=!1)):(!e.multiple&&g.value==null?o.value=[]:U.value&&!x.value&&!o.value.some(C=>{let{value:n}=C;return n===b.value[0].value})&&_(b.value[0]),r.value=!1,g.value="",u.value=-1))}),Q(g,l=>{!h.value||E.value||(l&&(r.value=!0),k.value=!l)}),Q(r,()=>{if(!e.hideSelected&&r.value&&o.value.length){const l=b.value.findIndex(a=>o.value.some(f=>a.value===f.value));Re&&window.requestAnimationFrame(()=>{var a;l>=0&&((a=w.value)==null||a.scrollToIndex(l))})}}),Q(b,(l,a)=>{h.value&&(!l.length&&e.hideNoData&&(r.value=!1),!a.length&&l.length&&(r.value=!0))}),Ie(()=>{const l=!!(e.chips||t.chip),a=!!(!e.hideNoData||b.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),f=o.value.length>0,C=le.filterProps(e);return s(le,W({ref:v},C,{modelValue:g.value,"onUpdate:modelValue":[n=>g.value=n,ke],focused:h.value,"onUpdate:focused":n=>h.value=n,validationValue:o.externalValue,counterValue:oe.value,dirty:f,onChange:ge,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!t.selection,"v-autocomplete--selecting-index":u.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:f?void 0:e.placeholder,"onClick:clear":ve,"onMousedown:control":de,onKeydown:he}),{...t,default:()=>s(Y,null,[s(Ce,W({ref:d,modelValue:r.value,"onUpdate:modelValue":n=>r.value=n,activator:"parent",contentClass:"v-autocomplete__content",disabled:G.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ye},e.menuProps),{default:()=>[a&&s(Be,{ref:J,selected:ce.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:fe,onFocusin:Ve,onFocusout:Fe,onScrollPassive:ie,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},{default:()=>{var n,V,i;return[(n=t["prepend-item"])==null?void 0:n.call(t),!b.value.length&&!e.hideNoData&&(((V=t["no-data"])==null?void 0:V.call(t))??s(ne,{title:m(e.noDataText)},null)),s(Se,{ref:w,renderless:!0,items:b.value},{default:S=>{var ee;let{item:F,index:D,itemRef:K}=S;const q=W(F.props,{ref:K,key:D,active:U.value&&D===0?!0:void 0,onClick:()=>_(F)});return((ee=t.item)==null?void 0:ee.call(t,{item:F,index:D,props:q}))??s(ne,q,{prepend:z=>{let{isSelected:H}=z;return s(Y,null,[e.multiple&&!e.hideSelected?s(He,{key:F.value,modelValue:H,ripple:!1,tabindex:"-1"},null):void 0,F.props.prependAvatar&&s(ze,{image:F.props.prependAvatar},null),F.props.prependIcon&&s(te,{icon:F.props.prependIcon},null)])},title:()=>{var z,H;return k.value?F.title:Je(F.title,(z=se(F))==null?void 0:z.title,((H=g.value)==null?void 0:H.length)??0)}})}}),(i=t["append-item"])==null?void 0:i.call(t)]}})]}),o.value.map((n,V)=>{function i(K){K.stopPropagation(),K.preventDefault(),_(n,!1)}const S={"onClick:close":i,onMousedown(K){K.preventDefault(),K.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},F=l?!!t.chip:!!t.selection,D=F?Le(l?t.chip({item:n,index:V,props:S}):t.selection({item:n,index:V})):void 0;if(!(F&&!D))return s("div",{key:n.value,class:["v-autocomplete__selection",V===u.value&&["v-autocomplete__selection--selected",B.value]],style:V===u.value?O.value:{}},[l?t.chip?s(Me,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>[D]}):s(Qe,W({key:"chip",closable:e.closableChips,size:"small",text:n.title,disabled:n.props.disabled},S),null):D??s("span",{class:"v-autocomplete__selection-text"},[n.title,e.multiple&&V<o.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[Te(",")])])])})]),"append-inner":function(){var S;for(var n=arguments.length,V=new Array(n),i=0;i<n;i++)V[i]=arguments[i];return s(Y,null,[(S=t["append-inner"])==null?void 0:S.call(t,...V),e.menuIcon?s(te,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:me,onClick:Oe,"aria-label":m(A.value),title:m(A.value)},null):void 0])}})}),Ne({isFocused:h,isPristine:k,menu:r,search:g,filteredItems:$,select:_},v)}});export{ol as V,Ye as m,Ge as u};
