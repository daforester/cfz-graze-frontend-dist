import{p as we,n as $e,e as X,t as z,c as Ye,G as Be,v as r,H as f,x as Ie,I as Z,a1 as ye,a2 as Ge,r as E,a3 as ce,K as n,L as k,M as S,$ as fe,S as Q,a8 as Oe,Z as V,Q as w,R as _,O as b,_ as he,U as F,N as Y,a4 as He,a0 as qe,w as xe}from"./index-acea51ac.js";import{a as je,F as te}from"./form-e2a93b7c.js";import{_ as Je}from"./ModelDialog.vue_vue_type_script_setup_true_lang-db637950.js";import{m as Ke,j as ze,k as We,l as Qe,n as Xe,o as Ze,p as et,u as tt,q as at,r as lt,s as ot,t as nt,v as it,w as st,x as ut,y as Ce,z as ge,A as Me,_ as Le,f as rt,g as dt,h as mt,i as Ut,d as _t}from"./VWindowItem-d0f6b3a2.js";import{e as At,T as ct,d as Tt}from"./FormRenderer.vue_vue_type_style_index_0_lang-f048c932.js";import{a as Ae,V as W}from"./VRow-0430d55e.js";import{V as Re}from"./VTextField-d272a7fc.js";import{V as ee}from"./copyToClipboard-9c1f29ba.js";import{u as St,j as De}from"./VContainer-2bf64696.js";import{v as oe}from"./v4-a960c1f4.js";import{S as Et}from"./submission-56c4c4f1.js";import{V as pe}from"./VBtn-90585e18.js";import{V as vt}from"./VAvatar-33305e30.js";import{c as It,e as Ne}from"./VCard-a5519cb4.js";import{V as Rt}from"./VDialog-a7e1d605.js";import{s as Dt}from"./sortSubmissions-ed9e4490.js";import{u as Ot}from"./useStoreAPI-17c562ae.js";import{u as pt,V as ft}from"./VToolbar-7d3e3979.js";import{V as yt}from"./VSpacer-79faa933.js";import{V as ke}from"./VTable-9bf46955.js";import"./VChip-7960de3d.js";import"./scopeId-a20591ba.js";import"./VCheckbox-1c1ea56e.js";import"./VToolbarItems-1fd7048b.js";import"./VList-71fc7e3f.js";import"./VDivider-3206ba53.js";import"./index-71069b21.js";import"./VTextarea-33c594ee.js";import"./userData-95280594.js";import"./VForm-f3ef703b.js";var be=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(be||{});const Ct=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ne=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(ne||{});const gt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(q||{});const Mt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var O=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(O||{});const Lt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],kt=we({itemsLength:{type:[Number,String],required:!0},...Ke(),...ze(),...We()},"VDataTableServer"),ht=$e()({name:"VDataTableServer",props:kt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,L)=>!0},setup(e,L){let{emit:d,slots:l}=L;const{groupBy:i}=Qe(e),{sortBy:u,multiSort:v,mustSort:c}=Xe(e),{page:R,itemsPerPage:C}=Ze(e),t=X(()=>parseInt(e.itemsLength,10)),{columns:m,headers:o}=et(e,{groupBy:i,showSelect:z(e,"showSelect"),showExpand:z(e,"showExpand")}),{items:p}=tt(e,m),{toggleSort:T}=at({sortBy:u,multiSort:v,mustSort:c,page:R}),{opened:G,isGroupOpen:h,toggleGroup:j,extractRows:$}=lt({groupBy:i,sortBy:u}),{pageCount:ie,setItemsPerPage:se}=ot({page:R,itemsPerPage:C,itemsLength:t}),{flatItems:ae}=nt(p,i,G),{isSelected:ue,select:re,selectAll:B,toggleSelect:Te,someSelected:de,allSelected:me}=it(e,{allItems:p,currentPage:p}),{isExpanded:Se,toggleExpand:Ee}=st(e),Ue=X(()=>$(p.value));ut({page:R,itemsPerPage:C,sortBy:u,groupBy:i,search:z(e,"search")}),Ye("v-data-table",{toggleSort:T,sortBy:u}),Be({VDataTableRows:{hideNoData:z(e,"hideNoData"),noDataText:z(e,"noDataText"),loading:z(e,"loading"),loadingText:z(e,"loadingText")}});const a=X(()=>({page:R.value,itemsPerPage:C.value,sortBy:u.value,pageCount:ie.value,toggleSort:T,setItemsPerPage:se,someSelected:de.value,allSelected:me.value,isSelected:ue,select:re,selectAll:B,toggleSelect:Te,isExpanded:Se,toggleExpand:Ee,isGroupOpen:h,toggleGroup:j,items:Ue.value,groupedItems:ae.value,columns:m.value,headers:o.value}));St(()=>{const[U]=Ce.filterProps(e),[s]=ge.filterProps(e),[A]=Me.filterProps(e),[P]=ke.filterProps(e);return r(ke,Ie({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},P),{top:()=>{var g;return(g=l.top)==null?void 0:g.call(l,a.value)},default:()=>{var g,le,y,x;return l.default?l.default(a.value):r(f,null,[(g=l.colgroup)==null?void 0:g.call(l,a.value),r("thead",{class:"v-data-table__thead",role:"rowgroup"},[r(ge,Ie(s,{sticky:e.fixedHeader}),l)]),(le=l.thead)==null?void 0:le.call(l,a.value),r("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(a.value):r(Me,Ie(A,{items:ae.value}),l)]),(y=l.tbody)==null?void 0:y.call(l,a.value),(x=l.tfoot)==null?void 0:x.call(l,a.value)])},bottom:()=>l.bottom?l.bottom(a.value):r(Ce,U,{prepend:l["footer.prepend"]})})})}}),Nt=Z({__name:"EditAdminLayout",props:ye({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:ye(["save"],["update:modelValue"]),setup(e,{emit:L}){const d=Ge(e,"modelValue"),l=E(ce(e.layout)),i=E([]),u=fe(),v=({callback:t})=>{const m=()=>{t&&t("Failed to Save Layout")},o=()=>{t&&t("Layout Saved")};u.saveAdminLayout(l.value).then(p=>{p?(o(),L("save",p)):m()}).catch(()=>{m()})},c=()=>({ID:0,LayoutPanelUUID:oe(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:te.FORM_TYPE_NIL}),R=t=>()=>({ID:0,LayoutItemUUID:oe(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:ne.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),C=t=>{const m=i.value.find(o=>o.value===t.SectionFieldUUID);m&&(t.SectionFieldID=m.object.ID,t.SectionField=m.object)};return u.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(m=>m.Sections.forEach(o=>o.Fields&&i.value.push(...o.Fields.map(p=>{var G;return{title:`${m.Name} - ${o.Name} - ${(G=p.Field)==null?void 0:G.Name}`,value:p.SectionFieldUUID,object:p}})))),i.value.sort(At("title"))}),(t,m)=>(n(),k(Je,{modelValue:d.value,"onUpdate:modelValue":m[3]||(m[3]=o=>d.value=o),onSave:v,title:t.title,color:"primary"},{default:S(()=>[r(De,{class:"px-0 mx-0",fluid:!0},{default:S(()=>[r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(Re,{modelValue:l.value.Name,"onUpdate:modelValue":m[0]||(m[0]=o=>l.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(W,{cols:"12",sm:"6"},{default:S(()=>[r(ee,{modelValue:l.value.Type,"onUpdate:modelValue":m[1]||(m[1]=o=>l.value.Type=o),label:"Layout Type",items:Q(Ct),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),r(Le,{modelValue:l.value.Panels,"onUpdate:modelValue":m[2]||(m[2]=o=>l.value.Panels=o),"new-item":c,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Oe({_:2},[V(l.value.Panels,(o,p)=>({name:`panel_${p}`,fn:S(()=>[r(De,{class:"px-0 mx-0",fluid:!0},{default:S(()=>[r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(Re,{modelValue:o.Name,"onUpdate:modelValue":T=>o.Name=T,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(W,{cols:"12",sm:"6"},{default:S(()=>[r(ee,{modelValue:o.RequiredFormType,"onUpdate:modelValue":T=>o.RequiredFormType=T,items:Q(je),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),r(Le,{modelValue:o.Items,"onUpdate:modelValue":T=>o.Items=T,"new-item":R(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Oe({_:2},[V(o.Items,(T,G)=>({name:`item_${G}`,fn:S(()=>[r(De,{class:"px-0 mx-0",fluid:!0},{default:S(()=>[r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(Re,{modelValue:T.Label,"onUpdate:modelValue":h=>T.Label=h,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(ee,{modelValue:T.SourceType,"onUpdate:modelValue":h=>T.SourceType=h,label:"Source Type",items:Q(gt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),r(W,{cols:"12",sm:"6"},{default:S(()=>[T.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),k(ee,{key:0,modelValue:T.SectionFieldUUID,"onUpdate:modelValue":h=>T.SectionFieldUUID=h,label:"Form Data",items:i.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:h=>C(T)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):T.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),k(ee,{key:1,modelValue:T.MetaField,"onUpdate:modelValue":h=>T.MetaField=h,label:"Miscellaneous Data",items:Q(Mt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):T.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),k(ee,{key:2,modelValue:T.UserField,"onUpdate:modelValue":h=>T.UserField=h,label:"User Profile Data",items:Q(Lt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),bt={key:0,class:"accommodationList"},Vt=Z({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return[];const d=JSON.parse(e.value),l=e.accommodations.filter(i=>d.includes(i.AccommodationUUID)).sort((i,u)=>{const v=d.findIndex(R=>R===i.AccommodationUUID),c=d.findIndex(R=>R===u.AccommodationUUID);return v>c?1:-1});return ce(l)});return(d,l)=>d.value?(n(),_("ol",bt,[(n(!0),_(f,null,V(L.value,i=>(n(),_("li",{key:i.AccommodationUUID},b(i.Name),1))),128))])):w("",!0)}});const Ft=he(Vt,[["__scopeId","data-v-1ba5f67a"]]),Pt={key:0,class:"addonList"},wt={key:0},$t=Z({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return;const d=JSON.parse(e.value),l=Object.keys(d),i=ce(e.extras);return i.forEach(u=>{u.Options=u.Options.filter(v=>l.includes(v.OptionUUID)?(v.Choices=v.Choices.filter(c=>c.TagUUID===d[v.OptionUUID].choiceId),d[v.OptionUUID].checked):!1)}),i.filter(u=>u.Options.length>0),i});return(d,l)=>d.value?(n(),_("ul",Pt,[(n(!0),_(f,null,V(L.value,i=>(n(),_("li",{key:i.ExtraUUID},[F("strong",null,b(i.Name),1),F("ul",null,[(n(!0),_(f,null,V(i.Options,u=>(n(),_("li",{key:u.OptionUUID},[Y(b(u.Name)+" ",1),u.Choices.length==1?(n(),_("small",wt,"("+b(u.Choices[0].Title)+")",1)):w("",!0)]))),128))])]))),128))])):w("",!0)}});const Yt=he($t,[["__scopeId","data-v-4ed6842b"]]),Bt={key:0},Gt=Z({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return;const d=JSON.parse(e.value);return Object.entries(d).filter(([,l])=>l).map(([l,i])=>e.interests.find(u=>u.InterestUUID===l)).filter(l=>l!==void 0)});return(d,l)=>d.value?(n(),_("ul",Bt,[(n(!0),_(f,null,V(L.value,i=>(n(),_("li",{key:i.InterestUUID},b(i.Name),1))),128))])):w("",!0)}}),Ht=F("br",null,null,-1),qt=F("small",null,"Options:",-1),xt=F("br",null,null,-1),jt=F("small",null,"Addons:",-1),Jt=Z({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return;let d={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{d=JSON.parse(e.value),"ticket"in d&&(d.Ticket=d.ticket),"addonsChecked"in d&&(d.AddonsChecked=d.addonsChecked),"componentsChecked"in d&&(d.ComponentsChecked=d.componentsChecked)}catch{}return d.Ticket.filter(l=>{const i=e.tickets.find(u=>u.TicketUUID===l);return!(!i||i.Type!==ct.TICKET_TYPE_TICKET)}).map(l=>{const i=e.tickets.find(v=>v.TicketUUID===l),u=ce(i);return u.TicketComponents=i.TicketComponents.filter(v=>d.ComponentsChecked.includes(v.TicketUUID)),u.AddonTickets=i.AddonTickets.filter(v=>d.AddonsChecked.includes(v.TicketUUID)),u})});return(d,l)=>d.value?(n(!0),_(f,{key:0},V(L.value,i=>(n(),_("div",{key:i.TicketUUID},[F("strong",null,b(i.Name),1),i.TicketComponents.length>0?(n(),_(f,{key:0},[Ht,qt,Y("  "),(n(!0),_(f,null,V(i.TicketComponents,u=>(n(),_(f,{key:u.TicketUUID},[F("small",null,b(u.Name),1),Y("  ")],64))),128))],64)):w("",!0),i.AddonTickets.length>0?(n(),_(f,{key:1},[xt,jt,Y("  "),(n(!0),_(f,null,V(i.AddonTickets,u=>(n(),_("small",{key:u.TicketUUID},[Y("("),F("em",null,b(u.Name),1),Y(")")]))),128))],64)):w("",!0)]))),128)):w("",!0)}}),Kt={key:0},zt={key:0},Wt=F("strong",null,"Total:",-1),Qt=Z({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:L}){const d=fe(),l=E(),i=E(),u=E(),v=E(),c=E(!1),R=t=>{console.log(t)},C=(t,m,o)=>{i.value=t,d.getRegistrationGroup(o.RegistrationUUID||"").then(p=>{u.value=p,l.value=m,v.value=o,c.value=!0})};return(t,m)=>(n(),_(f,null,[t.header.key=="actions"?(n(),k(pe,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:m[0]||(m[0]=o=>R(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0?(n(),k(Ft,{key:1,value:t.item.raw[t.header.key],accommodations:t.accommodations},null,8,["value","accommodations"])):t.header.type==="EXTRAS"&&t.extras.length>0?(n(),k(Yt,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(n(),k(Gt,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(n(),k(Jt,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(n(!0),_(f,{key:5},V(t.item.raw[t.header.key],o=>(n(),_("ul",{key:o.Heading},[F("li",null,[F("strong",null,b(o.Heading)+":",1),Y(" "+b(Q(Et)(o.Submission.Status))+" ",1),r(pe,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:p=>C(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(n(),k(vt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(n(),_(f,{key:7},[t.item.raw[t.header.key].length===1?(n(),_("em",Kt," Not in a group ")):(n(),_(f,{key:1},[F("ul",null,[(n(!0),_(f,null,V(t.item.raw[t.header.key],o=>(n(),_("li",{key:o.UUID,class:"ml-0"},[Y(b(o.Name)+" ",1),o.IsLeader?(n(),_("strong",zt,"(Leader)")):w("",!0)]))),128))]),Wt,Y(" "+b(t.item.raw[t.header.key].length),1)],64))],64)):(n(),_(f,{key:8},[Y(b(t.item.raw[t.header.key]),1)],64)),c.value&&v.value&&l.value?(n(),k(Rt,{key:9,modelValue:c.value,"onUpdate:modelValue":m[3]||(m[3]=o=>c.value=o),scrollable:!0},{default:S(()=>[r(Ne,{class:"bg-red-darken-4"},{default:S(()=>[r(It,null,{default:S(()=>[r(Tt,{modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=o=>l.value=o),admin:!0,convention:t.convention,data:v.value,editable:!0,"registration-group":u.value,onClose:m[2]||(m[2]=o=>{c.value=!1,L("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):w("",!0)],64))}}),ga=Z({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:L}){var Ue;const d=Ot();L("pageTitle","Registration Manager");const l=He(),i=qe(),u=E(!0);let v=((Ue=l.params.convention)==null?void 0:Ue.toString())||"";const c=E({ID:0,ConventionUUID:oe(),OrganisationID:0,OrganisationUUID:pt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),R=fe(),C=E({ID:0,AdminLayoutUUID:oe(),ConventionID:c.value.ID,ConventionUUID:c.value.ConventionUUID,Name:"Registration Table",Type:be.ADMIN_LAYOUT_TABLE,Panels:[]}),t=E([]),m=E([]),o=E([]),p=E(1),T=E(10),G=E([]),h=E(0),j=E(!1),$=E(""),ie=E([]),se=E([]),ae=E([]),ue=E([]),re=E([]),B=E(0);xe(B,a=>{a===7&&me()});const Te=()=>{t.value=[],m.value=[],o.value=[];try{R.getConventionAdminLayoutByName(c.value.ConventionUUID,"Registration Table").then(a=>{B.value+=1,a?C.value=a:(C.value.ConventionID=c.value.ID,C.value.ConventionUUID=c.value.ConventionUUID)})}catch{C.value.ConventionID=c.value.ID,C.value.ConventionUUID=c.value.ConventionUUID}try{R.getConventionForms(c.value.ConventionUUID).then(a=>{B.value+=1,a&&(t.value=a)})}catch{}try{R.getConventionAccommodation(c.value.ConventionUUID).then(a=>{B.value+=1,a&&(ie.value=a)})}catch{}try{R.getConventionVenues(c.value.ConventionUUID).then(a=>{B.value+=1,a&&(re.value=a)})}catch{}try{R.getConventionExtras(c.value.ConventionUUID).then(a=>{B.value+=1,a&&(se.value=a)})}catch{}try{R.getConventionInterests(c.value.ConventionUUID).then(a=>{B.value+=1,a&&(ae.value=a)})}catch{}try{R.getConventionTickets(c.value.ConventionUUID).then(a=>{B.value+=1,a&&(ue.value=a)})}catch{}},de=({page:a,itemsPerPage:U,sortBy:s})=>{p.value=a,G.value=s;const A=o.value.find(y=>y.uuid==$.value),P=A==null?void 0:A.layout.Items;let g="",le="";if(s&&P&&s.length>=1){const y=P.find(x=>x.LayoutItemUUID==s[0].key);switch(le=s[0].order,y==null?void 0:y.MetaField){case q.META_DATA_SOURCE_SUBMISSION_DATE:g="created";break;case q.META_DATA_SOURCE_SUBMISSION_STATUS:g="submission.status";break}switch(y==null?void 0:y.UserField){case O.USER_DATA_SOURCE_DISPLAY_NAME:g="user.display_name";break;case O.USER_DATA_SOURCE_EMAIL:g="user.email";break;case O.USER_DATA_SOURCE_FIRST_NAME:g="user.firstname";break;case O.USER_DATA_SOURCE_HANDLE:g="user.handle";break;case O.USER_DATA_SOURCE_LAST_NAME:g="user.lastname";break}}try{const y={Direction:le,Limit:U,Offset:(a-1)*U,Order:g};(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_ACCOMMODATION&&(y.Accommodation=!0),(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_BADGE&&(y.Badge=!0),(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_DEALER&&(y.Dealer=!0),(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_REGISTRATION&&(y.Registration=!0),R.searchConventionRegistrations(c.value.ConventionUUID,y).then(x=>{x&&(h.value=x.Total,m.value=x.Registrations,o.value.forEach(ve=>{const Ve=ve.layout;ve.items=m.value.map(M=>{const N={};return ve.headers.forEach(Fe=>{const I=Ve.Items.find(J=>J.LayoutItemUUID===Fe.key);if(I){if(I.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&I.SectionField)M.Submissions.forEach(J=>{const H=J.Data.find(_e=>_e.SectionFieldUUID===I.SectionFieldUUID);if(H){N[I.LayoutItemUUID]=H.Data;return}});else if(I.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&I.UserField)switch(I.UserField){case O.USER_DATA_SOURCE_AVATAR:N[I.LayoutItemUUID]=d.GetProfileImageURL(M.UserUUID);break;case O.USER_DATA_SOURCE_DISPLAY_NAME:N[I.LayoutItemUUID]=M.User.DisplayName;break;case O.USER_DATA_SOURCE_EMAIL:N[I.LayoutItemUUID]=M.User.Additional.Email;break;case O.USER_DATA_SOURCE_HANDLE:N[I.LayoutItemUUID]=M.User.Handle;break;case O.USER_DATA_SOURCE_DATE_OF_BIRTH:N[I.LayoutItemUUID]=M.User.Additional.DOB;break;case O.USER_DATA_SOURCE_FIRST_NAME:N[I.LayoutItemUUID]=M.User.Additional.FirstName;break;case O.USER_DATA_SOURCE_LAST_NAME:N[I.LayoutItemUUID]=M.User.Additional.LastName;break;case O.USER_DATA_SOURCE_TELEGRAM:N[I.LayoutItemUUID]="";break}else if(I.SourceType==="LAYOUT_ITEM_SOURCE_META"&&I.MetaField){const J=[];let H;const _e=M.Submissions.find(D=>{var K;return((K=D.Form)==null?void 0:K.Type)===te.FORM_TYPE_REGISTRATION});switch(I.MetaField){case q.META_DATA_SOURCE_REGISTRATION_GROUP:M.Leader?H=M:H=M.Primary,J.push({Name:H.User.DisplayName,UUID:H.UserUUID,IsLeader:!0,Reference:H.Reference}),J.push(...H.Members.map(D=>({Name:D.User.DisplayName,UUID:D.UserUUID,IsLeader:!1,Reference:D.Reference}))),N[I.LayoutItemUUID]=J;break;case q.META_DATA_SOURCE_REGISTRATION_REFERENCE:N[I.LayoutItemUUID]=M.Reference;break;case q.META_DATA_SOURCE_SUBMISSION_DATE:if(_e){const D=new Date(_e.CreatedAt||"");N[I.LayoutItemUUID]=`${D.getFullYear()}-${D.getMonth().toString().padStart(2,"0")}-${D.getDate().toString().padStart(2,"0")} ${D.getHours().toString().padStart(2,"0")}:${D.getMinutes().toString().padStart(2,"0")}:${D.getSeconds()}`}else{const D=new Date(M.CreatedAt||"");N[I.LayoutItemUUID]=`${D.getFullYear()}-${D.getMonth().toString().padStart(2,"0")}-${D.getDate().toString().padStart(2,"0")} ${D.getHours().toString().padStart(2,"0")}:${D.getMinutes().toString().padStart(2,"0")}:${D.getSeconds()}`}break;case q.META_DATA_SOURCE_SUBMISSION_STATUS:Dt(M.Submissions,t.value),N[I.LayoutItemUUID]=M.Submissions.map(D=>{const K=t.value.find(Pe=>Pe.FormUUID===D.FormUUID);return{Heading:K==null?void 0:K.Heading,Form:K,Submission:D,Registration:M}});break}}}}),N})}),u.value=!1)})}catch{}},me=()=>{C.value.Panels.forEach(a=>{a.Items.forEach(U=>{(U.SectionField==null||U.SectionField.Field==null)&&t.value.find(s=>{s.Sections.find(A=>{if(A.Fields){const P=A.Fields.find(g=>g.SectionFieldUUID===U.SectionFieldUUID);if(P)return U.SectionField=P,!0}})})})}),C.value.Panels.length>0&&(o.value=[],C.value.Panels.forEach(a=>{const U={uuid:oe(),order:a.Order,name:a.Name,headers:[],items:[],layout:a};a.Items.sort((s,A)=>s.Order>A.Order?1:s.Order==A.Order?0:-1),U.headers=a.Items.map(s=>{var A,P;return{key:s.LayoutItemUUID,title:s.Label||((P=(A=s.SectionField)==null?void 0:A.Field)==null?void 0:P.Label)||"",align:s.Align==="end"?"end":"start",sortable:Ee(s),type:Se(s)}}),o.value.push(U)})),($.value==null||$.value=="")&&o.value.length>0&&($.value=o.value[0].uuid)};v?R.getConvention(v).then(a=>{a&&(c.value=a,Te())}).catch(()=>{i.push("/")}):i.push("/");const Se=a=>{var U,s;if(a.SourceType===ne.LAYOUT_ITEM_SOURCE_META)return`${a.SourceType}.${a.MetaField}`;if(a.SourceType===ne.LAYOUT_ITEM_SOURCE_FORM)return(s=(U=a.SectionField)==null?void 0:U.Field)==null?void 0:s.Type;if(a.SourceType===ne.LAYOUT_ITEM_SOURCE_USER)return`${a.SourceType}.${a.UserField}`},Ee=a=>{const U=[q.META_DATA_SOURCE_SUBMISSION_DATE,q.META_DATA_SOURCE_SUBMISSION_STATUS],s=[O.USER_DATA_SOURCE_DISPLAY_NAME,O.USER_DATA_SOURCE_EMAIL,O.USER_DATA_SOURCE_HANDLE,O.USER_DATA_SOURCE_DATE_OF_BIRTH,O.USER_DATA_SOURCE_FIRST_NAME,O.USER_DATA_SOURCE_LAST_NAME];return U.includes(a.MetaField)||s.includes(a.UserField)};return(a,U)=>(n(),k(_t,null,{default:S(()=>[r(ft,{color:"blue-darken-4"},{default:S(()=>[r(rt,{modelValue:$.value,"onUpdate:modelValue":U[0]||(U[0]=s=>$.value=s),"show-arrows":""},{default:S(()=>[(n(!0),_(f,null,V(o.value,s=>(n(),k(dt,{key:s.uuid,value:s.uuid},{default:S(()=>[Y(b(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(yt),r(pe,{icon:"mdi:mdi-cog-outline",onClick:U[1]||(U[1]=s=>j.value=!0)})]),_:1}),r(Ut,{modelValue:$.value,"onUpdate:modelValue":U[4]||(U[4]=s=>$.value=s)},{default:S(()=>[(n(!0),_(f,null,V(o.value,s=>(n(),k(mt,{key:s.uuid,value:s.uuid},{default:S(()=>[s.uuid===$.value?(n(),k(Ne,{key:0,class:"pa-2"},{default:S(()=>[r(Q(ht),{"items-per-page":T.value,"onUpdate:itemsPerPage":U[3]||(U[3]=A=>T.value=A),headers:s.headers,"items-length":h.value,items:s.items,"item-value":"LayoutItemUUID",loading:u.value,"onUpdate:options":de},Oe({_:2},[V(s.headers,A=>({name:`item.${A.key}`,fn:S(({item:P})=>[r(Qt,{header:A,item:P,accommodations:ie.value,convention:c.value,extras:se.value,interests:ae.value,tickets:ue.value,venues:re.value,onReload:U[2]||(U[2]=g=>de({page:p.value,itemsPerPage:T.value,sortBy:G.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):w("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),j.value?(n(),k(Nt,{key:0,title:"Edit Layout",modelValue:j.value,"onUpdate:modelValue":U[5]||(U[5]=s=>j.value=s),layout:C.value,onSave:U[6]||(U[6]=s=>{j.value=!1,me()})},null,8,["modelValue","layout"])):w("",!0)]),_:1}))}});export{ga as default};
