var ct=Object.defineProperty;var mt=(e,l,t)=>l in e?ct(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t;var Z=(e,l,t)=>(mt(e,typeof l!="symbol"?l+"":l,t),t);import{i as B,M as x,N as j,r as S,k as ee,w as ne,c as K,n,q as D,v as o,y,D as w,F as h,x as I,B as T,Q as H,f as s,C as U,A as V,P as te,G as vt,H as ft,_ as ke,ai as At,a2 as Te,O as Me,aj as Tt,X as ye,o as Et,b as _t,ak as Ut,al as gt,am as xe,z as St,a8 as Ct,a5 as Dt,E as yt,an as Ye,ao as It,T as pt}from"./index-7PbpbQ3m.js";import{u as Ve}from"./VCheckboxBtn-PVZYqgwb.js";import{_ as Ee}from"./ModelDialog.vue_vue_type_script_setup_true_lang-0ftZYMUn.js";import{h as ie,b as Ie,a as Rt,c as Nt,d as Ke,P as je,u as ht}from"./useDisplayTransactions-c68F1U6I.js";import{a as se,V as ue}from"./VContainer-pCmVzKO1.js";import{V as Y,a as P}from"./VRow-yLBDaYw_.js";import{V as fe,a as Ae,c as he,d as Ot}from"./VList-JK5i0HQo.js";import{V as Ue}from"./VSelect-47zr9-87.js";import{G as Se}from"./userData-rTJ9Farn.js";import{C as pe}from"./canEditRegistrations-A1ez9bSf.js";import{V as F,a as tt}from"./VBtn-MMZykxrf.js";import{T as kt,V as at}from"./VAutocomplete-vJhkE555.js";import{a as Le,V as _e}from"./scopeId-r6hC0VnJ.js";import{b as Mt,_ as Je,V as nt}from"./SaveButton.vue_vue_type_script_setup_true_lang-g3iElhOr.js";import{G as Vt}from"./group-7fhbY6WJ.js";import{C as Lt}from"./canDo-yWCfI_4r.js";import{V as be,a as Re,c as we,d as ot,e as Pe}from"./VCard-ZMVnp_P6.js";import{V as lt}from"./VAvatar-cu_UxOAm.js";import{V as re}from"./VTextField-as5AwlW2.js";import{F as Ce}from"./form-0fJbSFPv.js";import{b as bt,c as wt,S as Pt}from"./submission-40fey8Hx.js";import{v as ge}from"./v4-yQnnJER4.js";import{b as Fe,c as $e,d as Be,a as Ge,V as He,_ as Ft}from"./VDataTable-6QTdd0C0.js";import{_ as $t}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-LkFm6NNh.js";import{a as Bt,V as Gt}from"./VToolbar-HyaKoIqD.js";import{V as Ht}from"./VDivider-dEOj_3dR.js";import{V as it}from"./VTextarea-EIKjM_p2.js";import{V as qe}from"./VDialog-xl12zWUd.js";import{V as xt,a as Oe}from"./VChip-J2hKMH5V.js";import{V as Yt}from"./VForm-oH0ItCCH.js";import{u as Kt}from"./nil-rxyd0N8M.js";import{b as jt,V as Jt}from"./VNavigationDrawer-kowlcw2Z.js";var qt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(qt||{});const po=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var De=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(De||{});const Ro=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var J=(e=>(e.META_DATA_SOURCE_NULL="",e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_ADMIN_FORM="META_DATA_SOURCE_ADMIN_FORM",e.META_DATA_SOURCE_BADGE_DISPLAY="META_DATA_SOURCE_BADGE_DISPLAY",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_CHECKIN_CONTROL="META_DATA_SOURCE_CHECKIN_CONTROL",e.META_DATA_SOURCE_CHECKIN_STATUS="META_DATA_SOURCE_CHECKIN_STATUS",e.META_DATA_SOURCE_DATA_LAYOUT="META_DATA_SOURCE_DATA_LAYOUT",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_EMAILS="META_DATA_SOURCE_EMAILS",e.META_DATA_SOURCE_NOTES="META_DATA_SOURCE_NOTES",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_PAYMENTS="META_DATA_SOURCE_PAYMENTS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_REGISTRATION_TOOLS_DROP="META_DATA_SOURCE_REGISTRATION_TOOLS_DROP",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e.META_DATA_SOURCE_TAGS="META_DATA_SOURCE_TAGS",e))(J||{});const No=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Actions Dropdown",value:"META_DATA_SOURCE_REGISTRATION_TOOLS_DROP"},{title:"Badge Display",value:"META_DATA_SOURCE_BADGE_DISPLAY"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Check In Control",value:"META_DATA_SOURCE_CHECKIN_CONTROL"},{title:"Check In Status",value:"META_DATA_SOURCE_CHECKIN_STATUS"},{title:"Data Display",value:"META_DATA_SOURCE_DATA_LAYOUT"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Emails",value:"META_DATA_SOURCE_EMAILS"},{title:"Notes",value:"META_DATA_SOURCE_NOTES"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Payments",value:"META_DATA_SOURCE_PAYMENTS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"},{title:"Tags",value:"META_DATA_SOURCE_TAGS"}];var oe=(e=>(e.PANEL_STYLE_FLEX="PANEL_STYLE_FLEX",e.PANEL_STYLE_NAV_BOTTOM="PANEL_STYLE_NAV_BOTTOM",e.PANEL_STYLE_NAV_LEFT="PANEL_STYLE_NAV_LEFT",e.PANEL_STYLE_NAV_RIGHT="PANEL_STYLE_NAV_RIGHT",e.PANEL_STYLE_NAV_TOP="PANEL_STYLE_NAV_TOP",e))(oe||{});const ho=[{title:"Body Flexible",value:"PANEL_STYLE_FLEX"},{title:"Fixed Bottom",value:"PANEL_STYLE_NAV_BOTTOM"},{title:"Fixed Left",value:"PANEL_STYLE_NAV_LEFT"},{title:"Fixed Right",value:"PANEL_STYLE_NAV_RIGHT"},{title:"Fixed Top",value:"PANEL_STYLE_NAV_TOP"}];var ve=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_CONTACTS="USER_DATA_SOURCE_CONTACTS",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(ve||{});const Oo=[{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"Contact Details",value:"USER_DATA_SOURCE_CONTACTS"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}];var Q=(e=>(e.CHECK_IN_STATUS_PENDING="CHECK_IN_STATUS_PENDING",e.CHECK_IN_STATUS_COMPLETED="CHECK_IN_STATUS_COMPLETED",e.CHECK_IN_STATUS_REJECTED="CHECK_IN_STATUS_REJECTED",e.CHECK_IN_STATUS_REVOKED="CHECK_IN_STATUS_REVOKED",e))(Q||{});const zt=[{title:"Pending",value:"CHECK_IN_STATUS_PENDING"},{title:"Completed",value:"CHECK_IN_STATUS_COMPLETED"},{title:"Rejected",value:"CHECK_IN_STATUS_REJECTED"},{title:"Revoked",value:"CHECK_IN_STATUS_REVOKED"}],ce=e=>{var l;return((l=zt.find(t=>t.value===e))==null?void 0:l.title)||""},Qt=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},Xt=w("br",null,null,-1),Wt=w("h3",null,"Assigned Accommodation",-1),Zt=w("br",null,null,-1),ea=w("br",null,null,-1),ta=w("h3",null,"Accommodation Preferences",-1),aa=w("h3",null,"Selected Tickets",-1),na=w("br",null,null,-1),oa=B({__name:"EditAccommodationAssignmentDialog",props:x({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["update:field"],["update:modelValue"]),setup(e,{emit:l}){const t=e,{convention:a,registration:r,title:m=""}=t,E=l,i=te(),u=j(e,"modelValue"),c=S({capacity:{max:b=>{var p;const M=L.value.find($=>$.room.RoomUUID===b);return!M||M.room.MaximumCapacity===0?!0:(((p=d.value)==null?void 0:p.Members.length)||0)<=M.room.MaximumCapacity||"Too many people in the group for this room"},min:b=>{var p;const M=L.value.find($=>$.room.RoomUUID===b);return!M||M.room.MinimumCapacity===0?!0:(((p=d.value)==null?void 0:p.Members.length)||0)>=M.room.MinimumCapacity||"Not enough people in the group for this room"}}}),A=S([]),f=Ve(t,E,void 0,void 0,"field"),v=S(ee(f.value));ne(f,()=>{v.value=ee(f.value)});const d=S(),_=S(""),R=S(""),k=S([]),O=S({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),g=async()=>{var p;const b=await i.getConventionAvailableAccommodation(a.ConventionUUID);b&&(A.value=b);const M=await i.getRegistrationGroup(r.RegistrationUUID||"");M&&(d.value=M);const N=await i.getConventionTickets(a.ConventionUUID);N&&(k.value=N);try{O.value=JSON.parse(((p=d.value)==null?void 0:p.TicketData)||"")}catch{}};ne(_,()=>{R.value=L.value.length>0?L.value[0].value:""});const C=K(()=>{const b=q.value;return A.value.map(M=>{let N;return b.forEach(p=>{M.Costs.forEach($=>{$.DateStart===(p==null?void 0:p.DateStart)&&$.DateEnd===p.DateEnd&&(N===void 0||N>$.Availability)&&(N=$.Availability)})}),{label:`${M.Name}`,title:`${M.Name} (${N} Available)`,value:M.AccommodationUUID}})}),L=K(()=>{const b=q.value,M=A.value.find(N=>N.AccommodationUUID===_.value);return(M==null?void 0:M.Pool.map(N=>{var $,X;let p;return b.forEach(ae=>{N.Costs.forEach(de=>{de.DateStart===(ae==null?void 0:ae.DateStart)&&de.DateEnd===ae.DateEnd&&(p===void 0||p>de.Availability)&&(p=de.Availability)})}),{label:`${($=N.Venue)==null?void 0:$.Name} - ${N.Name}`,title:`${(X=N.Venue)==null?void 0:X.Name} - ${N.Name} (${p} Available)`,value:N.RoomUUID,room:N}}))||[]}),q=K(()=>[...O.value.Ticket,...O.value.AddonsChecked,...O.value.ComponentsChecked].map(b=>k.value.find(M=>M.TicketUUID===b)).filter(b=>b!==void 0&&b.RequiresAccommodation)),G=b=>{var M;i.assignAccommodation(((M=d.value)==null?void 0:M.Registration.RegistrationUUID)||"",_.value,R.value,!1).then(N=>{N?(g(),b&&b("Room Assigned")):b&&b("Room not assigned")}).catch(()=>{b&&b("Room not assigned")})},W=b=>{var M,N;(M=d.value)!=null&&M.Registration.AllocationUUID?i.deleteAllocation(((N=d.value)==null?void 0:N.Registration.AllocationUUID)||"").then(p=>{p?(g(),b&&b("Allocation Deleted")):b&&b("Allocation not deleted")}).catch(()=>{b&&b("Allocation not deleted")}):b&&b("Nothing to Delete")},z=b=>{var N,p;const M=(N=A.value.find($=>$.AccommodationUUID===b.AccommodationUUID))==null?void 0:N.Pool;if(M){const $=M.find(X=>X.RoomUUID===b.RoomUUID);if($)return`${(p=$.Venue)==null?void 0:p.Name} - ${$.Name}`}return""};return g(),(b,M)=>{var N;return n(),D(Ee,{modelValue:u.value,"onUpdate:modelValue":M[2]||(M[2]=p=>u.value=p),title:U(m),color:"primary","show-close-action":!0,"show-delete-action":!!((N=d.value)!=null&&N.Registration.Allocation),"show-save-action":!!R.value,"save-button-label":"Assign Room",onDelete:W,onSave:G,fullscreen:!0,persistent:!0},{default:o(()=>[s(se,{class:"pa-0",fluid:!0},{default:o(()=>[s(Y,null,{default:o(()=>{var p;return[s(P,{cols:"12",md:"6"},{default:o(()=>{var $,X;return[w("h3",null,"Group Members ("+y(($=d.value)==null?void 0:$.Members.length)+")",1),(n(!0),T(h,null,H((X=d.value)==null?void 0:X.Members,ae=>(n(),T(h,{key:ae.UUID},[I(" #"+y(ae.Reference)+" "+y(ae.Name),1),Xt],64))),128))]}),_:1}),(p=d.value)!=null&&p.Registration.Allocation?(n(),D(P,{key:0,cols:"12",md:"6"},{default:o(()=>[Wt,s(fe,null,{default:o(()=>{var $;return[(n(!0),T(h,null,H(($=d.value)==null?void 0:$.Registration.Allocation.Periods,X=>(n(),D(Ae,{key:X.AllocationPeriodUUID},{default:o(()=>{var ae;return[I(y((ae=A.value.find(de=>de.AccommodationUUID===X.AccommodationUUID))==null?void 0:ae.Name)+" ",1),Zt,I(" "+y(z(X))+" ",1),ea,w("small",null,"("+y(U(ie)(X.DateStart))+" - "+y(U(ie)(X.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):V("",!0)]}),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12",md:"6"},{default:o(()=>[b.selectedAccommodation.length?(n(),T(h,{key:0},[ta,s(fe,null,{default:o(()=>[(n(!0),T(h,null,H(b.selectedAccommodation,(p,$)=>(n(),D(Ae,{key:p.AccommodationUUID},{default:o(()=>[I(y($+1)+". "+y(p.Name),1)]),_:2},1024))),128))]),_:1})],64)):V("",!0)]),_:1}),s(P,{cosl:"12",md:"6"},{default:o(()=>[aa,s(fe,null,{default:o(()=>[(n(!0),T(h,null,H(q.value,p=>(n(),D(Ae,{key:p==null?void 0:p.TicketUUID},{default:o(()=>[I(y(p.Name)+" ",1),na,w("small",null,"("+y(U(ie)(p.DateStart))+" - "+y(U(ie)(p.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12",md:"6"},{default:o(()=>[s(Ue,{modelValue:_.value,"onUpdate:modelValue":M[0]||(M[0]=p=>_.value=p),items:C.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),s(P,{cols:"12",md:"6"},{default:o(()=>[s(Ue,{modelValue:R.value,"onUpdate:modelValue":M[1]||(M[1]=p=>R.value=p),items:L.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[c.value.capacity.min,c.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),la=e=>(vt("data-v-33548a38"),e=e(),ft(),e),ia={key:0,class:"accommodationList"},sa={key:0,class:"text-orange-darken-2"},ra={key:1,class:"accommodationList"},ua=la(()=>w("br",null,null,-1)),da=B({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const l=Se(),t=pe(l,e.convention),a=S(!1),r=K(()=>e.registration.Allocation.Periods.map(i=>{var u;return{DateStart:i.DateStart,DateEnd:i.DateEnd,Accommodation:i.Accommodation||((u=e.accommodations)==null?void 0:u.find(c=>c.AccommodationUUID==i.AccommodationUUID))}}).sort((i,u)=>i.DateStart>u.DateStart?1:i.DateStart==u.DateStart?0:-1));e.registration&&e.registration.Allocation&&e.registration.Allocation.Periods&&e.registration.Allocation.Periods.forEach(i=>{var c;if(i.Accommodation)return;const u=(c=e.accommodations)==null?void 0:c.find(A=>A.AccommodationUUID==i.AccommodationUUID);u&&(i.Accommodation=u)});const m=K(()=>{if(!e.value)return[];const i=JSON.parse(e.value),u=e.accommodations.filter(c=>i.includes(c.AccommodationUUID)).sort((c,A)=>{const f=i.findIndex(d=>d===c.AccommodationUUID),v=i.findIndex(d=>d===A.AccommodationUUID);return f>v?1:-1});return ee(u)}),E=K(()=>{let i;const u=e.forms.find(c=>!!c.Sections.find(A=>{var f;return A.Fields?!!((f=A.Fields)!=null&&f.find(v=>{var d;return((d=v.Field)==null?void 0:d.Type)==="TICKET"?(i=v,!0):!1})):!1}));return i?!!e.registration.Submissions.find(c=>{if(c.FormUUID==(u==null?void 0:u.FormUUID))return!!c.Data.find(A=>{if(A.SectionFieldUUID==(i==null?void 0:i.SectionFieldUUID)){const f=JSON.parse(A.Data);return e.tickets.filter(v=>v.RequiresAccommodation).find(v=>f.Ticket.includes(v.TicketUUID)||f.AddonsChecked.includes(v.TicketUUID)||f.ComponentsChecked.includes(v.TicketUUID))}})}):!1});return(i,u)=>E.value?(n(),T(h,{key:0},[i.value?(n(),T("ol",ia,[(n(!0),T(h,null,H(m.value,c=>(n(),T("li",{key:c.AccommodationUUID},[i.registration&&i.registration.Allocation&&i.registration.Allocation.Periods.find(A=>A.AccommodationUUID===c.AccommodationUUID)?(n(),T("strong",sa,y(c.Name),1)):(n(),T(h,{key:1},[I(y(c.Name),1)],64))]))),128))])):(n(),T("ul",ra,[(n(!0),T(h,null,H(r.value,c=>{var A;return n(),T("li",{key:c.DateStart},[I(y((A=c.Accommodation)==null?void 0:A.Name)+" ("+y(U(ie)(c.DateStart))+" - "+y(U(ie)(c.DateEnd))+")",1),ua])}),128))])),U(t)?(n(),D(F,{key:2,onClick:u[0]||(u[0]=c=>a.value=!0),variant:"flat",color:"success"},{default:o(()=>[I("Assign Accommodation")]),_:1})):V("",!0),i.convention&&a.value?(n(),D(oa,{key:3,modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=c=>a.value=c),title:"Accommodation Allocation",convention:i.convention,registration:i.registration,tickets:i.tickets,"selected-accommodation":m.value},null,8,["modelValue","convention","registration","tickets","selected-accommodation"])):V("",!0)],64)):V("",!0)}}),ca=ke(da,[["__scopeId","data-v-33548a38"]]),ma={key:0,class:"addonList"},va={key:0},fa={key:0},Aa=B({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const l=K(()=>{if(!e.value)return;const t=JSON.parse(e.value),a=Object.keys(t),r=ee(e.extras);return r.forEach(m=>{m.Options=m.Options.filter(E=>a.includes(E.OptionUUID)?(E.Choices=E.Choices.filter(i=>i.TagUUID===t[E.OptionUUID].choiceId),t[E.OptionUUID].checked):!1)}),r.filter(m=>m.Options.length>0),r});return(t,a)=>t.value?(n(),T("ul",ma,[(n(!0),T(h,null,H(l.value,r=>(n(),T(h,{key:r.ExtraUUID},[r.Options.length?(n(),T("li",va,[w("strong",null,y(r.Name),1),w("ul",null,[(n(!0),T(h,null,H(r.Options,m=>(n(),T("li",{key:m.OptionUUID},[I(y(m.Name)+" ",1),m.Choices.length==1?(n(),T("small",fa,"("+y(m.Choices[0].Title)+")",1)):V("",!0)]))),128))])])):V("",!0)],64))),128))])):V("",!0)}}),Ta=ke(Aa,[["__scopeId","data-v-55786e01"]]),Ea={key:0},_a=B({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const l=K(()=>{if(!e.value)return;const t=JSON.parse(e.value);return Object.entries(t).filter(([,a])=>a).map(([a,r])=>e.interests.find(m=>m.InterestUUID===a)).filter(a=>a!==void 0)});return(t,a)=>t.value?(n(),T("ul",Ea,[(n(!0),T(h,null,H(l.value,r=>(n(),T("li",{key:r.InterestUUID},y(r.Name),1))),128))])):V("",!0)}}),Ua=w("br",null,null,-1),ga=w("small",null,"Options:",-1),Sa=w("br",null,null,-1),Ca=w("small",null,"Addons:",-1),Da=B({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const l=K(()=>{if(!e.value)return;let t={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{t=JSON.parse(e.value),"ticket"in t&&(t.Ticket=t.ticket),"addonsChecked"in t&&(t.AddonsChecked=t.addonsChecked),"componentsChecked"in t&&(t.ComponentsChecked=t.componentsChecked)}catch{}return t.Ticket.filter(a=>{const r=e.tickets.find(m=>m.TicketUUID===a);return!(!r||r.Type!==kt.TICKET_TYPE_TICKET)}).map(a=>{const r=e.tickets.find(E=>E.TicketUUID===a),m=ee(r);return m.TicketComponents=r.TicketComponents.filter(E=>t.ComponentsChecked.includes(E.TicketUUID)),m.AddonTickets=r.AddonTickets.filter(E=>t.AddonsChecked.includes(E.TicketUUID)),m})});return(t,a)=>t.value?(n(!0),T(h,{key:0},H(l.value,r=>(n(),T("div",{key:r.TicketUUID},[w("strong",null,y(r.Name),1),r.TicketComponents.length>0?(n(),T(h,{key:0},[Ua,ga,I("  "),(n(!0),T(h,null,H(r.TicketComponents,m=>(n(),T(h,{key:m.TicketUUID},[w("small",null,y(m.Name),1),I("  ")],64))),128))],64)):V("",!0),r.AddonTickets.length>0?(n(),T(h,{key:1},[Sa,Ca,I("  "),(n(!0),T(h,null,H(r.AddonTickets,m=>(n(),T("small",{key:m.TicketUUID},[I("("),w("em",null,y(m.Name),1),I(")")]))),128))],64)):V("",!0)]))),128)):V("",!0)}}),st=B({__name:"DataPanelAccommodation",props:x({accommodations:{},convention:{},data:{},forms:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){return j(e,"modelValue"),(l,t)=>(n(),T("div",null,[s(ca,{value:l.data,accommodations:l.accommodations,convention:l.convention,forms:l.forms,registration:l.registration,tickets:l.tickets,venues:l.venues},null,8,["value","accommodations","convention","forms","registration","tickets","venues"])]))}}),ya={key:0,class:"text-red-darken-4 font-weight-bold"},Ia={key:1,class:"text-orange-darken-2 font-weight-bold"},pa=B({__name:"DataPanelAge",props:x({data:{},forms:{},registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=j(e,"modelValue"),t=new Date,a=t.getFullYear(),r=(t.getMonth()+1).toLocaleString("en-US",{minimumIntegerDigits:2}),m=t.getDate().toLocaleString("en-US",{minimumIntegerDigits:2}),E=S(!1),i=S(`${a}-${r}-${m}`),u=S(18);e.forms.find(v=>v.Sections.find(d=>d.Fields?d.Fields.find(_=>{var R;return _.SectionFieldUUID===l.value.SectionFieldUUID?(l.value.SectionField=_,(R=_.Field)==null||R.Values.forEach(k=>{switch(k.Title){case"UNDER_AGE_APPLY_TAG":k.Value.length>0&&(E.value=!0);break;case"BEFORE_DATE":i.value=k.Value;break;case"MIN_AGE":u.value=parseInt(k.Value);break}}),!0):!1}):!1));const c=v=>({registration:A(v,e.registration.CreatedAt||"",u.value),convention:A(v,i.value,u.value)}),A=(v,d,_)=>{if(v>=d)return!1;const R=f(v),O=f(d).getTime()-R.getTime(),g=1e3*60*60*24*365.25;return O/g>=_},f=v=>{const[d,_,R]=v.split("-");return new Date(parseInt(d),parseInt(_)-1,parseInt(R))};return(v,d)=>(n(),T("div",null,[w("p",null,[I(y(U(ie)(v.data,{withDay:!1,withYear:!0}))+" ",1),E.value&&c(v.data).convention&&c(v.data).registration?(n(),D(ue,{key:0,icon:"mdi:mdi-check",color:"success"})):E.value&&!c(v.data).convention?(n(),D(ue,{key:1,icon:"mdi:mdi-alert",color:"error"})):E.value&&c(v.data).convention&&!c(v.data).registration?(n(),D(ue,{key:2,icon:"mdi:mdi-alert",color:"warning"})):V("",!0)]),E.value?(n(),T(h,{key:0},[c(v.data).convention?c(v.data).registration?V("",!0):(n(),T("p",Ia," Attendee was under "+y(u.value)+" at time of registration ",1)):(n(),T("p",ya," Attendee is under "+y(u.value),1))],64)):V("",!0)]))}}),rt=(e,l)=>e===void 0?!1:Lt(e,Vt.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).CheckIn,Ra={key:0,class:"font-weight-bold pt-2"},ut=B({__name:"Badges",props:{cardClass:{default:""},convention:{},hideDownload:{type:Boolean,default:!1},hideNfc:{type:Boolean,default:!1},registration:{},showTitle:{type:Boolean,default:!0}},setup(e){const l=te(),t=Le(),a=S([]);let r;const m=At();m&&"$NDEFReader"in m.appContext.config.globalProperties&&(r=m.appContext.config.globalProperties.$NDEFReader);const E=S(!!r),i=S(e.registration.BadgeSerialNumber),u=S(""),c=S(!1),A=S(2),f=Se();let v=!1,d=!1;e.convention&&(v=rt(f,e.convention),d=pe(f,e.convention)),ne(()=>e.registration,()=>{O()});const _=g=>{var L;const C=document.createElement("a");C.download=`${((L=e.convention)==null?void 0:L.Name)||""} Badge Image - ${e.registration.Reference} - ${e.registration.User.DisplayName}.jpg`,C.href=g,document.body.appendChild(C),C.click(),document.body.removeChild(C)},R=async g=>t.GetConBadgeImageURL(e.registration.RegistrationUUID,g),k=()=>{if(E.value)try{const g=new r;g.addEventListener("readingerror",()=>{u.value="Error Reading Card",c.value=!0}),g.addEventListener("reading",C=>{if(C.serialNumber){const L=C.serialNumber;u.value="Obtained Card Details",c.value=!0,i.value=L,l.setBadgeSerial(e.registration.RegistrationUUID,i.value).then(q=>{q?(u.value="Badge Serial Saved",c.value=!0):(u.value="Failed to Save Badge Serial",c.value=!0)})}else u.value="Serial Number not Found",c.value=!0}),g.scan&&g.scan()}catch{}},O=()=>{l.getConBadgeList(e.registration.RegistrationUUID).then(g=>{g&&(a.value=[],g.forEach(C=>{R(C).then(L=>{a.value.push({template:C,url:L})})}))}).catch(()=>{})};return O(),(g,C)=>(n(!0),T(h,null,H(a.value,L=>(n(),D(Pe,{key:L.template,class:Te(g.cardClass)},{default:o(()=>[s(be,null,{default:o(()=>[g.showTitle?(n(),D(Re,{key:0,class:"text-center"},{default:o(()=>[I(" Badges (#"+y(g.registration.Reference)+" "+y(g.registration.User.DisplayName)+") ",1)]),_:1})):V("",!0)]),_:1}),s(we,{class:"text-center"},{default:o(()=>[s(lt,{class:"d-block ma-auto",src:L.url,height:"280",width:"280"},null,8,["src"]),i.value?(n(),T("p",Ra,y(i.value),1)):V("",!0)]),_:2},1024),!g.hideDownload||!g.hideNfc?(n(),D(ot,{key:0,class:"justify-center"},{default:o(()=>[!g.hideNfc&&E.value&&(U(d)||U(v))?(n(),D(F,{key:0,"prepend-icon":"mdi:mdi-nfc",color:"warning",variant:"flat",onClick:k},{default:o(()=>[I("Link Card")]),_:1})):V("",!0),g.hideDownload?V("",!0):(n(),D(F,{key:1,color:"primary","prepend-icon":"mdi:mdi-download",variant:"flat",onClick:q=>_(L.url)},{default:o(()=>[I("Download")]),_:2},1032,["onClick"]))]),_:2},1024)):V("",!0),s(Mt,{modelValue:c.value,"onUpdate:modelValue":C[0]||(C[0]=q=>c.value=q),message:u.value,timeout:A.value*1e3},null,8,["modelValue","message","timeout"])]),_:2},1032,["class"]))),128))}}),Na=B({__name:"DataPanelText",props:x({convention:{},data:{},forms:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const l=j(e,"modelValue"),t=j(e,"registration"),a=S(e.data),r=K(()=>u.value?"":a.value!==e.data?"mdi:mdi-content-save":""),m=Se(),E=te(),i=S(pe(m,e.convention)),u=S(!1),c=()=>{u.value=!0,E.directEditFieldData(t.value.RegistrationUUID,l.value.LayoutItemUUID,a.value).then(A=>{A&&t.value.Submissions.find(f=>!!f.Data.find(v=>{if(v.SectionFieldUUID===l.value.SectionFieldUUID)return v.Data=A,!0})),u.value=!1}).catch(()=>{})};return(A,f)=>l.value.Meta&&l.value.Meta.DirectEdit&&(i.value||l.value.Meta.DirectEditPermission==="View")?(n(),D(re,{key:0,modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=v=>a.value=v),"append-inner-icon":r.value,"onClick:appendInner":c},Me({_:2},[u.value?{name:"append-inner",fn:o(()=>[s(tt,{color:"primary",indeterminate:"",size:30})]),key:"0"}:void 0]),1032,["modelValue","append-inner-icon"])):(n(),T(h,{key:1},[I(y(A.data),1)],64))}}),ha={key:4},Oa={key:8},ka=B({__name:"FormDataItem",props:x({accommodations:{},convention:{},extras:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const l=j(e,"modelValue"),t=j(e,"registration"),a=K(()=>{var f,v,d,_;const c=l.value,A=()=>{var R;for(let k=0;k<e.forms.length;k+=1)for(let O=0;O<e.forms[k].Sections.length;O+=1)if(e.forms[k].Sections[O].Fields){const g=(R=e.forms[k].Sections[O].Fields)==null?void 0:R.find(C=>C.SectionFieldUUID===c.SectionFieldUUID);if(g)return g}};return((v=(f=c.SectionField)==null?void 0:f.Field)==null?void 0:v.Type)||((_=(d=A())==null?void 0:d.Field)==null?void 0:_.Type)}),r=K(()=>{for(let c=0;c<t.value.Submissions.length;c+=1){const f=t.value.Submissions[c].Data.find(v=>v.SectionFieldUUID===l.value.SectionFieldUUID);if(f)return f.Data}return""}),m=te(),E=Le(),i=S(""),u=S("");if(a.value==="BADGE_IMAGE")try{const c=JSON.parse(r.value||"{}");c.fileUUID&&(u.value=E.GetBadgeImageURL(c.fileUUID)),t.value&&m.getConBadgeDisplayName(t.value.RegistrationUUID).then(A=>{A&&(i.value=A)}).catch(()=>{})}catch{}return(c,A)=>a.value==="ACCOMMODATION"?(n(),D(st,{key:0,convention:c.convention,tickets:c.tickets,accommodations:c.accommodations,venues:c.venues,registration:t.value,forms:c.forms,modelValue:l.value,"onUpdate:modelValue":A[0]||(A[0]=f=>l.value=f),data:r.value},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue","data"])):a.value==="EXTRAS"?(n(),D(Ta,{key:1,value:r.value,extras:c.extras},null,8,["value","extras"])):a.value==="TICKET"?(n(),D(Da,{key:2,value:r.value,tickets:c.tickets},null,8,["value","tickets"])):a.value==="INTERESTS"?(n(),D(_a,{key:3,value:r.value,interests:c.interests},null,8,["value","interests"])):a.value==="CHECKBOX"?(n(),T("div",ha,[r.value?(n(),D(ue,{key:0,icon:"mdi:mdi-check",color:"success"})):(n(),D(ue,{key:1,icon:"mdi:mdi-close",color:"error"}))])):a.value==="AGE"?(n(),D(pa,{key:5,data:r.value,forms:c.forms,registration:t.value,modelValue:l.value,"onUpdate:modelValue":A[1]||(A[1]=f=>l.value=f)},null,8,["data","forms","registration","modelValue"])):a.value==="BADGE_IMAGE"?(n(),D(ut,{key:6,convention:c.convention,registration:t.value,"show-title":!1,"card-class":c.itemClass},null,8,["convention","registration","card-class"])):a.value==="TEXT"?(n(),D(Na,{key:7,convention:c.convention,data:r.value,forms:c.forms,modelValue:l.value,"onUpdate:modelValue":A[2]||(A[2]=f=>l.value=f),registration:t.value,"onUpdate:registration":A[3]||(A[3]=f=>t.value=f)},null,8,["convention","data","forms","modelValue","registration"])):(n(),T("div",Oa,y(r.value),1))}}),Ma={key:0},Va={key:0},La=w("strong",null,"Total:",-1),ba=B({__name:"DataPanelRegistrationGroup",props:{registration:{}},setup(e){const l=K(()=>{const t=[];let a;return e.registration.Leader?a=e.registration:a=e.registration.Primary,t.push({Name:a.User.DisplayName,UUID:a.UserUUID,UserUUID:a.User.UserUUID,IsLeader:!0,Reference:a.Reference,Paid:a.Paid,Total:a.Total}),t.push(...a.Members.map(r=>({Name:r.User.DisplayName,UUID:r.UserUUID,UserUUID:r.User.UserUUID,IsLeader:!1,Reference:r.Reference,Paid:r.Paid,Total:r.Total}))),t});return(t,a)=>t.registration.Members.length===0&&!t.registration.Primary?(n(),T("em",Ma," Not in a group ")):(n(),T(h,{key:1},[w("ul",null,[(n(!0),T(h,null,H(l.value,r=>(n(),T("li",{key:r.UUID,class:"ml-0"},[I(" #"+y(r.Reference)+" : "+y(r.Name)+" ",1),r.IsLeader?(n(),T("strong",Va,"(Leader)")):V("",!0)]))),128))]),La,I(" "+y(l.value.length),1)],64))}}),wa=B({__name:"DataPanelSubmissionDate",props:{registration:{}},setup(e){const l=K(()=>{const t=e.registration.Submissions.find(a=>{var r;return((r=a.Form)==null?void 0:r.Type)===Ce.FORM_TYPE_REGISTRATION});return t?t.CreatedAt||"":e.registration.CreatedAt||""});return(t,a)=>(n(),T("div",null,y(U(ie)(l.value,{withDay:!1,withYear:!0})),1))}}),Pa={class:"text-grey-lighten-1"},Fa=B({__name:"DataPanelSubmissionStatus",props:{convention:{},forms:{},registration:{}},emits:["showForm"],setup(e,{emit:l}){const t=l,a=Se(),r=pe(a,e.convention),m=K(()=>e.registration.Submissions.map(u=>{const c=e.forms.find(A=>A.FormUUID===u.FormUUID);if(c)return{Heading:c.Heading,Form:c,Submission:u,Registration:e.registration}}).filter(u=>!!u)),E=(u,c,A)=>{t("showForm",u,c,A)},i=u=>({ID:0,SubmissionUUID:ge(),FormID:u.ID,FormUUID:u.FormUUID,Form:u,UserID:e.registration.UserID,UserUUID:e.registration.UserUUID,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Registration:e.registration,Data:[],Status:Pt.SUBMISSION_STATUS_NULL});return(u,c)=>(n(),T(h,null,[w("ul",null,[(n(!0),T(h,null,H(u.forms.filter(A=>A.Type===U(Ce).FORM_TYPE_ADMIN&&m.value.findIndex(f=>f.Form.ID===A.ID)<0),A=>(n(),T("li",{key:A.Heading},[w("strong",Pa,y(A.Heading),1),U(r)?(n(),D(F,{key:0,class:"text-grey-lighten-1",icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>E(u.registration,A,i(A))},null,8,["onClick"])):V("",!0)]))),128))]),w("ul",null,[(n(!0),T(h,null,H(m.value,A=>(n(),T("li",{key:A.Heading},[w("strong",null,[I(y(A.Heading),1),A.Form.Type!==U(Ce).FORM_TYPE_ADMIN?(n(),T(h,{key:0},[I(": ")],64)):V("",!0)]),A.Form.Type!==U(Ce).FORM_TYPE_ADMIN?(n(),T("span",{key:0,class:Te(U(bt)(A.Submission.Status))},y(U(wt)(A.Submission.Status)),3)):V("",!0),U(r)?(n(),D(F,{key:1,icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>E(A.Registration,A.Form,A.Submission)},null,8,["onClick"])):V("",!0)]))),128))])],64))}}),$a={key:0,class:"text-blue"},Ba={key:1,class:"text-red"},Ga={key:2,class:"text-orange"},Ha={key:3,class:"text-orange"},xa={key:4,class:"text-orange"},Ya={key:5,class:"text-orange"},Ka={key:6,class:"text-green"},ja=B({__name:"DataPanelPaymentStatus",props:{registration:{}},setup(e){const l=K(()=>{if(e.registration.Paid===0&&e.registration.Total)return"REQUIRED";if(e.registration.Total>e.registration.Paid)return"ADDITIONAL_REQUIRED";const t=e.registration.Members.find(a=>a.Paid===0&&(a.Total||0)>0);return t?e.registration.Total===0&&t.Total===0?"NOT_REQUIRED":e.registration.Total===0&&t.Total||e.registration.Total>0&&t.Total===0?"MISSING_REQUIRED":e.registration.Paid>=e.registration.Total?"AWAITING_PARTNER":"ALL_REQUIRED":e.registration.Total===0?"NOT_REQUIRED":"COMPLETE"});return(t,a)=>l.value=="NOT_REQUIRED"?(n(),T("div",$a,"No Payment Requested")):l.value=="MISSING_REQUIRED"?(n(),T("div",Ba,"Partner Payment Not Requested")):l.value=="AWAITING_PARTNER"?(n(),T("div",Ga,"Awaiting Partner Payment")):l.value=="ALL_REQUIRED"?(n(),T("div",Ha,"Awaiting Payments")):l.value=="REQUIRED"?(n(),T("div",xa,"Awaiting Payment")):l.value=="ADDITIONAL_REQUIRED"?(n(),T("div",Ya,"Awaiting Additional Payments")):(n(),T("div",Ka,"Completed"))}});var Ja=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],qa=function(e){return Ja.map(function(l){return l.toLowerCase()}).indexOf(e.toLowerCase())!==-1},za=function(e,l,t){Object.keys(l).filter(qa).forEach(function(a){var r=l[a];typeof r=="function"&&(a==="onInit"?r(e,t):t.on(a.substring(2),function(m){return r(m,t)}))})},Qa=function(e,l,t,a){var r=e.modelEvents?e.modelEvents:null,m=Array.isArray(r)?r.join(" "):r;ne(a,function(E,i){t&&typeof E=="string"&&E!==i&&E!==t.getContent({format:e.outputFormat})&&t.setContent(E)}),t.on(m||"change input undo redo",function(){l.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},Xa=function(e,l,t,a,r,m){a.setContent(m()),t.attrs["onUpdate:modelValue"]&&Qa(l,t,a,r),za(e,t.attrs,a)},ze=0,dt=function(e){var l=Date.now(),t=Math.floor(Math.random()*1e9);return ze++,e+"_"+t+ze+String(l)},Wa=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Qe=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Za=function(e,l){return Qe(e).concat(Qe(l))},en=function(e){return e==null},Xe=function(){return{listeners:[],scriptId:dt("tiny-script"),scriptLoaded:!1}},tn=function(){var e=Xe(),l=function(r,m,E,i){var u=m.createElement("script");u.referrerPolicy="origin",u.type="application/javascript",u.id=r,u.src=E;var c=function(){u.removeEventListener("load",c),i()};u.addEventListener("load",c),m.head&&m.head.appendChild(u)},t=function(r,m,E){e.scriptLoaded?E():(e.listeners.push(E),r.getElementById(e.scriptId)||l(e.scriptId,r,m,function(){e.listeners.forEach(function(i){return i()}),e.scriptLoaded=!0}))},a=function(){e=Xe()};return{load:t,reinitialize:a}},an=tn(),nn=function(){return typeof window<"u"?window:global},me=function(){var e=nn();return e&&e.tinymce?e.tinymce:null},on={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},le=function(){return le=Object.assign||function(e){for(var l,t=1,a=arguments.length;t<a;t++){l=arguments[t];for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r])}return e},le.apply(this,arguments)},ln=function(e,l,t,a){return e(a||"div",{id:l,ref:t})},sn=function(e,l,t){return e("textarea",{id:l,visibility:"hidden",ref:t})},Ne={selector:void 0,target:void 0},rn=B({props:on,setup:function(e,l){var t=e.init?le(le({},e.init),Ne):le({},Ne),a=Tt(e),r=a.disabled,m=a.modelValue,E=a.tagName,i=S(null),u=null,c=e.id||dt("tiny-vue"),A=e.init&&e.init.inline||e.inline,f=!!l.attrs["onUpdate:modelValue"],v=!0,d=e.initialValue?e.initialValue:"",_="",R=function(g){return f?function(){return m!=null&&m.value?m.value:""}:function(){return g?d:_}},k=function(){var g=R(v),C=le(le({},t),{readonly:e.disabled,target:i.value,plugins:Za(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:A,setup:function(L){u=L,L.on("init",function(q){return Xa(q,e,l,L,m,g)}),typeof t.setup=="function"&&t.setup(L)}});Wa(i.value)&&(i.value.style.visibility=""),me().init(C),v=!1};ne(r,function(g){var C;u!==null&&(typeof((C=u.mode)===null||C===void 0?void 0:C.set)=="function"?u.mode.set(g?"readonly":"design"):u.setMode(g?"readonly":"design"))}),ne(E,function(g){var C;f||(_=u.getContent()),(C=me())===null||C===void 0||C.remove(u),ye(function(){return k()})}),Et(function(){if(me()!==null)k();else if(i.value&&i.value.ownerDocument){var g=e.cloudChannel?e.cloudChannel:"6",C=e.apiKey?e.apiKey:"no-api-key",L=en(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(C,"/tinymce/").concat(g,"/tinymce.min.js"):e.tinymceScriptSrc;an.load(i.value.ownerDocument,L,k)}}),_t(function(){me()!==null&&me().remove(u)}),A||(Ut(function(){v||k()}),gt(function(){var g;f||(_=u.getContent()),(g=me())===null||g===void 0||g.remove(u)}));var O=function(g){var C;_=u.getContent(),(C=me())===null||C===void 0||C.remove(u),t=le(le(le({},t),g),Ne),ye(function(){return k()})};return l.expose({rerender:O,getEditor:function(){return u}}),function(){return A?ln(xe,c,i,e.tagName):sn(xe,c,i)}}});const un=["colspan"],dn=w("strong",null,"E-Mail Content",-1),cn=["innerHTML"],mn=B({__name:"Communications",props:{expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:l}){const t=te(),a=S([]),r=S({From:"",Subject:"",HTML:""}),m=S(""),E=S(""),i=S(""),u=S(!1),c=S(e.expanded?["1"]:[]),A=S([]),f=S([]),v=S([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),d=S([{key:"CreatedAt",order:"asc"}]);ne(r,g=>{i.value=g.From||i.value||"",E.value=g.Subject||E.value||"",m.value=g.HTML||m.value||""});const _=l,R=()=>{t.getRegistrationEmails(e.registration.RegistrationUUID).then(g=>{g&&(g.forEach(C=>{C.CreatedAt=Ie(new Date(C.CreatedAt||"")),C.Status=Qt(C.Status),C.User||(C.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),f.value=g)})};R(),(()=>{t.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(g=>{g&&(a.value=g)})})();const O=({callback:g})=>{t.sendRegistrationEmail(e.registration.RegistrationUUID,i.value,E.value,m.value).then(C=>{C?g&&(g("Email Sent"),R(),setTimeout(()=>{u.value=!1},2e3)):g&&g("Not sent")}).catch(()=>{g&&g("Not sent")})};return(g,C)=>(n(),T(h,null,[g.showEditor?(n(),D(se,{key:0,class:"px-0",style:{"max-width":"calc(100vw - 64px)"}},{default:o(()=>[s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[s(at,{items:a.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:r.value,"onUpdate:modelValue":C[0]||(C[0]=L=>r.value=L),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12"},{default:o(()=>[s(re,{modelValue:i.value,"onUpdate:modelValue":C[1]||(C[1]=L=>i.value=L),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12"},{default:o(()=>[s(re,{modelValue:E.value,"onUpdate:modelValue":C[2]||(C[2]=L=>E.value=L),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12"},{default:o(()=>[s(U(rn),{modelValue:m.value,"onUpdate:modelValue":C[3]||(C[3]=L=>m.value=L),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[s(Je,{onClick:C[4]||(C[4]=L=>_("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),s(P,{class:"text-right"},{default:o(()=>[s(Je,{onClick:O,label:"Send",color:"error"})]),_:1})]),_:1})]),_:1})):V("",!0),f.value.length&&!g.hideHistory?(n(),D(He,{key:1,class:"my-2",multiple:!0,modelValue:c.value,"onUpdate:modelValue":C[7]||(C[7]=L=>c.value=L)},{default:o(()=>[s(Ge,{value:"1"},{default:o(()=>[s(Fe,null,{default:o(()=>[I(" Email History ")]),_:1}),s($e,null,{default:o(()=>[s(Be,{items:f.value,headers:v.value,"show-expand":!0,"item-value":"EmailUUID",expanded:A.value,"onUpdate:expanded":C[5]||(C[5]=L=>A.value=L),"sort-by":d.value,"onUpdate:sortBy":C[6]||(C[6]=L=>d.value=L)},{"expanded-row":o(({columns:L,item:q})=>[w("tr",null,[w("td",{colspan:L.length},[dn,w("div",{class:"communicationsViewEmailPreview",innerHTML:q.HTML},null,8,cn)],8,un)])]),"footer.prepend":o(()=>[s(F,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:R},{default:o(()=>[I("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0)],64))}}),vn=B({__name:"Emails",props:{allowSending:{type:Boolean,default:!0},expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!0},registration:{},textClass:{default:""}},setup(e){const l=S(!1);return(t,a)=>(n(),T(h,null,[s(Pe,null,{default:o(()=>[t.showTitle?(n(),D(be,{key:0},{default:o(()=>[s(Re,null,{default:o(()=>[I(" E-Mails (#"+y(t.registration.Reference)+" "+y(t.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})):V("",!0),s(we,{class:Te(t.textClass)},{default:o(()=>[t.allowSending?(n(),D(Y,{key:0},{default:o(()=>[s(P,{cols:"12"},{default:o(()=>[s(F,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:a[0]||(a[0]=r=>l.value=!0)},{default:o(()=>[I(" Prepare Email ")]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1},8,["class"])]),_:1}),s(mn,{registration:t.registration,expanded:t.expanded,"hide-history":t.hideHistory,"show-editor":l.value,onCloseEditor:a[1]||(a[1]=r=>l.value=!1)},null,8,["registration","expanded","hide-history","show-editor"])],64))}}),fn=B({__name:"EditNoteCategoryDialog",props:x({convention:{},noteCategory:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["update:noteCategory"],["update:modelValue"]),setup(e,{emit:l}){const t=e,{title:a=""}=t,r=l,m=j(e,"modelValue"),E=Ve(t,r,void 0,void 0,"noteCategory"),i=S(ee(E.value));ne(E,()=>{i.value=ee(E.value)});const u=()=>{m.value=!1},c=()=>{i.value=ee(E.value)},A=()=>{E.value=i.value};return(f,v)=>(n(),D(Ee,{modelValue:m.value,"onUpdate:modelValue":v[2]||(v[2]=d=>m.value=d),onReset:c,onSave:A,title:U(a),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0},{default:o(()=>[s(se,{class:"pa-0",fluid:!0},{default:o(()=>[s(Y,null,{default:o(()=>[s(P,{cols:"12",sm:"6",md:"4"},{default:o(()=>[s(re,{modelValue:i.value.Name,"onUpdate:modelValue":v[0]||(v[0]=d=>i.value.Name=d),label:"Internal name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12",sm:"6",md:"4"},{default:o(()=>[s(Ft,{modelValue:i.value.Groups,"onUpdate:modelValue":v[1]||(v[1]=d=>i.value.Groups=d),convention:f.convention,label:"Groups",variant:"outlined","hide-details":""},null,8,["modelValue","convention"])]),_:1})]),_:1})]),_:1})]),actions:o(()=>[s(F,{color:"blue-darken-1",variant:"text",onClick:u},{default:o(()=>[I(" Cancel ")]),_:1}),s(F,{color:"blue-darken-1",variant:"text",onClick:c},{default:o(()=>[I(" Reset ")]),_:1}),s(_e),s(F,{color:"blue-darken-1",variant:"text",onClick:A},{default:o(()=>[I(" Save ")]),_:1})]),_:1},8,["modelValue","title"]))}}),An=()=>{const e=S(""),l=()=>{const t={x:window.innerWidth,y:window.innerHeight};t.x<600?e.value="xs":t.x>=600&&t.x<960?e.value="sm":t.x>=960&&t.x<1280?e.value="md":t.x>=1280&&t.x<1920?e.value="lg":t.x>=1920&&t.x<2560?e.value="xl":t.x>=2560&&(e.value="xxl")};return window.addEventListener("resize",l),l(),e},Tn={style:{"list-style":"none"}},En=B({__name:"NoteCategories",props:{hideHistory:{type:Boolean},convention:{},showEditor:{type:Boolean}},emits:["close"],setup(e,{emit:l}){const t=te(),a=l,r=S(!1),m=S(!1),E=S(""),i=S([]),u=S([{key:"Name",title:"Name"},{key:"Groups",title:"Groups"},{key:"actions",title:"",sortable:!1}]),c=An();S([{key:"CreatedAt",order:"asc"}]);const A=()=>({ID:0,NoteCategoryUUID:ge(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"",Groups:[],Notes:[]}),f=S(-1),v=S(A()),d=S(A()),_=()=>{d.value.NoteCategoryUUID=ge(),v.value=Object.assign({},A()),f.value=-1,r.value=!0},R=G=>{f.value=i.value.indexOf(G),v.value=Object.assign({},G),r.value=!0},k=G=>{f.value=i.value.indexOf(G),v.value=Object.assign({},G),m.value=!0},O=()=>{t.deleteNoteCategory(v.value.NoteCategoryUUID).then(G=>{G&&(i.value.splice(f.value,1),C())})},g=()=>{r.value=!1,ye(()=>{v.value=Object.assign({},d.value),f.value=-1})},C=()=>{m.value=!1,ye(()=>{v.value=Object.assign({},d.value),f.value=-1})},L=()=>{t.saveNoteCategory(v.value).then(G=>{G&&(f.value>-1?Object.assign(i.value[f.value],G):i.value.push(G),g())})};return(()=>{t.getNoteCategories(e.convention.ConventionUUID).then(G=>{G&&(i.value=G)})})(),(G,W)=>(n(),D(Be,{headers:u.value,items:i.value,"sort-by":[{key:"calories",order:"asc"}],class:"elevation-1"},{top:o(()=>[s(Gt,{color:"primary"},Me({default:o(()=>[s(Bt,null,{default:o(()=>[I("Note Categories")]),_:1}),s(Ht,{class:"mx-4 d-none d-sm-inline-flex",inset:!0,vertical:!0}),s(_e,{class:"d-none d-sm-inline-flex"}),U(c)!="xs"?(n(),D(F,{key:0,dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:_},{default:o(()=>[I(" New Item ")]),_:1})):V("",!0),s(F,{dark:"",class:"mb-2",icon:"mdi:mdi-window-close",onClick:W[0]||(W[0]=z=>a("close"))}),s($t,{modelValue:m.value,"onUpdate:modelValue":W[1]||(W[1]=z=>m.value=z),onDelete:O},null,8,["modelValue"])]),_:2},[U(c)=="xs"?{name:"extension",fn:o(()=>[s(_e),s(F,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:_},{default:o(()=>[I(" New Item ")]),_:1})]),key:"0"}:void 0]),1024),r.value?(n(),D(fn,{key:0,modelValue:r.value,"onUpdate:modelValue":W[2]||(W[2]=z=>r.value=z),"note-category":v.value,"onUpdate:noteCategory":[W[3]||(W[3]=z=>v.value=z),L],title:E.value,convention:G.convention},null,8,["modelValue","note-category","title","convention"])):V("",!0)]),"item.Groups":o(({item:z})=>[w("ul",Tn,[(n(!0),T(h,null,H(z.Groups,b=>(n(),T("li",{key:b.GroupUUID,class:"py-1"},y(b.Name),1))),128))])]),"item.actions":o(({item:z})=>[s(ue,{size:"small",class:"me-2",onClick:b=>R(z)},{default:o(()=>[I(" mdi:mdi-pencil ")]),_:2},1032,["onClick"]),s(ue,{size:"small",onClick:b=>k(z)},{default:o(()=>[I(" mdi:mdi-delete ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"]))}}),_n=B({__name:"SelectNoteCategories",props:x({convention:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:x(["change"],["update:modelValue"]),setup(e,{emit:l}){const t=j(e,"modelValue"),a=l,r=S([]),m=te(),E=S([]),i=S(""),u=S(0),c=K(()=>[...E.value].map(v=>({title:v.Name,value:r.value.find(d=>d.NoteCategoryUUID===v.NoteCategoryUUID)||v})));return typeof e.convention=="object"?i.value=e.convention.ConventionUUID:i.value=e.convention||"",(async()=>{const f=[];i.value&&f.push(m.getNoteCategories(i.value));const v=await Promise.all(f);if(i.value&&v.length==1&&(E.value=v[0].sort((d,_)=>d.Name.localeCompare(_.Name))),Array.isArray(t.value))u.value=2,c.value.forEach(d=>{Array.isArray(t.value)&&t.value.find(R=>R.NoteCategoryUUID===d.value.NoteCategoryUUID)&&r.value.push(d.value)});else if(typeof t.value=="string"){u.value=1;try{const d=JSON.parse(t.value);c.value.forEach(_=>{d.find(k=>k.NoteCategoryUUID===_.value.NoteCategoryUUID)&&r.value.push(_.value)})}catch{}}})(),ne(r,()=>{switch(u.value){default:case 2:{t.value=r.value,a("change");break}case 1:{t.value=JSON.stringify(r.value),a("change");break}}}),(f,v)=>(n(),D(at,{modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=d=>r.value=d),chips:f.chips,multiple:"",label:f.label||"Tags",variant:f.variant||"solo",hint:f.hint,"persistent-hint":!0,clearable:f.clearable,items:c.value,"item-title":"title","item-value":"value"},null,8,["modelValue","chips","label","variant","hint","clearable","items"]))}}),Un=B({__name:"EditNoteDialog",props:x({convention:{},note:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["update:note","saved"],["update:modelValue"]),setup(e,{emit:l}){const t=e,{title:a=""}=t,r=te(),m=l,E=j(e,"modelValue"),i=Ve(t,m,void 0,void 0,"note"),u=S(ee(i.value));ne(i,()=>{u.value=ee(i.value)});const c=()=>{u.value=ee(i.value)},A=f=>{u.value.NoteCategories===null&&(u.value.NoteCategories=[]),u.value.CreatedAt=void 0,u.value.DeletedAt=void 0,u.value.UpdatedAt=void 0,u.value.Admin=void 0,u.value.AdminID=void 0,u.value.AdminUUID=void 0,r.saveNote(u.value).then(v=>{v?(u.value=ee(v),f&&f("Note Saved"),i.value=u.value,m("saved",i.value)):f&&f("Internal Error Saving Note")}).catch(v=>{f&&f("Error Saving Note:"+v.ErrorMessage)})};return(f,v)=>u.value?(n(),D(Ee,{key:0,"card-class":"pa-4",modelValue:E.value,"onUpdate:modelValue":v[3]||(v[3]=d=>E.value=d),onReset:c,onSave:A,title:U(a),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0,"show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:o(()=>[s(se,{class:"pa-0",fluid:!0},{default:o(()=>[s(Y,null,{default:o(()=>[s(P,{cols:"12"},{default:o(()=>[s(_n,{modelValue:u.value.NoteCategories,"onUpdate:modelValue":v[0]||(v[0]=d=>u.value.NoteCategories=d),convention:f.convention,label:"Categories",variant:"outlined","hide-details":"",chips:!0},null,8,["modelValue","convention"])]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12"},{default:o(()=>[s(re,{modelValue:u.value.Subject,"onUpdate:modelValue":v[1]||(v[1]=d=>u.value.Subject=d),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12"},{default:o(()=>[s(it,{modelValue:u.value.Description,"onUpdate:modelValue":v[2]||(v[2]=d=>u.value.Description=d),label:"Note",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])):V("",!0)}}),gn=B({__name:"Notes",props:{allowAdding:{type:Boolean,default:!0},cardClass:{default:""},convention:{},expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean},registration:{},showControlPanel:{type:Boolean,default:!0},showEditor:{type:Boolean},showTitle:{type:Boolean,default:!0},textClass:{default:""}},setup(e){const l=te(),t=()=>({ID:0,NoteUUID:ge(),Description:"",NoteCategories:[],Registration:e.registration,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Subject:""}),a=S(!1),r=S(!1),m=S([]),E=S([]),i=S(t()),u=()=>{i.value=t(),a.value=!0},c=v=>{i.value=v,a.value=!0},A=()=>{l.getRegistrationNotes(e.registration.RegistrationUUID).then(v=>{v&&(v.forEach(d=>{d.CreatedAt=Ie(new Date(d.CreatedAt||"")),d.Admin||(d.Admin={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),m.value=v,e.expanded&&(E.value=v.map(d=>d.NoteUUID)))})},f=()=>{A(),setTimeout(()=>{a.value=!1},2e3)};return A(),(v,d)=>(n(),T(h,null,[s(Pe,{class:Te(v.cardClass)},{default:o(()=>[s(be,null,{default:o(()=>[s(Re,null,{default:o(()=>[s(Y,{class:"flex-row-reverse"},{default:o(()=>[v.showControlPanel?(n(),D(P,{key:0,class:"text-right flex-shrink-1 flex-grow-0",style:{"flex-grow":"0 !important"}},{default:o(()=>[s(F,{class:"d-sm-none",size:"xs",icon:"mdi:mdi-cog",variant:"text",color:"warning",onClick:d[0]||(d[0]=_=>r.value=!0)}),s(F,{class:"d-none d-sm-inline-flex","prepend-icon":"mdi:mdi-cog",variant:"text",color:"warning",onClick:d[1]||(d[1]=_=>r.value=!0)},{default:o(()=>[I("Categories")]),_:1})]),_:1})):V("",!0),v.showTitle?(n(),D(P,{key:1,class:"text-wrap flex-grow-1"},{default:o(()=>[I(" Notes (#"+y(v.registration.Reference)+" "+y(v.registration.User.DisplayName)+") ",1)]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1}),s(we,{class:Te(v.textClass)},{default:o(()=>[m.value.length===0?(n(),T(h,{key:0},[I(" No Notes Recorded ")],64)):(n(),D(He,{key:1,multiple:!0,variant:"accordion",modelValue:E.value,"onUpdate:modelValue":d[2]||(d[2]=_=>E.value=_)},{default:o(()=>[(n(!0),T(h,null,H(m.value,_=>(n(),D(Ge,{key:`${_.NoteUUID}.${_.UpdatedAt}`,value:_.NoteUUID},{default:o(()=>[s(Fe,{class:"py-0"},{default:o(()=>[I(y(_.Subject)+" ",1),s(xt,{class:"ml-4"},{default:o(()=>[_.NoteCategories.length===0?(n(),D(Oe,{key:0},{default:o(()=>[I(" Global ")]),_:1})):V("",!0),(n(!0),T(h,null,H(_.NoteCategories,R=>(n(),D(Oe,{key:R.NoteCategoryUUID},{default:o(()=>[I(y(R.Name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),s($e,null,{default:o(()=>[s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[I(y(_.Description),1)]),_:2},1024)]),_:2},1024),s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[I(y(U(ie)(_.UpdatedAt||""))+" ",1),_&&_.Admin&&_.Admin.DisplayName?(n(),T(h,{key:0},[I(" - "+y(_.Admin.DisplayName),1)],64)):V("",!0)]),_:2},1024),s(P,{class:"text-right"},{default:o(()=>[s(F,{color:"primary","prepend-icon":"mdi:mdi-pencil",onClick:R=>c(_)},{default:o(()=>[I("Edit")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["class"]),v.allowAdding?(n(),D(ot,{key:0},{default:o(()=>[s(F,{color:"primary",variant:"flat",onClick:u},{default:o(()=>[I("Add Note")]),_:1})]),_:1})):V("",!0)]),_:1},8,["class"]),s(qe,{modelValue:a.value,"onUpdate:modelValue":d[5]||(d[5]=_=>a.value=_),title:"Create Note"},{default:o(()=>[s(Un,{modelValue:a.value,"onUpdate:modelValue":d[3]||(d[3]=_=>a.value=_),note:i.value,"onUpdate:note":d[4]||(d[4]=_=>i.value=_),convention:v.convention,title:"Create Note",onSaved:f},null,8,["modelValue","note","convention"])]),_:1},8,["modelValue"]),s(qe,{modelValue:r.value,"onUpdate:modelValue":d[7]||(d[7]=_=>r.value=_),title:"Note Configuration"},{default:o(()=>[s(En,{convention:v.convention,onClose:d[6]||(d[6]=_=>r.value=!1)},null,8,["convention"])]),_:1},8,["modelValue"])],64))}}),Sn=B({__name:"StripeRefundPayment",props:x({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["refunded"],["update:modelValue"]),setup(e,{emit:l}){const t=j(e,"modelValue"),a=l,r=te(),m=S(!1),E=S("");let i=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const d=e.paymentTransaction.Data.PaymentIntent;d&&(i=d.amount)}const u=S({Amount:i/100,Description:"",Reason:""}),c=S([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),A=S(!1);async function f(d){d.preventDefault(),A.value=!0,r.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,u.value).then(_=>{_?a("refunded",_):v("An unexpected error occurred.")}).catch(_=>{v("An error occurred processing the refund: "+_.toString())}),A.value=!1}const v=d=>{E.value=d,m.value=!0};return(d,_)=>(n(),D(Ee,{modelValue:t.value,"onUpdate:modelValue":_[7]||(_[7]=R=>t.value=R),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:o(()=>[s(se,{class:"pa-0"},{default:o(()=>[s(Yt,{ref:"refundForm",id:"refund-form",onSubmit:_[4]||(_[4]=St(R=>f(R),["prevent"]))},{default:o(()=>[s(Y,null,{default:o(()=>[s(P,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[s(re,{modelValue:u.value.Amount,"onUpdate:modelValue":_[0]||(_[0]=R=>u.value.Amount=R),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:o(()=>[s(Ue,{modelValue:u.value.Reason,"onUpdate:modelValue":_[1]||(_[1]=R=>u.value.Reason=R),modelModifiers:{number:!0},items:c.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),s(P,{cols:"12"},{default:o(()=>[s(re,{modelValue:u.value.Description,"onUpdate:modelValue":_[2]||(_[2]=R=>u.value.Description=R),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[s(F,{color:"error",class:"w-100",onClick:_[3]||(_[3]=R=>t.value=!1)},{default:o(()=>[I("Cancel")]),_:1})]),_:1}),s(_e),s(P,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[s(F,{type:"submit",color:"success",class:"w-100"},Me({default:o(()=>[I(" Issue Refund ")]),_:2},[A.value?{name:"prepend",fn:o(()=>[s(tt,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),s(nt,{modelValue:m.value,"onUpdate:modelValue":_[6]||(_[6]=R=>m.value=R)},{actions:o(()=>[s(F,{variant:"text",onClick:_[5]||(_[5]=R=>m.value=!1)},{default:o(()=>[I(" Close ")]),_:1})]),default:o(()=>[I(y(E.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Cn=["colspan"],Dn=w("strong",null,"Details",-1),yn=["innerHTML"],In=B({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},expanded:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:l}){const t=e;let{expanded:a=!0,hideHistory:r=!1,registration:m,showEditor:E}=t;const i=te(),u=S([]),c=S(a?["1"]:[]),A=S([]),f=S([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),v=S(!1),d=S(),_=S(!1),R=S(""),k=S([{key:"CreatedAt",order:"asc"}]),O=l,g=()=>({PaymentTransactionUUID:ge(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:m.ID,RegistrationUUID:m.RegistrationUUID,Source:Ke.PAYMENT_TRANSACTION_SOURCE_NULL,Type:je.PAYMENT_TRANSACTION_TYPE_NULL}),C=S(g()),{convertTransactions:L,getPaymentTransactionsDisplay:q}=ht();ne(t,()=>{r=t.hideHistory,m=t.registration,E=t.showEditor,q(m.RegistrationUUID).then(M=>{A.value=M})});const G=()=>{q(m.RegistrationUUID).then(M=>{A.value=M})};G();const W=()=>{i.saveRegistrationPaymentTransaction(C.value).then(M=>{M&&(L(M.PaymentTransactions),C.value=g(),O("close-editor"),O("change"))})},z=M=>{const N=A.value.find(p=>p.PaymentTransactionUUID===M);N&&(d.value=N.PaymentTransaction,v.value=!0)},b=M=>{if(M)try{A.value=L(M.PaymentTransactions),d.value=void 0,v.value=!1,R.value="Refund Processed",_.value=!0,O("change")}catch(N){console.error(N)}};return(M,N)=>(n(),T(h,null,[U(E)?(n(),T(h,{key:0},[s(Re,null,{default:o(()=>[I(" Add Transaction ")]),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12",sm:"6"},{default:o(()=>[s(Ue,{items:U(Rt),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:C.value.Type,"onUpdate:modelValue":N[0]||(N[0]=p=>C.value.Type=p),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),s(P,{cols:"12",sm:"6"},{default:o(()=>[s(Ue,{items:U(Nt),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:C.value.Source,"onUpdate:modelValue":N[1]||(N[1]=p=>C.value.Source=p),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12",sm:"8",md:"10"},{default:o(()=>[s(re,{label:"Description","hide-details":"",modelValue:C.value.Description,"onUpdate:modelValue":N[2]||(N[2]=p=>C.value.Description=p),variant:"outlined"},null,8,["modelValue"])]),_:1}),s(P,{cols:"12",sm:"4",md:"2"},{default:o(()=>[s(re,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:C.value.Amount,"onUpdate:modelValue":N[3]||(N[3]=p=>C.value.Amount=p),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),s(Y,null,{default:o(()=>[s(P,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[s(F,{class:"w-100",onClick:N[4]||(N[4]=p=>O("close-editor")),color:"warning"},{default:o(()=>[I("Cancel")]),_:1})]),_:1}),s(_e),s(P,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[s(F,{class:"w-100",onClick:W,color:"primary"},{default:o(()=>[I("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):V("",!0),A.value.length&&!U(r)?(n(),D(He,{key:1,class:"my-2",modelValue:c.value,"onUpdate:modelValue":N[10]||(N[10]=p=>c.value=p)},{default:o(()=>[s(Ge,{value:"1"},{default:o(()=>[s(Fe,null,{default:o(()=>[I(" Transaction History ")]),_:1}),s($e,null,{default:o(()=>[s(Be,{items:A.value,headers:f.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:u.value,"onUpdate:expanded":N[5]||(N[5]=p=>u.value=p),"sort-by":k.value,"onUpdate:sortBy":N[6]||(N[6]=p=>k.value=p),class:"transactionTable"},{"item.Controls":o(({item:p})=>[M.canEdit&&p.PaymentTransaction&&p.PaymentTransaction.Source===U(Ke).PAYMENT_TRANSACTION_SOURCE_STRIPE&&p.PaymentTransaction.Type===U(je).PAYMENT_TRANSACTION_TYPE_PAYMENT?(n(),D(F,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:$=>z(p.PaymentTransactionUUID)},null,8,["onClick"])):V("",!0)]),"expanded-row":o(({columns:p,item:$})=>[w("tr",null,[w("td",{colspan:p.length},[Dn,w("div",{innerHTML:$.Data},null,8,yn)],8,Cn)])]),"footer.prepend":o(()=>[s(F,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:G},{default:o(()=>[I("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),v.value&&d.value?(n(),D(Sn,{key:0,modelValue:v.value,"onUpdate:modelValue":N[7]||(N[7]=p=>v.value=p),"payment-transaction":d.value,onRefunded:b},null,8,["modelValue","payment-transaction"])):V("",!0),s(nt,{modelValue:_.value,"onUpdate:modelValue":N[9]||(N[9]=p=>_.value=p)},{actions:o(()=>[s(F,{variant:"text",onClick:N[8]||(N[8]=p=>_.value=!1)},{default:o(()=>[I(" Close ")]),_:1})]),default:o(()=>[I(y(R.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0)],64))}}),pn=B({__name:"DataPanelRegistrationTags",props:x({registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=j(e,"modelValue"),t=K(()=>{if(!l.value.Meta.Tags||!Array.isArray(l.value.Meta.Tags))return e.registration.Tags;const r=l.value.Meta.Tags;return r.length===0?e.registration.Tags:e.registration.Tags.filter(m=>r.includes(m.TagUUID))}),a=K(()=>l.value.Meta.TagColour?l.value.Meta.TagColour:"");return(r,m)=>(n(!0),T(h,null,H(t.value,E=>(n(),D(Oe,{key:E.TagUUID,color:a.value,class:"ma-1"},{default:o(()=>[I(y(E.Title),1)]),_:2},1032,["color"]))),128))}}),Rn=ke(pn,[["__scopeId","data-v-644b07d0"]]),Nn=w("span",{class:"font-weight-bold pr-2"},"Status:",-1),hn={key:0,class:"text-green-darken-2"},On={key:1,class:"text-yellow-darken-4"},kn={key:2,class:"text-red-darken-4"},Mn=w("br",null,null,-1),Vn=w("span",{class:"font-weight-bold pr-2"},"Status:",-1),Ln={key:0,class:"text-green-darken-2"},bn={key:1,class:"text-yellow-darken-4"},wn={key:2,class:"text-red-darken-4"},Pn=w("span",null,"Not Checked In",-1),We=B({__name:"DataPanelCheckIn",props:x({convention:{},showControls:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=j(e,"modelValue"),t=te(),a=Se(),r=rt(a,e.convention),m=S([]),E=S(!1),i=S(!1),u=S(Q.CHECK_IN_STATUS_PENDING),c=S(""),A=R=>{E.value=!0,u.value=R},f=()=>{v()},v=()=>{t.getCheckInHistory(l.value.RegistrationUUID).then(R=>{R&&(m.value=R,i.value=!0,R.length&&(l.value.CheckIn=R[0]))}).catch(()=>{})},d=R=>{t.saveCheckIn(l.value.RegistrationUUID,u.value,c.value).then(k=>{k?(l.value.CheckIn=k,R&&(R("Check In Saved"),setTimeout(()=>{E.value=!1},500))):R&&R("Check In Failed")}).catch(()=>{R&&R("Check In Failed")})},_=K(()=>{switch(u.value){case Q.CHECK_IN_STATUS_REVOKED:return"yellow-darken-4";case Q.CHECK_IN_STATUS_REJECTED:return"red-darken-4";case Q.CHECK_IN_STATUS_COMPLETED:return"green-darken-2"}return""});return(R,k)=>(n(),T(h,null,[R.showControls&&U(r)?(n(),D(se,{key:0,class:"px-0"},{default:o(()=>[s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[s(F,{color:"error",class:"w-100","prepend-icon":"mdi:mdi-window-close",onClick:k[0]||(k[0]=O=>A(U(Q).CHECK_IN_STATUS_REJECTED))},{default:o(()=>[I(" Reject ")]),_:1})]),_:1}),s(P,null,{default:o(()=>[s(F,{color:"warning",class:"w-100","prepend-icon":"mdi:mdi-window-close",onClick:k[1]||(k[1]=O=>A(U(Q).CHECK_IN_STATUS_REVOKED))},{default:o(()=>[I(" Revoke ")]),_:1})]),_:1}),s(P,null,{default:o(()=>[s(F,{color:"success",class:"w-100","prepend-icon":"mdi:mdi-check",onClick:k[2]||(k[2]=O=>A(U(Q).CHECK_IN_STATUS_COMPLETED))},{default:o(()=>[I(" Approve ")]),_:1})]),_:1})]),_:1}),s(Ee,{modelValue:E.value,"onUpdate:modelValue":k[4]||(k[4]=O=>E.value=O),color:_.value,fullscreen:!1,"hide-extension":!0,persistent:!1,scrollable:!1,"show-close-action":!0,"show-save-action":!0,"save-button-label":"Confirm",title:`${U(ce)(u.value)} Check-In`,onSave:d},{default:o(()=>[s(it,{modelValue:c.value,"onUpdate:modelValue":k[3]||(k[3]=O=>c.value=O),label:"Notes",variant:"outlined"},null,8,["modelValue"])]),_:1},8,["modelValue","color","title"])]),_:1})):V("",!0),l.value.CheckIn?(n(),D(se,{key:1,class:"px-0"},{default:o(()=>[s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[Nn,l.value.CheckIn.Status===U(Q).CHECK_IN_STATUS_COMPLETED?(n(),T("span",hn,y(U(ce)(l.value.CheckIn.Status)),1)):l.value.CheckIn.Status===U(Q).CHECK_IN_STATUS_REVOKED?(n(),T("span",On,y(U(ce)(l.value.CheckIn.Status)),1)):l.value.CheckIn.Status===U(Q).CHECK_IN_STATUS_REJECTED?(n(),T("span",kn,y(U(ce)(l.value.CheckIn.Status)),1)):V("",!0),Mn,s(F,{style:{"font-size":"0.75rem","text-transform":"none"},"append-icon":"mdi:mdi-chevron-down",size:"xs",variant:"text",onClick:f},{default:o(()=>[I("History")]),_:1})]),_:1}),s(P,{class:"text-right"},{default:o(()=>{var O;return[w("small",null,y((O=l.value.CheckIn.Admin)==null?void 0:O.DisplayName)+" "+y(U(Ie)(l.value.CheckIn.CreatedAt||"")),1)]}),_:1})]),_:1}),s(Ee,{modelValue:i.value,"onUpdate:modelValue":k[5]||(k[5]=O=>i.value=O),fullscreen:!1,"hide-extension":!0,persistent:!1,scrollable:!0,"show-close-action":!0,"show-save-action":!1,title:"Check-In History"},{default:o(()=>[s(fe,null,{default:o(()=>[(n(!0),T(h,null,H(m.value,O=>(n(),D(Ae,{key:O.CheckInUUID},{default:o(()=>[s(he,null,{default:o(()=>[s(Y,null,{default:o(()=>[s(P,null,{default:o(()=>[Vn,O.Status===U(Q).CHECK_IN_STATUS_COMPLETED?(n(),T("span",Ln,y(U(ce)(O.Status)),1)):O.Status===U(Q).CHECK_IN_STATUS_REVOKED?(n(),T("span",bn,y(U(ce)(O.Status)),1)):O.Status===U(Q).CHECK_IN_STATUS_REJECTED?(n(),T("span",wn,y(U(ce)(O.Status)),1)):V("",!0)]),_:2},1024),s(P,{class:"text-right"},{default:o(()=>{var g;return[w("small",null,y((g=O.Admin)==null?void 0:g.DisplayName)+" "+y(U(Ie)(O.CreatedAt||"")),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024),O.Details?(n(),D(Ot,{key:0},{default:o(()=>[I(y(O.Details),1)]),_:2},1024)):V("",!0)]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})):(n(),D(se,{key:2,class:"px-0"},{default:o(()=>[Pn]),_:1}))],64))}}),Fn=B({__name:"MetaDataItem",props:x({accommodations:{},convention:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:x(["openActions","showForm"],["update:modelValue","update:registration"]),setup(e,{emit:l}){const t=j(e,"modelValue"),a=j(e,"registration"),r=l,m=i=>{r("openActions",i)},E=(i,u,c)=>{r("showForm",i,u,c)};return(i,u)=>t.value.MetaField===U(J).META_DATA_SOURCE_ACCOMMODATION_ALLOCATION?(n(),D(st,{key:0,convention:i.convention,tickets:i.tickets,accommodations:i.accommodations,venues:i.venues,registration:a.value,forms:i.forms,modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=c=>t.value=c),data:""},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue"])):t.value.MetaField===U(J).META_DATA_SOURCE_BADGE_DISPLAY?(n(),D(ut,{key:1,"card-class":i.itemClass,convention:i.convention,registration:a.value,"show-title":!1,"hide-download":t.value.Meta.HideDownloadButton,"hide-nfc":t.value.Meta.HideNFCButton},null,8,["card-class","convention","registration","hide-download","hide-nfc"])):t.value.MetaField===U(J).META_DATA_SOURCE_EMAILS?(n(),D(vn,{key:2,"allow-sending":!1,expanded:!1,"show-title":!1,registration:a.value,"text-class":"pa-0 ma-0"},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_NOTES?(n(),D(gn,{key:3,"allow-adding":!0,"card-class":i.itemClass,convention:i.convention,expanded:!1,registration:a.value,"show-control-panel":!1,"show-title":!1,"text-class":"pa-0 ma-0"},null,8,["card-class","convention","registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_PAYMENT_STATUS?(n(),D(ja,{key:4,registration:a.value},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_PAYMENTS?(n(),D(In,{key:5,registration:a.value,expanded:!1},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_ACTIONS?(n(),D(F,{key:6,icon:"mdi:mdi-briefcase",variant:"flat",onClick:u[1]||(u[1]=c=>m(a.value))})):t.value.MetaField===U(J).META_DATA_SOURCE_SUBMISSION_STATUS||t.value.MetaField===U(J).META_DATA_SOURCE_ACCOMMODATION_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_ADMIN_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_DEALER_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_BADGE_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_FORM?(n(),D(Fa,{key:7,convention:i.convention,forms:i.forms,registration:a.value,onShowForm:E},null,8,["convention","forms","registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_GROUP?(n(),D(ba,{key:8,registration:a.value},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_REFERENCE?(n(),T(h,{key:9},[I(y(a.value.Reference),1)],64)):t.value.MetaField===U(J).META_DATA_SOURCE_SUBMISSION_DATE?(n(),D(wa,{key:10,registration:a.value},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_TAGS?(n(),D(Rn,{key:11,registration:a.value,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=c=>t.value=c)},null,8,["registration","modelValue"])):t.value.MetaField===U(J).META_DATA_SOURCE_CHECKIN_CONTROL?(n(),D(We,{key:12,convention:i.convention,"show-controls":!0,modelValue:a.value,"onUpdate:modelValue":u[3]||(u[3]=c=>a.value=c)},null,8,["convention","modelValue"])):t.value.MetaField===U(J).META_DATA_SOURCE_CHECKIN_STATUS?(n(),D(We,{key:13,convention:i.convention,"show-controls":!1,modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=c=>a.value=c)},null,8,["convention","modelValue"])):(n(),T(h,{key:14},[I(" Unhandled Meta Item "+y(t.value),1)],64))}}),$n=B({__name:"UserDataItem",props:x({accommodations:{},convention:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const l=j(e,"modelValue"),t=j(e,"registration"),a=Le(),r=K(()=>a.GetProfileImageURL(t.value.UserUUID));return(m,E)=>l.value.UserField===U(ve).USER_DATA_SOURCE_TELEGRAM&&t.value.User.Handle?(n(),T(h,{key:0},[I(" @"+y(t.value.User.Handle),1)],64)):l.value.UserField===U(ve).USER_DATA_SOURCE_AVATAR?(n(),D(lt,{key:1,class:"rounded-circle",src:r.value,height:"32",width:"32"},null,8,["src"])):l.value.UserField===U(ve).USER_DATA_SOURCE_DATE_OF_BIRTH?(n(),T(h,{key:2},[I(y(U(ie)(t.value.User.Additional.DOB,{withYear:!0,withDay:!1})),1)],64)):l.value.UserField===U(ve).USER_DATA_SOURCE_EMAIL?(n(),T(h,{key:3},[I(y(t.value.User.Additional.Email),1)],64)):l.value.UserField===U(ve).USER_DATA_SOURCE_FIRST_NAME?(n(),T(h,{key:4},[I(y(t.value.User.Additional.FirstName),1)],64)):l.value.UserField===U(ve).USER_DATA_SOURCE_LAST_NAME?(n(),T(h,{key:5},[I(y(t.value.User.Additional.LastName),1)],64)):(n(),T(h,{key:6},[I(" Unhandled User Field "+y(l.value),1)],64))}}),Ze=B({__name:"PanelItem",props:x({accommodations:{},convention:{},extras:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:x(["openActions","showForm"],["update:modelValue","update:registration"]),setup(e,{emit:l}){const t=j(e,"modelValue"),a=j(e,"registration"),r=l,m=i=>{r("openActions",i)},E=(i,u,c)=>{r("showForm",i,u,c)};return(i,u)=>t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_FORM?(n(),D(ka,{key:0,accommodations:i.accommodations,convention:i.convention,extras:i.extras,forms:i.forms,interests:i.interests,"item-class":i.itemClass,tickets:i.tickets,venues:i.venues,modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=c=>t.value=c),registration:a.value,"onUpdate:registration":u[1]||(u[1]=c=>a.value=c)},null,8,["accommodations","convention","extras","forms","interests","item-class","tickets","venues","modelValue","registration"])):t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_META?(n(),D(Fn,{key:1,accommodations:i.accommodations,convention:i.convention,forms:i.forms,interests:i.interests,"item-class":i.itemClass,tickets:i.tickets,venues:i.venues,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=c=>t.value=c),registration:a.value,"onUpdate:registration":u[3]||(u[3]=c=>a.value=c),onOpenActions:m,onShowForm:E},null,8,["accommodations","convention","forms","interests","item-class","tickets","venues","modelValue","registration"])):t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_USER?(n(),D($n,{key:2,accommodations:i.accommodations,convention:i.convention,forms:i.forms,interests:i.interests,"item-class":i.itemClass,tickets:i.tickets,venues:i.venues,modelValue:t.value,"onUpdate:modelValue":u[4]||(u[4]=c=>t.value=c),registration:a.value,"onUpdate:registration":u[5]||(u[5]=c=>a.value=c)},null,8,["accommodations","convention","forms","interests","item-class","tickets","venues","modelValue","registration"])):V("",!0)}}),Bn=["onClick"],Gn=["onClick"],ko=B({__name:"PanelLayout",props:x({accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{}},{layout:{required:!0},layoutModifiers:{},modelValue:{required:!0},modelModifiers:{}}),emits:x(["openActions","showForm"],["update:layout","update:modelValue"]),setup(e,{emit:l}){const t=Ct(),a=l,r=j(e,"layout"),m=j(e,"modelValue"),E=S({});r.value&&r.value.Panels&&r.value.Panels.forEach(f=>{E.value[f.LayoutPanelUUID]=!1});const i=f=>{a("openActions",f)},u=(f,v,d)=>{a("showForm",f,v,d)},c=f=>{switch(f.PanelStyle){case oe.PANEL_STYLE_NAV_BOTTOM:return"bottom";case oe.PANEL_STYLE_NAV_LEFT:return"left";case oe.PANEL_STYLE_NAV_RIGHT:return"right";case oe.PANEL_STYLE_NAV_TOP:return"top"}},A=(f,v=!1)=>{switch(f.PanelStyle){case oe.PANEL_STYLE_NAV_BOTTOM:return v?"mdi:mdi-chevron-double-down":"mdi:mdi-chevron-double-up";case oe.PANEL_STYLE_NAV_LEFT:return v?"mdi:mdi-chevron-double-left":"mdi:mdi-chevron-double-right";case oe.PANEL_STYLE_NAV_RIGHT:return v?"mdi:mdi-chevron-double-right":"mdi:mdi-chevron-double-left";case oe.PANEL_STYLE_NAV_TOP:return v?"mdi:mdi-chevron-double-up":"mdi:mdi-chevron-double-down"}};return Dt(()=>{if(!r.value||!r.value.RunnerLayoutUUID||r.value.RunnerLayoutUUID==Kt)return;yt.getInstance().emit("layout_opened",{AdminLayoutUUID:r.value.AdminLayoutUUID,RegistrationUUID:m.value.RegistrationUUID})}),(f,v)=>(n(),T(h,null,[(n(!0),T(h,null,H(r.value.Panels,d=>(n(),T(h,{key:d.LayoutPanelUUID},[c(d)!==void 0?(n(),D(Jt,{key:0,permanent:!0,location:c(d),border:U(t).smAndDown.value?1:0,rail:U(t).smAndDown.value&&!E.value[d.LayoutPanelUUID],"rail-width":"30",width:U(t).smAndDown.value?"100%":256,app:""},{default:o(()=>[U(t).smAndDown.value&&!E.value[d.LayoutPanelUUID]?(n(),T("h3",{key:0,class:Te(`bg-secondary fill-height ${c(d)==="top"||c(d)==="bottom"?"px-3 text-right":"py-3 text-left"}`),style:{cursor:"pointer"},onClick:_=>E.value[d.LayoutPanelUUID]=!0},[s(ue,{icon:A(d,!1)},null,8,["icon"])],10,Bn)):(n(),T(h,{key:1},[w("h3",{class:"bg-secondary pa-3 d-flex",style:Ye(U(t).smAndDown.value?"cursor: pointer;":""),onClick:_=>E.value[d.LayoutPanelUUID]=!1},[I(y(d.Name)+" ",1),U(t).smAndDown.value?(n(),T(h,{key:0},[s(_e),s(F,{icon:A(d,!0),variant:"plain",size:"sm"},null,8,["icon"])],64)):V("",!0)],12,Gn),s(fe,{class:"bg-panel overflow-y-auto",style:{height:"calc(100vh - 116px)"}},{default:o(()=>[(n(!0),T(h,null,H(d.Items,(_,R)=>(n(),D(Ae,{key:_.LayoutItemUUID},{default:o(()=>[d.Items.length>1?(n(),D(he,{key:0,class:"font-weight-bold"},{default:o(()=>[I(y(_.Label),1)]),_:2},1024)):V("",!0),s(Ze,{accommodations:f.accommodations,convention:f.convention,extras:f.extras,forms:f.forms,interests:f.interests,"item-class":"bg-panel border-0",tickets:f.tickets,venues:f.venues,modelValue:d.Items[R],"onUpdate:modelValue":k=>d.Items[R]=k,registration:m.value,onOpenActions:i,onShowForm:u},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)],64))]),_:2},1032,["location","border","rail","width"])):V("",!0)],64))),128)),s(jt,{class:"py-0"},{default:o(()=>[s(se,null,{default:o(()=>[s(Y,null,{default:o(()=>[(n(!0),T(h,null,H(r.value.Panels,d=>{var _,R,k,O,g,C;return n(),T(h,{key:d.LayoutPanelUUID},[d.PanelStyle===U(oe).PANEL_STYLE_FLEX?(n(),D(P,{key:0,cols:((_=d.Meta&&d.Meta.cols)==null?void 0:_.toString())||!1,xs:((R=d.Meta&&d.Meta.cols_xs)==null?void 0:R.toString())||!1,sm:((k=d.Meta&&d.Meta.cols_sm)==null?void 0:k.toString())||!1,md:((O=d.Meta&&d.Meta.cols_md)==null?void 0:O.toString())||!1,lg:((g=d.Meta&&d.Meta.cols_lg)==null?void 0:g.toString())||!1,xl:((C=d.Meta&&d.Meta.cols_xl)==null?void 0:C.toString())||!1,class:"pa-0 pa-sm-2"},{default:o(()=>[s(se,{class:"bg-panel",style:Ye(U(t).smAndUp.value?"border-radius: 15px;":"")},{default:o(()=>[w("h3",null,y(d.Name),1),s(fe,{class:"bg-panel"},{default:o(()=>[(n(!0),T(h,null,H(d.Items,(L,q)=>(n(),D(Ae,{key:L.LayoutItemUUID,class:"px-0"},{default:o(()=>[d.Items.length>1?(n(),D(he,{key:0,class:"font-weight-bold"},{default:o(()=>[I(y(L.Label),1)]),_:2},1024)):V("",!0),s(Ze,{accommodations:f.accommodations,convention:f.convention,extras:f.extras,forms:f.forms,interests:f.interests,"item-class":"bg-panel border-0",tickets:f.tickets,venues:f.venues,modelValue:d.Items[q],"onUpdate:modelValue":G=>d.Items[q]=G,registration:m.value,"onUpdate:registration":v[0]||(v[0]=G=>m.value=G),onOpenActions:i,onShowForm:u},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["style"])]),_:2},1032,["cols","xs","sm","md","lg","xl"])):V("",!0)],64)}),128))]),_:1})]),_:1})]),_:1})],64))}});class Hn extends It{constructor(t){super();Z(this,"iAmConnecting",!1);Z(this,"iAmClosing",!1);Z(this,"socket");Z(this,"timer");Z(this,"router");Z(this,"wsUri");this.timer={ping:void 0,reconnect:void 0,timeout:void 0},this.router=t.router,this.wsUri=t.wsUri,this.setupSocket()}destroy(){this.closeSocket(),this.clearTimers()}clearTimers(){this.timer&&(this.timer.ping&&clearInterval(this.timer.ping),this.timer.reconnect&&clearInterval(this.timer.reconnect),this.timer.timeout&&clearTimeout(this.timer.timeout))}closeSocket(){var t;if(this.iAmClosing=!0,this.socket){try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0}this.clearTimers()}pingSocket(){if(!this.socket){this.timer&&this.timer.ping&&clearInterval(this.timer.ping);return}this.socket.send(`PING ${new Date().getTime()}`)}send(t){var a;(a=this.socket)==null||a.send(t)}JSON(t){const a=JSON.stringify(t);this.send(a)}setupSocket(){this.wsUri&&(this.iAmConnecting||(this.iAmConnecting=!0,this.socket=new WebSocket(this.wsUri),this.socket.onopen=()=>{this.iAmConnecting=!1,this.emit("open"),this.setConnectionTimeout(),this.timer.ping=setInterval(()=>this.pingSocket(),1e4)},this.socket.onclose=()=>{var t;this.iAmConnecting=!1,this.emit("close");try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0,this.iAmClosing||(this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3))},this.socket.onerror=()=>{var t;this.iAmConnecting=!1,this.emit("error");try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0,this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3)},this.socket.onmessage=t=>{var r;const a=t.data;if(a.substring(0,4)==="PING"){(r=this.socket)==null||r.send(a.replace("PING","PONG"));return}if(a.substring(0,4)==="PONG"){this.setConnectionTimeout(!0);return}if(a.substring(0,1)==="{")this.router.processJSON(a);else{const m=a.match(/(?:[^\s"]+|"[^"]*")+/g);if(!m||m.length<1)throw new Error("invalid command",{cause:{msg:a,file:"socket.ts",line:113}});const E=m.shift();this.router.processCommand(E,...m.values())}this.emit("message",a)}))}setConnectionTimeout(t=!0){t&&clearTimeout(this.timer.timeout),this.timer.timeout=setTimeout(()=>{var a;if(this.socket)try{(a=this.socket)==null||a.close()}catch{}},15e3)}}const xn=e=>new Hn(e);class et extends Object{constructor(t){super(t);Z(this,"body","");Z(this,"params");Z(this,"socket");t!=null&&t.body&&this.setBody(t.body),t!=null&&t.params?this.params=t.params:this.params=new Map,this.socket=t.socket}BindJSON(){return JSON.parse(this.body)}setBody(t){this.body=t}get(t){return this.params.get(t)||""}set(t,a){this.params.set(t,a)}}class Yn extends Object{constructor(t){super(t);Z(this,"registry",new Map);Z(this,"socket");t!=null&&t.socket&&(this.socket=t.socket)}COMMAND(t,a){this.registry.set(t,a)}JSON(t,a){this.registry.set(t,a)}processCommand(t,...a){const r=new et({socket:this.socket});a.forEach((E,i)=>{r.params.set(i,E)});const m=this.registry.get(t);m&&m(r)}processJSON(t){const a=JSON.parse(t);if(!this.registry.has(a.Command))return;const r=new et({socket:this.socket});a.Data&&r.setBody(a.Data),a.Params&&(Object.getPrototypeOf(a)!=Map.prototype&&(a.Params=new Map(Object.entries(a.Params))),Object.getPrototypeOf(a.Params)==Map.prototype&&a.Params.forEach((E,i)=>{r.params.set(i,E)}));const m=this.registry.get(a.Command);m&&m(r)}}const Mo=e=>{const l=new Yn({});l.COMMAND("VALID_AUTH",()=>{var a;(a=l.socket)==null||a.emit("authenticated")}),l.COMMAND("INVALID_AUTH",()=>{var a;(a=l.socket)==null||a.emit("auth_failed")}),l.JSON("CONVENTION_DATA",a=>{var m;const r=a.BindJSON();(m=l.socket)==null||m.emit("convention_data",r)}),l.JSON("JOINED",()=>{var a;(a=l.socket)==null||a.emit("joined")}),l.JSON("RUNNER_DATA",a=>{var m;const r=a.BindJSON();(m=l.socket)==null||m.emit("runner_data",r)}),l.JSON("RUNNER_CONNECTED",a=>{var m;const r=a.BindJSON();(m=l.socket)==null||m.emit("runner_connected",r)}),l.JSON("RUNNER_DISCONNECTED",a=>{var m;const r=a.BindJSON();(m=l.socket)==null||m.emit("runner_disconnected",r)}),l.JSON("STARTED",()=>{var a;(a=l.socket)==null||a.emit("started")});const t=xn({router:l,wsUri:e.wsUri});return l.socket=t,t},Kn=pt.getInstance(),Vo=()=>Kn;export{qt as A,ca as D,Ro as L,No as M,ho as P,Oo as U,ko as _,Ta as a,_a as b,Da as c,We as d,In as e,ut as f,vn as g,gn as h,po as i,oe as j,J as k,De as l,Vo as m,ve as n,Mo as u};
