import{d as w,X as C,Y as $,y as V,R as k,o as n,b as S,w as D,c as m,N as s,G as U,K as u,O as F,F as c,e as q,H as E}from"./index-4e57ad5f.js";import{_ as B}from"./FormField.vue_vue_type_script_setup_true_lang-ac9c1ee0.js";import{_ as H}from"./SaveButton.vue_vue_type_script_setup_true_lang-6ad914f2.js";import{u as G}from"./useGrazeAPI-66a09975.js";import{G as N}from"./userData-d733b0cf.js";import{v}from"./v4-a960c1f4.js";import{V as R}from"./VContainer-80a4b747.js";import{a as y,V as h}from"./VRow-18b65e9e.js";import{V as M}from"./VForm-f0f46e0a.js";const x={key:0,class:"my-2"},z={key:1,class:"my-2"},A={key:0,class:"my-2"},K={key:1,class:"my-2"},W=w({__name:"FormRenderer",props:C({convention:{},data:{},editable:{type:Boolean,default:!0},preview:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(l){const o=$(l,"modelValue"),p=V(),d=N(),b=G(),I=V((()=>{if(l.data!==void 0){const i=k(l.data);return o.value.Sections.forEach(e=>{e.Fields&&e.Fields.forEach(t=>{const r=l.data.Data.find(f=>f.SectionFieldUUID===t.SectionFieldUUID&&f.SectionFieldUUID==t.SectionFieldUUID);if(r)t.Value=r.Data;else{const f={ID:0,SubmissionDataUUID:v(),SubmissionID:l.data.ID,SubmissionUUID:l.data.SubmissionUUID,SectionID:e.ID,SectionUUID:e.SectionUUID,SectionFieldID:t.ID,SectionFieldUUID:t.SectionFieldUUID,Data:t.Value};i.Data.push(f)}})}),i}const a={ID:0,SubmissionUUID:v(),FormID:o.value.ID,FormUUID:o.value.FormUUID,UserID:(d==null?void 0:d.ID)||0,UserUUID:(d==null?void 0:d.UserUUID)||"",Data:[]};return a.Data=o.value.Sections.map(i=>i.Fields?i.Fields.map(e=>({ID:0,SubmissionDataUUID:v(),SubmissionID:a.ID,SubmissionUUID:a.SubmissionUUID,SectionID:i.ID,SectionUUID:i.SectionUUID,SectionFieldID:e.ID,SectionFieldUUID:e.SectionFieldUUID,Data:e.Value})):[]).flat(),a})()),_=(a,i,e)=>{const t=I.value.Data.find(r=>r.SectionUUID===a&&r.SectionFieldUUID===i);t&&(t.Data=e)},g=({callback:a})=>{var i;(i=p.value)==null||i.validate().then(e=>{e.valid?b.saveSubmission(I.value).then(t=>{t?(I.value=t,a&&a("Saved")):a&&a("Failed to process request")}).catch(()=>{a&&a("Failed to process request")}):a&&a("Errors in form detected, please review and try again.")})};return(a,i)=>(n(),S(R,null,{default:D(()=>[m(M,{ref_key:"formValidator",ref:p,onSubmit:i[0]||(i[0]=E(()=>{},["prevent"]))},{default:D(()=>[o.value.Heading?(n(),s("h2",x,U(o.value.Heading),1)):u("",!0),o.value.Description?(n(),s("p",z,U(o.value.Description),1)):u("",!0),(n(!0),s(c,null,F(o.value.Sections,e=>(n(),s(c,{key:`section_${o.value.ID}.${e.ID}`},[e.Heading?(n(),s("h3",A,U(e.Heading),1)):u("",!0),e.Description?(n(),s("p",K,U(e.Description),1)):u("",!0),e.Fields?(n(!0),s(c,{key:2},F(e.Fields,t=>(n(),s(c,{key:`field_${o.value.ID}.${e.ID}.${t.ID}`},[t.Field?(n(),S(y,{key:0},{default:D(()=>[m(h,null,{default:D(()=>[m(B,{field:t.Field,modelValue:t.Value,"onUpdate:modelValue":r=>t.Value=r,convention:a.convention,required:t.Required,"persistent-hint":!0,disabled:!a.editable,onChange:r=>_(e.SectionUUID,t.SectionFieldUUID,t.Value)},null,8,["field","modelValue","onUpdate:modelValue","convention","required","disabled","onChange"])]),_:2},1024)]),_:2},1024)):u("",!0)],64))),128)):u("",!0)],64))),128)),a.editable&&!a.preview?(n(),S(y,{key:2},{default:D(()=>[m(h,null,{default:D(()=>[m(H,{onClick:g,type:"submit"})]),_:1})]),_:1})):u("",!0),q(" "+U(I.value),1)]),_:1},512)]),_:1}))}});export{W as _};
