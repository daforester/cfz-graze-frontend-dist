import{p as Fe,n as Ne,e as z,t as j,c as Pe,G as we,v as r,H as C,x as Te,I as W,a1 as fe,a2 as Ye,r as S,a3 as Ue,K as i,L as O,M as T,$ as Re,S as K,a8 as Ee,Z as b,Q as P,R as A,O as F,_ as Le,U as w,N as H,a4 as Be,a0 as $e,w as He}from"./index-c660d075.js";import{a as Ge,F as te}from"./form-e2a93b7c.js";import{_ as xe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-b3a95fbd.js";import{m as qe,j as je,k as Je,l as Ke,n as ze,o as We,p as Qe,u as Xe,q as Ze,r as et,s as tt,t as at,v as lt,w as ot,x as nt,y as pe,z as ye,A as Oe,_ as Ce,f as it,g as st,h as ut,i as rt,d as dt}from"./VWindowItem-5b7d1d1f.js";import{e as mt,T as Ut,d as ct}from"./FormRenderer.vue_vue_type_style_index_0_lang-d6bdca87.js";import{a as me,V as J}from"./VRow-b9da7b89.js";import{V as Ae}from"./VTextField-de63d351.js";import{V as Z}from"./copyToClipboard-546ea9ea.js";import{u as _t,j as Se}from"./VContainer-64118404.js";import{v as ae}from"./v4-a960c1f4.js";import{S as vt}from"./submission-56c4c4f1.js";import{V as Ie}from"./VBtn-aed257c2.js";import{V as Tt}from"./VAvatar-20de19f4.js";import{c as At,e as ke}from"./VCard-c9e8e653.js";import{V as St}from"./VDialog-95f7bd65.js";import{s as Et}from"./sortSubmissions-ed9e4490.js";import{u as It}from"./useStoreAPI-9a6fc188.js";import{u as Dt,V as Rt}from"./VToolbar-4eac1cf1.js";import{V as ft}from"./VSpacer-9b399d04.js";import{V as ge}from"./VTable-58296cf9.js";import"./VChip-d437897b.js";import"./scopeId-fcf49611.js";import"./VCheckbox-efe05efc.js";import"./VToolbarItems-c3556583.js";import"./VList-c8145b8f.js";import"./index-71069b21.js";import"./VTextarea-175ccad1.js";import"./userData-a2284f32.js";import"./VForm-0a0d7c2c.js";var he=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(he||{});const pt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var le=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(le||{});const yt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var De=(e=>(e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(De||{});const Ot=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var f=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(f||{});const Ct=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],gt=Fe({itemsLength:{type:[Number,String],required:!0},...qe(),...je(),...Je()},"VDataTableServer"),Lt=Ne()({name:"VDataTableServer",props:gt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,y)=>!0},setup(e,y){let{emit:d,slots:a}=y;const{groupBy:n}=Ke(e),{sortBy:s,multiSort:E,mustSort:c}=ze(e),{page:I,itemsPerPage:p}=We(e),l=z(()=>parseInt(e.itemsLength,10)),{columns:m,headers:o}=Qe(e,{groupBy:n,showSelect:j(e,"showSelect"),showExpand:j(e,"showExpand")}),{items:R}=Xe(e,m),{toggleSort:_}=Ze({sortBy:s,multiSort:E,mustSort:c,page:I}),{opened:B,isGroupOpen:g,toggleGroup:x,extractRows:N}=et({groupBy:n,sortBy:s}),{pageCount:oe,setItemsPerPage:ne}=tt({page:I,itemsPerPage:p,itemsLength:l}),{flatItems:ee}=at(R,n,B),{isSelected:ie,select:se,selectAll:Y,toggleSelect:ce,someSelected:ue,allSelected:re}=lt(e,{allItems:R,currentPage:R}),{isExpanded:_e,toggleExpand:ve}=ot(e),de=z(()=>N(R.value));nt({page:I,itemsPerPage:p,sortBy:s,groupBy:n,search:j(e,"search")}),Pe("v-data-table",{toggleSort:_,sortBy:s}),we({VDataTableRows:{hideNoData:j(e,"hideNoData"),noDataText:j(e,"noDataText"),loading:j(e,"loading"),loadingText:j(e,"loadingText")}});const t=z(()=>({page:I.value,itemsPerPage:p.value,sortBy:s.value,pageCount:oe.value,toggleSort:_,setItemsPerPage:ne,someSelected:ue.value,allSelected:re.value,isSelected:ie,select:se,selectAll:Y,toggleSelect:ce,isExpanded:_e,toggleExpand:ve,isGroupOpen:g,toggleGroup:x,items:de.value,groupedItems:ee.value,columns:m.value,headers:o.value}));_t(()=>{const[U]=pe.filterProps(e),[u]=ye.filterProps(e),[v]=Oe.filterProps(e),[M]=ge.filterProps(e);return r(ge,Te({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},M),{top:()=>{var k;return(k=a.top)==null?void 0:k.call(a,t.value)},default:()=>{var k,L,G,Q;return a.default?a.default(t.value):r(C,null,[(k=a.colgroup)==null?void 0:k.call(a,t.value),r("thead",{class:"v-data-table__thead",role:"rowgroup"},[r(ye,Te(u,{sticky:e.fixedHeader}),a)]),(L=a.thead)==null?void 0:L.call(a,t.value),r("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(t.value):r(Oe,Te(v,{items:ee.value}),a)]),(G=a.tbody)==null?void 0:G.call(a,t.value),(Q=a.tfoot)==null?void 0:Q.call(a,t.value)])},bottom:()=>a.bottom?a.bottom(t.value):r(pe,U,{prepend:a["footer.prepend"]})})})}}),kt=W({__name:"EditAdminLayout",props:fe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:fe(["save"],["update:modelValue"]),setup(e,{emit:y}){const d=Ye(e,"modelValue"),a=S(Ue(e.layout)),n=S([]),s=Re(),E=({callback:l})=>{const m=()=>{l&&l("Failed to Save Layout")},o=()=>{l&&l("Layout Saved")};s.saveAdminLayout(a.value).then(R=>{R?(o(),y("save",R)):m()}).catch(()=>{m()})},c=()=>({ID:0,LayoutPanelUUID:ae(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:te.FORM_TYPE_NIL}),I=l=>()=>({ID:0,LayoutItemUUID:ae(),LayoutPanelID:l.ID,LayoutPanelUUID:l.LayoutPanelUUID,Label:"",SourceType:le.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:l.Items.length+1}),p=l=>{const m=n.value.find(o=>o.value===l.SectionFieldUUID);m&&(l.SectionFieldID=m.object.ID,l.SectionField=m.object)};return s.getConventionForms(e.layout.ConventionUUID).then(l=>{l.forEach(m=>m.Sections.forEach(o=>o.Fields&&n.value.push(...o.Fields.map(R=>{var B;return{title:`${m.Name} - ${o.Name} - ${(B=R.Field)==null?void 0:B.Name}`,value:R.SectionFieldUUID,object:R}})))),n.value.sort(mt("title"))}),(l,m)=>(i(),O(xe,{modelValue:d.value,"onUpdate:modelValue":m[3]||(m[3]=o=>d.value=o),onSave:E,title:l.title,color:"primary"},{default:T(()=>[r(Se,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[r(me,null,{default:T(()=>[r(J,{cols:"12",sm:"6"},{default:T(()=>[r(Ae,{modelValue:a.value.Name,"onUpdate:modelValue":m[0]||(m[0]=o=>a.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(J,{cols:"12",sm:"6"},{default:T(()=>[r(Z,{modelValue:a.value.Type,"onUpdate:modelValue":m[1]||(m[1]=o=>a.value.Type=o),label:"Layout Type",items:K(pt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),r(Ce,{modelValue:a.value.Panels,"onUpdate:modelValue":m[2]||(m[2]=o=>a.value.Panels=o),"new-item":c,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Ee({_:2},[b(a.value.Panels,(o,R)=>({name:`panel_${R}`,fn:T(()=>[r(Se,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[r(me,null,{default:T(()=>[r(J,{cols:"12",sm:"6"},{default:T(()=>[r(Ae,{modelValue:o.Name,"onUpdate:modelValue":_=>o.Name=_,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(J,{cols:"12",sm:"6"},{default:T(()=>[r(Z,{modelValue:o.RequiredFormType,"onUpdate:modelValue":_=>o.RequiredFormType=_,items:K(Ge),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),r(Ce,{modelValue:o.Items,"onUpdate:modelValue":_=>o.Items=_,"new-item":I(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Ee({_:2},[b(o.Items,(_,B)=>({name:`item_${B}`,fn:T(()=>[r(Se,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[r(me,null,{default:T(()=>[r(J,{cols:"12",sm:"6"},{default:T(()=>[r(Ae,{modelValue:_.Label,"onUpdate:modelValue":g=>_.Label=g,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),r(me,null,{default:T(()=>[r(J,{cols:"12",sm:"6"},{default:T(()=>[r(Z,{modelValue:_.SourceType,"onUpdate:modelValue":g=>_.SourceType=g,label:"Source Type",items:K(yt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),r(J,{cols:"12",sm:"6"},{default:T(()=>[_.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),O(Z,{key:0,modelValue:_.SectionFieldUUID,"onUpdate:modelValue":g=>_.SectionFieldUUID=g,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:g=>p(_)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):_.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),O(Z,{key:1,modelValue:_.MetaField,"onUpdate:modelValue":g=>_.MetaField=g,label:"Miscellaneous Data",items:K(Ot),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):_.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),O(Z,{key:2,modelValue:_.UserField,"onUpdate:modelValue":g=>_.UserField=g,label:"User Profile Data",items:K(Ct),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),ht={key:0,class:"accommodationList"},Vt=W({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return[];const d=JSON.parse(e.value),a=e.accommodations.filter(n=>d.includes(n.AccommodationUUID)).sort((n,s)=>{const E=d.findIndex(I=>I===n.AccommodationUUID),c=d.findIndex(I=>I===s.AccommodationUUID);return E>c?1:-1});return Ue(a)});return(d,a)=>d.value?(i(),A("ol",ht,[(i(!0),A(C,null,b(y.value,n=>(i(),A("li",{key:n.AccommodationUUID},F(n.Name),1))),128))])):P("",!0)}});const bt=Le(Vt,[["__scopeId","data-v-1ba5f67a"]]),Mt={key:0,class:"addonList"},Ft={key:0},Nt=W({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return;const d=JSON.parse(e.value),a=Object.keys(d),n=Ue(e.extras);return n.forEach(s=>{s.Options=s.Options.filter(E=>a.includes(E.OptionUUID)?(E.Choices=E.Choices.filter(c=>c.TagUUID===d[E.OptionUUID].choiceId),d[E.OptionUUID].checked):!1)}),n.filter(s=>s.Options.length>0),n});return(d,a)=>d.value?(i(),A("ul",Mt,[(i(!0),A(C,null,b(y.value,n=>(i(),A("li",{key:n.ExtraUUID},[w("strong",null,F(n.Name),1),w("ul",null,[(i(!0),A(C,null,b(n.Options,s=>(i(),A("li",{key:s.OptionUUID},[H(F(s.Name)+" ",1),s.Choices.length==1?(i(),A("small",Ft,"("+F(s.Choices[0].Title)+")",1)):P("",!0)]))),128))])]))),128))])):P("",!0)}});const Pt=Le(Nt,[["__scopeId","data-v-4ed6842b"]]),wt={key:0},Yt=W({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return;const d=JSON.parse(e.value);return Object.entries(d).filter(([,a])=>a).map(([a,n])=>e.interests.find(s=>s.InterestUUID===a)).filter(a=>a!==void 0)});return(d,a)=>d.value?(i(),A("ul",wt,[(i(!0),A(C,null,b(y.value,n=>(i(),A("li",{key:n.InterestUUID},F(n.Name),1))),128))])):P("",!0)}}),Bt=w("br",null,null,-1),$t=w("small",null,"Options:",-1),Ht=w("br",null,null,-1),Gt=w("small",null,"Addons:",-1),xt=W({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return;let d={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{d=JSON.parse(e.value),"ticket"in d&&(d.Ticket=d.ticket),"addonsChecked"in d&&(d.AddonsChecked=d.addonsChecked),"componentsChecked"in d&&(d.ComponentsChecked=d.componentsChecked)}catch{}return d.Ticket.filter(a=>{const n=e.tickets.find(s=>s.TicketUUID===a);return!(!n||n.Type!==Ut.TICKET_TYPE_TICKET)}).map(a=>{const n=e.tickets.find(E=>E.TicketUUID===a),s=Ue(n);return s.TicketComponents=n.TicketComponents.filter(E=>d.ComponentsChecked.includes(E.TicketUUID)),s.AddonTickets=n.AddonTickets.filter(E=>d.AddonsChecked.includes(E.TicketUUID)),s})});return(d,a)=>d.value?(i(!0),A(C,{key:0},b(y.value,n=>(i(),A("div",{key:n.TicketUUID},[w("strong",null,F(n.Name),1),n.TicketComponents.length>0?(i(),A(C,{key:0},[Bt,$t,H("  "),(i(!0),A(C,null,b(n.TicketComponents,s=>(i(),A(C,{key:s.TicketUUID},[w("small",null,F(s.Name),1),H("  ")],64))),128))],64)):P("",!0),n.AddonTickets.length>0?(i(),A(C,{key:1},[Ht,Gt,H("  "),(i(!0),A(C,null,b(n.AddonTickets,s=>(i(),A("small",{key:s.TicketUUID},[H("("),w("em",null,F(s.Name),1),H(")")]))),128))],64)):P("",!0)]))),128)):P("",!0)}}),qt=W({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:y}){const d=Re(),a=S(),n=S(),s=S(),E=S(),c=S(!1),I=l=>{console.log(l)},p=(l,m,o)=>{n.value=l,d.getRegistrationGroup(o.RegistrationUUID||"").then(R=>{s.value=R,a.value=m,E.value=o,c.value=!0})};return(l,m)=>(i(),A(C,null,[l.header.key=="actions"?(i(),O(Ie,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:m[0]||(m[0]=o=>I(l.item.raw))})):l.header.type==="ACCOMMODATION"&&l.accommodations.length>0?(i(),O(bt,{key:1,value:l.item.raw[l.header.key],accommodations:l.accommodations},null,8,["value","accommodations"])):l.header.type==="EXTRAS"&&l.extras.length>0?(i(),O(Pt,{key:2,value:l.item.raw[l.header.key],extras:l.extras},null,8,["value","extras"])):l.header.type==="INTERESTS"&&l.interests.length>0?(i(),O(Yt,{key:3,value:l.item.raw[l.header.key],interests:l.interests},null,8,["value","interests"])):l.header.type==="TICKET"&&l.tickets.length>0?(i(),O(xt,{key:4,value:l.item.raw[l.header.key],tickets:l.tickets},null,8,["value","tickets"])):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(i(!0),A(C,{key:5},b(l.item.raw[l.header.key],o=>(i(),A("ul",{key:o.Heading},[w("li",null,[w("strong",null,F(o.Heading)+":",1),H(" "+F(K(vt)(o.Submission.Status))+" ",1),r(Ie,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:R=>p(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):l.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),O(Tt,{key:6,class:"rounded-circle",src:l.item.raw[l.header.key],height:"32",width:"32"},null,8,["src"])):(i(),A(C,{key:7},[H(F(l.item.raw[l.header.key]),1)],64)),c.value&&E.value&&a.value?(i(),O(St,{key:8,modelValue:c.value,"onUpdate:modelValue":m[3]||(m[3]=o=>c.value=o),scrollable:!0},{default:T(()=>[r(ke,{class:"bg-red-darken-4"},{default:T(()=>[r(At,null,{default:T(()=>[r(ct,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=o=>a.value=o),admin:!0,convention:l.convention,data:E.value,editable:!0,"registration-group":s.value,onClose:m[2]||(m[2]=o=>{c.value=!1,y("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0)],64))}}),Da=W({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:y}){var de;const d=It();y("pageTitle","Registration Manager");const a=Be(),n=$e(),s=S(!0);let E=((de=a.params.convention)==null?void 0:de.toString())||"";const c=S({ID:0,ConventionUUID:ae(),OrganisationID:0,OrganisationUUID:Dt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),I=Re(),p=S({ID:0,AdminLayoutUUID:ae(),ConventionID:c.value.ID,ConventionUUID:c.value.ConventionUUID,Name:"Registration Table",Type:he.ADMIN_LAYOUT_TABLE,Panels:[]}),l=S([]),m=S([]),o=S([]),R=S(1),_=S(10),B=S([]),g=S(0),x=S(!1),N=S(""),oe=S([]),ne=S([]),ee=S([]),ie=S([]),se=S([]),Y=S(0);He(Y,t=>{t===7&&re()});const ce=()=>{l.value=[],m.value=[],o.value=[];try{I.getConventionAdminLayoutByName(c.value.ConventionUUID,"Registration Table").then(t=>{Y.value+=1,t?p.value=t:(p.value.ConventionID=c.value.ID,p.value.ConventionUUID=c.value.ConventionUUID)})}catch{p.value.ConventionID=c.value.ID,p.value.ConventionUUID=c.value.ConventionUUID}try{I.getConventionForms(c.value.ConventionUUID).then(t=>{Y.value+=1,t&&(l.value=t)})}catch{}try{I.getConventionAccommodation(c.value.ConventionUUID).then(t=>{Y.value+=1,t&&(oe.value=t)})}catch{}try{I.getConventionVenues(c.value.ConventionUUID).then(t=>{Y.value+=1,t&&(se.value=t)})}catch{}try{I.getConventionExtras(c.value.ConventionUUID).then(t=>{Y.value+=1,t&&(ne.value=t)})}catch{}try{I.getConventionInterests(c.value.ConventionUUID).then(t=>{Y.value+=1,t&&(ee.value=t)})}catch{}try{I.getConventionTickets(c.value.ConventionUUID).then(t=>{Y.value+=1,t&&(ie.value=t)})}catch{}},ue=({page:t,itemsPerPage:U,sortBy:u})=>{R.value=t,B.value=u;const v=o.value.find(L=>L.uuid==N.value),M=v==null?void 0:v.layout.Items;let k="";if(u&&M&&u.length>=1){const L=M.find(G=>G.LayoutItemUUID==u[0].key);switch(L==null?void 0:L.UserField){case f.USER_DATA_SOURCE_DISPLAY_NAME:k="user.display_name";break;case f.USER_DATA_SOURCE_HANDLE:k="user.handle";break;case f.USER_DATA_SOURCE_EMAIL:k="user.email";break}}try{const L={Offset:(t-1)*U,Order:k,Limit:U};(v==null?void 0:v.layout.RequiredFormType)===te.FORM_TYPE_ACCOMMODATION&&(L.Accommodation=!0),(v==null?void 0:v.layout.RequiredFormType)===te.FORM_TYPE_BADGE&&(L.Badge=!0),(v==null?void 0:v.layout.RequiredFormType)===te.FORM_TYPE_DEALER&&(L.Dealer=!0),I.searchConventionRegistrations(c.value.ConventionUUID,L).then(G=>{G&&(g.value=G.Total,m.value=G.Registrations,o.value.forEach(Q=>{const Ve=Q.layout;Q.items=m.value.map(h=>{const V={};return Q.headers.forEach(be=>{const D=Ve.Items.find(X=>X.LayoutItemUUID===be.key);if(D){if(D.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&D.SectionField)h.Submissions.forEach(X=>{const q=X.Data.find($=>$.SectionFieldUUID===D.SectionFieldUUID);if(q){V[D.LayoutItemUUID]=q.Data;return}});else if(D.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&D.UserField)switch(D.UserField){case f.USER_DATA_SOURCE_AVATAR:V[D.LayoutItemUUID]=d.GetProfileImageURL(h.UserUUID);break;case f.USER_DATA_SOURCE_DISPLAY_NAME:V[D.LayoutItemUUID]=h.User.DisplayName;break;case f.USER_DATA_SOURCE_EMAIL:V[D.LayoutItemUUID]=h.User.Additional.Email;break;case f.USER_DATA_SOURCE_HANDLE:V[D.LayoutItemUUID]=h.User.Handle;break;case f.USER_DATA_SOURCE_DATE_OF_BIRTH:V[D.LayoutItemUUID]=h.User.Additional.DOB;break;case f.USER_DATA_SOURCE_FIRST_NAME:V[D.LayoutItemUUID]=h.User.Additional.FirstName;break;case f.USER_DATA_SOURCE_LAST_NAME:V[D.LayoutItemUUID]=h.User.Additional.LastName;break;case f.USER_DATA_SOURCE_TELEGRAM:V[D.LayoutItemUUID]="";break}else if(D.SourceType==="LAYOUT_ITEM_SOURCE_META"&&D.MetaField){const X=h.Submissions.find(q=>{var $;return(($=q.Form)==null?void 0:$.Type)===te.FORM_TYPE_REGISTRATION});switch(D.MetaField){case De.META_DATA_SOURCE_SUBMISSION_DATE:X?V[D.LayoutItemUUID]=new Date(X.CreatedAt||"").toLocaleString():V[D.LayoutItemUUID]=new Date(h.CreatedAt||"").toLocaleString();break;case De.META_DATA_SOURCE_SUBMISSION_STATUS:Et(h.Submissions,l.value),V[D.LayoutItemUUID]=h.Submissions.map(q=>{const $=l.value.find(Me=>Me.FormUUID===q.FormUUID);return{Heading:$==null?void 0:$.Heading,Form:$,Submission:q,Registration:h}});break}}}}),V})}),s.value=!1)})}catch{}},re=()=>{p.value.Panels.forEach(t=>{t.Items.forEach(U=>{(U.SectionField==null||U.SectionField.Field==null)&&l.value.find(u=>{u.Sections.find(v=>{if(v.Fields){const M=v.Fields.find(k=>k.SectionFieldUUID===U.SectionFieldUUID);if(M)return U.SectionField=M,!0}})})})}),p.value.Panels.length>0&&(o.value=[],p.value.Panels.forEach(t=>{const U={uuid:ae(),order:t.Order,name:t.Name,headers:[],items:[],layout:t};t.Items.sort((u,v)=>u.Order>v.Order?1:u.Order==v.Order?0:-1),U.headers=t.Items.map(u=>{var v,M;return{key:u.LayoutItemUUID,title:u.Label||((M=(v=u.SectionField)==null?void 0:v.Field)==null?void 0:M.Label)||"",align:u.Align==="end"?"end":"start",sortable:ve(u),type:_e(u)}}),o.value.push(U)})),(N.value==null||N.value=="")&&o.value.length>0&&(N.value=o.value[0].uuid)};E?I.getConvention(E).then(t=>{t&&(c.value=t,ce())}).catch(()=>{n.push("/")}):n.push("/");const _e=t=>{var U,u;if(t.SourceType===le.LAYOUT_ITEM_SOURCE_META)return`${t.SourceType}.${t.MetaField}`;if(t.SourceType===le.LAYOUT_ITEM_SOURCE_FORM)return(u=(U=t.SectionField)==null?void 0:U.Field)==null?void 0:u.Type;if(t.SourceType===le.LAYOUT_ITEM_SOURCE_USER)return`${t.SourceType}.${t.UserField}`},ve=t=>[f.USER_DATA_SOURCE_DISPLAY_NAME,f.USER_DATA_SOURCE_EMAIL,f.USER_DATA_SOURCE_HANDLE,f.USER_DATA_SOURCE_DATE_OF_BIRTH,f.USER_DATA_SOURCE_FIRST_NAME,f.USER_DATA_SOURCE_LAST_NAME].includes(t.UserField);return(t,U)=>(i(),O(dt,null,{default:T(()=>[r(Rt,{color:"blue-darken-4"},{default:T(()=>[r(it,{modelValue:N.value,"onUpdate:modelValue":U[0]||(U[0]=u=>N.value=u),"show-arrows":""},{default:T(()=>[(i(!0),A(C,null,b(o.value,u=>(i(),O(st,{key:u.uuid,value:u.uuid},{default:T(()=>[H(F(u.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(ft),r(Ie,{icon:"mdi:mdi-cog-outline",onClick:U[1]||(U[1]=u=>x.value=!0)})]),_:1}),r(rt,{modelValue:N.value,"onUpdate:modelValue":U[4]||(U[4]=u=>N.value=u)},{default:T(()=>[(i(!0),A(C,null,b(o.value,u=>(i(),O(ut,{key:u.uuid,value:u.uuid},{default:T(()=>[u.uuid===N.value?(i(),O(ke,{key:0,class:"pa-2"},{default:T(()=>[r(K(Lt),{"items-per-page":_.value,"onUpdate:itemsPerPage":U[3]||(U[3]=v=>_.value=v),headers:u.headers,"items-length":g.value,items:u.items,"item-value":"LayoutItemUUID",loading:s.value,"onUpdate:options":ue},Ee({_:2},[b(u.headers,v=>({name:`item.${v.key}`,fn:T(({item:M})=>[r(qt,{header:v,item:M,accommodations:oe.value,convention:c.value,extras:ne.value,interests:ee.value,tickets:ie.value,venues:se.value,onReload:U[2]||(U[2]=k=>ue({page:R.value,itemsPerPage:_.value,sortBy:B.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):P("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),x.value?(i(),O(kt,{key:0,title:"Edit Layout",modelValue:x.value,"onUpdate:modelValue":U[5]||(U[5]=u=>x.value=u),layout:p.value,onSave:U[6]||(U[6]=u=>{x.value=!1,re()})},null,8,["modelValue","layout"])):P("",!0)]),_:1}))}});export{Da as default};
