import{p as Ye,n as Be,e as Z,t as z,c as Ge,G as He,v as s,H as p,x as Re,I as x,a1 as ge,a2 as qe,r as I,a3 as ce,K as n,L as h,M as _,$ as fe,S as X,a8 as pe,Z as F,Q as P,R as U,N as b,O as N,_ as Ve,U as w,a4 as je,a0 as Je,w as Ke}from"./index-4326309a.js";import{e as We,T as ze,d as Qe,c as Xe}from"./FormRenderer.vue_vue_type_style_index_0_lang-05bd9da9.js";import{a as Ze,F as te}from"./form-e2a93b7c.js";import{_ as xe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-075f90ed.js";import{m as et,j as tt,k as at,l as lt,n as ot,o as nt,p as it,u as st,q as ut,r as rt,s as dt,t as mt,v as Ut,w as _t,x as At,y as Me,z as Le,A as ke,_ as he,f as Tt,g as ct,h as St,i as Et,d as vt}from"./VWindowItem-caf9da4e.js";import{a as Ae,V as Q}from"./VRow-3f7c3be2.js";import{V as De}from"./VTextField-25b6e090.js";import{V as ee}from"./copyToClipboard-a3cd242d.js";import{u as It,j as Oe}from"./VContainer-c8acbbd5.js";import{v as oe}from"./v4-a960c1f4.js";import{V as Te}from"./VBtn-55d183e6.js";import{e as ye,b as Rt,V as Dt,c as be}from"./VCard-430fd411.js";import{V as Fe}from"./VDialog-24384f94.js";import{S as Ot}from"./submission-56c4c4f1.js";import{V as pt}from"./VAvatar-c4fa286b.js";import{s as ft}from"./sortSubmissions-ed9e4490.js";import{u as yt}from"./useStoreAPI-8e8692ae.js";import{u as Ct,V as gt}from"./VToolbar-271867d6.js";import{V as Mt}from"./VSpacer-42ae6a66.js";import{V as Ne}from"./VTable-4f0c8c30.js";import"./VCheckbox-30cf511e.js";import"./index-71069b21.js";import"./VList-f6198dc4.js";import"./VDivider-caedc65e.js";import"./VChip-02f613fb.js";import"./scopeId-ef486d83.js";import"./VTextarea-54d7cc78.js";import"./userData-a526871e.js";import"./VForm-23531074.js";import"./VToolbarItems-28566337.js";var Pe=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Pe||{});const Lt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ne=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(ne||{});const kt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var B=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(B||{});const ht=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var f=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(f||{});const Nt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Vt=Ye({itemsLength:{type:[Number,String],required:!0},...et(),...tt(),...at()},"VDataTableServer"),bt=Be()({name:"VDataTableServer",props:Vt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,C)=>!0},setup(e,C){let{emit:m,slots:a}=C;const{groupBy:i}=lt(e),{sortBy:u,multiSort:v,mustSort:A}=ot(e),{page:T,itemsPerPage:D}=nt(e),t=Z(()=>parseInt(e.itemsLength,10)),{columns:d,headers:o}=it(e,{groupBy:i,showSelect:z(e,"showSelect"),showExpand:z(e,"showExpand")}),{items:y}=st(e,d),{toggleSort:E}=ut({sortBy:u,multiSort:v,mustSort:A,page:T}),{opened:q,isGroupOpen:V,toggleGroup:J,extractRows:Y}=rt({groupBy:i,sortBy:u}),{pageCount:ie,setItemsPerPage:se}=dt({page:T,itemsPerPage:D,itemsLength:t}),{flatItems:ae}=mt(y,i,q),{isSelected:ue,select:re,selectAll:G,toggleSelect:Se,someSelected:de,allSelected:me}=Ut(e,{allItems:y,currentPage:y}),{isExpanded:Ee,toggleExpand:ve}=_t(e),Ue=Z(()=>Y(y.value));At({page:T,itemsPerPage:D,sortBy:u,groupBy:i,search:z(e,"search")}),Ge("v-data-table",{toggleSort:E,sortBy:u}),He({VDataTableRows:{hideNoData:z(e,"hideNoData"),noDataText:z(e,"noDataText"),loading:z(e,"loading"),loadingText:z(e,"loadingText")}});const l=Z(()=>({page:T.value,itemsPerPage:D.value,sortBy:u.value,pageCount:ie.value,toggleSort:E,setItemsPerPage:se,someSelected:de.value,allSelected:me.value,isSelected:ue,select:re,selectAll:G,toggleSelect:Se,isExpanded:Ee,toggleExpand:ve,isGroupOpen:V,toggleGroup:J,items:Ue.value,groupedItems:ae.value,columns:d.value,headers:o.value}));It(()=>{const[c]=Me.filterProps(e),[r]=Le.filterProps(e),[S]=ke.filterProps(e),[$]=Ne.filterProps(e);return s(Ne,Re({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},$),{top:()=>{var g;return(g=a.top)==null?void 0:g.call(a,l.value)},default:()=>{var g,le,M,j;return a.default?a.default(l.value):s(p,null,[(g=a.colgroup)==null?void 0:g.call(a,l.value),s("thead",{class:"v-data-table__thead",role:"rowgroup"},[s(Le,Re(r,{sticky:e.fixedHeader}),a)]),(le=a.thead)==null?void 0:le.call(a,l.value),s("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(l.value):s(ke,Re(S,{items:ae.value}),a)]),(M=a.tbody)==null?void 0:M.call(a,l.value),(j=a.tfoot)==null?void 0:j.call(a,l.value)])},bottom:()=>a.bottom?a.bottom(l.value):s(Me,c,{prepend:a["footer.prepend"]})})})}}),Ft=x({__name:"EditAdminLayout",props:ge({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:ge(["save"],["update:modelValue"]),setup(e,{emit:C}){const m=qe(e,"modelValue"),a=I(ce(e.layout)),i=I([]),u=fe(),v=({callback:t})=>{const d=()=>{t&&t("Failed to Save Layout")},o=()=>{t&&t("Layout Saved")};u.saveAdminLayout(a.value).then(y=>{y?(o(),C("save",y)):d()}).catch(()=>{d()})},A=()=>({ID:0,LayoutPanelUUID:oe(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:te.FORM_TYPE_NIL}),T=t=>()=>({ID:0,LayoutItemUUID:oe(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:ne.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),D=t=>{const d=i.value.find(o=>o.value===t.SectionFieldUUID);d&&(t.SectionFieldID=d.object.ID,t.SectionField=d.object)};return u.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(d=>d.Sections.forEach(o=>o.Fields&&i.value.push(...o.Fields.map(y=>{var q;return{title:`${d.Name} - ${o.Name} - ${(q=y.Field)==null?void 0:q.Name}`,value:y.SectionFieldUUID,object:y}})))),i.value.sort(We("title"))}),(t,d)=>(n(),h(xe,{modelValue:m.value,"onUpdate:modelValue":d[3]||(d[3]=o=>m.value=o),onSave:v,title:t.title,color:"primary"},{default:_(()=>[s(Oe,{class:"px-0 mx-0",fluid:!0},{default:_(()=>[s(Ae,null,{default:_(()=>[s(Q,{cols:"12",sm:"6"},{default:_(()=>[s(De,{modelValue:a.value.Name,"onUpdate:modelValue":d[0]||(d[0]=o=>a.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(Q,{cols:"12",sm:"6"},{default:_(()=>[s(ee,{modelValue:a.value.Type,"onUpdate:modelValue":d[1]||(d[1]=o=>a.value.Type=o),label:"Layout Type",items:X(Lt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),s(he,{modelValue:a.value.Panels,"onUpdate:modelValue":d[2]||(d[2]=o=>a.value.Panels=o),"new-item":A,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},pe({_:2},[F(a.value.Panels,(o,y)=>({name:`panel_${y}`,fn:_(()=>[s(Oe,{class:"px-0 mx-0",fluid:!0},{default:_(()=>[s(Ae,null,{default:_(()=>[s(Q,{cols:"12",sm:"6"},{default:_(()=>[s(De,{modelValue:o.Name,"onUpdate:modelValue":E=>o.Name=E,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(Q,{cols:"12",sm:"6"},{default:_(()=>[s(ee,{modelValue:o.RequiredFormType,"onUpdate:modelValue":E=>o.RequiredFormType=E,items:X(Ze),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),s(he,{modelValue:o.Items,"onUpdate:modelValue":E=>o.Items=E,"new-item":T(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},pe({_:2},[F(o.Items,(E,q)=>({name:`item_${q}`,fn:_(()=>[s(Oe,{class:"px-0 mx-0",fluid:!0},{default:_(()=>[s(Ae,null,{default:_(()=>[s(Q,{cols:"12",sm:"6"},{default:_(()=>[s(De,{modelValue:E.Label,"onUpdate:modelValue":V=>E.Label=V,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),s(Ae,null,{default:_(()=>[s(Q,{cols:"12",sm:"6"},{default:_(()=>[s(ee,{modelValue:E.SourceType,"onUpdate:modelValue":V=>E.SourceType=V,label:"Source Type",items:X(kt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(Q,{cols:"12",sm:"6"},{default:_(()=>[E.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),h(ee,{key:0,modelValue:E.SectionFieldUUID,"onUpdate:modelValue":V=>E.SectionFieldUUID=V,label:"Form Data",items:i.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:V=>D(E)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):E.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),h(ee,{key:1,modelValue:E.MetaField,"onUpdate:modelValue":V=>E.MetaField=V,label:"Miscellaneous Data",items:X(ht),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):E.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),h(ee,{key:2,modelValue:E.UserField,"onUpdate:modelValue":V=>E.UserField=V,label:"User Profile Data",items:X(Nt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Pt={key:1,class:"accommodationList"},wt=x({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},registration:{},value:{default:""},venues:{}},setup(e){const C=I(!1),m=Z(()=>{if(!e.value)return[];const a=JSON.parse(e.value),i=e.accommodations.filter(u=>a.includes(u.AccommodationUUID)).sort((u,v)=>{const A=a.findIndex(D=>D===u.AccommodationUUID),T=a.findIndex(D=>D===v.AccommodationUUID);return A>T?1:-1});return ce(i)});return(a,i)=>{var u,v,A;return n(),U(p,null,[a.registration.Allocation?(n(),U(p,{key:0},[b(N((u=a.accommodations.find(T=>T.AccommodationUUID))==null?void 0:u.Name)+" "+N((A=(v=a.venues)==null?void 0:v.map(T=>T.Rooms.find(D=>D.RoomUUID===a.registration.Allocation.RoomUUID)).filter(T=>T!=null)[0])==null?void 0:A.Name),1)],64)):P("",!0),a.value?(n(),U("ol",Pt,[(n(!0),U(p,null,F(m.value,T=>(n(),U("li",{key:T.AccommodationUUID},N(T.Name),1))),128))])):P("",!0),s(Te,{onClick:i[0]||(i[0]=T=>C.value=!0),variant:"flat",color:"success"},{default:_(()=>[b("Assign Accommodation")]),_:1}),s(Fe,{modelValue:C.value,"onUpdate:modelValue":i[1]||(i[1]=T=>C.value=T)},{default:_(()=>[s(ye,null,{default:_(()=>[s(Rt,null,{default:_(()=>[s(Dt,null,{default:_(()=>[b("Accommodation Allocation")]),_:1})]),_:1}),s(be,null,{default:_(()=>[b(" WIP ")]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const $t=Ve(wt,[["__scopeId","data-v-a687237f"]]),Yt={key:0,class:"addonList"},Bt={key:0},Gt={key:0},Ht=x({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const C=Z(()=>{if(!e.value)return;const m=JSON.parse(e.value),a=Object.keys(m),i=ce(e.extras);return i.forEach(u=>{u.Options=u.Options.filter(v=>a.includes(v.OptionUUID)?(v.Choices=v.Choices.filter(A=>A.TagUUID===m[v.OptionUUID].choiceId),m[v.OptionUUID].checked):!1)}),i.filter(u=>u.Options.length>0),i});return(m,a)=>m.value?(n(),U("ul",Yt,[(n(!0),U(p,null,F(C.value,i=>(n(),U(p,{key:i.ExtraUUID},[i.Options.length?(n(),U("li",Bt,[w("strong",null,N(i.Name),1),w("ul",null,[(n(!0),U(p,null,F(i.Options,u=>(n(),U("li",{key:u.OptionUUID},[b(N(u.Name)+" ",1),u.Choices.length==1?(n(),U("small",Gt,"("+N(u.Choices[0].Title)+")",1)):P("",!0)]))),128))])])):P("",!0)],64))),128))])):P("",!0)}});const qt=Ve(Ht,[["__scopeId","data-v-002a6d6d"]]),jt={key:0},Jt=x({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const C=Z(()=>{if(!e.value)return;const m=JSON.parse(e.value);return Object.entries(m).filter(([,a])=>a).map(([a,i])=>e.interests.find(u=>u.InterestUUID===a)).filter(a=>a!==void 0)});return(m,a)=>m.value?(n(),U("ul",jt,[(n(!0),U(p,null,F(C.value,i=>(n(),U("li",{key:i.InterestUUID},N(i.Name),1))),128))])):P("",!0)}}),Kt=w("br",null,null,-1),Wt=w("small",null,"Options:",-1),zt=w("br",null,null,-1),Qt=w("small",null,"Addons:",-1),Xt=x({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const C=Z(()=>{if(!e.value)return;let m={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{m=JSON.parse(e.value),"ticket"in m&&(m.Ticket=m.ticket),"addonsChecked"in m&&(m.AddonsChecked=m.addonsChecked),"componentsChecked"in m&&(m.ComponentsChecked=m.componentsChecked)}catch{}return m.Ticket.filter(a=>{const i=e.tickets.find(u=>u.TicketUUID===a);return!(!i||i.Type!==ze.TICKET_TYPE_TICKET)}).map(a=>{const i=e.tickets.find(v=>v.TicketUUID===a),u=ce(i);return u.TicketComponents=i.TicketComponents.filter(v=>m.ComponentsChecked.includes(v.TicketUUID)),u.AddonTickets=i.AddonTickets.filter(v=>m.AddonsChecked.includes(v.TicketUUID)),u})});return(m,a)=>m.value?(n(!0),U(p,{key:0},F(C.value,i=>(n(),U("div",{key:i.TicketUUID},[w("strong",null,N(i.Name),1),i.TicketComponents.length>0?(n(),U(p,{key:0},[Kt,Wt,b("  "),(n(!0),U(p,null,F(i.TicketComponents,u=>(n(),U(p,{key:u.TicketUUID},[w("small",null,N(u.Name),1),b("  ")],64))),128))],64)):P("",!0),i.AddonTickets.length>0?(n(),U(p,{key:1},[zt,Qt,b("  "),(n(!0),U(p,null,F(i.AddonTickets,u=>(n(),U("small",{key:u.TicketUUID},[b("("),w("em",null,N(u.Name),1),b(")")]))),128))],64)):P("",!0)]))),128)):P("",!0)}}),Zt={key:0},xt={key:0},ea=w("strong",null,"Total:",-1),ta=x({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:C}){const m=fe(),a=I(),i=I(),u=I(),v=I(),A=I(!1),T=t=>{console.log(t)},D=(t,d,o)=>{i.value=t,m.getRegistrationGroup(o.RegistrationUUID||"").then(y=>{u.value=y,a.value=d,v.value=o,A.value=!0})};return(t,d)=>(n(),U(p,null,[t.header.key=="actions"?(n(),h(Te,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:d[0]||(d[0]=o=>T(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(n(),h($t,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(n(),h(qt,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(n(),h(Jt,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(n(),h(Xt,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(n(!0),U(p,{key:5},F(t.item.raw[t.header.key],o=>(n(),U("ul",{key:o.Heading},[w("li",null,[w("strong",null,N(o.Heading)+":",1),b(" "+N(X(Ot)(o.Submission.Status))+" ",1),s(Te,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:y=>D(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(n(),h(pt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(n(),U(p,{key:7},[t.item.raw[t.header.key].length===1?(n(),U("em",Zt," Not in a group ")):(n(),U(p,{key:1},[w("ul",null,[(n(!0),U(p,null,F(t.item.raw[t.header.key],o=>(n(),U("li",{key:o.UUID,class:"ml-0"},[b(N(o.Name)+" ",1),o.IsLeader?(n(),U("strong",xt,"(Leader)")):P("",!0)]))),128))]),ea,b(" "+N(t.item.raw[t.header.key].length),1)],64))],64)):(n(),U(p,{key:8},[b(N(t.item.raw[t.header.key]),1)],64)),A.value&&v.value&&a.value?(n(),h(Fe,{key:9,modelValue:A.value,"onUpdate:modelValue":d[3]||(d[3]=o=>A.value=o),scrollable:!0},{default:_(()=>[s(ye,{class:"bg-red-darken-4"},{default:_(()=>[s(be,null,{default:_(()=>[s(Qe,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=o=>a.value=o),admin:!0,convention:t.convention,data:v.value,editable:!0,"registration-group":u.value,onClose:d[2]||(d[2]=o=>{A.value=!1,C("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0)],64))}}),ha=x({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:C}){var Ue;const m=yt();C("pageTitle","Registration Manager");const a=je(),i=Je(),u=I(!0);let v=((Ue=a.params.convention)==null?void 0:Ue.toString())||"";const A=I({ID:0,ConventionUUID:oe(),OrganisationID:0,OrganisationUUID:Ct,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),T=fe(),D=I({ID:0,AdminLayoutUUID:oe(),ConventionID:A.value.ID,ConventionUUID:A.value.ConventionUUID,Name:"Registration Table",Type:Pe.ADMIN_LAYOUT_TABLE,Panels:[]}),t=I([]),d=I([]),o=I([]),y=I(1),E=I(10),q=I([]),V=I(0),J=I(!1),Y=I(""),ie=I([]),se=I([]),ae=I([]),ue=I([]),re=I([]),G=I(0);Ke(G,l=>{l===7&&me()});const Se=()=>{t.value=[],d.value=[],o.value=[];try{T.getConventionAdminLayoutByName(A.value.ConventionUUID,"Registration Table").then(l=>{G.value+=1,l?D.value=l:(D.value.ConventionID=A.value.ID,D.value.ConventionUUID=A.value.ConventionUUID)})}catch{D.value.ConventionID=A.value.ID,D.value.ConventionUUID=A.value.ConventionUUID}try{T.getConventionForms(A.value.ConventionUUID).then(l=>{G.value+=1,l&&(t.value=l)})}catch{}try{T.getConventionAccommodation(A.value.ConventionUUID).then(l=>{G.value+=1,l&&(ie.value=l)})}catch{}try{T.getConventionVenues(A.value.ConventionUUID).then(l=>{G.value+=1,l&&(re.value=l)})}catch{}try{T.getConventionExtras(A.value.ConventionUUID).then(l=>{G.value+=1,l&&(se.value=l)})}catch{}try{T.getConventionInterests(A.value.ConventionUUID).then(l=>{G.value+=1,l&&(ae.value=l)})}catch{}try{T.getConventionTickets(A.value.ConventionUUID).then(l=>{G.value+=1,l&&(ue.value=l)})}catch{}},de=({page:l,itemsPerPage:c,sortBy:r})=>{y.value=l,q.value=r;const S=o.value.find(M=>M.uuid==Y.value),$=S==null?void 0:S.layout.Items;let g="",le="";if(r&&$&&r.length>=1){const M=$.find(j=>j.LayoutItemUUID==r[0].key);switch(le=r[0].order,M==null?void 0:M.MetaField){case B.META_DATA_SOURCE_REGISTRATION_REFERENCE:g="reference";break;case B.META_DATA_SOURCE_SUBMISSION_DATE:g="created";break;case B.META_DATA_SOURCE_SUBMISSION_STATUS:g="submission.status";break}switch(M==null?void 0:M.UserField){case f.USER_DATA_SOURCE_DISPLAY_NAME:g="user.display_name";break;case f.USER_DATA_SOURCE_EMAIL:g="user.email";break;case f.USER_DATA_SOURCE_FIRST_NAME:g="user.firstname";break;case f.USER_DATA_SOURCE_HANDLE:g="user.handle";break;case f.USER_DATA_SOURCE_LAST_NAME:g="user.lastname";break}}try{const M={Direction:le,Limit:c,Offset:(l-1)*c,Order:g};(S==null?void 0:S.layout.RequiredFormType)===te.FORM_TYPE_ACCOMMODATION&&(M.Accommodation=!0),(S==null?void 0:S.layout.RequiredFormType)===te.FORM_TYPE_BADGE&&(M.Badge=!0),(S==null?void 0:S.layout.RequiredFormType)===te.FORM_TYPE_DEALER&&(M.Dealer=!0),(S==null?void 0:S.layout.RequiredFormType)===te.FORM_TYPE_REGISTRATION&&(M.Registration=!0),T.searchConventionRegistrations(A.value.ConventionUUID,M).then(j=>{j&&(V.value=j.Total,d.value=j.Registrations,o.value.forEach(Ie=>{const we=Ie.layout;Ie.items=d.value.map(L=>{const k={};return Ie.headers.forEach(Ce=>{const R=we.Items.find(K=>K.LayoutItemUUID===Ce.key);if(R){if(R.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&R.SectionField)L.Submissions.forEach(K=>{const H=K.Data.find(_e=>_e.SectionFieldUUID===R.SectionFieldUUID);if(H){Ce.type===Xe.ACCOMMODATION?k[R.LayoutItemUUID]={Data:H.Data,Registration:L}:k[R.LayoutItemUUID]=H.Data;return}});else if(R.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&R.UserField)switch(R.UserField){case f.USER_DATA_SOURCE_AVATAR:k[R.LayoutItemUUID]=m.GetProfileImageURL(L.UserUUID);break;case f.USER_DATA_SOURCE_DISPLAY_NAME:k[R.LayoutItemUUID]=L.User.DisplayName;break;case f.USER_DATA_SOURCE_EMAIL:k[R.LayoutItemUUID]=L.User.Additional.Email;break;case f.USER_DATA_SOURCE_HANDLE:k[R.LayoutItemUUID]=L.User.Handle;break;case f.USER_DATA_SOURCE_DATE_OF_BIRTH:k[R.LayoutItemUUID]=L.User.Additional.DOB;break;case f.USER_DATA_SOURCE_FIRST_NAME:k[R.LayoutItemUUID]=L.User.Additional.FirstName;break;case f.USER_DATA_SOURCE_LAST_NAME:k[R.LayoutItemUUID]=L.User.Additional.LastName;break;case f.USER_DATA_SOURCE_TELEGRAM:k[R.LayoutItemUUID]="";break}else if(R.SourceType==="LAYOUT_ITEM_SOURCE_META"&&R.MetaField){const K=[];let H;const _e=L.Submissions.find(O=>{var W;return((W=O.Form)==null?void 0:W.Type)===te.FORM_TYPE_REGISTRATION});switch(R.MetaField){case B.META_DATA_SOURCE_REGISTRATION_GROUP:L.Leader?H=L:H=L.Primary,K.push({Name:H.User.DisplayName,UUID:H.UserUUID,IsLeader:!0,Reference:H.Reference}),K.push(...H.Members.map(O=>({Name:O.User.DisplayName,UUID:O.UserUUID,IsLeader:!1,Reference:O.Reference}))),k[R.LayoutItemUUID]=K;break;case B.META_DATA_SOURCE_REGISTRATION_REFERENCE:k[R.LayoutItemUUID]=L.Reference;break;case B.META_DATA_SOURCE_SUBMISSION_DATE:if(_e){const O=new Date(_e.CreatedAt||"");k[R.LayoutItemUUID]=`${O.getFullYear()}-${O.getMonth().toString().padStart(2,"0")}-${O.getDate().toString().padStart(2,"0")} ${O.getHours().toString().padStart(2,"0")}:${O.getMinutes().toString().padStart(2,"0")}:${O.getSeconds()}`}else{const O=new Date(L.CreatedAt||"");k[R.LayoutItemUUID]=`${O.getFullYear()}-${O.getMonth().toString().padStart(2,"0")}-${O.getDate().toString().padStart(2,"0")} ${O.getHours().toString().padStart(2,"0")}:${O.getMinutes().toString().padStart(2,"0")}:${O.getSeconds()}`}break;case B.META_DATA_SOURCE_SUBMISSION_STATUS:ft(L.Submissions,t.value),k[R.LayoutItemUUID]=L.Submissions.map(O=>{const W=t.value.find($e=>$e.FormUUID===O.FormUUID);return{Heading:W==null?void 0:W.Heading,Form:W,Submission:O,Registration:L}});break}}}}),k})}),u.value=!1)})}catch{}},me=()=>{D.value.Panels.forEach(l=>{l.Items.forEach(c=>{(c.SectionField==null||c.SectionField.Field==null)&&t.value.find(r=>{r.Sections.find(S=>{if(S.Fields){const $=S.Fields.find(g=>g.SectionFieldUUID===c.SectionFieldUUID);if($)return c.SectionField=$,!0}})})})}),D.value.Panels.length>0&&(o.value=[],D.value.Panels.forEach(l=>{const c={uuid:oe(),order:l.Order,name:l.Name,headers:[],items:[],layout:l};l.Items.sort((r,S)=>r.Order>S.Order?1:r.Order==S.Order?0:-1),c.headers=l.Items.map(r=>{var S,$;return{key:r.LayoutItemUUID,title:r.Label||(($=(S=r.SectionField)==null?void 0:S.Field)==null?void 0:$.Label)||"",align:r.Align==="end"?"end":"start",sortable:ve(r),type:Ee(r)}}),o.value.push(c)})),(Y.value==null||Y.value=="")&&o.value.length>0&&(Y.value=o.value[0].uuid)};v?T.getConvention(v).then(l=>{l&&(A.value=l,Se())}).catch(()=>{i.push("/")}):i.push("/");const Ee=l=>{var c,r;if(l.SourceType===ne.LAYOUT_ITEM_SOURCE_META)return`${l.SourceType}.${l.MetaField}`;if(l.SourceType===ne.LAYOUT_ITEM_SOURCE_FORM)return(r=(c=l.SectionField)==null?void 0:c.Field)==null?void 0:r.Type;if(l.SourceType===ne.LAYOUT_ITEM_SOURCE_USER)return`${l.SourceType}.${l.UserField}`},ve=l=>{const c=[B.META_DATA_SOURCE_REGISTRATION_REFERENCE,B.META_DATA_SOURCE_SUBMISSION_DATE,B.META_DATA_SOURCE_SUBMISSION_STATUS],r=[f.USER_DATA_SOURCE_DISPLAY_NAME,f.USER_DATA_SOURCE_EMAIL,f.USER_DATA_SOURCE_HANDLE,f.USER_DATA_SOURCE_DATE_OF_BIRTH,f.USER_DATA_SOURCE_FIRST_NAME,f.USER_DATA_SOURCE_LAST_NAME];return c.includes(l.MetaField)||r.includes(l.UserField)};return(l,c)=>(n(),h(vt,null,{default:_(()=>[s(gt,{color:"blue-darken-4"},{default:_(()=>[s(Tt,{modelValue:Y.value,"onUpdate:modelValue":c[0]||(c[0]=r=>Y.value=r),"show-arrows":""},{default:_(()=>[(n(!0),U(p,null,F(o.value,r=>(n(),h(ct,{key:r.uuid,value:r.uuid},{default:_(()=>[b(N(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(Mt),s(Te,{icon:"mdi:mdi-cog-outline",onClick:c[1]||(c[1]=r=>J.value=!0)})]),_:1}),s(Et,{modelValue:Y.value,"onUpdate:modelValue":c[4]||(c[4]=r=>Y.value=r),disabled:!0},{default:_(()=>[(n(!0),U(p,null,F(o.value,r=>(n(),h(St,{key:r.uuid,value:r.uuid},{default:_(()=>[r.uuid===Y.value?(n(),h(ye,{key:0,class:"pa-2"},{default:_(()=>[s(X(bt),{"items-per-page":E.value,"onUpdate:itemsPerPage":c[3]||(c[3]=S=>E.value=S),headers:r.headers,"items-length":V.value,items:r.items,"item-value":"LayoutItemUUID",loading:u.value,"onUpdate:options":de},pe({_:2},[F(r.headers,S=>({name:`item.${S.key}`,fn:_(({item:$})=>[s(ta,{header:S,item:$,accommodations:ie.value,convention:A.value,extras:se.value,interests:ae.value,tickets:ue.value,venues:re.value,onReload:c[2]||(c[2]=g=>de({page:y.value,itemsPerPage:E.value,sortBy:q.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):P("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),J.value?(n(),h(Ft,{key:0,title:"Edit Layout",modelValue:J.value,"onUpdate:modelValue":c[5]||(c[5]=r=>J.value=r),layout:D.value,onSave:c[6]||(c[6]=r=>{J.value=!1,me()})},null,8,["modelValue","layout"])):P("",!0)]),_:1}))}});export{ha as default};
