import{i as R,M as F,N as P,r as m,k as Z,n as g,q as w,v as a,y as k,x as f,f as e,C as I,A as b,P as H,_ as $,U as J,l as X,W as ee,B as N,Q as ae,F as G}from"./index-QFnvUixi.js";import{s as L}from"./index-OKsbKlsK.js";import{V as te,a as M}from"./scopeId-RaTpg9w0.js";import{_ as oe}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-bx4vERZk.js";import{e as A,c as le,V as ne,a as ie,b as se,d as re}from"./VCard-UBndLqMu.js";import{V as ue,a as me}from"./VToolbar-nqHzU5Q1.js";import{V as de}from"./VToolbarItems-Y-sDgHUm.js";import{V as U}from"./VBtn-8g6jCFa3.js";import{V as fe,a as B}from"./VContainer-A7hlFbOe.js";import{V as C,a as p}from"./VRow-4hZPCLCj.js";import{V as q}from"./VAvatar-VDw91Fpp.js";import{V as S}from"./VTextField-zmwrwrSh.js";import{V as E}from"./VForm-eKSZXNkZ.js";import{V as ge}from"./VFileInput-4uFVwGss.js";import{G as z}from"./userData-haNlX5Yt.js";import{V as pe}from"./VDialog-bqt7TMed.js";import{C as ce}from"./canEditOrganisation-ZPJwatCb.js";import{G as ve}from"./group-7fhbY6WJ.js";import{C as Ve}from"./canDo-yWCfI_4r.js";import{v as _e}from"./v4-yQnnJER4.js";import"./createSimpleFunctional-TCG58VNE.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-XwgmqhHQ.js";import"./forwardRefs-579yJ9E6.js";import"./VChip-LAsDL85F.js";import"./nil-rxyd0N8M.js";const Ie=(c,v)=>{if(c===void 0)return!1;const o=Ve(c,ve.GROUP_TYPE_ORGANISATION,v.OrganisationUUID);return o.EditOrganisation||o.EditConvention||o.ManageViews||o.ViewRegistration||o.EditRegistration||o.ManageUsers},Ce=R({__name:"EditOrganisation",props:{modelValue:{required:!0},modelModifiers:{}},emits:F(["change","close","delete"],["update:modelValue"]),setup(c,{emit:v}){const o=v,i=H(),y=M(),V=P(c,"modelValue"),s=m(Z(V.value)),_=m(`${y.GetOrganisationLogoURL(s.value.OrganisationUUID)}?${new Date().getTime()}`),O=m(),l=m(),n=m(!1),D=m(""),u=m(),x=async()=>{var r;const t=new FormData((r=l.value)==null?void 0:r.$el);if(t.get("Image")&&t.get("Image").size>0)return t.set("OrganisationUUID",s.value.OrganisationUUID),await y.SaveOrganisationLogo(t)},Y=()=>{var t;x(),(t=u.value)==null||t.validate().then(r=>{r&&i.saveOrganisation(s.value).then(d=>{d&&(V.value=d,o("change"),o("close"))})})},h=m({available:t=>!0,min:t=>t.length>=4||"Minimum 4 characters",required:t=>!!t||"Required.",valid:t=>!/[^0-9a-z_-]/.test(t)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),T=()=>{n.value=!1},j=()=>{n.value=!0},K=m(`
<p class="mb-2">
  Are you sure you wish to delete this organisation? All data relating to it will be
  removed including all conventions their respective registrations and payment information.
  This action can not be undone.
</p>
<p class="mb-2">
  We are talking some Thanos level shit right here, if you proceed a team of super-powered
  beings with Daddy issues will hunt you down through time, space and a social media
  platform formerly known as twitter.
</p>
<p>
  To confirm type "I CLICK MY FINGERS" in the box below.
</p>
`),W=t=>{D.value="",i.deleteOrganisation(s.value.OrganisationUUID).then(r=>{r?t&&t("Organisation Deleted"):t&&t("Failed to Delete Organisation"),setTimeout(()=>{T(),o("delete")},2e3)}).catch(()=>{t&&(t("Failed to Delete Organisation"),setTimeout(T,2e3))})},Q=()=>{_.value=URL.createObjectURL(O.value.files[0])};return(t,r)=>(g(),w(E,{"fast-fail":"",ref_key:"form",ref:u},{default:a(()=>[e(A,null,{default:a(()=>[e(ue,{dark:"",color:"primary"},{default:a(()=>[e(me,null,{default:a(()=>[f(k(s.value.Name),1)]),_:1}),e(te),e(de,null,{default:a(()=>[e(U,{variant:"text",onClick:j},{default:a(()=>[f(" Delete ")]),_:1}),e(U,{variant:"text",onClick:Y},{default:a(()=>[f(" Save ")]),_:1}),e(U,{icon:"",dark:"",onClick:r[0]||(r[0]=d=>o("close"))},{default:a(()=>[e(fe,null,{default:a(()=>[f("mdi:mdi-close")]),_:1})]),_:1})]),_:1})]),_:1}),e(le,null,{default:a(()=>[e(B,{fluid:!0},{default:a(()=>[e(C,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(q,{class:"imgLogo mx-auto",src:_.value||""},null,8,["src"])]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(S,{label:I(L).formLabelName,type:"text",variant:"outlined",modelValue:s.value.Name,"onUpdate:modelValue":r[1]||(r[1]=d=>s.value.Name=d)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(S,{label:I(L).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[h.value.available,h.value.min,h.value.required,h.value.valid],type:"text",variant:"outlined",modelValue:s.value.Slug,"onUpdate:modelValue":r[2]||(r[2]=d=>s.value.Slug=d)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(p,null,{default:a(()=>[e(E,{ref_key:"organisationImageForm",ref:l,enctype:"multipart/form-data"},{default:a(()=>[e(ge,{label:I(L).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:O,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:Q},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n.value?(g(),w(oe,{key:0,modelValue:n.value,"onUpdate:modelValue":r[3]||(r[3]=d=>n.value=d),title:`Delete ${s.value.Name}`,subtitle:"Your will be done",message:K.value,"confirmation-text":"I CLICK MY FINGERS",onDelete:W},null,8,["modelValue","title","message"])):b("",!0)]),_:1},512))}}),Oe=$(Ce,[["__scopeId","data-v-db4825de"]]),De=R({__name:"OrganisationCard",props:{modelValue:{required:!0},modelModifiers:{}},emits:F(["delete"],["update:modelValue"]),setup(c,{emit:v}){const o=z();(!o||!o.Groups.find(l=>l.Permission.EditConvention)&&!o.Groups.find(l=>l.Permission.EditOrganisation)&&!o.Groups.find(l=>l.Permission.EditRegistration)&&!o.Groups.find(l=>l.Permission.ManageViews)&&!o.Groups.find(l=>l.Permission.ViewRegistration))&&J().push("/");const i=P(c,"modelValue"),y=v,V=M(),s=m(!1),_=m(""),O=()=>{_.value=`${V.GetOrganisationLogoURL(i.value.OrganisationUUID)}?${new Date().getTime()}`};return O(),(l,n)=>{const D=X("RouterLink");return g(),w(A,null,{default:a(()=>[e(ne,{class:"flex-1-1 align-content-start"},{default:a(()=>[e(q,{class:"imgLogo mx-auto",src:_.value||""},null,8,["src"]),e(ie,null,{default:a(()=>[f(k(i.value.Name),1)]),_:1}),e(se,null,{default:a(()=>[f(k(i.value.Slug),1)]),_:1})]),_:1}),e(re,null,{default:a(()=>[e(C,{"no-gutters":""},{default:a(()=>[e(p,{class:"ma-1"},{default:a(()=>[e(U,{variant:"tonal",color:"primary",onClick:n[0]||(n[0]=u=>s.value=!0),width:"100%"},{default:a(()=>[f("Edit")]),_:1})]),_:1}),b("",!0),e(p,{class:"ma-1"},{default:a(()=>[e(D,{to:`/admin/organisations/${i.value.Slug?i.value.Slug:i.value.OrganisationUUID}`},{default:a(()=>[e(U,{variant:"tonal",color:"green",width:"100%"},{default:a(()=>[f("Convention Manager")]),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),e(pe,{modelValue:s.value,"onUpdate:modelValue":n[4]||(n[4]=u=>s.value=u),scrollable:!0,fullscreen:!0,persistent:!0},{default:a(()=>[e(Oe,{onClose:n[1]||(n[1]=u=>s.value=!1),modelValue:i.value,"onUpdate:modelValue":n[2]||(n[2]=u=>i.value=u),onDelete:n[3]||(n[3]=u=>{s.value=!1,y("delete")}),onChange:O},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}}),we=$(De,[["__scopeId","data-v-085ee91f"]]),Qe=R({__name:"OrganisationsView",emits:["pageTitle"],setup(c,{emit:v}){const o=ee.getInstance(),i=m([]);v("pageTitle","Organisations");const V=z(),s=()=>{const l={ID:0,OrganisationUUID:_e(),Name:"New Organisation",Slug:"",Logo:""};o.saveOrganisation(l).then(n=>{n&&i.value.push(n)})},_=l=>{i.value.splice(l,1)};return(()=>{o.getOrganisations().then(l=>{i.value=l})})(),(l,n)=>(g(),w(B,null,{default:a(()=>[e(C,null,{default:a(()=>[(g(!0),N(G,null,ae(i.value,(D,u)=>(g(),N(G,{key:D.ID},[I(Ie)(I(V),D)?(g(),w(p,{key:0,cols:"12",sm:"6",md:"4",lg:"3",class:"d-flex flex-column"},{default:a(()=>[e(we,{modelValue:i.value[u],"onUpdate:modelValue":x=>i.value[u]=x,class:"elevation-5 flex-1-0 d-flex flex-column",onDelete:x=>_(u)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024)):b("",!0)],64))),128))]),_:1}),e(C,null,{default:a(()=>[I(ce)(I(V))?(g(),w(p,{key:0,class:"text-right"},{default:a(()=>[e(U,{color:"primary",onClick:s},{default:a(()=>[f("New")]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}))}});export{Qe as default};
