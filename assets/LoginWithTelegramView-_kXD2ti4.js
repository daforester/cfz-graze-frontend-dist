import{i as p,r as v,o as E,B as c,n as i,W as C,q as k,v as l,F as g,f as r,D as o,A as h,U as L,l as w,x as D}from"./index-rEwU1qrG.js";import{G as R}from"./userData-Am5wR1du.js";import{S as V}from"./setupLogin-CXUrFui3.js";import{E as B}from"./emailFormVariant-1EY2p0cn.js";import{a as U}from"./VContainer-6sSsudAE.js";import{V as x,a as y,c as I,e as M}from"./VCard-ogrsCsz7.js";import"./createSimpleFunctional-Cfo6qXCZ.js";import"./VAvatar-Tp-5SbAV.js";const T=p({__name:"TelegramLoginForm",props:{mode:{},telegramLogin:{},redirectUrl:{default:""},requestAccess:{default:""},size:{default:""},userpic:{type:Boolean,default:!1},radius:{default:""}},emits:["callback"],setup(t,{emit:d}){const f=d,n=v(),a=e=>{f("callback",e)};return E(()=>{const e=document.createElement("script");e.async=!0,e.src="https://telegram.org/js/telegram-widget.js?22",e.setAttribute("data-size",t.size||""),e.setAttribute("data-userpic",t.userpic?"true":"false"),e.setAttribute("data-telegram-login",t.telegramLogin),e.setAttribute("data-request-access",t.requestAccess||""),t.radius&&e.setAttribute("data-radius",t.radius||""),t.mode==="callback"?(window.onTelegramAuth=a,e.setAttribute("data-onauth","window.onTelegramAuth(user)")):e.setAttribute("data-auth-url",t.redirectUrl||""),n.value.appendChild(e)}),(e,m)=>(i(),c("div",{ref_key:"telegram",ref:n},null,512))}}),N={class:"form-group row"},O={class:"col"},q=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),G=o("h2",null,"Telegram",-1),z={class:"form-group row"},F={class:"col"},H=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),X=p({__name:"LoginWithTelegramView",props:{variant:{default:()=>B.COMBINED}},emits:["pageTitle"],setup(t,{emit:d}){d("pageTitle","Telegram Login");const n=L(),a=v(new Map),e=R(),m=C.getInstance();m.getLoginURLs(location.href.substring(0,location.href.length-9)).then(s=>{a.value=s});const A=s=>{m.oAuthLogin("telegram","","","",s).then(({created:_,tokens:u,user:b})=>{V(u,b,n,_)})};return e&&t.variant!=="ADD_CREDENTIAL"&&(Date.now()-new Date(e.CreatedAt||"").getTime()>2e4?n.push("/"):n.push("/profile")),(s,_)=>{const u=w("router-link");return i(),c("div",null,[s.variant=="ADD_CREDENTIAL"?(i(),k(U,{key:0,style:{"max-width":"550px"}},{default:l(()=>[r(M,null,{default:l(()=>[r(x,{class:"text-center"},{default:l(()=>[r(y,null,{default:l(()=>[D("Add a Telegram Account")]),_:1})]),_:1}),r(I,{class:"text-center"},{default:l(()=>[a.value.size>0?(i(),c(g,{key:0},[r(T,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:A,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",N,[o("div",O,[r(u,{to:"/"},{default:l(()=>[q]),_:1})])])],64)):h("",!0)]),_:1})]),_:1})]),_:1})):(i(),c(g,{key:1},[G,a.value.size>0?(i(),c(g,{key:0},[r(T,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:A,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",z,[o("div",F,[r(u,{to:"/"},{default:l(()=>[H]),_:1})])])],64)):h("",!0)],64))])}}});export{X as default};
