import{s as b}from"./index-ba0d422e.js";import{u as N}from"./useGrazeAPI-06f84ab9.js";import{v as M}from"./v4-a960c1f4.js";import{V as y,a as w}from"./VBtn-f57de62f.js";import{V as $,b as x}from"./VToolbar-636c2505.js";import{V as E}from"./VSpacer-46d72639.js";import{V as F}from"./VSheet-bfa14b2c.js";import{V as J}from"./VContainer-11a6e18a.js";import{a as P,V as h}from"./VRow-058c9f7f.js";import{V as C}from"./VTextField-626df063.js";import{c as q,e as z}from"./VCard-4cb28a80.js";import{d as B,y as m,o as L,b as G,w as s,c as a,e as V,L as k,X as O,Y as R,h as X,k as Y,N as H,F as Q}from"./index-5067dcdc.js";import{V as W}from"./VAutocomplete-894103d3.js";import{V as Z}from"./VDialog-7d1bcbad.js";import{a as _,b as ee}from"./VList-60becb77.js";const A="00000000-0000-0000-0000-000000000000",ae=B({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(t,{emit:c}){const u=m(""),n=m("");typeof t.convention=="object"?(u.value=t.convention.ConventionUUID,n.value=t.convention.OrganisationUUID):u.value=t.convention||"",typeof t.organisation=="object"?n.value=t.organisation.OrganisationUUID:n.value.length===0&&(n.value=t.organisation||"");const d=m({ID:0,TagUUID:M(),ConventionID:0,ConventionUUID:u.value||A,OrganisationID:0,OrganisationUUID:n.value||A,Title:"",Key:""}),g=N(),p=()=>{g.saveTag(d.value).then(r=>{r&&(d.value=r,c("save",r),c("close"))})};return(r,i)=>(L(),G(z,null,{default:s(()=>[a(x,{dark:"",color:"primary"},{default:s(()=>[a(y,{icon:"",dark:"",onClick:i[0]||(i[0]=f=>c("close"))},{default:s(()=>[a(w,null,{default:s(()=>[V("mdi:mdi-close")]),_:1})]),_:1}),a($,null,{default:s(()=>[V("Add Tag")]),_:1}),a(E),a(F,null,{default:s(()=>[a(y,{variant:"text",onClick:p},{default:s(()=>[V(" Save ")]),_:1})]),_:1})]),_:1}),a(q,null,{default:s(()=>[a(J,{fluid:!0},{default:s(()=>[a(P,null,{default:s(()=>[a(h,{cols:"12"},{default:s(()=>[a(C,{label:k(b).formLabelDisplayName,type:"text",variant:"outlined",modelValue:d.value.Title,"onUpdate:modelValue":i[1]||(i[1]=f=>d.value.Title=f)},null,8,["label","modelValue"])]),_:1}),a(h,{cols:"12"},{default:s(()=>[a(C,{label:k(b).formLabelTagKey,type:"text",variant:"outlined",modelValue:d.value.Key,"onUpdate:modelValue":i[2]||(i[2]=f=>d.value.Key=f)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ue=B({__name:"SelectTags",props:O({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0}}),emits:O(["change"],["update:modelValue"]),setup(t,{emit:c}){const u=R(t,"modelValue"),n=m([]),d=N(),g=m([]),p=m([]),r=m(""),i=m(""),f=m(0),T=X(()=>[...g.value,...p.value].map(l=>({title:l.Title,value:n.value.find(e=>e.TagUUID===l.TagUUID)||l})));typeof t.convention=="object"?(r.value=t.convention.ConventionUUID,i.value=t.convention.OrganisationUUID):r.value=t.convention||"",typeof t.organisation=="object"?i.value=t.organisation.OrganisationUUID:i.value.length===0&&(i.value=t.organisation||""),(async()=>{const o=[];r.value&&o.push(d.getConventionTags(r.value)),i.value&&o.push(d.getOrganisationTags(i.value));const l=await Promise.all(o);if(r.value&&i.value?(p.value=l[0].sort((e,v)=>e.Title.localeCompare(v.Title)),g.value=l[1].sort((e,v)=>e.Title.localeCompare(v.Title))):r.value&&l.length==1?p.value=l[0].sort((e,v)=>e.Title.localeCompare(v.Title)):i.value&&l.length==1&&(g.value=l[0].sort((e,v)=>e.Title.localeCompare(v.Title))),Array.isArray(u.value))f.value=2,T.value.forEach(e=>{Array.isArray(u.value)&&u.value.find(D=>D.TagUUID===e.value.TagUUID)&&n.value.push(e.value)});else if(typeof u.value=="string"){f.value=1;try{const e=JSON.parse(u.value);T.value.forEach(v=>{e.find(K=>K.TagUUID===v.value.TagUUID)&&n.value.push(v.value)})}catch{}}})();const U=m(!1),S=()=>{U.value=!0},j=o=>{o.ConventionUUID.length>0?p.value.push(o):o.OrganisationUUID.length>0&&g.value.push(o),n.value.push(o),I()},I=()=>{switch(f.value){default:case 2:{u.value=n.value,c("change");break}case 1:{u.value=JSON.stringify(n.value),c("change");break}}};return Y(n,I),(o,l)=>(L(),H(Q,null,[a(W,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),chips:o.chips,multiple:"",label:o.label||"Tags",variant:o.variant||"solo",hint:o.hint,"persistent-hint":!0,clearable:o.clearable,items:T.value,"item-title":"title","item-value":"value"},{"prepend-item":s(()=>[a(_,{title:"New Tag",onClick:l[0]||(l[0]=e=>S())},{prepend:s(()=>[a(w,{icon:"mdi:mdi-plus"})]),_:1}),a(ee,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),a(Z,{modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value=e),scrollable:!0},{default:s(()=>[a(ae,{convention:o.convention,organisation:o.organisation,onClose:l[2]||(l[2]=e=>U.value=!1),onSave:j},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}});export{A as N,Ue as _};
