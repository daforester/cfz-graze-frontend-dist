import{d as C,X as $,Y as k,y as V,R as E,o as n,b as S,w as m,c as D,N as r,G as U,K as l,O as h,F as c,e as q,H as B}from"./index-e64203a3.js";import{s as F,_ as H}from"./FormField.vue_vue_type_script_setup_true_lang-61fbf103.js";import{_ as M}from"./SaveButton.vue_vue_type_script_setup_true_lang-17310d42.js";import{u as x}from"./useGrazeAPI-d03a471c.js";import{G}from"./userData-d733b0cf.js";import{v}from"./v4-a960c1f4.js";import{V as N}from"./VContainer-1e78ef63.js";import{a as y,V as g}from"./VRow-c3f1c0bf.js";import{V as R}from"./VForm-f4ac5fc9.js";const L={key:0,class:"my-2"},z={key:1,class:"my-2"},A={key:0,class:"my-2"},K={key:1,class:"my-2"},Z=C({__name:"FormRenderer",props:$({convention:{},data:{},editable:{type:Boolean,default:!0},preview:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(u){const o=k(u,"modelValue");F(o.value.Sections),o.value.Sections.forEach(e=>{e.Fields&&F(e.Fields)});const p=V(),d=G(),b=x(),I=V((()=>{if(u.data!==void 0){const i=E(u.data);return o.value.Sections.forEach(a=>{a.Fields&&a.Fields.forEach(t=>{const s=u.data.Data.find(f=>f.SectionFieldUUID===t.SectionFieldUUID&&f.SectionFieldUUID==t.SectionFieldUUID);if(s)t.Value=s.Data;else{const f={ID:0,SubmissionDataUUID:v(),SubmissionID:u.data.ID,SubmissionUUID:u.data.SubmissionUUID,SectionID:a.ID,SectionUUID:a.SectionUUID,SectionFieldID:t.ID,SectionFieldUUID:t.SectionFieldUUID,Data:t.Value};i.Data.push(f)}})}),i}const e={ID:0,SubmissionUUID:v(),FormID:o.value.ID,FormUUID:o.value.FormUUID,UserID:(d==null?void 0:d.ID)||0,UserUUID:(d==null?void 0:d.UserUUID)||"",Data:[]};return e.Data=o.value.Sections.map(i=>i.Fields?i.Fields.map(a=>({ID:0,SubmissionDataUUID:v(),SubmissionID:e.ID,SubmissionUUID:e.SubmissionUUID,SectionID:i.ID,SectionUUID:i.SectionUUID,SectionFieldID:a.ID,SectionFieldUUID:a.SectionFieldUUID,Data:a.Value})):[]).flat(),e})()),_=(e,i,a)=>{const t=I.value.Data.find(s=>s.SectionUUID===e&&s.SectionFieldUUID===i);t&&(t.Data=a)},w=({callback:e})=>{var i;(i=p.value)==null||i.validate().then(a=>{a.valid?b.saveSubmission(I.value).then(t=>{t?(I.value=t,e&&e("Saved")):e&&e("Failed to process request")}).catch(()=>{e&&e("Failed to process request")}):e&&e("Errors in form detected, please review and try again.")})};return(e,i)=>(n(),S(N,null,{default:m(()=>[D(R,{ref_key:"formValidator",ref:p,onSubmit:i[0]||(i[0]=B(()=>{},["prevent"]))},{default:m(()=>[o.value.Heading?(n(),r("h2",L,U(o.value.Heading),1)):l("",!0),o.value.Description?(n(),r("p",z,U(o.value.Description),1)):l("",!0),(n(!0),r(c,null,h(o.value.Sections,a=>(n(),r(c,{key:`section_${o.value.ID}.${a.ID}`},[a.Heading?(n(),r("h3",A,U(a.Heading),1)):l("",!0),a.Description?(n(),r("p",K,U(a.Description),1)):l("",!0),a.Fields?(n(!0),r(c,{key:2},h(a.Fields,t=>(n(),r(c,{key:`field_${o.value.ID}.${a.ID}.${t.ID}`},[t.Field?(n(),S(y,{key:0},{default:m(()=>[D(g,null,{default:m(()=>[D(H,{field:t.Field,modelValue:t.Value,"onUpdate:modelValue":s=>t.Value=s,convention:e.convention,required:t.Required,"min-length":t.MinLength,"max-length":t.MaxLength,"persistent-hint":!0,disabled:!e.editable,onChange:s=>_(a.SectionUUID,t.SectionFieldUUID,t.Value)},null,8,["field","modelValue","onUpdate:modelValue","convention","required","min-length","max-length","disabled","onChange"])]),_:2},1024)]),_:2},1024)):l("",!0)],64))),128)):l("",!0)],64))),128)),e.editable&&!e.preview?(n(),S(y,{key:2},{default:m(()=>[D(g,null,{default:m(()=>[D(M,{onClick:w,type:"submit"})]),_:1})]),_:1})):l("",!0),q(" "+U(I.value),1)]),_:1},512)]),_:1}))}});export{Z as _};
