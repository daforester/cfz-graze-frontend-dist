import{d as C,X as w,Y as O,o as g,b as y,y as V,k as z,w as l,c as e,e as d,G as I,N as $,O as Y,K as T,F as W,R as le,h as ae,L as E,f as k,r as te,Z as oe,_ as ne,W as se}from"./index-688d2d90.js";import{V as ie}from"./VSelect-16ea9bad.js";import{V as ue}from"./VAutocomplete-f2dff8ab.js";import{V as N}from"./VDialog-81246719.js";import{b as q,V as F}from"./VToolbar-86851732.js";import{V as _,a as M}from"./VBtn-e58ce716.js";import{V as B}from"./VSpacer-c809dac9.js";import{V as G,a as re}from"./VSheet-411b296c.js";import{c as x,e as R,V as K,a as j,d as Z}from"./VCard-604adec2.js";import{a as b,V as c}from"./VRow-057e874e.js";import{s as L}from"./index-ba0d422e.js";import{u as de}from"./useGrazeAPI-1bda4353.js";import{_ as me}from"./SaveButton.vue_vue_type_script_setup_true_lang-f1870f8b.js";import{V as fe}from"./VForm-ab1eab4e.js";import{V as X}from"./VContainer-810392cf.js";import{V as P}from"./VTextField-219ada8d.js";import{V as J}from"./VImg-7f8377c7.js";import{V as pe}from"./VFileInput-8bd6442d.js";import{v as ve}from"./v4-a960c1f4.js";import"./VList-05e08af9.js";import"./index-26948025.js";import"./rounded-910a82b3.js";import"./ssrBoot-bf6daede.js";import"./index-c9c35486.js";import"./createSimpleFunctional-f53cf77a.js";import"./VAvatar-b854ed1a.js";import"./VOverlay-37556103.js";import"./scopeId-5acaa7df.js";import"./VChip-46240e08.js";const S=[{id:1,displayName:"Main user",permissions:{organisation:["READ","WRITE"],permissions:["READ"]}},{id:2,displayName:"Org user",permissions:{organisation:["READ","WRITE"],permissions:[]}},{id:3,displayName:"Access user",permissions:{organisation:[],permissions:["READ","WRITE"]}},{id:4,displayName:"Main other user",permissions:{organisation:["READ","WRITE"],permissions:["READ","WRITE"]}},{id:5,displayName:"Org other user",permissions:{organisation:["READ","WRITE"],permissions:[]}},{id:6,displayName:"Access other user",permissions:{organisation:[],permissions:["READ","WRITE"]}},{id:7,displayName:"Main again user",permissions:{organisation:["READ","WRITE"],permissions:["READ","WRITE"]}},{id:8,displayName:"Org again user",permissions:{organisation:["READ","WRITE"],permissions:[]}},{id:9,displayName:"Access again user",permissions:{organisation:[],permissions:["READ","WRITE"]}}],H=C({__name:"Permission",props:w(["label","variant"],{modelValue:{required:!0}}),emits:["update:modelValue"],setup(r){const f=O(r,"modelValue"),o=[{label:"View",value:"READ"},{label:"Edit",value:"WRITE"}];return(n,u)=>(g(),y(ie,{modelValue:f.value,"onUpdate:modelValue":u[0]||(u[0]=v=>f.value=v),items:o,"item-title":"label","item-value":"value",label:r.label,"persistent-hint":"",variant:r.variant,clearable:"",multiple:""},null,8,["modelValue","label","variant"]))}}),Ve=C({__name:"SelectUser",props:w(["conventionId","variant"],{modelValue:{}}),emits:["update:modelValue"],setup(r){const f=O(r,"modelValue"),o=V(""),n=V(!1),u=V([]),v=V(""),t=V([]);fetch("https://randomuser.me/api/?results=200").then(a=>a.json()).then(a=>{t.value=a.results.map(i=>({ID:0,UserUUID:i.login.uuid,DisplayName:`${i.name.first} ${i.name.last}`,Handle:i.login.username,Avatar:i.picture.thumbnail,Permissions:{Organisation:[],Permissions:[]},Data:"",Groups:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""}}))});const s=a=>{n.value=!0,setTimeout(()=>{u.value=t.value.filter(i=>(i.DisplayName||"").toLowerCase().indexOf((a||"").toLowerCase())>-1||(i.Handle||"").toLowerCase().indexOf((a||"").toLowerCase())>-1||(`@${i.Handle}`||"").toLowerCase().indexOf((a||"").toLowerCase())>-1).map(i=>({UserUUID:i.UserUUID,DisplayName:`${i.DisplayName} (@${i.Handle})`})),n.value=!1},500)};return z(v,a=>{a&&a!==f.value&&s(a)}),z(o,a=>{f.value=t.value.find(i=>i.UserUUID===a)}),(a,i)=>(g(),y(ue,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=U=>o.value=U),search:v.value,"onUpdate:search":i[1]||(i[1]=U=>v.value=U),loading:n.value,items:u.value,class:"mx-4",density:"comfortable",variant:r.variant,"hide-no-data":"","hide-details":"",clearable:"",label:"User","item-title":"DisplayName","item-value":"UserUUID"},null,8,["modelValue","search","loading","items","variant"]))}}),ce=C({__name:"SelectUserDialog",props:w({width:{type:String,required:!1,defaultValue:"auto"},minWidth:{type:String,required:!1,defaultValue:""},maxWidth:{type:String,required:!1,defaultValue:""},actionLabel:{type:String,required:!1,defaultValue:"Select"},conventionId:{type:String,required:!1,defaultValue:""},variant:{type:String,required:!1,defaultValue:"filled"}},{modelValue:{type:Boolean,required:!0}}),emits:w(["update:user"],["update:modelValue"]),setup(r,{emit:f}){const o=O(r,"modelValue"),n=V(null),u=()=>{n.value!==null&&(f("update:user",n.value),o.value=!1)};return(v,t)=>(g(),y(N,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=s=>o.value=s),width:r.width,"min-width":r.minWidth,"max-width":r.maxWidth},{default:l(()=>[e(R,null,{default:l(()=>[e(q,{dark:"",color:"primary"},{default:l(()=>[e(_,{icon:"",dark:"",onClick:t[0]||(t[0]=s=>o.value=!1)},{default:l(()=>[e(M,null,{default:l(()=>[d("mdi:mdi-close")]),_:1})]),_:1}),e(F,null,{default:l(()=>[d("Select User")]),_:1}),e(B),e(G,null,{default:l(()=>[e(_,{variant:"text",onClick:u},{default:l(()=>[d(I(r.actionLabel),1)]),_:1})]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(Ve,{"convention-id":r.conventionId,variant:r.variant,modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=s=>n.value=s)},null,8,["convention-id","variant","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","width","min-width","max-width"]))}}),ge=C({__name:"UserPermissions",props:w(["name"],{modelValue:{required:!0}}),emits:w(["update:modelValue","close"],["update:modelValue"]),setup(r,{emit:f}){const o=O(r,"modelValue"),n=V(!1),u=t=>{t.Permissions||(t.Permissions={Organisation:[],Permissions:[]});const s=t.Permissions;s.Organisation||(s.Organisation=[]),s.Permissions||(s.Permissions=[]),o.value.push(t)},v=t=>{o.value.splice(t,1)};return(t,s)=>(g(),y(R,null,{default:l(()=>[e(q,{dark:"",color:"primary"},{default:l(()=>[e(_,{icon:"",dark:"",onClick:s[0]||(s[0]=a=>f("close"))},{default:l(()=>[e(M,null,{default:l(()=>[d("mdi:mdi-close")]),_:1})]),_:1}),e(F,null,{default:l(()=>[d("Permissions ("+I(r.name)+")",1)]),_:1}),e(B),e(G,null,{default:l(()=>[e(_,{variant:"text",onClick:s[1]||(s[1]=a=>f("close"))},{default:l(()=>[d(" Save ")]),_:1})]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(re,null,{default:l(()=>[(g(!0),$(W,null,Y(o.value,(a,i)=>(g(),y(b,{key:a.ID,"no-gutters":""},{default:l(()=>[e(c,{cols:"4",md:"3"},{default:l(()=>[e(_,{icon:"mdi:mdi-minus",color:"red",size:"sm",onClick:U=>v(i)},null,8,["onClick"]),d(" "+I(a.DisplayName),1)]),_:2},1024),e(c,{cols:"8",md:"4"},{default:l(()=>[a.Permissions&&a.Permissions.Organisation?(g(),y(H,{key:0,modelValue:a.Permissions.Organisation,"onUpdate:modelValue":U=>a.Permissions.Organisation=U,variant:"solo",label:"Organisation"},null,8,["modelValue","onUpdate:modelValue"])):T("",!0)]),_:2},1024),e(c,{cols:"4",md:"1"}),e(c,{cols:"8",md:"4"},{default:l(()=>[a.Permissions&&a.Permissions.Permissions?(g(),y(H,{key:0,modelValue:a.Permissions.Permissions,"onUpdate:modelValue":U=>a.Permissions.Permissions=U,variant:"solo",label:"User Permissions"},null,8,["modelValue","onUpdate:modelValue"])):T("",!0)]),_:2},1024)]),_:2},1024))),128)),e(_,{onClick:s[2]||(s[2]=a=>n.value=!0)},{default:l(()=>[d("Add User")]),_:1}),e(ce,{modelValue:n.value,"onUpdate:modelValue":s[3]||(s[3]=a=>n.value=a),"onUpdate:user":u,"action-label":"Add",width:"600px"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}))}}),_e=k("p",{class:"mb-2"}," Are you sure you wish to delete this organisation? All data relating to it will be removed including all conventions their respective registrations and payment information. This action can not be undone. ",-1),Ue=k("p",{class:"mb-2"}," We are talking some Thanos level shit right here, if you proceed a team of super-powered beings with Daddy issues will hunt you down through time, space and twitter. ",-1),De=k("p",null,' To confirm type "I CLICK MY FINGERS" in the box below. ',-1),ye=C({__name:"EditOrganisation",props:{modelValue:{required:!0}},emits:w(["close","delete"],["update:modelValue"]),setup(r,{emit:f}){const o=de(),n=O(r,"modelValue"),u=V(le(n.value)),v=V(!1),t=V(""),s=V(),a=V(),i=ae(()=>{if(a.value!==void 0){const m=a.value;if(m&&m.length>=1)return URL.createObjectURL(m[0])}return n.value.Logo}),U=async()=>{var p;const{valid:m}=await((p=s.value)==null?void 0:p.validate())||{valid:!1};m&&o.saveOrganisation(u.value).then(D=>{D&&(n.value=D,f("close"))})},h=V({available:m=>!0,min:m=>m.length>=4||"Minimum 4 characters",required:m=>!!m||"Required.",valid:m=>!/[^0-9a-z_-]/.test(m)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),A=()=>{v.value=!1},Q=()=>{v.value=!0},ee=({callback:m})=>{t.value="",o.deleteOrganisation(u.value.OrganisationUUID).then(p=>{p?m&&m("Convention Deleted"):m&&m("Failed to Delete Organisation"),setTimeout(()=>{A(),f("delete")},2e3)}).catch(()=>{m&&(m("Failed to Delete Organisation"),setTimeout(A,2e3))})};return(m,p)=>(g(),y(fe,{"fast-fail":"",ref_key:"form",ref:s},{default:l(()=>[e(R,null,{default:l(()=>[e(q,{dark:"",color:"primary"},{default:l(()=>[e(_,{icon:"",dark:"",onClick:p[0]||(p[0]=D=>f("close"))},{default:l(()=>[e(M,null,{default:l(()=>[d("mdi:mdi-close")]),_:1})]),_:1}),e(F,null,{default:l(()=>[d(I(u.value.Name),1)]),_:1}),e(B),e(G,null,{default:l(()=>[e(_,{variant:"text",onClick:Q},{default:l(()=>[d(" Delete ")]),_:1}),e(_,{variant:"text",onClick:U},{default:l(()=>[d(" Save ")]),_:1})]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(X,{fluid:!0},{default:l(()=>[e(b,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(P,{label:E(L).formLabelName,type:"text",variant:"outlined",modelValue:u.value.Name,"onUpdate:modelValue":p[1]||(p[1]=D=>u.value.Name=D)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(P,{label:E(L).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[h.value.available,h.value.min,h.value.required,h.value.valid],type:"text",variant:"outlined",modelValue:u.value.Slug,"onUpdate:modelValue":p[2]||(p[2]=D=>u.value.Slug=D)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(J,{class:"imgLogo",src:i.value||""},null,8,["src"])]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(c,null,{default:l(()=>[e(pe,{label:E(L).formLabelLogo,variant:"outlined",modelValue:a.value,"onUpdate:modelValue":p[3]||(p[3]=D=>a.value=D)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(N,{modelValue:v.value,"onUpdate:modelValue":p[5]||(p[5]=D=>v.value=D),width:"auto"},{default:l(()=>[e(R,null,{default:l(()=>[e(K,null,{default:l(()=>[d(" Delete Organisation ")]),_:1}),e(j,null,{default:l(()=>[d(" Your will be done ")]),_:1}),e(x,null,{default:l(()=>[e(b,null,{default:l(()=>[e(c,null,{default:l(()=>[_e,Ue,De]),_:1})]),_:1}),e(b,null,{default:l(()=>[e(c,null,{default:l(()=>[e(P,{modelValue:t.value,"onUpdate:modelValue":p[4]||(p[4]=D=>t.value=D),variant:"outlined",placeholder:"Enter text here",label:"Confirmation"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Z,null,{default:l(()=>[e(me,{color:"red-darken-3",label:"Delete",enabled:t.value=="I CLICK MY FINGERS",onClick:ee},null,8,["enabled"]),e(_,{color:"primary",onClick:A},{default:l(()=>[d("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},512))}}),be=C({__name:"Organisation",props:{modelValue:{required:!0}},emits:w(["delete"],["update:modelValue"]),setup(r,{emit:f}){const o=O(r,"modelValue"),n=V(!1),u=V(!1);return(v,t)=>{const s=te("RouterLink");return g(),$(W,null,[e(R,null,{default:l(()=>[o.value.Logo?(g(),y(J,{key:0,src:o.value.Logo,cover:!0},null,8,["src"])):T("",!0),e(K,null,{default:l(()=>[d(I(o.value.Name),1)]),_:1}),e(j,null,{default:l(()=>[d(I(o.value.Slug),1)]),_:1}),e(Z,null,{default:l(()=>[e(b,{"no-gutters":""},{default:l(()=>[e(c,{class:"ma-1"},{default:l(()=>[e(_,{variant:"tonal",color:"primary",onClick:t[0]||(t[0]=a=>n.value=!0),width:"100%"},{default:l(()=>[d("Edit")]),_:1})]),_:1}),e(c,{class:"ma-1"},{default:l(()=>[e(_,{variant:"tonal",color:"red",onClick:t[1]||(t[1]=a=>u.value=!0),width:"100%"},{default:l(()=>[d("User Permissions")]),_:1})]),_:1}),e(c,{class:"ma-1"},{default:l(()=>[e(s,{to:`/dashboard/admin/${o.value.Slug?o.value.Slug:o.value.OrganisationUUID}/conventions`},{default:l(()=>[e(_,{variant:"tonal",color:"green",width:"100%"},{default:l(()=>[d("Convention Manager")]),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})]),_:1}),e(N,{modelValue:n.value,"onUpdate:modelValue":t[5]||(t[5]=a=>n.value=a),scrollable:!0},{default:l(()=>[e(ye,{onClose:t[2]||(t[2]=a=>n.value=!1),modelValue:o.value,"onUpdate:modelValue":t[3]||(t[3]=a=>o.value=a),onDelete:t[4]||(t[4]=a=>{n.value=!1,f("delete")})},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(N,{modelValue:u.value,"onUpdate:modelValue":t[8]||(t[8]=a=>u.value=a),scrollable:!0},{default:l(()=>[e(ge,{onClose:t[6]||(t[6]=a=>u.value=!1),modelValue:E(S),"onUpdate:modelValue":t[7]||(t[7]=a=>oe(S)?S.value=a:null),name:o.value.Name},null,8,["modelValue","name"])]),_:1},8,["modelValue"])],64)}}});const we=ne(be,[["__scopeId","data-v-6e1b5f2b"]]),Ce=k("h3",null,"Organisations",-1),el=C({__name:"OrganisationsView",emits:["pageTitle"],setup(r,{emit:f}){const o=se.getInstance(),n=V([]);o.getOrganisations().then(t=>{n.value=t}),f("pageTitle","Organisations");const u=()=>{const t={ID:0,OrganisationUUID:ve(),Name:"New Organisation",Slug:"",Logo:""};o.saveOrganisation(t).then(s=>{s&&n.value.push(s)})},v=t=>{n.value.splice(t,1)};return(t,s)=>(g(),y(X,null,{default:l(()=>[e(b,null,{default:l(()=>[e(c,null,{default:l(()=>[Ce]),_:1}),e(c,{class:"text-right"},{default:l(()=>[e(_,{color:"primary",onClick:u},{default:l(()=>[d("New")]),_:1})]),_:1})]),_:1}),e(b,null,{default:l(()=>[(g(!0),$(W,null,Y(n.value,(a,i)=>(g(),y(c,{key:a.ID,cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[e(we,{modelValue:n.value[i],"onUpdate:modelValue":U=>n.value[i]=U,onDelete:U=>v(i)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024))),128))]),_:1})]),_:1}))}});export{el as default};
