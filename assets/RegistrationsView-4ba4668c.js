import{p as Yt,n as xt,e as ce,t as Ce,c as Ht,G as qt,v as t,H as F,x as Je,I as de,a0 as _e,a1 as $e,r as c,K as Te,M as u,N as G,O as o,a3 as Ie,W as H,a2 as He,a4 as ee,S as j,w as ue,X as h,Q as V,V as y,P as w,_ as at,ac as jt,ad as Qt,E as rt,k as Kt,f as zt,d as Wt,o as Jt,ae as dt,R as Xt,Y as Zt,Z as ea,a7 as ta,a6 as aa,U as oa}from"./index-ac311343.js";import{e as na,T as la,V as ia,d as sa,c as ua}from"./FormRenderer.vue_vue_type_style_index_0_lang-e4f05db1.js";import{a as ra,F as Se}from"./form-29fd1dbb.js";import{_ as Be}from"./ModelDialog.vue_vue_type_script_setup_true_lang-e8b26836.js";import{m as da,k as ma,l as ca,n as va,o as Ua,p as Aa,q as _a,u as Ta,r as fa,s as Ea,t as Sa,v as pa,w as Da,x as Ra,y as Ia,z as mt,A as ct,B as vt,a as ya,_ as ga,f as Ut,c as Rt,d as It,e as yt,b as gt,V as Ct,g as Ca,h as Oa,i as Ma,j as ha}from"./VWindowItem-6abb854b.js";import{V as J,a as b}from"./VRow-650e8225.js";import{V as me}from"./VTextField-7e26d564.js";import{V as re}from"./copyToClipboard-0f8ed3e5.js";import{u as Va,j as Re,V as ba}from"./VContainer-ecac3023.js";import{V as ka,u as ot}from"./VCheckbox-48536abb.js";import{v as Ne}from"./v4-a960c1f4.js";import{h as Ye,b as Na,a as La,c as Fa,d as At,P as et,u as Ot}from"./useDisplayTransactions-0f0c1a8e.js";import{V as xe,a as Pe}from"./VList-ae9e3e02.js";import{V as ne,a as Pa}from"./VBtn-75807fcb.js";import{b as wa,c as Mt,d as _t}from"./submission-6136b51d.js";import{V as $a}from"./VAvatar-6f7d9aac.js";import{s as Ba}from"./sortSubmissions-8ed80f07.js";import{V as qe,a as Ga}from"./scopeId-bc98ec91.js";import{_ as tt,V as ht}from"./SaveButton.vue_vue_type_script_setup_true_lang-34b2c7e0.js";import{V as Ya}from"./VForm-c9e3742b.js";import{V as xa,e as Tt,c as Ha}from"./VCard-5b80e53b.js";import{G as qa}from"./group-d2a77946.js";import{C as ja}from"./canDo-2c299106.js";import{G as Qa}from"./userData-b4f03537.js";import{V as Ka}from"./forwardRefs-d3114dfc.js";import{u as Xe}from"./nil-d01db1aa.js";import{V as ft,a as za}from"./VToolbar-c0d31548.js";import{V as Et,a as Wa}from"./VTable-1c1f619b.js";import{V as Ja}from"./VDialog-08c19895.js";import"./index-26b71cef.js";import"./VTextarea-ba5b1be6.js";import"./VChip-f2e3f647.js";import"./VToolbarItems-e668b422.js";import"./VDivider-9625ac4d.js";import"./createSimpleFunctional-6e4886dc.js";var Vt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Vt||{});const Xa=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var we=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(we||{});const Za=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const eo=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var Z=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(Z||{});const to=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],ao=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},oo=Yt({itemsLength:{type:[Number,String],required:!0},...da(),...ma(),...ca()},"VDataTableServer"),no=xt()({name:"VDataTableServer",props:oo(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,p)=>!0},setup(e,p){let{emit:s,slots:i}=p;const{groupBy:n}=va(e),{sortBy:a,multiSort:m,mustSort:l}=Ua(e),{page:U,itemsPerPage:I}=Aa(e),A=ce(()=>parseInt(e.itemsLength,10)),{columns:f,headers:v}=_a(e,{groupBy:n,showSelect:Ce(e,"showSelect"),showExpand:Ce(e,"showExpand")}),{items:T}=Ta(e,f),{toggleSort:_}=fa({sortBy:a,multiSort:m,mustSort:l,page:U}),{opened:Y,isGroupOpen:R,toggleGroup:C,extractRows:O}=Ea({groupBy:n,sortBy:a}),{pageCount:k,setItemsPerPage:X}=Sa({page:U,itemsPerPage:I,itemsLength:A}),{flatItems:te}=pa(T,n,Y),{isSelected:se,select:K,selectAll:E,toggleSelect:S,someSelected:L,allSelected:M}=Da(e,{allItems:T,currentPage:T}),{isExpanded:B,toggleExpand:ae}=Ra(e),oe=ce(()=>O(T.value));Ia({page:U,itemsPerPage:I,sortBy:a,groupBy:n,search:Ce(e,"search")}),Ht("v-data-table",{toggleSort:_,sortBy:a}),qt({VDataTableRows:{hideNoData:Ce(e,"hideNoData"),noDataText:Ce(e,"noDataText"),loading:Ce(e,"loading"),loadingText:Ce(e,"loadingText")}});const z=ce(()=>({page:U.value,itemsPerPage:I.value,sortBy:a.value,pageCount:k.value,toggleSort:_,setItemsPerPage:X,someSelected:L.value,allSelected:M.value,isSelected:se,select:K,selectAll:E,toggleSelect:S,isExpanded:B,toggleExpand:ae,isGroupOpen:R,toggleGroup:C,items:oe.value,groupedItems:te.value,columns:f.value,headers:v.value}));Va(()=>{const[Me]=mt.filterProps(e),[he]=ct.filterProps(e),[Ve]=vt.filterProps(e),[ve]=Et.filterProps(e);return t(Et,Je({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ve),{top:()=>{var le;return(le=i.top)==null?void 0:le.call(i,z.value)},default:()=>{var le,pe,De,ye;return i.default?i.default(z.value):t(F,null,[(le=i.colgroup)==null?void 0:le.call(i,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(ct,Je(he,{sticky:e.fixedHeader}),i)]),(pe=i.thead)==null?void 0:pe.call(i,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[i.body?i.body(z.value):t(vt,Je(Ve,{items:te.value}),i)]),(De=i.tbody)==null?void 0:De.call(i,z.value),(ye=i.tfoot)==null?void 0:ye.call(i,z.value)])},bottom:()=>i.bottom?i.bottom(z.value):t(mt,Me,{prepend:i["footer.prepend"]})})})}}),lo=de({__name:"EditAdminLayout",props:_e({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["save"],["update:modelValue"]),setup(e,{emit:p}){const s=$e(e,"modelValue"),i=c(Te(e.layout)),n=c([]),a=Ie(),m=({callback:A})=>{const f=()=>{A&&A("Failed to Save Layout")},v=()=>{A&&A("Layout Saved")};a.saveAdminLayout(i.value).then(T=>{T?(v(),p("save",T)):f()}).catch(()=>{f()})},l=()=>({ID:0,LayoutPanelUUID:Ne(),AdminLayoutID:i.value.ID,AdminLayoutUUID:i.value.AdminLayoutUUID,Name:"",Order:i.value.Panels.length+1,Items:[],RequiredFormType:Se.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),U=A=>()=>({ID:0,LayoutItemUUID:Ne(),LayoutPanelID:A.ID,LayoutPanelUUID:A.LayoutPanelUUID,Label:"",SourceType:we.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:A.Items.length+1,DefaultSort:!1}),I=A=>{const f=n.value.find(v=>v.value===A.SectionFieldUUID);f&&(A.SectionFieldID=f.object.ID,A.SectionField=f.object)};return a.getConventionForms(e.layout.ConventionUUID).then(A=>{A.forEach(f=>f.Sections.forEach(v=>v.Fields&&n.value.push(...v.Fields.map(T=>{var Y;return{title:`${f.Name} - ${v.Name} - ${(Y=T.Field)==null?void 0:Y.Name}`,value:T.SectionFieldUUID,object:T}})))),n.value.sort(na("title"))}),(A,f)=>(u(),G(Be,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=v=>s.value=v),onSave:m,title:A.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(Re,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(me,{modelValue:i.value.Name,"onUpdate:modelValue":f[0]||(f[0]=v=>i.value.Name=v),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(re,{modelValue:i.value.Type,"onUpdate:modelValue":f[1]||(f[1]=v=>i.value.Type=v),label:"Layout Type",items:H(Xa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(Ut,{modelValue:i.value.Panels,"onUpdate:modelValue":f[2]||(f[2]=v=>i.value.Panels=v),"new-item":l,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},He({_:2},[ee(i.value.Panels,(v,T)=>({name:`panel_${T}`,fn:o(()=>[t(Re,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(me,{modelValue:v.Name,"onUpdate:modelValue":_=>v.Name=_,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(re,{modelValue:v.RequiredFormType,"onUpdate:modelValue":_=>v.RequiredFormType=_,items:H(ra),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(ya,{label:"Required Groups",variant:"outlined",modelValue:v.RequiredGroupMemberships,"onUpdate:modelValue":_=>v.RequiredGroupMemberships=_,convention:i.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(ga,{label:"Registration Tags",variant:"outlined",modelValue:v.RequiredRegistrationTags,"onUpdate:modelValue":_=>v.RequiredRegistrationTags=_,convention:i.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(Ut,{modelValue:v.Items,"onUpdate:modelValue":_=>v.Items=_,"new-item":U(v),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},He({_:2},[ee(v.Items,(_,Y)=>({name:`item_${Y}`,fn:o(()=>[t(Re,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(me,{modelValue:_.Label,"onUpdate:modelValue":R=>_.Label=R,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(re,{modelValue:_.SourceType,"onUpdate:modelValue":R=>_.SourceType=R,label:"Source Type",items:H(Za),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:o(()=>[_.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(u(),G(re,{key:0,modelValue:_.SectionFieldUUID,"onUpdate:modelValue":R=>_.SectionFieldUUID=R,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:R=>I(_)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):_.SourceType==="LAYOUT_ITEM_SOURCE_META"?(u(),G(re,{key:1,modelValue:_.MetaField,"onUpdate:modelValue":R=>_.MetaField=R,label:"Miscellaneous Data",items:H(eo),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):_.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(u(),G(re,{key:2,modelValue:_.UserField,"onUpdate:modelValue":R=>_.UserField=R,label:"User Profile Data",items:H(to),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):j("",!0)]),_:2},1024)]),_:2},1024),t(J,null,{default:o(()=>[t(b,null,{default:o(()=>[t(ka,{modelValue:_.DefaultSort,"onUpdate:modelValue":R=>_.DefaultSort=R,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),io=h("br",null,null,-1),so=h("h3",null,"Assigned Accommodation",-1),uo=h("br",null,null,-1),ro=h("br",null,null,-1),mo=h("h3",null,"Accommodation Preferences",-1),co=h("h3",null,"Selected Tickets",-1),vo=h("br",null,null,-1),Uo=de({__name:"EditAccommodationAssignmentDialog",props:_e({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["update:field"],["update:modelValue"]),setup(e,{emit:p}){const s=e,{convention:i,registration:n,title:a=""}=s,m=Ie(),l=$e(e,"modelValue"),U=c({capacity:{max:E=>{var M;const S=k.value.find(B=>B.room.RoomUUID===E);return!S||S.room.MaximumCapacity===0?!0:(((M=v.value)==null?void 0:M.Members.length)||0)<=S.room.MaximumCapacity||"Too many people in the group for this room"},min:E=>{var M;const S=k.value.find(B=>B.room.RoomUUID===E);return!S||S.room.MinimumCapacity===0?!0:(((M=v.value)==null?void 0:M.Members.length)||0)>=S.room.MinimumCapacity||"Not enough people in the group for this room"}}}),I=c([]),A=ot(s,p,void 0,void 0,"field"),f=c(Te(A.value));ue(A,()=>{f.value=Te(A.value)});const v=c(),T=c(""),_=c(""),Y=c([]),R=c({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),C=async()=>{var M;const E=await m.getConventionAvailableAccommodation(i.ConventionUUID);E&&(I.value=E);const S=await m.getRegistrationGroup(n.RegistrationUUID||"");S&&(v.value=S);const L=await m.getConventionTickets(i.ConventionUUID);L&&(Y.value=L);try{R.value=JSON.parse(((M=v.value)==null?void 0:M.TicketData)||"")}catch{}};ue(T,()=>{_.value=k.value.length>0?k.value[0].value:""});const O=ce(()=>{const E=X.value;return I.value.map(S=>{let L;return E.forEach(M=>{S.Costs.forEach(B=>{B.DateStart===(M==null?void 0:M.DateStart)&&B.DateEnd===M.DateEnd&&(L===void 0||L>B.Availability)&&(L=B.Availability)})}),{label:`${S.Name}`,title:`${S.Name} (${L} Available)`,value:S.AccommodationUUID}})}),k=ce(()=>{const E=X.value,S=I.value.find(L=>L.AccommodationUUID===T.value);return(S==null?void 0:S.Pool.map(L=>{var B,ae;let M;return E.forEach(oe=>{L.Costs.forEach(z=>{z.DateStart===(oe==null?void 0:oe.DateStart)&&z.DateEnd===oe.DateEnd&&(M===void 0||M>z.Availability)&&(M=z.Availability)})}),{label:`${(B=L.Venue)==null?void 0:B.Name} - ${L.Name}`,title:`${(ae=L.Venue)==null?void 0:ae.Name} - ${L.Name} (${M} Available)`,value:L.RoomUUID,room:L}}))||[]}),X=ce(()=>[...R.value.Ticket,...R.value.AddonsChecked,...R.value.ComponentsChecked].map(E=>Y.value.find(S=>S.TicketUUID===E)).filter(E=>E!==void 0&&E.RequiresAccommodation)),te=E=>{var S;m.assignAccommodation(((S=v.value)==null?void 0:S.Registration.RegistrationUUID)||"",T.value,_.value,!1).then(L=>{L?(C(),E&&E("Room Assigned")):E&&E("Room not assigned")}).catch(()=>{E&&E("Room not assigned")})},se=E=>{var S,L;(S=v.value)!=null&&S.Registration.AllocationUUID?m.deleteAllocation(((L=v.value)==null?void 0:L.Registration.AllocationUUID)||"").then(M=>{M?(C(),E&&E("Allocation Deleted")):E&&E("Allocation not deleted")}).catch(()=>{E&&E("Allocation not deleted")}):E&&E("Nothing to Delete")},K=E=>{var L,M;const S=(L=I.value.find(B=>B.AccommodationUUID===E.AccommodationUUID))==null?void 0:L.Pool;if(S){const B=S.find(ae=>ae.RoomUUID===E.RoomUUID);if(B)return`${(M=B.Venue)==null?void 0:M.Name} - ${B.Name}`}return""};return C(),(E,S)=>{var L;return u(),G(Be,{modelValue:l.value,"onUpdate:modelValue":S[2]||(S[2]=M=>l.value=M),title:H(a),color:"primary","show-close-action":!0,"show-delete-action":!!((L=v.value)!=null&&L.Registration.Allocation),"show-save-action":!!_.value,"save-button-label":"Assign Room",onDelete:se,onSave:te,fullscreen:!0,persistent:!0},{default:o(()=>[t(Re,{class:"pa-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>{var M;return[t(b,{cols:"12",md:"6"},{default:o(()=>{var B,ae;return[h("h3",null,"Group Members ("+V((B=v.value)==null?void 0:B.Members.length)+")",1),(u(!0),y(F,null,ee((ae=v.value)==null?void 0:ae.Members,oe=>(u(),y(F,{key:oe.UUID},[w(" #"+V(oe.Reference)+" "+V(oe.Name),1),io],64))),128))]}),_:1}),(M=v.value)!=null&&M.Registration.Allocation?(u(),G(b,{key:0,cols:"12",md:"6"},{default:o(()=>[so,t(xe,null,{default:o(()=>{var B;return[(u(!0),y(F,null,ee((B=v.value)==null?void 0:B.Registration.Allocation.Periods,ae=>(u(),G(Pe,{key:ae.AllocationPeriodUUID},{default:o(()=>{var oe;return[w(V((oe=I.value.find(z=>z.AccommodationUUID===ae.AccommodationUUID))==null?void 0:oe.Name)+" ",1),uo,w(" "+V(K(ae))+" ",1),ro,h("small",null,"("+V(H(Ye)(ae.DateStart))+" - "+V(H(Ye)(ae.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):j("",!0)]}),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",md:"6"},{default:o(()=>[E.selectedAccommodation.length?(u(),y(F,{key:0},[mo,t(xe,null,{default:o(()=>[(u(!0),y(F,null,ee(E.selectedAccommodation,(M,B)=>(u(),G(Pe,{key:M.AccommodationUUID},{default:o(()=>[w(V(B+1)+". "+V(M.Name),1)]),_:2},1024))),128))]),_:1})],64)):j("",!0)]),_:1}),t(b,{cosl:"12",md:"6"},{default:o(()=>[co,t(xe,null,{default:o(()=>[(u(!0),y(F,null,ee(X.value,M=>(u(),G(Pe,{key:M==null?void 0:M.TicketUUID},{default:o(()=>[w(V(M.Name)+" ",1),vo,h("small",null,"("+V(H(Ye)(M.DateStart))+" - "+V(H(Ye)(M.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",md:"6"},{default:o(()=>[t(re,{modelValue:T.value,"onUpdate:modelValue":S[0]||(S[0]=M=>T.value=M),items:O.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",md:"6"},{default:o(()=>[t(re,{modelValue:_.value,"onUpdate:modelValue":S[1]||(S[1]=M=>_.value=M),items:k.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[U.value.capacity.min,U.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Ao={key:0,class:"accommodationList"},_o={key:0,class:"text-orange-darken-2"},To=de({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const p=c(!1),s=ce(()=>{if(!e.value)return[];const n=JSON.parse(e.value),a=e.accommodations.filter(m=>n.includes(m.AccommodationUUID)).sort((m,l)=>{const U=n.findIndex(A=>A===m.AccommodationUUID),I=n.findIndex(A=>A===l.AccommodationUUID);return U>I?1:-1});return Te(a)}),i=ce(()=>{let n;const a=e.forms.find(m=>m.Sections.find(l=>{var U;return(U=l.Fields)==null?void 0:U.find(I=>{var A;if(((A=I.Field)==null?void 0:A.Type)==="TICKET")return n=I,!0})}));return n?!!e.registration.Submissions.find(m=>{if(m.FormUUID==(a==null?void 0:a.FormUUID))return m.Data.find(l=>{if(l.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const U=JSON.parse(l.Data);return e.tickets.filter(I=>I.RequiresAccommodation).find(I=>U.Ticket.includes(I.TicketUUID)||U.AddonsChecked.includes(I.TicketUUID)||U.ComponentsChecked.includes(I.TicketUUID))}})}):!1});return(n,a)=>i.value?(u(),y(F,{key:0},[n.value?(u(),y("ol",Ao,[(u(!0),y(F,null,ee(s.value,m=>(u(),y("li",{key:m.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(l=>l.AccommodationUUID===m.AccommodationUUID)?(u(),y("strong",_o,V(m.Name),1)):(u(),y(F,{key:1},[w(V(m.Name),1)],64))]))),128))])):j("",!0),t(ne,{onClick:a[0]||(a[0]=m=>p.value=!0),variant:"flat",color:"success"},{default:o(()=>[w("Assign Accommodation")]),_:1}),n.convention&&p.value?(u(),G(Uo,{key:1,modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=m=>p.value=m),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":s.value},null,8,["modelValue","convention","registration","selected-accommodation"])):j("",!0)],64)):j("",!0)}});const fo=at(To,[["__scopeId","data-v-7a102d46"]]),Eo={key:0,class:"addonList"},So={key:0},po={key:0},Do=de({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const p=ce(()=>{if(!e.value)return;const s=JSON.parse(e.value),i=Object.keys(s),n=Te(e.extras);return n.forEach(a=>{a.Options=a.Options.filter(m=>i.includes(m.OptionUUID)?(m.Choices=m.Choices.filter(l=>l.TagUUID===s[m.OptionUUID].choiceId),s[m.OptionUUID].checked):!1)}),n.filter(a=>a.Options.length>0),n});return(s,i)=>s.value?(u(),y("ul",Eo,[(u(!0),y(F,null,ee(p.value,n=>(u(),y(F,{key:n.ExtraUUID},[n.Options.length?(u(),y("li",So,[h("strong",null,V(n.Name),1),h("ul",null,[(u(!0),y(F,null,ee(n.Options,a=>(u(),y("li",{key:a.OptionUUID},[w(V(a.Name)+" ",1),a.Choices.length==1?(u(),y("small",po,"("+V(a.Choices[0].Title)+")",1)):j("",!0)]))),128))])])):j("",!0)],64))),128))])):j("",!0)}});const Ro=at(Do,[["__scopeId","data-v-55786e01"]]),Io={key:0},yo=de({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const p=ce(()=>{if(!e.value)return;const s=JSON.parse(e.value);return Object.entries(s).filter(([,i])=>i).map(([i,n])=>e.interests.find(a=>a.InterestUUID===i)).filter(i=>i!==void 0)});return(s,i)=>s.value?(u(),y("ul",Io,[(u(!0),y(F,null,ee(p.value,n=>(u(),y("li",{key:n.InterestUUID},V(n.Name),1))),128))])):j("",!0)}}),go=h("br",null,null,-1),Co=h("small",null,"Options:",-1),Oo=h("br",null,null,-1),Mo=h("small",null,"Addons:",-1),ho=de({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const p=ce(()=>{if(!e.value)return;let s={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{s=JSON.parse(e.value),"ticket"in s&&(s.Ticket=s.ticket),"addonsChecked"in s&&(s.AddonsChecked=s.addonsChecked),"componentsChecked"in s&&(s.ComponentsChecked=s.componentsChecked)}catch{}return s.Ticket.filter(i=>{const n=e.tickets.find(a=>a.TicketUUID===i);return!(!n||n.Type!==la.TICKET_TYPE_TICKET)}).map(i=>{const n=e.tickets.find(m=>m.TicketUUID===i),a=Te(n);return a.TicketComponents=n.TicketComponents.filter(m=>s.ComponentsChecked.includes(m.TicketUUID)),a.AddonTickets=n.AddonTickets.filter(m=>s.AddonsChecked.includes(m.TicketUUID)),a})});return(s,i)=>s.value?(u(!0),y(F,{key:0},ee(p.value,n=>(u(),y("div",{key:n.TicketUUID},[h("strong",null,V(n.Name),1),n.TicketComponents.length>0?(u(),y(F,{key:0},[go,Co,w("  "),(u(!0),y(F,null,ee(n.TicketComponents,a=>(u(),y(F,{key:a.TicketUUID},[h("small",null,V(a.Name),1),w("  ")],64))),128))],64)):j("",!0),n.AddonTickets.length>0?(u(),y(F,{key:1},[Oo,Mo,w("  "),(u(!0),y(F,null,ee(n.AddonTickets,a=>(u(),y("small",{key:a.TicketUUID},[w("("),h("em",null,V(a.Name),1),w(")")]))),128))],64)):j("",!0)]))),128)):j("",!0)}}),Vo={key:0,class:"text-blue text-center"},bo={key:1,class:"text-red text-center"},ko={key:2,class:"text-orange text-center"},No={key:3,class:"text-orange text-center"},Lo={key:4,class:"text-orange text-center"},Fo={key:5,class:"text-orange text-center"},Po={key:6,class:"text-green text-center"},wo={key:0},$o={key:0},Bo=h("strong",null,"Total:",-1),Go=de({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload","showForm"],setup(e,{emit:p}){const s=(a,m,l)=>{p("showForm",{registration:a,form:m,submission:l})},i=a=>{p("openActions",a)},n=a=>{p("openPayments",a)};return(a,m)=>a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(u(),G(fo,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(u(),G(Ro,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(u(),G(yo,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(u(),G(ho,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(u(!0),y(F,{key:4},ee(a.item.raw[a.header.key],l=>(u(),y("ul",{key:l.Heading},[h("li",null,[h("strong",null,V(l.Heading)+": ",1),h("span",{class:jt(H(wa)(l.Submission.Status))},V(H(Mt)(l.Submission.Status)),3),t(ne,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:U=>s(l.Registration,l.Form,l.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(u(),G($a,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(u(),y(F,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(u(),y("div",Vo,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(u(),y("div",bo,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(u(),y("div",ko,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(u(),y("div",No,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(u(),y("div",Lo,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(u(),y("div",Fo,"Awaiting Additional Payments")):(u(),y("div",Po,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(u(),y(F,{key:7},[t(ne,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:m[0]||(m[0]=l=>i(a.item.raw[a.header.key]))}),t(ne,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:m[1]||(m[1]=l=>n(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(u(),y(F,{key:8},[a.item.raw[a.header.key].length===1?(u(),y("em",wo," Not in a group ")):(u(),y(F,{key:1},[h("ul",null,[(u(!0),y(F,null,ee(a.item.raw[a.header.key],l=>(u(),y("li",{key:l.UUID,class:"ml-0"},[w(" #"+V(l.Reference)+" : "+V(l.Name)+" ",1),l.IsLeader?(u(),y("strong",$o,"(Leader)")):j("",!0)]))),128))]),Bo,w(" "+V(a.item.raw[a.header.key].length),1)],64))],64)):(u(),y(F,{key:9},[w(V(a.item.raw[a.header.key]),1)],64))}});var Yo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],xo=function(e){return Yo.map(function(p){return p.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Ho=function(e,p,s){Object.keys(p).filter(xo).forEach(function(i){var n=p[i];typeof n=="function"&&(i==="onInit"?n(e,s):s.on(i.substring(2),function(a){return n(a,s)}))})},qo=function(e,p,s,i){var n=e.modelEvents?e.modelEvents:null,a=Array.isArray(n)?n.join(" "):n;ue(i,function(m,l){s&&typeof m=="string"&&m!==l&&m!==s.getContent({format:e.outputFormat})&&s.setContent(m)}),s.on(a||"change input undo redo",function(){p.emit("update:modelValue",s.getContent({format:e.outputFormat}))})},jo=function(e,p,s,i,n,a){i.setContent(a()),s.attrs["onUpdate:modelValue"]&&qo(p,s,i,n),Ho(e,s.attrs,i)},St=0,bt=function(e){var p=Date.now(),s=Math.floor(Math.random()*1e9);return St++,e+"_"+s+St+String(p)},Qo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},pt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Ko=function(e,p){return pt(e).concat(pt(p))},zo=function(e){return e==null},Dt=function(){return{listeners:[],scriptId:bt("tiny-script"),scriptLoaded:!1}},Wo=function(){var e=Dt(),p=function(n,a,m,l){var U=a.createElement("script");U.referrerPolicy="origin",U.type="application/javascript",U.id=n,U.src=m;var I=function(){U.removeEventListener("load",I),l()};U.addEventListener("load",I),a.head&&a.head.appendChild(U)},s=function(n,a,m){e.scriptLoaded?m():(e.listeners.push(m),n.getElementById(e.scriptId)||p(e.scriptId,n,a,function(){e.listeners.forEach(function(l){return l()}),e.scriptLoaded=!0}))},i=function(){e=Dt()};return{load:s,reinitialize:i}},Jo=Wo(),Xo=function(){return typeof window<"u"?window:global},Oe=function(){var e=Xo();return e&&e.tinymce?e.tinymce:null},Zo={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},Ae=globalThis&&globalThis.__assign||function(){return Ae=Object.assign||function(e){for(var p,s=1,i=arguments.length;s<i;s++){p=arguments[s];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&(e[n]=p[n])}return e},Ae.apply(this,arguments)},en=function(e,p,s,i){return e(i||"div",{id:p,ref:s})},tn=function(e,p,s){return e("textarea",{id:p,visibility:"hidden",ref:s})},Ze={selector:void 0,target:void 0},an=de({props:Zo,setup:function(e,p){var s=e.init?Ae(Ae({},e.init),Ze):Ae({},Ze),i=Qt(e),n=i.disabled,a=i.modelValue,m=i.tagName,l=c(null),U=null,I=e.id||bt("tiny-vue"),A=e.init&&e.init.inline||e.inline,f=!!p.attrs["onUpdate:modelValue"],v=!0,T=e.initialValue?e.initialValue:"",_="",Y=function(O){return f?function(){return a!=null&&a.value?a.value:""}:function(){return O?T:_}},R=function(){var O=Y(v),k=Ae(Ae({},s),{readonly:e.disabled,target:l.value,plugins:Ko(s.plugins,e.plugins),toolbar:e.toolbar||s.toolbar,inline:A,setup:function(X){U=X,X.on("init",function(te){return jo(te,e,p,X,a,O)}),typeof s.setup=="function"&&s.setup(X)}});Qo(l.value)&&(l.value.style.visibility=""),Oe().init(k),v=!1};ue(n,function(O){var k;U!==null&&(typeof((k=U.mode)===null||k===void 0?void 0:k.set)=="function"?U.mode.set(O?"readonly":"design"):U.setMode(O?"readonly":"design"))}),ue(m,function(O){var k;f||(_=U.getContent()),(k=Oe())===null||k===void 0||k.remove(U),rt(function(){return R()})}),Kt(function(){if(Oe()!==null)R();else if(l.value&&l.value.ownerDocument){var O=e.cloudChannel?e.cloudChannel:"6",k=e.apiKey?e.apiKey:"no-api-key",X=zo(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(k,"/tinymce/").concat(O,"/tinymce.min.js"):e.tinymceScriptSrc;Jo.load(l.value.ownerDocument,X,R)}}),zt(function(){Oe()!==null&&Oe().remove(U)}),A||(Wt(function(){v||R()}),Jt(function(){var O;f||(_=U.getContent()),(O=Oe())===null||O===void 0||O.remove(U)}));var C=function(O){var k;_=U.getContent(),(k=Oe())===null||k===void 0||k.remove(U),s=Ae(Ae(Ae({},s),O),Ze),rt(function(){return R()})};return p.expose({rerender:C,getEditor:function(){return U}}),function(){return A?en(dt,I,l,e.tagName):tn(dt,I,l)}}});const on=["colspan"],nn=h("strong",null,"E-Mail Content",-1),ln=["innerHTML"],kt=de({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:p}){const s=Ie(),i=c([]),n=c({From:"",Subject:"",HTML:""}),a=c(""),m=c(""),l=c(""),U=c(!1),I=c([]),A=c([]),f=c([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),v=c([{key:"CreatedAt",order:"asc"}]);ue(n,R=>{l.value=R.From||l.value||"",m.value=R.Subject||m.value||"",a.value=R.HTML||a.value||""});const T=()=>{s.getRegistrationEmails(e.registration.RegistrationUUID).then(R=>{R&&(R.forEach(C=>{C.CreatedAt=Na(new Date(C.CreatedAt||"")),C.Status=ao(C.Status),C.User||(C.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),A.value=R)})};T(),(()=>{s.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(R=>{R&&(i.value=R)})})();const Y=({callback:R})=>{s.sendRegistrationEmail(e.registration.RegistrationUUID,l.value,m.value,a.value).then(C=>{C?R&&(R("Email Sent"),T(),setTimeout(()=>{U.value=!1},2e3)):R&&R("Not sent")}).catch(()=>{R&&R("Not sent")})};return(R,C)=>(u(),y(F,null,[R.showEditor?(u(),y(F,{key:0},[t(J,null,{default:o(()=>[t(b,null,{default:o(()=>[t(ia,{items:i.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":C[0]||(C[0]=O=>n.value=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12"},{default:o(()=>[t(me,{modelValue:l.value,"onUpdate:modelValue":C[1]||(C[1]=O=>l.value=O),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:o(()=>[t(me,{modelValue:m.value,"onUpdate:modelValue":C[2]||(C[2]=O=>m.value=O),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:o(()=>[t(H(an),{modelValue:a.value,"onUpdate:modelValue":C[3]||(C[3]=O=>a.value=O),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,null,{default:o(()=>[t(tt,{onClick:C[4]||(C[4]=O=>p("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(b,{class:"text-right"},{default:o(()=>[t(tt,{onClick:Y,label:"Send",color:"error"})]),_:1})]),_:1})],64)):j("",!0),A.value.length&&!R.hideHistory?(u(),G(Ct,{key:1,class:"my-2"},{default:o(()=>[t(gt,null,{default:o(()=>[t(Rt,null,{default:o(()=>[w(" Email History ")]),_:1}),t(It,null,{default:o(()=>[t(H(yt),{items:A.value,headers:f.value,"show-expand":!0,"item-value":"EmailUUID",expanded:I.value,"onUpdate:expanded":C[5]||(C[5]=O=>I.value=O),"sort-by":v.value,"onUpdate:sortBy":C[6]||(C[6]=O=>v.value=O)},{"expanded-row":o(({columns:O,item:k})=>[h("tr",null,[h("td",{colspan:O.length},[nn,h("div",{class:"communicationsViewEmailPreview",innerHTML:k.raw.HTML},null,8,ln)],8,on)])]),"footer.prepend":o(()=>[t(ne,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:T},{default:o(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const sn=de({__name:"StripeRefundPayment",props:_e({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["refunded"],["update:modelValue"]),setup(e,{emit:p}){const s=$e(e,"modelValue"),i=Ie(),n=c(!1),a=c("");let m=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const v=e.paymentTransaction.Data.PaymentIntent;v&&(m=v.amount)}const l=c({Amount:m/100,Description:"",Reason:""}),U=c([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),I=c(!1);async function A(v){v.preventDefault(),I.value=!0,i.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,l.value).then(T=>{T?p("refunded",T):f("An unexpected error occurred.")}).catch(T=>{f("An error occurred processing the refund: "+T.toString())}),I.value=!1}const f=v=>{a.value=v,n.value=!0};return(v,T)=>(u(),G(Be,{modelValue:s.value,"onUpdate:modelValue":T[7]||(T[7]=_=>s.value=_),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:o(()=>[t(Re,{class:"pa-0"},{default:o(()=>[t(Ya,{ref:"refundForm",id:"refund-form",onSubmit:T[4]||(T[4]=Xt(_=>A(_),["prevent"]))},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[t(me,{modelValue:l.value.Amount,"onUpdate:modelValue":T[0]||(T[0]=_=>l.value.Amount=_),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:o(()=>[t(re,{modelValue:l.value.Reason,"onUpdate:modelValue":T[1]||(T[1]=_=>l.value.Reason=_),modelModifiers:{number:!0},items:U.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12"},{default:o(()=>[t(me,{modelValue:l.value.Description,"onUpdate:modelValue":T[2]||(T[2]=_=>l.value.Description=_),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[t(ne,{color:"error",class:"w-100",onClick:T[3]||(T[3]=_=>s.value=!1)},{default:o(()=>[w("Cancel")]),_:1})]),_:1}),t(qe),t(b,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[t(ne,{type:"submit",color:"success",class:"w-100"},He({default:o(()=>[w(" Issue Refund ")]),_:2},[I.value?{name:"prepend",fn:o(()=>[t(Pa,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(ht,{modelValue:n.value,"onUpdate:modelValue":T[6]||(T[6]=_=>n.value=_)},{actions:o(()=>[t(ne,{variant:"text",onClick:T[5]||(T[5]=_=>n.value=!1)},{default:o(()=>[w(" Close ")]),_:1})]),default:o(()=>[w(V(a.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),un=["colspan"],rn=h("strong",null,"Details",-1),dn=["innerHTML"],mn=de({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:p}){const s=e;let{hideHistory:i=!1,registration:n,showEditor:a}=s;const m=Ie(),l=c([]),U=c([]),I=c([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),A=c(!1),f=c(),v=c(!1),T=c(""),_=c([{key:"CreatedAt",order:"asc"}]),Y=()=>({PaymentTransactionUUID:Ne(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:At.PAYMENT_TRANSACTION_SOURCE_NULL,Type:et.PAYMENT_TRANSACTION_TYPE_NULL}),R=c(Y()),{convertTransactions:C,getPaymentTransactionsDisplay:O}=Ot();ue(s,()=>{i=s.hideHistory,n=s.registration,a=s.showEditor,O(n.RegistrationUUID).then(K=>{U.value=K})});const k=()=>{O(n.RegistrationUUID).then(K=>{U.value=K})};k();const X=()=>{m.saveRegistrationPaymentTransaction(R.value).then(K=>{K&&(C(K.PaymentTransactions),R.value=Y(),p("close-editor"),p("change"))})},te=K=>{const E=U.value.find(S=>S.PaymentTransactionUUID===K);E&&(f.value=E.PaymentTransaction,A.value=!0)},se=K=>{if(K)try{U.value=C(K.PaymentTransactions),f.value=void 0,A.value=!1,T.value="Refund Processed",v.value=!0,p("change")}catch(E){console.error(E)}};return(K,E)=>(u(),y(F,null,[H(a)?(u(),y(F,{key:0},[t(xa,null,{default:o(()=>[w(" Add Transaction ")]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(re,{items:H(La),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:R.value.Type,"onUpdate:modelValue":E[0]||(E[0]=S=>R.value.Type=S),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(re,{items:H(Fa),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:R.value.Source,"onUpdate:modelValue":E[1]||(E[1]=S=>R.value.Source=S),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(me,{label:"Description","hide-details":"",modelValue:R.value.Description,"onUpdate:modelValue":E[2]||(E[2]=S=>R.value.Description=S),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(me,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:R.value.Amount,"onUpdate:modelValue":E[3]||(E[3]=S=>R.value.Amount=S),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(ne,{class:"w-100",onClick:E[4]||(E[4]=S=>p("close-editor")),color:"warning"},{default:o(()=>[w("Cancel")]),_:1})]),_:1}),t(qe),t(b,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(ne,{class:"w-100",onClick:X,color:"primary"},{default:o(()=>[w("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):j("",!0),U.value.length&&!H(i)?(u(),G(Ct,{key:1,class:"my-2"},{default:o(()=>[t(gt,null,{default:o(()=>[t(Rt,null,{default:o(()=>[w(" Transaction History ")]),_:1}),t(It,null,{default:o(()=>[t(H(yt),{items:U.value,headers:I.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:l.value,"onUpdate:expanded":E[5]||(E[5]=S=>l.value=S),"sort-by":_.value,"onUpdate:sortBy":E[6]||(E[6]=S=>_.value=S),class:"transactionTable"},{"item.Controls":o(({item:S})=>[K.canEdit&&S.raw.PaymentTransaction.Source===H(At).PAYMENT_TRANSACTION_SOURCE_STRIPE&&S.raw.PaymentTransaction.Type===H(et).PAYMENT_TRANSACTION_TYPE_PAYMENT?(u(),G(ne,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:L=>te(S.key)},null,8,["onClick"])):j("",!0)]),"expanded-row":o(({columns:S,item:L})=>[h("tr",null,[h("td",{colspan:S.length},[rn,h("div",{innerHTML:L.raw.HTML},null,8,dn)],8,un)])]),"footer.prepend":o(()=>[t(ne,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:k},{default:o(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),A.value&&f.value?(u(),G(sn,{key:0,modelValue:A.value,"onUpdate:modelValue":E[7]||(E[7]=S=>A.value=S),"payment-transaction":f.value,onRefunded:se},null,8,["modelValue","payment-transaction"])):j("",!0),t(ht,{modelValue:v.value,"onUpdate:modelValue":E[9]||(E[9]=S=>v.value=S)},{actions:o(()=>[t(ne,{variant:"text",onClick:E[8]||(E[8]=S=>v.value=!1)},{default:o(()=>[w(" Close ")]),_:1})]),default:o(()=>[w(V(T.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const cn=(e=void 0,p)=>e===void 0?!1:ja(e,qa.GROUP_TYPE_CONVENTION,p.ConventionUUID,p).EditPaymentTransactions,je=e=>(Zt("data-v-a5bd0dd4"),e=e(),ea(),e),vn={class:"mb-4"},Un={class:"v-row"},An={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},_n={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Tn={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},fn={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},En=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),Sn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},pn=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),Dn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Rn=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),In={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},yn=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),gn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Cn=de({__name:"PaymentActions",props:_e({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const s=e,i=$e(e,"modelValue"),{registration:n}=s,a=c(!1),m=c(!1),l=c(),U=c([]),I=c(new Date().getTime()),A=c(!1),f=ot(s,p,void 0,void 0,"registration"),v=c(Te(f.value));ue(f,()=>{v.value=Te(f.value)});const T=Ie();T.getConvention(n.ConventionUUID).then(C=>{C&&(A.value=cn(Qa(),C))});const _=()=>{T.generateRegistrationCharges(n.RegistrationUUID,!1).then(C=>{C&&(U.value=C.PaymentTransactions,l.value=C.Registration,I.value=new Date().getTime())}).catch(()=>{})};_();const Y=()=>{T.generateRegistrationCharges(n.RegistrationUUID,!0).then(C=>{C&&(U.value=C.PaymentTransactions,l.value=C.Registration,I.value=new Date().getTime())})},{totalCharges:R}=Ot();return(C,O)=>(u(),G(Be,{modelValue:i.value,"onUpdate:modelValue":O[3]||(O[3]=k=>i.value=k),title:C.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Re,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[l.value?(u(),y(F,{key:0},[h("h3",vn,"#"+V(l.value.Reference)+" "+V(l.value.User.DisplayName),1),h("dl",Un,[(u(!0),y(F,null,ee(U.value,k=>(u(),y(F,{key:k.PaymentTransactionUUID},[k.Type===H(et).PAYMENT_TRANSACTION_TYPE_CHARGE?(u(),y("dt",An,[h("div",_n,V(k.Description.split(":")[0])+": ",1),h("div",Tn,V(k.Description.split(":")[1]),1)])):j("",!0),h("dd",fn," £"+V(k.Amount),1)],64))),128)),En,h("dd",Sn," £"+V(H(R)(U.value)),1),pn,h("dd",Dn," £"+V(l.value.Total),1),Rn,h("dd",In," £"+V(l.value.Paid),1),yn,h("dd",gn," £"+V(l.value.Total-l.value.Paid),1)]),t(J,{class:"flex-row-reverse"},{default:o(()=>[t(b,{class:"text-right"},{default:o(()=>[t(ne,{color:"primary",onClick:Y},{default:o(()=>[w("Apply Charges")]),_:1})]),_:1}),!m.value&&A.value?(u(),G(b,{key:0},{default:o(()=>[t(ne,{color:"secondary",onClick:O[0]||(O[0]=k=>m.value=!0)},{default:o(()=>[w("Transaction Entry")]),_:1})]),_:1})):j("",!0)]),_:1})],64)):j("",!0),t(mn,{"can-edit":A.value,registration:H(n),"show-editor":m.value,onCloseEditor:O[1]||(O[1]=k=>m.value=!1),updated:I.value,onChange:_},null,8,["can-edit","registration","show-editor","updated"]),t(kt,{registration:H(n),"show-editor":a.value,onCloseEditor:O[2]||(O[2]=k=>a.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const On=at(Cn,[["__scopeId","data-v-a5bd0dd4"]]),Mn=de({__name:"RegistrationActions",props:_e({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const s=e,i=$e(e,"modelValue"),n=c(!1),a=ot(s,p,void 0,void 0,"registration"),m=c(Te(a.value));ue(a,()=>{m.value=Te(a.value)});const l=Ie(),U=(I,A)=>{const f=m.value.Submissions.find(v=>v.SubmissionUUID==A);if(!f){I&&I("Submission not found");return}l.setSubmissionStatus(A,f.Status).then(v=>{v?(m.value.Submissions.forEach((T,_)=>{a.value.Submissions[_].Status=T.Status}),I&&I("Status Saved")):I&&I("Status not saved")}).catch(()=>{I&&I("Status not saved")})};return(I,A)=>(u(),G(Be,{modelValue:i.value,"onUpdate:modelValue":A[2]||(A[2]=f=>i.value=f),title:I.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Re,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[h("h3",null,"#"+V(I.registration.Reference)+" "+V(I.registration.User.DisplayName),1),t(xe,null,{default:o(()=>[(u(!0),y(F,null,ee(m.value.Submissions,f=>(u(),G(Pe,{key:f.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(J,{class:"py-2 align-center"},{default:o(()=>[t(b,{cols:"8"},{default:o(()=>{var v;return[t(re,{modelValue:f.Status,"onUpdate:modelValue":T=>f.Status=T,items:H(_t),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((v=I.forms.find(T=>T.FormUUID==f.FormUUID))==null?void 0:v.Name)||""},{selection:o(()=>[t(ba,{class:"mr-4"},{default:o(()=>{var T;return[w(V((T=H(_t).find(_=>_.value===f.Status))==null?void 0:T.icon),1)]}),_:2},1024),w(" "+V(H(Mt)(f.Status)),1)]),item:o(({item:T,props:{onClick:_}})=>[t(Pe,{title:T.title,"prepend-icon":T.raw.icon,onClick:_},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(b,{cols:"4"},{default:o(()=>[t(tt,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:v=>U(v.callback,f.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12"},{default:o(()=>[t(ne,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:A[0]||(A[0]=f=>n.value=!0)},{default:o(()=>[w("Prepare Email")]),_:1})]),_:1})]),_:1}),t(kt,{registration:I.registration,"show-editor":n.value,onCloseEditor:A[1]||(A[1]=f=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const ml=de({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:p}){var it;const s=Ga();p("pageTitle","Registration Manager");const i=ta(),n=aa(),a=c(!0);let m=((it=i.params.convention)==null?void 0:it.toString())||"";const l=c({ID:0,ConventionUUID:Ne(),OrganisationID:0,OrganisationUUID:Xe,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),U=Ie(),I=oa.getInstance(),A=c({ID:0,AdminLayoutUUID:Ne(),ConventionID:l.value.ID,ConventionUUID:l.value.ConventionUUID,Name:"Registration Table",Type:Vt.ADMIN_LAYOUT_TABLE,Panels:[]}),f=c([]),v=c([]),T=c([]),_=c([]),Y=c([]),R=c(1),C=c(10),O=c([]),k=c(0),X=c(!1),te=c(""),se=c(""),K=c(""),E=c(""),S=c({FieldUUID:"591c9bca-c78c-4e97-8aef-bc596ef472fb",Value:""}),L=c(new Map([["591c9bca-c78c-4e97-8aef-bc596ef472fb",S.value]])),M=c(""),B=c(""),ae=c([]),oe=c([]),z=c([]),Me=c([]),he=c([]),Ve=c([]),ve=c(0),le=c(),pe=c(!1),De=c(!1),ye=c(),nt=c(),Qe=c(),be=c(!1);ue(te,r=>{const d=Y.value.find(D=>D.uuid===r);if(d){const D=d.headers.find(g=>g.defaultSort===!0);D&&(O.value=[{key:D.key,order:"asc"}],ae.value=[{key:D.key,order:"asc"}])}}),ue(ve,r=>{r===7&&lt()}),ue(M,()=>{se.value=Date.now().toString()}),ue(B,()=>{se.value=Date.now().toString()});const Nt=()=>{f.value=[],T.value=[],Y.value=[];try{U.getConventionAdminLayoutByName(l.value.ConventionUUID,"Registration Table").then(r=>{ve.value+=1,r?A.value=r:(A.value.ConventionID=l.value.ID,A.value.ConventionUUID=l.value.ConventionUUID)})}catch{A.value.ConventionID=l.value.ID,A.value.ConventionUUID=l.value.ConventionUUID}try{U.getConventionForms(l.value.ConventionUUID).then(r=>{ve.value+=1,r&&(f.value=r)})}catch{}try{U.getConventionAccommodation(l.value.ConventionUUID).then(r=>{ve.value+=1,r&&(oe.value=r)})}catch{}try{U.getConventionVenues(l.value.ConventionUUID).then(r=>{ve.value+=1,r&&(Ve.value=r)})}catch{}try{U.getConventionExtras(l.value.ConventionUUID).then(r=>{ve.value+=1,r&&(z.value=r)})}catch{}try{U.getConventionInterests(l.value.ConventionUUID).then(r=>{ve.value+=1,r&&(Me.value=r)})}catch{}try{U.getConventionTickets(l.value.ConventionUUID).then(r=>{ve.value+=1,r&&(he.value=r)})}catch{}try{U.getConventionGroups(l.value.ConventionUUID).then(r=>{r&&(v.value=r.sort((d,D)=>d.Name.localeCompare(D.Name)))})}catch{}try{U.getConventionTags(l.value.ConventionUUID).then(r=>{r&&(_.value=r.sort((d,D)=>d.Title.localeCompare(D.Title)).map(d=>(d.Title=`${d.Title} [${d.Key}]`,d)))})}catch{}},Ke=({page:r,itemsPerPage:d,sortBy:D})=>{a.value=!0,R.value=r,O.value=D;const g=Y.value.find(W=>W.uuid==te.value),Ue=g==null?void 0:g.layout.Items;let ie="",st="";if(D&&Ue&&D.length>=1){const W=Ue.find(Le=>Le.LayoutItemUUID==D[0].key);switch(st=D[0].order||"asc",W==null?void 0:W.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:ie="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:ie="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ie="submission.status";break}switch(W==null?void 0:W.UserField){case Z.USER_DATA_SOURCE_DISPLAY_NAME:ie="user.display_name";break;case Z.USER_DATA_SOURCE_EMAIL:ie="user.email";break;case Z.USER_DATA_SOURCE_FIRST_NAME:ie="user.firstname";break;case Z.USER_DATA_SOURCE_HANDLE:ie="user.handle";break;case Z.USER_DATA_SOURCE_LAST_NAME:ie="user.lastname";break}}try{const W={Direction:st,Limit:d,Offset:(r-1)*d,Order:ie};g&&g.layout.RequiredRegistrationTags.length>0&&(W.PanelUUID=g==null?void 0:g.layout.LayoutPanelUUID),(g==null?void 0:g.layout.RequiredFormType)===Se.FORM_TYPE_ACCOMMODATION&&(W.Accommodation=!0),(g==null?void 0:g.layout.RequiredFormType)===Se.FORM_TYPE_BADGE&&(W.Badge=!0),(g==null?void 0:g.layout.RequiredFormType)===Se.FORM_TYPE_DEALER&&(W.Dealer=!0),(g==null?void 0:g.layout.RequiredFormType)===Se.FORM_TYPE_REGISTRATION&&(W.Registration=!0),W.GroupUUID=M.value||Xe,W.TagUUID=B.value||Xe,W.Email=E.value,W.Reference=K.value,W.FieldValues=Array.from(L.value.values()),U.searchConventionRegistrations(l.value.ConventionUUID,W).then(Le=>{Le&&(k.value=Le.Total,T.value=Le.Registrations,Y.value.forEach(We=>{const Gt=We.layout;We.items=T.value.map($=>{const Ge=[];let fe;$.Leader?fe=$:fe=$.Primary,Ge.push({Name:fe.User.DisplayName,UUID:fe.UserUUID,UserUUID:fe.User.UserUUID,IsLeader:!0,Reference:fe.Reference,Paid:fe.Paid,Total:fe.Total}),Ge.push(...fe.Members.map(Ee=>({Name:Ee.User.DisplayName,UUID:Ee.UserUUID,UserUUID:Ee.User.UserUUID,IsLeader:!1,Reference:Ee.Reference,Paid:Ee.Paid,Total:Ee.Total})));const q={};return We.headers.forEach(Ee=>{var ut;const P=Gt.Items.find(Fe=>Fe.LayoutItemUUID===Ee.key);if(P){if(P.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&P.SectionField)$.Submissions.forEach(Fe=>{const ke=Fe.Data.find(N=>N.SectionFieldUUID===P.SectionFieldUUID);if(ke){Ee.type===ua.ACCOMMODATION?q[P.LayoutItemUUID]={Data:ke.Data,Registration:$}:q[P.LayoutItemUUID]=ke.Data;return}});else if(P.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&P.UserField)switch(P.UserField){case Z.USER_DATA_SOURCE_AVATAR:q[P.LayoutItemUUID]=s.GetProfileImageURL($.UserUUID);break;case Z.USER_DATA_SOURCE_DISPLAY_NAME:q[P.LayoutItemUUID]=$.User.DisplayName;break;case Z.USER_DATA_SOURCE_EMAIL:q[P.LayoutItemUUID]=$.User.Additional.Email;break;case Z.USER_DATA_SOURCE_HANDLE:q[P.LayoutItemUUID]=$.User.Handle;break;case Z.USER_DATA_SOURCE_DATE_OF_BIRTH:q[P.LayoutItemUUID]=$.User.Additional.DOB;break;case Z.USER_DATA_SOURCE_FIRST_NAME:q[P.LayoutItemUUID]=$.User.Additional.FirstName;break;case Z.USER_DATA_SOURCE_LAST_NAME:q[P.LayoutItemUUID]=$.User.Additional.LastName;break;case Z.USER_DATA_SOURCE_TELEGRAM:q[P.LayoutItemUUID]="";break}else if(P.SourceType==="LAYOUT_ITEM_SOURCE_META"&&P.MetaField){const Fe=(ut=f.value.find(N=>N.Type===Se.FORM_TYPE_REGISTRATION))==null?void 0:ut.FormUUID,ke=$.Submissions.find(N=>N.FormUUID===Fe);switch(P.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:q[P.LayoutItemUUID]=$;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:q[P.LayoutItemUUID]=Ge;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:q[P.LayoutItemUUID]=$.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(ke){const N=new Date(ke.CreatedAt||"");q[P.LayoutItemUUID]=`${N.getFullYear()}-${(N.getMonth()+1).toString().padStart(2,"0")}-${N.getDate().toString().padStart(2,"0")} ${N.getHours().toString().padStart(2,"0")}:${N.getMinutes().toString().padStart(2,"0")}:${N.getSeconds().toString().padStart(2,"0")}`}else{const N=new Date($.CreatedAt||"");q[P.LayoutItemUUID]=`${N.getFullYear()}-${(N.getMonth()+1).toString().padStart(2,"0")}-${N.getDate().toString().padStart(2,"0")} ${N.getHours().toString().padStart(2,"0")}:${N.getMinutes().toString().padStart(2,"0")}:${N.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:q[P.LayoutItemUUID]=$.Submissions.map(N=>{const x=f.value.find(ge=>ge.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:$}}).filter(N=>{var x;return((x=N.Form)==null?void 0:x.Type)===Se.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:q[P.LayoutItemUUID]=$.Submissions.map(N=>{const x=f.value.find(ge=>ge.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:$}}).filter(N=>{var x;return((x=N.Form)==null?void 0:x.Type)===Se.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:q[P.LayoutItemUUID]=$.Submissions.map(N=>{const x=f.value.find(ge=>ge.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:$}}).filter(N=>{var x;return((x=N.Form)==null?void 0:x.Type)===Se.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if($.Paid===0&&$.Total)q[P.LayoutItemUUID]="REQUIRED";else if($.Total>$.Paid)q[P.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const N=Ge.find(x=>x.Paid===0&&(x.Total||0)>0);if(N){$.Total===0&&N.Total===0?q[P.LayoutItemUUID]="NOT_REQUIRED":$.Total===0&&N.Total||$.Total>0&&N.Total===0?q[P.LayoutItemUUID]="MISSING_REQUIRED":$.Paid>=$.Total?q[P.LayoutItemUUID]="AWAITING_PARTNER":q[P.LayoutItemUUID]="ALL_REQUIRED";break}else $.Total===0?q[P.LayoutItemUUID]="NOT_REQUIRED":q[P.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:Ba($.Submissions,f.value),q[P.LayoutItemUUID]=$.Submissions.map(N=>{const x=f.value.find(ge=>ge.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:$}});break}}}}),q})}),a.value=!1)})}catch{}},Lt=r=>{X.value=!1,r&&(A.value=r,lt())},lt=()=>{A.value.Panels.forEach(r=>{r.Items.forEach(d=>{(d.SectionField==null||d.SectionField.Field==null)&&f.value.find(D=>{D.Sections.find(g=>{if(g.Fields){const Ue=g.Fields.find(ie=>ie.SectionFieldUUID===d.SectionFieldUUID);if(Ue)return d.SectionField=Ue,!0}})})})}),A.value.Panels.length>0&&(Y.value=[],A.value.Panels.forEach(r=>{const d={uuid:Ne(),order:r.Order,name:r.Name,headers:[],items:[],layout:r};r.Items.sort((D,g)=>D.Order>g.Order?1:D.Order==g.Order?0:-1),d.headers=r.Items.map(D=>{var g,Ue;return{key:D.LayoutItemUUID,title:D.Label||((Ue=(g=D.SectionField)==null?void 0:g.Field)==null?void 0:Ue.Label)||"",align:D.Align==="end"?"end":"start",sortable:Pt(D),type:Ft(D),defaultSort:D.DefaultSort}}),Y.value.push(d)}),Y.value=Y.value.sort((r,d)=>r.order>d.order?1:r.order==d.order?0:-1)),(te.value==null||te.value=="")&&Y.value.length>0&&(te.value=Y.value[0].uuid)};m?U.getConvention(m).then(r=>{r&&(l.value=r,A.value.ConventionID=l.value.ID,A.value.ConventionUUID=l.value.ConventionUUID,Nt())}).catch(()=>{n.push("/")}):n.push("/");const Ft=r=>{var d,D;if(r.SourceType===we.LAYOUT_ITEM_SOURCE_META)return`${r.SourceType}.${r.MetaField}`;if(r.SourceType===we.LAYOUT_ITEM_SOURCE_FORM)return(D=(d=r.SectionField)==null?void 0:d.Field)==null?void 0:D.Type;if(r.SourceType===we.LAYOUT_ITEM_SOURCE_USER)return`${r.SourceType}.${r.UserField}`},Pt=r=>{const d=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],D=[Z.USER_DATA_SOURCE_DISPLAY_NAME,Z.USER_DATA_SOURCE_EMAIL,Z.USER_DATA_SOURCE_HANDLE,Z.USER_DATA_SOURCE_DATE_OF_BIRTH,Z.USER_DATA_SOURCE_FIRST_NAME,Z.USER_DATA_SOURCE_LAST_NAME];return d.includes(r.MetaField)||D.includes(r.UserField)},wt=r=>{le.value=r,pe.value=!0},$t=r=>{le.value=r,De.value=!0};ue(pe,r=>{r||(le.value=void 0)}),ue(De,r=>{r||(le.value=void 0)});const ze=async(r="")=>{nt.value=await U.getRegistrationGroup(r)},Bt=({registration:r,form:d,submission:D})=>{le.value=r,ze(r.RegistrationUUID).then(()=>{ye.value=d,Qe.value=D,be.value=!0})};return I.on("registration.group.leave",r=>{U.leaveRegistrationGroup(r).then(d=>{d&&ze(r).then(()=>{I.emit("registration.group.left",d)})})}),I.on("registration.group.remove.member",r=>{U.leaveRegistrationGroup(r).then(d=>{d&&ze(r).then(()=>{I.emit("registration.group.left",d)})})}),(r,d)=>(u(),G(Wa,null,{default:o(()=>[t(ft,{color:"blue-darken-4"},{default:o(()=>[t(Ca,{modelValue:te.value,"onUpdate:modelValue":d[0]||(d[0]=D=>te.value=D),"show-arrows":""},{default:o(()=>[(u(!0),y(F,null,ee(Y.value,D=>(u(),G(Oa,{key:D.uuid,value:D.uuid},{default:o(()=>[w(V(D.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(qe),t(ne,{icon:"mdi:mdi-cog-outline",onClick:d[1]||(d[1]=D=>X.value=!0)})]),_:1}),t(ha,{modelValue:te.value,"onUpdate:modelValue":d[16]||(d[16]=D=>te.value=D),disabled:!0},{default:o(()=>[(u(!0),y(F,null,ee(Y.value,D=>(u(),G(Ma,{key:D.uuid,value:D.uuid},{default:o(()=>[D.uuid===te.value?(u(),G(Tt,{key:0,class:"pa-2"},{default:o(()=>[t(H(no),{"items-per-page":C.value,"onUpdate:itemsPerPage":d[14]||(d[14]=g=>C.value=g),"sort-by":ae.value,"onUpdate:sortBy":d[15]||(d[15]=g=>ae.value=g),headers:D.headers,"items-length":k.value,items:D.items,"item-value":"LayoutItemUUID",loading:a.value,search:se.value,"onUpdate:options":Ke},He({top:o(()=>[t(Re,null,{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"12",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(me,{modelValue:K.value,"onUpdate:modelValue":d[2]||(d[2]=g=>K.value=g),label:"Search by Badge",clearable:!0,"hide-details":"","onClick:clear":d[3]||(d[3]=g=>se.value=Date.now().toString()),onInput:d[4]||(d[4]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"12",md:"4",lg:"5",xl:"3"},{default:o(()=>[t(me,{modelValue:S.value.Value,"onUpdate:modelValue":d[5]||(d[5]=g=>S.value.Value=g),label:"Search By Furry Name",clearable:!0,"hide-details":"","onClick:clear":d[6]||(d[6]=g=>se.value=Date.now().toString()),onInput:d[7]||(d[7]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"12",md:"5",lg:"5",xl:"3"},{default:o(()=>[t(me,{modelValue:E.value,"onUpdate:modelValue":d[8]||(d[8]=g=>E.value=g),label:"Search By Email",clearable:!0,"hide-details":"","onClick:clear":d[9]||(d[9]=g=>se.value=Date.now().toString()),onInput:d[10]||(d[10]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"6",lg:"6",xl:"2"},{default:o(()=>[t(re,{modelValue:M.value,"onUpdate:modelValue":d[11]||(d[11]=g=>M.value=g),label:"Search By Group",clearable:!0,"hide-details":"",items:v.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",sm:"6",md:"6",lg:"6",xl:"2"},{default:o(()=>[t(re,{modelValue:B.value,"onUpdate:modelValue":d[12]||(d[12]=g=>B.value=g),label:"Search By Tag",clearable:!0,"hide-details":"",items:_.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[ee(D.headers,g=>({name:`item.${g.key}`,fn:o(({item:Ue})=>[t(Go,{header:g,item:Ue,accommodations:oe.value,convention:l.value,extras:z.value,forms:f.value,interests:Me.value,tickets:he.value,venues:Ve.value,onOpenActions:wt,onOpenPayments:$t,onReload:d[13]||(d[13]=ie=>Ke({page:R.value,itemsPerPage:C.value,sortBy:O.value})),onShowForm:Bt},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):j("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),X.value?(u(),G(lo,{key:0,title:"Edit Layout",modelValue:X.value,"onUpdate:modelValue":d[17]||(d[17]=D=>X.value=D),layout:A.value,onSave:Lt},null,8,["modelValue","layout"])):j("",!0),le.value?(u(),y(F,{key:1},[pe.value?(u(),G(Mn,{key:0,modelValue:pe.value,"onUpdate:modelValue":d[18]||(d[18]=D=>pe.value=D),registration:le.value,"onUpdate:registration":d[19]||(d[19]=D=>le.value=D),accommodations:oe.value,convention:l.value,extras:z.value,forms:f.value,interests:Me.value,tickets:he.value,title:"Registration Status & Communications",venues:Ve.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):De.value?(u(),G(On,{key:1,modelValue:De.value,"onUpdate:modelValue":d[20]||(d[20]=D=>De.value=D),registration:le.value,"onUpdate:registration":d[21]||(d[21]=D=>le.value=D),accommodations:oe.value,convention:l.value,extras:z.value,forms:f.value,interests:Me.value,tickets:he.value,title:"Registration Payments",venues:Ve.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):j("",!0)],64)):j("",!0),be.value&&Qe.value&&ye.value?(u(),G(Ja,{key:2,modelValue:be.value,"onUpdate:modelValue":d[25]||(d[25]=D=>be.value=D),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(Tt,{class:"bg-red-darken-4"},{default:o(()=>[t(ft,{color:"error"},{default:o(()=>[t(za,null,{default:o(()=>[w("Submission Editor - Admin Mode")]),_:1}),t(qe),t(Ka,null,{default:o(()=>[t(ne,{icon:"mdi:mdi-window-close",onClick:d[22]||(d[22]=D=>be.value=!1)})]),_:1})]),_:1}),t(Ha,null,{default:o(()=>[t(sa,{modelValue:ye.value,"onUpdate:modelValue":d[23]||(d[23]=D=>ye.value=D),admin:!0,convention:l.value,data:Qe.value,editable:!0,"registration-group":nt.value,onClose:d[24]||(d[24]=D=>{be.value=!1,Ke({page:R.value,itemsPerPage:C.value,sortBy:O.value})})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0)]),_:1}))}});export{ml as default};
