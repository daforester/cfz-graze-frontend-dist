import{F as Q}from"./form-3a7bf7fd.js";import{P as W}from"./permission-435f8ef2.js";import{I as A,a0 as O,a1 as Y,r as f,K as h,w as j,M as r,N as c,O as e,W as I,v as t,a3 as G,_ as B,L as X,S as U,P as N,Q as J,X as Z,V as k,a7 as ee,a4 as te,H as oe}from"./index-a13ce8de.js";import{a as H}from"./scopeId-c1a4fedb.js";import{_ as ne}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-b415ab61.js";import{u as ae,V as le}from"./VCheckbox-a0248995.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-3ef7576a.js";import{s as R}from"./index-26b71cef.js";import{V as y,a as _}from"./VRow-2cb2b821.js";import{V as q}from"./VAvatar-eeb24497.js";import{V as F}from"./VTextField-10836387.js";import{V as se}from"./VTextarea-d7223a4b.js";import{V as ue}from"./VForm-8e981779.js";import{V as re}from"./VFileInput-7f24f2f1.js";import{j as z}from"./VContainer-0c059b3f.js";import{G as P}from"./group-d2a77946.js";import{C as $}from"./canDo-99eb87c2.js";import{C as de}from"./canEditRegistrations-68b5b4be.js";import{G as K}from"./userData-0449de80.js";import{e as me,V as ve,a as fe,c as M,b as ce,d as pe}from"./VCard-c97fb22d.js";import{V as E}from"./VBtn-7ab2e771.js";import{C as ge}from"./canEditOrganisation-afda20f6.js";import{v as _e}from"./v4-a960c1f4.js";import{u as Ce}from"./nil-d01db1aa.js";import"./createSimpleFunctional-a6d88f38.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-8be1309b.js";import"./forwardRefs-fbcb17e9.js";import"./VDialog-b17bbb4c.js";import"./VToolbar-006434ff.js";import"./VChip-30fbc5ca.js";const Ve=(p=void 0,d=void 0)=>p===void 0?!1:d===void 0?$(p,P.GROUP_TYPE_CONVENTION).EditConvention:$(p,P.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).EditConvention,De=(p,d)=>p===void 0?!1:$(p,P.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).ViewRegistration,Ue=A({__name:"EditConventionDialog",props:O({convention:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:O(["update:convention","delete","save"],["update:modelValue"]),setup(p,{emit:d}){const D=p,a=G(),m=H(),{title:x=""}=D,C=Y(p,"modelValue"),g=ae(D,d,void 0,void 0,"convention"),n=f(h(g.value));j(g,()=>{n.value=h(g.value)});const V=f(`${m.GetConventionLogoURL(n.value.ConventionUUID)}?${new Date().getTime()}`),L=f(),w=f(),S=()=>{V.value=URL.createObjectURL(L.value.files[0])},b=()=>{d("delete")},i=()=>{n.value=h(g.value)},l=async()=>{var o;const u=new FormData((o=w.value)==null?void 0:o.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",n.value.ConventionUUID),await m.SaveConventionLogo(u)},s=u=>{l(),a.saveConvention(n.value).then(o=>{o?u&&u("Convention Data Saved").then(()=>{g.value=o,d("save",o)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,o)=>(r(),c(ie,{modelValue:C.value,"onUpdate:modelValue":o[5]||(o[5]=v=>C.value=v),onDelete:b,onReset:i,onSave:s,title:I(x),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(z,{class:"pa-0",fluid:!0},{default:e(()=>[t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(q,{class:"imgLogo mx-auto",src:V.value||""},null,8,["src"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(F,{label:I(R).formLabelName,name:"Name",variant:"outlined",modelValue:n.value.Name,"onUpdate:modelValue":o[0]||(o[0]=v=>n.value.Name=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(se,{label:I(R).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:n.value.Description,"onUpdate:modelValue":o[1]||(o[1]=v=>n.value.Description=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(F,{label:I(R).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:n.value.DetailLink,"onUpdate:modelValue":o[2]||(o[2]=v=>n.value.DetailLink=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(F,{label:I(R).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:n.value.Slug,"onUpdate:modelValue":o[3]||(o[3]=v=>n.value.Slug=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(le,{label:I(R).formConventionVisible,name:"Visible",modelValue:n.value.Visible,"onUpdate:modelValue":o[4]||(o[4]=v=>n.value.Visible=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(ue,{ref_key:"conventionImageForm",ref:w,enctype:"multipart/form-data"},{default:e(()=>[t(re,{label:I(R).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:L,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:S},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}});const Ie=B(Ue,[["__scopeId","data-v-003c7991"]]),ye=["innerHTML"],xe={key:0,class:"text-green"},Le={key:1,class:"text-red"},Ne={key:0,class:"text-green"},we={key:1,class:"text-red"},be=A({__name:"ConventionCard",props:O({open:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:O(["delete"],["update:modelValue"]),setup(p,{emit:d}){const D=G(),a=Y(p,"modelValue"),m=H(),x=K(),C=f(m.GetConventionLogoURL(a.value.ConventionUUID)),g=f(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),n=f(!1),V=f(!1),L=f(Ve(x,a.value)),w=f(de(x,a.value)),S=f(De(x,a.value)),b=()=>{V.value=!1,C.value=`${m.GetConventionLogoURL(a.value.ConventionUUID)}?ts=${Date.now()}`},i=l=>{D.deleteConvention(a.value.ConventionUUID).then(s=>{s?l&&(l("Convention Deleted"),d("delete")):l&&l("Failed to Delete Convention"),setTimeout(()=>{n.value=!1},2e3)}).catch(()=>{l&&(l("Failed to Delete Organisation"),n.value=!1)})};return(l,s)=>{const u=X("RouterLink");return r(),c(me,null,{default:e(()=>[t(ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[C.value?(r(),c(q,{key:0,src:C.value,title:a.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),a.value.Name?(r(),c(ve,{key:1},{default:e(()=>[N(J(a.value.Name),1)]),_:1})):U("",!0),a.value.Description?(r(),c(fe,{key:2,class:"text-wrap subtitle"},{default:e(()=>[Z("div",{innerHTML:a.value.Description},null,8,ye)]),_:1})):U("",!0),t(M,{class:"px-0 pb-0"},{default:e(()=>[N(" Visibility:  "),a.value.Visible?(r(),k("span",xe,"Visible")):(r(),k("span",Le,"Hidden"))]),_:1}),t(M,{class:"px-0 pb-0"},{default:e(()=>[N(" Registration:  "),l.open?(r(),k("span",Ne,"Open")):(r(),k("span",we,"Closed"))]),_:1})]),_:1}),t(pe,null,{default:e(()=>[t(y,{"no-gutters":""},{default:e(()=>[L.value?(r(),c(_,{key:0,class:"ma-1"},{default:e(()=>[t(E,{variant:"tonal",color:"primary",onClick:s[0]||(s[0]=o=>V.value=!0),width:"100%"},{default:e(()=>[N("Edit")]),_:1})]),_:1})):U("",!0),U("",!0),L.value?(r(),c(_,{key:2,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}`},{default:e(()=>[t(E,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[N("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),S.value||w.value?(r(),c(_,{key:3,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/registrations`},{default:e(()=>[t(E,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[N("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),V.value?(r(),c(Ie,{key:0,modelValue:V.value,"onUpdate:modelValue":s[1]||(s[1]=o=>V.value=o),convention:a.value,"onUpdate:convention":s[2]||(s[2]=o=>a.value=o),onDelete:s[3]||(s[3]=o=>n.value=!0),onSave:b,title:`${a.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),n.value?(r(),c(ne,{key:1,modelValue:n.value,"onUpdate:modelValue":s[4]||(s[4]=o=>n.value=o),"confirmation-text":"I UNDERSTAND",message:g.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:i},null,8,["modelValue","message"])):U("",!0)]),_:1})}}});const Te=B(be,[["__scopeId","data-v-ee930677"]]),Re=A({__name:"ConventionsView",emits:["pageTitle"],setup(p,{emit:d}){var b;d("pageTitle","Conventions");const D=G(),a=K(),m=f([]),x=f([]),C=ee();let g=((b=C.params.organisation)==null?void 0:b.toString())||"";const n=f();j(C,()=>{var i,l;g!==((i=C.params.organisation)==null?void 0:i.toString())&&(g=((l=C.params.organisation)==null?void 0:l.toString())||"",V())});const V=()=>{g?D.getOrganisation(g).then(i=>{i&&(n.value=i,D.getConventionList(i.OrganisationUUID).then(l=>{l&&(m.value=l,L())}))}).catch(()=>{}):D.getPermissionAccessList(W.PERMISSION_TYPE_NULL).then(i=>{i&&(m.value=i.Conventions,L())})},L=()=>{m.value.forEach(i=>{D.getConventionForms(i.ConventionUUID).then(l=>{l&&(x.value=[...x.value,...l])}).catch(l=>{console.error(l)})})},w=()=>{var i,l;if(n.value){const s={ID:0,ConventionUUID:_e(),OrganisationID:((i=n.value)==null?void 0:i.ID)||0,OrganisationUUID:((l=n.value)==null?void 0:l.OrganisationUUID)||Ce,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};D.saveConvention(s).then(u=>{u&&m.value.push(u)})}},S=i=>{m.value.splice(i,1)};return V(),(i,l)=>(r(),c(z,null,{default:e(()=>[t(y,{class:"justify-center"},{default:e(()=>[(r(!0),k(oe,null,te(m.value,(s,u)=>(r(),c(_,{key:s.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var o,v;return[t(Te,{modelValue:m.value[u],"onUpdate:modelValue":T=>m.value[u]=T,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((o=s.Organisation)==null?void 0:o.Slug)||((v=s.Organisation)==null?void 0:v.OrganisationUUID)||"",open:!!x.value.find(T=>T.ConventionUUID===s.ConventionUUID&&T.Type===I(Q).FORM_TYPE_REGISTRATION&&T.State.New),onDelete:T=>S(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(y,null,{default:e(()=>[n.value&&I(ge)(I(a),n.value)?(r(),c(_,{key:0,class:"text-right"},{default:e(()=>[t(E,{color:"primary",onClick:w},{default:e(()=>[N("New")]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}});const st=B(Re,[["__scopeId","data-v-c7b95705"]]);export{st as default};
