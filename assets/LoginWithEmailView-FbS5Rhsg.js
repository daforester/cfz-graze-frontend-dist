import{i as S,r as n,q as w,v as e,z as H,B as D,y as V,C as o,x as u,F as G,D as m,f as t,A as h,U as O,P as J,l as K,n as r,G as Q,H as X,_ as Y}from"./index-qrnKhx_T.js";import{s as M}from"./index-OKsbKlsK.js";import{S as U}from"./setupLogin-cxDSA0Pc.js";import{E as c}from"./emailFormVariant-1EY2p0cn.js";import{V as ee}from"./VForm-9fBepPZ3.js";import{a as k,V as A}from"./VRow-UcVvURYV.js";import{V as B}from"./VTextField-0XScCu3_.js";import{V as L}from"./VBtn-Av-8rse3.js";import{a as z}from"./VContainer-gWvyuF1h.js";import{G as ae}from"./userData-jTd1ttDI.js";import{V as te,a as le,c as re,e as se}from"./VCard-Y7aFevFa.js";import"./forwardRefs-U4OdwkyO.js";import"./VAvatar-kJpqjpP2.js";import"./createSimpleFunctional-InvJdGk4.js";const C=p=>(Q("data-v-07d5624d"),p=p(),X(),p),oe={key:1,class:"ma-auto text-left"},ne={key:2,class:"ma-auto text-left"},ue={key:3,class:"ma-auto text-left"},ie=C(()=>m("br",null,null,-1)),de=C(()=>m("br",null,null,-1)),ce={class:"text-red-darken-1 font-weight-bold"},me=C(()=>m("br",null,null,-1)),fe=C(()=>m("br",null,null,-1)),ve=C(()=>m("br",null,null,-1)),pe=C(()=>m("span",{class:"text-red-darken-4"}," Please contact registration if you require further assistance. ",-1)),_e={class:"text-center mt-4"},ge=S({__name:"EmailLoginForm",props:{variant:{default:()=>c.COMBINED}},setup(p){const I=O(),E=J(),_=n(!0),y=n(!1),T=n(!1),N=n(!1),s=n(""),g=n(""),R=n(!1),f=n({required:a=>!!a||"Required.",min:a=>a.length>=8||"Min 8 characters",email:a=>!!a.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),i=n(""),d=n(!1),q=new URL(location.href).searchParams.get("token")||"";q!==""&&(_.value=!1,N.value=!0,E.validateAccount(q,p.variant).then(({created:a,tokens:l,user:b})=>{try{U(l,b,I,a)}catch(v){console.error(v)}}).catch(a=>{console.error(a),i.value=a.ErrorMessage}));const x=()=>(i.value="",!(f.value.required(s.value)!==!0||f.value.email(s.value)!==!0||f.value.required(g.value)!==!0||f.value.min(g.value)!==!0)),$=a=>{if(a.preventDefault(),!x())return;const b=new URL(location.href).searchParams.get("state");d.value=!0,E.oAuthLogin("internal",s.value,g.value,b||"").then(({created:v,tokens:Z,user:j})=>{U(Z,j,I,v)}).catch(()=>{i.value="Login failed, check credentials or register",d.value=!1})},F=a=>{a.preventDefault(),x()&&(d.value=!0,E.registerAccount(s.value,g.value).then(l=>{_.value=!1,l&&(T.value=!0)}).catch(()=>{i.value="Unable to register, address may be in use",d.value=!1}))},W=()=>{E.requestLoginLink(s.value).then(a=>{_.value=!1,a&&(y.value=!0)}).catch(()=>{i.value="A problem was encountered, please try again",d.value=!1})};return(a,l)=>{const b=K("router-link");return _.value?(r(),w(ee,{key:0,onSubmit:l[3]||(l[3]=H(()=>{},["stop"])),class:"ma-auto vForm",disabled:d.value},{default:e(()=>[t(A,null,{default:e(()=>[t(k,null,{default:e(()=>[t(B,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=v=>s.value=v),rules:[f.value.required,f.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(A,null,{default:e(()=>[t(k,null,{default:e(()=>[t(B,{margin:"normal",required:"",name:"password",label:"Password",type:R.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=v=>g.value=v),"append-icon":R.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":l[2]||(l[2]=v=>R.value=!R.value),counter:"",hint:"At least 8 characters",rules:[f.value.required,f.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),i.value?(r(),w(A,{key:0},{default:e(()=>[t(k,{class:"text-red-darken-1 font-weight-bold"},{default:e(()=>[u(V(i.value),1)]),_:1})]),_:1})):h("",!0),t(A,{justify:"space-between"},{default:e(()=>[a.variant===o(c).COMBINED||a.variant===o(c).REGISTER?(r(),w(k,{key:0,cols:"12",sm:"7"},{default:e(()=>[t(L,{onClick:F,color:"orange-darken-2",disabled:d.value},{default:e(()=>[u(" Create Account ")]),_:1},8,["disabled"])]),_:1})):h("",!0),a.variant===o(c).COMBINED||a.variant===o(c).LOGIN?(r(),w(k,{key:1,cols:"12",sm:"5"},{default:e(()=>[t(L,{onClick:$,color:"primary",disabled:d.value,type:"submit"},{default:e(()=>[u(" Sign In ")]),_:1},8,["disabled"])]),_:1})):h("",!0),a.variant===o(c).ADD_CREDENTIAL?(r(),w(k,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:e(()=>[t(L,{onClick:F,color:"orange-darken-2",disabled:d.value},{default:e(()=>[u(" Add Email ")]),_:1},8,["disabled"])]),_:1})):h("",!0)]),_:1}),a.variant===o(c).COMBINED||a.variant===o(c).LOGIN?(r(),w(z,{key:1},{default:e(()=>[t(A,null,{default:e(()=>[t(k,null,{default:e(()=>[t(L,{variant:"text",onClick:W},{default:e(()=>[u(V(o(M).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0)]),_:1},8,["disabled"])):y.value?(r(),D("p",oe,V(o(M).messageResetEmail),1)):T.value?(r(),D("p",ne,V(o(M).messageVerifyNewAccountEmail),1)):N.value?(r(),D("p",ue,[u(V(o(M).messageVerifiedNewAccountMessage)+" ",1),i.value?(r(),D(G,{key:0},[ie,de,m("span",ce,[u(" An error occurred creating or recovering account:"),me,u(" "+V(i.value),1)]),fe,ve,pe,m("div",_e,[t(b,{to:"/"},{default:e(()=>[t(L,{color:"red"},{default:e(()=>[u("Close")]),_:1})]),_:1})])],64)):h("",!0)])):h("",!0)}}}),P=Y(ge,[["__scopeId","data-v-07d5624d"]]),he=m("h2",null,"Email",-1),qe=S({__name:"LoginWithEmailView",props:{variant:{default:()=>c.COMBINED}},emits:["pageTitle"],setup(p,{emit:I}){I("pageTitle","Email Login");const _=O(),y=ae(),N=new URL(location.href).searchParams.get("token")||"";return y&&p.variant!=="ADD_CREDENTIAL"&&!N&&(Date.now()-new Date(y.CreatedAt||"").getTime()>2e4?_.push("/"):_.push("/profile")),(s,g)=>s.variant=="ADD_CREDENTIAL"?(r(),w(z,{key:0,style:{"max-width":"550px"}},{default:e(()=>[t(se,null,{default:e(()=>[t(te,{class:"text-center"},{default:e(()=>[t(le,null,{default:e(()=>[u("Add an E-Mail Address")]),_:1})]),_:1}),t(re,null,{default:e(()=>[t(P,{variant:s.variant},null,8,["variant"])]),_:1})]),_:1})]),_:1})):(r(),D(G,{key:1},[he,t(P,{variant:s.variant},null,8,["variant"])],64))}});export{qe as default};
