import{F as X}from"./form-0fJbSFPv.js";import{P as Z}from"./permission-7wLhDNXq.js";import{i as M,M as F,N as z,r as v,k as $,w as H,n as d,q as c,v as e,f as t,C as L,P as Y,_ as q,b as ee,l as te,A as U,y as oe,x as k,D as ne,B as O,V as ae,Q as le,F as ie,W as se}from"./index-V1GW9i6G.js";import{a as K}from"./scopeId-yaKUKGP8.js";import{_ as ue}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-d5G23wNu.js";import{u as re}from"./useModel-nVYpcuLJ.js";import{_ as de}from"./ModelDialog.vue_vue_type_script_setup_true_lang-kTwBNend.js";import{s as h}from"./index-OKsbKlsK.js";import{a as Q}from"./VContainer-ceZVLMJn.js";import{V as N,a as p}from"./VRow-xOb1CuX2.js";import{V as W}from"./VAvatar-pRO9Ex7r.js";import{V as A}from"./VTextField-Qw2RxLUi.js";import{V as me}from"./VTextarea-HzaZNKMX.js";import{V as ve}from"./VCheckbox-IFggFz5k.js";import{V as ce}from"./VForm-ei9d6tDj.js";import{V as fe}from"./VFileInput-yS0lEeRe.js";import{G as B}from"./group-7fhbY6WJ.js";import{C as G}from"./canDo-8YyPTMee.js";import{C as pe}from"./canEditRegistrations-9NH7e-Bp.js";import{C as ge}from"./canViewOperations-P_rxgblf.js";import{G as J}from"./userData-3LEZFgnu.js";import{V as Ce,a as Ve,b as _e,c as j,d as De,e as Ue}from"./VCard-mucGh0GZ.js";import{V as R}from"./VBtn-MERrmpmJ.js";import{C as Ie}from"./canEditOrganisation-9mm8fY46.js";import{v as ye}from"./v4-yQnnJER4.js";import"./createSimpleFunctional-uYLUWLP3.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-bgOt2mFG.js";import"./forwardRefs-Sb8Hn7OV.js";import"./VDialog-IEHZjW9N.js";import"./VToolbar-u25Y78Ax.js";import"./VCheckboxBtn-4uHJkimm.js";import"./VChip-KcMR6nzJ.js";const we=(g=void 0,C=void 0)=>g===void 0?!1:C===void 0?G(g,B.GROUP_TYPE_CONVENTION).EditConvention:G(g,B.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).EditConvention,Le=(g,C)=>g===void 0?!1:G(g,B.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).ViewRegistration,Ne=M({__name:"EditConventionDialog",props:F({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:F(["update:convention","delete","save"],["update:modelValue"]),setup(g,{emit:C}){const S=g,w=Y(),o=K(),{title:f=""}=S,V=C,I=z(g,"modelValue"),_=re(S,V,void 0,void 0,"convention"),a=v($(_.value));H(_,()=>{a.value=$(_.value)});const D=v(`${o.GetConventionLogoURL(a.value.ConventionUUID)}?${new Date().getTime()}`),y=v(),x=v(),E=()=>{D.value=URL.createObjectURL(y.value.files[0])},T=()=>{V("delete")},u=()=>{a.value=$(_.value)},r=async()=>{var l;const i=new FormData((l=x.value)==null?void 0:l.$el);if(i.get("Image")&&i.get("Image").size>0)return i.set("ConventionUUID",a.value.ConventionUUID),await o.SaveConventionLogo(i)},m=i=>{r(),w.saveConvention(a.value).then(l=>{l?i&&i("Convention Data Saved").then(()=>{_.value=l,V("save",l)}):i&&i("Failed to save")}).catch(()=>{i("Failed to save")})};return(i,l)=>(d(),c(de,{modelValue:I.value,"onUpdate:modelValue":l[5]||(l[5]=n=>I.value=n),onDelete:T,onReset:u,onSave:m,title:L(f),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(Q,{class:"pa-0",fluid:!0},{default:e(()=>[t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(W,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(A,{label:L(h).formLabelName,name:"Name",variant:"outlined",modelValue:a.value.Name,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.Name=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(me,{label:L(h).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:a.value.Description,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.Description=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(A,{label:L(h).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:a.value.DetailLink,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.DetailLink=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(A,{label:L(h).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:a.value.Slug,"onUpdate:modelValue":l[3]||(l[3]=n=>a.value.Slug=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(ve,{label:L(h).formConventionVisible,name:"Visible",modelValue:a.value.Visible,"onUpdate:modelValue":l[4]||(l[4]=n=>a.value.Visible=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(ce,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[t(fe,{label:L(h).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),xe=q(Ne,[["__scopeId","data-v-003c7991"]]),ke=["innerHTML"],be={key:0,class:"text-green"},Se={key:1,class:"text-red"},Te={key:0,class:"text-green"},he={key:1,class:"text-red"},Re=M({__name:"ConventionCard",props:F({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:F(["delete","duplicated"],["update:modelValue"]),setup(g,{emit:C}){const S=Y(),w=C,o=z(g,"modelValue"),f=K(),V=J(),I=v(f.GetConventionLogoURL(o.value.ConventionUUID)),_=v(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),a=v(!1),D=v(!1),y=v(!1),x=v(we(V,o.value)),E=v(pe(V,o.value)),T=v(Le(V,o.value)),u=v(ge(V,o.value)),r=()=>{y.value=!1,I.value=`${f.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},m=n=>{S.deleteConvention(o.value.ConventionUUID).then(s=>{s?n&&(n("Convention Deleted"),w("delete")):n&&n("Failed to Delete Convention"),setTimeout(()=>{D.value=!1},2e3)}).catch(()=>{n&&(n("Failed to Delete Organisation"),D.value=!1)})},i=()=>{S.duplicateConvention(o.value.ConventionUUID).then(n=>{n&&w("duplicated",n)})},l=n=>{n.altKey&&n.ctrlKey&&n.code==="KeyA"&&(a.value=!a.value)};return window.addEventListener("keydown",l),ee(()=>{window.removeEventListener("keydown",l)}),(n,s)=>{const P=te("RouterLink");return d(),c(Ue,null,{default:e(()=>[t(Ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[I.value?(d(),c(W,{key:0,src:I.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),o.value.Name?(d(),c(Ve,{key:1},{default:e(()=>[k(oe(o.value.Name)+" ",1),x.value&&a.value?(d(),c(R,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:i})):U("",!0)]),_:1})):U("",!0),o.value.Description?(d(),c(_e,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ne("div",{innerHTML:o.value.Description},null,8,ke)]),_:1})):U("",!0),t(j,{class:"px-0 pb-0"},{default:e(()=>[k(" Visibility:  "),o.value.Visible?(d(),O("span",be,"Visible")):(d(),O("span",Se,"Hidden"))]),_:1}),t(j,{class:"px-0 pb-0"},{default:e(()=>[k(" Registration:  "),n.open?(d(),O("span",Te,"Open")):(d(),O("span",he,"Closed"))]),_:1})]),_:1}),t(De,null,{default:e(()=>[t(N,{"no-gutters":""},{default:e(()=>[x.value?(d(),c(p,{key:0,class:"ma-1"},{default:e(()=>[t(R,{variant:"tonal",color:"primary",onClick:s[0]||(s[0]=b=>y.value=!0),width:"100%"},{default:e(()=>[k("Edit")]),_:1})]),_:1})):U("",!0),U("",!0),x.value?(d(),c(p,{key:2,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t(R,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[k("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),T.value||E.value?(d(),c(p,{key:3,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t(R,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[k("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),u.value?(d(),c(p,{key:4,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/operations`},{default:e(()=>[t(R,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[k("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),y.value?(d(),c(xe,{key:0,modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=b=>y.value=b),convention:o.value,"onUpdate:convention":s[2]||(s[2]=b=>o.value=b),onDelete:s[3]||(s[3]=b=>D.value=!0),onSave:r,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),D.value?(d(),c(ue,{key:1,modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=b=>D.value=b),"confirmation-text":"I UNDERSTAND",message:_.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:m},null,8,["modelValue","message"])):U("",!0)]),_:1})}}}),Ee=q(Re,[["__scopeId","data-v-9433b945"]]),Oe=M({__name:"ConventionsView",emits:["pageTitle"],setup(g,{emit:C}){var T;C("pageTitle","Conventions");const w=Y(),o=J(),f=v([]),V=v([]),I=ae();let _=((T=I.params.organisation)==null?void 0:T.toString())||"";const a=v();H(I,()=>{var u,r;_!==((u=I.params.organisation)==null?void 0:u.toString())&&(_=((r=I.params.organisation)==null?void 0:r.toString())||"",D())});const D=()=>{_?w.getOrganisation(_).then(u=>{u&&(a.value=u,w.getConventionList(u.OrganisationUUID).then(r=>{r&&(f.value=r.sort((m,i)=>m.ID>i.ID?-1:m.ID<i.ID?1:0),y())}))}).catch(()=>{}):w.getPermissionAccessList(Z.PERMISSION_TYPE_NULL).then(u=>{u&&(f.value=u.Conventions.sort((r,m)=>r.ID>m.ID?-1:r.ID<m.ID?1:0),y())})},y=()=>{f.value.forEach(u=>{w.getConventionForms(u.ConventionUUID).then(r=>{r&&(V.value=[...V.value,...r])}).catch(r=>{console.error(r)})})},x=()=>{var u,r;if(a.value){const m={ID:0,ConventionUUID:ye(),OrganisationID:((u=a.value)==null?void 0:u.ID)||0,OrganisationUUID:((r=a.value)==null?void 0:r.OrganisationUUID)||se,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};w.saveConvention(m).then(i=>{i&&f.value.push(i)})}},E=u=>{f.value.splice(u,1)};return D(),(u,r)=>(d(),c(Q,null,{default:e(()=>[t(N,{class:"justify-center"},{default:e(()=>[(d(!0),O(ie,null,le(f.value,(m,i)=>(d(),c(p,{key:m.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var l,n;return[t(Ee,{modelValue:f.value[i],"onUpdate:modelValue":s=>f.value[i]=s,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((l=m.Organisation)==null?void 0:l.Slug)||((n=m.Organisation)==null?void 0:n.OrganisationUUID)||"",open:!!V.value.find(s=>s.ConventionUUID===m.ConventionUUID&&s.Type===L(X).FORM_TYPE_REGISTRATION&&s.State&&s.State.New),onDelete:s=>E(i),onDuplicated:s=>f.value.push(s)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),t(N,null,{default:e(()=>[a.value&&L(Ie)(L(o),a.value)?(d(),c(p,{key:0,class:"text-right"},{default:e(()=>[t(R,{color:"primary",onClick:x},{default:e(()=>[k("New")]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}}),ft=q(Oe,[["__scopeId","data-v-9b88a28b"]]);export{ft as default};
