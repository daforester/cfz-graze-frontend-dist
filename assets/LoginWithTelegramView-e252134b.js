import{I as T,r as p,k as b,M as i,V as u,a6 as E,a8 as C,L as k,N as L,O as l,v as r,P as w,X as o,H as g,S as A}from"./index-18820bce.js";import{G as V}from"./userData-5591dc55.js";import{S as R}from"./setupLogin-d6d1aa98.js";import{E as D}from"./emailFormVariant-e5e0aad4.js";import{b as I,V as y,c as B,e as M}from"./VCard-4b12f720.js";import{j as N}from"./VContainer-80736491.js";import"./createSimpleFunctional-59218f06.js";import"./VAvatar-ddb3c847.js";const h=T({__name:"TelegramLoginForm",props:{mode:{},telegramLogin:{},redirectUrl:{default:""},requestAccess:{default:""},size:{default:""},userpic:{type:Boolean,default:!1},radius:{default:""}},emits:["callback"],setup(t,{emit:d}){const n=p(),a=e=>{d("callback",e)};return b(()=>{const e=document.createElement("script");e.async=!0,e.src="https://telegram.org/js/telegram-widget.js?22",e.setAttribute("data-size",t.size||""),e.setAttribute("data-userpic",t.userpic?"true":"false"),e.setAttribute("data-telegram-login",t.telegramLogin),e.setAttribute("data-request-access",t.requestAccess||""),t.radius&&e.setAttribute("data-radius",t.radius||""),t.mode==="callback"?(window.onTelegramAuth=a,e.setAttribute("data-onauth","window.onTelegramAuth(user)")):e.setAttribute("data-auth-url",t.redirectUrl||""),n.value.appendChild(e)}),(e,m)=>(i(),u("div",{ref_key:"telegram",ref:n},null,512))}}),O={class:"form-group row"},U={class:"col"},x=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),G=o("h2",null,"Telegram",-1),q={class:"form-group row"},z={class:"col"},H=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),K=T({__name:"LoginWithTelegramView",props:{variant:{default:()=>D.COMBINED}},emits:["pageTitle"],setup(t,{emit:d}){d("pageTitle","Telegram Login");const n=E(),a=p(new Map),e=V(),m=C.getInstance();m.getLoginURLs(location.href.substring(0,location.href.length-9)).then(s=>{a.value=s});const f=s=>{m.oAuthLogin("telegram","","","",s).then(({created:_,tokens:c,user:v})=>{R(c,v,n,_)})};return e&&t.variant!=="ADD_CREDENTIAL"&&(Date.now()-new Date(e.CreatedAt||"").getTime()>2e4?n.push("/"):n.push("/profile")),(s,_)=>{const c=k("router-link");return s.variant=="ADD_CREDENTIAL"?(i(),L(N,{key:0,style:{"max-width":"550px"}},{default:l(()=>[r(M,null,{default:l(()=>[r(I,{class:"text-center"},{default:l(()=>[r(y,null,{default:l(()=>[w("Add a Telegram Account")]),_:1})]),_:1}),r(B,{class:"text-center"},{default:l(()=>[a.value.size>0?(i(),u(g,{key:0},[r(h,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:f,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",O,[o("div",U,[r(c,{to:"/"},{default:l(()=>[x]),_:1})])])],64)):A("",!0)]),_:1})]),_:1})]),_:1})):(i(),u(g,{key:1},[G,a.value.size>0?(i(),u(g,{key:0},[r(h,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:f,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",q,[o("div",z,[r(c,{to:"/"},{default:l(()=>[H]),_:1})])])],64)):A("",!0)],64))}}});export{K as default};
