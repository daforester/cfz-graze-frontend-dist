import{p as ke,n as Me,e as J,t as q,c as be,G as Ve,v as u,H as h,x as _e,I as K,a1 as Ee,a2 as Fe,r as I,a3 as re,K as i,L as g,M as T,$ as ye,S as Q,a8 as Ae,Z as b,Q as P,R as v,O as w,_ as Oe,U as B,N as x,a4 as Ne,a0 as Pe,w as we}from"./index-6f0a31af.js";import{a as Ye,F as X}from"./form-e2a93b7c.js";import{_ as Be}from"./ModelDialog.vue_vue_type_script_setup_true_lang-82df5767.js";import{m as $e,j as xe,k as He,l as Ge,n as qe,o as je,p as Je,u as Ke,q as ze,r as We,s as Qe,t as Xe,v as Ze,w as et,x as tt,y as Ie,z as De,A as fe,_ as pe,f as at,g as lt,h as ot,i as nt,d as st}from"./VWindowItem-2e972c56.js";import{c as it,T as ut}from"./filter-3ab81b8c.js";import{a as ue,V as j}from"./VRow-c48a2999.js";import{V as Te}from"./VTextField-7dacfa8e.js";import{V as W}from"./VSelect-01fba6f1.js";import{u as rt,j as ve}from"./VContainer-a007aaab.js";import{v as Z}from"./v4-a960c1f4.js";import{S as dt}from"./submission-56c4c4f1.js";import{V as Ce}from"./VBtn-790f2bd2.js";import{u as mt,V as Ut}from"./VToolbar-967eee94.js";import{V as ct}from"./VSpacer-1fa386ca.js";import{e as _t}from"./VCard-a5cb53c4.js";import{V as Re}from"./VTable-6649b99a.js";import"./VChip-4c0e6976.js";import"./scopeId-fb50797f.js";import"./VAvatar-b8585581.js";import"./VDialog-70136927.js";import"./VCheckboxBtn-84b3451a.js";import"./VToolbarItems-5c879c9b.js";import"./VList-05ba7dd4.js";var Le=(t=>(t.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",t.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",t))(Le||{});const Tt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ee=(t=>(t.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",t.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",t.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",t))(ee||{});const vt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Se=(t=>(t.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",t.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",t))(Se||{});const At=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var f=(t=>(t.USER_DATA_SOURCE_NULL="",t.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",t.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",t.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",t.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",t.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",t.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",t.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",t.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",t))(f||{});const St=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Et=ke({itemsLength:{type:[Number,String],required:!0},...$e(),...xe(),...He()},"VDataTableServer"),It=Me()({name:"VDataTableServer",props:Et(),emits:{"update:modelValue":t=>!0,"update:page":t=>!0,"update:itemsPerPage":t=>!0,"update:sortBy":t=>!0,"update:options":t=>!0,"update:expanded":t=>!0,"update:groupBy":t=>!0,"click:row":(t,p)=>!0},setup(t,p){let{emit:o,slots:e}=p;const{groupBy:l}=Ge(t),{sortBy:s,multiSort:r,mustSort:D}=qe(t),{page:E,itemsPerPage:N}=je(t),A=J(()=>parseInt(t.itemsLength,10)),{columns:d,headers:_}=Je(t,{groupBy:l,showSelect:q(t,"showSelect"),showExpand:q(t,"showExpand")}),{items:R}=Ke(t,d),{toggleSort:U}=ze({sortBy:s,multiSort:r,mustSort:D,page:E}),{opened:y,isGroupOpen:O,toggleGroup:te,extractRows:ae}=We({groupBy:l,sortBy:s}),{pageCount:le,setItemsPerPage:oe}=Qe({page:E,itemsPerPage:N,itemsLength:A}),{flatItems:V}=Xe(R,l,y),{isSelected:de,select:me,selectAll:ne,toggleSelect:Ue,someSelected:ce,allSelected:se}=Ze(t,{allItems:R,currentPage:R}),{isExpanded:a,toggleExpand:c}=et(t),m=J(()=>ae(R.value));tt({page:E,itemsPerPage:N,sortBy:s,groupBy:l,search:q(t,"search")}),be("v-data-table",{toggleSort:U,sortBy:s}),Ve({VDataTableRows:{hideNoData:q(t,"hideNoData"),noDataText:q(t,"noDataText"),loading:q(t,"loading"),loadingText:q(t,"loadingText")}});const n=J(()=>({page:E.value,itemsPerPage:N.value,sortBy:s.value,pageCount:le.value,toggleSort:U,setItemsPerPage:oe,someSelected:ce.value,allSelected:se.value,isSelected:de,select:me,selectAll:ne,toggleSelect:Ue,isExpanded:a,toggleExpand:c,isGroupOpen:O,toggleGroup:te,items:m.value,groupedItems:V.value,columns:d.value,headers:_.value}));rt(()=>{const[C]=Ie.filterProps(t),[F]=De.filterProps(t),[k]=fe.filterProps(t),[H]=Re.filterProps(t);return u(Re,_e({class:["v-data-table",{"v-data-table--loading":t.loading},t.class],style:t.style},H),{top:()=>{var Y;return(Y=e.top)==null?void 0:Y.call(e,n.value)},default:()=>{var Y,ie,M,L;return e.default?e.default(n.value):u(h,null,[(Y=e.colgroup)==null?void 0:Y.call(e,n.value),u("thead",{class:"v-data-table__thead",role:"rowgroup"},[u(De,_e(F,{sticky:t.fixedHeader}),e)]),(ie=e.thead)==null?void 0:ie.call(e,n.value),u("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[e.body?e.body(n.value):u(fe,_e(k,{items:V.value}),e)]),(M=e.tbody)==null?void 0:M.call(e,n.value),(L=e.tfoot)==null?void 0:L.call(e,n.value)])},bottom:()=>e.bottom?e.bottom(n.value):u(Ie,C,{prepend:e["footer.prepend"]})})})}}),Dt=K({__name:"EditAdminLayout",props:Ee({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["save"],["update:modelValue"]),setup(t,{emit:p}){const o=Fe(t,"modelValue"),e=I(re(t.layout)),l=I([]),s=ye(),r=({callback:A})=>{const d=()=>{A&&A("Failed to Save Layout")},_=()=>{A&&A("Layout Saved")};s.saveAdminLayout(e.value).then(R=>{R?(_(),p("save",R)):d()}).catch(()=>{d()})},D=()=>({ID:0,LayoutPanelUUID:Z(),AdminLayoutID:e.value.ID,AdminLayoutUUID:e.value.AdminLayoutUUID,Name:"",Order:e.value.Panels.length+1,Items:[],RequiredFormType:X.FORM_TYPE_NIL}),E=A=>()=>({ID:0,LayoutItemUUID:Z(),LayoutPanelID:A.ID,LayoutPanelUUID:A.LayoutPanelUUID,Label:"",SourceType:ee.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:A.Items.length+1}),N=A=>{const d=l.value.find(_=>_.value===A.SectionFieldUUID);d&&(A.SectionFieldID=d.object.ID,A.SectionField=d.object)};return s.getConventionForms(t.layout.ConventionUUID).then(A=>{A.forEach(d=>d.Sections.forEach(_=>_.Fields&&l.value.push(..._.Fields.map(R=>{var y;return{title:`${d.Name} - ${_.Name} - ${(y=R.Field)==null?void 0:y.Name}`,value:R.SectionFieldUUID,object:R}})))),l.value.sort(it("title"))}),(A,d)=>(i(),g(Be,{modelValue:o.value,"onUpdate:modelValue":d[3]||(d[3]=_=>o.value=_),onSave:r,title:A.title,color:"primary"},{default:T(()=>[u(ve,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[u(ue,null,{default:T(()=>[u(j,{cols:"12",sm:"6"},{default:T(()=>[u(Te,{modelValue:e.value.Name,"onUpdate:modelValue":d[0]||(d[0]=_=>e.value.Name=_),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),u(j,{cols:"12",sm:"6"},{default:T(()=>[u(W,{modelValue:e.value.Type,"onUpdate:modelValue":d[1]||(d[1]=_=>e.value.Type=_),label:"Layout Type",items:Q(Tt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),u(pe,{modelValue:e.value.Panels,"onUpdate:modelValue":d[2]||(d[2]=_=>e.value.Panels=_),"new-item":D,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Ae({_:2},[b(e.value.Panels,(_,R)=>({name:`panel_${R}`,fn:T(()=>[u(ve,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[u(ue,null,{default:T(()=>[u(j,{cols:"12",sm:"6"},{default:T(()=>[u(Te,{modelValue:_.Name,"onUpdate:modelValue":U=>_.Name=U,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),u(j,{cols:"12",sm:"6"},{default:T(()=>[u(W,{modelValue:_.RequiredFormType,"onUpdate:modelValue":U=>_.RequiredFormType=U,items:Q(Ye),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),u(pe,{modelValue:_.Items,"onUpdate:modelValue":U=>_.Items=U,"new-item":E(_),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Ae({_:2},[b(_.Items,(U,y)=>({name:`item_${y}`,fn:T(()=>[u(ve,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[u(ue,null,{default:T(()=>[u(j,{cols:"12",sm:"6"},{default:T(()=>[u(Te,{modelValue:U.Label,"onUpdate:modelValue":O=>U.Label=O,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),u(ue,null,{default:T(()=>[u(j,{cols:"12",sm:"6"},{default:T(()=>[u(W,{modelValue:U.SourceType,"onUpdate:modelValue":O=>U.SourceType=O,label:"Source Type",items:Q(vt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),u(j,{cols:"12",sm:"6"},{default:T(()=>[U.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),g(W,{key:0,modelValue:U.SectionFieldUUID,"onUpdate:modelValue":O=>U.SectionFieldUUID=O,label:"Form Data",items:l.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:O=>N(U)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):U.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),g(W,{key:1,modelValue:U.MetaField,"onUpdate:modelValue":O=>U.MetaField=O,label:"Miscellaneous Data",items:Q(At),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):U.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),g(W,{key:2,modelValue:U.UserField,"onUpdate:modelValue":O=>U.UserField=O,label:"User Profile Data",items:Q(St),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),ft={key:0,class:"accommodationList"},pt=K({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(t){const p=J(()=>{if(!t.value)return[];const o=JSON.parse(t.value),e=t.accommodations.filter(l=>o.includes(l.AccommodationUUID)).sort((l,s)=>{const r=o.findIndex(E=>E===l.AccommodationUUID),D=o.findIndex(E=>E===s.AccommodationUUID);return r>D?1:-1});return re(e)});return(o,e)=>o.value?(i(),v("ol",ft,[(i(!0),v(h,null,b(p.value,l=>(i(),v("li",{key:l.AccommodationUUID},w(l.Name),1))),128))])):P("",!0)}});const Rt=Oe(pt,[["__scopeId","data-v-1ba5f67a"]]),yt={key:0,class:"addonList"},Ot={key:0},Ct=K({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(t){const p=J(()=>{if(!t.value)return;const o=JSON.parse(t.value),e=Object.keys(o),l=re(t.extras);return l.forEach(s=>{s.Options=s.Options.filter(r=>e.includes(r.OptionUUID)?(r.Choices=r.Choices.filter(D=>D.TagUUID===o[r.OptionUUID].choiceId),o[r.OptionUUID].checked):!1)}),l.filter(s=>s.Options.length>0),l});return(o,e)=>o.value?(i(),v("ul",yt,[(i(!0),v(h,null,b(p.value,l=>(i(),v("li",{key:l.ExtraUUID},[B("strong",null,w(l.Name),1),B("ul",null,[(i(!0),v(h,null,b(l.Options,s=>(i(),v("li",{key:s.OptionUUID},[x(w(s.Name)+" ",1),s.Choices.length==1?(i(),v("small",Ot,"("+w(s.Choices[0].Title)+")",1)):P("",!0)]))),128))])]))),128))])):P("",!0)}});const Lt=Oe(Ct,[["__scopeId","data-v-4ed6842b"]]),ht={key:0},gt=K({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(t){const p=J(()=>{if(!t.value)return;const o=JSON.parse(t.value);return Object.entries(o).filter(([,e])=>e).map(([e,l])=>t.interests.find(s=>s.InterestUUID===e)).filter(e=>e!==void 0)});return(o,e)=>o.value?(i(),v("ul",ht,[(i(!0),v(h,null,b(p.value,l=>(i(),v("li",{key:l.InterestUUID},w(l.Name),1))),128))])):P("",!0)}}),kt=B("br",null,null,-1),Mt=B("small",null,"Options:",-1),bt=B("br",null,null,-1),Vt=B("small",null,"Addons:",-1),Ft=K({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(t){const p=J(()=>{if(!t.value)return;let o={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{o=JSON.parse(t.value),"ticket"in o&&(o.Ticket=o.ticket),"addonsChecked"in o&&(o.AddonsChecked=o.addonsChecked),"componentsChecked"in o&&(o.ComponentsChecked=o.componentsChecked)}catch{}return o.Ticket.filter(e=>{const l=t.tickets.find(s=>s.TicketUUID===e);return!(!l||l.Type!==ut.TICKET_TYPE_TICKET)}).map(e=>{const l=t.tickets.find(r=>r.TicketUUID===e),s=re(l);return s.TicketComponents=l.TicketComponents.filter(r=>o.ComponentsChecked.includes(r.TicketUUID)),s.AddonTickets=l.AddonTickets.filter(r=>o.AddonsChecked.includes(r.TicketUUID)),s})});return(o,e)=>o.value?(i(!0),v(h,{key:0},b(p.value,l=>(i(),v("div",{key:l.TicketUUID},[B("strong",null,w(l.Name),1),l.TicketComponents.length>0?(i(),v(h,{key:0},[kt,Mt,x("  "),(i(!0),v(h,null,b(l.TicketComponents,s=>(i(),v(h,{key:s.TicketUUID},[B("small",null,w(s.Name),1),x("  ")],64))),128))],64)):P("",!0),l.AddonTickets.length>0?(i(),v(h,{key:1},[bt,Vt,x("  "),(i(!0),v(h,null,b(l.AddonTickets,s=>(i(),v("small",{key:s.TicketUUID},[x("("),B("em",null,w(s.Name),1),x(")")]))),128))],64)):P("",!0)]))),128)):P("",!0)}}),Nt=["innerHTML"],Pt=K({__name:"RegListRow",props:{header:{},accommodations:{},extras:{},item:{},interests:{},tickets:{},venues:{}},setup(t){const p=e=>{console.log(e)},o=e=>e.map(l=>`<strong>${l.Heading}:</strong> ${dt(l.Status)}<br/>`).join("");return(e,l)=>e.header.key=="actions"?(i(),g(Ce,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:l[0]||(l[0]=s=>p(e.item.raw))})):e.header.type==="ACCOMMODATION"&&e.accommodations.length>0?(i(),g(Rt,{key:1,value:e.item.raw[e.header.key],accommodations:e.accommodations},null,8,["value","accommodations"])):e.header.type==="EXTRAS"&&e.extras.length>0?(i(),g(Lt,{key:2,value:e.item.raw[e.header.key],extras:e.extras},null,8,["value","extras"])):e.header.type==="INTERESTS"&&e.interests.length>0?(i(),g(gt,{key:3,value:e.item.raw[e.header.key],interests:e.interests},null,8,["value","interests"])):e.header.type==="TICKET"&&e.tickets.length>0?(i(),g(Ft,{key:4,value:e.item.raw[e.header.key],tickets:e.tickets},null,8,["value","tickets"])):e.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(i(),v("div",{key:5,innerHTML:`${o(e.item.raw[e.header.key])}`},null,8,Nt)):(i(),v(h,{key:6},[x(w(e.item.raw[e.header.key]),1)],64))}}),ia=K({__name:"RegistrationsView",emits:["pageTitle"],setup(t,{emit:p}){var se;p("pageTitle","Registration Manager");const o=Ne(),e=Pe(),l=I(!0);let s=((se=o.params.convention)==null?void 0:se.toString())||"";const r=I({ID:0,ConventionUUID:Z(),OrganisationID:0,OrganisationUUID:mt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),D=ye(),E=I({ID:0,AdminLayoutUUID:Z(),ConventionID:r.value.ID,ConventionUUID:r.value.ConventionUUID,Name:"Registration Table",Type:Le.ADMIN_LAYOUT_TABLE,Panels:[]}),N=I([]),A=I([]),d=I([]),_=I(10),R=I(0),U=I(!1),y=I(""),O=I([]),te=I([]),ae=I([]),le=I([]),oe=I([]),V=I(0);we(V,a=>{a===7&&ne()});const de=()=>{N.value=[],A.value=[],d.value=[];try{D.getConventionAdminLayoutByName(r.value.ConventionUUID,"Registration Table").then(a=>{V.value+=1,a?E.value=a:(E.value.ConventionID=r.value.ID,E.value.ConventionUUID=r.value.ConventionUUID)})}catch{E.value.ConventionID=r.value.ID,E.value.ConventionUUID=r.value.ConventionUUID}try{D.getConventionForms(r.value.ConventionUUID).then(a=>{V.value+=1,a&&(N.value=a)})}catch{}try{D.getConventionAccommodation(r.value.ConventionUUID).then(a=>{V.value+=1,a&&(O.value=a)})}catch{}try{D.getConventionVenues(r.value.ConventionUUID).then(a=>{V.value+=1,a&&(oe.value=a)})}catch{}try{D.getConventionExtras(r.value.ConventionUUID).then(a=>{V.value+=1,a&&(te.value=a)})}catch{}try{D.getConventionInterests(r.value.ConventionUUID).then(a=>{V.value+=1,a&&(ae.value=a)})}catch{}try{D.getConventionTickets(r.value.ConventionUUID).then(a=>{V.value+=1,a&&(le.value=a)})}catch{}},me=({page:a,itemsPerPage:c,sortBy:m})=>{const n=d.value.find(k=>k.uuid==y.value),C=n==null?void 0:n.layout.Items;let F="";if(m&&C&&m.length>=1){const k=C.find(H=>H.LayoutItemUUID==m[0].key);switch(k==null?void 0:k.UserField){case f.USER_DATA_SOURCE_DISPLAY_NAME:F="user.display_name";break;case f.USER_DATA_SOURCE_HANDLE:F="user.handle";break;case f.USER_DATA_SOURCE_EMAIL:F="user.email";break}}try{const k={Offset:(a-1)*c,Order:F,Limit:c};(n==null?void 0:n.layout.RequiredFormType)===X.FORM_TYPE_ACCOMMODATION&&(k.Accommodation=!0),(n==null?void 0:n.layout.RequiredFormType)===X.FORM_TYPE_BADGE&&(k.Badge=!0),(n==null?void 0:n.layout.RequiredFormType)===X.FORM_TYPE_DEALER&&(k.Dealer=!0),D.searchConventionRegistrations(r.value.ConventionUUID,k).then(H=>{H&&(R.value=H.Total,A.value=H.Registrations,d.value.forEach(Y=>{const ie=Y.layout;Y.items=A.value.map(M=>{const L={};return Y.headers.forEach(he=>{const S=ie.Items.find(z=>z.LayoutItemUUID===he.key);if(S){if(S.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&S.SectionField)M.Submissions.forEach(z=>{const G=z.Data.find($=>$.SectionFieldUUID===S.SectionFieldUUID);if(G){L[S.LayoutItemUUID]=G.Data;return}});else if(S.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&S.UserField)switch(S.UserField){case f.USER_DATA_SOURCE_DISPLAY_NAME:L[S.LayoutItemUUID]=M.User.DisplayName;break;case f.USER_DATA_SOURCE_EMAIL:L[S.LayoutItemUUID]=M.User.Additional.Email;break;case f.USER_DATA_SOURCE_HANDLE:L[S.LayoutItemUUID]=M.User.Handle;break;case f.USER_DATA_SOURCE_DATE_OF_BIRTH:L[S.LayoutItemUUID]=M.User.Additional.DOB;break;case f.USER_DATA_SOURCE_FIRST_NAME:L[S.LayoutItemUUID]=M.User.Additional.FirstName;break;case f.USER_DATA_SOURCE_LAST_NAME:L[S.LayoutItemUUID]=M.User.Additional.LastName;break;case f.USER_DATA_SOURCE_TELEGRAM:L[S.LayoutItemUUID]="";break}else if(S.SourceType==="LAYOUT_ITEM_SOURCE_META"&&S.MetaField){const z=M.Submissions.find(G=>{var $;return(($=G.Form)==null?void 0:$.Type)===X.FORM_TYPE_REGISTRATION});switch(S.MetaField){case Se.META_DATA_SOURCE_SUBMISSION_DATE:z?L[S.LayoutItemUUID]=new Date(z.CreatedAt).toLocaleString():L[S.LayoutItemUUID]=new Date(M.CreatedAt).toLocaleString();break;case Se.META_DATA_SOURCE_SUBMISSION_STATUS:L[S.LayoutItemUUID]=M.Submissions.map(G=>{const $=N.value.find(ge=>ge.FormUUID===G.FormUUID);return{Heading:$==null?void 0:$.Heading,Status:G.Status}});break}}}}),L})}),l.value=!1)})}catch{}},ne=()=>{E.value.Panels.forEach(a=>{a.Items.forEach(c=>{(c.SectionField==null||c.SectionField.Field==null)&&N.value.find(m=>{m.Sections.find(n=>{if(n.Fields){const C=n.Fields.find(F=>F.SectionFieldUUID===c.SectionFieldUUID);if(C)return c.SectionField=C,!0}})})})}),E.value.Panels.length>0&&(d.value=[],E.value.Panels.forEach(a=>{const c={uuid:Z(),order:a.Order,name:a.Name,headers:[],items:[],layout:a},m={key:"actions",title:"Actions",align:"start",sortable:!1,type:""};a.Items.sort((n,C)=>n.Order>C.Order?1:n.Order==C.Order?0:-1),c.headers=a.Items.map(n=>{var C,F;return{key:n.LayoutItemUUID,title:n.Label||((F=(C=n.SectionField)==null?void 0:C.Field)==null?void 0:F.Label)||"",align:n.Align==="end"?"end":"start",sortable:ce(n),type:Ue(n)}}),c.headers.push(m),d.value.push(c)})),(y.value==null||y.value=="")&&d.value.length>0&&(y.value=d.value[0].uuid)};s?D.getConvention(s).then(a=>{a&&(r.value=a,de())}).catch(()=>{e.push("/")}):e.push("/");const Ue=a=>{var c,m;if(a.SourceType===ee.LAYOUT_ITEM_SOURCE_META)return`${a.SourceType}.${a.MetaField}`;if(a.SourceType===ee.LAYOUT_ITEM_SOURCE_FORM)return(m=(c=a.SectionField)==null?void 0:c.Field)==null?void 0:m.Type;if(a.SourceType===ee.LAYOUT_ITEM_SOURCE_USER)return`${a.SourceType}.${a.UserField}`},ce=a=>[f.USER_DATA_SOURCE_DISPLAY_NAME,f.USER_DATA_SOURCE_EMAIL,f.USER_DATA_SOURCE_HANDLE,f.USER_DATA_SOURCE_DATE_OF_BIRTH,f.USER_DATA_SOURCE_FIRST_NAME,f.USER_DATA_SOURCE_LAST_NAME].includes(a.UserField);return(a,c)=>(i(),g(st,null,{default:T(()=>[u(Ut,{color:"blue-darken-4"},{default:T(()=>[u(at,{modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=m=>y.value=m),"show-arrows":""},{default:T(()=>[(i(!0),v(h,null,b(d.value,m=>(i(),g(lt,{key:m.uuid,value:m.uuid},{default:T(()=>[x(w(m.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),u(ct),u(Ce,{icon:"mdi:mdi-cog-outline",onClick:c[1]||(c[1]=m=>U.value=!0)})]),_:1}),u(nt,{modelValue:y.value,"onUpdate:modelValue":c[3]||(c[3]=m=>y.value=m)},{default:T(()=>[(i(!0),v(h,null,b(d.value,m=>(i(),g(ot,{key:m.uuid,value:m.uuid},{default:T(()=>[m.uuid===y.value?(i(),g(_t,{key:0,class:"pa-2"},{default:T(()=>[u(Q(It),{"items-per-page":_.value,"onUpdate:itemsPerPage":c[2]||(c[2]=n=>_.value=n),headers:m.headers,"items-length":R.value,items:m.items,"item-value":"LayoutItemUUID",loading:l.value,"onUpdate:options":me},Ae({_:2},[b(m.headers,n=>({name:`item.${n.key}`,fn:T(({item:C})=>[u(Pt,{header:n,item:C,accommodations:O.value,extras:te.value,interests:ae.value,tickets:le.value,venues:oe.value},null,8,["header","item","accommodations","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):P("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),U.value?(i(),g(Dt,{key:0,title:"Edit Layout",modelValue:U.value,"onUpdate:modelValue":c[4]||(c[4]=m=>U.value=m),layout:E.value,onSave:c[5]||(c[5]=m=>{U.value=!1,ne()})},null,8,["modelValue","layout"])):P("",!0)]),_:1}))}});export{ia as default};
