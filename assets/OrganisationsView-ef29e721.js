import{d as b,X as w,Y as h,o as D,b as O,y as g,k as H,w as a,c as e,e as m,G as C,N as T,O as Z,K as Y,F as W,R as re,M as X,L as x,S as de,U as me,f as N,_ as J,r as fe,Z as pe,W as ve}from"./index-ad583c67.js";import{V as ge}from"./VSelect-31dd40d2.js";import{V as ce}from"./VAutocomplete-272f0cb3.js";import{V as S}from"./VDialog-410f5634.js";import{b as F,V as q}from"./VToolbar-07d80ae3.js";import{V as U,a as M}from"./VBtn-282d2b58.js";import{V as B}from"./VSpacer-2d2b4767.js";import{V as G,a as Ve}from"./VSheet-ab000da5.js";import{c as L,e as R,V as Q,a as ee,d as ae}from"./VCard-387bb51f.js";import{a as y,V as _}from"./VRow-055430d7.js";import{s as A}from"./index-ba0d422e.js";import{u as _e}from"./useGrazeAPI-8f74a332.js";import{_ as Ue}from"./SaveButton.vue_vue_type_script_setup_true_lang-ed6b7e27.js";import{V as j}from"./VForm-ff8a8b9c.js";import{V as le}from"./VContainer-fbb15823.js";import{V as te}from"./VImg-4e76607d.js";import{V as P}from"./VTextField-bcf26082.js";import{V as De}from"./VFileInput-692bc010.js";import{v as Ie}from"./v4-a960c1f4.js";import"./VList-f69a734e.js";import"./index-d4774cfe.js";import"./rounded-7a345354.js";import"./ssrBoot-4e7347f1.js";import"./index-0c409218.js";import"./createSimpleFunctional-2a2dbdcd.js";import"./VAvatar-b27f27a9.js";import"./VOverlay-401ee4b7.js";import"./scopeId-230b3d07.js";import"./VChip-f7150b31.js";const $=[{id:1,displayName:"Main user",permissions:{organisation:["READ","WRITE"],permissions:["READ"]}},{id:2,displayName:"Org user",permissions:{organisation:["READ","WRITE"],permissions:[]}},{id:3,displayName:"Access user",permissions:{organisation:[],permissions:["READ","WRITE"]}},{id:4,displayName:"Main other user",permissions:{organisation:["READ","WRITE"],permissions:["READ","WRITE"]}},{id:5,displayName:"Org other user",permissions:{organisation:["READ","WRITE"],permissions:[]}},{id:6,displayName:"Access other user",permissions:{organisation:[],permissions:["READ","WRITE"]}},{id:7,displayName:"Main again user",permissions:{organisation:["READ","WRITE"],permissions:["READ","WRITE"]}},{id:8,displayName:"Org again user",permissions:{organisation:["READ","WRITE"],permissions:[]}},{id:9,displayName:"Access again user",permissions:{organisation:[],permissions:["READ","WRITE"]}}],K=b({__name:"Permission",props:w(["label","variant"],{modelValue:{required:!0}}),emits:["update:modelValue"],setup(s){const p=h(s,"modelValue"),n=[{label:"View",value:"READ"},{label:"Edit",value:"WRITE"}];return(i,f)=>(D(),O(ge,{modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=u=>p.value=u),items:n,"item-title":"label","item-value":"value",label:s.label,"persistent-hint":"",variant:s.variant,clearable:"",multiple:""},null,8,["modelValue","label","variant"]))}}),ye=b({__name:"SelectUser",props:w(["conventionId","variant"],{modelValue:{}}),emits:["update:modelValue"],setup(s){const p=h(s,"modelValue"),n=g(""),i=g(!1),f=g([]),u=g(""),r=g([]);fetch("https://randomuser.me/api/?results=200").then(t=>t.json()).then(t=>{r.value=t.results.map(l=>({ID:0,UserUUID:l.login.uuid,DisplayName:`${l.name.first} ${l.name.last}`,Handle:l.login.username,Avatar:l.picture.thumbnail,Permissions:{Organisation:[],Permissions:[]},Data:"",Groups:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""}}))});const o=t=>{i.value=!0,setTimeout(()=>{f.value=r.value.filter(l=>(l.DisplayName||"").toLowerCase().indexOf((t||"").toLowerCase())>-1||(l.Handle||"").toLowerCase().indexOf((t||"").toLowerCase())>-1||(`@${l.Handle}`||"").toLowerCase().indexOf((t||"").toLowerCase())>-1).map(l=>({UserUUID:l.UserUUID,DisplayName:`${l.DisplayName} (@${l.Handle})`})),i.value=!1},500)};return H(u,t=>{t&&t!==p.value&&o(t)}),H(n,t=>{p.value=r.value.find(l=>l.UserUUID===t)}),(t,l)=>(D(),O(ce,{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=v=>n.value=v),search:u.value,"onUpdate:search":l[1]||(l[1]=v=>u.value=v),loading:i.value,items:f.value,class:"mx-4",density:"comfortable",variant:s.variant,"hide-no-data":"","hide-details":"",clearable:"",label:"User","item-title":"DisplayName","item-value":"UserUUID"},null,8,["modelValue","search","loading","items","variant"]))}}),Oe=b({__name:"SelectUserDialog",props:w({width:{type:String,required:!1,defaultValue:"auto"},minWidth:{type:String,required:!1,defaultValue:""},maxWidth:{type:String,required:!1,defaultValue:""},actionLabel:{type:String,required:!1,defaultValue:"Select"},conventionId:{type:String,required:!1,defaultValue:""},variant:{type:String,required:!1,defaultValue:"filled"}},{modelValue:{type:Boolean,required:!0}}),emits:w(["update:user"],["update:modelValue"]),setup(s,{emit:p}){const n=h(s,"modelValue"),i=g(null),f=()=>{i.value!==null&&(p("update:user",i.value),n.value=!1)};return(u,r)=>(D(),O(S,{modelValue:n.value,"onUpdate:modelValue":r[2]||(r[2]=o=>n.value=o),width:s.width,"min-width":s.minWidth,"max-width":s.maxWidth},{default:a(()=>[e(R,null,{default:a(()=>[e(F,{dark:"",color:"primary"},{default:a(()=>[e(U,{icon:"",dark:"",onClick:r[0]||(r[0]=o=>n.value=!1)},{default:a(()=>[e(M,null,{default:a(()=>[m("mdi:mdi-close")]),_:1})]),_:1}),e(q,null,{default:a(()=>[m("Select User")]),_:1}),e(B),e(G,null,{default:a(()=>[e(U,{variant:"text",onClick:f},{default:a(()=>[m(C(s.actionLabel),1)]),_:1})]),_:1})]),_:1}),e(L,null,{default:a(()=>[e(ye,{"convention-id":s.conventionId,variant:s.variant,modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=o=>i.value=o)},null,8,["convention-id","variant","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","width","min-width","max-width"]))}}),we=b({__name:"UserPermissions",props:w(["name"],{modelValue:{required:!0}}),emits:w(["update:modelValue","close"],["update:modelValue"]),setup(s,{emit:p}){const n=h(s,"modelValue"),i=g(!1),f=r=>{r.Permissions||(r.Permissions={Organisation:[],Permissions:[]});const o=r.Permissions;o.Organisation||(o.Organisation=[]),o.Permissions||(o.Permissions=[]),n.value.push(r)},u=r=>{n.value.splice(r,1)};return(r,o)=>(D(),O(R,null,{default:a(()=>[e(F,{dark:"",color:"primary"},{default:a(()=>[e(U,{icon:"",dark:"",onClick:o[0]||(o[0]=t=>p("close"))},{default:a(()=>[e(M,null,{default:a(()=>[m("mdi:mdi-close")]),_:1})]),_:1}),e(q,null,{default:a(()=>[m("Permissions ("+C(s.name)+")",1)]),_:1}),e(B),e(G,null,{default:a(()=>[e(U,{variant:"text",onClick:o[1]||(o[1]=t=>p("close"))},{default:a(()=>[m(" Save ")]),_:1})]),_:1})]),_:1}),e(L,null,{default:a(()=>[e(Ve,null,{default:a(()=>[(D(!0),T(W,null,Z(n.value,(t,l)=>(D(),O(y,{key:t.ID,"no-gutters":""},{default:a(()=>[e(_,{cols:"4",md:"3"},{default:a(()=>[e(U,{icon:"mdi:mdi-minus",color:"red",size:"sm",onClick:v=>u(l)},null,8,["onClick"]),m(" "+C(t.DisplayName),1)]),_:2},1024),e(_,{cols:"8",md:"4"},{default:a(()=>[t.Permissions&&t.Permissions.Organisation?(D(),O(K,{key:0,modelValue:t.Permissions.Organisation,"onUpdate:modelValue":v=>t.Permissions.Organisation=v,variant:"solo",label:"Organisation"},null,8,["modelValue","onUpdate:modelValue"])):Y("",!0)]),_:2},1024),e(_,{cols:"4",md:"1"}),e(_,{cols:"8",md:"4"},{default:a(()=>[t.Permissions&&t.Permissions.Permissions?(D(),O(K,{key:0,modelValue:t.Permissions.Permissions,"onUpdate:modelValue":v=>t.Permissions.Permissions=v,variant:"solo",label:"User Permissions"},null,8,["modelValue","onUpdate:modelValue"])):Y("",!0)]),_:2},1024)]),_:2},1024))),128)),e(U,{onClick:o[2]||(o[2]=t=>i.value=!0)},{default:a(()=>[m("Add User")]),_:1}),e(Oe,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=t=>i.value=t),"onUpdate:user":f,"action-label":"Add",width:"600px"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}))}}),z=s=>(de("data-v-9c549085"),s=s(),me(),s),be=z(()=>N("p",{class:"mb-2"}," Are you sure you wish to delete this organisation? All data relating to it will be removed including all conventions their respective registrations and payment information. This action can not be undone. ",-1)),Ce=z(()=>N("p",{class:"mb-2"}," We are talking some Thanos level shit right here, if you proceed a team of super-powered beings with Daddy issues will hunt you down through time, space and twitter. ",-1)),he=z(()=>N("p",null,' To confirm type "I CLICK MY FINGERS" in the box below. ',-1)),Re=b({__name:"EditOrganisation",props:{modelValue:{required:!0}},emits:w(["change","close","delete"],["update:modelValue"]),setup(s,{emit:p}){const n=_e(),i=X(),f=h(s,"modelValue"),u=g(re(f.value)),r=g(`${i.GetOrganisationLogoURL(u.value.OrganisationUUID)}?${new Date().getTime()}`),o=g(),t=g(),l=g(!1),v=g(""),c=g(),oe=async()=>{var V;const d=new FormData((V=t.value)==null?void 0:V.$el);if(d.get("Image")&&d.get("Image").size>0)return d.set("OrganisationUUID",u.value.OrganisationUUID),await i.SaveOrganisationLogo(d)},ne=()=>{var d;oe(),(d=c.value)==null||d.validate().then(V=>{V&&n.saveOrganisation(u.value).then(I=>{I&&(f.value=I,p("change"),p("close"))})})},E=g({available:d=>!0,min:d=>d.length>=4||"Minimum 4 characters",required:d=>!!d||"Required.",valid:d=>!/[^0-9a-z_-]/.test(d)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),k=()=>{l.value=!1},se=()=>{l.value=!0},ie=({callback:d})=>{v.value="",n.deleteOrganisation(u.value.OrganisationUUID).then(V=>{V?d&&d("Convention Deleted"):d&&d("Failed to Delete Organisation"),setTimeout(()=>{k(),p("delete")},2e3)}).catch(()=>{d&&(d("Failed to Delete Organisation"),setTimeout(k,2e3))})},ue=()=>{r.value=URL.createObjectURL(o.value.files[0])};return(d,V)=>(D(),O(j,{"fast-fail":"",ref_key:"form",ref:c},{default:a(()=>[e(R,null,{default:a(()=>[e(F,{dark:"",color:"primary"},{default:a(()=>[e(U,{icon:"",dark:"",onClick:V[0]||(V[0]=I=>p("close"))},{default:a(()=>[e(M,null,{default:a(()=>[m("mdi:mdi-close")]),_:1})]),_:1}),e(q,null,{default:a(()=>[m(C(u.value.Name),1)]),_:1}),e(B),e(G,null,{default:a(()=>[e(U,{variant:"text",onClick:se},{default:a(()=>[m(" Delete ")]),_:1}),e(U,{variant:"text",onClick:ne},{default:a(()=>[m(" Save ")]),_:1})]),_:1})]),_:1}),e(L,null,{default:a(()=>[e(le,{fluid:!0},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12"},{default:a(()=>[e(te,{class:"imgLogo mx-auto",src:r.value||""},null,8,["src"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,{cols:"12"},{default:a(()=>[e(P,{label:x(A).formLabelName,type:"text",variant:"outlined",modelValue:u.value.Name,"onUpdate:modelValue":V[1]||(V[1]=I=>u.value.Name=I)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,{cols:"12"},{default:a(()=>[e(P,{label:x(A).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[E.value.available,E.value.min,E.value.required,E.value.valid],type:"text",variant:"outlined",modelValue:u.value.Slug,"onUpdate:modelValue":V[2]||(V[2]=I=>u.value.Slug=I)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,null,{default:a(()=>[e(j,{ref_key:"organisationImageForm",ref:t,enctype:"multipart/form-data"},{default:a(()=>[e(De,{label:x(A).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:o,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:ue},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{modelValue:l.value,"onUpdate:modelValue":V[4]||(V[4]=I=>l.value=I),width:"auto"},{default:a(()=>[e(R,null,{default:a(()=>[e(Q,null,{default:a(()=>[m(" Delete Organisation ")]),_:1}),e(ee,null,{default:a(()=>[m(" Your will be done ")]),_:1}),e(L,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,null,{default:a(()=>[be,Ce,he]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,null,{default:a(()=>[e(P,{modelValue:v.value,"onUpdate:modelValue":V[3]||(V[3]=I=>v.value=I),variant:"outlined",placeholder:"Enter text here",label:"Confirmation"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ae,null,{default:a(()=>[e(Ue,{color:"red-darken-3",label:"Delete",enabled:v.value=="I CLICK MY FINGERS",onClick:ie},null,8,["enabled"]),e(U,{color:"primary",onClick:k},{default:a(()=>[m("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},512))}});const Ee=J(Re,[["__scopeId","data-v-9c549085"]]),xe=b({__name:"Organisation",props:{modelValue:{required:!0}},emits:w(["delete"],["update:modelValue"]),setup(s,{emit:p}){const n=h(s,"modelValue"),i=X(),f=g(!1),u=g(!1),r=g(""),o=()=>{r.value=`${i.GetOrganisationLogoURL(n.value.OrganisationUUID)}?${new Date().getTime()}`};return o(),(t,l)=>{const v=fe("RouterLink");return D(),T(W,null,[e(R,null,{default:a(()=>[e(te,{class:"imgLogo mx-auto",src:r.value||""},null,8,["src"]),e(Q,null,{default:a(()=>[m(C(n.value.Name),1)]),_:1}),e(ee,null,{default:a(()=>[m(C(n.value.Slug),1)]),_:1}),e(ae,null,{default:a(()=>[e(y,{"no-gutters":""},{default:a(()=>[e(_,{class:"ma-1"},{default:a(()=>[e(U,{variant:"tonal",color:"primary",onClick:l[0]||(l[0]=c=>f.value=!0),width:"100%"},{default:a(()=>[m("Edit")]),_:1})]),_:1}),e(_,{class:"ma-1"},{default:a(()=>[e(U,{variant:"tonal",color:"red",onClick:l[1]||(l[1]=c=>u.value=!0),width:"100%"},{default:a(()=>[m("User Permissions")]),_:1})]),_:1}),e(_,{class:"ma-1"},{default:a(()=>[e(v,{to:`/dashboard/admin/${n.value.Slug?n.value.Slug:n.value.OrganisationUUID}/conventions`},{default:a(()=>[e(U,{variant:"tonal",color:"green",width:"100%"},{default:a(()=>[m("Convention Manager")]),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=c=>f.value=c),scrollable:!0},{default:a(()=>[e(Ee,{onClose:l[2]||(l[2]=c=>f.value=!1),modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=c=>n.value=c),onDelete:l[4]||(l[4]=c=>{f.value=!1,p("delete")}),onChange:o},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(S,{modelValue:u.value,"onUpdate:modelValue":l[8]||(l[8]=c=>u.value=c),scrollable:!0},{default:a(()=>[e(we,{onClose:l[6]||(l[6]=c=>u.value=!1),modelValue:x($),"onUpdate:modelValue":l[7]||(l[7]=c=>pe($)?$.value=c:null),name:n.value.Name},null,8,["modelValue","name"])]),_:1},8,["modelValue"])],64)}}});const Se=J(xe,[["__scopeId","data-v-2457d43e"]]),Le=N("h3",null,"Organisations",-1),ua=b({__name:"OrganisationsView",emits:["pageTitle"],setup(s,{emit:p}){const n=ve.getInstance(),i=g([]);p("pageTitle","Organisations");const f=()=>{const o={ID:0,OrganisationUUID:Ie(),Name:"New Organisation",Slug:"",Logo:""};n.saveOrganisation(o).then(t=>{t&&i.value.push(t)})},u=o=>{i.value.splice(o,1)};return(()=>{n.getOrganisations().then(o=>{i.value=o})})(),(o,t)=>(D(),O(le,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,null,{default:a(()=>[Le]),_:1}),e(_,{class:"text-right"},{default:a(()=>[e(U,{color:"primary",onClick:f},{default:a(()=>[m("New")]),_:1})]),_:1})]),_:1}),e(y,null,{default:a(()=>[(D(!0),T(W,null,Z(i.value,(l,v)=>(D(),O(_,{key:l.ID,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[e(Se,{modelValue:i.value[v],"onUpdate:modelValue":c=>i.value[v]=c,onDelete:c=>u(v)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024))),128))]),_:1})]),_:1}))}});export{ua as default};
