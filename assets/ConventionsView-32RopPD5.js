import{F as X}from"./form-0fJbSFPv.js";import{P as Z}from"./permission-7wLhDNXq.js";import{i as M,M as F,N as z,r as m,k as $,w as H,n as r,q as v,v as e,f as t,C as L,P as Y,_ as q,b as ee,l as te,A as D,y as oe,x as k,D as ne,B as O,V as ae,Q as le,F as ie,W as se}from"./index-Coiqs0Ka.js";import{a as K}from"./scopeId-fJIzUcwj.js";import{_ as ue}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-zM7AYgYC.js";import{u as re}from"./useModel-LgDJErs_.js";import{_ as de}from"./ModelDialog.vue_vue_type_script_setup_true_lang-X1T1oHG8.js";import{s as h}from"./index-OKsbKlsK.js";import{a as Q}from"./VContainer--mxasqAg.js";import{V as N,a as f}from"./VRow-mvYSrjf-.js";import{V as W}from"./VAvatar-f6q8OqBy.js";import{V as A}from"./VTextField-DyLvAsrW.js";import{V as me}from"./VTextarea-mM64hR1Y.js";import{V as ve}from"./VCheckbox-hMEU52JN.js";import{V as ce}from"./VForm-XB0FDyqn.js";import{V as fe}from"./VFileInput-zUZq7Ko9.js";import{G as B}from"./group-7fhbY6WJ.js";import{C as G}from"./canDo-4N33a1Ln.js";import{C as pe}from"./canEditRegistrations-QickYo-w.js";import{C as ge}from"./canViewOperations-iEjtIdBr.js";import{G as J}from"./userData-OFA3wNhZ.js";import{V as Ce,a as Ve,b as _e,c as j,d as De,e as Ue}from"./VCard-ZWAXG_KF.js";import{V as R}from"./VBtn-_SFGAJ40.js";import{C as Ie}from"./canEditOrganisation-2bFdQxjr.js";import{v as ye}from"./v4-yQnnJER4.js";import"./createSimpleFunctional-Wnvth9Ui.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-VGarMC03.js";import"./forwardRefs-IuIzLRow.js";import"./VDialog-b_dYvVQD.js";import"./VToolbar-_rznUKGL.js";import"./VCheckboxBtn-6kL6Xv5u.js";import"./VChip-fQCaaWUz.js";const we=(p=void 0,g=void 0)=>p===void 0?!1:g===void 0?G(p,B.GROUP_TYPE_CONVENTION).EditConvention:G(p,B.GROUP_TYPE_CONVENTION,g.ConventionUUID,g).EditConvention,Le=(p,g)=>p===void 0?!1:G(p,B.GROUP_TYPE_CONVENTION,g.ConventionUUID,g).ViewRegistration,Ne=M({__name:"EditConventionDialog",props:F({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:F(["update:convention","delete","save"],["update:modelValue"]),setup(p,{emit:g}){const S=p,y=Y(),o=K(),{title:c=""}=S,C=g,U=z(p,"modelValue"),V=re(S,C,void 0,void 0,"convention"),a=m($(V.value));H(V,()=>{a.value=$(V.value)});const _=m(`${o.GetConventionLogoURL(a.value.ConventionUUID)}?${new Date().getTime()}`),I=m(),x=m(),E=()=>{_.value=URL.createObjectURL(I.value.files[0])},T=()=>{C("delete")},s=()=>{a.value=$(V.value)},d=async()=>{var l;const u=new FormData((l=x.value)==null?void 0:l.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",a.value.ConventionUUID),await o.SaveConventionLogo(u)},w=u=>{d(),y.saveConvention(a.value).then(l=>{l?u&&u("Convention Data Saved").then(()=>{V.value=l,C("save",l)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,l)=>(r(),v(de,{modelValue:U.value,"onUpdate:modelValue":l[5]||(l[5]=n=>U.value=n),onDelete:T,onReset:s,onSave:w,title:L(c),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(Q,{class:"pa-0",fluid:!0},{default:e(()=>[t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(W,{class:"imgLogo mx-auto",src:_.value||""},null,8,["src"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(A,{label:L(h).formLabelName,name:"Name",variant:"outlined",modelValue:a.value.Name,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.Name=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(me,{label:L(h).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:a.value.Description,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.Description=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(A,{label:L(h).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:a.value.DetailLink,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.DetailLink=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(A,{label:L(h).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:a.value.Slug,"onUpdate:modelValue":l[3]||(l[3]=n=>a.value.Slug=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(ve,{label:L(h).formConventionVisible,name:"Visible",modelValue:a.value.Visible,"onUpdate:modelValue":l[4]||(l[4]=n=>a.value.Visible=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(f,null,{default:e(()=>[t(ce,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[t(fe,{label:L(h).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:I,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),xe=q(Ne,[["__scopeId","data-v-003c7991"]]),ke=["innerHTML"],be={key:0,class:"text-green"},Se={key:1,class:"text-red"},Te={key:0,class:"text-green"},he={key:1,class:"text-red"},Re=M({__name:"ConventionCard",props:F({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:F(["delete","duplicated"],["update:modelValue"]),setup(p,{emit:g}){const S=Y(),y=g,o=z(p,"modelValue"),c=K(),C=J(),U=m(c.GetConventionLogoURL(o.value.ConventionUUID)),V=m(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),a=m(!1),_=m(!1),I=m(!1),x=m(we(C,o.value)),E=m(pe(C,o.value)),T=m(Le(C,o.value)),s=m(ge(C,o.value)),d=()=>{I.value=!1,U.value=`${c.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},w=n=>{S.deleteConvention(o.value.ConventionUUID).then(i=>{i?n&&(n("Convention Deleted"),y("delete")):n&&n("Failed to Delete Convention"),setTimeout(()=>{_.value=!1},2e3)}).catch(()=>{n&&(n("Failed to Delete Organisation"),_.value=!1)})},u=()=>{S.duplicateConvention(o.value.ConventionUUID).then(n=>{n&&y("duplicated",n)})},l=n=>{n.altKey&&n.ctrlKey&&n.code==="KeyA"&&(a.value=!a.value)};return window.addEventListener("keydown",l),ee(()=>{window.removeEventListener("keydown",l)}),(n,i)=>{const P=te("RouterLink");return r(),v(Ue,null,{default:e(()=>[t(Ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[U.value?(r(),v(W,{key:0,src:U.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),o.value.Name?(r(),v(Ve,{key:1},{default:e(()=>[k(oe(o.value.Name)+" ",1),x.value&&a.value?(r(),v(R,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:u})):D("",!0)]),_:1})):D("",!0),o.value.Description?(r(),v(_e,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ne("div",{innerHTML:o.value.Description},null,8,ke)]),_:1})):D("",!0),t(j,{class:"px-0 pb-0"},{default:e(()=>[k(" Visibility:  "),o.value.Visible?(r(),O("span",be,"Visible")):(r(),O("span",Se,"Hidden"))]),_:1}),t(j,{class:"px-0 pb-0"},{default:e(()=>[k(" Registration:  "),n.open?(r(),O("span",Te,"Open")):(r(),O("span",he,"Closed"))]),_:1})]),_:1}),t(De,null,{default:e(()=>[t(N,{"no-gutters":""},{default:e(()=>[x.value?(r(),v(f,{key:0,class:"ma-1"},{default:e(()=>[t(R,{variant:"tonal",color:"primary",onClick:i[0]||(i[0]=b=>I.value=!0),width:"100%"},{default:e(()=>[k("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),x.value?(r(),v(f,{key:2,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t(R,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[k("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),T.value||E.value?(r(),v(f,{key:3,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t(R,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[k("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),s.value?(r(),v(f,{key:4,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/operations`},{default:e(()=>[t(R,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[k("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0)]),_:1})]),_:1}),I.value?(r(),v(xe,{key:0,modelValue:I.value,"onUpdate:modelValue":i[1]||(i[1]=b=>I.value=b),convention:o.value,"onUpdate:convention":i[2]||(i[2]=b=>o.value=b),onDelete:i[3]||(i[3]=b=>_.value=!0),onSave:d,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),_.value?(r(),v(ue,{key:1,modelValue:_.value,"onUpdate:modelValue":i[4]||(i[4]=b=>_.value=b),"confirmation-text":"I UNDERSTAND",message:V.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:w},null,8,["modelValue","message"])):D("",!0)]),_:1})}}}),Ee=q(Re,[["__scopeId","data-v-9433b945"]]),Oe=M({__name:"ConventionsView",emits:["pageTitle"],setup(p,{emit:g}){var T;g("pageTitle","Conventions");const y=Y(),o=J(),c=m([]),C=m([]),U=ae();let V=((T=U.params.organisation)==null?void 0:T.toString())||"";const a=m();H(U,()=>{var s,d;V!==((s=U.params.organisation)==null?void 0:s.toString())&&(V=((d=U.params.organisation)==null?void 0:d.toString())||"",_())});const _=()=>{V?y.getOrganisation(V).then(s=>{s&&(a.value=s,y.getConventionList(s.OrganisationUUID).then(d=>{d&&(c.value=d,I())}))}).catch(()=>{}):y.getPermissionAccessList(Z.PERMISSION_TYPE_NULL).then(s=>{s&&(c.value=s.Conventions,I())})},I=()=>{c.value.forEach(s=>{y.getConventionForms(s.ConventionUUID).then(d=>{d&&(C.value=[...C.value,...d])}).catch(d=>{console.error(d)})})},x=()=>{var s,d;if(a.value){const w={ID:0,ConventionUUID:ye(),OrganisationID:((s=a.value)==null?void 0:s.ID)||0,OrganisationUUID:((d=a.value)==null?void 0:d.OrganisationUUID)||se,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};y.saveConvention(w).then(u=>{u&&c.value.push(u)})}},E=s=>{c.value.splice(s,1)};return _(),(s,d)=>(r(),v(Q,null,{default:e(()=>[t(N,{class:"justify-center"},{default:e(()=>[(r(!0),O(ie,null,le(c.value,(w,u)=>(r(),v(f,{key:w.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var l,n;return[t(Ee,{modelValue:c.value[u],"onUpdate:modelValue":i=>c.value[u]=i,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((l=w.Organisation)==null?void 0:l.Slug)||((n=w.Organisation)==null?void 0:n.OrganisationUUID)||"",open:!!C.value.find(i=>i.ConventionUUID===w.ConventionUUID&&i.Type===L(X).FORM_TYPE_REGISTRATION&&i.State&&i.State.New),onDelete:i=>E(u),onDuplicated:i=>c.value.push(i)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),t(N,null,{default:e(()=>[a.value&&L(Ie)(L(o),a.value)?(r(),v(f,{key:0,class:"text-right"},{default:e(()=>[t(R,{color:"primary",onClick:x},{default:e(()=>[k("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}}),ft=q(Oe,[["__scopeId","data-v-f895f3c5"]]);export{ft as default};
