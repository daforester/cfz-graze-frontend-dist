import{f as Ve,u as pe,g as we,h as Ce,a as Me}from"./VSelect-cc687147.js";import{i as Se,j as xe,V as ee,g as Ie}from"./VTextField-68dc880d.js";import{i as be,u as Pe,V as Ae}from"./rounded-17dcc806.js";import{p as ne,y as L,h as I,M as J,K as Ke,at as W,ae as re,an as _e,a2 as De,a as Le,a7 as Re,s as N,x as X,k as te,c,F as H,m as z,e as Te,au as Oe,z as le}from"./index-3b87d87f.js";import{u as Ee,V as je,a as ae}from"./VList-2e0a3d0f.js";import{m as Ue}from"./index-2c63a4b0.js";import{a as ue}from"./VBtn-a6edf83f.js";import{a as Be}from"./VChip-a1ec4bf4.js";const Ne=(e,n,t)=>e==null||n==null?-1:e.toString().toLocaleLowerCase().indexOf(n.toString().toLocaleLowerCase()),ze=ne({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function He(e,n,t){var C;const k=[],f=(t==null?void 0:t.default)??Ne,d=t!=null&&t.filterKeys?re(t.filterKeys):!1,m=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return k;e:for(let p=0;p<e.length;p++){const h=e[p],o={},a={};let g=-1;if(n&&!(t!=null&&t.noFilter)){if(typeof h=="object"){const R=d||Object.keys(h);for(const S of R){const O=_e(h,S,h),s=(C=t==null?void 0:t.customKeyFilter)==null?void 0:C[S];if(g=s?s(O,n,h):f(O,n,h),g!==-1&&g!==!1)s?o[S]=g:a[S]=g;else if((t==null?void 0:t.filterMode)==="every")continue e}}else g=f(h,n,h),g!==-1&&g!==!1&&(a.title=g);const M=Object.keys(a).length,b=Object.keys(o).length;if(!M&&!b||(t==null?void 0:t.filterMode)==="union"&&b!==m&&!M||(t==null?void 0:t.filterMode)==="intersection"&&(b!==m||!M))continue}k.push({index:p,matches:{...a,...o}})}return k}function $e(e,n,t,k){const f=L([]),d=L(new Map),m=I(()=>k!=null&&k.transform?J(n).map(k==null?void 0:k.transform):J(n));Ke(()=>{const p=typeof W(t)!="string"&&typeof W(t)!="number"?"":String(W(t)),h=He(m.value,p,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),o=J(n),a=[],g=new Map;h.forEach(M=>{let{index:b,matches:R}=M;const S=o[b];a.push(S),g.set(S.value,R)}),f.value=a,d.value=g});function C(p){return d.value.get(p.value)}return{filteredItems:f,filteredMatches:d,getMatches:C}}function Qe(e,n,t){if(n==null)return e;if(Array.isArray(n))throw new Error("Multiple matches is not implemented");return typeof n=="number"&&~n?c(H,null,[c("span",{class:"v-autocomplete__unmask"},[e.substr(0,n)]),c("span",{class:"v-autocomplete__mask"},[e.substr(n,t)]),c("span",{class:"v-autocomplete__unmask"},[e.substr(n+t)])]):e}const Ge=ne({autoSelectFirst:{type:[Boolean,String]},search:String,...ze({filterKeys:["title"]}),...Ve(),...De(Se({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...Ue({transition:!1})},"VAutocomplete"),lt=Le()({name:"VAutocomplete",props:Ge(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,n){let{slots:t}=n;const{t:k}=Re(),f=L(),d=N(!1),m=N(!0),C=L(!1),p=L(),h=X(e,"menu"),o=I({get:()=>h.value,set:l=>{var r;h.value&&!l&&((r=p.value)!=null&&r.Î¨openChildren)||(h.value=l)}}),a=N(-1),g=I(()=>{var l;return(l=f.value)==null?void 0:l.color}),{items:M,transformIn:b,transformOut:R}=Ee(e),{textColorClasses:S,textColorStyles:O}=be(g),s=X(e,"search",""),w=X(e,"modelValue",[],l=>b(l===null?[null]:re(l)),l=>{const r=R(l);return e.multiple?r:r[0]??null}),K=xe(),{filteredItems:E,getMatches:ce}=$e(e,M,()=>m.value?"":s.value),x=I(()=>w.value.map(l=>M.value.find(r=>e.valueComparator(r.value,l.value))||l)),P=I(()=>e.hideSelected?E.value.filter(l=>!x.value.some(r=>r.value===l.value)):E.value),$=I(()=>x.value.map(l=>l.props.value)),Y=I(()=>x.value[a.value]),j=I(()=>{var r;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&s.value===((r=P.value[0])==null?void 0:r.title))&&P.value.length>0&&!m.value&&!C.value}),Q=I(()=>e.hideNoData&&!M.value.length||e.readonly||(K==null?void 0:K.isReadonly.value)),G=L(),{onListScroll:oe,onListKeydown:se}=pe(G,f);function ie(l){e.openOnClear&&(o.value=!0),s.value=""}function ve(){Q.value||(o.value=!0)}function fe(l){Q.value||(d.value&&(l.preventDefault(),l.stopPropagation()),o.value=!o.value)}function de(l){var D,u,y;if(e.readonly||K!=null&&K.isReadonly.value)return;const r=f.value.selectionStart,v=$.value.length;if((a.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(o.value=!0),["Escape"].includes(l.key)&&(o.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(j.value&&["Enter","Tab"].includes(l.key)&&_(E.value[0]),m.value=!0),l.key==="ArrowDown"&&j.value&&((D=G.value)==null||D.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(a.value<0){l.key==="Backspace"&&!s.value&&(a.value=v-1);return}const i=a.value;Y.value&&_(Y.value),a.value=i>=v-1?v-2:i}if(l.key==="ArrowLeft"){if(a.value<0&&r>0)return;const i=a.value>-1?a.value-1:v-1;x.value[i]?a.value=i:(a.value=-1,f.value.setSelectionRange((u=s.value)==null?void 0:u.length,(y=s.value)==null?void 0:y.length))}if(l.key==="ArrowRight"){if(a.value<0)return;const i=a.value+1;x.value[i]?a.value=i:(a.value=-1,f.value.setSelectionRange(0,0))}}}function me(l){s.value=l.target.value}function he(){var l;d.value&&(m.value=!0,(l=f.value)==null||l.focus())}function ge(l){d.value=!0,setTimeout(()=>{C.value=!0})}function ye(l){C.value=!1}function ke(l){(l==null||l===""&&!e.multiple)&&(w.value=[])}const T=N(!1);function _(l){if(e.multiple){const r=$.value.findIndex(v=>e.valueComparator(v,l.value));if(r===-1)w.value=[...w.value,l];else{const v=[...w.value];v.splice(r,1),w.value=v}}else w.value=[l],T.value=!0,s.value=l.title,o.value=!1,m.value=!0,le(()=>T.value=!1)}return te(d,(l,r)=>{var v;l!==r&&(l?(T.value=!0,s.value=e.multiple?"":String(((v=x.value.at(-1))==null?void 0:v.props.title)??""),m.value=!0,le(()=>T.value=!1)):(!e.multiple&&!s.value?w.value=[]:j.value&&!C.value&&!x.value.some(D=>{let{value:u}=D;return u===P.value[0].value})&&_(P.value[0]),o.value=!1,s.value="",a.value=-1))}),te(s,l=>{!d.value||T.value||(l&&(o.value=!0),m.value=!l)}),Pe(()=>{const l=!!(e.chips||t.chip),r=!!(!e.hideNoData||P.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),v=w.value.length>0,[D]=ee.filterProps(e);return c(ee,z({ref:f},D,{modelValue:s.value,"onUpdate:modelValue":ke,focused:d.value,"onUpdate:focused":u=>d.value=u,validationValue:w.externalValue,dirty:v,onInput:me,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":o.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!t.selection,"v-autocomplete--selecting-index":a.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:v?void 0:e.placeholder,"onClick:clear":ie,"onMousedown:control":ve,onKeydown:de}),{...t,default:()=>c(H,null,[c(we,z({ref:p,modelValue:o.value,"onUpdate:modelValue":u=>o.value=u,activator:"parent",contentClass:"v-autocomplete__content",disabled:Q.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:he},e.menuProps),{default:()=>[r&&c(je,{ref:G,selected:$.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onKeydown:se,onFocusin:ge,onFocusout:ye,onScrollPassive:oe,tabindex:"-1"},{default:()=>{var u,y,i;return[(u=t["prepend-item"])==null?void 0:u.call(t),!P.value.length&&!e.hideNoData&&(((y=t["no-data"])==null?void 0:y.call(t))??c(ae,{title:k(e.noDataText)},null)),c(Ce,{renderless:!0,items:P.value},{default:A=>{var q;let{item:F,index:V,itemRef:Fe}=A;const Z=z(F.props,{ref:Fe,key:V,active:j.value&&V===0?!0:void 0,onClick:()=>_(F)});return((q=t.item)==null?void 0:q.call(t,{item:F,index:V,props:Z}))??c(ae,Z,{prepend:U=>{let{isSelected:B}=U;return c(H,null,[e.multiple&&!e.hideSelected?c(Me,{key:F.value,modelValue:B,ripple:!1,tabindex:"-1"},null):void 0,F.props.prependIcon&&c(ue,{icon:F.props.prependIcon},null)])},title:()=>{var U,B;return m.value?F.title:Qe(F.title,(U=ce(F))==null?void 0:U.title,((B=s.value)==null?void 0:B.length)??0)}})}}),(i=t["append-item"])==null?void 0:i.call(t)]}})]}),x.value.map((u,y)=>{var F;function i(V){V.stopPropagation(),V.preventDefault(),_(u)}const A={"onClick:close":i,onMousedown(V){V.preventDefault(),V.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0};return c("div",{key:u.value,class:["v-autocomplete__selection",y===a.value&&["v-autocomplete__selection--selected",S.value]],style:y===a.value?O.value:{}},[l?t.chip?c(Ae,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>{var V;return[(V=t.chip)==null?void 0:V.call(t,{item:u,index:y,props:A})]}}):c(Be,z({key:"chip",closable:e.closableChips,size:"small",text:u.title},A),null):((F=t.selection)==null?void 0:F.call(t,{item:u,index:y}))??c("span",{class:"v-autocomplete__selection-text"},[u.title,e.multiple&&y<x.value.length-1&&c("span",{class:"v-autocomplete__selection-comma"},[Te(",")])])])})]),"append-inner":function(){var A;for(var u=arguments.length,y=new Array(u),i=0;i<u;i++)y[i]=arguments[i];return c(H,null,[(A=t["append-inner"])==null?void 0:A.call(t,...y),e.menuIcon?c(ue,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:fe,onClick:Oe},null):void 0])}})}),Ie({isFocused:d,isPristine:m,menu:o,search:s,filteredItems:E,select:_},f)}});export{lt as V,ze as m,$e as u};
