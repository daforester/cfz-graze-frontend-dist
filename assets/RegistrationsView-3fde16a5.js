import{p as Be,n as $e,e as ee,t as Z,c as He,G as qe,v as i,H as y,x as Oe,I as te,a1 as Fe,a2 as je,r as C,a3 as ce,K as n,L as b,M as m,$ as fe,S as x,a8 as Me,Z as G,Q as Y,R as U,N as P,O as h,_ as Ve,U as w,a4 as Je,a0 as Ke,w as We}from"./index-ab102e80.js";import{e as ze,T as Qe,d as Xe,c as Ze}from"./FormRenderer.vue_vue_type_style_index_0_lang-8a9cb02d.js";import{a as xe,F as J}from"./form-e2a93b7c.js";import{_ as et}from"./ModelDialog.vue_vue_type_script_setup_true_lang-850fc7cc.js";import{m as tt,k as at,l as ot,n as lt,o as nt,p as it,q as st,u as ut,r as rt,s as dt,t as _t,v as mt,w as At,x as Ut,y as Tt,z as Le,A as ke,B as Ne,_ as Et,f as be,g as St,h as ct,i as Rt,j as vt,d as It}from"./VWindowItem-b4bdb246.js";import{a as ne,V as W}from"./VRow-146e9ef6.js";import{V as Ce}from"./VTextField-21bc8012.js";import{V as ae}from"./copyToClipboard-c9e0246a.js";import{u as Dt,j as pe}from"./VContainer-51eb9763.js";import{v as ie}from"./v4-a960c1f4.js";import{V as Se}from"./VBtn-b6b36bf8.js";import{e as ye,b as Ot,V as Ct,c as Pe}from"./VCard-2743441e.js";import{V as Ge}from"./VDialog-b24200c5.js";import{S as pt}from"./submission-56c4c4f1.js";import{V as Mt}from"./VAvatar-e1a860af.js";import{s as Ee}from"./sortSubmissions-ed9e4490.js";import{u as ft}from"./useStoreAPI-810ca54c.js";import{u as yt,V as gt}from"./VToolbar-a44dc471.js";import{V as Ft}from"./VSpacer-52cf4cdf.js";import{V as he}from"./VTable-987a9c2b.js";import"./VCheckbox-3688d1ae.js";import"./index-71069b21.js";import"./VList-9dc46f9e.js";import"./VDivider-d5f5b4bd.js";import"./VChip-f066083c.js";import"./scopeId-f299ad7a.js";import"./VTextarea-50c708b2.js";import"./userData-8b8a6097.js";import"./VForm-ee8d5f94.js";import"./VToolbarItems-13d758fd.js";var Ye=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Ye||{});const Lt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var se=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(se||{});const kt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var f=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(f||{});const Nt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var g=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(g||{});const bt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],ht=Be({itemsLength:{type:[Number,String],required:!0},...tt(),...at(),...ot()},"VDataTableServer"),Vt=$e()({name:"VDataTableServer",props:ht(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,k)=>!0},setup(e,k){let{emit:A,slots:a}=k;const{groupBy:s}=lt(e),{sortBy:u,multiSort:D,mustSort:T}=nt(e),{page:E,itemsPerPage:p}=it(e),t=ee(()=>parseInt(e.itemsLength,10)),{columns:_,headers:l}=st(e,{groupBy:s,showSelect:Z(e,"showSelect"),showExpand:Z(e,"showExpand")}),{items:F}=ut(e,_),{toggleSort:v}=rt({sortBy:u,multiSort:D,mustSort:T,page:E}),{opened:j,isGroupOpen:V,toggleGroup:z,extractRows:$}=dt({groupBy:s,sortBy:u}),{pageCount:ue,setItemsPerPage:re}=_t({page:E,itemsPerPage:p,itemsLength:t}),{flatItems:oe}=mt(F,s,j),{isSelected:de,select:_e,selectAll:H,toggleSelect:Re,someSelected:me,allSelected:Ae}=At(e,{allItems:F,currentPage:F}),{isExpanded:ve,toggleExpand:Ie}=Ut(e),Ue=ee(()=>$(F.value));Tt({page:E,itemsPerPage:p,sortBy:u,groupBy:s,search:Z(e,"search")}),He("v-data-table",{toggleSort:v,sortBy:u}),qe({VDataTableRows:{hideNoData:Z(e,"hideNoData"),noDataText:Z(e,"noDataText"),loading:Z(e,"loading"),loadingText:Z(e,"loadingText")}});const o=ee(()=>({page:E.value,itemsPerPage:p.value,sortBy:u.value,pageCount:ue.value,toggleSort:v,setItemsPerPage:re,someSelected:me.value,allSelected:Ae.value,isSelected:de,select:_e,selectAll:H,toggleSelect:Re,isExpanded:ve,toggleExpand:Ie,isGroupOpen:V,toggleGroup:z,items:Ue.value,groupedItems:oe.value,columns:_.value,headers:l.value}));Dt(()=>{const[S]=Le.filterProps(e),[r]=ke.filterProps(e),[c]=Ne.filterProps(e),[B]=he.filterProps(e);return i(he,Oe({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},B),{top:()=>{var M;return(M=a.top)==null?void 0:M.call(a,o.value)},default:()=>{var M,le,N,K;return a.default?a.default(o.value):i(y,null,[(M=a.colgroup)==null?void 0:M.call(a,o.value),i("thead",{class:"v-data-table__thead",role:"rowgroup"},[i(ke,Oe(r,{sticky:e.fixedHeader}),a)]),(le=a.thead)==null?void 0:le.call(a,o.value),i("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(o.value):i(Ne,Oe(c,{items:oe.value}),a)]),(N=a.tbody)==null?void 0:N.call(a,o.value),(K=a.tfoot)==null?void 0:K.call(a,o.value)])},bottom:()=>a.bottom?a.bottom(o.value):i(Le,S,{prepend:a["footer.prepend"]})})})}}),Pt=te({__name:"EditAdminLayout",props:Fe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Fe(["save"],["update:modelValue"]),setup(e,{emit:k}){const A=je(e,"modelValue"),a=C(ce(e.layout)),s=C([]),u=fe(),D=({callback:t})=>{const _=()=>{t&&t("Failed to Save Layout")},l=()=>{t&&t("Layout Saved")};u.saveAdminLayout(a.value).then(F=>{F?(l(),k("save",F)):_()}).catch(()=>{_()})},T=()=>({ID:0,LayoutPanelUUID:ie(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:J.FORM_TYPE_NIL,RequiredGroupMemberships:[]}),E=t=>()=>({ID:0,LayoutItemUUID:ie(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:se.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),p=t=>{const _=s.value.find(l=>l.value===t.SectionFieldUUID);_&&(t.SectionFieldID=_.object.ID,t.SectionField=_.object)};return u.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(_=>_.Sections.forEach(l=>l.Fields&&s.value.push(...l.Fields.map(F=>{var j;return{title:`${_.Name} - ${l.Name} - ${(j=F.Field)==null?void 0:j.Name}`,value:F.SectionFieldUUID,object:F}})))),s.value.sort(ze("title"))}),(t,_)=>(n(),b(et,{modelValue:A.value,"onUpdate:modelValue":_[3]||(_[3]=l=>A.value=l),onSave:D,title:t.title,color:"primary"},{default:m(()=>[i(pe,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[i(ne,null,{default:m(()=>[i(W,{cols:"12",sm:"6"},{default:m(()=>[i(Ce,{modelValue:a.value.Name,"onUpdate:modelValue":_[0]||(_[0]=l=>a.value.Name=l),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),i(W,{cols:"12",sm:"6"},{default:m(()=>[i(ae,{modelValue:a.value.Type,"onUpdate:modelValue":_[1]||(_[1]=l=>a.value.Type=l),label:"Layout Type",items:x(Lt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),i(be,{modelValue:a.value.Panels,"onUpdate:modelValue":_[2]||(_[2]=l=>a.value.Panels=l),"new-item":T,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Me({_:2},[G(a.value.Panels,(l,F)=>({name:`panel_${F}`,fn:m(()=>[i(pe,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[i(ne,null,{default:m(()=>[i(W,{cols:"12",sm:"6"},{default:m(()=>[i(Ce,{modelValue:l.Name,"onUpdate:modelValue":v=>l.Name=v,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),i(W,{cols:"12",sm:"6"},{default:m(()=>[i(ae,{modelValue:l.RequiredFormType,"onUpdate:modelValue":v=>l.RequiredFormType=v,items:x(xe),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),i(ne,null,{default:m(()=>[i(W,{cols:"12"},{default:m(()=>[i(Et,{label:"Required Groups",variant:"outlined",modelValue:l.RequiredGroupMemberships,"onUpdate:modelValue":v=>l.RequiredGroupMemberships=v,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),i(be,{modelValue:l.Items,"onUpdate:modelValue":v=>l.Items=v,"new-item":E(l),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Me({_:2},[G(l.Items,(v,j)=>({name:`item_${j}`,fn:m(()=>[i(pe,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[i(ne,null,{default:m(()=>[i(W,{cols:"12",sm:"6"},{default:m(()=>[i(Ce,{modelValue:v.Label,"onUpdate:modelValue":V=>v.Label=V,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),i(ne,null,{default:m(()=>[i(W,{cols:"12",sm:"6"},{default:m(()=>[i(ae,{modelValue:v.SourceType,"onUpdate:modelValue":V=>v.SourceType=V,label:"Source Type",items:x(kt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),i(W,{cols:"12",sm:"6"},{default:m(()=>[v.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),b(ae,{key:0,modelValue:v.SectionFieldUUID,"onUpdate:modelValue":V=>v.SectionFieldUUID=V,label:"Form Data",items:s.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:V=>p(v)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):v.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),b(ae,{key:1,modelValue:v.MetaField,"onUpdate:modelValue":V=>v.MetaField=V,label:"Miscellaneous Data",items:x(Nt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):v.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),b(ae,{key:2,modelValue:v.UserField,"onUpdate:modelValue":V=>v.UserField=V,label:"User Profile Data",items:x(bt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):Y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Gt={key:1,class:"accommodationList"},Yt=te({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},registration:{},value:{default:""},venues:{}},setup(e){const k=C(!1),A=ee(()=>{if(!e.value)return[];const a=JSON.parse(e.value),s=e.accommodations.filter(u=>a.includes(u.AccommodationUUID)).sort((u,D)=>{const T=a.findIndex(p=>p===u.AccommodationUUID),E=a.findIndex(p=>p===D.AccommodationUUID);return T>E?1:-1});return ce(s)});return(a,s)=>{var u,D,T;return n(),U(y,null,[a.registration.Allocation?(n(),U(y,{key:0},[P(h((u=a.accommodations.find(E=>E.AccommodationUUID))==null?void 0:u.Name)+" "+h((T=(D=a.venues)==null?void 0:D.map(E=>E.Rooms.find(p=>p.RoomUUID===a.registration.Allocation.RoomUUID)).filter(E=>E!=null)[0])==null?void 0:T.Name),1)],64)):Y("",!0),a.value?(n(),U("ol",Gt,[(n(!0),U(y,null,G(A.value,E=>(n(),U("li",{key:E.AccommodationUUID},h(E.Name),1))),128))])):Y("",!0),i(Se,{onClick:s[0]||(s[0]=E=>k.value=!0),variant:"flat",color:"success"},{default:m(()=>[P("Assign Accommodation")]),_:1}),i(Ge,{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=E=>k.value=E)},{default:m(()=>[i(ye,null,{default:m(()=>[i(Ot,null,{default:m(()=>[i(Ct,null,{default:m(()=>[P("Accommodation Allocation")]),_:1})]),_:1}),i(Pe,null,{default:m(()=>[P(" WIP ")]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const wt=Ve(Yt,[["__scopeId","data-v-a687237f"]]),Bt={key:0,class:"addonList"},$t={key:0},Ht={key:0},qt=te({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const k=ee(()=>{if(!e.value)return;const A=JSON.parse(e.value),a=Object.keys(A),s=ce(e.extras);return s.forEach(u=>{u.Options=u.Options.filter(D=>a.includes(D.OptionUUID)?(D.Choices=D.Choices.filter(T=>T.TagUUID===A[D.OptionUUID].choiceId),A[D.OptionUUID].checked):!1)}),s.filter(u=>u.Options.length>0),s});return(A,a)=>A.value?(n(),U("ul",Bt,[(n(!0),U(y,null,G(k.value,s=>(n(),U(y,{key:s.ExtraUUID},[s.Options.length?(n(),U("li",$t,[w("strong",null,h(s.Name),1),w("ul",null,[(n(!0),U(y,null,G(s.Options,u=>(n(),U("li",{key:u.OptionUUID},[P(h(u.Name)+" ",1),u.Choices.length==1?(n(),U("small",Ht,"("+h(u.Choices[0].Title)+")",1)):Y("",!0)]))),128))])])):Y("",!0)],64))),128))])):Y("",!0)}});const jt=Ve(qt,[["__scopeId","data-v-002a6d6d"]]),Jt={key:0},Kt=te({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const k=ee(()=>{if(!e.value)return;const A=JSON.parse(e.value);return Object.entries(A).filter(([,a])=>a).map(([a,s])=>e.interests.find(u=>u.InterestUUID===a)).filter(a=>a!==void 0)});return(A,a)=>A.value?(n(),U("ul",Jt,[(n(!0),U(y,null,G(k.value,s=>(n(),U("li",{key:s.InterestUUID},h(s.Name),1))),128))])):Y("",!0)}}),Wt=w("br",null,null,-1),zt=w("small",null,"Options:",-1),Qt=w("br",null,null,-1),Xt=w("small",null,"Addons:",-1),Zt=te({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const k=ee(()=>{if(!e.value)return;let A={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{A=JSON.parse(e.value),"ticket"in A&&(A.Ticket=A.ticket),"addonsChecked"in A&&(A.AddonsChecked=A.addonsChecked),"componentsChecked"in A&&(A.ComponentsChecked=A.componentsChecked)}catch{}return A.Ticket.filter(a=>{const s=e.tickets.find(u=>u.TicketUUID===a);return!(!s||s.Type!==Qe.TICKET_TYPE_TICKET)}).map(a=>{const s=e.tickets.find(D=>D.TicketUUID===a),u=ce(s);return u.TicketComponents=s.TicketComponents.filter(D=>A.ComponentsChecked.includes(D.TicketUUID)),u.AddonTickets=s.AddonTickets.filter(D=>A.AddonsChecked.includes(D.TicketUUID)),u})});return(A,a)=>A.value?(n(!0),U(y,{key:0},G(k.value,s=>(n(),U("div",{key:s.TicketUUID},[w("strong",null,h(s.Name),1),s.TicketComponents.length>0?(n(),U(y,{key:0},[Wt,zt,P("  "),(n(!0),U(y,null,G(s.TicketComponents,u=>(n(),U(y,{key:u.TicketUUID},[w("small",null,h(u.Name),1),P("  ")],64))),128))],64)):Y("",!0),s.AddonTickets.length>0?(n(),U(y,{key:1},[Qt,Xt,P("  "),(n(!0),U(y,null,G(s.AddonTickets,u=>(n(),U("small",{key:u.TicketUUID},[P("("),w("em",null,h(u.Name),1),P(")")]))),128))],64)):Y("",!0)]))),128)):Y("",!0)}}),xt={key:0},ea={key:0},ta=w("strong",null,"Total:",-1),aa=te({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:k}){const A=fe(),a=C(),s=C(),u=C(),D=C(),T=C(!1),E=t=>{console.log(t)},p=(t,_,l)=>{s.value=t,A.getRegistrationGroup(l.RegistrationUUID||"").then(F=>{u.value=F,a.value=_,D.value=l,T.value=!0})};return(t,_)=>(n(),U(y,null,[t.header.key=="actions"?(n(),b(Se,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:_[0]||(_[0]=l=>E(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(n(),b(wt,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(n(),b(jt,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(n(),b(Kt,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(n(),b(Zt,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(n(!0),U(y,{key:5},G(t.item.raw[t.header.key],l=>(n(),U("ul",{key:l.Heading},[w("li",null,[w("strong",null,h(l.Heading)+":",1),P(" "+h(x(pt)(l.Submission.Status))+" ",1),i(Se,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:F=>p(l.Registration,l.Form,l.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(n(),b(Mt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(n(),U(y,{key:7},[t.item.raw[t.header.key].length===1?(n(),U("em",xt," Not in a group ")):(n(),U(y,{key:1},[w("ul",null,[(n(!0),U(y,null,G(t.item.raw[t.header.key],l=>(n(),U("li",{key:l.UUID,class:"ml-0"},[P(h(l.Name)+" ",1),l.IsLeader?(n(),U("strong",ea,"(Leader)")):Y("",!0)]))),128))]),ta,P(" "+h(t.item.raw[t.header.key].length),1)],64))],64)):(n(),U(y,{key:8},[P(h(t.item.raw[t.header.key]),1)],64)),T.value&&D.value&&a.value?(n(),b(Ge,{key:9,modelValue:T.value,"onUpdate:modelValue":_[3]||(_[3]=l=>T.value=l),scrollable:!0},{default:m(()=>[i(ye,{class:"bg-red-darken-4"},{default:m(()=>[i(Pe,null,{default:m(()=>[i(Xe,{modelValue:a.value,"onUpdate:modelValue":_[1]||(_[1]=l=>a.value=l),admin:!0,convention:t.convention,data:D.value,editable:!0,"registration-group":u.value,onClose:_[2]||(_[2]=l=>{T.value=!1,k("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Y("",!0)],64))}}),Na=te({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:k}){var Ue;const A=ft();k("pageTitle","Registration Manager");const a=Je(),s=Ke(),u=C(!0);let D=((Ue=a.params.convention)==null?void 0:Ue.toString())||"";const T=C({ID:0,ConventionUUID:ie(),OrganisationID:0,OrganisationUUID:yt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),E=fe(),p=C({ID:0,AdminLayoutUUID:ie(),ConventionID:T.value.ID,ConventionUUID:T.value.ConventionUUID,Name:"Registration Table",Type:Ye.ADMIN_LAYOUT_TABLE,Panels:[]}),t=C([]),_=C([]),l=C([]),F=C(1),v=C(10),j=C([]),V=C(0),z=C(!1),$=C(""),ue=C([]),re=C([]),oe=C([]),de=C([]),_e=C([]),H=C(0);We(H,o=>{o===7&&Ae()});const Re=()=>{t.value=[],_.value=[],l.value=[];try{E.getConventionAdminLayoutByName(T.value.ConventionUUID,"Registration Table").then(o=>{H.value+=1,o?p.value=o:(p.value.ConventionID=T.value.ID,p.value.ConventionUUID=T.value.ConventionUUID)})}catch{p.value.ConventionID=T.value.ID,p.value.ConventionUUID=T.value.ConventionUUID}try{E.getConventionForms(T.value.ConventionUUID).then(o=>{H.value+=1,o&&(t.value=o)})}catch{}try{E.getConventionAccommodation(T.value.ConventionUUID).then(o=>{H.value+=1,o&&(ue.value=o)})}catch{}try{E.getConventionVenues(T.value.ConventionUUID).then(o=>{H.value+=1,o&&(_e.value=o)})}catch{}try{E.getConventionExtras(T.value.ConventionUUID).then(o=>{H.value+=1,o&&(re.value=o)})}catch{}try{E.getConventionInterests(T.value.ConventionUUID).then(o=>{H.value+=1,o&&(oe.value=o)})}catch{}try{E.getConventionTickets(T.value.ConventionUUID).then(o=>{H.value+=1,o&&(de.value=o)})}catch{}},me=({page:o,itemsPerPage:S,sortBy:r})=>{F.value=o,j.value=r;const c=l.value.find(N=>N.uuid==$.value),B=c==null?void 0:c.layout.Items;let M="",le="";if(r&&B&&r.length>=1){const N=B.find(K=>K.LayoutItemUUID==r[0].key);switch(le=r[0].order,N==null?void 0:N.MetaField){case f.META_DATA_SOURCE_ACCOMMODATION_FORM:M="submission.status";break;case f.META_DATA_SOURCE_BADGE_FORM:M="submission.status";break;case f.META_DATA_SOURCE_DEALER_FORM:M="submission.status";break;case f.META_DATA_SOURCE_REGISTRATION_FORM:M="submission.status";break;case f.META_DATA_SOURCE_REGISTRATION_REFERENCE:M="reference";break;case f.META_DATA_SOURCE_SUBMISSION_DATE:M="created";break;case f.META_DATA_SOURCE_SUBMISSION_STATUS:M="submission.status";break}switch(N==null?void 0:N.UserField){case g.USER_DATA_SOURCE_DISPLAY_NAME:M="user.display_name";break;case g.USER_DATA_SOURCE_EMAIL:M="user.email";break;case g.USER_DATA_SOURCE_FIRST_NAME:M="user.firstname";break;case g.USER_DATA_SOURCE_HANDLE:M="user.handle";break;case g.USER_DATA_SOURCE_LAST_NAME:M="user.lastname";break}}try{const N={Direction:le,Limit:S,Offset:(o-1)*S,Order:M};(c==null?void 0:c.layout.RequiredFormType)===J.FORM_TYPE_ACCOMMODATION&&(N.Accommodation=!0),(c==null?void 0:c.layout.RequiredFormType)===J.FORM_TYPE_BADGE&&(N.Badge=!0),(c==null?void 0:c.layout.RequiredFormType)===J.FORM_TYPE_DEALER&&(N.Dealer=!0),(c==null?void 0:c.layout.RequiredFormType)===J.FORM_TYPE_REGISTRATION&&(N.Registration=!0),E.searchConventionRegistrations(T.value.ConventionUUID,N).then(K=>{K&&(V.value=K.Total,_.value=K.Registrations,l.value.forEach(De=>{const we=De.layout;De.items=_.value.map(O=>{const L={};return De.headers.forEach(ge=>{const I=we.Items.find(Q=>Q.LayoutItemUUID===ge.key);if(I){if(I.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&I.SectionField)O.Submissions.forEach(Q=>{const q=Q.Data.find(Te=>Te.SectionFieldUUID===I.SectionFieldUUID);if(q){ge.type===Ze.ACCOMMODATION?L[I.LayoutItemUUID]={Data:q.Data,Registration:O}:L[I.LayoutItemUUID]=q.Data;return}});else if(I.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&I.UserField)switch(I.UserField){case g.USER_DATA_SOURCE_AVATAR:L[I.LayoutItemUUID]=A.GetProfileImageURL(O.UserUUID);break;case g.USER_DATA_SOURCE_DISPLAY_NAME:L[I.LayoutItemUUID]=O.User.DisplayName;break;case g.USER_DATA_SOURCE_EMAIL:L[I.LayoutItemUUID]=O.User.Additional.Email;break;case g.USER_DATA_SOURCE_HANDLE:L[I.LayoutItemUUID]=O.User.Handle;break;case g.USER_DATA_SOURCE_DATE_OF_BIRTH:L[I.LayoutItemUUID]=O.User.Additional.DOB;break;case g.USER_DATA_SOURCE_FIRST_NAME:L[I.LayoutItemUUID]=O.User.Additional.FirstName;break;case g.USER_DATA_SOURCE_LAST_NAME:L[I.LayoutItemUUID]=O.User.Additional.LastName;break;case g.USER_DATA_SOURCE_TELEGRAM:L[I.LayoutItemUUID]="";break}else if(I.SourceType==="LAYOUT_ITEM_SOURCE_META"&&I.MetaField){const Q=[];let q;const Te=O.Submissions.find(d=>{var R;return((R=d.Form)==null?void 0:R.Type)===J.FORM_TYPE_REGISTRATION});switch(I.MetaField){case f.META_DATA_SOURCE_REGISTRATION_GROUP:O.Leader?q=O:q=O.Primary,Q.push({Name:q.User.DisplayName,UUID:q.UserUUID,IsLeader:!0,Reference:q.Reference}),Q.push(...q.Members.map(d=>({Name:d.User.DisplayName,UUID:d.UserUUID,IsLeader:!1,Reference:d.Reference}))),L[I.LayoutItemUUID]=Q;break;case f.META_DATA_SOURCE_REGISTRATION_REFERENCE:L[I.LayoutItemUUID]=O.Reference;break;case f.META_DATA_SOURCE_SUBMISSION_DATE:if(Te){const d=new Date(Te.CreatedAt||"");L[I.LayoutItemUUID]=`${d.getFullYear()}-${d.getMonth().toString().padStart(2,"0")}-${d.getDate().toString().padStart(2,"0")} ${d.getHours().toString().padStart(2,"0")}:${d.getMinutes().toString().padStart(2,"0")}:${d.getSeconds()}`}else{const d=new Date(O.CreatedAt||"");L[I.LayoutItemUUID]=`${d.getFullYear()}-${d.getMonth().toString().padStart(2,"0")}-${d.getDate().toString().padStart(2,"0")} ${d.getHours().toString().padStart(2,"0")}:${d.getMinutes().toString().padStart(2,"0")}:${d.getSeconds()}`}break;case f.META_DATA_SOURCE_ACCOMMODATION_FORM:Ee(O.Submissions,t.value),L[I.LayoutItemUUID]=O.Submissions.map(d=>{const R=t.value.find(X=>X.FormUUID===d.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:d,Registration:O}}).filter(d=>{var R;return((R=d.Form)==null?void 0:R.Type)===J.FORM_TYPE_ACCOMMODATION});break;case f.META_DATA_SOURCE_BADGE_FORM:Ee(O.Submissions,t.value),L[I.LayoutItemUUID]=O.Submissions.map(d=>{const R=t.value.find(X=>X.FormUUID===d.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:d,Registration:O}}).filter(d=>{var R;return((R=d.Form)==null?void 0:R.Type)===J.FORM_TYPE_BADGE});break;case f.META_DATA_SOURCE_DEALER_FORM:Ee(O.Submissions,t.value),L[I.LayoutItemUUID]=O.Submissions.map(d=>{const R=t.value.find(X=>X.FormUUID===d.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:d,Registration:O}}).filter(d=>{var R;return((R=d.Form)==null?void 0:R.Type)===J.FORM_TYPE_DEALER});break;case f.META_DATA_SOURCE_SUBMISSION_STATUS:Ee(O.Submissions,t.value),L[I.LayoutItemUUID]=O.Submissions.map(d=>{const R=t.value.find(X=>X.FormUUID===d.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:d,Registration:O}});break}}}}),L})}),u.value=!1)})}catch{}},Ae=()=>{p.value.Panels.forEach(o=>{o.Items.forEach(S=>{(S.SectionField==null||S.SectionField.Field==null)&&t.value.find(r=>{r.Sections.find(c=>{if(c.Fields){const B=c.Fields.find(M=>M.SectionFieldUUID===S.SectionFieldUUID);if(B)return S.SectionField=B,!0}})})})}),p.value.Panels.length>0&&(l.value=[],p.value.Panels.forEach(o=>{const S={uuid:ie(),order:o.Order,name:o.Name,headers:[],items:[],layout:o};o.Items.sort((r,c)=>r.Order>c.Order?1:r.Order==c.Order?0:-1),S.headers=o.Items.map(r=>{var c,B;return{key:r.LayoutItemUUID,title:r.Label||((B=(c=r.SectionField)==null?void 0:c.Field)==null?void 0:B.Label)||"",align:r.Align==="end"?"end":"start",sortable:Ie(r),type:ve(r)}}),l.value.push(S)})),($.value==null||$.value=="")&&l.value.length>0&&($.value=l.value[0].uuid)};D?E.getConvention(D).then(o=>{o&&(T.value=o,Re())}).catch(()=>{s.push("/")}):s.push("/");const ve=o=>{var S,r;if(o.SourceType===se.LAYOUT_ITEM_SOURCE_META)return`${o.SourceType}.${o.MetaField}`;if(o.SourceType===se.LAYOUT_ITEM_SOURCE_FORM)return(r=(S=o.SectionField)==null?void 0:S.Field)==null?void 0:r.Type;if(o.SourceType===se.LAYOUT_ITEM_SOURCE_USER)return`${o.SourceType}.${o.UserField}`},Ie=o=>{const S=[f.META_DATA_SOURCE_ACCOMMODATION_FORM,f.META_DATA_SOURCE_BADGE_FORM,f.META_DATA_SOURCE_DEALER_FORM,f.META_DATA_SOURCE_REGISTRATION_FORM,f.META_DATA_SOURCE_REGISTRATION_REFERENCE,f.META_DATA_SOURCE_SUBMISSION_DATE,f.META_DATA_SOURCE_SUBMISSION_STATUS],r=[g.USER_DATA_SOURCE_DISPLAY_NAME,g.USER_DATA_SOURCE_EMAIL,g.USER_DATA_SOURCE_HANDLE,g.USER_DATA_SOURCE_DATE_OF_BIRTH,g.USER_DATA_SOURCE_FIRST_NAME,g.USER_DATA_SOURCE_LAST_NAME];return S.includes(o.MetaField)||r.includes(o.UserField)};return(o,S)=>(n(),b(It,null,{default:m(()=>[i(gt,{color:"blue-darken-4"},{default:m(()=>[i(St,{modelValue:$.value,"onUpdate:modelValue":S[0]||(S[0]=r=>$.value=r),"show-arrows":""},{default:m(()=>[(n(!0),U(y,null,G(l.value,r=>(n(),b(ct,{key:r.uuid,value:r.uuid},{default:m(()=>[P(h(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(Ft),i(Se,{icon:"mdi:mdi-cog-outline",onClick:S[1]||(S[1]=r=>z.value=!0)})]),_:1}),i(vt,{modelValue:$.value,"onUpdate:modelValue":S[4]||(S[4]=r=>$.value=r),disabled:!0},{default:m(()=>[(n(!0),U(y,null,G(l.value,r=>(n(),b(Rt,{key:r.uuid,value:r.uuid},{default:m(()=>[r.uuid===$.value?(n(),b(ye,{key:0,class:"pa-2"},{default:m(()=>[i(x(Vt),{"items-per-page":v.value,"onUpdate:itemsPerPage":S[3]||(S[3]=c=>v.value=c),headers:r.headers,"items-length":V.value,items:r.items,"item-value":"LayoutItemUUID",loading:u.value,"onUpdate:options":me},Me({_:2},[G(r.headers,c=>({name:`item.${c.key}`,fn:m(({item:B})=>[i(aa,{header:c,item:B,accommodations:ue.value,convention:T.value,extras:re.value,interests:oe.value,tickets:de.value,venues:_e.value,onReload:S[2]||(S[2]=M=>me({page:F.value,itemsPerPage:v.value,sortBy:j.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):Y("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),z.value?(n(),b(Pt,{key:0,title:"Edit Layout",modelValue:z.value,"onUpdate:modelValue":S[5]||(S[5]=r=>z.value=r),layout:p.value,onSave:S[6]||(S[6]=r=>{z.value=!1,Ae()})},null,8,["modelValue","layout"])):Y("",!0)]),_:1}))}});export{Na as default};
