import{I as P,a0 as U,r as o,K as r,L as h,M as a,v as t,N as m,O as w,Q as f,S as s,P as z,R as C,H as O,U as v,$ as Z,V as j,W as H,_ as K}from"./index-8ad06f27.js";import{s as I}from"./index-71069b21.js";import{S}from"./setupLogin-c4294e03.js";import{E as n}from"./emailFormVariant-e5e0aad4.js";import{V as p,a as b}from"./VRow-54bd7dbf.js";import{V as q}from"./VTextField-3c41e73a.js";import{V as R,n as Q}from"./VContainer-b06eee3c.js";import{V as J}from"./VForm-b728c646.js";import{G as X}from"./userData-78fbfbb8.js";import"./index-c1ce7132.js";const V=k=>(j("data-v-0036505c"),k=k(),H(),k),Y={key:1,class:"ma-auto text-left"},ee={key:2,class:"ma-auto text-left"},ae={key:3,class:"ma-auto text-left"},te=V(()=>v("br",null,null,-1)),le=V(()=>v("br",null,null,-1)),se={class:"text-red-darken-1 font-weight-bold"},re=V(()=>v("br",null,null,-1)),oe=V(()=>v("br",null,null,-1)),ne=V(()=>v("br",null,null,-1)),ue=V(()=>v("span",{class:"text-red-darken-4"}," Please contact registration for further assistance. ",-1)),ie=P({__name:"EmailLoginForm",props:{variant:{default:()=>n.COMBINED}},setup(k){const L=U(),y=Z(),E=o(!0),N=o(!1),M=o(!1),F=o(!1),_=o(""),g=o(""),A=o(!1),u=o({required:e=>!!e||"Required.",min:e=>e.length>=8||"Min 8 characters",email:e=>!!e.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),i=o(""),d=o(!1),D=new URL(location.href).searchParams.get("token")||"";D!==""&&(E.value=!1,F.value=!0,y.validateAccount(D).then(({tokens:e,user:l})=>{try{S(e,l,L)}catch(c){console.error(c)}}).catch(e=>{i.value=e.ErrorMessage}));const x=()=>(i.value="",!(u.value.required(_.value)!==!0||u.value.email(_.value)!==!0||u.value.required(g.value)!==!0||u.value.min(g.value)!==!0)),T=e=>{if(e.preventDefault(),!x())return;const c=new URL(location.href).searchParams.get("state");d.value=!0,y.oAuthLogin("internal",_.value,g.value,c||"").then(({tokens:$,user:W})=>{S($,W,L)}).catch(()=>{i.value="Login failed, check credentials or register",d.value=!1})},B=e=>{e.preventDefault(),x()&&(d.value=!0,y.registerAccount(_.value,g.value).then(l=>{E.value=!1,l&&(M.value=!0)}).catch(()=>{i.value="Unable to register, address may be in use",d.value=!1}))},G=()=>{E.value=!1,N.value=!0};return(e,l)=>E.value?(r(),h(J,{key:0,onSubmit:l[3]||(l[3]=z(()=>{},["stop"])),class:"ma-auto vForm",disabled:d.value},{default:a(()=>[t(b,null,{default:a(()=>[t(p,null,{default:a(()=>[t(q,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=c=>_.value=c),rules:[u.value.required,u.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(b,null,{default:a(()=>[t(p,null,{default:a(()=>[t(q,{margin:"normal",required:"",name:"password",label:"Password",type:A.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=c=>g.value=c),"append-icon":A.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":l[2]||(l[2]=c=>A.value=!A.value),counter:"",hint:"At least 8 characters",rules:[u.value.required,u.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),i.value?(r(),h(b,{key:0},{default:a(()=>[t(p,{class:"text-red-darken-1 font-weight-bold"},{default:a(()=>[m(w(i.value),1)]),_:1})]),_:1})):f("",!0),t(b,{justify:"space-between"},{default:a(()=>[e.variant===s(n).COMBINED||e.variant===s(n).REGISTER?(r(),h(p,{key:0,cols:"12",sm:"6"},{default:a(()=>[t(R,{onClick:B,color:"orange-darken-2",disabled:d.value},{default:a(()=>[m(" Register ")]),_:1},8,["disabled"])]),_:1})):f("",!0),e.variant===s(n).COMBINED||e.variant===s(n).LOGIN?(r(),h(p,{key:1,cols:"12",sm:"6"},{default:a(()=>[t(R,{onClick:T,color:"primary",disabled:d.value,type:"submit"},{default:a(()=>[m(" Sign In ")]),_:1},8,["disabled"])]),_:1})):f("",!0),e.variant===s(n).ADD_CREDENTIAL?(r(),h(p,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:a(()=>[t(R,{onClick:B,color:"orange-darken-2",disabled:d.value},{default:a(()=>[m(" Add Email ")]),_:1},8,["disabled"])]),_:1})):f("",!0)]),_:1}),e.variant===s(n).COMBINED||e.variant===s(n).LOGIN?(r(),h(Q,{key:1},{default:a(()=>[t(b,null,{default:a(()=>[t(p,null,{default:a(()=>[t(R,{variant:"text",onClick:G},{default:a(()=>[m(w(s(I).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1},8,["disabled"])):N.value?(r(),C("p",Y,w(s(I).messageResetEmail),1)):M.value?(r(),C("p",ee,w(s(I).messageVerifyNewAccountEmail),1)):F.value?(r(),C("p",ae,[m(w(s(I).messageVerifiedNewAccountMessage)+" ",1),i.value?(r(),C(O,{key:0},[te,le,v("span",se,[m(" An error occurred creating account:"),re,m(" "+w(i.value),1)]),oe,ne,ue],64)):f("",!0)])):f("",!0)}});const de=K(ie,[["__scopeId","data-v-0036505c"]]),ce=v("h2",null,"Email",-1),Ee=P({__name:"LoginWithEmailView",props:{variant:{default:()=>n.COMBINED}},emits:["pageTitle"],setup(k,{emit:L}){L("pageTitle","Email Login");const y=U();return X()&&y.push("/"),(N,M)=>(r(),C(O,null,[ce,t(de,{variant:N.variant},null,8,["variant"])],64))}});export{Ee as default};
