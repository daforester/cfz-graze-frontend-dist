import{p as Kt,n as zt,e as Ue,t as Ce,c as Wt,G as Jt,v as t,H as L,x as et,I as re,a0 as ce,a1 as Le,r as U,K as ve,M as r,N as Y,O as o,a3 as ge,W as H,a2 as qe,a4 as ee,S as q,w as se,X as M,Q as V,V as y,P as w,_ as Qe,ac as Xt,ad as Zt,E as dt,k as ea,f as ta,d as aa,o as oa,ae as mt,R as na,Y as Rt,Z as yt,a7 as la,a6 as ia,U as sa}from"./index-df2ebec6.js";import{e as ua,T as ra,V as da,d as ma,c as ca}from"./FormRenderer.vue_vue_type_style_index_0_lang-4cdb0525.js";import{a as va,F as Se}from"./form-29fd1dbb.js";import{_ as Fe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-3149a9db.js";import{m as Ua,k as Ta,l as _a,n as Aa,o as fa,p as Ea,q as Sa,u as pa,r as ga,s as Da,t as Ra,v as ya,w as Ia,x as Ca,y as Oa,z as ct,A as vt,B as Ut,a as ha,_ as It,f as Tt,c as Ct,d as Ot,e as ht,b as Mt,V as Vt,g as Ma,h as Va,i as ba,j as ka}from"./VWindowItem-49a647af.js";import{V as J,a as b}from"./VRow-045c58a9.js";import{V as me}from"./VTextField-59a695bd.js";import{V as de}from"./copyToClipboard-599740f0.js";import{u as Na,j as pe,V as La}from"./VContainer-2dbb1f7c.js";import{V as bt,u as Ke}from"./VCheckbox-15c66db5.js";import{v as Ne}from"./v4-a960c1f4.js";import{h as xe,b as Fa,a as Pa,c as wa,d as _t,P as ot,u as kt}from"./useDisplayTransactions-1614fb3d.js";import{V as He,a as $e}from"./VList-16e42e8b.js";import{V as ne,a as $a}from"./VBtn-3780ed9a.js";import{b as Ba,c as Nt,d as At}from"./submission-6136b51d.js";import{V as Ga}from"./VAvatar-fec3d5ca.js";import{s as Ya}from"./sortSubmissions-8ed80f07.js";import{V as je,a as xa}from"./scopeId-01795715.js";import{_ as nt,V as Lt}from"./SaveButton.vue_vue_type_script_setup_true_lang-1e677bd5.js";import{V as Ha}from"./VForm-4219ea8b.js";import{V as qa,e as ft,c as ja}from"./VCard-12b7be65.js";import{G as Qa}from"./group-d2a77946.js";import{C as Ka}from"./canDo-2c299106.js";import{G as za}from"./userData-7664683d.js";import{V as Wa,a as Ja}from"./VAlert-b7dfa7db.js";import{V as Xa}from"./forwardRefs-60dd28ac.js";import{u as tt}from"./nil-d01db1aa.js";import{V as Et,a as Za}from"./VToolbar-32980ce1.js";import{V as St,a as eo}from"./VTable-7ff52564.js";import{V as to}from"./VDialog-06e8a6a7.js";import"./index-26b71cef.js";import"./VTextarea-febeb37b.js";import"./VChip-ae70b2f5.js";import"./VToolbarItems-60b8a86d.js";import"./VDivider-3dc55804.js";import"./createSimpleFunctional-1e18b869.js";var Ft=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Ft||{});const ao=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Be=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Be||{});const oo=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const no=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var Z=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(Z||{});const lo=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],io=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},so=Kt({itemsLength:{type:[Number,String],required:!0},...Ua(),...Ta(),..._a()},"VDataTableServer"),uo=zt()({name:"VDataTableServer",props:so(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,S)=>!0},setup(e,S){let{emit:d,slots:l}=S;const{groupBy:n}=Aa(e),{sortBy:s,multiSort:a,mustSort:i}=fa(e),{page:m,itemsPerPage:D}=Ea(e),T=Ue(()=>parseInt(e.itemsLength,10)),{columns:_,headers:v}=Sa(e,{groupBy:n,showSelect:Ce(e,"showSelect"),showExpand:Ce(e,"showExpand")}),{items:A}=pa(e,_),{toggleSort:f}=ga({sortBy:s,multiSort:a,mustSort:i,page:m}),{opened:$,isGroupOpen:R,toggleGroup:C,extractRows:O}=Da({groupBy:n,sortBy:s}),{pageCount:k,setItemsPerPage:X}=Ra({page:m,itemsPerPage:D,itemsLength:T}),{flatItems:te}=ya(A,n,$),{isSelected:ue,select:K,selectAll:p,toggleSelect:g,someSelected:F,allSelected:h}=Ia(e,{allItems:A,currentPage:A}),{isExpanded:G,toggleExpand:ae}=Ca(e),le=Ue(()=>O(A.value));Oa({page:m,itemsPerPage:D,sortBy:s,groupBy:n,search:Ce(e,"search")}),Wt("v-data-table",{toggleSort:f,sortBy:s}),Jt({VDataTableRows:{hideNoData:Ce(e,"hideNoData"),noDataText:Ce(e,"noDataText"),loading:Ce(e,"loading"),loadingText:Ce(e,"loadingText")}});const z=Ue(()=>({page:m.value,itemsPerPage:D.value,sortBy:s.value,pageCount:k.value,toggleSort:f,setItemsPerPage:X,someSelected:F.value,allSelected:h.value,isSelected:ue,select:K,selectAll:p,toggleSelect:g,isExpanded:G,toggleExpand:ae,isGroupOpen:R,toggleGroup:C,items:le.value,groupedItems:te.value,columns:_.value,headers:v.value}));Na(()=>{const[he]=ct.filterProps(e),[Me]=vt.filterProps(e),[Ve]=Ut.filterProps(e),[Te]=St.filterProps(e);return t(St,et({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Te),{top:()=>{var oe;return(oe=l.top)==null?void 0:oe.call(l,z.value)},default:()=>{var oe,De,Re,ye;return l.default?l.default(z.value):t(L,null,[(oe=l.colgroup)==null?void 0:oe.call(l,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(vt,et(Me,{sticky:e.fixedHeader}),l)]),(De=l.thead)==null?void 0:De.call(l,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(z.value):t(Ut,et(Ve,{items:te.value}),l)]),(Re=l.tbody)==null?void 0:Re.call(l,z.value),(ye=l.tfoot)==null?void 0:ye.call(l,z.value)])},bottom:()=>l.bottom?l.bottom(z.value):t(ct,he,{prepend:l["footer.prepend"]})})})}}),ro=re({__name:"EditAdminLayout",props:ce({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:ce(["save"],["update:modelValue"]),setup(e,{emit:S}){const d=Le(e,"modelValue"),l=U(ve(e.layout)),n=U([]),s=ge(),a=({callback:T})=>{const _=()=>{T&&T("Failed to Save Layout")},v=()=>{T&&T("Layout Saved")};s.saveAdminLayout(l.value).then(A=>{A?(v(),S("save",A)):_()}).catch(()=>{_()})},i=()=>({ID:0,LayoutPanelUUID:Ne(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:Se.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),m=T=>()=>({ID:0,LayoutItemUUID:Ne(),LayoutPanelID:T.ID,LayoutPanelUUID:T.LayoutPanelUUID,Label:"",SourceType:Be.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:T.Items.length+1,DefaultSort:!1}),D=T=>{const _=n.value.find(v=>v.value===T.SectionFieldUUID);_&&(T.SectionFieldID=_.object.ID,T.SectionField=_.object)};return s.getConventionForms(e.layout.ConventionUUID).then(T=>{T.forEach(_=>_.Sections.forEach(v=>v.Fields&&n.value.push(...v.Fields.map(A=>{var $;return{title:`${_.Name} - ${v.Name} - ${($=A.Field)==null?void 0:$.Name}`,value:A.SectionFieldUUID,object:A}})))),n.value.sort(ua("title"))}),(T,_)=>(r(),Y(Fe,{modelValue:d.value,"onUpdate:modelValue":_[3]||(_[3]=v=>d.value=v),onSave:a,title:T.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(pe,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(me,{modelValue:l.value.Name,"onUpdate:modelValue":_[0]||(_[0]=v=>l.value.Name=v),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(de,{modelValue:l.value.Type,"onUpdate:modelValue":_[1]||(_[1]=v=>l.value.Type=v),label:"Layout Type",items:H(ao),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(Tt,{modelValue:l.value.Panels,"onUpdate:modelValue":_[2]||(_[2]=v=>l.value.Panels=v),"new-item":i,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},qe({_:2},[ee(l.value.Panels,(v,A)=>({name:`panel_${A}`,fn:o(()=>[t(pe,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(me,{modelValue:v.Name,"onUpdate:modelValue":f=>v.Name=f,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(de,{modelValue:v.RequiredFormType,"onUpdate:modelValue":f=>v.RequiredFormType=f,items:H(va),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(ha,{label:"Required Groups",variant:"outlined",modelValue:v.RequiredGroupMemberships,"onUpdate:modelValue":f=>v.RequiredGroupMemberships=f,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(It,{label:"Registration Tags",variant:"outlined",modelValue:v.RequiredRegistrationTags,"onUpdate:modelValue":f=>v.RequiredRegistrationTags=f,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(Tt,{modelValue:v.Items,"onUpdate:modelValue":f=>v.Items=f,"new-item":m(v),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},qe({_:2},[ee(v.Items,(f,$)=>({name:`item_${$}`,fn:o(()=>[t(pe,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(me,{modelValue:f.Label,"onUpdate:modelValue":R=>f.Label=R,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(de,{modelValue:f.SourceType,"onUpdate:modelValue":R=>f.SourceType=R,label:"Source Type",items:H(oo),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:o(()=>[f.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(r(),Y(de,{key:0,modelValue:f.SectionFieldUUID,"onUpdate:modelValue":R=>f.SectionFieldUUID=R,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:R=>D(f)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):f.SourceType==="LAYOUT_ITEM_SOURCE_META"?(r(),Y(de,{key:1,modelValue:f.MetaField,"onUpdate:modelValue":R=>f.MetaField=R,label:"Miscellaneous Data",items:H(no),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):f.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(r(),Y(de,{key:2,modelValue:f.UserField,"onUpdate:modelValue":R=>f.UserField=R,label:"User Profile Data",items:H(lo),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):q("",!0)]),_:2},1024)]),_:2},1024),t(J,null,{default:o(()=>[t(b,null,{default:o(()=>[t(bt,{modelValue:f.DefaultSort,"onUpdate:modelValue":R=>f.DefaultSort=R,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),mo=M("br",null,null,-1),co=M("h3",null,"Assigned Accommodation",-1),vo=M("br",null,null,-1),Uo=M("br",null,null,-1),To=M("h3",null,"Accommodation Preferences",-1),_o=M("h3",null,"Selected Tickets",-1),Ao=M("br",null,null,-1),fo=re({__name:"EditAccommodationAssignmentDialog",props:ce({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ce(["update:field"],["update:modelValue"]),setup(e,{emit:S}){const d=e,{convention:l,registration:n,title:s=""}=d,a=ge(),i=Le(e,"modelValue"),m=U({capacity:{max:p=>{var h;const g=k.value.find(G=>G.room.RoomUUID===p);return!g||g.room.MaximumCapacity===0?!0:(((h=v.value)==null?void 0:h.Members.length)||0)<=g.room.MaximumCapacity||"Too many people in the group for this room"},min:p=>{var h;const g=k.value.find(G=>G.room.RoomUUID===p);return!g||g.room.MinimumCapacity===0?!0:(((h=v.value)==null?void 0:h.Members.length)||0)>=g.room.MinimumCapacity||"Not enough people in the group for this room"}}}),D=U([]),T=Ke(d,S,void 0,void 0,"field"),_=U(ve(T.value));se(T,()=>{_.value=ve(T.value)});const v=U(),A=U(""),f=U(""),$=U([]),R=U({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),C=async()=>{var h;const p=await a.getConventionAvailableAccommodation(l.ConventionUUID);p&&(D.value=p);const g=await a.getRegistrationGroup(n.RegistrationUUID||"");g&&(v.value=g);const F=await a.getConventionTickets(l.ConventionUUID);F&&($.value=F);try{R.value=JSON.parse(((h=v.value)==null?void 0:h.TicketData)||"")}catch{}};se(A,()=>{f.value=k.value.length>0?k.value[0].value:""});const O=Ue(()=>{const p=X.value;return D.value.map(g=>{let F;return p.forEach(h=>{g.Costs.forEach(G=>{G.DateStart===(h==null?void 0:h.DateStart)&&G.DateEnd===h.DateEnd&&(F===void 0||F>G.Availability)&&(F=G.Availability)})}),{label:`${g.Name}`,title:`${g.Name} (${F} Available)`,value:g.AccommodationUUID}})}),k=Ue(()=>{const p=X.value,g=D.value.find(F=>F.AccommodationUUID===A.value);return(g==null?void 0:g.Pool.map(F=>{var G,ae;let h;return p.forEach(le=>{F.Costs.forEach(z=>{z.DateStart===(le==null?void 0:le.DateStart)&&z.DateEnd===le.DateEnd&&(h===void 0||h>z.Availability)&&(h=z.Availability)})}),{label:`${(G=F.Venue)==null?void 0:G.Name} - ${F.Name}`,title:`${(ae=F.Venue)==null?void 0:ae.Name} - ${F.Name} (${h} Available)`,value:F.RoomUUID,room:F}}))||[]}),X=Ue(()=>[...R.value.Ticket,...R.value.AddonsChecked,...R.value.ComponentsChecked].map(p=>$.value.find(g=>g.TicketUUID===p)).filter(p=>p!==void 0&&p.RequiresAccommodation)),te=p=>{var g;a.assignAccommodation(((g=v.value)==null?void 0:g.Registration.RegistrationUUID)||"",A.value,f.value,!1).then(F=>{F?(C(),p&&p("Room Assigned")):p&&p("Room not assigned")}).catch(()=>{p&&p("Room not assigned")})},ue=p=>{var g,F;(g=v.value)!=null&&g.Registration.AllocationUUID?a.deleteAllocation(((F=v.value)==null?void 0:F.Registration.AllocationUUID)||"").then(h=>{h?(C(),p&&p("Allocation Deleted")):p&&p("Allocation not deleted")}).catch(()=>{p&&p("Allocation not deleted")}):p&&p("Nothing to Delete")},K=p=>{var F,h;const g=(F=D.value.find(G=>G.AccommodationUUID===p.AccommodationUUID))==null?void 0:F.Pool;if(g){const G=g.find(ae=>ae.RoomUUID===p.RoomUUID);if(G)return`${(h=G.Venue)==null?void 0:h.Name} - ${G.Name}`}return""};return C(),(p,g)=>{var F;return r(),Y(Fe,{modelValue:i.value,"onUpdate:modelValue":g[2]||(g[2]=h=>i.value=h),title:H(s),color:"primary","show-close-action":!0,"show-delete-action":!!((F=v.value)!=null&&F.Registration.Allocation),"show-save-action":!!f.value,"save-button-label":"Assign Room",onDelete:ue,onSave:te,fullscreen:!0,persistent:!0},{default:o(()=>[t(pe,{class:"pa-0",fluid:!0},{default:o(()=>[t(J,null,{default:o(()=>{var h;return[t(b,{cols:"12",md:"6"},{default:o(()=>{var G,ae;return[M("h3",null,"Group Members ("+V((G=v.value)==null?void 0:G.Members.length)+")",1),(r(!0),y(L,null,ee((ae=v.value)==null?void 0:ae.Members,le=>(r(),y(L,{key:le.UUID},[w(" #"+V(le.Reference)+" "+V(le.Name),1),mo],64))),128))]}),_:1}),(h=v.value)!=null&&h.Registration.Allocation?(r(),Y(b,{key:0,cols:"12",md:"6"},{default:o(()=>[co,t(He,null,{default:o(()=>{var G;return[(r(!0),y(L,null,ee((G=v.value)==null?void 0:G.Registration.Allocation.Periods,ae=>(r(),Y($e,{key:ae.AllocationPeriodUUID},{default:o(()=>{var le;return[w(V((le=D.value.find(z=>z.AccommodationUUID===ae.AccommodationUUID))==null?void 0:le.Name)+" ",1),vo,w(" "+V(K(ae))+" ",1),Uo,M("small",null,"("+V(H(xe)(ae.DateStart))+" - "+V(H(xe)(ae.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):q("",!0)]}),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",md:"6"},{default:o(()=>[p.selectedAccommodation.length?(r(),y(L,{key:0},[To,t(He,null,{default:o(()=>[(r(!0),y(L,null,ee(p.selectedAccommodation,(h,G)=>(r(),Y($e,{key:h.AccommodationUUID},{default:o(()=>[w(V(G+1)+". "+V(h.Name),1)]),_:2},1024))),128))]),_:1})],64)):q("",!0)]),_:1}),t(b,{cosl:"12",md:"6"},{default:o(()=>[_o,t(He,null,{default:o(()=>[(r(!0),y(L,null,ee(X.value,h=>(r(),Y($e,{key:h==null?void 0:h.TicketUUID},{default:o(()=>[w(V(h.Name)+" ",1),Ao,M("small",null,"("+V(H(xe)(h.DateStart))+" - "+V(H(xe)(h.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",md:"6"},{default:o(()=>[t(de,{modelValue:A.value,"onUpdate:modelValue":g[0]||(g[0]=h=>A.value=h),items:O.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",md:"6"},{default:o(()=>[t(de,{modelValue:f.value,"onUpdate:modelValue":g[1]||(g[1]=h=>f.value=h),items:k.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[m.value.capacity.min,m.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Eo={key:0,class:"accommodationList"},So={key:0,class:"text-orange-darken-2"},po=re({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const S=U(!1),d=Ue(()=>{if(!e.value)return[];const n=JSON.parse(e.value),s=e.accommodations.filter(a=>n.includes(a.AccommodationUUID)).sort((a,i)=>{const m=n.findIndex(T=>T===a.AccommodationUUID),D=n.findIndex(T=>T===i.AccommodationUUID);return m>D?1:-1});return ve(s)}),l=Ue(()=>{let n;const s=e.forms.find(a=>a.Sections.find(i=>{var m;return(m=i.Fields)==null?void 0:m.find(D=>{var T;if(((T=D.Field)==null?void 0:T.Type)==="TICKET")return n=D,!0})}));return n?!!e.registration.Submissions.find(a=>{if(a.FormUUID==(s==null?void 0:s.FormUUID))return a.Data.find(i=>{if(i.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const m=JSON.parse(i.Data);return e.tickets.filter(D=>D.RequiresAccommodation).find(D=>m.Ticket.includes(D.TicketUUID)||m.AddonsChecked.includes(D.TicketUUID)||m.ComponentsChecked.includes(D.TicketUUID))}})}):!1});return(n,s)=>l.value?(r(),y(L,{key:0},[n.value?(r(),y("ol",Eo,[(r(!0),y(L,null,ee(d.value,a=>(r(),y("li",{key:a.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(i=>i.AccommodationUUID===a.AccommodationUUID)?(r(),y("strong",So,V(a.Name),1)):(r(),y(L,{key:1},[w(V(a.Name),1)],64))]))),128))])):q("",!0),t(ne,{onClick:s[0]||(s[0]=a=>S.value=!0),variant:"flat",color:"success"},{default:o(()=>[w("Assign Accommodation")]),_:1}),n.convention&&S.value?(r(),Y(fo,{key:1,modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=a=>S.value=a),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":d.value},null,8,["modelValue","convention","registration","selected-accommodation"])):q("",!0)],64)):q("",!0)}});const go=Qe(po,[["__scopeId","data-v-7a102d46"]]),Do={key:0,class:"addonList"},Ro={key:0},yo={key:0},Io=re({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const S=Ue(()=>{if(!e.value)return;const d=JSON.parse(e.value),l=Object.keys(d),n=ve(e.extras);return n.forEach(s=>{s.Options=s.Options.filter(a=>l.includes(a.OptionUUID)?(a.Choices=a.Choices.filter(i=>i.TagUUID===d[a.OptionUUID].choiceId),d[a.OptionUUID].checked):!1)}),n.filter(s=>s.Options.length>0),n});return(d,l)=>d.value?(r(),y("ul",Do,[(r(!0),y(L,null,ee(S.value,n=>(r(),y(L,{key:n.ExtraUUID},[n.Options.length?(r(),y("li",Ro,[M("strong",null,V(n.Name),1),M("ul",null,[(r(!0),y(L,null,ee(n.Options,s=>(r(),y("li",{key:s.OptionUUID},[w(V(s.Name)+" ",1),s.Choices.length==1?(r(),y("small",yo,"("+V(s.Choices[0].Title)+")",1)):q("",!0)]))),128))])])):q("",!0)],64))),128))])):q("",!0)}});const Co=Qe(Io,[["__scopeId","data-v-55786e01"]]),Oo={key:0},ho=re({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const S=Ue(()=>{if(!e.value)return;const d=JSON.parse(e.value);return Object.entries(d).filter(([,l])=>l).map(([l,n])=>e.interests.find(s=>s.InterestUUID===l)).filter(l=>l!==void 0)});return(d,l)=>d.value?(r(),y("ul",Oo,[(r(!0),y(L,null,ee(S.value,n=>(r(),y("li",{key:n.InterestUUID},V(n.Name),1))),128))])):q("",!0)}}),Mo=M("br",null,null,-1),Vo=M("small",null,"Options:",-1),bo=M("br",null,null,-1),ko=M("small",null,"Addons:",-1),No=re({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const S=Ue(()=>{if(!e.value)return;let d={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{d=JSON.parse(e.value),"ticket"in d&&(d.Ticket=d.ticket),"addonsChecked"in d&&(d.AddonsChecked=d.addonsChecked),"componentsChecked"in d&&(d.ComponentsChecked=d.componentsChecked)}catch{}return d.Ticket.filter(l=>{const n=e.tickets.find(s=>s.TicketUUID===l);return!(!n||n.Type!==ra.TICKET_TYPE_TICKET)}).map(l=>{const n=e.tickets.find(a=>a.TicketUUID===l),s=ve(n);return s.TicketComponents=n.TicketComponents.filter(a=>d.ComponentsChecked.includes(a.TicketUUID)),s.AddonTickets=n.AddonTickets.filter(a=>d.AddonsChecked.includes(a.TicketUUID)),s})});return(d,l)=>d.value?(r(!0),y(L,{key:0},ee(S.value,n=>(r(),y("div",{key:n.TicketUUID},[M("strong",null,V(n.Name),1),n.TicketComponents.length>0?(r(),y(L,{key:0},[Mo,Vo,w("  "),(r(!0),y(L,null,ee(n.TicketComponents,s=>(r(),y(L,{key:s.TicketUUID},[M("small",null,V(s.Name),1),w("  ")],64))),128))],64)):q("",!0),n.AddonTickets.length>0?(r(),y(L,{key:1},[bo,ko,w("  "),(r(!0),y(L,null,ee(n.AddonTickets,s=>(r(),y("small",{key:s.TicketUUID},[w("("),M("em",null,V(s.Name),1),w(")")]))),128))],64)):q("",!0)]))),128)):q("",!0)}}),Lo={key:0,class:"text-blue text-center"},Fo={key:1,class:"text-red text-center"},Po={key:2,class:"text-orange text-center"},wo={key:3,class:"text-orange text-center"},$o={key:4,class:"text-orange text-center"},Bo={key:5,class:"text-orange text-center"},Go={key:6,class:"text-green text-center"},Yo={key:0},xo={key:0},Ho=M("strong",null,"Total:",-1),qo=re({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","openTags","reload","showForm"],setup(e,{emit:S}){const d=(a,i,m)=>{S("showForm",{registration:a,form:i,submission:m})},l=a=>{S("openActions",a)},n=a=>{S("openPayments",a)},s=a=>{S("openTags",a)};return(a,i)=>a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(r(),Y(go,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(r(),Y(Co,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(r(),Y(ho,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(r(),Y(No,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(r(!0),y(L,{key:4},ee(a.item.raw[a.header.key],m=>(r(),y("ul",{key:m.Heading},[M("li",null,[M("strong",null,V(m.Heading)+": ",1),M("span",{class:Xt(H(Ba)(m.Submission.Status))},V(H(Nt)(m.Submission.Status)),3),t(ne,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:D=>d(m.Registration,m.Form,m.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(r(),Y(Ga,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(r(),y(L,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(r(),y("div",Lo,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(r(),y("div",Fo,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(r(),y("div",Po,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(r(),y("div",wo,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(r(),y("div",$o,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(r(),y("div",Bo,"Awaiting Additional Payments")):(r(),y("div",Go,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(r(),y(L,{key:7},[t(ne,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:i[0]||(i[0]=m=>l(a.item.raw[a.header.key]))}),t(ne,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:i[1]||(i[1]=m=>n(a.item.raw[a.header.key]))}),t(ne,{icon:"mdi:mdi-tag-text",variant:"flat",onClick:i[2]||(i[2]=m=>s(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(r(),y(L,{key:8},[a.item.raw[a.header.key].length===1?(r(),y("em",Yo," Not in a group ")):(r(),y(L,{key:1},[M("ul",null,[(r(!0),y(L,null,ee(a.item.raw[a.header.key],m=>(r(),y("li",{key:m.UUID,class:"ml-0"},[w(" #"+V(m.Reference)+" : "+V(m.Name)+" ",1),m.IsLeader?(r(),y("strong",xo,"(Leader)")):q("",!0)]))),128))]),Ho,w(" "+V(a.item.raw[a.header.key].length),1)],64))],64)):(r(),y(L,{key:9},[w(V(a.item.raw[a.header.key]),1)],64))}});var jo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Qo=function(e){return jo.map(function(S){return S.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Ko=function(e,S,d){Object.keys(S).filter(Qo).forEach(function(l){var n=S[l];typeof n=="function"&&(l==="onInit"?n(e,d):d.on(l.substring(2),function(s){return n(s,d)}))})},zo=function(e,S,d,l){var n=e.modelEvents?e.modelEvents:null,s=Array.isArray(n)?n.join(" "):n;se(l,function(a,i){d&&typeof a=="string"&&a!==i&&a!==d.getContent({format:e.outputFormat})&&d.setContent(a)}),d.on(s||"change input undo redo",function(){S.emit("update:modelValue",d.getContent({format:e.outputFormat}))})},Wo=function(e,S,d,l,n,s){l.setContent(s()),d.attrs["onUpdate:modelValue"]&&zo(S,d,l,n),Ko(e,d.attrs,l)},pt=0,Pt=function(e){var S=Date.now(),d=Math.floor(Math.random()*1e9);return pt++,e+"_"+d+pt+String(S)},Jo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},gt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Xo=function(e,S){return gt(e).concat(gt(S))},Zo=function(e){return e==null},Dt=function(){return{listeners:[],scriptId:Pt("tiny-script"),scriptLoaded:!1}},en=function(){var e=Dt(),S=function(n,s,a,i){var m=s.createElement("script");m.referrerPolicy="origin",m.type="application/javascript",m.id=n,m.src=a;var D=function(){m.removeEventListener("load",D),i()};m.addEventListener("load",D),s.head&&s.head.appendChild(m)},d=function(n,s,a){e.scriptLoaded?a():(e.listeners.push(a),n.getElementById(e.scriptId)||S(e.scriptId,n,s,function(){e.listeners.forEach(function(i){return i()}),e.scriptLoaded=!0}))},l=function(){e=Dt()};return{load:d,reinitialize:l}},tn=en(),an=function(){return typeof window<"u"?window:global},Oe=function(){var e=an();return e&&e.tinymce?e.tinymce:null},on={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},Ae=globalThis&&globalThis.__assign||function(){return Ae=Object.assign||function(e){for(var S,d=1,l=arguments.length;d<l;d++){S=arguments[d];for(var n in S)Object.prototype.hasOwnProperty.call(S,n)&&(e[n]=S[n])}return e},Ae.apply(this,arguments)},nn=function(e,S,d,l){return e(l||"div",{id:S,ref:d})},ln=function(e,S,d){return e("textarea",{id:S,visibility:"hidden",ref:d})},at={selector:void 0,target:void 0},sn=re({props:on,setup:function(e,S){var d=e.init?Ae(Ae({},e.init),at):Ae({},at),l=Zt(e),n=l.disabled,s=l.modelValue,a=l.tagName,i=U(null),m=null,D=e.id||Pt("tiny-vue"),T=e.init&&e.init.inline||e.inline,_=!!S.attrs["onUpdate:modelValue"],v=!0,A=e.initialValue?e.initialValue:"",f="",$=function(O){return _?function(){return s!=null&&s.value?s.value:""}:function(){return O?A:f}},R=function(){var O=$(v),k=Ae(Ae({},d),{readonly:e.disabled,target:i.value,plugins:Xo(d.plugins,e.plugins),toolbar:e.toolbar||d.toolbar,inline:T,setup:function(X){m=X,X.on("init",function(te){return Wo(te,e,S,X,s,O)}),typeof d.setup=="function"&&d.setup(X)}});Jo(i.value)&&(i.value.style.visibility=""),Oe().init(k),v=!1};se(n,function(O){var k;m!==null&&(typeof((k=m.mode)===null||k===void 0?void 0:k.set)=="function"?m.mode.set(O?"readonly":"design"):m.setMode(O?"readonly":"design"))}),se(a,function(O){var k;_||(f=m.getContent()),(k=Oe())===null||k===void 0||k.remove(m),dt(function(){return R()})}),ea(function(){if(Oe()!==null)R();else if(i.value&&i.value.ownerDocument){var O=e.cloudChannel?e.cloudChannel:"6",k=e.apiKey?e.apiKey:"no-api-key",X=Zo(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(k,"/tinymce/").concat(O,"/tinymce.min.js"):e.tinymceScriptSrc;tn.load(i.value.ownerDocument,X,R)}}),ta(function(){Oe()!==null&&Oe().remove(m)}),T||(aa(function(){v||R()}),oa(function(){var O;_||(f=m.getContent()),(O=Oe())===null||O===void 0||O.remove(m)}));var C=function(O){var k;f=m.getContent(),(k=Oe())===null||k===void 0||k.remove(m),d=Ae(Ae(Ae({},d),O),at),dt(function(){return R()})};return S.expose({rerender:C,getEditor:function(){return m}}),function(){return T?nn(mt,D,i,e.tagName):ln(mt,D,i)}}});const un=["colspan"],rn=M("strong",null,"E-Mail Content",-1),dn=["innerHTML"],wt=re({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:S}){const d=ge(),l=U([]),n=U({From:"",Subject:"",HTML:""}),s=U(""),a=U(""),i=U(""),m=U(!1),D=U([]),T=U([]),_=U([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),v=U([{key:"CreatedAt",order:"asc"}]);se(n,R=>{i.value=R.From||i.value||"",a.value=R.Subject||a.value||"",s.value=R.HTML||s.value||""});const A=()=>{d.getRegistrationEmails(e.registration.RegistrationUUID).then(R=>{R&&(R.forEach(C=>{C.CreatedAt=Fa(new Date(C.CreatedAt||"")),C.Status=io(C.Status),C.User||(C.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),T.value=R)})};A(),(()=>{d.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(R=>{R&&(l.value=R)})})();const $=({callback:R})=>{d.sendRegistrationEmail(e.registration.RegistrationUUID,i.value,a.value,s.value).then(C=>{C?R&&(R("Email Sent"),A(),setTimeout(()=>{m.value=!1},2e3)):R&&R("Not sent")}).catch(()=>{R&&R("Not sent")})};return(R,C)=>(r(),y(L,null,[R.showEditor?(r(),y(L,{key:0},[t(J,null,{default:o(()=>[t(b,null,{default:o(()=>[t(da,{items:l.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":C[0]||(C[0]=O=>n.value=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12"},{default:o(()=>[t(me,{modelValue:i.value,"onUpdate:modelValue":C[1]||(C[1]=O=>i.value=O),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:o(()=>[t(me,{modelValue:a.value,"onUpdate:modelValue":C[2]||(C[2]=O=>a.value=O),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:o(()=>[t(H(sn),{modelValue:s.value,"onUpdate:modelValue":C[3]||(C[3]=O=>s.value=O),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,null,{default:o(()=>[t(nt,{onClick:C[4]||(C[4]=O=>S("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(b,{class:"text-right"},{default:o(()=>[t(nt,{onClick:$,label:"Send",color:"error"})]),_:1})]),_:1})],64)):q("",!0),T.value.length&&!R.hideHistory?(r(),Y(Vt,{key:1,class:"my-2"},{default:o(()=>[t(Mt,null,{default:o(()=>[t(Ct,null,{default:o(()=>[w(" Email History ")]),_:1}),t(Ot,null,{default:o(()=>[t(H(ht),{items:T.value,headers:_.value,"show-expand":!0,"item-value":"EmailUUID",expanded:D.value,"onUpdate:expanded":C[5]||(C[5]=O=>D.value=O),"sort-by":v.value,"onUpdate:sortBy":C[6]||(C[6]=O=>v.value=O)},{"expanded-row":o(({columns:O,item:k})=>[M("tr",null,[M("td",{colspan:O.length},[rn,M("div",{class:"communicationsViewEmailPreview",innerHTML:k.raw.HTML},null,8,dn)],8,un)])]),"footer.prepend":o(()=>[t(ne,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:A},{default:o(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const mn=re({__name:"StripeRefundPayment",props:ce({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0}}),emits:ce(["refunded"],["update:modelValue"]),setup(e,{emit:S}){const d=Le(e,"modelValue"),l=ge(),n=U(!1),s=U("");let a=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const v=e.paymentTransaction.Data.PaymentIntent;v&&(a=v.amount)}const i=U({Amount:a/100,Description:"",Reason:""}),m=U([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),D=U(!1);async function T(v){v.preventDefault(),D.value=!0,l.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,i.value).then(A=>{A?S("refunded",A):_("An unexpected error occurred.")}).catch(A=>{_("An error occurred processing the refund: "+A.toString())}),D.value=!1}const _=v=>{s.value=v,n.value=!0};return(v,A)=>(r(),Y(Fe,{modelValue:d.value,"onUpdate:modelValue":A[7]||(A[7]=f=>d.value=f),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:o(()=>[t(pe,{class:"pa-0"},{default:o(()=>[t(Ha,{ref:"refundForm",id:"refund-form",onSubmit:A[4]||(A[4]=na(f=>T(f),["prevent"]))},{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[t(me,{modelValue:i.value.Amount,"onUpdate:modelValue":A[0]||(A[0]=f=>i.value.Amount=f),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:o(()=>[t(de,{modelValue:i.value.Reason,"onUpdate:modelValue":A[1]||(A[1]=f=>i.value.Reason=f),modelModifiers:{number:!0},items:m.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12"},{default:o(()=>[t(me,{modelValue:i.value.Description,"onUpdate:modelValue":A[2]||(A[2]=f=>i.value.Description=f),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[t(ne,{color:"error",class:"w-100",onClick:A[3]||(A[3]=f=>d.value=!1)},{default:o(()=>[w("Cancel")]),_:1})]),_:1}),t(je),t(b,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[t(ne,{type:"submit",color:"success",class:"w-100"},qe({default:o(()=>[w(" Issue Refund ")]),_:2},[D.value?{name:"prepend",fn:o(()=>[t($a,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(Lt,{modelValue:n.value,"onUpdate:modelValue":A[6]||(A[6]=f=>n.value=f)},{actions:o(()=>[t(ne,{variant:"text",onClick:A[5]||(A[5]=f=>n.value=!1)},{default:o(()=>[w(" Close ")]),_:1})]),default:o(()=>[w(V(s.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),cn=["colspan"],vn=M("strong",null,"Details",-1),Un=["innerHTML"],Tn=re({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:S}){const d=e;let{hideHistory:l=!1,registration:n,showEditor:s}=d;const a=ge(),i=U([]),m=U([]),D=U([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),T=U(!1),_=U(),v=U(!1),A=U(""),f=U([{key:"CreatedAt",order:"asc"}]),$=()=>({PaymentTransactionUUID:Ne(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:_t.PAYMENT_TRANSACTION_SOURCE_NULL,Type:ot.PAYMENT_TRANSACTION_TYPE_NULL}),R=U($()),{convertTransactions:C,getPaymentTransactionsDisplay:O}=kt();se(d,()=>{l=d.hideHistory,n=d.registration,s=d.showEditor,O(n.RegistrationUUID).then(K=>{m.value=K})});const k=()=>{O(n.RegistrationUUID).then(K=>{m.value=K})};k();const X=()=>{a.saveRegistrationPaymentTransaction(R.value).then(K=>{K&&(C(K.PaymentTransactions),R.value=$(),S("close-editor"),S("change"))})},te=K=>{const p=m.value.find(g=>g.PaymentTransactionUUID===K);p&&(_.value=p.PaymentTransaction,T.value=!0)},ue=K=>{if(K)try{m.value=C(K.PaymentTransactions),_.value=void 0,T.value=!1,A.value="Refund Processed",v.value=!0,S("change")}catch(p){console.error(p)}};return(K,p)=>(r(),y(L,null,[H(s)?(r(),y(L,{key:0},[t(qa,null,{default:o(()=>[w(" Add Transaction ")]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(de,{items:H(Pa),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:R.value.Type,"onUpdate:modelValue":p[0]||(p[0]=g=>R.value.Type=g),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(de,{items:H(wa),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:R.value.Source,"onUpdate:modelValue":p[1]||(p[1]=g=>R.value.Source=g),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(me,{label:"Description","hide-details":"",modelValue:R.value.Description,"onUpdate:modelValue":p[2]||(p[2]=g=>R.value.Description=g),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(me,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:R.value.Amount,"onUpdate:modelValue":p[3]||(p[3]=g=>R.value.Amount=g),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(ne,{class:"w-100",onClick:p[4]||(p[4]=g=>S("close-editor")),color:"warning"},{default:o(()=>[w("Cancel")]),_:1})]),_:1}),t(je),t(b,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(ne,{class:"w-100",onClick:X,color:"primary"},{default:o(()=>[w("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):q("",!0),m.value.length&&!H(l)?(r(),Y(Vt,{key:1,class:"my-2"},{default:o(()=>[t(Mt,null,{default:o(()=>[t(Ct,null,{default:o(()=>[w(" Transaction History ")]),_:1}),t(Ot,null,{default:o(()=>[t(H(ht),{items:m.value,headers:D.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:i.value,"onUpdate:expanded":p[5]||(p[5]=g=>i.value=g),"sort-by":f.value,"onUpdate:sortBy":p[6]||(p[6]=g=>f.value=g),class:"transactionTable"},{"item.Controls":o(({item:g})=>[K.canEdit&&g.raw.PaymentTransaction.Source===H(_t).PAYMENT_TRANSACTION_SOURCE_STRIPE&&g.raw.PaymentTransaction.Type===H(ot).PAYMENT_TRANSACTION_TYPE_PAYMENT?(r(),Y(ne,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:F=>te(g.key)},null,8,["onClick"])):q("",!0)]),"expanded-row":o(({columns:g,item:F})=>[M("tr",null,[M("td",{colspan:g.length},[vn,M("div",{innerHTML:F.raw.HTML},null,8,Un)],8,cn)])]),"footer.prepend":o(()=>[t(ne,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:k},{default:o(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),T.value&&_.value?(r(),Y(mn,{key:0,modelValue:T.value,"onUpdate:modelValue":p[7]||(p[7]=g=>T.value=g),"payment-transaction":_.value,onRefunded:ue},null,8,["modelValue","payment-transaction"])):q("",!0),t(Lt,{modelValue:v.value,"onUpdate:modelValue":p[9]||(p[9]=g=>v.value=g)},{actions:o(()=>[t(ne,{variant:"text",onClick:p[8]||(p[8]=g=>v.value=!1)},{default:o(()=>[w(" Close ")]),_:1})]),default:o(()=>[w(V(A.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const _n=(e=void 0,S)=>e===void 0?!1:Ka(e,Qa.GROUP_TYPE_CONVENTION,S.ConventionUUID,S).EditPaymentTransactions,ze=e=>(Rt("data-v-a5bd0dd4"),e=e(),yt(),e),An={class:"mb-4"},fn={class:"v-row"},En={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Sn={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},pn={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},gn={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},Dn=ze(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),Rn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},yn=ze(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),In={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Cn=ze(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),On={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},hn=ze(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),Mn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Vn=re({__name:"PaymentActions",props:ce({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ce(["update:registration"],["update:modelValue"]),setup(e,{emit:S}){const d=e,l=Le(e,"modelValue"),{registration:n}=d,s=U(!1),a=U(!1),i=U(),m=U([]),D=U(new Date().getTime()),T=U(!1),_=Ke(d,S,void 0,void 0,"registration"),v=U(ve(_.value));se(_,()=>{v.value=ve(_.value)});const A=ge();A.getConvention(n.ConventionUUID).then(C=>{C&&(T.value=_n(za(),C))});const f=()=>{A.generateRegistrationCharges(n.RegistrationUUID,!1).then(C=>{C&&(m.value=C.PaymentTransactions,i.value=C.Registration,D.value=new Date().getTime())}).catch(()=>{})};f();const $=()=>{A.generateRegistrationCharges(n.RegistrationUUID,!0).then(C=>{C&&(m.value=C.PaymentTransactions,i.value=C.Registration,D.value=new Date().getTime())})},{totalCharges:R}=kt();return(C,O)=>(r(),Y(Fe,{modelValue:l.value,"onUpdate:modelValue":O[3]||(O[3]=k=>l.value=k),title:C.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(pe,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[i.value?(r(),y(L,{key:0},[M("h3",An,"#"+V(i.value.Reference)+" "+V(i.value.User.DisplayName),1),M("dl",fn,[(r(!0),y(L,null,ee(m.value,k=>(r(),y(L,{key:k.PaymentTransactionUUID},[k.Type===H(ot).PAYMENT_TRANSACTION_TYPE_CHARGE?(r(),y("dt",En,[M("div",Sn,V(k.Description.split(":")[0])+": ",1),M("div",pn,V(k.Description.split(":")[1]),1)])):q("",!0),M("dd",gn," £"+V(k.Amount),1)],64))),128)),Dn,M("dd",Rn," £"+V(H(R)(m.value)),1),yn,M("dd",In," £"+V(i.value.Total),1),Cn,M("dd",On," £"+V(i.value.Paid),1),hn,M("dd",Mn," £"+V(i.value.Total-i.value.Paid),1)]),t(J,{class:"flex-row-reverse"},{default:o(()=>[t(b,{class:"text-right"},{default:o(()=>[t(ne,{color:"primary",onClick:$},{default:o(()=>[w("Apply Charges")]),_:1})]),_:1}),!a.value&&T.value?(r(),Y(b,{key:0},{default:o(()=>[t(ne,{color:"secondary",onClick:O[0]||(O[0]=k=>a.value=!0)},{default:o(()=>[w("Transaction Entry")]),_:1})]),_:1})):q("",!0)]),_:1})],64)):q("",!0),t(Tn,{"can-edit":T.value,registration:H(n),"show-editor":a.value,onCloseEditor:O[1]||(O[1]=k=>a.value=!1),updated:D.value,onChange:f},null,8,["can-edit","registration","show-editor","updated"]),t(wt,{registration:H(n),"show-editor":s.value,onCloseEditor:O[2]||(O[2]=k=>s.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const bn=Qe(Vn,[["__scopeId","data-v-a5bd0dd4"]]),kn=re({__name:"RegistrationActions",props:ce({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ce(["update:registration"],["update:modelValue"]),setup(e,{emit:S}){const d=e,l=Le(e,"modelValue"),n=U(!1),s=Ke(d,S,void 0,void 0,"registration"),a=U(ve(s.value));se(s,()=>{a.value=ve(s.value)});const i=ge(),m=(D,T)=>{const _=a.value.Submissions.find(v=>v.SubmissionUUID==T);if(!_){D&&D("Submission not found");return}i.setSubmissionStatus(T,_.Status).then(v=>{v?(a.value.Submissions.forEach((A,f)=>{s.value.Submissions[f].Status=A.Status}),D&&D("Status Saved")):D&&D("Status not saved")}).catch(()=>{D&&D("Status not saved")})};return(D,T)=>(r(),Y(Fe,{modelValue:l.value,"onUpdate:modelValue":T[2]||(T[2]=_=>l.value=_),title:D.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(pe,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[M("h3",null,"#"+V(D.registration.Reference)+" "+V(D.registration.User.DisplayName),1),t(He,null,{default:o(()=>[(r(!0),y(L,null,ee(a.value.Submissions,_=>(r(),Y($e,{key:_.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(J,{class:"py-2 align-center"},{default:o(()=>[t(b,{cols:"8"},{default:o(()=>{var v;return[t(de,{modelValue:_.Status,"onUpdate:modelValue":A=>_.Status=A,items:H(At),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((v=D.forms.find(A=>A.FormUUID==_.FormUUID))==null?void 0:v.Name)||""},{selection:o(()=>[t(La,{class:"mr-4"},{default:o(()=>{var A;return[w(V((A=H(At).find(f=>f.value===_.Status))==null?void 0:A.icon),1)]}),_:2},1024),w(" "+V(H(Nt)(_.Status)),1)]),item:o(({item:A,props:{onClick:f}})=>[t($e,{title:A.title,"prepend-icon":A.raw.icon,onClick:f},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(b,{cols:"4"},{default:o(()=>[t(nt,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:v=>m(v.callback,_.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(J,null,{default:o(()=>[t(b,{cols:"12"},{default:o(()=>[t(ne,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:T[0]||(T[0]=_=>n.value=!0)},{default:o(()=>[w("Prepare Email")]),_:1})]),_:1})]),_:1}),t(wt,{registration:D.registration,"show-editor":n.value,onCloseEditor:T[1]||(T[1]=_=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const Nn=e=>(Rt("data-v-601a4fc6"),e=e(),yt(),e),Ln=Nn(()=>M("p",null,"Any tags controlled through registration form fields will be reset when the applicable form is saved. If you don't know what you're doing here, don't touch!",-1)),Fn={class:"mb-4"},Pn=re({__name:"RegistrationTags",props:ce({registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ce(["update:registration"],["update:modelValue"]),setup(e,{emit:S}){const d=e,l=Le(e,"modelValue"),n=ge(),s=Ke(d,S,void 0,void 0,"registration"),a=U(ve(s.value)),i=U(!1),m=U(a.value.Tags);se(s,()=>{a.value=ve(s.value)});const D=T=>{const _=[],v=[];a.value.Tags.forEach(A=>{m.value.find($=>$.TagUUID===A.TagUUID)||_.push(A.TagUUID)}),m.value.forEach(A=>{a.value.Tags.find($=>A.TagUUID===$.TagUUID)||v.push(A.TagUUID)}),n.updateRegistrationTags(_,v,a.value.RegistrationUUID).then(A=>{A?T&&(T("Tags Saved"),s.value.Tags=A.Tags,l.value=!1):T&&T("Error Saving Tags")}).catch(()=>{T&&T("Error Saving Tags")})};return(T,_)=>(r(),Y(Fe,{modelValue:l.value,"onUpdate:modelValue":_[2]||(_[2]=v=>l.value=v),title:T.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,onSave:D,"show-save-action":!0},{default:o(()=>[t(pe,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[a.value?(r(),y(L,{key:0},[t(Wa,{class:"my-4"},{default:o(()=>[t(Ja,null,{default:o(()=>[w("Caution")]),_:1}),Ln]),_:1}),M("h3",Fn,"#"+V(a.value.Reference)+" "+V(a.value.User.DisplayName),1),t(It,{modelValue:a.value.Tags,"onUpdate:modelValue":_[0]||(_[0]=v=>a.value.Tags=v),convention:a.value.ConventionUUID,"show-key":!0,chips:!0,"show-uuid":i.value},null,8,["modelValue","convention","show-uuid"]),t(bt,{label:"Enable Debug Mode",modelValue:i.value,"onUpdate:modelValue":_[1]||(_[1]=v=>i.value=v)},null,8,["modelValue"])],64)):q("",!0)]),_:1})]),_:1},8,["modelValue","title"]))}});const wn=Qe(Pn,[["__scopeId","data-v-601a4fc6"]]),pl=re({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:S}){var st;const d=xa();S("pageTitle","Registration Manager");const l=la(),n=ia(),s=U(!0);let a=((st=l.params.convention)==null?void 0:st.toString())||"";const i=U({ID:0,ConventionUUID:Ne(),OrganisationID:0,OrganisationUUID:tt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),m=ge(),D=sa.getInstance(),T=U({ID:0,AdminLayoutUUID:Ne(),ConventionID:i.value.ID,ConventionUUID:i.value.ConventionUUID,Name:"Registration Table",Type:Ft.ADMIN_LAYOUT_TABLE,Panels:[]}),_=U([]),v=U([]),A=U([]),f=U([]),$=U([]),R=U(1),C=U(10),O=U([]),k=U(0),X=U(!1),te=U(""),ue=U(""),K=U(""),p=U(""),g=U({FieldUUID:"591c9bca-c78c-4e97-8aef-bc596ef472fb",Value:""}),F=U(new Map([["591c9bca-c78c-4e97-8aef-bc596ef472fb",g.value]])),h=U(""),G=U(""),ae=U([]),le=U([]),z=U([]),he=U([]),Me=U([]),Ve=U([]),Te=U(0),oe=U(),De=U(!1),Re=U(!1),ye=U(!1),Ge=U(),lt=U(),We=U(),be=U(!1);se(te,c=>{const u=$.value.find(E=>E.uuid===c);if(u){const E=u.headers.find(I=>I.defaultSort===!0);E&&(O.value=[{key:E.key,order:"asc"}],ae.value=[{key:E.key,order:"asc"}])}}),se(Te,c=>{c===7&&it()}),se(h,()=>{ue.value=Date.now().toString()}),se(G,()=>{ue.value=Date.now().toString()});const $t=()=>{_.value=[],A.value=[],$.value=[];try{m.getConventionAdminLayoutByName(i.value.ConventionUUID,"Registration Table").then(c=>{Te.value+=1,c?T.value=c:(T.value.ConventionID=i.value.ID,T.value.ConventionUUID=i.value.ConventionUUID)})}catch{T.value.ConventionID=i.value.ID,T.value.ConventionUUID=i.value.ConventionUUID}try{m.getConventionForms(i.value.ConventionUUID).then(c=>{Te.value+=1,c&&(_.value=c)})}catch{}try{m.getConventionAccommodation(i.value.ConventionUUID).then(c=>{Te.value+=1,c&&(le.value=c)})}catch{}try{m.getConventionVenues(i.value.ConventionUUID).then(c=>{Te.value+=1,c&&(Ve.value=c)})}catch{}try{m.getConventionExtras(i.value.ConventionUUID).then(c=>{Te.value+=1,c&&(z.value=c)})}catch{}try{m.getConventionInterests(i.value.ConventionUUID).then(c=>{Te.value+=1,c&&(he.value=c)})}catch{}try{m.getConventionTickets(i.value.ConventionUUID).then(c=>{Te.value+=1,c&&(Me.value=c)})}catch{}try{m.getConventionGroups(i.value.ConventionUUID).then(c=>{c&&(v.value=c.sort((u,E)=>u.Name.localeCompare(E.Name)))})}catch{}try{m.getConventionTags(i.value.ConventionUUID).then(c=>{c&&(f.value=c.sort((u,E)=>u.Title.localeCompare(E.Title)).map(u=>(u.Title=`${u.Title} [${u.Key}]`,u)))})}catch{}},Je=({page:c,itemsPerPage:u,sortBy:E})=>{s.value=!0,R.value=c,O.value=E;const I=$.value.find(W=>W.uuid==te.value),_e=I==null?void 0:I.layout.Items;let ie="",ut="";if(E&&_e&&E.length>=1){const W=_e.find(Pe=>Pe.LayoutItemUUID==E[0].key);switch(ut=E[0].order||"asc",W==null?void 0:W.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:ie="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:ie="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:ie="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ie="submission.status";break}switch(W==null?void 0:W.UserField){case Z.USER_DATA_SOURCE_DISPLAY_NAME:ie="user.display_name";break;case Z.USER_DATA_SOURCE_EMAIL:ie="user.email";break;case Z.USER_DATA_SOURCE_FIRST_NAME:ie="user.firstname";break;case Z.USER_DATA_SOURCE_HANDLE:ie="user.handle";break;case Z.USER_DATA_SOURCE_LAST_NAME:ie="user.lastname";break}}try{const W={Direction:ut,Limit:u,Offset:(c-1)*u,Order:ie};I&&I.layout.RequiredRegistrationTags.length>0&&(W.PanelUUID=I==null?void 0:I.layout.LayoutPanelUUID),(I==null?void 0:I.layout.RequiredFormType)===Se.FORM_TYPE_ACCOMMODATION&&(W.Accommodation=!0),(I==null?void 0:I.layout.RequiredFormType)===Se.FORM_TYPE_BADGE&&(W.Badge=!0),(I==null?void 0:I.layout.RequiredFormType)===Se.FORM_TYPE_DEALER&&(W.Dealer=!0),(I==null?void 0:I.layout.RequiredFormType)===Se.FORM_TYPE_REGISTRATION&&(W.Registration=!0),W.GroupUUID=h.value||tt,W.TagUUID=G.value||tt,W.Email=p.value,W.Reference=K.value,W.FieldValues=Array.from(F.value.values()),m.searchConventionRegistrations(i.value.ConventionUUID,W).then(Pe=>{Pe&&(k.value=Pe.Total,A.value=Pe.Registrations,$.value.forEach(Ze=>{const Qt=Ze.layout;Ze.items=A.value.map(B=>{const Ye=[];let fe;B.Leader?fe=B:fe=B.Primary,Ye.push({Name:fe.User.DisplayName,UUID:fe.UserUUID,UserUUID:fe.User.UserUUID,IsLeader:!0,Reference:fe.Reference,Paid:fe.Paid,Total:fe.Total}),Ye.push(...fe.Members.map(Ee=>({Name:Ee.User.DisplayName,UUID:Ee.UserUUID,UserUUID:Ee.User.UserUUID,IsLeader:!1,Reference:Ee.Reference,Paid:Ee.Paid,Total:Ee.Total})));const j={};return Ze.headers.forEach(Ee=>{var rt;const P=Qt.Items.find(we=>we.LayoutItemUUID===Ee.key);if(P){if(P.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&P.SectionField)B.Submissions.forEach(we=>{const ke=we.Data.find(N=>N.SectionFieldUUID===P.SectionFieldUUID);if(ke){Ee.type===ca.ACCOMMODATION?j[P.LayoutItemUUID]={Data:ke.Data,Registration:B}:j[P.LayoutItemUUID]=ke.Data;return}});else if(P.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&P.UserField)switch(P.UserField){case Z.USER_DATA_SOURCE_AVATAR:j[P.LayoutItemUUID]=d.GetProfileImageURL(B.UserUUID);break;case Z.USER_DATA_SOURCE_DISPLAY_NAME:j[P.LayoutItemUUID]=B.User.DisplayName;break;case Z.USER_DATA_SOURCE_EMAIL:j[P.LayoutItemUUID]=B.User.Additional.Email;break;case Z.USER_DATA_SOURCE_HANDLE:j[P.LayoutItemUUID]=B.User.Handle;break;case Z.USER_DATA_SOURCE_DATE_OF_BIRTH:j[P.LayoutItemUUID]=B.User.Additional.DOB;break;case Z.USER_DATA_SOURCE_FIRST_NAME:j[P.LayoutItemUUID]=B.User.Additional.FirstName;break;case Z.USER_DATA_SOURCE_LAST_NAME:j[P.LayoutItemUUID]=B.User.Additional.LastName;break;case Z.USER_DATA_SOURCE_TELEGRAM:j[P.LayoutItemUUID]="";break}else if(P.SourceType==="LAYOUT_ITEM_SOURCE_META"&&P.MetaField){const we=(rt=_.value.find(N=>N.Type===Se.FORM_TYPE_REGISTRATION))==null?void 0:rt.FormUUID,ke=B.Submissions.find(N=>N.FormUUID===we);switch(P.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:j[P.LayoutItemUUID]=B;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:j[P.LayoutItemUUID]=Ye;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:j[P.LayoutItemUUID]=B.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(ke){const N=new Date(ke.CreatedAt||"");j[P.LayoutItemUUID]=`${N.getFullYear()}-${(N.getMonth()+1).toString().padStart(2,"0")}-${N.getDate().toString().padStart(2,"0")} ${N.getHours().toString().padStart(2,"0")}:${N.getMinutes().toString().padStart(2,"0")}:${N.getSeconds().toString().padStart(2,"0")}`}else{const N=new Date(B.CreatedAt||"");j[P.LayoutItemUUID]=`${N.getFullYear()}-${(N.getMonth()+1).toString().padStart(2,"0")}-${N.getDate().toString().padStart(2,"0")} ${N.getHours().toString().padStart(2,"0")}:${N.getMinutes().toString().padStart(2,"0")}:${N.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:j[P.LayoutItemUUID]=B.Submissions.map(N=>{const x=_.value.find(Ie=>Ie.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:B}}).filter(N=>{var x;return((x=N.Form)==null?void 0:x.Type)===Se.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:j[P.LayoutItemUUID]=B.Submissions.map(N=>{const x=_.value.find(Ie=>Ie.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:B}}).filter(N=>{var x;return((x=N.Form)==null?void 0:x.Type)===Se.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:j[P.LayoutItemUUID]=B.Submissions.map(N=>{const x=_.value.find(Ie=>Ie.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:B}}).filter(N=>{var x;return((x=N.Form)==null?void 0:x.Type)===Se.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if(B.Paid===0&&B.Total)j[P.LayoutItemUUID]="REQUIRED";else if(B.Total>B.Paid)j[P.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const N=Ye.find(x=>x.Paid===0&&(x.Total||0)>0);if(N){B.Total===0&&N.Total===0?j[P.LayoutItemUUID]="NOT_REQUIRED":B.Total===0&&N.Total||B.Total>0&&N.Total===0?j[P.LayoutItemUUID]="MISSING_REQUIRED":B.Paid>=B.Total?j[P.LayoutItemUUID]="AWAITING_PARTNER":j[P.LayoutItemUUID]="ALL_REQUIRED";break}else B.Total===0?j[P.LayoutItemUUID]="NOT_REQUIRED":j[P.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:Ya(B.Submissions,_.value),j[P.LayoutItemUUID]=B.Submissions.map(N=>{const x=_.value.find(Ie=>Ie.FormUUID===N.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:N,Registration:B}});break}}}}),j})}),s.value=!1)})}catch{}},Bt=c=>{X.value=!1,c&&(T.value=c,it())},it=()=>{T.value.Panels.forEach(c=>{c.Items.forEach(u=>{(u.SectionField==null||u.SectionField.Field==null)&&_.value.find(E=>{E.Sections.find(I=>{if(I.Fields){const _e=I.Fields.find(ie=>ie.SectionFieldUUID===u.SectionFieldUUID);if(_e)return u.SectionField=_e,!0}})})})}),T.value.Panels.length>0&&($.value=[],T.value.Panels.forEach(c=>{const u={uuid:Ne(),order:c.Order,name:c.Name,headers:[],items:[],layout:c};c.Items.sort((E,I)=>E.Order>I.Order?1:E.Order==I.Order?0:-1),u.headers=c.Items.map(E=>{var I,_e;return{key:E.LayoutItemUUID,title:E.Label||((_e=(I=E.SectionField)==null?void 0:I.Field)==null?void 0:_e.Label)||"",align:E.Align==="end"?"end":"start",sortable:Yt(E),type:Gt(E),defaultSort:E.DefaultSort}}),$.value.push(u)}),$.value=$.value.sort((c,u)=>c.order>u.order?1:c.order==u.order?0:-1)),(te.value==null||te.value=="")&&$.value.length>0&&(te.value=$.value[0].uuid)};a?m.getConvention(a).then(c=>{c&&(i.value=c,T.value.ConventionID=i.value.ID,T.value.ConventionUUID=i.value.ConventionUUID,$t())}).catch(()=>{n.push("/")}):n.push("/");const Gt=c=>{var u,E;if(c.SourceType===Be.LAYOUT_ITEM_SOURCE_META)return`${c.SourceType}.${c.MetaField}`;if(c.SourceType===Be.LAYOUT_ITEM_SOURCE_FORM)return(E=(u=c.SectionField)==null?void 0:u.Field)==null?void 0:E.Type;if(c.SourceType===Be.LAYOUT_ITEM_SOURCE_USER)return`${c.SourceType}.${c.UserField}`},Yt=c=>{const u=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],E=[Z.USER_DATA_SOURCE_DISPLAY_NAME,Z.USER_DATA_SOURCE_EMAIL,Z.USER_DATA_SOURCE_HANDLE,Z.USER_DATA_SOURCE_DATE_OF_BIRTH,Z.USER_DATA_SOURCE_FIRST_NAME,Z.USER_DATA_SOURCE_LAST_NAME];return u.includes(c.MetaField)||E.includes(c.UserField)},xt=c=>{oe.value=c,De.value=!0},Ht=c=>{oe.value=c,Re.value=!0},qt=c=>{oe.value=c,ye.value=!0};se(De,c=>{c||(oe.value=void 0)}),se(Re,c=>{c||(oe.value=void 0)});const Xe=async(c="")=>{lt.value=await m.getRegistrationGroup(c)},jt=({registration:c,form:u,submission:E})=>{oe.value=c,Xe(c.RegistrationUUID).then(()=>{Ge.value=u,We.value=E,be.value=!0})};return D.on("registration.group.leave",c=>{m.leaveRegistrationGroup(c).then(u=>{u&&Xe(c).then(()=>{D.emit("registration.group.left",u)})})}),D.on("registration.group.remove.member",c=>{m.leaveRegistrationGroup(c).then(u=>{u&&Xe(c).then(()=>{D.emit("registration.group.left",u)})})}),(c,u)=>(r(),Y(eo,null,{default:o(()=>[t(Et,{color:"blue-darken-4"},{default:o(()=>[t(Ma,{modelValue:te.value,"onUpdate:modelValue":u[0]||(u[0]=E=>te.value=E),"show-arrows":""},{default:o(()=>[(r(!0),y(L,null,ee($.value,E=>(r(),Y(Va,{key:E.uuid,value:E.uuid},{default:o(()=>[w(V(E.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(je),t(ne,{icon:"mdi:mdi-cog-outline",onClick:u[1]||(u[1]=E=>X.value=!0)})]),_:1}),t(ka,{modelValue:te.value,"onUpdate:modelValue":u[16]||(u[16]=E=>te.value=E),disabled:!0},{default:o(()=>[(r(!0),y(L,null,ee($.value,E=>(r(),Y(ba,{key:E.uuid,value:E.uuid},{default:o(()=>[E.uuid===te.value?(r(),Y(ft,{key:0,class:"pa-2"},{default:o(()=>[t(H(uo),{"items-per-page":C.value,"onUpdate:itemsPerPage":u[14]||(u[14]=I=>C.value=I),"sort-by":ae.value,"onUpdate:sortBy":u[15]||(u[15]=I=>ae.value=I),headers:E.headers,"items-length":k.value,items:E.items,"item-value":"LayoutItemUUID",loading:s.value,search:ue.value,"onUpdate:options":Je},qe({top:o(()=>[t(pe,null,{default:o(()=>[t(J,null,{default:o(()=>[t(b,{cols:"12",sm:"12",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(me,{modelValue:K.value,"onUpdate:modelValue":u[2]||(u[2]=I=>K.value=I),label:"Search by Badge",clearable:!0,"hide-details":"","onClick:clear":u[3]||(u[3]=I=>ue.value=Date.now().toString()),onInput:u[4]||(u[4]=I=>ue.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"12",md:"4",lg:"5",xl:"3"},{default:o(()=>[t(me,{modelValue:g.value.Value,"onUpdate:modelValue":u[5]||(u[5]=I=>g.value.Value=I),label:"Search By Furry Name",clearable:!0,"hide-details":"","onClick:clear":u[6]||(u[6]=I=>ue.value=Date.now().toString()),onInput:u[7]||(u[7]=I=>ue.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"12",md:"5",lg:"5",xl:"3"},{default:o(()=>[t(me,{modelValue:p.value,"onUpdate:modelValue":u[8]||(u[8]=I=>p.value=I),label:"Search By Email",clearable:!0,"hide-details":"","onClick:clear":u[9]||(u[9]=I=>ue.value=Date.now().toString()),onInput:u[10]||(u[10]=I=>ue.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"6",lg:"6",xl:"2"},{default:o(()=>[t(de,{modelValue:h.value,"onUpdate:modelValue":u[11]||(u[11]=I=>h.value=I),label:"Search By Group",clearable:!0,"hide-details":"",items:v.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",sm:"6",md:"6",lg:"6",xl:"2"},{default:o(()=>[t(de,{modelValue:G.value,"onUpdate:modelValue":u[12]||(u[12]=I=>G.value=I),label:"Search By Tag",clearable:!0,"hide-details":"",items:f.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[ee(E.headers,I=>({name:`item.${I.key}`,fn:o(({item:_e})=>[t(qo,{header:I,item:_e,accommodations:le.value,convention:i.value,extras:z.value,forms:_.value,interests:he.value,tickets:Me.value,venues:Ve.value,onOpenActions:xt,onOpenPayments:Ht,onOpenTags:qt,onReload:u[13]||(u[13]=ie=>Je({page:R.value,itemsPerPage:C.value,sortBy:O.value})),onShowForm:jt},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),X.value?(r(),Y(ro,{key:0,title:"Edit Layout",modelValue:X.value,"onUpdate:modelValue":u[17]||(u[17]=E=>X.value=E),layout:T.value,onSave:Bt},null,8,["modelValue","layout"])):q("",!0),oe.value?(r(),y(L,{key:1},[De.value?(r(),Y(kn,{key:0,modelValue:De.value,"onUpdate:modelValue":u[18]||(u[18]=E=>De.value=E),registration:oe.value,"onUpdate:registration":u[19]||(u[19]=E=>oe.value=E),accommodations:le.value,convention:i.value,extras:z.value,forms:_.value,interests:he.value,tickets:Me.value,title:"Registration Status & Communications",venues:Ve.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):Re.value?(r(),Y(bn,{key:1,modelValue:Re.value,"onUpdate:modelValue":u[20]||(u[20]=E=>Re.value=E),registration:oe.value,"onUpdate:registration":u[21]||(u[21]=E=>oe.value=E),accommodations:le.value,convention:i.value,extras:z.value,forms:_.value,interests:he.value,tickets:Me.value,title:"Registration Payments",venues:Ve.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):ye.value?(r(),Y(wn,{key:2,modelValue:ye.value,"onUpdate:modelValue":u[22]||(u[22]=E=>ye.value=E),registration:oe.value,"onUpdate:registration":u[23]||(u[23]=E=>oe.value=E),convention:i.value,title:"Registration Tags"},null,8,["modelValue","registration","convention"])):q("",!0)],64)):q("",!0),be.value&&We.value&&Ge.value?(r(),Y(to,{key:2,modelValue:be.value,"onUpdate:modelValue":u[27]||(u[27]=E=>be.value=E),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(ft,{class:"bg-red-darken-4"},{default:o(()=>[t(Et,{color:"error"},{default:o(()=>[t(Za,null,{default:o(()=>[w("Submission Editor - Admin Mode")]),_:1}),t(je),t(Xa,null,{default:o(()=>[t(ne,{icon:"mdi:mdi-window-close",onClick:u[24]||(u[24]=E=>be.value=!1)})]),_:1})]),_:1}),t(ja,null,{default:o(()=>[t(ma,{modelValue:Ge.value,"onUpdate:modelValue":u[25]||(u[25]=E=>Ge.value=E),admin:!0,convention:i.value,data:We.value,editable:!0,"registration-group":lt.value,onClose:u[26]||(u[26]=E=>{be.value=!1,Je({page:R.value,itemsPerPage:C.value,sortBy:O.value})})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):q("",!0)]),_:1}))}});export{pl as default};
