import{p as kt,n as Nt,e as ue,t as ge,c as Lt,G as Ft,v as t,H as k,x as je,I as ie,a0 as Ee,a1 as Ge,r as U,K as ve,M as s,N as Y,O as o,a3 as fe,W as x,a2 as ze,a4 as Z,S as q,w as oe,X as b,Q as F,V as I,P as G,_ as Ye,ac as Pt,ad as wt,E as at,k as $t,f as Bt,d as Gt,o as Yt,ae as ot,Y as vt,Z as _t,a7 as Ht,a6 as xt}from"./index-2b2fa830.js";import{e as qt,T as jt,d as Qt,V as Kt,c as zt}from"./FormRenderer.vue_vue_type_style_index_0_lang-25308657.js";import{a as Wt,F as Ae}from"./form-29fd1dbb.js";import{_ as He}from"./ModelDialog.vue_vue_type_script_setup_true_lang-f48a1d9b.js";import{m as Jt,k as Xt,l as Zt,n as ea,o as ta,p as aa,q as oa,u as na,r as la,s as ia,t as sa,v as ra,w as ua,x as da,y as ma,z as nt,A as lt,B as it,a as ca,_ as va,f as st,c as Ut,d as At,e as Tt,b as Et,V as ft,g as _a,h as Ua,i as Aa,j as Ta}from"./VWindowItem-70ddaf26.js";import{V as ee,a as P}from"./VRow-6d5e811c.js";import{V as Te}from"./VTextField-eecff37b.js";import{V as ne}from"./copyToClipboard-a4142c84.js";import{u as Ea,j as Ce,V as fa}from"./VContainer-7e4fef3f.js";import{V as Sa,u as Je}from"./VCheckbox-27158143.js";import{v as Me}from"./v4-a960c1f4.js";import{h as $e,b as Da,a as pa,c as Ia,d as Ra,P as St,u as Dt}from"./useDisplayTransactions-5159dd0c.js";import{V as Be,a as Le}from"./VList-8489884e.js";import{V as le}from"./VBtn-369e263e.js";import{b as ya,c as pt,d as rt}from"./submission-40700c29.js";import{V as ga}from"./forwardRefs-77ea3a69.js";import{V as Oa}from"./VAvatar-91f6b5a4.js";import{V as It,a as Ca}from"./VToolbar-a3bdc840.js";import{V as Xe,a as ha}from"./scopeId-7a2ad4c9.js";import{c as Ma,e as Rt,V as ba}from"./VCard-a6bf2882.js";import{V as Va}from"./VDialog-665c2eea.js";import{s as ka}from"./sortSubmissions-8ed80f07.js";import{_ as We}from"./SaveButton.vue_vue_type_script_setup_true_lang-cce1f555.js";import{u as Qe}from"./nil-d01db1aa.js";import{V as ut,a as Na}from"./VTable-dc0681bf.js";import"./index-26b71cef.js";import"./VTextarea-2cea8b13.js";import"./VChip-32c5abba.js";import"./userData-3492926f.js";import"./VForm-42e6b0f0.js";import"./VToolbarItems-0116a0f4.js";import"./VDivider-50eda30a.js";import"./createSimpleFunctional-10d46739.js";var yt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(yt||{});const La=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Fe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Fe||{});const Fa=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const Pa=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var X=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(X||{});const wa=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],$a=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Send Error"}return"Unknown"},Ba=kt({itemsLength:{type:[Number,String],required:!0},...Jt(),...Xt(),...Zt()},"VDataTableServer"),Ga=Nt()({name:"VDataTableServer",props:Ba(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,p)=>!0},setup(e,p){let{emit:r,slots:l}=p;const{groupBy:n}=ea(e),{sortBy:u,multiSort:c,mustSort:d}=ta(e),{page:A,itemsPerPage:E}=aa(e),v=ue(()=>parseInt(e.itemsLength,10)),{columns:a,headers:i}=oa(e,{groupBy:n,showSelect:ge(e,"showSelect"),showExpand:ge(e,"showExpand")}),{items:_}=na(e,a),{toggleSort:T}=la({sortBy:u,multiSort:c,mustSort:d,page:A}),{opened:K,isGroupOpen:S,toggleGroup:y,extractRows:f}=ia({groupBy:n,sortBy:u}),{pageCount:O,setItemsPerPage:j}=sa({page:A,itemsPerPage:E,itemsLength:v}),{flatItems:se}=ra(_,n,K),{isSelected:Se,select:De,selectAll:h,toggleSelect:M,someSelected:N,allSelected:g}=ua(e,{allItems:_,currentPage:_}),{isExpanded:$,toggleExpand:W}=da(e),te=ue(()=>f(_.value));ma({page:A,itemsPerPage:E,sortBy:u,groupBy:n,search:ge(e,"search")}),Lt("v-data-table",{toggleSort:T,sortBy:u}),Ft({VDataTableRows:{hideNoData:ge(e,"hideNoData"),noDataText:ge(e,"noDataText"),loading:ge(e,"loading"),loadingText:ge(e,"loadingText")}});const z=ue(()=>({page:A.value,itemsPerPage:E.value,sortBy:u.value,pageCount:O.value,toggleSort:T,setItemsPerPage:j,someSelected:N.value,allSelected:g.value,isSelected:Se,select:De,selectAll:h,toggleSelect:M,isExpanded:$,toggleExpand:W,isGroupOpen:S,toggleGroup:y,items:te.value,groupedItems:se.value,columns:a.value,headers:i.value}));Ea(()=>{const[de]=nt.filterProps(e),[re]=lt.filterProps(e),[pe]=it.filterProps(e),[Ie]=ut.filterProps(e);return t(ut,je({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Ie),{top:()=>{var Re;return(Re=l.top)==null?void 0:Re.call(l,z.value)},default:()=>{var Re,be,Pe,Ve;return l.default?l.default(z.value):t(k,null,[(Re=l.colgroup)==null?void 0:Re.call(l,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(lt,je(re,{sticky:e.fixedHeader}),l)]),(be=l.thead)==null?void 0:be.call(l,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(z.value):t(it,je(pe,{items:se.value}),l)]),(Pe=l.tbody)==null?void 0:Pe.call(l,z.value),(Ve=l.tfoot)==null?void 0:Ve.call(l,z.value)])},bottom:()=>l.bottom?l.bottom(z.value):t(nt,de,{prepend:l["footer.prepend"]})})})}}),Ya=ie({__name:"EditAdminLayout",props:Ee({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["save"],["update:modelValue"]),setup(e,{emit:p}){const r=Ge(e,"modelValue"),l=U(ve(e.layout)),n=U([]),u=fe(),c=({callback:v})=>{const a=()=>{v&&v("Failed to Save Layout")},i=()=>{v&&v("Layout Saved")};u.saveAdminLayout(l.value).then(_=>{_?(i(),p("save",_)):a()}).catch(()=>{a()})},d=()=>({ID:0,LayoutPanelUUID:Me(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:Ae.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),A=v=>()=>({ID:0,LayoutItemUUID:Me(),LayoutPanelID:v.ID,LayoutPanelUUID:v.LayoutPanelUUID,Label:"",SourceType:Fe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:v.Items.length+1,DefaultSort:!1}),E=v=>{const a=n.value.find(i=>i.value===v.SectionFieldUUID);a&&(v.SectionFieldID=a.object.ID,v.SectionField=a.object)};return u.getConventionForms(e.layout.ConventionUUID).then(v=>{v.forEach(a=>a.Sections.forEach(i=>i.Fields&&n.value.push(...i.Fields.map(_=>{var K;return{title:`${a.Name} - ${i.Name} - ${(K=_.Field)==null?void 0:K.Name}`,value:_.SectionFieldUUID,object:_}})))),n.value.sort(qt("title"))}),(v,a)=>(s(),Y(He,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=i=>r.value=i),onSave:c,title:v.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:l.value.Name,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.Name=i),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:l.value.Type,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.Type=i),label:"Layout Type",items:x(La),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(st,{modelValue:l.value.Panels,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.Panels=i),"new-item":d,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ze({_:2},[Z(l.value.Panels,(i,_)=>({name:`panel_${_}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:i.Name,"onUpdate:modelValue":T=>i.Name=T,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:i.RequiredFormType,"onUpdate:modelValue":T=>i.RequiredFormType=T,items:x(Wt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ca,{label:"Required Groups",variant:"outlined",modelValue:i.RequiredGroupMemberships,"onUpdate:modelValue":T=>i.RequiredGroupMemberships=T,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(va,{label:"Registration Tags",variant:"outlined",modelValue:i.RequiredRegistrationTags,"onUpdate:modelValue":T=>i.RequiredRegistrationTags=T,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(st,{modelValue:i.Items,"onUpdate:modelValue":T=>i.Items=T,"new-item":A(i),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ze({_:2},[Z(i.Items,(T,K)=>({name:`item_${K}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:T.Label,"onUpdate:modelValue":S=>T.Label=S,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:T.SourceType,"onUpdate:modelValue":S=>T.SourceType=S,label:"Source Type",items:x(Fa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[T.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(s(),Y(ne,{key:0,modelValue:T.SectionFieldUUID,"onUpdate:modelValue":S=>T.SectionFieldUUID=S,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:S=>E(T)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):T.SourceType==="LAYOUT_ITEM_SOURCE_META"?(s(),Y(ne,{key:1,modelValue:T.MetaField,"onUpdate:modelValue":S=>T.MetaField=S,label:"Miscellaneous Data",items:x(Pa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):T.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(s(),Y(ne,{key:2,modelValue:T.UserField,"onUpdate:modelValue":S=>T.UserField=S,label:"User Profile Data",items:x(wa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):q("",!0)]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(Sa,{modelValue:T.DefaultSort,"onUpdate:modelValue":S=>T.DefaultSort=S,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ha=b("br",null,null,-1),xa=b("h3",null,"Assigned Accommodation",-1),qa=b("br",null,null,-1),ja=b("br",null,null,-1),Qa=b("h3",null,"Accommodation Preferences",-1),Ka=b("h3",null,"Selected Tickets",-1),za=b("br",null,null,-1),Wa=ie({__name:"EditAccommodationAssignmentDialog",props:Ee({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:field"],["update:modelValue"]),setup(e,{emit:p}){const r=e,{convention:l,registration:n,title:u=""}=r,c=fe(),d=Ge(e,"modelValue"),A=U({capacity:{max:h=>{var g;const M=O.value.find($=>$.room.RoomUUID===h);return!M||M.room.MaximumCapacity===0?!0:(((g=i.value)==null?void 0:g.Members.length)||0)<=M.room.MaximumCapacity||"Too many people in the group for this room"},min:h=>{var g;const M=O.value.find($=>$.room.RoomUUID===h);return!M||M.room.MinimumCapacity===0?!0:(((g=i.value)==null?void 0:g.Members.length)||0)>=M.room.MinimumCapacity||"Not enough people in the group for this room"}}}),E=U([]),v=Je(r,p,void 0,void 0,"field"),a=U(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const i=U(),_=U(""),T=U(""),K=U([]),S=U({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),y=async()=>{var g;const h=await c.getConventionAvailableAccommodation(l.ConventionUUID);h&&(E.value=h);const M=await c.getRegistrationGroup(n.RegistrationUUID||"");M&&(i.value=M);const N=await c.getConventionTickets(l.ConventionUUID);N&&(K.value=N);try{S.value=JSON.parse(((g=i.value)==null?void 0:g.TicketData)||"")}catch{}};oe(_,()=>{T.value=O.value.length>0?O.value[0].value:""});const f=ue(()=>{const h=j.value;return E.value.map(M=>{let N;return h.forEach(g=>{M.Costs.forEach($=>{$.DateStart===(g==null?void 0:g.DateStart)&&$.DateEnd===g.DateEnd&&(N===void 0||N>$.Availability)&&(N=$.Availability)})}),{label:`${M.Name}`,title:`${M.Name} (${N} Available)`,value:M.AccommodationUUID}})}),O=ue(()=>{const h=j.value,M=E.value.find(N=>N.AccommodationUUID===_.value);return(M==null?void 0:M.Pool.map(N=>{var $,W;let g;return h.forEach(te=>{N.Costs.forEach(z=>{z.DateStart===(te==null?void 0:te.DateStart)&&z.DateEnd===te.DateEnd&&(g===void 0||g>z.Availability)&&(g=z.Availability)})}),{label:`${($=N.Venue)==null?void 0:$.Name} - ${N.Name}`,title:`${(W=N.Venue)==null?void 0:W.Name} - ${N.Name} (${g} Available)`,value:N.RoomUUID,room:N}}))||[]}),j=ue(()=>[...S.value.Ticket,...S.value.AddonsChecked,...S.value.ComponentsChecked].map(h=>K.value.find(M=>M.TicketUUID===h)).filter(h=>h!==void 0&&h.RequiresAccommodation)),se=h=>{var M;c.assignAccommodation(((M=i.value)==null?void 0:M.Registration.RegistrationUUID)||"",_.value,T.value,!1).then(N=>{N?(y(),h&&h("Room Assigned")):h&&h("Room not assigned")}).catch(()=>{h&&h("Room not assigned")})},Se=h=>{var M,N;(M=i.value)!=null&&M.Registration.AllocationUUID?c.deleteAllocation(((N=i.value)==null?void 0:N.Registration.AllocationUUID)||"").then(g=>{g?(y(),h&&h("Allocation Deleted")):h&&h("Allocation not deleted")}).catch(()=>{h&&h("Allocation not deleted")}):h&&h("Nothing to Delete")},De=h=>{var N,g;const M=(N=E.value.find($=>$.AccommodationUUID===h.AccommodationUUID))==null?void 0:N.Pool;if(M){const $=M.find(W=>W.RoomUUID===h.RoomUUID);if($)return`${(g=$.Venue)==null?void 0:g.Name} - ${$.Name}`}return""};return y(),(h,M)=>{var N;return s(),Y(He,{modelValue:d.value,"onUpdate:modelValue":M[2]||(M[2]=g=>d.value=g),title:x(u),color:"primary","show-close-action":!0,"show-delete-action":!!((N=i.value)!=null&&N.Registration.Allocation),"show-save-action":!!T.value,"save-button-label":"Assign Room",onDelete:Se,onSave:se,fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"pa-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>{var g;return[t(P,{cols:"12",md:"6"},{default:o(()=>{var $,W;return[b("h3",null,"Group Members ("+F(($=i.value)==null?void 0:$.Members.length)+")",1),(s(!0),I(k,null,Z((W=i.value)==null?void 0:W.Members,te=>(s(),I(k,{key:te.UUID},[G(" #"+F(te.Reference)+" "+F(te.Name),1),Ha],64))),128))]}),_:1}),(g=i.value)!=null&&g.Registration.Allocation?(s(),Y(P,{key:0,cols:"12",md:"6"},{default:o(()=>[xa,t(Be,null,{default:o(()=>{var $;return[(s(!0),I(k,null,Z(($=i.value)==null?void 0:$.Registration.Allocation.Periods,W=>(s(),Y(Le,{key:W.AllocationPeriodUUID},{default:o(()=>{var te;return[G(F((te=E.value.find(z=>z.AccommodationUUID===W.AccommodationUUID))==null?void 0:te.Name)+" ",1),qa,G(" "+F(De(W))+" ",1),ja,b("small",null,"("+F(x($e)(W.DateStart))+" - "+F(x($e)(W.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):q("",!0)]}),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",md:"6"},{default:o(()=>[h.selectedAccommodation.length?(s(),I(k,{key:0},[Qa,t(Be,null,{default:o(()=>[(s(!0),I(k,null,Z(h.selectedAccommodation,(g,$)=>(s(),Y(Le,{key:g.AccommodationUUID},{default:o(()=>[G(F($+1)+". "+F(g.Name),1)]),_:2},1024))),128))]),_:1})],64)):q("",!0)]),_:1}),t(P,{cosl:"12",md:"6"},{default:o(()=>[Ka,t(Be,null,{default:o(()=>[(s(!0),I(k,null,Z(j.value,g=>(s(),Y(Le,{key:g==null?void 0:g.TicketUUID},{default:o(()=>[G(F(g.Name)+" ",1),za,b("small",null,"("+F(x($e)(g.DateStart))+" - "+F(x($e)(g.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",md:"6"},{default:o(()=>[t(ne,{modelValue:_.value,"onUpdate:modelValue":M[0]||(M[0]=g=>_.value=g),items:f.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(P,{cols:"12",md:"6"},{default:o(()=>[t(ne,{modelValue:T.value,"onUpdate:modelValue":M[1]||(M[1]=g=>T.value=g),items:O.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[A.value.capacity.min,A.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Ja={key:0,class:"accommodationList"},Xa={key:0,class:"text-orange-darken-2"},Za=ie({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const p=U(!1),r=ue(()=>{if(!e.value)return[];const n=JSON.parse(e.value),u=e.accommodations.filter(c=>n.includes(c.AccommodationUUID)).sort((c,d)=>{const A=n.findIndex(v=>v===c.AccommodationUUID),E=n.findIndex(v=>v===d.AccommodationUUID);return A>E?1:-1});return ve(u)}),l=ue(()=>{let n;const u=e.forms.find(c=>c.Sections.find(d=>{var A;return(A=d.Fields)==null?void 0:A.find(E=>{var v;if(((v=E.Field)==null?void 0:v.Type)==="TICKET")return n=E,!0})}));return n?!!e.registration.Submissions.find(c=>{if(c.FormUUID==(u==null?void 0:u.FormUUID))return c.Data.find(d=>{if(d.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const A=JSON.parse(d.Data);return e.tickets.filter(E=>E.RequiresAccommodation).find(E=>A.Ticket.includes(E.TicketUUID)||A.AddonsChecked.includes(E.TicketUUID)||A.ComponentsChecked.includes(E.TicketUUID))}})}):!1});return(n,u)=>l.value?(s(),I(k,{key:0},[n.value?(s(),I("ol",Ja,[(s(!0),I(k,null,Z(r.value,c=>(s(),I("li",{key:c.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(d=>d.AccommodationUUID===c.AccommodationUUID)?(s(),I("strong",Xa,F(c.Name),1)):(s(),I(k,{key:1},[G(F(c.Name),1)],64))]))),128))])):q("",!0),t(le,{onClick:u[0]||(u[0]=c=>p.value=!0),variant:"flat",color:"success"},{default:o(()=>[G("Assign Accommodation")]),_:1}),n.convention&&p.value?(s(),Y(Wa,{key:1,modelValue:p.value,"onUpdate:modelValue":u[1]||(u[1]=c=>p.value=c),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":r.value},null,8,["modelValue","convention","registration","selected-accommodation"])):q("",!0)],64)):q("",!0)}});const eo=Ye(Za,[["__scopeId","data-v-7a102d46"]]),to={key:0,class:"addonList"},ao={key:0},oo={key:0},no=ie({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const p=ue(()=>{if(!e.value)return;const r=JSON.parse(e.value),l=Object.keys(r),n=ve(e.extras);return n.forEach(u=>{u.Options=u.Options.filter(c=>l.includes(c.OptionUUID)?(c.Choices=c.Choices.filter(d=>d.TagUUID===r[c.OptionUUID].choiceId),r[c.OptionUUID].checked):!1)}),n.filter(u=>u.Options.length>0),n});return(r,l)=>r.value?(s(),I("ul",to,[(s(!0),I(k,null,Z(p.value,n=>(s(),I(k,{key:n.ExtraUUID},[n.Options.length?(s(),I("li",ao,[b("strong",null,F(n.Name),1),b("ul",null,[(s(!0),I(k,null,Z(n.Options,u=>(s(),I("li",{key:u.OptionUUID},[G(F(u.Name)+" ",1),u.Choices.length==1?(s(),I("small",oo,"("+F(u.Choices[0].Title)+")",1)):q("",!0)]))),128))])])):q("",!0)],64))),128))])):q("",!0)}});const lo=Ye(no,[["__scopeId","data-v-55786e01"]]),io={key:0},so=ie({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const p=ue(()=>{if(!e.value)return;const r=JSON.parse(e.value);return Object.entries(r).filter(([,l])=>l).map(([l,n])=>e.interests.find(u=>u.InterestUUID===l)).filter(l=>l!==void 0)});return(r,l)=>r.value?(s(),I("ul",io,[(s(!0),I(k,null,Z(p.value,n=>(s(),I("li",{key:n.InterestUUID},F(n.Name),1))),128))])):q("",!0)}}),ro=b("br",null,null,-1),uo=b("small",null,"Options:",-1),mo=b("br",null,null,-1),co=b("small",null,"Addons:",-1),vo=ie({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const p=ue(()=>{if(!e.value)return;let r={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{r=JSON.parse(e.value),"ticket"in r&&(r.Ticket=r.ticket),"addonsChecked"in r&&(r.AddonsChecked=r.addonsChecked),"componentsChecked"in r&&(r.ComponentsChecked=r.componentsChecked)}catch{}return r.Ticket.filter(l=>{const n=e.tickets.find(u=>u.TicketUUID===l);return!(!n||n.Type!==jt.TICKET_TYPE_TICKET)}).map(l=>{const n=e.tickets.find(c=>c.TicketUUID===l),u=ve(n);return u.TicketComponents=n.TicketComponents.filter(c=>r.ComponentsChecked.includes(c.TicketUUID)),u.AddonTickets=n.AddonTickets.filter(c=>r.AddonsChecked.includes(c.TicketUUID)),u})});return(r,l)=>r.value?(s(!0),I(k,{key:0},Z(p.value,n=>(s(),I("div",{key:n.TicketUUID},[b("strong",null,F(n.Name),1),n.TicketComponents.length>0?(s(),I(k,{key:0},[ro,uo,G("  "),(s(!0),I(k,null,Z(n.TicketComponents,u=>(s(),I(k,{key:u.TicketUUID},[b("small",null,F(u.Name),1),G("  ")],64))),128))],64)):q("",!0),n.AddonTickets.length>0?(s(),I(k,{key:1},[mo,co,G("  "),(s(!0),I(k,null,Z(n.AddonTickets,u=>(s(),I("small",{key:u.TicketUUID},[G("("),b("em",null,F(u.Name),1),G(")")]))),128))],64)):q("",!0)]))),128)):q("",!0)}}),_o={key:0,class:"text-blue text-center"},Uo={key:1,class:"text-red text-center"},Ao={key:2,class:"text-orange text-center"},To={key:3,class:"text-orange text-center"},Eo={key:4,class:"text-orange text-center"},fo={key:5,class:"text-orange text-center"},So={key:6,class:"text-green text-center"},Do={key:0},po={key:0},Io=b("strong",null,"Total:",-1),Ro=ie({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload"],setup(e,{emit:p}){const r=fe(),l=U(),n=U(),u=U(),c=U(),d=U(!1),A=(a,i,_)=>{n.value=a,r.getRegistrationGroup(_.RegistrationUUID||"").then(T=>{u.value=T,l.value=i,c.value=_,d.value=!0})},E=a=>{p("openActions",a)},v=a=>{p("openPayments",a)};return(a,i)=>(s(),I(k,null,[a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(s(),Y(eo,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(s(),Y(lo,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(s(),Y(so,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(s(),Y(vo,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(s(!0),I(k,{key:4},Z(a.item.raw[a.header.key],_=>(s(),I("ul",{key:_.Heading},[b("li",null,[b("strong",null,F(_.Heading)+":",1),b("span",{class:Pt(x(ya)(_.Submission.Status))},F(x(pt)(_.Submission.Status)),3),t(le,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:T=>A(_.Registration,_.Form,_.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(s(),Y(Oa,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(s(),I(k,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(s(),I("div",_o,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(s(),I("div",Uo,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(s(),I("div",Ao,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(s(),I("div",To,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(s(),I("div",Eo,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(s(),I("div",fo,"Awaiting Additional Payments")):(s(),I("div",So,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(s(),I(k,{key:7},[t(le,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:i[0]||(i[0]=_=>E(a.item.raw[a.header.key]))}),t(le,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:i[1]||(i[1]=_=>v(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(s(),I(k,{key:8},[a.item.raw[a.header.key].length===1?(s(),I("em",Do," Not in a group ")):(s(),I(k,{key:1},[b("ul",null,[(s(!0),I(k,null,Z(a.item.raw[a.header.key],_=>(s(),I("li",{key:_.UUID,class:"ml-0"},[G(" #"+F(_.Reference)+" : "+F(_.Name)+" ",1),_.IsLeader?(s(),I("strong",po,"(Leader)")):q("",!0)]))),128))]),Io,G(" "+F(a.item.raw[a.header.key].length),1)],64))],64)):(s(),I(k,{key:9},[G(F(a.item.raw[a.header.key]),1)],64)),d.value&&c.value&&l.value?(s(),Y(Va,{key:10,modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=_=>d.value=_),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(Rt,{class:"bg-red-darken-4"},{default:o(()=>[t(It,{color:"error"},{default:o(()=>[t(Ca,null,{default:o(()=>[G("Submission Editor - Admin Mode")]),_:1}),t(Xe),t(ga,null,{default:o(()=>[t(le,{icon:"mdi:mdi-window-close",onClick:i[2]||(i[2]=_=>d.value=!1)})]),_:1})]),_:1}),t(Ma,null,{default:o(()=>[t(Qt,{modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=_=>l.value=_),admin:!0,convention:a.convention,data:c.value,editable:!0,"registration-group":u.value,onClose:i[4]||(i[4]=_=>{d.value=!1,p("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):q("",!0)],64))}});var yo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],go=function(e){return yo.map(function(p){return p.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Oo=function(e,p,r){Object.keys(p).filter(go).forEach(function(l){var n=p[l];typeof n=="function"&&(l==="onInit"?n(e,r):r.on(l.substring(2),function(u){return n(u,r)}))})},Co=function(e,p,r,l){var n=e.modelEvents?e.modelEvents:null,u=Array.isArray(n)?n.join(" "):n;oe(l,function(c,d){r&&typeof c=="string"&&c!==d&&c!==r.getContent({format:e.outputFormat})&&r.setContent(c)}),r.on(u||"change input undo redo",function(){p.emit("update:modelValue",r.getContent({format:e.outputFormat}))})},ho=function(e,p,r,l,n,u){l.setContent(u()),r.attrs["onUpdate:modelValue"]&&Co(p,r,l,n),Oo(e,r.attrs,l)},dt=0,gt=function(e){var p=Date.now(),r=Math.floor(Math.random()*1e9);return dt++,e+"_"+r+dt+String(p)},Mo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},mt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},bo=function(e,p){return mt(e).concat(mt(p))},Vo=function(e){return e==null},ct=function(){return{listeners:[],scriptId:gt("tiny-script"),scriptLoaded:!1}},ko=function(){var e=ct(),p=function(n,u,c,d){var A=u.createElement("script");A.referrerPolicy="origin",A.type="application/javascript",A.id=n,A.src=c;var E=function(){A.removeEventListener("load",E),d()};A.addEventListener("load",E),u.head&&u.head.appendChild(A)},r=function(n,u,c){e.scriptLoaded?c():(e.listeners.push(c),n.getElementById(e.scriptId)||p(e.scriptId,n,u,function(){e.listeners.forEach(function(d){return d()}),e.scriptLoaded=!0}))},l=function(){e=ct()};return{load:r,reinitialize:l}},No=ko(),Lo=function(){return typeof window<"u"?window:global},Oe=function(){var e=Lo();return e&&e.tinymce?e.tinymce:null},Fo={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},ce=globalThis&&globalThis.__assign||function(){return ce=Object.assign||function(e){for(var p,r=1,l=arguments.length;r<l;r++){p=arguments[r];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&(e[n]=p[n])}return e},ce.apply(this,arguments)},Po=function(e,p,r,l){return e(l||"div",{id:p,ref:r})},wo=function(e,p,r){return e("textarea",{id:p,visibility:"hidden",ref:r})},Ke={selector:void 0,target:void 0},$o=ie({props:Fo,setup:function(e,p){var r=e.init?ce(ce({},e.init),Ke):ce({},Ke),l=wt(e),n=l.disabled,u=l.modelValue,c=l.tagName,d=U(null),A=null,E=e.id||gt("tiny-vue"),v=e.init&&e.init.inline||e.inline,a=!!p.attrs["onUpdate:modelValue"],i=!0,_=e.initialValue?e.initialValue:"",T="",K=function(f){return a?function(){return u!=null&&u.value?u.value:""}:function(){return f?_:T}},S=function(){var f=K(i),O=ce(ce({},r),{readonly:e.disabled,target:d.value,plugins:bo(r.plugins,e.plugins),toolbar:e.toolbar||r.toolbar,inline:v,setup:function(j){A=j,j.on("init",function(se){return ho(se,e,p,j,u,f)}),typeof r.setup=="function"&&r.setup(j)}});Mo(d.value)&&(d.value.style.visibility=""),Oe().init(O),i=!1};oe(n,function(f){var O;A!==null&&(typeof((O=A.mode)===null||O===void 0?void 0:O.set)=="function"?A.mode.set(f?"readonly":"design"):A.setMode(f?"readonly":"design"))}),oe(c,function(f){var O;a||(T=A.getContent()),(O=Oe())===null||O===void 0||O.remove(A),at(function(){return S()})}),$t(function(){if(Oe()!==null)S();else if(d.value&&d.value.ownerDocument){var f=e.cloudChannel?e.cloudChannel:"6",O=e.apiKey?e.apiKey:"no-api-key",j=Vo(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(O,"/tinymce/").concat(f,"/tinymce.min.js"):e.tinymceScriptSrc;No.load(d.value.ownerDocument,j,S)}}),Bt(function(){Oe()!==null&&Oe().remove(A)}),v||(Gt(function(){i||S()}),Yt(function(){var f;a||(T=A.getContent()),(f=Oe())===null||f===void 0||f.remove(A)}));var y=function(f){var O;T=A.getContent(),(O=Oe())===null||O===void 0||O.remove(A),r=ce(ce(ce({},r),f),Ke),at(function(){return S()})};return p.expose({rerender:y,getEditor:function(){return A}}),function(){return v?Po(ot,E,d,e.tagName):wo(ot,E,d)}}});const Bo=["colspan"],Go=b("strong",null,"E-Mail Content",-1),Yo=["innerHTML"],Ot=ie({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:p}){const r=fe(),l=U([]),n=U({From:"",Subject:"",HTML:""}),u=U(""),c=U(""),d=U(""),A=U(!1),E=U([]),v=U([]),a=U([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),i=U([{key:"CreatedAt",order:"asc"}]);oe(n,S=>{d.value=S.From||d.value||"",c.value=S.Subject||c.value||"",u.value=S.HTML||u.value||""});const _=()=>{r.getRegistrationEmails(e.registration.RegistrationUUID).then(S=>{S&&(S.forEach(y=>{y.CreatedAt=Da(new Date(y.CreatedAt||"")),y.Status=$a(y.Status),y.User||(y.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),v.value=S)})};_(),(()=>{r.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(S=>{S&&(l.value=S)})})();const K=({callback:S})=>{r.sendRegistrationEmail(e.registration.RegistrationUUID,d.value,c.value,u.value).then(y=>{y?S&&(S("Email Sent"),_(),setTimeout(()=>{A.value=!1},2e3)):S&&S("Not sent")}).catch(()=>{S&&S("Not sent")})};return(S,y)=>(s(),I(k,null,[S.showEditor?(s(),I(k,{key:0},[t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(Kt,{items:l.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=f=>n.value=f),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12"},{default:o(()=>[t(Te,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=f=>d.value=f),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12"},{default:o(()=>[t(Te,{modelValue:c.value,"onUpdate:modelValue":y[2]||(y[2]=f=>c.value=f),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12"},{default:o(()=>[t(x($o),{modelValue:u.value,"onUpdate:modelValue":y[3]||(y[3]=f=>u.value=f),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(We,{onClick:y[4]||(y[4]=f=>p("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(P,{class:"text-right"},{default:o(()=>[t(We,{onClick:K,label:"Send",color:"error"})]),_:1})]),_:1})],64)):q("",!0),v.value.length&&!S.hideHistory?(s(),Y(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[G(" Email History ")]),_:1}),t(At,null,{default:o(()=>[t(x(Tt),{items:v.value,headers:a.value,"show-expand":!0,"item-value":"EmailUUID",expanded:E.value,"onUpdate:expanded":y[5]||(y[5]=f=>E.value=f),"sort-by":i.value,"onUpdate:sortBy":y[6]||(y[6]=f=>i.value=f)},{"expanded-row":o(({columns:f,item:O})=>[b("tr",null,[b("td",{colspan:f.length},[Go,b("div",{class:"communicationsViewEmailPreview",innerHTML:O.raw.HTML},null,8,Yo)],8,Bo)])]),"footer.prepend":o(()=>[t(le,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:_},{default:o(()=>[G("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const Ho=e=>(vt("data-v-ee66eb82"),e=e(),_t(),e),xo=["colspan"],qo=Ho(()=>b("strong",null,"Details",-1)),jo=["innerHTML"],Qo=ie({__name:"PaymentTransactions",props:{hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:p}){const r=e;let{hideHistory:l=!1,registration:n,showEditor:u}=r;const c=fe(),d=U([]),A=U([]),E=U([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"}]),v=U([{key:"CreatedAt",order:"asc"}]),a=()=>({PaymentTransactionUUID:Me(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:Ra.PAYMENT_TRANSACTION_SOURCE_NULL,Type:St.PAYMENT_TRANSACTION_TYPE_NULL}),i=U(a()),{convertTransactions:_,getPaymentTransactionsDisplay:T}=Dt();oe(r,()=>{l=r.hideHistory,n=r.registration,u=r.showEditor,T(n.RegistrationUUID).then(y=>{A.value=y})});const K=()=>{T(n.RegistrationUUID).then(y=>{A.value=y})};K();const S=()=>{c.saveRegistrationPaymentTransaction(i.value).then(y=>{y&&(_(y.PaymentTransactions),i.value=a(),p("close-editor"),p("change"))})};return(y,f)=>(s(),I(k,null,[x(u)?(s(),I(k,{key:0},[t(ba,null,{default:o(()=>[G(" Add Transaction ")]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{items:x(pa),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:i.value.Type,"onUpdate:modelValue":f[0]||(f[0]=O=>i.value.Type=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{items:x(Ia),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:i.value.Source,"onUpdate:modelValue":f[1]||(f[1]=O=>i.value.Source=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(Te,{label:"Description","hide-details":"",modelValue:i.value.Description,"onUpdate:modelValue":f[2]||(f[2]=O=>i.value.Description=O),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(Te,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:i.value.Amount,"onUpdate:modelValue":f[3]||(f[3]=O=>i.value.Amount=O),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(le,{class:"w-100",onClick:f[4]||(f[4]=O=>p("close-editor")),color:"warning"},{default:o(()=>[G("Cancel")]),_:1})]),_:1}),t(Xe),t(P,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(le,{class:"w-100",onClick:S,color:"primary"},{default:o(()=>[G("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):q("",!0),A.value.length&&!x(l)?(s(),Y(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[G(" Transaction History ")]),_:1}),t(At,null,{default:o(()=>[t(x(Tt),{items:A.value,headers:E.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:d.value,"onUpdate:expanded":f[5]||(f[5]=O=>d.value=O),"sort-by":v.value,"onUpdate:sortBy":f[6]||(f[6]=O=>v.value=O)},{"expanded-row":o(({columns:O,item:j})=>[b("tr",null,[b("td",{colspan:O.length},[qo,b("div",{innerHTML:j.raw.HTML},null,8,jo)],8,xo)])]),"footer.prepend":o(()=>[t(le,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:K},{default:o(()=>[G("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const Ko=Ye(Qo,[["__scopeId","data-v-ee66eb82"]]),xe=e=>(vt("data-v-76d30f00"),e=e(),_t(),e),zo={class:"v-row"},Wo={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Jo={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Xo={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},Zo={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},en=xe(()=>b("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),tn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},an=xe(()=>b("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),on={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},nn=xe(()=>b("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),ln={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},sn=xe(()=>b("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),rn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},un=ie({__name:"PaymentActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const r=e,l=Ge(e,"modelValue"),{registration:n}=r,u=U(!1),c=U(!1),d=U(),A=U([]),E=U(new Date().getTime()),v=Je(r,p,void 0,void 0,"registration"),a=U(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const i=fe(),_=()=>{i.generateRegistrationCharges(n.RegistrationUUID,!1).then(S=>{S&&(A.value=S.PaymentTransactions,d.value=S.Registration,E.value=new Date().getTime())}).catch(()=>{})};_();const T=()=>{i.generateRegistrationCharges(n.RegistrationUUID,!0).then(S=>{S&&(A.value=S.PaymentTransactions,d.value=S.Registration,E.value=new Date().getTime())})},{totalCharges:K}=Dt();return(S,y)=>(s(),Y(He,{modelValue:l.value,"onUpdate:modelValue":y[3]||(y[3]=f=>l.value=f),title:S.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[d.value?(s(),I(k,{key:0},[b("dl",zo,[(s(!0),I(k,null,Z(A.value,f=>(s(),I(k,{key:f.PaymentTransactionUUID},[f.Type===x(St).PAYMENT_TRANSACTION_TYPE_CHARGE?(s(),I("dt",Wo,[b("div",Jo,F(f.Description.split(":")[0])+": ",1),b("div",Xo,F(f.Description.split(":")[1]),1)])):q("",!0),b("dd",Zo," £"+F(f.Amount),1)],64))),128)),en,b("dd",tn," £"+F(x(K)(A.value)),1),an,b("dd",on," £"+F(d.value.Total),1),nn,b("dd",ln," £"+F(d.value.Paid),1),sn,b("dd",rn," £"+F(d.value.Total-d.value.Paid),1)]),t(ee,{class:"flex-row-reverse"},{default:o(()=>[t(P,{class:"text-right"},{default:o(()=>[t(le,{color:"primary",onClick:T},{default:o(()=>[G("Apply Charges")]),_:1})]),_:1}),c.value?q("",!0):(s(),Y(P,{key:0},{default:o(()=>[t(le,{color:"secondary",onClick:y[0]||(y[0]=f=>c.value=!0)},{default:o(()=>[G("Transaction Entry")]),_:1})]),_:1}))]),_:1})],64)):q("",!0),t(Ko,{registration:x(n),"show-editor":c.value,onCloseEditor:y[1]||(y[1]=f=>c.value=!1),updated:E.value,onChange:_},null,8,["registration","show-editor","updated"]),t(Ot,{registration:x(n),"show-editor":u.value,onCloseEditor:y[2]||(y[2]=f=>u.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const dn=Ye(un,[["__scopeId","data-v-76d30f00"]]),mn=ie({__name:"RegistrationActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const r=e,l=Ge(e,"modelValue"),n=U(!1),u=Je(r,p,void 0,void 0,"registration"),c=U(ve(u.value));oe(u,()=>{c.value=ve(u.value)});const d=fe(),A=(E,v)=>{const a=c.value.Submissions.find(i=>i.SubmissionUUID==v);if(!a){E&&E("Submission not found");return}d.setSubmissionStatus(v,a.Status).then(i=>{i?(c.value.Submissions.forEach((_,T)=>{u.value.Submissions[T].Status=_.Status}),E&&E("Status Saved")):E&&E("Status not saved")}).catch(()=>{E&&E("Status not saved")})};return(E,v)=>(s(),Y(He,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=a=>l.value=a),title:E.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(Be,null,{default:o(()=>[(s(!0),I(k,null,Z(c.value.Submissions,a=>(s(),Y(Le,{key:a.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(ee,{class:"py-2 align-center"},{default:o(()=>[t(P,{cols:"8"},{default:o(()=>{var i;return[t(ne,{modelValue:a.Status,"onUpdate:modelValue":_=>a.Status=_,items:x(rt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((i=E.forms.find(_=>_.FormUUID==a.FormUUID))==null?void 0:i.Name)||""},{selection:o(()=>[t(fa,{class:"mr-4"},{default:o(()=>{var _;return[G(F((_=x(rt).find(T=>T.value===a.Status))==null?void 0:_.icon),1)]}),_:2},1024),G(" "+F(x(pt)(a.Status)),1)]),item:o(({item:_,props:{onClick:T}})=>[t(Le,{title:_.title,"prepend-icon":_.raw.icon,onClick:T},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(P,{cols:"4"},{default:o(()=>[t(We,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:i=>A(i.callback,a.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12"},{default:o(()=>[t(le,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:v[0]||(v[0]=a=>n.value=!0)},{default:o(()=>[G("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Ot,{registration:E.registration,"show-editor":n.value,onCloseEditor:v[1]||(v[1]=a=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const qn=ie({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:p}){var Ze;const r=ha();p("pageTitle","Registration Manager");const l=Ht(),n=xt(),u=U(!0);let c=((Ze=l.params.convention)==null?void 0:Ze.toString())||"";const d=U({ID:0,ConventionUUID:Me(),OrganisationID:0,OrganisationUUID:Qe,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),A=fe(),E=U({ID:0,AdminLayoutUUID:Me(),ConventionID:d.value.ID,ConventionUUID:d.value.ConventionUUID,Name:"Registration Table",Type:yt.ADMIN_LAYOUT_TABLE,Panels:[]}),v=U([]),a=U([]),i=U([]),_=U([]),T=U([]),K=U(1),S=U(10),y=U([]),f=U(0),O=U(!1),j=U(""),se=U(""),Se=U(""),De=U(""),h=U(""),M=U(""),N=U([]),g=U([]),$=U([]),W=U([]),te=U([]),z=U([]),de=U(0),re=U(),pe=U(!1),Ie=U(!1);oe(de,m=>{m===7&&Ve()}),oe(h,()=>{se.value=Date.now().toString()}),oe(M,()=>{se.value=Date.now().toString()});const Re=()=>{v.value=[],i.value=[],T.value=[];try{A.getConventionAdminLayoutByName(d.value.ConventionUUID,"Registration Table").then(m=>{de.value+=1,m?E.value=m:(E.value.ConventionID=d.value.ID,E.value.ConventionUUID=d.value.ConventionUUID)})}catch{E.value.ConventionID=d.value.ID,E.value.ConventionUUID=d.value.ConventionUUID}try{A.getConventionForms(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(v.value=m)})}catch{}try{A.getConventionAccommodation(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(g.value=m)})}catch{}try{A.getConventionVenues(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(z.value=m)})}catch{}try{A.getConventionExtras(d.value.ConventionUUID).then(m=>{de.value+=1,m&&($.value=m)})}catch{}try{A.getConventionInterests(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(W.value=m)})}catch{}try{A.getConventionTickets(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(te.value=m)})}catch{}try{A.getConventionGroups(d.value.ConventionUUID).then(m=>{m&&(a.value=m.sort((D,R)=>D.Name.localeCompare(R.Name)))})}catch{}try{A.getConventionTags(d.value.ConventionUUID).then(m=>{m&&(_.value=m.sort((D,R)=>D.Title.localeCompare(R.Title)).map(D=>(D.Title=`${D.Title} [${D.Key}]`,D)))})}catch{}},be=({page:m,itemsPerPage:D,sortBy:R})=>{u.value=!0,K.value=m,y.value=R;const C=T.value.find(J=>J.uuid==j.value),me=C==null?void 0:C.layout.Items;let ae="",et="";if(R&&me&&R.length>=1){const J=me.find(ke=>ke.LayoutItemUUID==R[0].key);switch(et=R[0].order,J==null?void 0:J.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:ae="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:ae="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ae="submission.status";break}switch(J==null?void 0:J.UserField){case X.USER_DATA_SOURCE_DISPLAY_NAME:ae="user.display_name";break;case X.USER_DATA_SOURCE_EMAIL:ae="user.email";break;case X.USER_DATA_SOURCE_FIRST_NAME:ae="user.firstname";break;case X.USER_DATA_SOURCE_HANDLE:ae="user.handle";break;case X.USER_DATA_SOURCE_LAST_NAME:ae="user.lastname";break}}try{const J={Direction:et,Limit:D,Offset:(m-1)*D,Order:ae};C&&C.layout.RequiredRegistrationTags.length>0&&(J.PanelUUID=C==null?void 0:C.layout.LayoutPanelUUID),(C==null?void 0:C.layout.RequiredFormType)===Ae.FORM_TYPE_ACCOMMODATION&&(J.Accommodation=!0),(C==null?void 0:C.layout.RequiredFormType)===Ae.FORM_TYPE_BADGE&&(J.Badge=!0),(C==null?void 0:C.layout.RequiredFormType)===Ae.FORM_TYPE_DEALER&&(J.Dealer=!0),(C==null?void 0:C.layout.RequiredFormType)===Ae.FORM_TYPE_REGISTRATION&&(J.Registration=!0),J.GroupUUID=h.value||Qe,J.TagUUID=M.value||Qe,J.Email=De.value,J.Reference=Se.value,A.searchConventionRegistrations(d.value.ConventionUUID,J).then(ke=>{ke&&(f.value=ke.Total,i.value=ke.Registrations,T.value.forEach(qe=>{const Vt=qe.layout;qe.items=i.value.map(w=>{const we=[];let _e;w.Leader?_e=w:_e=w.Primary,we.push({Name:_e.User.DisplayName,UUID:_e.UserUUID,UserUUID:_e.User.UserUUID,IsLeader:!0,Reference:_e.Reference,Paid:_e.Paid,Total:_e.Total}),we.push(..._e.Members.map(Ue=>({Name:Ue.User.DisplayName,UUID:Ue.UserUUID,UserUUID:Ue.User.UserUUID,IsLeader:!1,Reference:Ue.Reference,Paid:Ue.Paid,Total:Ue.Total})));const H={};return qe.headers.forEach(Ue=>{var tt;const L=Vt.Items.find(Ne=>Ne.LayoutItemUUID===Ue.key);if(L){if(L.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&L.SectionField)w.Submissions.forEach(Ne=>{const he=Ne.Data.find(V=>V.SectionFieldUUID===L.SectionFieldUUID);if(he){Ue.type===zt.ACCOMMODATION?H[L.LayoutItemUUID]={Data:he.Data,Registration:w}:H[L.LayoutItemUUID]=he.Data;return}});else if(L.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&L.UserField)switch(L.UserField){case X.USER_DATA_SOURCE_AVATAR:H[L.LayoutItemUUID]=r.GetProfileImageURL(w.UserUUID);break;case X.USER_DATA_SOURCE_DISPLAY_NAME:H[L.LayoutItemUUID]=w.User.DisplayName;break;case X.USER_DATA_SOURCE_EMAIL:H[L.LayoutItemUUID]=w.User.Additional.Email;break;case X.USER_DATA_SOURCE_HANDLE:H[L.LayoutItemUUID]=w.User.Handle;break;case X.USER_DATA_SOURCE_DATE_OF_BIRTH:H[L.LayoutItemUUID]=w.User.Additional.DOB;break;case X.USER_DATA_SOURCE_FIRST_NAME:H[L.LayoutItemUUID]=w.User.Additional.FirstName;break;case X.USER_DATA_SOURCE_LAST_NAME:H[L.LayoutItemUUID]=w.User.Additional.LastName;break;case X.USER_DATA_SOURCE_TELEGRAM:H[L.LayoutItemUUID]="";break}else if(L.SourceType==="LAYOUT_ITEM_SOURCE_META"&&L.MetaField){const Ne=(tt=v.value.find(V=>V.Type===Ae.FORM_TYPE_REGISTRATION))==null?void 0:tt.FormUUID,he=w.Submissions.find(V=>V.FormUUID===Ne);switch(L.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:H[L.LayoutItemUUID]=w;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:H[L.LayoutItemUUID]=we;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:H[L.LayoutItemUUID]=w.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(he){const V=new Date(he.CreatedAt||"");H[L.LayoutItemUUID]=`${V.getFullYear()}-${(V.getMonth()+1).toString().padStart(2,"0")}-${V.getDate().toString().padStart(2,"0")} ${V.getHours().toString().padStart(2,"0")}:${V.getMinutes().toString().padStart(2,"0")}:${V.getSeconds().toString().padStart(2,"0")}`}else{const V=new Date(w.CreatedAt||"");H[L.LayoutItemUUID]=`${V.getFullYear()}-${(V.getMonth()+1).toString().padStart(2,"0")}-${V.getDate().toString().padStart(2,"0")} ${V.getHours().toString().padStart(2,"0")}:${V.getMinutes().toString().padStart(2,"0")}:${V.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:H[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:H[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:H[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if(w.Paid===0&&w.Total)H[L.LayoutItemUUID]="REQUIRED";else if(w.Total>w.Paid)H[L.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const V=we.find(B=>B.Paid===0&&(B.Total||0)>0);if(V){w.Total===0&&V.Total===0?H[L.LayoutItemUUID]="NOT_REQUIRED":w.Total===0&&V.Total||w.Total>0&&V.Total===0?H[L.LayoutItemUUID]="MISSING_REQUIRED":w.Paid>=w.Total?H[L.LayoutItemUUID]="AWAITING_PARTNER":H[L.LayoutItemUUID]="ALL_REQUIRED";break}else w.Total===0?H[L.LayoutItemUUID]="NOT_REQUIRED":H[L.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ka(w.Submissions,v.value),H[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}});break}}}}),H})}),u.value=!1)})}catch{}},Pe=m=>{O.value=!1,m&&(E.value=m,Ve())},Ve=()=>{E.value.Panels.forEach(m=>{m.Items.forEach(D=>{(D.SectionField==null||D.SectionField.Field==null)&&v.value.find(R=>{R.Sections.find(C=>{if(C.Fields){const me=C.Fields.find(ae=>ae.SectionFieldUUID===D.SectionFieldUUID);if(me)return D.SectionField=me,!0}})})})}),E.value.Panels.length>0&&(T.value=[],E.value.Panels.forEach(m=>{const D={uuid:Me(),order:m.Order,name:m.Name,headers:[],items:[],layout:m};m.Items.sort((R,C)=>R.Order>C.Order?1:R.Order==C.Order?0:-1),D.headers=m.Items.map(R=>{var C,me;return R.DefaultSort&&N.value.push({key:R.LayoutItemUUID,order:"asc"}),{key:R.LayoutItemUUID,title:R.Label||((me=(C=R.SectionField)==null?void 0:C.Field)==null?void 0:me.Label)||"",align:R.Align==="end"?"end":"start",sortable:ht(R),type:Ct(R)}}),T.value.push(D)}),T.value=T.value.sort((m,D)=>m.order>D.order?1:m.order==D.order?0:-1)),(j.value==null||j.value=="")&&T.value.length>0&&(j.value=T.value[0].uuid)};c?A.getConvention(c).then(m=>{m&&(d.value=m,E.value.ConventionID=d.value.ID,E.value.ConventionUUID=d.value.ConventionUUID,Re())}).catch(()=>{n.push("/")}):n.push("/");const Ct=m=>{var D,R;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_META)return`${m.SourceType}.${m.MetaField}`;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_FORM)return(R=(D=m.SectionField)==null?void 0:D.Field)==null?void 0:R.Type;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_USER)return`${m.SourceType}.${m.UserField}`},ht=m=>{const D=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],R=[X.USER_DATA_SOURCE_DISPLAY_NAME,X.USER_DATA_SOURCE_EMAIL,X.USER_DATA_SOURCE_HANDLE,X.USER_DATA_SOURCE_DATE_OF_BIRTH,X.USER_DATA_SOURCE_FIRST_NAME,X.USER_DATA_SOURCE_LAST_NAME];return D.includes(m.MetaField)||R.includes(m.UserField)},Mt=m=>{re.value=m,pe.value=!0},bt=m=>{re.value=m,Ie.value=!0};return oe(pe,m=>{m||(re.value=void 0)}),oe(Ie,m=>{m||(re.value=void 0)}),(m,D)=>(s(),Y(Na,null,{default:o(()=>[t(It,{color:"blue-darken-4"},{default:o(()=>[t(_a,{modelValue:j.value,"onUpdate:modelValue":D[0]||(D[0]=R=>j.value=R),"show-arrows":""},{default:o(()=>[(s(!0),I(k,null,Z(T.value,R=>(s(),Y(Ua,{key:R.uuid,value:R.uuid},{default:o(()=>[G(F(R.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(Xe),t(le,{icon:"mdi:mdi-cog-outline",onClick:D[1]||(D[1]=R=>O.value=!0)})]),_:1}),t(Ta,{modelValue:j.value,"onUpdate:modelValue":D[11]||(D[11]=R=>j.value=R),disabled:!0},{default:o(()=>[(s(!0),I(k,null,Z(T.value,R=>(s(),Y(Aa,{key:R.uuid,value:R.uuid},{default:o(()=>[R.uuid===j.value?(s(),Y(Rt,{key:0,class:"pa-2"},{default:o(()=>[t(x(Ga),{"items-per-page":S.value,"onUpdate:itemsPerPage":D[9]||(D[9]=C=>S.value=C),"sort-by":N.value,"onUpdate:sortBy":D[10]||(D[10]=C=>N.value=C),headers:R.headers,"items-length":f.value,items:R.items,"item-value":"LayoutItemUUID",loading:u.value,search:se.value,"onUpdate:options":be},ze({top:o(()=>[t(Ce,null,{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:Se.value,"onUpdate:modelValue":D[2]||(D[2]=C=>Se.value=C),label:"Search by Badge",clearable:!0,"hide-details":"",onInput:D[3]||(D[3]=C=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:De.value,"onUpdate:modelValue":D[4]||(D[4]=C=>De.value=C),label:"Search By Email",clearable:!0,"hide-details":"",onInput:D[5]||(D[5]=C=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ne,{modelValue:h.value,"onUpdate:modelValue":D[6]||(D[6]=C=>h.value=C),label:"Search By Group",clearable:!0,"hide-details":"",items:a.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ne,{modelValue:M.value,"onUpdate:modelValue":D[7]||(D[7]=C=>M.value=C),label:"Search By Tag",clearable:!0,"hide-details":"",items:_.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[Z(R.headers,C=>({name:`item.${C.key}`,fn:o(({item:me})=>[t(Ro,{header:C,item:me,accommodations:g.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,venues:z.value,onOpenActions:Mt,onOpenPayments:bt,onReload:D[8]||(D[8]=ae=>be({page:K.value,itemsPerPage:S.value,sortBy:y.value}))},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),O.value?(s(),Y(Ya,{key:0,title:"Edit Layout",modelValue:O.value,"onUpdate:modelValue":D[12]||(D[12]=R=>O.value=R),layout:E.value,onSave:Pe},null,8,["modelValue","layout"])):q("",!0),re.value?(s(),I(k,{key:1},[pe.value?(s(),Y(mn,{key:0,modelValue:pe.value,"onUpdate:modelValue":D[13]||(D[13]=R=>pe.value=R),registration:re.value,"onUpdate:registration":D[14]||(D[14]=R=>re.value=R),accommodations:g.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Status & Communications",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):Ie.value?(s(),Y(dn,{key:1,modelValue:Ie.value,"onUpdate:modelValue":D[15]||(D[15]=R=>Ie.value=R),registration:re.value,"onUpdate:registration":D[16]||(D[16]=R=>re.value=R),accommodations:g.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Payments",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):q("",!0)],64)):q("",!0)]),_:1}))}});export{qn as default};
