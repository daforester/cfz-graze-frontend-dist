import{p as We,n as Qe,e as ee,t as me,c as Xe,G as Ze,v as l,H as M,x as Le,I as ue,a1 as pe,a2 as He,r as v,a3 as _e,K as i,L as h,M as u,$ as fe,S as x,a8 as ke,Z as B,Q as Y,w as be,R as T,N as G,O as k,U as q,_ as qe,a4 as xe,a0 as et}from"./index-666ceafa.js";import{e as tt,T as at,d as ot,c as lt}from"./FormRenderer.vue_vue_type_style_index_0_lang-f0988c7b.js";import{a as nt,F as le}from"./form-29fd1dbb.js";import{_ as je}from"./ModelDialog.vue_vue_type_script_setup_true_lang-a9cbd684.js";import{m as it,k as st,l as ut,n as rt,o as dt,p as mt,q as At,u as _t,r as Ut,s as Tt,t as ct,v as Et,w as vt,x as St,y as Rt,z as Ne,A as Ve,B as Pe,_ as Dt,f as $e,g as It,h as Ot,i as pt,j as ft,d as Ct}from"./VWindowItem-76cb6dec.js";import{a as Ae,V as J}from"./VRow-82ef2ef1.js";import{V as Te}from"./VTextField-950d7b16.js";import{V as se}from"./copyToClipboard-1e0f962a.js";import{u as Mt,j as ce}from"./VContainer-9da15021.js";import{v as Ee}from"./v4-a960c1f4.js";import{u as yt}from"./VCheckbox-a58ea759.js";import{V as we,a as Ge}from"./VList-d91b4ddb.js";import{V as Se}from"./VBtn-c7281faf.js";import{S as gt}from"./submission-56c4c4f1.js";import{V as Lt}from"./VAvatar-07a71531.js";import{c as kt,e as Je}from"./VCard-fa5f3bb7.js";import{V as bt}from"./VDialog-20036a6d.js";import{s as Oe}from"./sortSubmissions-8ed80f07.js";import{u as Ft}from"./useStoreAPI-35b913d3.js";import{u as ht,V as Nt}from"./VToolbar-38f8792a.js";import{V as Vt}from"./VSpacer-605a85d9.js";import{V as Be}from"./VTable-73633621.js";import"./index-26b71cef.js";import"./VChip-568022c1.js";import"./scopeId-8e48918c.js";import"./VTextarea-76ba6832.js";import"./userData-79211a98.js";import"./VForm-a1656cee.js";import"./VToolbarItems-0e7aa202.js";import"./VDivider-44335d3c.js";var Ke=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Ke||{});const Pt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ve=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(ve||{});const $t=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var L=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(L||{});const wt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var F=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(F||{});const Gt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Bt=We({itemsLength:{type:[Number,String],required:!0},...it(),...st(),...ut()},"VDataTableServer"),Yt=Qe()({name:"VDataTableServer",props:Bt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,b)=>!0},setup(e,b){let{emit:A,slots:a}=b;const{groupBy:s}=rt(e),{sortBy:r,multiSort:D,mustSort:c}=dt(e),{page:S,itemsPerPage:f}=mt(e),t=ee(()=>parseInt(e.itemsLength,10)),{columns:_,headers:o}=At(e,{groupBy:s,showSelect:me(e,"showSelect"),showExpand:me(e,"showExpand")}),{items:y}=_t(e,_),{toggleSort:R}=Ut({sortBy:r,multiSort:D,mustSort:c,page:S}),{opened:j,isGroupOpen:P,toggleGroup:te,extractRows:K}=Tt({groupBy:s,sortBy:r}),{pageCount:ae,setItemsPerPage:ne}=ct({page:S,itemsPerPage:f,itemsLength:t}),{flatItems:g}=Et(y,s,j),{isSelected:N,select:O,selectAll:H,toggleSelect:ie,someSelected:oe,allSelected:Q}=vt(e,{allItems:y,currentPage:y}),{isExpanded:X,toggleExpand:Ce}=St(e),Re=ee(()=>K(y.value));Rt({page:S,itemsPerPage:f,sortBy:r,groupBy:s,search:me(e,"search")}),Xe("v-data-table",{toggleSort:R,sortBy:r}),Ze({VDataTableRows:{hideNoData:me(e,"hideNoData"),noDataText:me(e,"noDataText"),loading:me(e,"loading"),loadingText:me(e,"loadingText")}});const W=ee(()=>({page:S.value,itemsPerPage:f.value,sortBy:r.value,pageCount:ae.value,toggleSort:R,setItemsPerPage:ne,someSelected:oe.value,allSelected:Q.value,isSelected:N,select:O,selectAll:H,toggleSelect:ie,isExpanded:X,toggleExpand:Ce,isGroupOpen:P,toggleGroup:te,items:Re.value,groupedItems:g.value,columns:_.value,headers:o.value}));Mt(()=>{const[Me]=Ne.filterProps(e),[ye]=Ve.filterProps(e),[De]=Pe.filterProps(e),[n]=Be.filterProps(e);return l(Be,Le({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},n),{top:()=>{var d;return(d=a.top)==null?void 0:d.call(a,W.value)},default:()=>{var d,m,U,z;return a.default?a.default(W.value):l(M,null,[(d=a.colgroup)==null?void 0:d.call(a,W.value),l("thead",{class:"v-data-table__thead",role:"rowgroup"},[l(Ve,Le(ye,{sticky:e.fixedHeader}),a)]),(m=a.thead)==null?void 0:m.call(a,W.value),l("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(W.value):l(Pe,Le(De,{items:g.value}),a)]),(U=a.tbody)==null?void 0:U.call(a,W.value),(z=a.tfoot)==null?void 0:z.call(a,W.value)])},bottom:()=>a.bottom?a.bottom(W.value):l(Ne,Me,{prepend:a["footer.prepend"]})})})}}),Ht=ue({__name:"EditAdminLayout",props:pe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:pe(["save"],["update:modelValue"]),setup(e,{emit:b}){const A=He(e,"modelValue"),a=v(_e(e.layout)),s=v([]),r=fe(),D=({callback:t})=>{const _=()=>{t&&t("Failed to Save Layout")},o=()=>{t&&t("Layout Saved")};r.saveAdminLayout(a.value).then(y=>{y?(o(),b("save",y)):_()}).catch(()=>{_()})},c=()=>({ID:0,LayoutPanelUUID:Ee(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:le.FORM_TYPE_NIL,RequiredGroupMemberships:[]}),S=t=>()=>({ID:0,LayoutItemUUID:Ee(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:ve.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),f=t=>{const _=s.value.find(o=>o.value===t.SectionFieldUUID);_&&(t.SectionFieldID=_.object.ID,t.SectionField=_.object)};return r.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(_=>_.Sections.forEach(o=>o.Fields&&s.value.push(...o.Fields.map(y=>{var j;return{title:`${_.Name} - ${o.Name} - ${(j=y.Field)==null?void 0:j.Name}`,value:y.SectionFieldUUID,object:y}})))),s.value.sort(tt("title"))}),(t,_)=>(i(),h(je,{modelValue:A.value,"onUpdate:modelValue":_[3]||(_[3]=o=>A.value=o),onSave:D,title:t.title,color:"primary"},{default:u(()=>[l(ce,{class:"px-0 mx-0",fluid:!0},{default:u(()=>[l(Ae,null,{default:u(()=>[l(J,{cols:"12",sm:"6"},{default:u(()=>[l(Te,{modelValue:a.value.Name,"onUpdate:modelValue":_[0]||(_[0]=o=>a.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),l(J,{cols:"12",sm:"6"},{default:u(()=>[l(se,{modelValue:a.value.Type,"onUpdate:modelValue":_[1]||(_[1]=o=>a.value.Type=o),label:"Layout Type",items:x(Pt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l($e,{modelValue:a.value.Panels,"onUpdate:modelValue":_[2]||(_[2]=o=>a.value.Panels=o),"new-item":c,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ke({_:2},[B(a.value.Panels,(o,y)=>({name:`panel_${y}`,fn:u(()=>[l(ce,{class:"px-0 mx-0",fluid:!0},{default:u(()=>[l(Ae,null,{default:u(()=>[l(J,{cols:"12",sm:"6"},{default:u(()=>[l(Te,{modelValue:o.Name,"onUpdate:modelValue":R=>o.Name=R,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(J,{cols:"12",sm:"6"},{default:u(()=>[l(se,{modelValue:o.RequiredFormType,"onUpdate:modelValue":R=>o.RequiredFormType=R,items:x(nt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),l(Ae,null,{default:u(()=>[l(J,{cols:"12"},{default:u(()=>[l(Dt,{label:"Required Groups",variant:"outlined",modelValue:o.RequiredGroupMemberships,"onUpdate:modelValue":R=>o.RequiredGroupMemberships=R,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l($e,{modelValue:o.Items,"onUpdate:modelValue":R=>o.Items=R,"new-item":S(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ke({_:2},[B(o.Items,(R,j)=>({name:`item_${j}`,fn:u(()=>[l(ce,{class:"px-0 mx-0",fluid:!0},{default:u(()=>[l(Ae,null,{default:u(()=>[l(J,{cols:"12",sm:"6"},{default:u(()=>[l(Te,{modelValue:R.Label,"onUpdate:modelValue":P=>R.Label=P,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l(Ae,null,{default:u(()=>[l(J,{cols:"12",sm:"6"},{default:u(()=>[l(se,{modelValue:R.SourceType,"onUpdate:modelValue":P=>R.SourceType=P,label:"Source Type",items:x($t),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(J,{cols:"12",sm:"6"},{default:u(()=>[R.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),h(se,{key:0,modelValue:R.SectionFieldUUID,"onUpdate:modelValue":P=>R.SectionFieldUUID=P,label:"Form Data",items:s.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:P=>f(R)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):R.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),h(se,{key:1,modelValue:R.MetaField,"onUpdate:modelValue":P=>R.MetaField=P,label:"Miscellaneous Data",items:x(wt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):R.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),h(se,{key:2,modelValue:R.UserField,"onUpdate:modelValue":P=>R.UserField=P,label:"User Profile Data",items:x(Gt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):Y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ye=e=>(typeof e=="string"&&(e=new Date(e)),`${e.toLocaleString("default",{weekday:"long"})} ${e.getDate()}${qt(e.getDate())} ${e.toLocaleString("default",{month:"long"})}`),qt=e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},jt=q("h3",null,"Preferences",-1),Jt=q("h3",null,"Selected Tickets",-1),Kt=ue({__name:"EditAccommodationAssignmentDialog",props:pe({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:pe(["update:field"],["update:modelValue"]),setup(e,{emit:b}){const A=e,{convention:a,registration:s,title:r=""}=A,D=fe(),c=He(e,"modelValue"),S=v([]),f=yt(A,b,void 0,void 0,"field"),t=v(_e(f.value));be(f,()=>{t.value=_e(f.value)});const _=v(),o=v(""),y=v(""),R=v([]),j=v({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),P=()=>{c.value=!1},te=async()=>{var H;const g=await D.getConventionAvailableAccommodation(a.ConventionUUID);g&&(S.value=g);const N=await D.getRegistrationGroup(s.RegistrationUUID||"");N&&(_.value=N);const O=await D.getConventionTickets(a.ConventionUUID);O&&(R.value=O);try{j.value=JSON.parse(((H=_.value)==null?void 0:H.TicketData)||"")}catch{}};be(o,()=>{y.value=ae.value.length>0?ae.value[0].value:""});const K=ee(()=>S.value.map(g=>({title:`${g.Name}`,value:g.AccommodationUUID}))),ae=ee(()=>{const g=ne.value,N=S.value.find(O=>O.AccommodationUUID===o.value);return(N==null?void 0:N.Pool.map(O=>{var ie;let H;return g.forEach(oe=>{O.Costs.forEach(Q=>{Q.DateStart===(oe==null?void 0:oe.DateStart)&&Q.DateEnd===oe.DateEnd&&(H===void 0||H>Q.Availability)&&(H=Q.Availability)})}),{title:`${(ie=O.Venue)==null?void 0:ie.Name} - ${O.Name} (${H} Available)`,value:O.RoomUUID}}))||[]}),ne=ee(()=>[...j.value.Ticket,...j.value.AddonsChecked,...j.value.ComponentsChecked].map(g=>R.value.find(N=>N.TicketUUID===g)).filter(g=>g!==void 0&&g.RequiresAccommodation));return te(),(g,N)=>(i(),h(je,{modelValue:c.value,"onUpdate:modelValue":N[2]||(N[2]=O=>c.value=O),title:x(r),color:"primary"},{default:u(()=>[l(ce,{class:"pa-0",fluid:!0},{default:u(()=>[l(Ae,null,{default:u(()=>[l(J,{cols:"12",md:"6"},{default:u(()=>[g.selectedAccommodation.length?(i(),T(M,{key:0},[jt,l(we,{type:"number"},{default:u(()=>[(i(!0),T(M,null,B(g.selectedAccommodation,(O,H)=>(i(),h(Ge,{key:O.AccommodationUUID},{default:u(()=>[G(k(H+1)+". "+k(O.Name),1)]),_:2},1024))),128))]),_:1})],64)):Y("",!0)]),_:1}),l(J,{cosl:"12",md:"6"},{default:u(()=>[Jt,l(we,{type:"number"},{default:u(()=>[(i(!0),T(M,null,B(ne.value,O=>(i(),h(Ge,{key:O==null?void 0:O.TicketUUID},{default:u(()=>[G(k(O.Name)+" ("+k(x(Ye)(O.DateStart))+" - "+k(x(Ye)(O.DateEnd))+") ",1)]),_:2},1024))),128))]),_:1})]),_:1}),l(J,{cols:"12",md:"6"},{default:u(()=>[l(se,{modelValue:o.value,"onUpdate:modelValue":N[0]||(N[0]=O=>o.value=O),items:K.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),l(J,{cols:"12",md:"6"},{default:u(()=>[l(se,{modelValue:y.value,"onUpdate:modelValue":N[1]||(N[1]=O=>y.value=O),items:ae.value,"item-title":"title","item-value":"value",label:"Room Pool"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),actions:u(()=>[l(Se,{color:"blue-darken-1",variant:"text",onClick:P},{default:u(()=>[G(" Close ")]),_:1})]),_:1},8,["modelValue","title"]))}}),zt={key:1,class:"accommodationList"},Wt=ue({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},registration:{},value:{default:""},venues:{}},setup(e){const b=v(!1),A=ee(()=>{if(!e.value)return[];const a=JSON.parse(e.value),s=e.accommodations.filter(r=>a.includes(r.AccommodationUUID)).sort((r,D)=>{const c=a.findIndex(f=>f===r.AccommodationUUID),S=a.findIndex(f=>f===D.AccommodationUUID);return c>S?1:-1});return _e(s)});return(a,s)=>{var r,D,c;return i(),T(M,null,[a.registration.Allocation?(i(),T(M,{key:0},[G(k((r=a.accommodations.find(S=>S.AccommodationUUID===a.registration.Allocation.AccommodationUUID))==null?void 0:r.Name)+" "+k((c=(D=a.venues)==null?void 0:D.map(S=>S.Rooms.find(f=>f.RoomUUID===a.registration.Allocation.RoomUUID)).filter(S=>S!=null)[0])==null?void 0:c.Name),1)],64)):Y("",!0),a.value?(i(),T("ol",zt,[(i(!0),T(M,null,B(A.value,S=>(i(),T("li",{key:S.AccommodationUUID},k(S.Name),1))),128))])):Y("",!0),l(Se,{onClick:s[0]||(s[0]=S=>b.value=!0),variant:"flat",color:"success"},{default:u(()=>[G("Assign Accommodation")]),_:1}),a.convention&&b.value?(i(),h(Kt,{key:2,modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=S=>b.value=S),title:"Accommodation Allocation",convention:a.convention,registration:a.registration,"selected-accommodation":A.value},null,8,["modelValue","convention","registration","selected-accommodation"])):Y("",!0)],64)}}});const Qt=qe(Wt,[["__scopeId","data-v-14a6c9a0"]]),Xt={key:0,class:"addonList"},Zt={key:0},xt={key:0},ea=ue({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const b=ee(()=>{if(!e.value)return;const A=JSON.parse(e.value),a=Object.keys(A),s=_e(e.extras);return s.forEach(r=>{r.Options=r.Options.filter(D=>a.includes(D.OptionUUID)?(D.Choices=D.Choices.filter(c=>c.TagUUID===A[D.OptionUUID].choiceId),A[D.OptionUUID].checked):!1)}),s.filter(r=>r.Options.length>0),s});return(A,a)=>A.value?(i(),T("ul",Xt,[(i(!0),T(M,null,B(b.value,s=>(i(),T(M,{key:s.ExtraUUID},[s.Options.length?(i(),T("li",Zt,[q("strong",null,k(s.Name),1),q("ul",null,[(i(!0),T(M,null,B(s.Options,r=>(i(),T("li",{key:r.OptionUUID},[G(k(r.Name)+" ",1),r.Choices.length==1?(i(),T("small",xt,"("+k(r.Choices[0].Title)+")",1)):Y("",!0)]))),128))])])):Y("",!0)],64))),128))])):Y("",!0)}});const ta=qe(ea,[["__scopeId","data-v-55786e01"]]),aa={key:0},oa=ue({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const b=ee(()=>{if(!e.value)return;const A=JSON.parse(e.value);return Object.entries(A).filter(([,a])=>a).map(([a,s])=>e.interests.find(r=>r.InterestUUID===a)).filter(a=>a!==void 0)});return(A,a)=>A.value?(i(),T("ul",aa,[(i(!0),T(M,null,B(b.value,s=>(i(),T("li",{key:s.InterestUUID},k(s.Name),1))),128))])):Y("",!0)}}),la=q("br",null,null,-1),na=q("small",null,"Options:",-1),ia=q("br",null,null,-1),sa=q("small",null,"Addons:",-1),ua=ue({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const b=ee(()=>{if(!e.value)return;let A={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{A=JSON.parse(e.value),"ticket"in A&&(A.Ticket=A.ticket),"addonsChecked"in A&&(A.AddonsChecked=A.addonsChecked),"componentsChecked"in A&&(A.ComponentsChecked=A.componentsChecked)}catch{}return A.Ticket.filter(a=>{const s=e.tickets.find(r=>r.TicketUUID===a);return!(!s||s.Type!==at.TICKET_TYPE_TICKET)}).map(a=>{const s=e.tickets.find(D=>D.TicketUUID===a),r=_e(s);return r.TicketComponents=s.TicketComponents.filter(D=>A.ComponentsChecked.includes(D.TicketUUID)),r.AddonTickets=s.AddonTickets.filter(D=>A.AddonsChecked.includes(D.TicketUUID)),r})});return(A,a)=>A.value?(i(!0),T(M,{key:0},B(b.value,s=>(i(),T("div",{key:s.TicketUUID},[q("strong",null,k(s.Name),1),s.TicketComponents.length>0?(i(),T(M,{key:0},[la,na,G("  "),(i(!0),T(M,null,B(s.TicketComponents,r=>(i(),T(M,{key:r.TicketUUID},[q("small",null,k(r.Name),1),G("  ")],64))),128))],64)):Y("",!0),s.AddonTickets.length>0?(i(),T(M,{key:1},[ia,sa,G("  "),(i(!0),T(M,null,B(s.AddonTickets,r=>(i(),T("small",{key:r.TicketUUID},[G("("),q("em",null,k(r.Name),1),G(")")]))),128))],64)):Y("",!0)]))),128)):Y("",!0)}}),ra={key:0},da={key:0},ma=q("strong",null,"Total:",-1),Aa=ue({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:b}){const A=fe(),a=v(),s=v(),r=v(),D=v(),c=v(!1),S=t=>{console.log(t)},f=(t,_,o)=>{s.value=t,A.getRegistrationGroup(o.RegistrationUUID||"").then(y=>{r.value=y,a.value=_,D.value=o,c.value=!0})};return(t,_)=>(i(),T(M,null,[t.header.key=="actions"?(i(),h(Se,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:_[0]||(_[0]=o=>S(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(i(),h(Qt,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,convention:t.convention,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","convention","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(i(),h(ta,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(i(),h(oa,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(i(),h(ua,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(i(!0),T(M,{key:5},B(t.item.raw[t.header.key],o=>(i(),T("ul",{key:o.Heading},[q("li",null,[q("strong",null,k(o.Heading)+":",1),G(" "+k(x(gt)(o.Submission.Status))+" ",1),l(Se,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:y=>f(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),h(Lt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(i(),T(M,{key:7},[t.item.raw[t.header.key].length===1?(i(),T("em",ra," Not in a group ")):(i(),T(M,{key:1},[q("ul",null,[(i(!0),T(M,null,B(t.item.raw[t.header.key],o=>(i(),T("li",{key:o.UUID,class:"ml-0"},[G(" #"+k(o.Reference)+" : "+k(o.Name)+" ",1),o.IsLeader?(i(),T("strong",da,"(Leader)")):Y("",!0)]))),128))]),ma,G(" "+k(t.item.raw[t.header.key].length),1)],64))],64)):(i(),T(M,{key:8},[G(k(t.item.raw[t.header.key]),1)],64)),c.value&&D.value&&a.value?(i(),h(bt,{key:9,modelValue:c.value,"onUpdate:modelValue":_[3]||(_[3]=o=>c.value=o),scrollable:!0},{default:u(()=>[l(Je,{class:"bg-red-darken-4"},{default:u(()=>[l(kt,null,{default:u(()=>[l(ot,{modelValue:a.value,"onUpdate:modelValue":_[1]||(_[1]=o=>a.value=o),admin:!0,convention:t.convention,data:D.value,editable:!0,"registration-group":r.value,onClose:_[2]||(_[2]=o=>{c.value=!1,b("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Y("",!0)],64))}}),Ha=ue({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:b}){var De;const A=Ft();b("pageTitle","Registration Manager");const a=xe(),s=et(),r=v(!0);let D=((De=a.params.convention)==null?void 0:De.toString())||"";const c=v({ID:0,ConventionUUID:Ee(),OrganisationID:0,OrganisationUUID:ht,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),S=fe(),f=v({ID:0,AdminLayoutUUID:Ee(),ConventionID:c.value.ID,ConventionUUID:c.value.ConventionUUID,Name:"Registration Table",Type:Ke.ADMIN_LAYOUT_TABLE,Panels:[]}),t=v([]),_=v([]),o=v([]),y=v(1),R=v(10),j=v([]),P=v(0),te=v(!1),K=v(""),ae=v(""),ne=v(""),g=v(""),N=v([]),O=v([]),H=v([]),ie=v([]),oe=v([]),Q=v([]),X=v(0);be(X,n=>{n===7&&W()});const Ce=()=>{t.value=[],_.value=[],o.value=[];try{S.getConventionAdminLayoutByName(c.value.ConventionUUID,"Registration Table").then(n=>{X.value+=1,n?f.value=n:(f.value.ConventionID=c.value.ID,f.value.ConventionUUID=c.value.ConventionUUID)})}catch{f.value.ConventionID=c.value.ID,f.value.ConventionUUID=c.value.ConventionUUID}try{S.getConventionForms(c.value.ConventionUUID).then(n=>{X.value+=1,n&&(t.value=n)})}catch{}try{S.getConventionAccommodation(c.value.ConventionUUID).then(n=>{X.value+=1,n&&(O.value=n)})}catch{}try{S.getConventionVenues(c.value.ConventionUUID).then(n=>{X.value+=1,n&&(Q.value=n)})}catch{}try{S.getConventionExtras(c.value.ConventionUUID).then(n=>{X.value+=1,n&&(H.value=n)})}catch{}try{S.getConventionInterests(c.value.ConventionUUID).then(n=>{X.value+=1,n&&(ie.value=n)})}catch{}try{S.getConventionTickets(c.value.ConventionUUID).then(n=>{X.value+=1,n&&(oe.value=n)})}catch{}},Re=({page:n,itemsPerPage:d,sortBy:m})=>{y.value=n,j.value=m;const U=o.value.find($=>$.uuid==K.value),z=U==null?void 0:U.layout.Items;let w="",Fe="";if(m&&z&&m.length>=1){const $=z.find(Ue=>Ue.LayoutItemUUID==m[0].key);switch(Fe=m[0].order,$==null?void 0:$.MetaField){case L.META_DATA_SOURCE_ACCOMMODATION_FORM:w="submission.status";break;case L.META_DATA_SOURCE_BADGE_FORM:w="submission.status";break;case L.META_DATA_SOURCE_DEALER_FORM:w="submission.status";break;case L.META_DATA_SOURCE_REGISTRATION_FORM:w="submission.status";break;case L.META_DATA_SOURCE_REGISTRATION_REFERENCE:w="reference";break;case L.META_DATA_SOURCE_SUBMISSION_DATE:w="created";break;case L.META_DATA_SOURCE_SUBMISSION_STATUS:w="submission.status";break}switch($==null?void 0:$.UserField){case F.USER_DATA_SOURCE_DISPLAY_NAME:w="user.display_name";break;case F.USER_DATA_SOURCE_EMAIL:w="user.email";break;case F.USER_DATA_SOURCE_FIRST_NAME:w="user.firstname";break;case F.USER_DATA_SOURCE_HANDLE:w="user.handle";break;case F.USER_DATA_SOURCE_LAST_NAME:w="user.lastname";break}}try{const $={Direction:Fe,Limit:d,Offset:(n-1)*d,Order:w};(U==null?void 0:U.layout.RequiredFormType)===le.FORM_TYPE_ACCOMMODATION&&($.Accommodation=!0),(U==null?void 0:U.layout.RequiredFormType)===le.FORM_TYPE_BADGE&&($.Badge=!0),(U==null?void 0:U.layout.RequiredFormType)===le.FORM_TYPE_DEALER&&($.Dealer=!0),(U==null?void 0:U.layout.RequiredFormType)===le.FORM_TYPE_REGISTRATION&&($.Registration=!0),$.Email=g.value,$.Reference=ne.value,S.searchConventionRegistrations(c.value.ConventionUUID,$).then(Ue=>{Ue&&(P.value=Ue.Total,_.value=Ue.Registrations,o.value.forEach(ge=>{const ze=ge.layout;ge.items=_.value.map(C=>{const V={};return ge.headers.forEach(he=>{const p=ze.Items.find(re=>re.LayoutItemUUID===he.key);if(p){if(p.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&p.SectionField)C.Submissions.forEach(re=>{const Z=re.Data.find(Ie=>Ie.SectionFieldUUID===p.SectionFieldUUID);if(Z){he.type===lt.ACCOMMODATION?V[p.LayoutItemUUID]={Data:Z.Data,Registration:C}:V[p.LayoutItemUUID]=Z.Data;return}});else if(p.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&p.UserField)switch(p.UserField){case F.USER_DATA_SOURCE_AVATAR:V[p.LayoutItemUUID]=A.GetProfileImageURL(C.UserUUID);break;case F.USER_DATA_SOURCE_DISPLAY_NAME:V[p.LayoutItemUUID]=C.User.DisplayName;break;case F.USER_DATA_SOURCE_EMAIL:V[p.LayoutItemUUID]=C.User.Additional.Email;break;case F.USER_DATA_SOURCE_HANDLE:V[p.LayoutItemUUID]=C.User.Handle;break;case F.USER_DATA_SOURCE_DATE_OF_BIRTH:V[p.LayoutItemUUID]=C.User.Additional.DOB;break;case F.USER_DATA_SOURCE_FIRST_NAME:V[p.LayoutItemUUID]=C.User.Additional.FirstName;break;case F.USER_DATA_SOURCE_LAST_NAME:V[p.LayoutItemUUID]=C.User.Additional.LastName;break;case F.USER_DATA_SOURCE_TELEGRAM:V[p.LayoutItemUUID]="";break}else if(p.SourceType==="LAYOUT_ITEM_SOURCE_META"&&p.MetaField){const re=[];let Z;const Ie=C.Submissions.find(E=>{var I;return((I=E.Form)==null?void 0:I.Type)===le.FORM_TYPE_REGISTRATION});switch(p.MetaField){case L.META_DATA_SOURCE_REGISTRATION_GROUP:C.Leader?Z=C:Z=C.Primary,re.push({Name:Z.User.DisplayName,UUID:Z.UserUUID,IsLeader:!0,Reference:Z.Reference}),re.push(...Z.Members.map(E=>({Name:E.User.DisplayName,UUID:E.UserUUID,IsLeader:!1,Reference:E.Reference}))),V[p.LayoutItemUUID]=re;break;case L.META_DATA_SOURCE_REGISTRATION_REFERENCE:V[p.LayoutItemUUID]=C.Reference;break;case L.META_DATA_SOURCE_SUBMISSION_DATE:if(Ie){const E=new Date(Ie.CreatedAt||"");V[p.LayoutItemUUID]=`${E.getFullYear()}-${(E.getMonth()+1).toString().padStart(2,"0")}-${E.getDate().toString().padStart(2,"0")} ${E.getHours().toString().padStart(2,"0")}:${E.getMinutes().toString().padStart(2,"0")}:${E.getSeconds().toString().padStart(2,"0")}`}else{const E=new Date(C.CreatedAt||"");V[p.LayoutItemUUID]=`${E.getFullYear()}-${(E.getMonth()+1).toString().padStart(2,"0")}-${E.getDate().toString().padStart(2,"0")} ${E.getHours().toString().padStart(2,"0")}:${E.getMinutes().toString().padStart(2,"0")}:${E.getSeconds().toString().padStart(2,"0")}`}break;case L.META_DATA_SOURCE_ACCOMMODATION_FORM:Oe(C.Submissions,t.value),V[p.LayoutItemUUID]=C.Submissions.map(E=>{const I=t.value.find(de=>de.FormUUID===E.FormUUID);return{Heading:I==null?void 0:I.Heading,Form:I,Submission:E,Registration:C}}).filter(E=>{var I;return((I=E.Form)==null?void 0:I.Type)===le.FORM_TYPE_ACCOMMODATION});break;case L.META_DATA_SOURCE_BADGE_FORM:Oe(C.Submissions,t.value),V[p.LayoutItemUUID]=C.Submissions.map(E=>{const I=t.value.find(de=>de.FormUUID===E.FormUUID);return{Heading:I==null?void 0:I.Heading,Form:I,Submission:E,Registration:C}}).filter(E=>{var I;return((I=E.Form)==null?void 0:I.Type)===le.FORM_TYPE_BADGE});break;case L.META_DATA_SOURCE_DEALER_FORM:Oe(C.Submissions,t.value),V[p.LayoutItemUUID]=C.Submissions.map(E=>{const I=t.value.find(de=>de.FormUUID===E.FormUUID);return{Heading:I==null?void 0:I.Heading,Form:I,Submission:E,Registration:C}}).filter(E=>{var I;return((I=E.Form)==null?void 0:I.Type)===le.FORM_TYPE_DEALER});break;case L.META_DATA_SOURCE_SUBMISSION_STATUS:Oe(C.Submissions,t.value),V[p.LayoutItemUUID]=C.Submissions.map(E=>{const I=t.value.find(de=>de.FormUUID===E.FormUUID);return{Heading:I==null?void 0:I.Heading,Form:I,Submission:E,Registration:C}});break}}}}),V})}),r.value=!1)})}catch{}},W=()=>{f.value.Panels.forEach(n=>{n.Items.forEach(d=>{(d.SectionField==null||d.SectionField.Field==null)&&t.value.find(m=>{m.Sections.find(U=>{if(U.Fields){const z=U.Fields.find(w=>w.SectionFieldUUID===d.SectionFieldUUID);if(z)return d.SectionField=z,!0}})})})}),f.value.Panels.length>0&&(o.value=[],f.value.Panels.forEach(n=>{const d={uuid:Ee(),order:n.Order,name:n.Name,headers:[],items:[],layout:n};n.Items.sort((m,U)=>m.Order>U.Order?1:m.Order==U.Order?0:-1),d.headers=n.Items.map(m=>{var U,z;return{key:m.LayoutItemUUID,title:m.Label||((z=(U=m.SectionField)==null?void 0:U.Field)==null?void 0:z.Label)||"",align:m.Align==="end"?"end":"start",sortable:ye(m),type:Me(m)}}),o.value.push(d)})),(K.value==null||K.value=="")&&o.value.length>0&&(K.value=o.value[0].uuid)};D?S.getConvention(D).then(n=>{n&&(c.value=n,Ce())}).catch(()=>{s.push("/")}):s.push("/");const Me=n=>{var d,m;if(n.SourceType===ve.LAYOUT_ITEM_SOURCE_META)return`${n.SourceType}.${n.MetaField}`;if(n.SourceType===ve.LAYOUT_ITEM_SOURCE_FORM)return(m=(d=n.SectionField)==null?void 0:d.Field)==null?void 0:m.Type;if(n.SourceType===ve.LAYOUT_ITEM_SOURCE_USER)return`${n.SourceType}.${n.UserField}`},ye=n=>{const d=[L.META_DATA_SOURCE_ACCOMMODATION_FORM,L.META_DATA_SOURCE_BADGE_FORM,L.META_DATA_SOURCE_DEALER_FORM,L.META_DATA_SOURCE_REGISTRATION_FORM,L.META_DATA_SOURCE_REGISTRATION_REFERENCE,L.META_DATA_SOURCE_SUBMISSION_DATE,L.META_DATA_SOURCE_SUBMISSION_STATUS],m=[F.USER_DATA_SOURCE_DISPLAY_NAME,F.USER_DATA_SOURCE_EMAIL,F.USER_DATA_SOURCE_HANDLE,F.USER_DATA_SOURCE_DATE_OF_BIRTH,F.USER_DATA_SOURCE_FIRST_NAME,F.USER_DATA_SOURCE_LAST_NAME];return d.includes(n.MetaField)||m.includes(n.UserField)};return(n,d)=>(i(),h(Ct,null,{default:u(()=>[l(Nt,{color:"blue-darken-4"},{default:u(()=>[l(It,{modelValue:K.value,"onUpdate:modelValue":d[0]||(d[0]=m=>K.value=m),"show-arrows":""},{default:u(()=>[(i(!0),T(M,null,B(o.value,m=>(i(),h(Ot,{key:m.uuid,value:m.uuid},{default:u(()=>[G(k(m.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(Vt),l(Se,{icon:"mdi:mdi-cog-outline",onClick:d[1]||(d[1]=m=>te.value=!0)})]),_:1}),l(ft,{modelValue:K.value,"onUpdate:modelValue":d[8]||(d[8]=m=>K.value=m),disabled:!0},{default:u(()=>[(i(!0),T(M,null,B(o.value,m=>(i(),h(pt,{key:m.uuid,value:m.uuid},{default:u(()=>[m.uuid===K.value?(i(),h(Je,{key:0,class:"pa-2"},{default:u(()=>[l(x(Yt),{"items-per-page":R.value,"onUpdate:itemsPerPage":d[7]||(d[7]=U=>R.value=U),headers:m.headers,"items-length":P.value,items:m.items,"item-value":"LayoutItemUUID",loading:r.value,search:ae.value,"sort-by":N.value,"onUpdate:options":Re},ke({top:u(()=>[l(ce,null,{default:u(()=>[l(Ae,null,{default:u(()=>[l(J,null,{default:u(()=>[l(Te,{modelValue:ne.value,"onUpdate:modelValue":d[2]||(d[2]=U=>ne.value=U),label:"Search by Badge",onInput:d[3]||(d[3]=U=>ae.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),l(J,null,{default:u(()=>[l(Te,{modelValue:g.value,"onUpdate:modelValue":d[4]||(d[4]=U=>g.value=U),label:"Search By Email",onInput:d[5]||(d[5]=U=>ae.value=Date.now().toString())},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:2},[B(m.headers,U=>({name:`item.${U.key}`,fn:u(({item:z})=>[l(Aa,{header:U,item:z,accommodations:O.value,convention:c.value,extras:H.value,interests:ie.value,tickets:oe.value,venues:Q.value,onReload:d[6]||(d[6]=w=>Re({page:y.value,itemsPerPage:R.value,sortBy:j.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading","search","sort-by"])]),_:2},1024)):Y("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),te.value?(i(),h(Ht,{key:0,title:"Edit Layout",modelValue:te.value,"onUpdate:modelValue":d[9]||(d[9]=m=>te.value=m),layout:f.value,onSave:d[10]||(d[10]=m=>{te.value=!1,W()})},null,8,["modelValue","layout"])):Y("",!0)]),_:1}))}});export{Ha as default};
