import{p as bt,n as kt,e as ue,t as ge,c as Nt,G as Lt,v as t,H as k,x as je,I as ie,a0 as Ee,a1 as Be,r as T,K as ve,M as i,N as H,O as o,a3 as fe,W as q,a2 as ze,a4 as Z,S as j,w as oe,X as M,Q as F,V as I,P as Y,_ as Ye,ab as Ft,E as at,k as Pt,f as wt,d as $t,o as Gt,ac as ot,Y as vt,Z as _t,a6 as Bt,a5 as Yt}from"./index-f0a97a90.js";import{e as Ht,T as xt,d as qt,V as jt,c as Qt}from"./FormRenderer.vue_vue_type_style_index_0_lang-8c605192.js";import{a as Kt,F as Ae}from"./form-29fd1dbb.js";import{_ as He}from"./ModelDialog.vue_vue_type_script_setup_true_lang-2a57bc59.js";import{m as zt,k as Wt,l as Jt,n as Xt,o as Zt,p as ea,q as ta,u as aa,r as oa,s as na,t as la,v as ia,w as sa,x as ra,y as ua,z as nt,A as lt,B as it,a as da,_ as ma,f as st,c as Ut,d as At,e as Tt,b as Et,V as ft,g as ca,h as va,i as _a,j as Ua}from"./VWindowItem-08b14ad7.js";import{V as ee,a as P}from"./VRow-ca9bb35d.js";import{V as Te}from"./VTextField-2466fbcd.js";import{V as ne}from"./copyToClipboard-20ce67c2.js";import{u as Aa,j as Ce,V as Ta}from"./VContainer-3e80b7db.js";import{V as Ea,u as Je}from"./VCheckbox-895aecb9.js";import{v as Me}from"./v4-a960c1f4.js";import{h as $e,b as fa,a as Sa,c as Da,d as Ia,P as St,u as Dt}from"./useDisplayTransactions-d077a5b4.js";import{V as Ge,a as Le}from"./VList-a2e553a4.js";import{V as le}from"./VBtn-1729b9b7.js";import{b as It,c as rt}from"./submission-2c955912.js";import{V as pa}from"./forwardRefs-89164f1c.js";import{V as Ra}from"./VAvatar-b49abec4.js";import{V as pt,a as ya}from"./VToolbar-e7cefacb.js";import{V as Xe,a as ga}from"./scopeId-354efbe1.js";import{c as Oa,e as Rt,V as Ca}from"./VCard-5b240c90.js";import{V as ha}from"./VDialog-07c6c7be.js";import{s as Ma}from"./sortSubmissions-8ed80f07.js";import{_ as We}from"./SaveButton.vue_vue_type_script_setup_true_lang-8887f2b0.js";import{u as Qe}from"./nil-d01db1aa.js";import{V as ut,a as Va}from"./VTable-10518b92.js";import"./index-26b71cef.js";import"./VTextarea-394f802a.js";import"./VChip-25871777.js";import"./userData-f254c1f8.js";import"./VForm-925fd5d3.js";import"./VToolbarItems-f52d88d8.js";import"./VDivider-11e4f33d.js";import"./createSimpleFunctional-a66bdf83.js";var yt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(yt||{});const ba=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Fe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Fe||{});const ka=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const Na=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var X=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(X||{});const La=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Fa=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Send Error"}return"Unknown"},Pa=bt({itemsLength:{type:[Number,String],required:!0},...zt(),...Wt(),...Jt()},"VDataTableServer"),wa=kt()({name:"VDataTableServer",props:Pa(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,D)=>!0},setup(e,D){let{emit:s,slots:l}=D;const{groupBy:n}=Xt(e),{sortBy:r,multiSort:m,mustSort:d}=Zt(e),{page:A,itemsPerPage:f}=ea(e),v=ue(()=>parseInt(e.itemsLength,10)),{columns:a,headers:u}=ta(e,{groupBy:n,showSelect:ge(e,"showSelect"),showExpand:ge(e,"showExpand")}),{items:E}=aa(e,a),{toggleSort:_}=oa({sortBy:r,multiSort:m,mustSort:d,page:A}),{opened:b,isGroupOpen:U,toggleGroup:O,extractRows:y}=na({groupBy:n,sortBy:r}),{pageCount:G,setItemsPerPage:K}=la({page:A,itemsPerPage:f,itemsLength:v}),{flatItems:se}=ia(E,n,b),{isSelected:Se,select:De,selectAll:C,toggleSelect:h,someSelected:N,allSelected:R}=sa(e,{allItems:E,currentPage:E}),{isExpanded:$,toggleExpand:W}=ra(e),te=ue(()=>y(E.value));ua({page:A,itemsPerPage:f,sortBy:r,groupBy:n,search:ge(e,"search")}),Nt("v-data-table",{toggleSort:_,sortBy:r}),Lt({VDataTableRows:{hideNoData:ge(e,"hideNoData"),noDataText:ge(e,"noDataText"),loading:ge(e,"loading"),loadingText:ge(e,"loadingText")}});const z=ue(()=>({page:A.value,itemsPerPage:f.value,sortBy:r.value,pageCount:G.value,toggleSort:_,setItemsPerPage:K,someSelected:N.value,allSelected:R.value,isSelected:Se,select:De,selectAll:C,toggleSelect:h,isExpanded:$,toggleExpand:W,isGroupOpen:U,toggleGroup:O,items:te.value,groupedItems:se.value,columns:a.value,headers:u.value}));Aa(()=>{const[de]=nt.filterProps(e),[re]=lt.filterProps(e),[Ie]=it.filterProps(e),[pe]=ut.filterProps(e);return t(ut,je({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},pe),{top:()=>{var Re;return(Re=l.top)==null?void 0:Re.call(l,z.value)},default:()=>{var Re,Ve,be,Pe;return l.default?l.default(z.value):t(k,null,[(Re=l.colgroup)==null?void 0:Re.call(l,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(lt,je(re,{sticky:e.fixedHeader}),l)]),(Ve=l.thead)==null?void 0:Ve.call(l,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(z.value):t(it,je(Ie,{items:se.value}),l)]),(be=l.tbody)==null?void 0:be.call(l,z.value),(Pe=l.tfoot)==null?void 0:Pe.call(l,z.value)])},bottom:()=>l.bottom?l.bottom(z.value):t(nt,de,{prepend:l["footer.prepend"]})})})}}),$a=ie({__name:"EditAdminLayout",props:Ee({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["save"],["update:modelValue"]),setup(e,{emit:D}){const s=Be(e,"modelValue"),l=T(ve(e.layout)),n=T([]),r=fe(),m=({callback:v})=>{const a=()=>{v&&v("Failed to Save Layout")},u=()=>{v&&v("Layout Saved")};r.saveAdminLayout(l.value).then(E=>{E?(u(),D("save",E)):a()}).catch(()=>{a()})},d=()=>({ID:0,LayoutPanelUUID:Me(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:Ae.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),A=v=>()=>({ID:0,LayoutItemUUID:Me(),LayoutPanelID:v.ID,LayoutPanelUUID:v.LayoutPanelUUID,Label:"",SourceType:Fe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:v.Items.length+1,DefaultSort:!1}),f=v=>{const a=n.value.find(u=>u.value===v.SectionFieldUUID);a&&(v.SectionFieldID=a.object.ID,v.SectionField=a.object)};return r.getConventionForms(e.layout.ConventionUUID).then(v=>{v.forEach(a=>a.Sections.forEach(u=>u.Fields&&n.value.push(...u.Fields.map(E=>{var b;return{title:`${a.Name} - ${u.Name} - ${(b=E.Field)==null?void 0:b.Name}`,value:E.SectionFieldUUID,object:E}})))),n.value.sort(Ht("title"))}),(v,a)=>(i(),H(He,{modelValue:s.value,"onUpdate:modelValue":a[3]||(a[3]=u=>s.value=u),onSave:m,title:v.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:l.value.Name,"onUpdate:modelValue":a[0]||(a[0]=u=>l.value.Name=u),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:l.value.Type,"onUpdate:modelValue":a[1]||(a[1]=u=>l.value.Type=u),label:"Layout Type",items:q(ba),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(st,{modelValue:l.value.Panels,"onUpdate:modelValue":a[2]||(a[2]=u=>l.value.Panels=u),"new-item":d,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ze({_:2},[Z(l.value.Panels,(u,E)=>({name:`panel_${E}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:u.Name,"onUpdate:modelValue":_=>u.Name=_,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:u.RequiredFormType,"onUpdate:modelValue":_=>u.RequiredFormType=_,items:q(Kt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(da,{label:"Required Groups",variant:"outlined",modelValue:u.RequiredGroupMemberships,"onUpdate:modelValue":_=>u.RequiredGroupMemberships=_,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ma,{label:"Registration Tags",variant:"outlined",modelValue:u.RequiredRegistrationTags,"onUpdate:modelValue":_=>u.RequiredRegistrationTags=_,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(st,{modelValue:u.Items,"onUpdate:modelValue":_=>u.Items=_,"new-item":A(u),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ze({_:2},[Z(u.Items,(_,b)=>({name:`item_${b}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:_.Label,"onUpdate:modelValue":U=>_.Label=U,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:_.SourceType,"onUpdate:modelValue":U=>_.SourceType=U,label:"Source Type",items:q(ka),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[_.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),H(ne,{key:0,modelValue:_.SectionFieldUUID,"onUpdate:modelValue":U=>_.SectionFieldUUID=U,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:U=>f(_)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):_.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),H(ne,{key:1,modelValue:_.MetaField,"onUpdate:modelValue":U=>_.MetaField=U,label:"Miscellaneous Data",items:q(Na),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):_.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),H(ne,{key:2,modelValue:_.UserField,"onUpdate:modelValue":U=>_.UserField=U,label:"User Profile Data",items:q(La),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):j("",!0)]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(Ea,{modelValue:_.DefaultSort,"onUpdate:modelValue":U=>_.DefaultSort=U,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ga=M("br",null,null,-1),Ba=M("h3",null,"Assigned Accommodation",-1),Ya=M("br",null,null,-1),Ha=M("br",null,null,-1),xa=M("h3",null,"Accommodation Preferences",-1),qa=M("h3",null,"Selected Tickets",-1),ja=M("br",null,null,-1),Qa=ie({__name:"EditAccommodationAssignmentDialog",props:Ee({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:field"],["update:modelValue"]),setup(e,{emit:D}){const s=e,{convention:l,registration:n,title:r=""}=s,m=fe(),d=Be(e,"modelValue"),A=T({capacity:{max:C=>{var R;const h=G.value.find($=>$.room.RoomUUID===C);return!h||h.room.MaximumCapacity===0?!0:(((R=u.value)==null?void 0:R.Members.length)||0)<=h.room.MaximumCapacity||"Too many people in the group for this room"},min:C=>{var R;const h=G.value.find($=>$.room.RoomUUID===C);return!h||h.room.MinimumCapacity===0?!0:(((R=u.value)==null?void 0:R.Members.length)||0)>=h.room.MinimumCapacity||"Not enough people in the group for this room"}}}),f=T([]),v=Je(s,D,void 0,void 0,"field"),a=T(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const u=T(),E=T(""),_=T(""),b=T([]),U=T({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),O=async()=>{var R;const C=await m.getConventionAvailableAccommodation(l.ConventionUUID);C&&(f.value=C);const h=await m.getRegistrationGroup(n.RegistrationUUID||"");h&&(u.value=h);const N=await m.getConventionTickets(l.ConventionUUID);N&&(b.value=N);try{U.value=JSON.parse(((R=u.value)==null?void 0:R.TicketData)||"")}catch{}};oe(E,()=>{_.value=G.value.length>0?G.value[0].value:""});const y=ue(()=>{const C=K.value;return f.value.map(h=>{let N;return C.forEach(R=>{h.Costs.forEach($=>{$.DateStart===(R==null?void 0:R.DateStart)&&$.DateEnd===R.DateEnd&&(N===void 0||N>$.Availability)&&(N=$.Availability)})}),{label:`${h.Name}`,title:`${h.Name} (${N} Available)`,value:h.AccommodationUUID}})}),G=ue(()=>{const C=K.value,h=f.value.find(N=>N.AccommodationUUID===E.value);return(h==null?void 0:h.Pool.map(N=>{var $,W;let R;return C.forEach(te=>{N.Costs.forEach(z=>{z.DateStart===(te==null?void 0:te.DateStart)&&z.DateEnd===te.DateEnd&&(R===void 0||R>z.Availability)&&(R=z.Availability)})}),{label:`${($=N.Venue)==null?void 0:$.Name} - ${N.Name}`,title:`${(W=N.Venue)==null?void 0:W.Name} - ${N.Name} (${R} Available)`,value:N.RoomUUID,room:N}}))||[]}),K=ue(()=>[...U.value.Ticket,...U.value.AddonsChecked,...U.value.ComponentsChecked].map(C=>b.value.find(h=>h.TicketUUID===C)).filter(C=>C!==void 0&&C.RequiresAccommodation)),se=C=>{var h;m.assignAccommodation(((h=u.value)==null?void 0:h.Registration.RegistrationUUID)||"",E.value,_.value,!1).then(N=>{N?(O(),C&&C("Room Assigned")):C&&C("Room not assigned")}).catch(()=>{C&&C("Room not assigned")})},Se=C=>{var h,N;(h=u.value)!=null&&h.Registration.AllocationUUID?m.deleteAllocation(((N=u.value)==null?void 0:N.Registration.AllocationUUID)||"").then(R=>{R?(O(),C&&C("Allocation Deleted")):C&&C("Allocation not deleted")}).catch(()=>{C&&C("Allocation not deleted")}):C&&C("Nothing to Delete")},De=C=>{var N,R;const h=(N=f.value.find($=>$.AccommodationUUID===C.AccommodationUUID))==null?void 0:N.Pool;if(h){const $=h.find(W=>W.RoomUUID===C.RoomUUID);if($)return`${(R=$.Venue)==null?void 0:R.Name} - ${$.Name}`}return""};return O(),(C,h)=>{var N;return i(),H(He,{modelValue:d.value,"onUpdate:modelValue":h[2]||(h[2]=R=>d.value=R),title:q(r),color:"primary","show-close-action":!0,"show-delete-action":!!((N=u.value)!=null&&N.Registration.Allocation),"show-save-action":!!_.value,"save-button-label":"Assign Room",onDelete:Se,onSave:se,fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"pa-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>{var R;return[t(P,{cols:"12",md:"6"},{default:o(()=>{var $,W;return[M("h3",null,"Group Members ("+F(($=u.value)==null?void 0:$.Members.length)+")",1),(i(!0),I(k,null,Z((W=u.value)==null?void 0:W.Members,te=>(i(),I(k,{key:te.UUID},[Y(" #"+F(te.Reference)+" "+F(te.Name),1),Ga],64))),128))]}),_:1}),(R=u.value)!=null&&R.Registration.Allocation?(i(),H(P,{key:0,cols:"12",md:"6"},{default:o(()=>[Ba,t(Ge,null,{default:o(()=>{var $;return[(i(!0),I(k,null,Z(($=u.value)==null?void 0:$.Registration.Allocation.Periods,W=>(i(),H(Le,{key:W.AllocationPeriodUUID},{default:o(()=>{var te;return[Y(F((te=f.value.find(z=>z.AccommodationUUID===W.AccommodationUUID))==null?void 0:te.Name)+" ",1),Ya,Y(" "+F(De(W))+" ",1),Ha,M("small",null,"("+F(q($e)(W.DateStart))+" - "+F(q($e)(W.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):j("",!0)]}),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",md:"6"},{default:o(()=>[C.selectedAccommodation.length?(i(),I(k,{key:0},[xa,t(Ge,null,{default:o(()=>[(i(!0),I(k,null,Z(C.selectedAccommodation,(R,$)=>(i(),H(Le,{key:R.AccommodationUUID},{default:o(()=>[Y(F($+1)+". "+F(R.Name),1)]),_:2},1024))),128))]),_:1})],64)):j("",!0)]),_:1}),t(P,{cosl:"12",md:"6"},{default:o(()=>[qa,t(Ge,null,{default:o(()=>[(i(!0),I(k,null,Z(K.value,R=>(i(),H(Le,{key:R==null?void 0:R.TicketUUID},{default:o(()=>[Y(F(R.Name)+" ",1),ja,M("small",null,"("+F(q($e)(R.DateStart))+" - "+F(q($e)(R.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",md:"6"},{default:o(()=>[t(ne,{modelValue:E.value,"onUpdate:modelValue":h[0]||(h[0]=R=>E.value=R),items:y.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(P,{cols:"12",md:"6"},{default:o(()=>[t(ne,{modelValue:_.value,"onUpdate:modelValue":h[1]||(h[1]=R=>_.value=R),items:G.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[A.value.capacity.min,A.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Ka={key:0,class:"accommodationList"},za={key:0,class:"text-orange-darken-2"},Wa=ie({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const D=T(!1),s=ue(()=>{if(!e.value)return[];const n=JSON.parse(e.value),r=e.accommodations.filter(m=>n.includes(m.AccommodationUUID)).sort((m,d)=>{const A=n.findIndex(v=>v===m.AccommodationUUID),f=n.findIndex(v=>v===d.AccommodationUUID);return A>f?1:-1});return ve(r)}),l=ue(()=>{let n;const r=e.forms.find(m=>m.Sections.find(d=>{var A;return(A=d.Fields)==null?void 0:A.find(f=>{var v;if(((v=f.Field)==null?void 0:v.Type)==="TICKET")return n=f,!0})}));return n?!!e.registration.Submissions.find(m=>{if(m.FormUUID==(r==null?void 0:r.FormUUID))return m.Data.find(d=>{if(d.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const A=JSON.parse(d.Data);return e.tickets.filter(f=>f.RequiresAccommodation).find(f=>A.Ticket.includes(f.TicketUUID)||A.AddonsChecked.includes(f.TicketUUID)||A.ComponentsChecked.includes(f.TicketUUID))}})}):!1});return(n,r)=>l.value?(i(),I(k,{key:0},[n.value?(i(),I("ol",Ka,[(i(!0),I(k,null,Z(s.value,m=>(i(),I("li",{key:m.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(d=>d.AccommodationUUID===m.AccommodationUUID)?(i(),I("strong",za,F(m.Name),1)):(i(),I(k,{key:1},[Y(F(m.Name),1)],64))]))),128))])):j("",!0),t(le,{onClick:r[0]||(r[0]=m=>D.value=!0),variant:"flat",color:"success"},{default:o(()=>[Y("Assign Accommodation")]),_:1}),n.convention&&D.value?(i(),H(Qa,{key:1,modelValue:D.value,"onUpdate:modelValue":r[1]||(r[1]=m=>D.value=m),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":s.value},null,8,["modelValue","convention","registration","selected-accommodation"])):j("",!0)],64)):j("",!0)}});const Ja=Ye(Wa,[["__scopeId","data-v-7a102d46"]]),Xa={key:0,class:"addonList"},Za={key:0},eo={key:0},to=ie({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const D=ue(()=>{if(!e.value)return;const s=JSON.parse(e.value),l=Object.keys(s),n=ve(e.extras);return n.forEach(r=>{r.Options=r.Options.filter(m=>l.includes(m.OptionUUID)?(m.Choices=m.Choices.filter(d=>d.TagUUID===s[m.OptionUUID].choiceId),s[m.OptionUUID].checked):!1)}),n.filter(r=>r.Options.length>0),n});return(s,l)=>s.value?(i(),I("ul",Xa,[(i(!0),I(k,null,Z(D.value,n=>(i(),I(k,{key:n.ExtraUUID},[n.Options.length?(i(),I("li",Za,[M("strong",null,F(n.Name),1),M("ul",null,[(i(!0),I(k,null,Z(n.Options,r=>(i(),I("li",{key:r.OptionUUID},[Y(F(r.Name)+" ",1),r.Choices.length==1?(i(),I("small",eo,"("+F(r.Choices[0].Title)+")",1)):j("",!0)]))),128))])])):j("",!0)],64))),128))])):j("",!0)}});const ao=Ye(to,[["__scopeId","data-v-55786e01"]]),oo={key:0},no=ie({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const D=ue(()=>{if(!e.value)return;const s=JSON.parse(e.value);return Object.entries(s).filter(([,l])=>l).map(([l,n])=>e.interests.find(r=>r.InterestUUID===l)).filter(l=>l!==void 0)});return(s,l)=>s.value?(i(),I("ul",oo,[(i(!0),I(k,null,Z(D.value,n=>(i(),I("li",{key:n.InterestUUID},F(n.Name),1))),128))])):j("",!0)}}),lo=M("br",null,null,-1),io=M("small",null,"Options:",-1),so=M("br",null,null,-1),ro=M("small",null,"Addons:",-1),uo=ie({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const D=ue(()=>{if(!e.value)return;let s={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{s=JSON.parse(e.value),"ticket"in s&&(s.Ticket=s.ticket),"addonsChecked"in s&&(s.AddonsChecked=s.addonsChecked),"componentsChecked"in s&&(s.ComponentsChecked=s.componentsChecked)}catch{}return s.Ticket.filter(l=>{const n=e.tickets.find(r=>r.TicketUUID===l);return!(!n||n.Type!==xt.TICKET_TYPE_TICKET)}).map(l=>{const n=e.tickets.find(m=>m.TicketUUID===l),r=ve(n);return r.TicketComponents=n.TicketComponents.filter(m=>s.ComponentsChecked.includes(m.TicketUUID)),r.AddonTickets=n.AddonTickets.filter(m=>s.AddonsChecked.includes(m.TicketUUID)),r})});return(s,l)=>s.value?(i(!0),I(k,{key:0},Z(D.value,n=>(i(),I("div",{key:n.TicketUUID},[M("strong",null,F(n.Name),1),n.TicketComponents.length>0?(i(),I(k,{key:0},[lo,io,Y("  "),(i(!0),I(k,null,Z(n.TicketComponents,r=>(i(),I(k,{key:r.TicketUUID},[M("small",null,F(r.Name),1),Y("  ")],64))),128))],64)):j("",!0),n.AddonTickets.length>0?(i(),I(k,{key:1},[so,ro,Y("  "),(i(!0),I(k,null,Z(n.AddonTickets,r=>(i(),I("small",{key:r.TicketUUID},[Y("("),M("em",null,F(r.Name),1),Y(")")]))),128))],64)):j("",!0)]))),128)):j("",!0)}}),mo={key:0,class:"text-blue text-center"},co={key:1,class:"text-red text-center"},vo={key:2,class:"text-orange text-center"},_o={key:3,class:"text-orange text-center"},Uo={key:4,class:"text-orange text-center"},Ao={key:5,class:"text-orange text-center"},To={key:6,class:"text-green text-center"},Eo={key:0},fo={key:0},So=M("strong",null,"Total:",-1),Do=ie({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload"],setup(e,{emit:D}){const s=fe(),l=T(),n=T(),r=T(),m=T(),d=T(!1),A=(a,u,E)=>{n.value=a,s.getRegistrationGroup(E.RegistrationUUID||"").then(_=>{r.value=_,l.value=u,m.value=E,d.value=!0})},f=a=>{D("openActions",a)},v=a=>{D("openPayments",a)};return(a,u)=>(i(),I(k,null,[a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(i(),H(Ja,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(i(),H(ao,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(i(),H(no,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(i(),H(uo,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(i(!0),I(k,{key:4},Z(a.item.raw[a.header.key],E=>(i(),I("ul",{key:E.Heading},[M("li",null,[M("strong",null,F(E.Heading)+":",1),Y(" "+F(q(It)(E.Submission.Status))+" ",1),t(le,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:_=>A(E.Registration,E.Form,E.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),H(Ra,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(i(),I(k,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(i(),I("div",mo,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(i(),I("div",co,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(i(),I("div",vo,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(i(),I("div",_o,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(i(),I("div",Uo,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(i(),I("div",Ao,"Awaiting Additional Payments")):(i(),I("div",To,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(i(),I(k,{key:7},[t(le,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:u[0]||(u[0]=E=>f(a.item.raw[a.header.key]))}),t(le,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:u[1]||(u[1]=E=>v(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(i(),I(k,{key:8},[a.item.raw[a.header.key].length===1?(i(),I("em",Eo," Not in a group ")):(i(),I(k,{key:1},[M("ul",null,[(i(!0),I(k,null,Z(a.item.raw[a.header.key],E=>(i(),I("li",{key:E.UUID,class:"ml-0"},[Y(" #"+F(E.Reference)+" : "+F(E.Name)+" ",1),E.IsLeader?(i(),I("strong",fo,"(Leader)")):j("",!0)]))),128))]),So,Y(" "+F(a.item.raw[a.header.key].length),1)],64))],64)):(i(),I(k,{key:9},[Y(F(a.item.raw[a.header.key]),1)],64)),d.value&&m.value&&l.value?(i(),H(ha,{key:10,modelValue:d.value,"onUpdate:modelValue":u[5]||(u[5]=E=>d.value=E),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(Rt,{class:"bg-red-darken-4"},{default:o(()=>[t(pt,{color:"error"},{default:o(()=>[t(ya,null,{default:o(()=>[Y("Submission Editor - Admin Mode")]),_:1}),t(Xe),t(pa,null,{default:o(()=>[t(le,{icon:"mdi:mdi-window-close",onClick:u[2]||(u[2]=E=>d.value=!1)})]),_:1})]),_:1}),t(Oa,null,{default:o(()=>[t(qt,{modelValue:l.value,"onUpdate:modelValue":u[3]||(u[3]=E=>l.value=E),admin:!0,convention:a.convention,data:m.value,editable:!0,"registration-group":r.value,onClose:u[4]||(u[4]=E=>{d.value=!1,D("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0)],64))}});var Io=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],po=function(e){return Io.map(function(D){return D.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Ro=function(e,D,s){Object.keys(D).filter(po).forEach(function(l){var n=D[l];typeof n=="function"&&(l==="onInit"?n(e,s):s.on(l.substring(2),function(r){return n(r,s)}))})},yo=function(e,D,s,l){var n=e.modelEvents?e.modelEvents:null,r=Array.isArray(n)?n.join(" "):n;oe(l,function(m,d){s&&typeof m=="string"&&m!==d&&m!==s.getContent({format:e.outputFormat})&&s.setContent(m)}),s.on(r||"change input undo redo",function(){D.emit("update:modelValue",s.getContent({format:e.outputFormat}))})},go=function(e,D,s,l,n,r){l.setContent(r()),s.attrs["onUpdate:modelValue"]&&yo(D,s,l,n),Ro(e,s.attrs,l)},dt=0,gt=function(e){var D=Date.now(),s=Math.floor(Math.random()*1e9);return dt++,e+"_"+s+dt+String(D)},Oo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},mt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Co=function(e,D){return mt(e).concat(mt(D))},ho=function(e){return e==null},ct=function(){return{listeners:[],scriptId:gt("tiny-script"),scriptLoaded:!1}},Mo=function(){var e=ct(),D=function(n,r,m,d){var A=r.createElement("script");A.referrerPolicy="origin",A.type="application/javascript",A.id=n,A.src=m;var f=function(){A.removeEventListener("load",f),d()};A.addEventListener("load",f),r.head&&r.head.appendChild(A)},s=function(n,r,m){e.scriptLoaded?m():(e.listeners.push(m),n.getElementById(e.scriptId)||D(e.scriptId,n,r,function(){e.listeners.forEach(function(d){return d()}),e.scriptLoaded=!0}))},l=function(){e=ct()};return{load:s,reinitialize:l}},Vo=Mo(),bo=function(){return typeof window<"u"?window:global},Oe=function(){var e=bo();return e&&e.tinymce?e.tinymce:null},ko={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},ce=globalThis&&globalThis.__assign||function(){return ce=Object.assign||function(e){for(var D,s=1,l=arguments.length;s<l;s++){D=arguments[s];for(var n in D)Object.prototype.hasOwnProperty.call(D,n)&&(e[n]=D[n])}return e},ce.apply(this,arguments)},No=function(e,D,s,l){return e(l||"div",{id:D,ref:s})},Lo=function(e,D,s){return e("textarea",{id:D,visibility:"hidden",ref:s})},Ke={selector:void 0,target:void 0},Fo=ie({props:ko,setup:function(e,D){var s=e.init?ce(ce({},e.init),Ke):ce({},Ke),l=Ft(e),n=l.disabled,r=l.modelValue,m=l.tagName,d=T(null),A=null,f=e.id||gt("tiny-vue"),v=e.init&&e.init.inline||e.inline,a=!!D.attrs["onUpdate:modelValue"],u=!0,E=e.initialValue?e.initialValue:"",_="",b=function(y){return a?function(){return r!=null&&r.value?r.value:""}:function(){return y?E:_}},U=function(){var y=b(u),G=ce(ce({},s),{readonly:e.disabled,target:d.value,plugins:Co(s.plugins,e.plugins),toolbar:e.toolbar||s.toolbar,inline:v,setup:function(K){A=K,K.on("init",function(se){return go(se,e,D,K,r,y)}),typeof s.setup=="function"&&s.setup(K)}});Oo(d.value)&&(d.value.style.visibility=""),Oe().init(G),u=!1};oe(n,function(y){var G;A!==null&&(typeof((G=A.mode)===null||G===void 0?void 0:G.set)=="function"?A.mode.set(y?"readonly":"design"):A.setMode(y?"readonly":"design"))}),oe(m,function(y){var G;a||(_=A.getContent()),(G=Oe())===null||G===void 0||G.remove(A),at(function(){return U()})}),Pt(function(){if(Oe()!==null)U();else if(d.value&&d.value.ownerDocument){var y=e.cloudChannel?e.cloudChannel:"6",G=e.apiKey?e.apiKey:"no-api-key",K=ho(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(G,"/tinymce/").concat(y,"/tinymce.min.js"):e.tinymceScriptSrc;Vo.load(d.value.ownerDocument,K,U)}}),wt(function(){Oe()!==null&&Oe().remove(A)}),v||($t(function(){u||U()}),Gt(function(){var y;a||(_=A.getContent()),(y=Oe())===null||y===void 0||y.remove(A)}));var O=function(y){var G;_=A.getContent(),(G=Oe())===null||G===void 0||G.remove(A),s=ce(ce(ce({},s),y),Ke),at(function(){return U()})};return D.expose({rerender:O,getEditor:function(){return A}}),function(){return v?No(ot,f,d,e.tagName):Lo(ot,f,d)}}});const Po=["colspan"],wo=M("strong",null,"E-Mail Content",-1),$o=["innerHTML"],Ot=ie({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:D}){const s=fe(),l=T([]),n=T({From:"",Subject:"",HTML:""}),r=T(""),m=T(""),d=T(""),A=T(!1),f=T([]),v=T([]),a=T([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]);oe(n,b=>{d.value=b.From||d.value||"",m.value=b.Subject||m.value||"",r.value=b.HTML||r.value||""});const u=()=>{s.getRegistrationEmails(e.registration.RegistrationUUID).then(b=>{b&&(b.forEach(U=>{U.CreatedAt=fa(new Date(U.CreatedAt||"")),U.Status=Fa(U.Status),U.User||(U.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),v.value=b)})};u(),(()=>{s.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(b=>{b&&(l.value=b)})})();const _=({callback:b})=>{s.sendRegistrationEmail(e.registration.RegistrationUUID,d.value,m.value,r.value).then(U=>{U?b&&(b("Email Sent"),u(),setTimeout(()=>{A.value=!1},2e3)):b&&b("Not sent")}).catch(()=>{b&&b("Not sent")})};return(b,U)=>(i(),I(k,null,[b.showEditor?(i(),I(k,{key:0},[t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(jt,{items:l.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":U[0]||(U[0]=O=>n.value=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12"},{default:o(()=>[t(Te,{modelValue:d.value,"onUpdate:modelValue":U[1]||(U[1]=O=>d.value=O),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12"},{default:o(()=>[t(Te,{modelValue:m.value,"onUpdate:modelValue":U[2]||(U[2]=O=>m.value=O),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12"},{default:o(()=>[t(q(Fo),{modelValue:r.value,"onUpdate:modelValue":U[3]||(U[3]=O=>r.value=O),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(We,{onClick:U[4]||(U[4]=O=>D("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(P,{class:"text-right"},{default:o(()=>[t(We,{onClick:_,label:"Send",color:"error"})]),_:1})]),_:1})],64)):j("",!0),v.value.length&&!b.hideHistory?(i(),H(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[Y(" Email History ")]),_:1}),t(At,null,{default:o(()=>[t(q(Tt),{items:v.value,headers:a.value,"show-expand":!0,"item-value":"EmailUUID",expanded:f.value,"onUpdate:expanded":U[5]||(U[5]=O=>f.value=O)},{"expanded-row":o(({columns:O,item:y})=>[M("tr",null,[M("td",{colspan:O.length},[wo,M("div",{class:"communicationsViewEmailPreview",innerHTML:y.raw.HTML},null,8,$o)],8,Po)])]),"footer.prepend":o(()=>[t(le,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:u},{default:o(()=>[Y("Refresh")]),_:1})]),_:1},8,["items","headers","expanded"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const Go=e=>(vt("data-v-0de55890"),e=e(),_t(),e),Bo=["colspan"],Yo=Go(()=>M("strong",null,"Details",-1)),Ho=["innerHTML"],xo=ie({__name:"PaymentTransactions",props:{hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:D}){const s=e;let{hideHistory:l=!1,registration:n,showEditor:r}=s;const m=fe(),d=T([]),A=T([]),f=T([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"}]),v=()=>({PaymentTransactionUUID:Me(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:Ia.PAYMENT_TRANSACTION_SOURCE_NULL,Type:St.PAYMENT_TRANSACTION_TYPE_NULL}),a=T(v()),{convertTransactions:u,getPaymentTransactionsDisplay:E}=Dt();oe(s,()=>{l=s.hideHistory,n=s.registration,r=s.showEditor,E(n.RegistrationUUID).then(U=>{A.value=U})});const _=()=>{E(n.RegistrationUUID).then(U=>{A.value=U})};_();const b=()=>{m.saveRegistrationPaymentTransaction(a.value).then(U=>{U&&(u(U.PaymentTransactions),a.value=v(),D("close-editor"),D("change"))})};return(U,O)=>(i(),I(k,null,[q(r)?(i(),I(k,{key:0},[t(Ca,null,{default:o(()=>[Y(" Add Transaction ")]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{items:q(Sa),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:a.value.Type,"onUpdate:modelValue":O[0]||(O[0]=y=>a.value.Type=y),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{items:q(Da),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:a.value.Source,"onUpdate:modelValue":O[1]||(O[1]=y=>a.value.Source=y),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(Te,{label:"Description","hide-details":"",modelValue:a.value.Description,"onUpdate:modelValue":O[2]||(O[2]=y=>a.value.Description=y),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(Te,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:a.value.Amount,"onUpdate:modelValue":O[3]||(O[3]=y=>a.value.Amount=y),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(le,{class:"w-100",onClick:O[4]||(O[4]=y=>D("close-editor")),color:"warning"},{default:o(()=>[Y("Cancel")]),_:1})]),_:1}),t(Xe),t(P,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(le,{class:"w-100",onClick:b,color:"primary"},{default:o(()=>[Y("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):j("",!0),A.value.length&&!q(l)?(i(),H(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[Y(" Transaction History ")]),_:1}),t(At,null,{default:o(()=>[t(q(Tt),{items:A.value,headers:f.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:d.value,"onUpdate:expanded":O[5]||(O[5]=y=>d.value=y)},{"expanded-row":o(({columns:y,item:G})=>[M("tr",null,[M("td",{colspan:y.length},[Yo,M("div",{innerHTML:G.raw.HTML},null,8,Ho)],8,Bo)])]),"footer.prepend":o(()=>[t(le,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:_},{default:o(()=>[Y("Refresh")]),_:1})]),_:1},8,["items","headers","expanded"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const qo=Ye(xo,[["__scopeId","data-v-0de55890"]]),xe=e=>(vt("data-v-d8ffe9ea"),e=e(),_t(),e),jo={class:"v-row"},Qo={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Ko={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},zo={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},Wo={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},Jo=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),Xo={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Zo=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),en={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},tn=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),an={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},on=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),nn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},ln=ie({__name:"PaymentActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:D}){const s=e,l=Be(e,"modelValue"),{registration:n}=s,r=T(!1),m=T(!1),d=T(),A=T([]),f=T(new Date().getTime()),v=Je(s,D,void 0,void 0,"registration"),a=T(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const u=fe(),E=()=>{u.generateRegistrationCharges(n.RegistrationUUID,!1).then(U=>{U&&(A.value=U.PaymentTransactions,d.value=U.Registration,f.value=new Date().getTime())}).catch(()=>{})};E();const _=()=>{u.generateRegistrationCharges(n.RegistrationUUID,!0).then(U=>{U&&(A.value=U.PaymentTransactions,d.value=U.Registration,f.value=new Date().getTime())})},{totalCharges:b}=Dt();return(U,O)=>(i(),H(He,{modelValue:l.value,"onUpdate:modelValue":O[3]||(O[3]=y=>l.value=y),title:U.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[d.value?(i(),I(k,{key:0},[M("dl",jo,[(i(!0),I(k,null,Z(A.value,y=>(i(),I(k,{key:y.PaymentTransactionUUID},[y.Type===q(St).PAYMENT_TRANSACTION_TYPE_CHARGE?(i(),I("dt",Qo,[M("div",Ko,F(y.Description.split(":")[0])+": ",1),M("div",zo,F(y.Description.split(":")[1]),1)])):j("",!0),M("dd",Wo," £"+F(y.Amount),1)],64))),128)),Jo,M("dd",Xo," £"+F(q(b)(A.value)),1),Zo,M("dd",en," £"+F(d.value.Total),1),tn,M("dd",an," £"+F(d.value.Paid),1),on,M("dd",nn," £"+F(d.value.Total-d.value.Paid),1)]),t(ee,{class:"flex-row-reverse"},{default:o(()=>[t(P,{class:"text-right"},{default:o(()=>[t(le,{color:"primary",onClick:_},{default:o(()=>[Y("Apply Charges")]),_:1})]),_:1}),m.value?j("",!0):(i(),H(P,{key:0},{default:o(()=>[t(le,{color:"secondary",onClick:O[0]||(O[0]=y=>m.value=!0)},{default:o(()=>[Y("Transaction Entry")]),_:1})]),_:1}))]),_:1})],64)):j("",!0),t(qo,{registration:q(n),"show-editor":m.value,onCloseEditor:O[1]||(O[1]=y=>m.value=!1),updated:f.value,onChange:E},null,8,["registration","show-editor","updated"]),t(Ot,{registration:q(n),"show-editor":r.value,onCloseEditor:O[2]||(O[2]=y=>r.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const sn=Ye(ln,[["__scopeId","data-v-d8ffe9ea"]]),rn=ie({__name:"RegistrationActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:D}){const s=e,l=Be(e,"modelValue"),n=T(!1),r=Je(s,D,void 0,void 0,"registration"),m=T(ve(r.value));oe(r,()=>{m.value=ve(r.value)});const d=fe(),A=(f,v)=>{const a=m.value.Submissions.find(u=>u.SubmissionUUID==v);if(!a){f&&f("Submission not found");return}d.setSubmissionStatus(v,a.Status).then(u=>{u?(m.value.Submissions.forEach((E,_)=>{r.value.Submissions[_].Status=E.Status}),f&&f("Status Saved")):f&&f("Status not saved")}).catch(()=>{f&&f("Status not saved")})};return(f,v)=>(i(),H(He,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=a=>l.value=a),title:f.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(Ge,null,{default:o(()=>[(i(!0),I(k,null,Z(m.value.Submissions,a=>(i(),H(Le,{key:a.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(ee,{class:"py-2 align-center"},{default:o(()=>[t(P,{cols:"8"},{default:o(()=>{var u;return[t(ne,{modelValue:a.Status,"onUpdate:modelValue":E=>a.Status=E,items:q(rt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((u=f.forms.find(E=>E.FormUUID==a.FormUUID))==null?void 0:u.Name)||""},{selection:o(()=>[t(Ta,{class:"mr-4"},{default:o(()=>{var E;return[Y(F((E=q(rt).find(_=>_.value===a.Status))==null?void 0:E.icon),1)]}),_:2},1024),Y(" "+F(q(It)(a.Status)),1)]),item:o(({item:E,props:{onClick:_}})=>[t(Le,{title:E.title,"prepend-icon":E.raw.icon,onClick:_},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(P,{cols:"4"},{default:o(()=>[t(We,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:u=>A(u.callback,a.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12"},{default:o(()=>[t(le,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:v[0]||(v[0]=a=>n.value=!0)},{default:o(()=>[Y("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Ot,{registration:f.registration,"show-editor":n.value,onCloseEditor:v[1]||(v[1]=a=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const Yn=ie({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:D}){var Ze;const s=ga();D("pageTitle","Registration Manager");const l=Bt(),n=Yt(),r=T(!0);let m=((Ze=l.params.convention)==null?void 0:Ze.toString())||"";const d=T({ID:0,ConventionUUID:Me(),OrganisationID:0,OrganisationUUID:Qe,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),A=fe(),f=T({ID:0,AdminLayoutUUID:Me(),ConventionID:d.value.ID,ConventionUUID:d.value.ConventionUUID,Name:"Registration Table",Type:yt.ADMIN_LAYOUT_TABLE,Panels:[]}),v=T([]),a=T([]),u=T([]),E=T([]),_=T([]),b=T(1),U=T(10),O=T([]),y=T(0),G=T(!1),K=T(""),se=T(""),Se=T(""),De=T(""),C=T(""),h=T(""),N=T([]),R=T([]),$=T([]),W=T([]),te=T([]),z=T([]),de=T(0),re=T(),Ie=T(!1),pe=T(!1);oe(de,c=>{c===7&&be()}),oe(C,()=>{se.value=Date.now().toString()}),oe(h,()=>{se.value=Date.now().toString()});const Re=()=>{v.value=[],u.value=[],_.value=[];try{A.getConventionAdminLayoutByName(d.value.ConventionUUID,"Registration Table").then(c=>{de.value+=1,c?f.value=c:(f.value.ConventionID=d.value.ID,f.value.ConventionUUID=d.value.ConventionUUID)})}catch{f.value.ConventionID=d.value.ID,f.value.ConventionUUID=d.value.ConventionUUID}try{A.getConventionForms(d.value.ConventionUUID).then(c=>{de.value+=1,c&&(v.value=c)})}catch{}try{A.getConventionAccommodation(d.value.ConventionUUID).then(c=>{de.value+=1,c&&(R.value=c)})}catch{}try{A.getConventionVenues(d.value.ConventionUUID).then(c=>{de.value+=1,c&&(z.value=c)})}catch{}try{A.getConventionExtras(d.value.ConventionUUID).then(c=>{de.value+=1,c&&($.value=c)})}catch{}try{A.getConventionInterests(d.value.ConventionUUID).then(c=>{de.value+=1,c&&(W.value=c)})}catch{}try{A.getConventionTickets(d.value.ConventionUUID).then(c=>{de.value+=1,c&&(te.value=c)})}catch{}try{A.getConventionGroups(d.value.ConventionUUID).then(c=>{c&&(a.value=c.sort((S,p)=>S.Name.localeCompare(p.Name)))})}catch{}try{A.getConventionTags(d.value.ConventionUUID).then(c=>{c&&(E.value=c.sort((S,p)=>S.Title.localeCompare(p.Title)).map(S=>(S.Title=`${S.Title} [${S.Key}]`,S)))})}catch{}},Ve=({page:c,itemsPerPage:S,sortBy:p})=>{r.value=!0,b.value=c,O.value=p;const g=_.value.find(J=>J.uuid==K.value),me=g==null?void 0:g.layout.Items;let ae="",et="";if(p&&me&&p.length>=1){const J=me.find(ke=>ke.LayoutItemUUID==p[0].key);switch(et=p[0].order,J==null?void 0:J.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:ae="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:ae="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ae="submission.status";break}switch(J==null?void 0:J.UserField){case X.USER_DATA_SOURCE_DISPLAY_NAME:ae="user.display_name";break;case X.USER_DATA_SOURCE_EMAIL:ae="user.email";break;case X.USER_DATA_SOURCE_FIRST_NAME:ae="user.firstname";break;case X.USER_DATA_SOURCE_HANDLE:ae="user.handle";break;case X.USER_DATA_SOURCE_LAST_NAME:ae="user.lastname";break}}try{const J={Direction:et,Limit:S,Offset:(c-1)*S,Order:ae};g&&g.layout.RequiredRegistrationTags.length>0&&(J.PanelUUID=g==null?void 0:g.layout.LayoutPanelUUID),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_ACCOMMODATION&&(J.Accommodation=!0),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_BADGE&&(J.Badge=!0),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_DEALER&&(J.Dealer=!0),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_REGISTRATION&&(J.Registration=!0),J.GroupUUID=C.value||Qe,J.TagUUID=h.value||Qe,J.Email=De.value,J.Reference=Se.value,A.searchConventionRegistrations(d.value.ConventionUUID,J).then(ke=>{ke&&(y.value=ke.Total,u.value=ke.Registrations,_.value.forEach(qe=>{const Vt=qe.layout;qe.items=u.value.map(w=>{const we=[];let _e;w.Leader?_e=w:_e=w.Primary,we.push({Name:_e.User.DisplayName,UUID:_e.UserUUID,UserUUID:_e.User.UserUUID,IsLeader:!0,Reference:_e.Reference,Paid:_e.Paid,Total:_e.Total}),we.push(..._e.Members.map(Ue=>({Name:Ue.User.DisplayName,UUID:Ue.UserUUID,UserUUID:Ue.User.UserUUID,IsLeader:!1,Reference:Ue.Reference,Paid:Ue.Paid,Total:Ue.Total})));const x={};return qe.headers.forEach(Ue=>{var tt;const L=Vt.Items.find(Ne=>Ne.LayoutItemUUID===Ue.key);if(L){if(L.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&L.SectionField)w.Submissions.forEach(Ne=>{const he=Ne.Data.find(V=>V.SectionFieldUUID===L.SectionFieldUUID);if(he){Ue.type===Qt.ACCOMMODATION?x[L.LayoutItemUUID]={Data:he.Data,Registration:w}:x[L.LayoutItemUUID]=he.Data;return}});else if(L.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&L.UserField)switch(L.UserField){case X.USER_DATA_SOURCE_AVATAR:x[L.LayoutItemUUID]=s.GetProfileImageURL(w.UserUUID);break;case X.USER_DATA_SOURCE_DISPLAY_NAME:x[L.LayoutItemUUID]=w.User.DisplayName;break;case X.USER_DATA_SOURCE_EMAIL:x[L.LayoutItemUUID]=w.User.Additional.Email;break;case X.USER_DATA_SOURCE_HANDLE:x[L.LayoutItemUUID]=w.User.Handle;break;case X.USER_DATA_SOURCE_DATE_OF_BIRTH:x[L.LayoutItemUUID]=w.User.Additional.DOB;break;case X.USER_DATA_SOURCE_FIRST_NAME:x[L.LayoutItemUUID]=w.User.Additional.FirstName;break;case X.USER_DATA_SOURCE_LAST_NAME:x[L.LayoutItemUUID]=w.User.Additional.LastName;break;case X.USER_DATA_SOURCE_TELEGRAM:x[L.LayoutItemUUID]="";break}else if(L.SourceType==="LAYOUT_ITEM_SOURCE_META"&&L.MetaField){const Ne=(tt=v.value.find(V=>V.Type===Ae.FORM_TYPE_REGISTRATION))==null?void 0:tt.FormUUID,he=w.Submissions.find(V=>V.FormUUID===Ne);switch(L.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:x[L.LayoutItemUUID]=w;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:x[L.LayoutItemUUID]=we;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:x[L.LayoutItemUUID]=w.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(he){const V=new Date(he.CreatedAt||"");x[L.LayoutItemUUID]=`${V.getFullYear()}-${(V.getMonth()+1).toString().padStart(2,"0")}-${V.getDate().toString().padStart(2,"0")} ${V.getHours().toString().padStart(2,"0")}:${V.getMinutes().toString().padStart(2,"0")}:${V.getSeconds().toString().padStart(2,"0")}`}else{const V=new Date(w.CreatedAt||"");x[L.LayoutItemUUID]=`${V.getFullYear()}-${(V.getMonth()+1).toString().padStart(2,"0")}-${V.getDate().toString().padStart(2,"0")} ${V.getHours().toString().padStart(2,"0")}:${V.getMinutes().toString().padStart(2,"0")}:${V.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:x[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:x[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:x[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if(w.Paid===0&&w.Total)x[L.LayoutItemUUID]="REQUIRED";else if(w.Total>w.Paid)x[L.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const V=we.find(B=>B.Paid===0&&(B.Total||0)>0);if(V){w.Total===0&&V.Total===0?x[L.LayoutItemUUID]="NOT_REQUIRED":w.Total===0&&V.Total||w.Total>0&&V.Total===0?x[L.LayoutItemUUID]="MISSING_REQUIRED":w.Paid>=w.Total?x[L.LayoutItemUUID]="AWAITING_PARTNER":x[L.LayoutItemUUID]="ALL_REQUIRED";break}else w.Total===0?x[L.LayoutItemUUID]="NOT_REQUIRED":x[L.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:Ma(w.Submissions,v.value),x[L.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}});break}}}}),x})}),r.value=!1)})}catch{}},be=()=>{f.value.Panels.forEach(c=>{c.Items.forEach(S=>{(S.SectionField==null||S.SectionField.Field==null)&&v.value.find(p=>{p.Sections.find(g=>{if(g.Fields){const me=g.Fields.find(ae=>ae.SectionFieldUUID===S.SectionFieldUUID);if(me)return S.SectionField=me,!0}})})})}),f.value.Panels.length>0&&(_.value=[],f.value.Panels.forEach(c=>{const S={uuid:Me(),order:c.Order,name:c.Name,headers:[],items:[],layout:c};c.Items.sort((p,g)=>p.Order>g.Order?1:p.Order==g.Order?0:-1),S.headers=c.Items.map(p=>{var g,me;return p.DefaultSort&&N.value.push({key:p.LayoutItemUUID,order:"asc"}),{key:p.LayoutItemUUID,title:p.Label||((me=(g=p.SectionField)==null?void 0:g.Field)==null?void 0:me.Label)||"",align:p.Align==="end"?"end":"start",sortable:Ct(p),type:Pe(p)}}),_.value.push(S)}),_.value=_.value.sort((c,S)=>c.order>S.order?1:c.order==S.order?0:-1)),(K.value==null||K.value=="")&&_.value.length>0&&(K.value=_.value[0].uuid)};m?A.getConvention(m).then(c=>{c&&(d.value=c,f.value.ConventionID=d.value.ID,f.value.ConventionUUID=d.value.ConventionUUID,Re())}).catch(()=>{n.push("/")}):n.push("/");const Pe=c=>{var S,p;if(c.SourceType===Fe.LAYOUT_ITEM_SOURCE_META)return`${c.SourceType}.${c.MetaField}`;if(c.SourceType===Fe.LAYOUT_ITEM_SOURCE_FORM)return(p=(S=c.SectionField)==null?void 0:S.Field)==null?void 0:p.Type;if(c.SourceType===Fe.LAYOUT_ITEM_SOURCE_USER)return`${c.SourceType}.${c.UserField}`},Ct=c=>{const S=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],p=[X.USER_DATA_SOURCE_DISPLAY_NAME,X.USER_DATA_SOURCE_EMAIL,X.USER_DATA_SOURCE_HANDLE,X.USER_DATA_SOURCE_DATE_OF_BIRTH,X.USER_DATA_SOURCE_FIRST_NAME,X.USER_DATA_SOURCE_LAST_NAME];return S.includes(c.MetaField)||p.includes(c.UserField)},ht=c=>{re.value=c,Ie.value=!0},Mt=c=>{re.value=c,pe.value=!0};return oe(Ie,c=>{c||(re.value=void 0)}),oe(pe,c=>{c||(re.value=void 0)}),(c,S)=>(i(),H(Va,null,{default:o(()=>[t(pt,{color:"blue-darken-4"},{default:o(()=>[t(ca,{modelValue:K.value,"onUpdate:modelValue":S[0]||(S[0]=p=>K.value=p),"show-arrows":""},{default:o(()=>[(i(!0),I(k,null,Z(_.value,p=>(i(),H(va,{key:p.uuid,value:p.uuid},{default:o(()=>[Y(F(p.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(Xe),t(le,{icon:"mdi:mdi-cog-outline",onClick:S[1]||(S[1]=p=>G.value=!0)})]),_:1}),t(Ua,{modelValue:K.value,"onUpdate:modelValue":S[11]||(S[11]=p=>K.value=p),disabled:!0},{default:o(()=>[(i(!0),I(k,null,Z(_.value,p=>(i(),H(_a,{key:p.uuid,value:p.uuid},{default:o(()=>[p.uuid===K.value?(i(),H(Rt,{key:0,class:"pa-2"},{default:o(()=>[t(q(wa),{"items-per-page":U.value,"onUpdate:itemsPerPage":S[9]||(S[9]=g=>U.value=g),"sort-by":N.value,"onUpdate:sortBy":S[10]||(S[10]=g=>N.value=g),headers:p.headers,"items-length":y.value,items:p.items,"item-value":"LayoutItemUUID",loading:r.value,search:se.value,"onUpdate:options":Ve},ze({top:o(()=>[t(Ce,null,{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:Se.value,"onUpdate:modelValue":S[2]||(S[2]=g=>Se.value=g),label:"Search by Badge",clearable:!0,"hide-details":"",onInput:S[3]||(S[3]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:De.value,"onUpdate:modelValue":S[4]||(S[4]=g=>De.value=g),label:"Search By Email",clearable:!0,"hide-details":"",onInput:S[5]||(S[5]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ne,{modelValue:C.value,"onUpdate:modelValue":S[6]||(S[6]=g=>C.value=g),label:"Search By Group",clearable:!0,"hide-details":"",items:a.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ne,{modelValue:h.value,"onUpdate:modelValue":S[7]||(S[7]=g=>h.value=g),label:"Search By Tag",clearable:!0,"hide-details":"",items:E.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[Z(p.headers,g=>({name:`item.${g.key}`,fn:o(({item:me})=>[t(Do,{header:g,item:me,accommodations:R.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,venues:z.value,onOpenActions:ht,onOpenPayments:Mt,onReload:S[8]||(S[8]=ae=>Ve({page:b.value,itemsPerPage:U.value,sortBy:O.value}))},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):j("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),G.value?(i(),H($a,{key:0,title:"Edit Layout",modelValue:G.value,"onUpdate:modelValue":S[12]||(S[12]=p=>G.value=p),layout:f.value,onSave:S[13]||(S[13]=p=>{G.value=!1,be()})},null,8,["modelValue","layout"])):j("",!0),re.value?(i(),I(k,{key:1},[Ie.value?(i(),H(rn,{key:0,modelValue:Ie.value,"onUpdate:modelValue":S[14]||(S[14]=p=>Ie.value=p),registration:re.value,"onUpdate:registration":S[15]||(S[15]=p=>re.value=p),accommodations:R.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Status & Communications",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):pe.value?(i(),H(sn,{key:1,modelValue:pe.value,"onUpdate:modelValue":S[16]||(S[16]=p=>pe.value=p),registration:re.value,"onUpdate:registration":S[17]||(S[17]=p=>re.value=p),accommodations:R.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Payments",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):j("",!0)],64)):j("",!0)]),_:1}))}});export{Yn as default};
