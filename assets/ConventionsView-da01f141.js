import{F as Q}from"./form-29fd1dbb.js";import{P as W}from"./permission-03f04c02.js";import{I as G,a0 as k,a1 as Y,r as c,K as F,w as j,M as r,N as p,O as e,W as I,v as t,a3 as A,_ as B,L as X,S as D,P as L,Q as J,X as Z,V as O,a6 as ee,a4 as te,H as ne}from"./index-3747dab3.js";import{a as H}from"./scopeId-edba0c19.js";import{_ as oe}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-b630e5d2.js";import{u as ae,V as le}from"./VCheckbox-976228db.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-bf035cab.js";import{s as R}from"./index-26b71cef.js";import{V as y,a as _}from"./VRow-5c8bdbb4.js";import{V as q}from"./VAvatar-0f6c5393.js";import{V as $}from"./VTextField-6fb90b45.js";import{V as se}from"./VTextarea-8e93b0e2.js";import{V as ue}from"./VForm-7f95ab65.js";import{V as re}from"./VFileInput-a5d5c5b7.js";import{j as z}from"./VContainer-3085ba0f.js";import{G as h}from"./group-d2a77946.js";import{C as P,a as de}from"./canEditOrganisation-8fe33599.js";import{G as K}from"./userData-6e2858bb.js";import{e as ve,V as me,a as fe,c as M,b as ce,d as pe}from"./VCard-9f920b22.js";import{V as S}from"./VBtn-091e84ae.js";import{v as ge}from"./v4-a960c1f4.js";import{u as _e}from"./nil-d01db1aa.js";import"./createSimpleFunctional-faa74197.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-1e15d49f.js";import"./forwardRefs-8e3fdbcf.js";import"./VDialog-25c33c6d.js";import"./VToolbar-3e806f56.js";import"./VChip-443781ab.js";const Ve=(v=void 0,d=void 0)=>v===void 0?!1:d===void 0?P(v,h.GROUP_TYPE_CONVENTION).EditConvention:P(v,h.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).EditConvention,Ce=(v,d)=>v===void 0?!1:P(v,h.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).EditRegistration,Ue=(v,d)=>v===void 0?!1:P(v,h.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).ViewRegistration,De=G({__name:"EditConventionDialog",props:k({convention:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:k(["update:convention","delete","save"],["update:modelValue"]),setup(v,{emit:d}){const U=v,a=A(),m=H(),{title:N=""}=U,V=Y(v,"modelValue"),g=ae(U,d,void 0,void 0,"convention"),o=c(F(g.value));j(g,()=>{o.value=F(g.value)});const C=c(`${m.GetConventionLogoURL(o.value.ConventionUUID)}?${new Date().getTime()}`),x=c(),b=c(),E=()=>{C.value=URL.createObjectURL(x.value.files[0])},w=()=>{d("delete")},i=()=>{o.value=F(g.value)},l=async()=>{var n;const u=new FormData((n=b.value)==null?void 0:n.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",o.value.ConventionUUID),await m.SaveConventionLogo(u)},s=u=>{l(),a.saveConvention(o.value).then(n=>{n?u&&u("Convention Data Saved").then(()=>{g.value=n,d("save",n)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,n)=>(r(),p(ie,{modelValue:V.value,"onUpdate:modelValue":n[5]||(n[5]=f=>V.value=f),onDelete:w,onReset:i,onSave:s,title:I(N),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:e(()=>[t(z,{class:"pa-0",fluid:!0},{default:e(()=>[t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(q,{class:"imgLogo mx-auto",src:C.value||""},null,8,["src"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t($,{label:I(R).formLabelName,name:"Name",variant:"outlined",modelValue:o.value.Name,"onUpdate:modelValue":n[0]||(n[0]=f=>o.value.Name=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(se,{label:I(R).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:o.value.Description,"onUpdate:modelValue":n[1]||(n[1]=f=>o.value.Description=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t($,{label:I(R).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:o.value.DetailLink,"onUpdate:modelValue":n[2]||(n[2]=f=>o.value.DetailLink=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t($,{label:I(R).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:o.value.Slug,"onUpdate:modelValue":n[3]||(n[3]=f=>o.value.Slug=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(le,{label:I(R).formConventionVisible,name:"Visible",modelValue:o.value.Visible,"onUpdate:modelValue":n[4]||(n[4]=f=>o.value.Visible=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(ue,{ref_key:"conventionImageForm",ref:b,enctype:"multipart/form-data"},{default:e(()=>[t(re,{label:I(R).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:x,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}});const Ie=B(De,[["__scopeId","data-v-b5f5bf6b"]]),ye=["innerHTML"],Ne={key:0,class:"text-green"},xe={key:1,class:"text-red"},Le={key:0,class:"text-green"},be={key:1,class:"text-red"},we=G({__name:"ConventionCard",props:k({open:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:k(["delete"],["update:modelValue"]),setup(v,{emit:d}){const U=A(),a=Y(v,"modelValue"),m=H(),N=K(),V=c(m.GetConventionLogoURL(a.value.ConventionUUID)),g=c(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),o=c(!1),C=c(!1),x=c(Ve(N,a.value)),b=c(Ce(N,a.value)),E=c(Ue(N,a.value)),w=()=>{C.value=!1,V.value=`${m.GetConventionLogoURL(a.value.ConventionUUID)}?ts=${Date.now()}`},i=l=>{U.deleteConvention(a.value.ConventionUUID).then(s=>{s?l&&(l("Convention Deleted"),d("delete")):l&&l("Failed to Delete Convention"),setTimeout(()=>{o.value=!1},2e3)}).catch(()=>{l&&(l("Failed to Delete Organisation"),o.value=!1)})};return(l,s)=>{const u=X("RouterLink");return r(),p(ve,null,{default:e(()=>[t(ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[V.value?(r(),p(q,{key:0,src:V.value,title:a.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),a.value.Name?(r(),p(me,{key:1},{default:e(()=>[L(J(a.value.Name),1)]),_:1})):D("",!0),a.value.Description?(r(),p(fe,{key:2,class:"text-wrap subtitle"},{default:e(()=>[Z("div",{innerHTML:a.value.Description},null,8,ye)]),_:1})):D("",!0),t(M,{class:"px-0 pb-0"},{default:e(()=>[L(" Visibility:  "),a.value.Visible?(r(),O("span",Ne,"Visible")):(r(),O("span",xe,"Hidden"))]),_:1}),t(M,{class:"px-0 pb-0"},{default:e(()=>[L(" Registration:  "),l.open?(r(),O("span",Le,"Open")):(r(),O("span",be,"Closed"))]),_:1})]),_:1}),t(pe,null,{default:e(()=>[t(y,{"no-gutters":""},{default:e(()=>[x.value?(r(),p(_,{key:0,class:"ma-1"},{default:e(()=>[t(S,{variant:"tonal",color:"primary",onClick:s[0]||(s[0]=n=>C.value=!0),width:"100%"},{default:e(()=>[L("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),x.value?(r(),p(_,{key:2,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}`},{default:e(()=>[t(S,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[L("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),E.value||b.value?(r(),p(_,{key:3,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/registrations`},{default:e(()=>[t(S,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[L("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0)]),_:1})]),_:1}),C.value?(r(),p(Ie,{key:0,modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=n=>C.value=n),convention:a.value,"onUpdate:convention":s[2]||(s[2]=n=>a.value=n),onDelete:s[3]||(s[3]=n=>o.value=!0),onSave:w,title:`${a.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),o.value?(r(),p(oe,{key:1,modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=n=>o.value=n),"confirmation-text":"I UNDERSTAND",message:g.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:i},null,8,["modelValue","message"])):D("",!0)]),_:1})}}});const Te=B(we,[["__scopeId","data-v-1d5a45f3"]]),Re=G({__name:"ConventionsView",emits:["pageTitle"],setup(v,{emit:d}){var w;d("pageTitle","Conventions");const U=A(),a=K(),m=c([]),N=c([]),V=ee();let g=((w=V.params.organisation)==null?void 0:w.toString())||"";const o=c();j(V,()=>{var i,l;g!==((i=V.params.organisation)==null?void 0:i.toString())&&(g=((l=V.params.organisation)==null?void 0:l.toString())||"",C())});const C=()=>{g?U.getOrganisation(g).then(i=>{i&&(o.value=i,U.getConventionList(i.OrganisationUUID).then(l=>{l&&(m.value=l,x())}))}).catch(()=>{}):U.getPermissionAccessList(W.PERMISSION_TYPE_NULL).then(i=>{i&&(m.value=i.Conventions,x())})},x=()=>{m.value.forEach(i=>{U.getConventionForms(i.ConventionUUID).then(l=>{l&&(N.value=[...N.value,...l])}).catch(l=>{console.error(l)})})},b=()=>{var i,l;if(o.value){const s={ID:0,ConventionUUID:ge(),OrganisationID:((i=o.value)==null?void 0:i.ID)||0,OrganisationUUID:((l=o.value)==null?void 0:l.OrganisationUUID)||_e,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};U.saveConvention(s).then(u=>{u&&m.value.push(u)})}},E=i=>{m.value.splice(i,1)};return C(),(i,l)=>(r(),p(z,null,{default:e(()=>[t(y,{class:"justify-center"},{default:e(()=>[(r(!0),O(ne,null,te(m.value,(s,u)=>(r(),p(_,{key:s.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var n,f;return[t(Te,{modelValue:m.value[u],"onUpdate:modelValue":T=>m.value[u]=T,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((n=s.Organisation)==null?void 0:n.Slug)||((f=s.Organisation)==null?void 0:f.OrganisationUUID)||"",open:!!N.value.find(T=>T.ConventionUUID===s.ConventionUUID&&T.Type===I(Q).FORM_TYPE_REGISTRATION&&T.State.New),onDelete:T=>E(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(y,null,{default:e(()=>[o.value&&I(de)(I(a),o.value)?(r(),p(_,{key:0,class:"text-right"},{default:e(()=>[t(S,{color:"primary",onClick:b},{default:e(()=>[L("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}});const lt=B(Re,[["__scopeId","data-v-f6915eaa"]]);export{lt as default};
