import{F as ee}from"./form-0fJbSFPv.js";import{P as te}from"./permission-7wLhDNXq.js";import{i as q,M as $,N as Q,r,k as B,w as J,n as d,q as c,v as e,f as t,C as N,P as j,_ as H,l as oe,A as D,y as ne,x,D as ae,B as A,V as le,Q as ie,F as se}from"./index-AnVF1VyL.js";import{u as K}from"./VSpacer-F0pZJULb.js";import{_ as ue}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-W790H0fL.js";import{u as re}from"./useModel-WZKHWVYf.js";import{_ as de}from"./ModelDialog.vue_vue_type_script_setup_true_lang-JDlI0Zcn.js";import{s as S}from"./index-OKsbKlsK.js";import{a as W}from"./VContainer-lANhosQ-.js";import{V as L,a as g}from"./VRow-Qp4QfNDW.js";import{V as X}from"./VAvatar-QCubEyhR.js";import{V as Y}from"./VTextField-lgGMqLi_.js";import{V as me}from"./VTextarea-IQq-ak0X.js";import{V as ve}from"./VCheckbox-4r_rsaS_.js";import{V as fe}from"./VForm-I5fOsp3Q.js";import{V as ce}from"./VFileInput-UKIfbToO.js";import{G as O}from"./group-7fhbY6WJ.js";import{C as T}from"./canDo-8w-iwWYc.js";import{C as pe}from"./canEditRegistrations-PHKxD3Wu.js";import{G as Z}from"./userData-keZD7zzw.js";import{V as ge,a as Ce,b as Ve,c as z,d as _e,e as Ue}from"./VCard-EKKWfVyO.js";import{V as G}from"./VBtn-KG2fAbbh.js";import{C as De}from"./canEditOrganisation-pymJEzkf.js";import{v as Ie}from"./v4-yQnnJER4.js";import{u as Ne}from"./nil-rxyd0N8M.js";import"./createSimpleFunctional-5Su_mjh7.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-dHruSQTp.js";import"./VOverlay-z4Dzirpk.js";import"./forwardRefs-YqQOqdbj.js";import"./scopeId-aEWfGS7v.js";import"./VDialog-BW9p2wiP.js";import"./VToolbar-NGOxt6oc.js";import"./VCheckboxBtn-DsWMwsbS.js";import"./VChip-F5_pkBV2.js";const Le=(n=void 0,a=void 0)=>n===void 0?!1:a===void 0?T(n,O.GROUP_TYPE_CONVENTION).EditConvention:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditConvention,Ee=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewRegistration,Oe=q({__name:"EditConventionDialog",props:$({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:$(["update:convention","delete","save"],["update:modelValue"]),setup(n,{emit:a}){const F=n,E=j(),o=K(),{title:p=""}=F,v=a,_=Q(n,"modelValue"),C=re(F,v,void 0,void 0,"convention"),l=r(B(C.value));J(C,()=>{l.value=B(C.value)});const U=r(`${o.GetConventionLogoURL(l.value.ConventionUUID)}?${new Date().getTime()}`),w=r(),b=r(),h=()=>{U.value=URL.createObjectURL(w.value.files[0])},k=()=>{v("delete")},s=()=>{l.value=B(C.value)},m=async()=>{var i;const u=new FormData((i=b.value)==null?void 0:i.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",l.value.ConventionUUID),await o.SaveConventionLogo(u)},I=u=>{m(),E.saveConvention(l.value).then(i=>{i?u&&u("Convention Data Saved").then(()=>{C.value=i,v("save",i)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,i)=>(d(),c(de,{modelValue:_.value,"onUpdate:modelValue":i[5]||(i[5]=f=>_.value=f),onDelete:k,onReset:s,onSave:I,title:N(p),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(W,{class:"pa-0",fluid:!0},{default:e(()=>[t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(X,{class:"imgLogo mx-auto",src:U.value||""},null,8,["src"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(S).formLabelName,name:"Name",variant:"outlined",modelValue:l.value.Name,"onUpdate:modelValue":i[0]||(i[0]=f=>l.value.Name=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(me,{label:N(S).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:l.value.Description,"onUpdate:modelValue":i[1]||(i[1]=f=>l.value.Description=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(S).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:l.value.DetailLink,"onUpdate:modelValue":i[2]||(i[2]=f=>l.value.DetailLink=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(S).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:l.value.Slug,"onUpdate:modelValue":i[3]||(i[3]=f=>l.value.Slug=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(ve,{label:N(S).formConventionVisible,name:"Visible",modelValue:l.value.Visible,"onUpdate:modelValue":i[4]||(i[4]=f=>l.value.Visible=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(fe,{ref_key:"conventionImageForm",ref:b,enctype:"multipart/form-data"},{default:e(()=>[t(ce,{label:N(S).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:w,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:h},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Te=H(Oe,[["__scopeId","data-v-319537e0"]]),we=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewProps,ye=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewLostAndFound,Pe=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditProps,xe=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditLostAndFound,Re=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ConfigureProps,be=(n,a)=>n===void 0?!1:T(n,O.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ConfigureLostAndFound,ke=["innerHTML"],Se={key:0,class:"text-green"},Fe={key:1,class:"text-red"},he={key:0,class:"text-green"},Ae={key:1,class:"text-red"},Ge=q({__name:"ConventionCard",props:$({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:$(["delete"],["update:modelValue"]),setup(n,{emit:a}){const F=j(),E=a,o=Q(n,"modelValue"),p=K(),v=Z(),_=r(p.GetConventionLogoURL(o.value.ConventionUUID)),C=r(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),l=r(!1),U=r(!1),w=r(Le(v,o.value)),b=r(pe(v,o.value)),h=r(Ee(v,o.value)),k=r(we(v,o.value)),s=r(ye(v,o.value)),m=r(Pe(v,o.value)),I=r(xe(v,o.value)),u=r(Re(v,o.value)),i=r(be(v,o.value)),f=()=>{U.value=!1,_.value=`${p.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},y=P=>{F.deleteConvention(o.value.ConventionUUID).then(V=>{V?P&&(P("Convention Deleted"),E("delete")):P&&P("Failed to Delete Convention"),setTimeout(()=>{l.value=!1},2e3)}).catch(()=>{P&&(P("Failed to Delete Organisation"),l.value=!1)})};return(P,V)=>{const M=oe("RouterLink");return d(),c(Ue,null,{default:e(()=>[t(ge,{class:"flex-1-1 align-content-start"},{default:e(()=>[_.value?(d(),c(X,{key:0,src:_.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),o.value.Name?(d(),c(Ce,{key:1},{default:e(()=>[x(ne(o.value.Name),1)]),_:1})):D("",!0),o.value.Description?(d(),c(Ve,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ae("div",{innerHTML:o.value.Description},null,8,ke)]),_:1})):D("",!0),t(z,{class:"px-0 pb-0"},{default:e(()=>[x(" Visibility:  "),o.value.Visible?(d(),A("span",Se,"Visible")):(d(),A("span",Fe,"Hidden"))]),_:1}),t(z,{class:"px-0 pb-0"},{default:e(()=>[x(" Registration:  "),P.open?(d(),A("span",he,"Open")):(d(),A("span",Ae,"Closed"))]),_:1})]),_:1}),t(_e,null,{default:e(()=>[t(L,{"no-gutters":""},{default:e(()=>[w.value?(d(),c(g,{key:0,class:"ma-1"},{default:e(()=>[t(G,{variant:"tonal",color:"primary",onClick:V[0]||(V[0]=R=>U.value=!0),width:"100%"},{default:e(()=>[x("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),w.value?(d(),c(g,{key:2,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t(G,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[x("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),h.value||b.value?(d(),c(g,{key:3,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t(G,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[x("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),k.value||s.value||m.value||I.value||u.value||i.value?(d(),c(g,{key:4,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/operations`},{default:e(()=>[t(G,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[x("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0)]),_:1})]),_:1}),U.value?(d(),c(Te,{key:0,modelValue:U.value,"onUpdate:modelValue":V[1]||(V[1]=R=>U.value=R),convention:o.value,"onUpdate:convention":V[2]||(V[2]=R=>o.value=R),onDelete:V[3]||(V[3]=R=>l.value=!0),onSave:f,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),l.value?(d(),c(ue,{key:1,modelValue:l.value,"onUpdate:modelValue":V[4]||(V[4]=R=>l.value=R),"confirmation-text":"I UNDERSTAND",message:C.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:y},null,8,["modelValue","message"])):D("",!0)]),_:1})}}}),$e=H(Ge,[["__scopeId","data-v-5c95f486"]]),Me=q({__name:"ConventionsView",emits:["pageTitle"],setup(n,{emit:a}){var k;a("pageTitle","Conventions");const E=j(),o=Z(),p=r([]),v=r([]),_=le();let C=((k=_.params.organisation)==null?void 0:k.toString())||"";const l=r();J(_,()=>{var s,m;C!==((s=_.params.organisation)==null?void 0:s.toString())&&(C=((m=_.params.organisation)==null?void 0:m.toString())||"",U())});const U=()=>{C?E.getOrganisation(C).then(s=>{s&&(l.value=s,E.getConventionList(s.OrganisationUUID).then(m=>{m&&(p.value=m,w())}))}).catch(()=>{}):E.getPermissionAccessList(te.PERMISSION_TYPE_NULL).then(s=>{s&&(p.value=s.Conventions,w())})},w=()=>{p.value.forEach(s=>{E.getConventionForms(s.ConventionUUID).then(m=>{m&&(v.value=[...v.value,...m])}).catch(m=>{console.error(m)})})},b=()=>{var s,m;if(l.value){const I={ID:0,ConventionUUID:Ie(),OrganisationID:((s=l.value)==null?void 0:s.ID)||0,OrganisationUUID:((m=l.value)==null?void 0:m.OrganisationUUID)||Ne,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};E.saveConvention(I).then(u=>{u&&p.value.push(u)})}},h=s=>{p.value.splice(s,1)};return U(),(s,m)=>(d(),c(W,null,{default:e(()=>[t(L,{class:"justify-center"},{default:e(()=>[(d(!0),A(se,null,ie(p.value,(I,u)=>(d(),c(g,{key:I.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var i,f;return[t($e,{modelValue:p.value[u],"onUpdate:modelValue":y=>p.value[u]=y,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((i=I.Organisation)==null?void 0:i.Slug)||((f=I.Organisation)==null?void 0:f.OrganisationUUID)||"",open:!!v.value.find(y=>y.ConventionUUID===I.ConventionUUID&&y.Type===N(ee).FORM_TYPE_REGISTRATION&&y.State.New),onDelete:y=>h(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(L,null,{default:e(()=>[l.value&&N(De)(N(o),l.value)?(d(),c(g,{key:0,class:"text-right"},{default:e(()=>[t(G,{color:"primary",onClick:b},{default:e(()=>[x("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}}),It=H(Me,[["__scopeId","data-v-f6915eaa"]]);export{It as default};
