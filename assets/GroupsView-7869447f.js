import{I as Q,a0 as F,a1 as X,K as O,L,M as o,v as l,r as v,a2 as j,w as H,e as oe,Q as K,$ as ee,S as b,H as x,Z as ne,N as C,O as R,U as r,P as ge,a9 as we,R as z,ar as _e,E as te}from"./index-66519961.js";import{O as E,G as P}from"./group-d2a77946.js";import{P as Te}from"./permission-03f04c02.js";import{n as le,V as k}from"./VContainer-f7530e18.js";import{V as y,a as ae}from"./VRow-10269350.js";import{V as Y,u as se}from"./VCheckbox-d720999d.js";import{_ as Ne}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-38f460f9.js";import{_ as ue}from"./ModelDialog.vue_vue_type_script_setup_true_lang-c5b16c6e.js";import{V as De}from"./VTextField-88275153.js";import{V as J}from"./VSelect-ae0a651e.js";import{u as A,V as be}from"./VToolbar-98532de1.js";import{G as Ee,A as ye}from"./userData-36b22fbb.js";import{u as Ge}from"./useAvatar-775e259c.js";import{_ as he}from"./VChip-5872c4cf.js";import{V as Re,a as Pe,e as Ce}from"./VList-4fa5773e.js";import{V as Me}from"./VAvatar-f6f7c4c8.js";import{V as Se}from"./VDialog-ca8944d4.js";import{e as ke,V as Ae,a as Ye,c as xe,d as Le}from"./VCard-fe4440b3.js";import{V as ie}from"./VSpacer-d0a0a75d.js";import{V as $e}from"./VTable-e87330a8.js";import{v as q}from"./v4-a960c1f4.js";import"./VCheckboxBtn-9cf26c16.js";import"./index-c8542385.js";import"./scopeId-7eeb3c4f.js";import"./useStoreAPI-35819716.js";const re=Q({__name:"EditGroupPermissions",props:F({disabled:{type:Boolean}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(G){const p=X(G,"modelValue");return(f,d)=>(O(),L(le,null,{default:o(()=>[l(ae,null,{default:o(()=>[l(y,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(Y,{modelValue:p.value.EditConvention,"onUpdate:modelValue":d[0]||(d[0]=U=>p.value.EditConvention=U),label:"Edit Convention","hide-details":"",disabled:f.disabled},null,8,["modelValue","disabled"])]),_:1}),l(y,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(Y,{modelValue:p.value.EditOrganisation,"onUpdate:modelValue":d[1]||(d[1]=U=>p.value.EditOrganisation=U),label:"Edit Organisation","hide-details":"",disabled:f.disabled},null,8,["modelValue","disabled"])]),_:1}),l(y,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(Y,{modelValue:p.value.EditRegistration,"onUpdate:modelValue":d[2]||(d[2]=U=>p.value.EditRegistration=U),label:"Edit Registrations","hide-details":"",disabled:f.disabled},null,8,["modelValue","disabled"])]),_:1}),l(y,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(Y,{modelValue:p.value.ManageUsers,"onUpdate:modelValue":d[3]||(d[3]=U=>p.value.ManageUsers=U),label:"Manage Users","hide-details":"",disabled:f.disabled},null,8,["modelValue","disabled"])]),_:1}),l(y,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(Y,{modelValue:p.value.ManageViews,"onUpdate:modelValue":d[4]||(d[4]=U=>p.value.ManageViews=U),label:"Manage Views","hide-details":"",disabled:f.disabled},null,8,["modelValue","disabled"])]),_:1}),l(y,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(Y,{modelValue:p.value.ViewRegistration,"onUpdate:modelValue":d[5]||(d[5]=U=>p.value.ViewRegistration=U),label:"View Registrations","hide-details":"",disabled:f.disabled},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}))}}),je=Q({__name:"EditGroupDialog",props:F({conventions:{},organisations:{},group:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:F(["update:group","save"],["update:modelValue"]),setup(G,{emit:p}){const f=G,d=ee(),{conventions:U,organisations:M,title:N=""}=f,g=X(G,"modelValue"),u=se(f,p,void 0,void 0,"group"),t=v(j(u.value)),c=v(null);t.value.OwnerType===E.OWNER_TYPE_CONVENTION?c.value=U.filter(s=>s.ConventionUUID==t.value.OwnerUUID).map(s=>s.ConventionUUID).join(""):t.value.OwnerType===E.OWNER_TYPE_ORGANISATION?c.value=M.filter(s=>s.OrganisationUUID==t.value.OwnerUUID).map(s=>s.OrganisationUUID).join(""):(t.value.Type===P.GROUP_TYPE_SYSTEM||t.value.Type===P.GROUP_TYPE_ADMIN)&&(c.value=null),H(u,()=>{t.value=j(u.value)});const V=v({ID:0,PermissionUUID:A,GroupID:0,GroupUUID:A,EditConvention:!1,EditOrganisation:!1,EditRegistration:!1,ViewRegistration:!1,ManageUsers:!1,ManageViews:!1});d.getPermission(P.GROUP_TYPE_SYSTEM,A).then(s=>{V.value=s,_()}).catch(()=>{});const w=()=>{t.value=j(u.value),_()},h=s=>{if(c.value==null)t.value.Type=P.GROUP_TYPE_ADMIN,t.value.OwnerType=null,t.value.OwnerID=null,t.value.OwnerUUID=null;else{const e=S.value.find(m=>c.value===m.OwnerUUID);e&&(e.OwnerType==E.OWNER_TYPE_ORGANISATION?t.value.Type=P.GROUP_TYPE_ORGANISATION:e.OwnerType==E.OWNER_TYPE_CONVENTION&&(t.value.Type=P.GROUP_TYPE_CONVENTION),t.value.OwnerType=e.OwnerType,t.value.OwnerID=e.OwnerID,t.value.OwnerUUID=e.OwnerUUID)}d.saveGroup(t.value).then(e=>{e&&s&&s("Group Saved").then(()=>{u.value=e,p("save",e)})}).catch(()=>{s&&s("Failed to Save Group")})},_=()=>{const s=S.value.find(e=>t.value.OwnerUUID===e.OwnerUUID);s?c.value=s.OwnerUUID:S.value.length>0&&(c.value=null)},S=oe(()=>{const s=[];return V.value.ManageUsers&&s.push({Label:"System Admin",OwnerID:null,OwnerUUID:null,OwnerType:null}),s.push(...U.map(e=>({Label:`${e.Name} (Convention)`,OwnerID:e.ID,OwnerUUID:e.ConventionUUID,OwnerType:E.OWNER_TYPE_CONVENTION}))),s.push(...M.map(e=>({Label:`${e.Name} (Organisation)`,OwnerID:e.ID,OwnerUUID:e.OrganisationUUID,OwnerType:E.OWNER_TYPE_ORGANISATION}))),s});return _(),(s,e)=>(O(),L(ue,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=m=>g.value=m),onReset:w,onSave:h,title:K(N),color:"primary","show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:o(()=>[l(le,{class:"pa-0",fluid:!0},{default:o(()=>[l(ae,null,{default:o(()=>[l(y,{cols:"12",md:"6"},{default:o(()=>[l(De,{modelValue:t.value.Name,"onUpdate:modelValue":e[0]||(e[0]=m=>t.value.Name=m),label:"Name",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(y,{cols:"12",md:"6"},{default:o(()=>[l(J,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=m=>c.value=m),label:"Owner",items:S.value,"item-title":"Label","item-value":"OwnerUUID",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),l(y,{cols:"12"},{default:o(()=>[l(re,{modelValue:t.value.Permission,"onUpdate:modelValue":e[2]||(e[2]=m=>t.value.Permission=m),disabled:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Fe=r("p",null," Are you sure you wish to remove this user? If they have permissions from another group these will still be usable. To add the user back into the group you may need to provide them with a new invite link. ",-1),We={key:1},Be=["href","onClick"],ze=Q({__name:"EditGroupMembersDialog",props:F({group:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:F(["update:group","save"],["update:modelValue"]),setup(G,{emit:p}){const f=G,d=ee(),U=Ge(),{title:M=""}=f,N=X(G,"modelValue"),g=se(f,p,void 0,void 0,"group"),u=v(j(g.value)),t=v("");(u.value.Users==null||u.value.Users.length==0)&&d.getGroupMembers(u.value.GroupUUID).then(e=>{e&&(u.value.Users=e)}).catch(()=>{u.value.Users=[]}),d.getGroupInvite(u.value.GroupUUID).then(e=>{if(e){const m=new URL(location.href);m.searchParams.set("token",e),t.value=m.toString()}}),H(g,()=>{u.value=j(g.value)});const c=()=>{window.isSecureContext&&navigator.clipboard&&navigator.clipboard.writeText(t.value)},V=v(!1),w=v(-1),h=v(""),_=()=>{w.value=-1,V.value=!1},S=e=>{w.value=e,V.value=!0},s=({callback:e})=>{if(!u.value.Users){e&&(e("Failed to Remove User"),setTimeout(_,2e3));return}h.value="",w.value<0||w.value>=u.value.Users.length?(e&&e("Invalid Convention"),setTimeout(_,2e3)):d.removeUserFromGroup(u.value.Users[w.value].UserUUID,u.value.GroupUUID).then(m=>{var I;m?((I=u.value.Users)==null||I.splice(w.value,1),e&&e("User Removed")):e&&e("Failed to Remove User"),setTimeout(_,2e3)}).catch(()=>{e&&(e("Failed to Remove User"),setTimeout(_,2e3))})};return(e,m)=>(O(),L(ue,{modelValue:N.value,"onUpdate:modelValue":m[1]||(m[1]=I=>N.value=I),title:K(M),color:"primary"},{default:o(()=>[l(le,{class:"pa-0",fluid:!0},{default:o(()=>[u.value.Users&&u.value.Users.length?(O(),b(x,{key:0},[l(Re,null,{default:o(()=>[(O(!0),b(x,null,ne(u.value.Users,(I,$)=>(O(),L(Pe,{key:I.UserUUID},{append:o(()=>[l(k,{color:"red-darken-3",icon:"mdi:mdi-window-close",size:"x-small",onClick:W=>S($)},null,8,["onClick"])]),prepend:o(()=>[l(Me,{src:K(U)(I.UserUUID),class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])]),default:o(()=>[l(Ce,null,{default:o(()=>[C(R(I.DisplayName)+" "+R(I.Handle?`(${I.Handle})`:""),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(Se,{modelValue:V.value,"onUpdate:modelValue":m[0]||(m[0]=I=>V.value=I),width:"auto"},{default:o(()=>[l(ke,null,{default:o(()=>[l(Ae,null,{default:o(()=>[C(" Remove User from Group ")]),_:1}),l(Ye,null,{default:o(()=>[C(" User will no longer have the permissions from this group. ")]),_:1}),l(xe,null,{default:o(()=>[l(ae,null,{default:o(()=>[l(y,null,{default:o(()=>[Fe]),_:1})]),_:1})]),_:1}),l(Le,null,{default:o(()=>[l(k,{color:"primary",onClick:_},{default:o(()=>[C("Cancel")]),_:1}),l(ie),l(he,{color:"red-darken-3",label:"Remove User",onClick:s})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)):(O(),b("p",We," No members "))]),_:1})]),actions:o(()=>[l(k,{variant:"text"},{default:o(()=>[r("a",{href:t.value,onClick:ge(c,["prevent"])},"Invite URL",8,Be)]),_:1})]),_:1},8,["modelValue","title"]))}}),qe=r("h1",{class:"text-center mt-5"},"Processing Invite...",-1),He={key:0,class:"text-center mt-5 text-red text-h5"},Ke=r("p",{class:"text-center mt-5"},"Please contact your admin and request a new one",-1),Qe=r("thead",null,[r("tr",null,[r("th",null,"Name"),r("th",{class:"d-none d-md-table-cell"}," Owner "),r("th",null,"Permissions"),r("th")])],-1),Ze={class:"d-block d-md-none mt-2"},Je=r("strong",null,"Owner",-1),Xe=r("br",null,null,-1),el=r("br",null,null,-1),ll={class:"d-none d-md-table-cell"},al=r("br",null,null,-1),tl=r("br",null,null,-1),ol=r("br",null,null,-1),hl=Q({__name:"GroupsView",emits:["pageTitle"],setup(G,{emit:p}){p("pageTitle","Manage Groups & Permissions");const f=ee(),d=Ee(),U=we();(!d||!d.Groups.find(a=>a.Permission.ManageUsers))&&U.push("/");const M=v(!0),N=v(),g=v(),u=v([]),t=v([]),c=v([]),V=v(!1),w=v(!1),h=v(!1),_=v(""),s=new URL(location.href).searchParams.get("token")||"";s!==""&&(M.value=!1,f.validateGroupInviteToken(s).then(a=>{a&&(ye(a),U.push("/"))}).catch(()=>{_.value="Invalid Token"})),H(N,()=>{$(g.value,N.value)}),H(g,()=>{$(g.value,N.value)});const e=a=>a.OwnerType===E.OWNER_TYPE_CONVENTION?u.value.filter(i=>i.ConventionUUID===a.OwnerUUID).map(i=>i.Name).join(""):a.OwnerType===E.OWNER_TYPE_ORGANISATION?c.value.filter(i=>i.OrganisationUUID===a.OwnerUUID).map(i=>i.Name).join(""):a.OwnerType===void 0||a.OwnerType===null?"System":"Unknown",m=a=>a.OwnerType===E.OWNER_TYPE_CONVENTION?"Convention":a.OwnerType===E.OWNER_TYPE_ORGANISATION?"Organisation":a.OwnerType===void 0||a.OwnerType===null?"Global":"Unknown",I=()=>{f.getPermissionAccessList(Te.PERMISSION_TYPE_MANAGE_USERS).then(a=>{u.value=a.Conventions,c.value=a.Organisations}).catch(()=>{})},$=(a=A,i=A)=>{f.getManageableGroups(a||A,i||A).then(n=>{n&&(t.value=n)}).catch(()=>{})},W=()=>{const a={ID:0,GroupUUID:q(),Type:P.GROUP_TYPE_CONVENTION,Name:"",MinimumNumbers:0,Permission:{ID:0,PermissionUUID:q(),GroupID:0,GroupUUID:q(),EditConvention:!1,EditOrganisation:!1,EditRegistration:!1,ManageUsers:!1,ManageViews:!1,ViewRegistration:!1},Users:[],OwnerID:null,OwnerType:null,OwnerUUID:null};return a.Permission.GroupUUID=a.GroupUUID,a},Z=v(W()),D=v(-1),T=v(W()),de=oe(()=>D.value===-1?"New Group":"Edit Group"),me=()=>{Z.value.GroupUUID=q(),T.value=Object.assign({},W()),D.value=-1,V.value=!0},ve=a=>{D.value=t.value.indexOf(a),T.value=Object.assign({},a),w.value=!0},pe=a=>{D.value=t.value.indexOf(a),T.value=Object.assign({},a),V.value=!0},Ue=a=>{D.value=t.value.indexOf(a),T.value=Object.assign({},a),h.value=!0},fe=()=>{f.deleteGroup(T.value.GroupUUID).then(a=>{a&&(t.value.splice(D.value,1),Oe())})},ce=()=>{V.value=!1,te(()=>{T.value=Object.assign({},Z.value),D.value=-1})},Oe=()=>{h.value=!1,te(()=>{T.value=Object.assign({},Z.value),D.value=-1})},Ve=a=>{D.value>-1?Object.assign(t.value[D.value],a):t.value.push(a),ce()};return I(),$(g.value,N.value),(a,i)=>(O(),b("div",null,[M.value?(O(),b(x,{key:1},[l(be,{color:"primary"},{default:o(()=>[l(J,{label:"Organisation",modelValue:g.value,"onUpdate:modelValue":i[0]||(i[0]=n=>g.value=n),items:c.value,"item-value":"OrganisationUUID","item-title":"Name",clearable:!0,"hide-details":"",class:"mr-1"},null,8,["modelValue","items"]),l(J,{label:"Convention",modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=n=>N.value=n),items:u.value,"item-value":"ConventionUUID","item-title":"Name",clearable:!0,"hide-details":""},null,8,["modelValue","items"]),l(ie),l(k,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:me},{default:o(()=>[C(" New Group ")]),_:1}),l(Ne,{modelValue:h.value,"onUpdate:modelValue":i[2]||(i[2]=n=>h.value=n),onDelete:fe},null,8,["modelValue"])]),_:1}),V.value?(O(),L(je,{key:0,modelValue:V.value,"onUpdate:modelValue":i[3]||(i[3]=n=>V.value=n),group:T.value,"onUpdate:group":i[4]||(i[4]=n=>T.value=n),onSave:Ve,title:de.value,conventions:u.value,organisations:c.value},null,8,["modelValue","group","title","conventions","organisations"])):z("",!0),w.value?(O(),L(ze,{key:1,modelValue:w.value,"onUpdate:modelValue":i[5]||(i[5]=n=>w.value=n),group:T.value,"onUpdate:group":i[6]||(i[6]=n=>T.value=n),title:`${T.value.Name}`},null,8,["modelValue","group","title"])):z("",!0),l($e,null,{default:o(()=>[Qe,r("tbody",null,[(O(!0),b(x,null,ne(t.value,(n,Ie)=>(O(),b("tr",{key:n.GroupUUID,class:_e(Ie%2?"bg-grey-lighten-4":"")},[r("td",null,[C(R(n.Name)+" ",1),r("p",Ze,[Je,Xe,C(" "+R(e(n)),1),el,r("small",null,"("+R(m(n))+")",1)])]),r("td",ll,[C(R(e(n)),1),al,r("small",null,"("+R(m(n))+")",1)]),r("td",null,[l(re,{modelValue:n.Permission,"onUpdate:modelValue":B=>n.Permission=B,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),r("td",null,[l(k,{icon:"mdi:mdi-account-group",size:"x-small",color:"success",class:"mb-1",onClick:B=>ve(n)},null,8,["onClick"]),tl,n.Type!==K(P).GROUP_TYPE_SYSTEM?(O(),b(x,{key:0},[l(k,{icon:"mdi:mdi-pencil",size:"x-small",color:"primary",class:"mb-1",onClick:B=>pe(n)},null,8,["onClick"]),ol,l(k,{icon:"mdi:mdi-delete",size:"x-small",color:"error",class:"mb-1",onClick:B=>Ue(n)},null,8,["onClick"])],64)):z("",!0)])],2))),128))])]),_:1})],64)):(O(),b(x,{key:0},[qe,_.value?(O(),b("p",He,R(_.value),1)):z("",!0),Ke],64))]))}});export{hl as default};
