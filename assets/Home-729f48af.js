import{I as N,a0 as ae,a1 as se,J as le,r as U,w as q,M as e,N as a,O as t,v as i,P as l,R as ie,Q as g,S as _,a2 as re,X as m,a3 as K,K as X,V as u,H as E,a4 as B,W as h,e as Y,L as j,Y as ue,Z as ce,_ as oe}from"./index-fc77c170.js";import{G as J}from"./userData-2ecef3da.js";import{_ as de}from"./LoginView.vue_vue_type_script_setup_true_lang-efaab06e.js";import{s as H}from"./index-26b71cef.js";import{F as I}from"./form-29fd1dbb.js";import{S as Z,a as me}from"./submission-9dd916bb.js";import{V as ne,a as ve}from"./scopeId-4844cc2d.js";import{c as G}from"./canEditForm-787038d8.js";import{s as pe}from"./sortSubmissions-8ed80f07.js";import{P as x,a as fe,f as _e,u as ye}from"./useDisplayTransactions-42702f3e.js";import{V as ge,l as Te}from"./VAlert-a6df6318.js";import{_ as he}from"./ModelDialog.vue_vue_type_script_setup_true_lang-2d203a69.js";import{V as ke}from"./VForm-44341b6e.js";import{V as L,a as M}from"./VRow-8ee51b39.js";import{V as v,a as Se}from"./VBtn-fe59c7f5.js";import{j as Q}from"./VContainer-92c8870a.js";import{V as Ie}from"./SaveButton.vue_vue_type_script_setup_true_lang-b1ac0e05.js";import{V as Ee}from"./VAvatar-4f7c619d.js";import{V as ee,a as Ue,b as we,c as te,d as Ae,e as Ce}from"./VCard-331ec6d9.js";import"./emailFormVariant-e5e0aad4.js";import"./LoginButton-0c4482ef.js";import"./createSimpleFunctional-6f5888c4.js";import"./forwardRefs-4c46e33f.js";import"./VDialog-1a1614be.js";import"./VToolbar-1392324c.js";const Re=m("p",{class:"my-4"},[l(" Payments are non-refundable, please check our "),m("a",{target:"_blank",href:"https://www.scotiacon.org.uk/policies"},"policies"),l(" for further information. ")],-1),De=m("p",{class:"my-4"}," You must be over 18 to attend the convention and be able to produce valid ID matching the details on your registration. ",-1),Pe=m("p",{class:"my-4"}," If you are unable to provide valid ID when asked at the convention you will not be issued your attendee badge. ",-1),be=m("p",{class:"my-4"}," Payments should be made by the authorised card holder only. ",-1),Fe=m("p",{class:"my-4"},[l(" Please contact "),m("a",{href:"mailto:registration@scotiacon.org.uk"},"registration@scotiacon.org.uk"),l(" if you need any further assistance. ")],-1),Ve=m("div",{id:"link-authentication-element"},null,-1),Oe=m("div",{id:"payment-element"},null,-1),Me=N({__name:"StripePayment",props:ae({paymentTransactions:{},registration:{}},{modelValue:{type:Boolean,required:!0}}),emits:["update:modelValue"],setup(p){const T=se(p,"modelValue"),k=K(),S=J(),c=le(),n=U(),f=U(),w=U((S==null?void 0:S.Additional.Email)||""),A=U(!1),$=U("");let F;const V=U(!1);q(T,r=>{r&&k.stripePublicKey().then(async d=>{d&&(f.value=await Te(d),await o(f.value))})});const O=r=>{$.value=r,A.value=!0};async function o(r){var b;if(!r)return;const d=await k.stripePaymentIntent(((b=p.registration)==null?void 0:b.RegistrationUUID)||""),y={theme:"stripe"};c.current.value.dark&&(y.theme="night"),F=r.elements({clientSecret:d,appearance:y});const R=F.create("linkAuthentication",{defaultValues:{email:w.value}});R.mount("#link-authentication-element"),R.on("change",z=>{w.value=z.value.email});const s={layout:"tabs"};F.create("payment",s).mount("#payment-element")}async function C(r,d){if(!d)return;r.preventDefault(),V.value=!0;const y=new URL(location.href);y.pathname+="payment/stripe/processing";const{error:R}=await d.confirmPayment({elements:F,confirmParams:{return_url:y.toString(),receipt_email:w.value}});R.type==="card_error"||R.type==="validation_error"?O(R.message):O("An unexpected error occurred."),V.value=!1}return(r,d)=>(e(),a(he,{modelValue:T.value,"onUpdate:modelValue":d[3]||(d[3]=y=>T.value=y),title:"Make a Payment",color:"blue-darken-4",fullscreen:"",persistent:""},{default:t(()=>[i(Q,{class:"pa-0"},{default:t(()=>[i(ge,{class:"mb-2",closable:!0},{title:t(()=>[l(" Payment Information ")]),text:t(()=>[Re,De,Pe,be,Fe]),_:1}),i(ke,{ref_key:"paymentForm",ref:n,id:"payment-form",onSubmit:d[0]||(d[0]=ie(y=>C(y,f.value),["prevent"]))},{default:t(()=>[i(L,null,{default:t(()=>[i(M,null,{default:t(()=>[Ve]),_:1})]),_:1}),i(L,null,{default:t(()=>[i(M,null,{default:t(()=>[Oe]),_:1})]),_:1}),i(L,null,{default:t(()=>[r.registration?(e(),a(M,{key:0,class:"font-weight-bold text-right"},{default:t(()=>[l(" Payment Amount: £"+g(r.registration.Total-r.registration.Paid),1)]),_:1})):_("",!0)]),_:1}),i(L,null,{default:t(()=>[i(M,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:t(()=>[i(v,{color:"error",class:"w-100"},{default:t(()=>[l("Cancel")]),_:1})]),_:1}),i(ne),i(M,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:t(()=>[i(v,{type:"submit",color:"success",class:"w-100"},re({default:t(()=>[l(" Pay Now ")]),_:2},[V.value?{name:"prepend",fn:t(()=>[i(Se,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),i(Ie,{modelValue:A.value,"onUpdate:modelValue":d[2]||(d[2]=y=>A.value=y)},{actions:t(()=>[i(v,{variant:"text",onClick:d[1]||(d[1]=y=>A.value=!1)},{default:t(()=>[l(" Close ")]),_:1})]),default:t(()=>[l(g($.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Ne={key:0},$e={key:1,class:"v-row"},Ye={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},xe={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Le={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},ze={key:1,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Ge={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Be={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},He={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},je=m("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1),qe={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Ke=m("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Current Payments ",-1),Je={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Qe=m("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance Due ",-1),We={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Xe=N({__name:"AttendeeTransactionList",props:{paymentTransactions:{},registration:{}},setup(p){const T=p,k=U(X(T.paymentTransactions));q(T,()=>{k.value=X(T.paymentTransactions)});const S=(c,n)=>c.Type===x.PAYMENT_TRANSACTION_TYPE_CHARGE&&n.Type!==x.PAYMENT_TRANSACTION_TYPE_CHARGE?-1:c.Type!==x.PAYMENT_TRANSACTION_TYPE_CHARGE&&n.Type===x.PAYMENT_TRANSACTION_TYPE_CHARGE||(c.UpdatedAt||0)>(n.UpdatedAt||0)?1:c.UpdatedAt===n.UpdatedAt?0:-1;return(c,n)=>c.registration.Total==0?(e(),u("p",Ne," Your registration is currently being processed, payment information will appear here when ready. ")):(e(),u("dl",$e,[(e(!0),u(E,null,B(k.value.sort(S),f=>{var w;return e(),u(E,{key:f.PaymentTransactionUUID},[f.Type===h(x).PAYMENT_TRANSACTION_TYPE_CHARGE?(e(),u("dt",Ye,[m("div",xe,g(f.Description.split(":")[0]),1),m("div",Le,g(f.Description.split(":")[1]),1)])):(e(),u("dt",ze,[m("div",Ge,g((w=h(fe).find(A=>A.value===f.Type))==null?void 0:w.title),1),m("div",Be," [ "+g(h(_e)(f.UpdatedAt||""))+" ] "+g(f.Description),1)])),m("dd",He," £"+g(f.Amount),1)],64)}),128)),je,m("dd",qe," £"+g(c.registration.Total),1),Ke,m("dd",Je," £"+g(c.registration.Paid),1),Qe,m("dd",We," £"+g(c.registration.Total-c.registration.Paid),1)]))}}),Ze=p=>(ue("data-v-d218a137"),p=p(),ce(),p),et=["innerHTML"],tt={key:0},ot={key:0,class:"font-weight-bold float-left pt-1 w-50"},nt={key:1,class:"pa-1"},at={key:0,class:"font-weight-bold float-left pt-1 w-50"},st={key:1},lt={class:"font-weight-bold float-left pt-1 w-50"},it={class:"text-red-darken-4"},rt={key:1,class:"text-red-darken-4 mt-4"},ut=Ze(()=>m("strong",null,"There are forms above that require completion, please edit and save them.",-1)),ct=[ut],dt=N({__name:"OpenConvention",props:{convention:{},forms:{default:()=>[]}},setup(p){const T=ve(),k=K(),{getPaymentTransactions:S}=ye(),c=U(T.GetConventionLogoURL(p.convention.ConventionUUID)),n=U(),f=U([]),w=U(!1),A=Y(()=>{var o;return G(p.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_REGISTRATION)}),$=Y(()=>{var o;return G(p.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_DEALER)}),F=Y(()=>{var o;return G(p.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_ACCOMMODATION)}),V=Y(()=>{var o;return G(p.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_ADDITIONAL)}),O=Y(()=>{var o,C;return n.value&&((o=n.value)!=null&&o.Submissions)?!!((C=n.value)!=null&&C.Submissions.find(r=>{var d;return((d=r.Form)==null?void 0:d.Type)==I.FORM_TYPE_REGISTRATION&&(r.Status==Z.SUBMISSION_STATUS_ACCEPTED||r.Status==Z.SUBMISSION_STATUS_CONFIRMED)})):!1});return q(()=>p.forms,()=>{k.getRegistrationByConvention(p.convention.ConventionUUID).then(o=>{var C;o&&(o.Submissions?(o.Submissions.forEach((r,d)=>{r.Form||(o.Submissions[d].Form=p.forms.find(y=>y.FormUUID===r.FormUUID))}),pe(o.Submissions)):o.Submissions=[],n.value=o,O.value&&S(((C=n.value)==null?void 0:C.RegistrationUUID)||"").then(r=>{f.value=r}))})}),(o,C)=>{const r=j("router-link"),d=j("RouterLink");return e(),a(Ce,{class:"elevation-5 flex-1-0 d-flex flex-column"},{default:t(()=>[i(we,{class:"flex-1-1 align-content-start"},{default:t(()=>[c.value?(e(),a(Ee,{key:0,src:c.value,title:o.convention.Name,class:"logo text-center"},null,8,["src","title"])):_("",!0),o.convention.Name?(e(),a(ee,{key:1,class:"text-center"},{default:t(()=>[l(g(o.convention.Name),1)]),_:1})):_("",!0),o.convention.Description?(e(),a(Ue,{key:2,class:"text-wrap subtitle"},{default:t(()=>[m("div",{innerHTML:o.convention.Description},null,8,et)]),_:1})):_("",!0)]),_:1}),i(te,null,{default:t(()=>{var y,R;return[n.value?(e(),u("dl",tt,[n.value.Reference?(e(),u("dt",ot," Badge No: ")):_("",!0),n.value.Reference?(e(),u("dd",nt," #"+g(n.value.Reference),1)):_("",!0),(e(!0),u(E,null,B((y=n.value)==null?void 0:y.Submissions,s=>{var D,b,z,W;return e(),u(E,{key:s.SubmissionUUID},[s.Form?(e(),u(E,{key:0},[s.Form?(e(),u("dt",at,g(s.Form.Heading),1)):_("",!0),s.Form?(e(),u("dd",st,[l(g(h(me)(s.Status))+" ",1),((D=s.Form)==null?void 0:D.Type)===h(I).FORM_TYPE_REGISTRATION?(e(),a(r,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/registration`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&A.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((b=s.Form)==null?void 0:b.Type)===h(I).FORM_TYPE_ACCOMMODATION?(e(),a(r,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/accommodation`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&F.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((z=s.Form)==null?void 0:z.Type)===h(I).FORM_TYPE_DEALER?(e(),a(r,{key:2,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/dealer`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&$.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((W=s.Form)==null?void 0:W.Type)===h(I).FORM_TYPE_ADDITIONAL?(e(),a(r,{key:3,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/additional`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&V.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):_("",!0)])):_("",!0)],64)):_("",!0)],64)}),128)),((R=n.value)==null?void 0:R.Submissions.length)>=1?(e(!0),u(E,{key:2},B(o.forms,s=>{var D;return e(),u(E,{key:s.FormUUID},[(D=n.value)!=null&&D.Submissions.find(b=>b.FormUUID===s.FormUUID)?_("",!0):(e(),u(E,{key:0},[m("dt",lt,g(s.Heading),1),m("dd",it,[l(" Requires Completion "),s.Type===h(I).FORM_TYPE_REGISTRATION?(e(),a(r,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/registration`},{default:t(()=>[s.State.Edit&&A.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===h(I).FORM_TYPE_ACCOMMODATION?(e(),a(r,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/accommodation`},{default:t(()=>[s.State.Edit&&F.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===h(I).FORM_TYPE_DEALER?(e(),a(r,{key:2,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/dealer`},{default:t(()=>[s.State.Edit&&$.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===h(I).FORM_TYPE_ADDITIONAL?(e(),a(r,{key:3,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/additional`},{default:t(()=>[s.State.Edit&&V.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):_("",!0)])],64))],64)}),128)):_("",!0)])):_("",!0),n.value&&n.value.Submissions.length>=1&&o.forms.filter(s=>{var D;return!((D=n.value)!=null&&D.Submissions.find(b=>b.FormUUID==s.FormUUID))}).length?(e(),u("div",rt,ct)):_("",!0)]}),_:1}),O.value&&n.value?(e(),u(E,{key:0},[i(ee,{class:"pb-4 text-center"},{default:t(()=>[l("Payment Information")]),_:1}),i(te,null,{default:t(()=>[i(Xe,{"payment-transactions":f.value,registration:n.value},null,8,["payment-transactions","registration"])]),_:1})],64)):_("",!0),i(Ae,null,{default:t(()=>{var y,R;return[o.convention.DetailLink?(e(),a(v,{key:0,color:"orange",href:o.convention.DetailLink},{default:t(()=>[l(g(h(H).buttonDetails),1)]),_:1},8,["href"])):_("",!0),i(ne),A.value?(e(),u(E,{key:1},[(y=n.value)!=null&&y.Submissions.find(s=>{var D;return((D=s.Form)==null?void 0:D.Type)===h(I).FORM_TYPE_REGISTRATION})?(e(),a(d,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}`},{default:t(()=>[i(v,{color:"primary"},{default:t(()=>[l(g(h(H).buttonViewRegistration),1)]),_:1})]),_:1},8,["to"])):(e(),u(E,{key:0},[(R=o.forms.find(s=>s.Type===h(I).FORM_TYPE_REGISTRATION))!=null&&R.State.New?(e(),a(d,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}`},{default:t(()=>[i(v,{color:"primary"},{default:t(()=>[l(g(h(H).buttonRegister),1)]),_:1})]),_:1},8,["to"])):_("",!0)],64))],64)):O.value&&n.value&&n.value.Total>n.value.Paid?(e(),u(E,{key:2},[i(v,{color:"success",variant:"elevated",onClick:C[0]||(C[0]=s=>w.value=!0)},{default:t(()=>[l("Make Payment")]),_:1}),n.value?(e(),a(Me,{key:0,"payment-transactions":f.value,registration:n.value,modelValue:w.value,"onUpdate:modelValue":C[1]||(C[1]=s=>w.value=s)},null,8,["payment-transactions","registration","modelValue"])):_("",!0)],64)):_("",!0)]}),_:1})]),_:1})}}});const mt=oe(dt,[["__scopeId","data-v-d218a137"]]),vt=N({__name:"Conventions",setup(p){const T=K(),k=U([]),S=U([]);return T.getOpenConventionsList().then(c=>{c&&(k.value=[...k.value,...c],T.getAvailableConventionForms(k.value.map(n=>n.ConventionUUID)).then(n=>{S.value=[...S.value,...n]}).catch(n=>{console.error(n)}))}),(c,n)=>(e(),a(Q,null,{default:t(()=>[i(L,{class:"justify-center"},{default:t(()=>[(e(!0),u(E,null,B(k.value,f=>(e(),a(M,{key:f.ConventionUUID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:t(()=>[i(mt,{convention:f,forms:S.value.filter(w=>w.ConventionUUID===f.ConventionUUID)},null,8,["convention","forms"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),pt={};function ft(p,T){return e(),u("div")}const _t=oe(pt,[["render",ft]]),yt=N({__name:"MainView",emits:["pageTitle"],setup(p,{emit:T}){T("pageTitle","Scotiacon Registration System"),sessionStorage.getItem("reload")==="true"&&(sessionStorage.removeItem("reload"),setTimeout(()=>{location.reload()},500));const S=localStorage.getItem("gjt_token"),c=localStorage.getItem("ajt_token");S?(localStorage.removeItem("gjt_token"),location.href=S):c&&(localStorage.removeItem("ajt_token"),location.href=c);const n=U(J());return(f,w)=>{const A=j("router-link");return e(),u(E,null,[n.value&&!n.value.Additional.Email?(e(),a(Q,{key:0,class:"bg-red-darken-4 text-center",fluid:!0},{default:t(()=>[l(" Please enter a Contact Email on the "),i(A,{to:"/profile",class:"text-white font-weight-bold"},{default:t(()=>[l("manage account page")]),_:1}),l(" to ensure we can contact you. ")]),_:1})):_("",!0),i(vt),i(_t)],64)}}}),Gt=N({__name:"Home",emits:["pageTitle"],setup(p,{emit:T}){const k=J();return T("pageTitle","Telegram Login"),(S,c)=>(e(),u("div",null,[h(k)?(e(),a(yt,{key:0,onPageTitle:c[0]||(c[0]=n=>T("pageTitle",n))})):(e(),a(de,{key:1}))]))}});export{Gt as default};
