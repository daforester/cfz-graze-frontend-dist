import{p as ia,n as sa,e as te,t as pe,c as Ha,G as Rt,v as t,H as L,x as Ve,I as Q,a0 as Z,a1 as me,r as A,K as Te,w as de,M as u,N as C,O as l,W as I,X as P,Q as R,V as T,a4 as W,P as O,S as $,a3 as _e,Y as ht,Z as kt,_ as ct,ac as ua,ad as qa,E as Je,k as ja,f as za,d as Qa,o as Ka,ae as jt,a2 as Xe,R as Ct,aa as lt,af as Wa,ag as rt,z as Ja,u as Xa,ah as Za,A as el,B as tl,D as al,s as ll,ai as dt,aj as zt,a7 as nl,a6 as ol,U as il}from"./index-a13ce8de.js";import{T as sl,V as ra,e as ul,d as rl,c as dl}from"./FormRenderer.vue_vue_type_style_index_0_lang-5177f51c.js";import{F as Ue,a as ml}from"./form-3a7bf7fd.js";import{u as ot,V as da}from"./VCheckbox-a0248995.js";import{_ as Ze}from"./ModelDialog.vue_vue_type_script_setup_true_lang-3ef7576a.js";import{h as Oe,b as ma,a as cl,c as vl,d as Qt,P as Vt,u as ca}from"./useDisplayTransactions-2e2c8d1c.js";import{V as K,a as M}from"./VRow-2cb2b821.js";import{V as We,a as Ge,c as va}from"./VList-b2cb02cf.js";import{V as ge}from"./copyToClipboard-da064ef6.js";import{u as fa,j as Ae,V as be,b as fl,m as Ul,k as gl,c as Al,d as Tl,l as _l,a as pl,n as yl}from"./VContainer-0c059b3f.js";import{G as it}from"./userData-0449de80.js";import{C as Ua}from"./canEditRegistrations-68b5b4be.js";import{V as H,a as Dl,u as Il}from"./VBtn-7ab2e771.js";import{b as ga,c as Mt,S as Aa,d as Kt}from"./submission-6136b51d.js";import{G as Nt}from"./group-d2a77946.js";import{C as Lt}from"./canDo-99eb87c2.js";import{v as ye}from"./v4-a960c1f4.js";import{a as Ft,V as Ye}from"./scopeId-c1a4fedb.js";import{V as wt}from"./VAvatar-eeb24497.js";import{s as El}from"./sortSubmissions-4bc1d48e.js";import{m as Sl,k as Rl,l as Cl,n as Vl,o as Ol,p as bl,q as hl,u as kl,r as Ml,s as Nl,t as Ll,v as Fl,w as wl,x as Pl,y as $l,z as Wt,A as Jt,B as Xt,g as Ta,h as _a,c as vt,d as ft,e as Pt,b as Ut,V as gt,a as pa,_ as ya,j as Da,i as Be,f as Ot}from"./VWindowItem-1546795b.js";import{V as xe,b as et,c as He,d as $t,e as Me}from"./VCard-c97fb22d.js";import{_ as nt,V as Ia}from"./SaveButton.vue_vue_type_script_setup_true_lang-8be1309b.js";import{V as ae}from"./VTextField-10836387.js";import{_ as Ea}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-b415ab61.js";import{a as Sa,V as bt}from"./VToolbar-006434ff.js";import{V as Bl}from"./VDivider-9b43062a.js";import{V as Gl}from"./VTextarea-d7223a4b.js";import{V as Yl,a as xl}from"./VChip-30fbc5ca.js";import{V as mt}from"./VDialog-b17bbb4c.js";import{V as Hl}from"./VForm-8e981779.js";import{V as ql,a as jl}from"./VAlert-b2febbd0.js";import{S as zl}from"./setupLogin-469519c7.js";import{V as Ql}from"./forwardRefs-fbcb17e9.js";import{u as Et}from"./nil-d01db1aa.js";import{V as Zt,a as Kl}from"./VTable-1546b86c.js";import"./index-26b71cef.js";import"./VFileInput-7f24f2f1.js";import"./createSimpleFunctional-a6d88f38.js";import"./VToolbarItems-b4dc981f.js";var ke=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(ke||{});const Wl=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var he=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(he||{});const Jl=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var j=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_ADMIN_FORM="META_DATA_SOURCE_ADMIN_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DATA_LAYOUT="META_DATA_SOURCE_DATA_LAYOUT",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(j||{});const Xl=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Data Display",value:"META_DATA_SOURCE_DATA_LAYOUT"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var oe=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(oe||{});const Zl=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],en=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},tn=e=>e===void 0?!1:Lt(e,Nt.GROUP_TYPE_SYSTEM).ManageUsers,an=ia({itemsLength:{type:[Number,String],required:!0},...Sl(),...Rl(),...Cl()},"VDataTableServer"),ln=sa()({name:"VDataTableServer",props:an(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,v)=>!0},setup(e,v){let{emit:o,slots:s}=v;const{groupBy:i}=Vl(e),{sortBy:r,multiSort:a,mustSort:n}=Ol(e),{page:d,itemsPerPage:c}=bl(e),g=te(()=>parseInt(e.itemsLength,10)),{columns:_,headers:m}=hl(e,{groupBy:i,showSelect:pe(e,"showSelect"),showExpand:pe(e,"showExpand")}),{items:f}=kl(e,_),{toggleSort:U}=Ml({sortBy:r,multiSort:a,mustSort:n,page:d}),{opened:k,isGroupOpen:q,toggleGroup:p,extractRows:N}=Nl({groupBy:i,sortBy:r}),{pageCount:h,setItemsPerPage:le}=Ll({page:d,itemsPerPage:c,itemsLength:g}),{flatItems:B}=Fl(f,i,k),{isSelected:ie,select:X,selectAll:E,toggleSelect:S,someSelected:V,allSelected:F}=wl(e,{allItems:f,currentPage:f}),{isExpanded:G,toggleExpand:ne}=Pl(e),fe=te(()=>N(f.value));$l({page:d,itemsPerPage:c,sortBy:r,groupBy:i,search:pe(e,"search")}),Ha("v-data-table",{toggleSort:U,sortBy:r}),Rt({VDataTableRows:{hideNoData:pe(e,"hideNoData"),noDataText:pe(e,"noDataText"),loading:pe(e,"loading"),loadingText:pe(e,"loadingText")}});const ce=te(()=>({page:d.value,itemsPerPage:c.value,sortBy:r.value,pageCount:h.value,toggleSort:U,setItemsPerPage:le,someSelected:V.value,allSelected:F.value,isSelected:ie,select:X,selectAll:E,toggleSelect:S,isExpanded:G,toggleExpand:ne,isGroupOpen:q,toggleGroup:p,items:fe.value,groupedItems:B.value,columns:_.value,headers:m.value}));fa(()=>{const[qe]=Wt.filterProps(e),[je]=Jt.filterProps(e),[tt]=Xt.filterProps(e),[ze]=Zt.filterProps(e);return t(Zt,Ve({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ze),{top:()=>{var Ie;return(Ie=s.top)==null?void 0:Ie.call(s,ce.value)},default:()=>{var Ie,Ne,Le,Fe;return s.default?s.default(ce.value):t(L,null,[(Ie=s.colgroup)==null?void 0:Ie.call(s,ce.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(Jt,Ve(je,{sticky:e.fixedHeader}),s)]),(Ne=s.thead)==null?void 0:Ne.call(s,ce.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[s.body?s.body(ce.value):t(Xt,Ve(tt,{items:B.value}),s)]),(Le=s.tbody)==null?void 0:Le.call(s,ce.value),(Fe=s.tfoot)==null?void 0:Fe.call(s,ce.value)])},bottom:()=>s.bottom?s.bottom(ce.value):t(Wt,qe,{prepend:s["footer.prepend"]})})})}}),nn=P("br",null,null,-1),on=P("h3",null,"Assigned Accommodation",-1),sn=P("br",null,null,-1),un=P("br",null,null,-1),rn=P("h3",null,"Accommodation Preferences",-1),dn=P("h3",null,"Selected Tickets",-1),mn=P("br",null,null,-1),cn=Q({__name:"EditAccommodationAssignmentDialog",props:Z({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Z(["update:field"],["update:modelValue"]),setup(e,{emit:v}){const o=e,{convention:s,registration:i,title:r=""}=o,a=_e(),n=me(e,"modelValue"),d=A({capacity:{max:E=>{var F;const S=h.value.find(G=>G.room.RoomUUID===E);return!S||S.room.MaximumCapacity===0?!0:(((F=m.value)==null?void 0:F.Members.length)||0)<=S.room.MaximumCapacity||"Too many people in the group for this room"},min:E=>{var F;const S=h.value.find(G=>G.room.RoomUUID===E);return!S||S.room.MinimumCapacity===0?!0:(((F=m.value)==null?void 0:F.Members.length)||0)>=S.room.MinimumCapacity||"Not enough people in the group for this room"}}}),c=A([]),g=ot(o,v,void 0,void 0,"field"),_=A(Te(g.value));de(g,()=>{_.value=Te(g.value)});const m=A(),f=A(""),U=A(""),k=A([]),q=A({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),p=async()=>{var F;const E=await a.getConventionAvailableAccommodation(s.ConventionUUID);E&&(c.value=E);const S=await a.getRegistrationGroup(i.RegistrationUUID||"");S&&(m.value=S);const V=await a.getConventionTickets(s.ConventionUUID);V&&(k.value=V);try{q.value=JSON.parse(((F=m.value)==null?void 0:F.TicketData)||"")}catch{}};de(f,()=>{U.value=h.value.length>0?h.value[0].value:""});const N=te(()=>{const E=le.value;return c.value.map(S=>{let V;return E.forEach(F=>{S.Costs.forEach(G=>{G.DateStart===(F==null?void 0:F.DateStart)&&G.DateEnd===F.DateEnd&&(V===void 0||V>G.Availability)&&(V=G.Availability)})}),{label:`${S.Name}`,title:`${S.Name} (${V} Available)`,value:S.AccommodationUUID}})}),h=te(()=>{const E=le.value,S=c.value.find(V=>V.AccommodationUUID===f.value);return(S==null?void 0:S.Pool.map(V=>{var G,ne;let F;return E.forEach(fe=>{V.Costs.forEach(ce=>{ce.DateStart===(fe==null?void 0:fe.DateStart)&&ce.DateEnd===fe.DateEnd&&(F===void 0||F>ce.Availability)&&(F=ce.Availability)})}),{label:`${(G=V.Venue)==null?void 0:G.Name} - ${V.Name}`,title:`${(ne=V.Venue)==null?void 0:ne.Name} - ${V.Name} (${F} Available)`,value:V.RoomUUID,room:V}}))||[]}),le=te(()=>[...q.value.Ticket,...q.value.AddonsChecked,...q.value.ComponentsChecked].map(E=>k.value.find(S=>S.TicketUUID===E)).filter(E=>E!==void 0&&E.RequiresAccommodation)),B=E=>{var S;a.assignAccommodation(((S=m.value)==null?void 0:S.Registration.RegistrationUUID)||"",f.value,U.value,!1).then(V=>{V?(p(),E&&E("Room Assigned")):E&&E("Room not assigned")}).catch(()=>{E&&E("Room not assigned")})},ie=E=>{var S,V;(S=m.value)!=null&&S.Registration.AllocationUUID?a.deleteAllocation(((V=m.value)==null?void 0:V.Registration.AllocationUUID)||"").then(F=>{F?(p(),E&&E("Allocation Deleted")):E&&E("Allocation not deleted")}).catch(()=>{E&&E("Allocation not deleted")}):E&&E("Nothing to Delete")},X=E=>{var V,F;const S=(V=c.value.find(G=>G.AccommodationUUID===E.AccommodationUUID))==null?void 0:V.Pool;if(S){const G=S.find(ne=>ne.RoomUUID===E.RoomUUID);if(G)return`${(F=G.Venue)==null?void 0:F.Name} - ${G.Name}`}return""};return p(),(E,S)=>{var V;return u(),C(Ze,{modelValue:n.value,"onUpdate:modelValue":S[2]||(S[2]=F=>n.value=F),title:I(r),color:"primary","show-close-action":!0,"show-delete-action":!!((V=m.value)!=null&&V.Registration.Allocation),"show-save-action":!!U.value,"save-button-label":"Assign Room",onDelete:ie,onSave:B,fullscreen:!0,persistent:!0},{default:l(()=>[t(Ae,{class:"pa-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>{var F;return[t(M,{cols:"12",md:"6"},{default:l(()=>{var G,ne;return[P("h3",null,"Group Members ("+R((G=m.value)==null?void 0:G.Members.length)+")",1),(u(!0),T(L,null,W((ne=m.value)==null?void 0:ne.Members,fe=>(u(),T(L,{key:fe.UUID},[O(" #"+R(fe.Reference)+" "+R(fe.Name),1),nn],64))),128))]}),_:1}),(F=m.value)!=null&&F.Registration.Allocation?(u(),C(M,{key:0,cols:"12",md:"6"},{default:l(()=>[on,t(We,null,{default:l(()=>{var G;return[(u(!0),T(L,null,W((G=m.value)==null?void 0:G.Registration.Allocation.Periods,ne=>(u(),C(Ge,{key:ne.AllocationPeriodUUID},{default:l(()=>{var fe;return[O(R((fe=c.value.find(ce=>ce.AccommodationUUID===ne.AccommodationUUID))==null?void 0:fe.Name)+" ",1),sn,O(" "+R(X(ne))+" ",1),un,P("small",null,"("+R(I(Oe)(ne.DateStart))+" - "+R(I(Oe)(ne.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):$("",!0)]}),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12",md:"6"},{default:l(()=>[E.selectedAccommodation.length?(u(),T(L,{key:0},[rn,t(We,null,{default:l(()=>[(u(!0),T(L,null,W(E.selectedAccommodation,(F,G)=>(u(),C(Ge,{key:F.AccommodationUUID},{default:l(()=>[O(R(G+1)+". "+R(F.Name),1)]),_:2},1024))),128))]),_:1})],64)):$("",!0)]),_:1}),t(M,{cosl:"12",md:"6"},{default:l(()=>[dn,t(We,null,{default:l(()=>[(u(!0),T(L,null,W(le.value,F=>(u(),C(Ge,{key:F==null?void 0:F.TicketUUID},{default:l(()=>[O(R(F.Name)+" ",1),mn,P("small",null,"("+R(I(Oe)(F.DateStart))+" - "+R(I(Oe)(F.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12",md:"6"},{default:l(()=>[t(ge,{modelValue:f.value,"onUpdate:modelValue":S[0]||(S[0]=F=>f.value=F),items:N.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(M,{cols:"12",md:"6"},{default:l(()=>[t(ge,{modelValue:U.value,"onUpdate:modelValue":S[1]||(S[1]=F=>U.value=F),items:h.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[d.value.capacity.min,d.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),vn=e=>(ht("data-v-33548a38"),e=e(),kt(),e),fn={key:0,class:"accommodationList"},Un={key:0,class:"text-orange-darken-2"},gn={key:1,class:"accommodationList"},An=vn(()=>P("br",null,null,-1)),Tn=Q({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const v=it(),o=Ua(v,e.convention),s=A(!1),i=te(()=>e.registration.Allocation.Periods.map(n=>{var d;return{DateStart:n.DateStart,DateEnd:n.DateEnd,Accommodation:n.Accommodation||((d=e.accommodations)==null?void 0:d.find(c=>c.AccommodationUUID==n.AccommodationUUID))}}).sort((n,d)=>n.DateStart>d.DateStart?1:n.DateStart==d.DateStart?0:-1));e.registration&&e.registration.Allocation&&e.registration.Allocation.Periods&&e.registration.Allocation.Periods.forEach(n=>{var c;if(n.Accommodation)return;const d=(c=e.accommodations)==null?void 0:c.find(g=>g.AccommodationUUID==n.AccommodationUUID);d&&(n.Accommodation=d)});const r=te(()=>{if(!e.value)return[];const n=JSON.parse(e.value),d=e.accommodations.filter(c=>n.includes(c.AccommodationUUID)).sort((c,g)=>{const _=n.findIndex(f=>f===c.AccommodationUUID),m=n.findIndex(f=>f===g.AccommodationUUID);return _>m?1:-1});return Te(d)}),a=te(()=>{let n;const d=e.forms.find(c=>!!c.Sections.find(g=>{var _;return g.Fields?!!((_=g.Fields)!=null&&_.find(m=>{var f;return((f=m.Field)==null?void 0:f.Type)==="TICKET"?(n=m,!0):!1})):!1}));return n?!!e.registration.Submissions.find(c=>{if(c.FormUUID==(d==null?void 0:d.FormUUID))return!!c.Data.find(g=>{if(g.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const _=JSON.parse(g.Data);return e.tickets.filter(m=>m.RequiresAccommodation).find(m=>_.Ticket.includes(m.TicketUUID)||_.AddonsChecked.includes(m.TicketUUID)||_.ComponentsChecked.includes(m.TicketUUID))}})}):!1});return(n,d)=>a.value?(u(),T(L,{key:0},[n.value?(u(),T("ol",fn,[(u(!0),T(L,null,W(r.value,c=>(u(),T("li",{key:c.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(g=>g.AccommodationUUID===c.AccommodationUUID)?(u(),T("strong",Un,R(c.Name),1)):(u(),T(L,{key:1},[O(R(c.Name),1)],64))]))),128))])):(u(),T("ul",gn,[(u(!0),T(L,null,W(i.value,c=>{var g;return u(),T("li",{key:c.DateStart},[O(R((g=c.Accommodation)==null?void 0:g.Name)+" ("+R(I(Oe)(c.DateStart))+" - "+R(I(Oe)(c.DateEnd))+")",1),An])}),128))])),I(o)?(u(),C(H,{key:2,onClick:d[0]||(d[0]=c=>s.value=!0),variant:"flat",color:"success"},{default:l(()=>[O("Assign Accommodation")]),_:1})):$("",!0),n.convention&&s.value?(u(),C(cn,{key:3,modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=c=>s.value=c),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,tickets:n.tickets,"selected-accommodation":r.value},null,8,["modelValue","convention","registration","tickets","selected-accommodation"])):$("",!0)],64)):$("",!0)}});const Ra=ct(Tn,[["__scopeId","data-v-33548a38"]]),_n={key:0,class:"addonList"},pn={key:0},yn={key:0},Dn=Q({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const v=te(()=>{if(!e.value)return;const o=JSON.parse(e.value),s=Object.keys(o),i=Te(e.extras);return i.forEach(r=>{r.Options=r.Options.filter(a=>s.includes(a.OptionUUID)?(a.Choices=a.Choices.filter(n=>n.TagUUID===o[a.OptionUUID].choiceId),o[a.OptionUUID].checked):!1)}),i.filter(r=>r.Options.length>0),i});return(o,s)=>o.value?(u(),T("ul",_n,[(u(!0),T(L,null,W(v.value,i=>(u(),T(L,{key:i.ExtraUUID},[i.Options.length?(u(),T("li",pn,[P("strong",null,R(i.Name),1),P("ul",null,[(u(!0),T(L,null,W(i.Options,r=>(u(),T("li",{key:r.OptionUUID},[O(R(r.Name)+" ",1),r.Choices.length==1?(u(),T("small",yn,"("+R(r.Choices[0].Title)+")",1)):$("",!0)]))),128))])])):$("",!0)],64))),128))])):$("",!0)}});const Ca=ct(Dn,[["__scopeId","data-v-55786e01"]]),In={key:0},Va=Q({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const v=te(()=>{if(!e.value)return;const o=JSON.parse(e.value);return Object.entries(o).filter(([,s])=>s).map(([s,i])=>e.interests.find(r=>r.InterestUUID===s)).filter(s=>s!==void 0)});return(o,s)=>o.value?(u(),T("ul",In,[(u(!0),T(L,null,W(v.value,i=>(u(),T("li",{key:i.InterestUUID},R(i.Name),1))),128))])):$("",!0)}}),En=P("br",null,null,-1),Sn=P("small",null,"Options:",-1),Rn=P("br",null,null,-1),Cn=P("small",null,"Addons:",-1),Oa=Q({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const v=te(()=>{if(!e.value)return;let o={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{o=JSON.parse(e.value),"ticket"in o&&(o.Ticket=o.ticket),"addonsChecked"in o&&(o.AddonsChecked=o.addonsChecked),"componentsChecked"in o&&(o.ComponentsChecked=o.componentsChecked)}catch{}return o.Ticket.filter(s=>{const i=e.tickets.find(r=>r.TicketUUID===s);return!(!i||i.Type!==sl.TICKET_TYPE_TICKET)}).map(s=>{const i=e.tickets.find(a=>a.TicketUUID===s),r=Te(i);return r.TicketComponents=i.TicketComponents.filter(a=>o.ComponentsChecked.includes(a.TicketUUID)),r.AddonTickets=i.AddonTickets.filter(a=>o.AddonsChecked.includes(a.TicketUUID)),r})});return(o,s)=>o.value?(u(!0),T(L,{key:0},W(v.value,i=>(u(),T("div",{key:i.TicketUUID},[P("strong",null,R(i.Name),1),i.TicketComponents.length>0?(u(),T(L,{key:0},[En,Sn,O("  "),(u(!0),T(L,null,W(i.TicketComponents,r=>(u(),T(L,{key:r.TicketUUID},[P("small",null,R(r.Name),1),O("  ")],64))),128))],64)):$("",!0),i.AddonTickets.length>0?(u(),T(L,{key:1},[Rn,Cn,O("  "),(u(!0),T(L,null,W(i.AddonTickets,r=>(u(),T("small",{key:r.TicketUUID},[O("("),P("em",null,R(r.Name),1),O(")")]))),128))],64)):$("",!0)]))),128)):$("",!0)}}),ba=Q({__name:"DataPanelAccommodation",props:Z({accommodations:{},convention:{},data:{},forms:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){return me(e,"modelValue"),(v,o)=>(u(),T("div",null,[t(Ra,{value:v.data,accommodations:v.accommodations,convention:v.convention,forms:v.forms,registration:v.registration,tickets:v.tickets,venues:v.venues},null,8,["value","accommodations","convention","forms","registration","tickets","venues"])]))}}),Vn={key:0,class:"text-red-darken-4 font-weight-bold"},On={key:1,class:"text-orange-darken-2 font-weight-bold"},bn=Q({__name:"DataPanelAge",props:Z({data:{},forms:{},registration:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=me(e,"modelValue"),o=new Date,s=o.getFullYear(),i=(o.getMonth()+1).toLocaleString("en-US",{minimumIntegerDigits:2}),r=o.getDate().toLocaleString("en-US",{minimumIntegerDigits:2}),a=A(!1),n=A(`${s}-${i}-${r}`),d=A(18);e.forms.find(m=>m.Sections.find(f=>f.Fields?f.Fields.find(U=>{var k;return U.SectionFieldUUID===v.value.SectionFieldUUID?(v.value.SectionField=U,(k=U.Field)==null||k.Values.forEach(q=>{switch(q.Title){case"UNDER_AGE_APPLY_TAG":q.Value.length>0&&(a.value=!0);break;case"BEFORE_DATE":n.value=q.Value;break;case"MIN_AGE":d.value=parseInt(q.Value);break}}),!0):!1}):!1));const c=m=>({registration:g(m,e.registration.CreatedAt||"",d.value),convention:g(m,n.value,d.value)}),g=(m,f,U)=>{if(m>=f)return!1;const k=_(m),p=_(f).getTime()-k.getTime(),N=1e3*60*60*24*365.25;return p/N>=U},_=m=>{const[f,U,k]=m.split("-");return new Date(parseInt(f),parseInt(U)-1,parseInt(k))};return(m,f)=>(u(),T("div",null,[P("p",null,[O(R(I(Oe)(m.data,{withDay:!1,withYear:!0}))+" ",1),a.value&&c(m.data).convention&&c(m.data).registration?(u(),C(be,{key:0,icon:"mdi:mdi-check",color:"success"})):a.value&&!c(m.data).convention?(u(),C(be,{key:1,icon:"mdi:mdi-alert",color:"error"})):a.value&&c(m.data).convention&&!c(m.data).registration?(u(),C(be,{key:2,icon:"mdi:mdi-alert",color:"warning"})):$("",!0)]),a.value?(u(),T(L,{key:0},[c(m.data).convention?c(m.data).registration?$("",!0):(u(),T("p",On," Attendee was under "+R(d.value)+" at time of registration ",1)):(u(),T("p",Vn," Attendee is under "+R(d.value),1))],64)):$("",!0)]))}}),hn={key:4},kn={key:5},Mn={key:6},Nn=Q({__name:"FormDataItem",props:Z({accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=me(e,"modelValue"),o=te(()=>{var a,n,d,c;const i=v.value,r=()=>{var g;for(let _=0;_<e.forms.length;_+=1)for(let m=0;m<e.forms[_].Sections.length;m+=1)if(e.forms[_].Sections[m].Fields){const f=(g=e.forms[_].Sections[m].Fields)==null?void 0:g.find(U=>U.SectionFieldUUID===i.SectionFieldUUID);if(f)return f}};return((n=(a=i.SectionField)==null?void 0:a.Field)==null?void 0:n.Type)||((c=(d=r())==null?void 0:d.Field)==null?void 0:c.Type)}),s=te(()=>{for(let i=0;i<e.registration.Submissions.length;i+=1){const a=e.registration.Submissions[i].Data.find(n=>n.SectionFieldUUID===v.value.SectionFieldUUID);if(a)return a.Data}return""});return(i,r)=>o.value==="ACCOMMODATION"?(u(),C(ba,{key:0,convention:i.convention,tickets:i.tickets,accommodations:i.accommodations,venues:i.venues,registration:i.registration,forms:i.forms,modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=a=>v.value=a),data:s.value},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue","data"])):o.value==="EXTRAS"?(u(),C(Ca,{key:1,value:s.value,extras:i.extras},null,8,["value","extras"])):o.value==="TICKET"?(u(),C(Oa,{key:2,value:s.value,tickets:i.tickets},null,8,["value","tickets"])):o.value==="INTERESTS"?(u(),C(Va,{key:3,value:s.value,interests:i.interests},null,8,["value","interests"])):o.value==="CHECKBOX"?(u(),T("div",hn,[s.value?(u(),C(be,{key:0,icon:"mdi:mdi-check",color:"success"})):(u(),C(be,{key:1,icon:"mdi:mdi-close",color:"error"}))])):o.value==="AGE"?(u(),T("div",kn,[t(bn,{data:s.value,forms:i.forms,registration:i.registration,modelValue:v.value,"onUpdate:modelValue":r[1]||(r[1]=a=>v.value=a)},null,8,["data","forms","registration","modelValue"])])):(u(),T("div",Mn,R(s.value),1))}}),Ln={key:0},Fn={key:0},wn=P("strong",null,"Total:",-1),Pn=Q({__name:"DataPanelRegistrationGroup",props:{registration:{}},setup(e){const v=te(()=>{const o=[];let s;return e.registration.Leader?s=e.registration:s=e.registration.Primary,o.push({Name:s.User.DisplayName,UUID:s.UserUUID,UserUUID:s.User.UserUUID,IsLeader:!0,Reference:s.Reference,Paid:s.Paid,Total:s.Total}),o.push(...s.Members.map(i=>({Name:i.User.DisplayName,UUID:i.UserUUID,UserUUID:i.User.UserUUID,IsLeader:!1,Reference:i.Reference,Paid:i.Paid,Total:i.Total}))),o});return(o,s)=>o.registration.Members.length===0&&!o.registration.Primary?(u(),T("em",Ln," Not in a group ")):(u(),T(L,{key:1},[P("ul",null,[(u(!0),T(L,null,W(v.value,i=>(u(),T("li",{key:i.UUID,class:"ml-0"},[O(" #"+R(i.Reference)+" : "+R(i.Name)+" ",1),i.IsLeader?(u(),T("strong",Fn,"(Leader)")):$("",!0)]))),128))]),wn,O(" "+R(v.value.length),1)],64))}}),$n=Q({__name:"DataPanelSubmissionDate",props:{registration:{}},setup(e){const v=te(()=>{const o=e.registration.Submissions.find(s=>{var i;return((i=s.Form)==null?void 0:i.Type)===Ue.FORM_TYPE_REGISTRATION});return o?o.CreatedAt||"":e.registration.CreatedAt||""});return(o,s)=>(u(),T("div",null,R(I(Oe)(v.value,{withDay:!1,withYear:!0})),1))}}),Bn={class:"text-grey-lighten-1"},Gn=Q({__name:"DataPanelSubmissionStatus",props:{convention:{},forms:{},registration:{}},emits:["showForm"],setup(e,{emit:v}){const o=it(),s=Ua(o,e.convention),i=te(()=>e.registration.Submissions.map(n=>{const d=e.forms.find(c=>c.FormUUID===n.FormUUID);if(d)return{Heading:d.Heading,Form:d,Submission:n,Registration:e.registration}}).filter(n=>!!n)),r=(n,d,c)=>{v("showForm",n,d,c)},a=n=>({ID:0,SubmissionUUID:ye(),FormID:n.ID,FormUUID:n.FormUUID,Form:n,UserID:e.registration.UserID,UserUUID:e.registration.UserUUID,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Registration:e.registration,Data:[],Status:Aa.SUBMISSION_STATUS_NULL});return(n,d)=>(u(),T(L,null,[P("ul",null,[(u(!0),T(L,null,W(n.forms.filter(c=>c.Type===I(Ue).FORM_TYPE_ADMIN&&i.value.findIndex(g=>g.Form.ID===c.ID)<0),c=>(u(),T("li",{key:c.Heading},[P("strong",Bn,R(c.Heading),1),I(s)?(u(),C(H,{key:0,class:"text-grey-lighten-1",icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:g=>r(n.registration,c,a(c))},null,8,["onClick"])):$("",!0)]))),128))]),P("ul",null,[(u(!0),T(L,null,W(i.value,c=>(u(),T("li",{key:c.Heading},[P("strong",null,[O(R(c.Heading),1),c.Form.Type!==I(Ue).FORM_TYPE_ADMIN?(u(),T(L,{key:0},[O(": ")],64)):$("",!0)]),c.Form.Type!==I(Ue).FORM_TYPE_ADMIN?(u(),T("span",{key:0,class:ua(I(ga)(c.Submission.Status))},R(I(Mt)(c.Submission.Status)),3)):$("",!0),I(s)?(u(),C(H,{key:1,icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:g=>r(c.Registration,c.Form,c.Submission)},null,8,["onClick"])):$("",!0)]))),128))])],64))}}),Yn={key:0,class:"text-blue"},xn={key:1,class:"text-red"},Hn={key:2,class:"text-orange"},qn={key:3,class:"text-orange"},jn={key:4,class:"text-orange"},zn={key:5,class:"text-orange"},Qn={key:6,class:"text-green"},Kn=Q({__name:"DataPanelPaymentStatus",props:{registration:{}},setup(e){const v=te(()=>{if(e.registration.Paid===0&&e.registration.Total)return"REQUIRED";if(e.registration.Total>e.registration.Paid)return"ADDITIONAL_REQUIRED";const o=e.registration.Members.find(s=>s.Paid===0&&(s.Total||0)>0);return o?e.registration.Total===0&&o.Total===0?"NOT_REQUIRED":e.registration.Total===0&&o.Total||e.registration.Total>0&&o.Total===0?"MISSING_REQUIRED":e.registration.Paid>=e.registration.Total?"AWAITING_PARTNER":"ALL_REQUIRED":e.registration.Total===0?"NOT_REQUIRED":"COMPLETE"});return(o,s)=>v.value=="NOT_REQUIRED"?(u(),T("div",Yn,"No Payment Requested")):v.value=="MISSING_REQUIRED"?(u(),T("div",xn,"Partner Payment Not Requested")):v.value=="AWAITING_PARTNER"?(u(),T("div",Hn,"Awaiting Partner Payment")):v.value=="ALL_REQUIRED"?(u(),T("div",qn,"Awaiting Payments")):v.value=="REQUIRED"?(u(),T("div",jn,"Awaiting Payment")):v.value=="ADDITIONAL_REQUIRED"?(u(),T("div",zn,"Awaiting Additional Payments")):(u(),T("div",Qn,"Completed"))}}),Wn=Q({__name:"MetaDataItem",props:Z({accommodations:{},convention:{},forms:{},interests:{},registration:{},tickets:{},venues:{}},{modelValue:{required:!0}}),emits:Z(["openActions","showForm"],["update:modelValue"]),setup(e,{emit:v}){const o=me(e,"modelValue"),s=r=>{v("openActions",r)},i=(r,a,n)=>{v("showForm",r,a,n)};return(r,a)=>o.value.MetaField===I(j).META_DATA_SOURCE_REGISTRATION_REFERENCE?(u(),T(L,{key:0},[O(R(r.registration.Reference),1)],64)):o.value.MetaField===I(j).META_DATA_SOURCE_REGISTRATION_GROUP?(u(),C(Pn,{key:1,registration:r.registration},null,8,["registration"])):o.value.MetaField===I(j).META_DATA_SOURCE_ACCOMMODATION_ALLOCATION?(u(),C(ba,{key:2,convention:r.convention,tickets:r.tickets,accommodations:r.accommodations,venues:r.venues,registration:r.registration,forms:r.forms,modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value=n),data:""},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue"])):o.value.MetaField===I(j).META_DATA_SOURCE_REGISTRATION_ACTIONS?(u(),C(H,{key:3,icon:"mdi:mdi-briefcase",variant:"flat",onClick:a[1]||(a[1]=n=>s(r.registration))})):o.value.MetaField===I(j).META_DATA_SOURCE_SUBMISSION_DATE?(u(),C($n,{key:4,registration:r.registration},null,8,["registration"])):o.value.MetaField===I(j).META_DATA_SOURCE_SUBMISSION_STATUS||o.value.MetaField===I(j).META_DATA_SOURCE_ACCOMMODATION_FORM||o.value.MetaField===I(j).META_DATA_SOURCE_ADMIN_FORM||o.value.MetaField===I(j).META_DATA_SOURCE_DEALER_FORM||o.value.MetaField===I(j).META_DATA_SOURCE_BADGE_FORM||o.value.MetaField===I(j).META_DATA_SOURCE_REGISTRATION_FORM?(u(),C(Gn,{key:5,convention:r.convention,forms:r.forms,registration:r.registration,onShowForm:i},null,8,["convention","forms","registration"])):o.value.MetaField===I(j).META_DATA_SOURCE_PAYMENT_STATUS?(u(),C(Kn,{key:6,registration:r.registration},null,8,["registration"])):(u(),T(L,{key:7},[O(" Unhandled Meta Item "+R(o.value),1)],64))}}),Jn=Q({__name:"UserDataItem",props:Z({accommodations:{},convention:{},forms:{},interests:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=me(e,"modelValue"),o=Ft(),s=te(()=>o.GetProfileImageURL(e.registration.UserUUID));return(i,r)=>v.value.UserField===I(oe).USER_DATA_SOURCE_TELEGRAM&&i.registration.User.Handle?(u(),T(L,{key:0},[O(" @"+R(i.registration.User.Handle),1)],64)):v.value.UserField===I(oe).USER_DATA_SOURCE_AVATAR?(u(),C(wt,{key:1,class:"rounded-circle",src:s.value,height:"32",width:"32"},null,8,["src"])):v.value.UserField===I(oe).USER_DATA_SOURCE_FIRST_NAME?(u(),T(L,{key:2},[O(R(i.registration.User.Additional.FirstName),1)],64)):v.value.UserField===I(oe).USER_DATA_SOURCE_LAST_NAME?(u(),T(L,{key:3},[O(R(i.registration.User.Additional.LastName),1)],64)):(u(),T(L,{key:4},[O(" Unhandled User Field "+R(v.value),1)],64))}}),Xn=Q({__name:"PanelItem",props:Z({accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0}}),emits:Z(["openActions","showForm"],["update:modelValue"]),setup(e,{emit:v}){const o=me(e,"modelValue"),s=r=>{v("openActions",r)},i=(r,a,n)=>{v("showForm",r,a,n)};return(r,a)=>o.value.SourceType===I(he).LAYOUT_ITEM_SOURCE_FORM?(u(),C(Nn,{key:0,accommodations:r.accommodations,convention:r.convention,extras:r.extras,forms:r.forms,interests:r.interests,registration:r.registration,tickets:r.tickets,venues:r.venues,modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value=n)},null,8,["accommodations","convention","extras","forms","interests","registration","tickets","venues","modelValue"])):o.value.SourceType===I(he).LAYOUT_ITEM_SOURCE_META?(u(),C(Wn,{key:1,accommodations:r.accommodations,convention:r.convention,forms:r.forms,interests:r.interests,registration:r.registration,tickets:r.tickets,venues:r.venues,modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=n=>o.value=n),onOpenActions:s,onShowForm:i},null,8,["accommodations","convention","forms","interests","registration","tickets","venues","modelValue"])):o.value.SourceType===I(he).LAYOUT_ITEM_SOURCE_USER?(u(),C(Jn,{key:2,accommodations:r.accommodations,convention:r.convention,forms:r.forms,interests:r.interests,registration:r.registration,tickets:r.tickets,venues:r.venues,modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=n=>o.value=n)},null,8,["accommodations","convention","forms","interests","registration","tickets","venues","modelValue"])):$("",!0)}}),Zn=Q({__name:"PanelLayout",props:{accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{},layout:{},registration:{}},emits:["openActions","showForm"],setup(e,{emit:v}){const o=i=>{v("openActions",i)},s=(i,r,a)=>{v("showForm",i,r,a)};return(i,r)=>(u(),C(K,null,{default:l(()=>[(u(!0),T(L,null,W(i.layout.Panels,a=>{var n,d,c,g,_,m;return u(),C(M,{key:a.LayoutPanelUUID,cols:((n=a.Meta.cols)==null?void 0:n.toString())||!1,xs:((d=a.Meta.cols_xs)==null?void 0:d.toString())||!1,sm:((c=a.Meta.cols_sm)==null?void 0:c.toString())||!1,md:((g=a.Meta.cols_md)==null?void 0:g.toString())||!1,lg:((_=a.Meta.cols_lg)==null?void 0:_.toString())||!1,xl:((m=a.Meta.cols_xl)==null?void 0:m.toString())||!1},{default:l(()=>[t(Ae,{class:"border rounded bg-white"},{default:l(()=>[P("h3",null,R(a.Name),1),t(We,{class:"bg-white"},{default:l(()=>[(u(!0),T(L,null,W(a.Items,(f,U)=>(u(),C(Ge,{key:f.LayoutItemUUID,class:"px-0"},{default:l(()=>[a.Items.length>1?(u(),C(va,{key:0,class:"font-weight-bold"},{default:l(()=>[O(R(f.Label),1)]),_:2},1024)):$("",!0),t(Xn,{accommodations:i.accommodations,convention:i.convention,extras:i.extras,forms:i.forms,interests:i.interests,tickets:i.tickets,venues:i.venues,modelValue:a.Items[U],"onUpdate:modelValue":k=>a.Items[U]=k,registration:i.registration,onOpenActions:o,onShowForm:s},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["cols","xs","sm","md","lg","xl"])}),128))]),_:1}))}}),eo=Q({__name:"DataTableItemPanel",props:{accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{},layouts:{},registration:{}},emits:["openActions","showForm"],setup(e,{emit:v}){const o=A(),s=A(!1),i=n=>{o.value=n,s.value=!0},r=n=>{v("openActions",n)},a=(n,d,c)=>{v("showForm",n,d,c)};return(n,d)=>(u(),T("div",null,[n.layouts?(u(),C(We,{key:0},{default:l(()=>[(u(!0),T(L,null,W(n.layouts,c=>(u(),C(Ge,{key:c.AdminLayoutUUID,class:"d-block pa-0 ma-0"},{default:l(()=>[t(va,{style:{"text-overflow":"inherit"},class:"overflow-visible text-wrap"},{default:l(()=>[t(H,{"prepend-icon":"mdi:mdi-page-layout-body",variant:"flat",onClick:g=>i(c)},{default:l(()=>[O(R(c.Name),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):$("",!0),s.value&&o.value?(u(),C(Ze,{key:1,modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=c=>s.value=c),"hide-extension":!0,fullscreen:!0,title:`#${n.registration.Reference} ${n.registration.User.DisplayName} - ${o.value.Name} `},{default:l(()=>[t(Zn,{accommodations:n.accommodations,convention:n.convention,extras:n.extras,forms:n.forms,interests:n.interests,tickets:n.tickets,venues:n.venues,layout:o.value,registration:n.registration,onOpenActions:r,onShowForm:a},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","layout","registration"])]),_:1},8,["modelValue","title"])):$("",!0)]))}}),to={class:"text-grey-lighten-1"},ao={key:0,class:"text-blue text-center"},lo={key:1,class:"text-red text-center"},no={key:2,class:"text-orange text-center"},oo={key:3,class:"text-orange text-center"},io={key:4,class:"text-orange text-center"},so={key:5,class:"text-orange text-center"},uo={key:6,class:"text-green text-center"},ro={key:0},mo={key:0},co=P("strong",null,"Total:",-1),vo=Q({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},user:{},venues:{}},emits:["openActions","openPayments","openTags","reload","showForm","switchUser"],setup(e,{emit:v}){const o=(a,n,d)=>{v("showForm",{registration:a,form:n,submission:d})},s=a=>{v("openActions",a)},i=a=>{v("switchUser",a)},r=a=>{const n=e.item.raw.registration;return{ID:0,SubmissionUUID:ye(),FormID:a.ID,FormUUID:a.FormUUID,Form:a,UserID:n.UserID,UserUUID:n.UserUUID,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Registration:n,Data:[],Status:Aa.SUBMISSION_STATUS_NULL}};return(a,n)=>a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(u(),C(Ra,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(u(),C(Ca,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(u(),C(Va,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(u(),C(Oa,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ADMIN_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(u(),T(L,{key:4},[P("ul",null,[(u(!0),T(L,null,W(a.forms.filter(d=>d.Type===I(Ue).FORM_TYPE_ADMIN&&a.item.raw[a.header.key].findIndex(c=>c.Form.ID===d.ID)<0),d=>(u(),T("li",{key:d.Heading},[P("strong",to,R(d.Heading),1),t(H,{class:"text-grey-lighten-1",icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:c=>o(a.item.raw.registration,d,r(d))},null,8,["onClick"])]))),128))]),P("ul",null,[(u(!0),T(L,null,W(a.item.raw[a.header.key],d=>(u(),T("li",{key:d.Heading},[P("strong",null,[O(R(d.Heading),1),d.Form.Type!==I(Ue).FORM_TYPE_ADMIN?(u(),T(L,{key:0},[O(": ")],64)):$("",!0)]),d.Form.Type!==I(Ue).FORM_TYPE_ADMIN?(u(),T("span",{key:0,class:ua(I(ga)(d.Submission.Status))},R(I(Mt)(d.Submission.Status)),3)):$("",!0),t(H,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:c=>o(d.Registration,d.Form,d.Submission)},null,8,["onClick"])]))),128))])],64)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(u(),C(wt,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(u(),T(L,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(u(),T("div",ao,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(u(),T("div",lo,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(u(),T("div",no,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(u(),T("div",oo,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(u(),T("div",io,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(u(),T("div",so,"Awaiting Additional Payments")):(u(),T("div",uo,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(u(),T(L,{key:7},[t(H,{icon:"mdi:mdi-briefcase",variant:"flat",onClick:n[0]||(n[0]=d=>s(a.item.raw[a.header.key]))}),I(tn)(a.user)?(u(),C(H,{key:0,icon:"mdi:mdi-account-switch-outline",variant:"flat",onClick:n[1]||(n[1]=d=>i(a.item.raw[a.header.key]))})):$("",!0)],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(u(),T(L,{key:8},[a.item.raw[a.header.key].length===1?(u(),T("em",ro," Not in a group ")):(u(),T(L,{key:1},[P("ul",null,[(u(!0),T(L,null,W(a.item.raw[a.header.key],d=>(u(),T("li",{key:d.UUID,class:"ml-0"},[O(" #"+R(d.Reference)+" : "+R(d.Name)+" ",1),d.IsLeader?(u(),T("strong",mo,"(Leader)")):$("",!0)]))),128))]),co,O(" "+R(a.item.raw[a.header.key].length),1)],64))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DATA_LAYOUT"?(u(),C(eo,{key:9,accommodations:a.accommodations,convention:a.convention,extras:a.extras,forms:a.forms,interests:a.interests,tickets:a.tickets,venues:a.venues,layouts:a.item.raw[a.header.key].Layouts,registration:a.item.raw[a.header.key].Registration,onOpenActions:s,onShowForm:o},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","layouts","registration"])):(u(),T(L,{key:10},[O(R(a.item.raw[a.header.key]),1)],64))}}),ea=Q({__name:"RegistrationActionTabs",props:Z({alignTabs:{},class:{},fixedTabs:{type:Boolean},showArrows:{type:[String,Boolean]},tabs:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=e,o=me(e,"modelValue");return(s,i)=>(u(),C(Ta,Ve({modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r)},v),{default:l(()=>[(u(!0),T(L,null,W(s.tabs,r=>(u(),C(_a,{value:r.value,key:r.value},{default:l(()=>[O(R(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},16,["modelValue"]))}}),fo=Q({__name:"Badges",props:{convention:{},registration:{}},setup(e){const v=_e(),o=Ft(),s=A([]),i=a=>{var d;const n=document.createElement("a");n.download=`${((d=e.convention)==null?void 0:d.Name)||""} Badge Image - ${e.registration.Reference} - ${e.registration.User.DisplayName}.jpg`,n.href=a,document.body.appendChild(n),n.click(),document.body.removeChild(n)},r=async a=>o.GetConBadgeImageURL(e.registration.RegistrationUUID,a);return v.getConBadgeList(e.registration.RegistrationUUID).then(a=>{a.forEach(n=>{r(n).then(d=>{s.value.push({template:n,url:d})})})}).catch(()=>{}),(a,n)=>(u(!0),T(L,null,W(s.value,d=>(u(),C(Me,{key:d.template},{default:l(()=>[t(et,null,{default:l(()=>[t(xe,null,{default:l(()=>[t(K,{class:"flex-row-reverse"},{default:l(()=>[t(M,{class:"text-wrap flex-grow-1"},{default:l(()=>[O(" Badges (#"+R(a.registration.Reference)+" "+R(a.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(He,null,{default:l(()=>[t(wt,{src:d.url,height:"280",width:"280"},null,8,["src"])]),_:2},1024),t($t,null,{default:l(()=>[t(H,{color:"primary","prepend-icon":"mdi:mdi-download",variant:"flat",onClick:c=>i(d.url)},{default:l(()=>[O("Download")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))}});var Uo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],go=function(e){return Uo.map(function(v){return v.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Ao=function(e,v,o){Object.keys(v).filter(go).forEach(function(s){var i=v[s];typeof i=="function"&&(s==="onInit"?i(e,o):o.on(s.substring(2),function(r){return i(r,o)}))})},To=function(e,v,o,s){var i=e.modelEvents?e.modelEvents:null,r=Array.isArray(i)?i.join(" "):i;de(s,function(a,n){o&&typeof a=="string"&&a!==n&&a!==o.getContent({format:e.outputFormat})&&o.setContent(a)}),o.on(r||"change input undo redo",function(){v.emit("update:modelValue",o.getContent({format:e.outputFormat}))})},_o=function(e,v,o,s,i,r){s.setContent(r()),o.attrs["onUpdate:modelValue"]&&To(v,o,s,i),Ao(e,o.attrs,s)},ta=0,ha=function(e){var v=Date.now(),o=Math.floor(Math.random()*1e9);return ta++,e+"_"+o+ta+String(v)},po=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},aa=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},yo=function(e,v){return aa(e).concat(aa(v))},Do=function(e){return e==null},la=function(){return{listeners:[],scriptId:ha("tiny-script"),scriptLoaded:!1}},Io=function(){var e=la(),v=function(i,r,a,n){var d=r.createElement("script");d.referrerPolicy="origin",d.type="application/javascript",d.id=i,d.src=a;var c=function(){d.removeEventListener("load",c),n()};d.addEventListener("load",c),r.head&&r.head.appendChild(d)},o=function(i,r,a){e.scriptLoaded?a():(e.listeners.push(a),i.getElementById(e.scriptId)||v(e.scriptId,i,r,function(){e.listeners.forEach(function(n){return n()}),e.scriptLoaded=!0}))},s=function(){e=la()};return{load:o,reinitialize:s}},Eo=Io(),So=function(){return typeof window<"u"?window:global},$e=function(){var e=So();return e&&e.tinymce?e.tinymce:null},Ro={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},Ee=globalThis&&globalThis.__assign||function(){return Ee=Object.assign||function(e){for(var v,o=1,s=arguments.length;o<s;o++){v=arguments[o];for(var i in v)Object.prototype.hasOwnProperty.call(v,i)&&(e[i]=v[i])}return e},Ee.apply(this,arguments)},Co=function(e,v,o,s){return e(s||"div",{id:v,ref:o})},Vo=function(e,v,o){return e("textarea",{id:v,visibility:"hidden",ref:o})},St={selector:void 0,target:void 0},Oo=Q({props:Ro,setup:function(e,v){var o=e.init?Ee(Ee({},e.init),St):Ee({},St),s=qa(e),i=s.disabled,r=s.modelValue,a=s.tagName,n=A(null),d=null,c=e.id||ha("tiny-vue"),g=e.init&&e.init.inline||e.inline,_=!!v.attrs["onUpdate:modelValue"],m=!0,f=e.initialValue?e.initialValue:"",U="",k=function(N){return _?function(){return r!=null&&r.value?r.value:""}:function(){return N?f:U}},q=function(){var N=k(m),h=Ee(Ee({},o),{readonly:e.disabled,target:n.value,plugins:yo(o.plugins,e.plugins),toolbar:e.toolbar||o.toolbar,inline:g,setup:function(le){d=le,le.on("init",function(B){return _o(B,e,v,le,r,N)}),typeof o.setup=="function"&&o.setup(le)}});po(n.value)&&(n.value.style.visibility=""),$e().init(h),m=!1};de(i,function(N){var h;d!==null&&(typeof((h=d.mode)===null||h===void 0?void 0:h.set)=="function"?d.mode.set(N?"readonly":"design"):d.setMode(N?"readonly":"design"))}),de(a,function(N){var h;_||(U=d.getContent()),(h=$e())===null||h===void 0||h.remove(d),Je(function(){return q()})}),ja(function(){if($e()!==null)q();else if(n.value&&n.value.ownerDocument){var N=e.cloudChannel?e.cloudChannel:"6",h=e.apiKey?e.apiKey:"no-api-key",le=Do(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(h,"/tinymce/").concat(N,"/tinymce.min.js"):e.tinymceScriptSrc;Eo.load(n.value.ownerDocument,le,q)}}),za(function(){$e()!==null&&$e().remove(d)}),g||(Qa(function(){m||q()}),Ka(function(){var N;_||(U=d.getContent()),(N=$e())===null||N===void 0||N.remove(d)}));var p=function(N){var h;U=d.getContent(),(h=$e())===null||h===void 0||h.remove(d),o=Ee(Ee(Ee({},o),N),St),Je(function(){return q()})};return v.expose({rerender:p,getEditor:function(){return d}}),function(){return g?Co(jt,c,n,e.tagName):Vo(jt,c,n)}}});const bo=["colspan"],ho=P("strong",null,"E-Mail Content",-1),ko=["innerHTML"],Mo=Q({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:v}){const o=_e(),s=A([]),i=A({From:"",Subject:"",HTML:""}),r=A(""),a=A(""),n=A(""),d=A(!1),c=A([]),g=A(["1"]),_=A([]),m=A([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),f=A([{key:"CreatedAt",order:"asc"}]);de(i,p=>{n.value=p.From||n.value||"",a.value=p.Subject||a.value||"",r.value=p.HTML||r.value||""});const U=()=>{o.getRegistrationEmails(e.registration.RegistrationUUID).then(p=>{p&&(p.forEach(N=>{N.CreatedAt=ma(new Date(N.CreatedAt||"")),N.Status=en(N.Status),N.User||(N.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),_.value=p)})};U(),(()=>{o.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(p=>{p&&(s.value=p)})})();const q=({callback:p})=>{o.sendRegistrationEmail(e.registration.RegistrationUUID,n.value,a.value,r.value).then(N=>{N?p&&(p("Email Sent"),U(),setTimeout(()=>{d.value=!1},2e3)):p&&p("Not sent")}).catch(()=>{p&&p("Not sent")})};return(p,N)=>(u(),T(L,null,[p.showEditor?(u(),T(L,{key:0},[t(K,null,{default:l(()=>[t(M,null,{default:l(()=>[t(ra,{items:s.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:i.value,"onUpdate:modelValue":N[0]||(N[0]=h=>i.value=h),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[t(ae,{modelValue:n.value,"onUpdate:modelValue":N[1]||(N[1]=h=>n.value=h),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(M,{cols:"12"},{default:l(()=>[t(ae,{modelValue:a.value,"onUpdate:modelValue":N[2]||(N[2]=h=>a.value=h),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(M,{cols:"12"},{default:l(()=>[t(I(Oo),{modelValue:r.value,"onUpdate:modelValue":N[3]||(N[3]=h=>r.value=h),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,null,{default:l(()=>[t(nt,{onClick:N[4]||(N[4]=h=>v("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(M,{class:"text-right"},{default:l(()=>[t(nt,{onClick:q,label:"Send",color:"error"})]),_:1})]),_:1})],64)):$("",!0),_.value.length&&!p.hideHistory?(u(),C(gt,{key:1,class:"my-2",multiple:!0,modelValue:g.value,"onUpdate:modelValue":N[7]||(N[7]=h=>g.value=h)},{default:l(()=>[t(Ut,{value:"1"},{default:l(()=>[t(vt,null,{default:l(()=>[O(" Email History ")]),_:1}),t(ft,null,{default:l(()=>[t(I(Pt),{items:_.value,headers:m.value,"show-expand":!0,"item-value":"EmailUUID",expanded:c.value,"onUpdate:expanded":N[5]||(N[5]=h=>c.value=h),"sort-by":f.value,"onUpdate:sortBy":N[6]||(N[6]=h=>f.value=h)},{"expanded-row":l(({columns:h,item:le})=>[P("tr",null,[P("td",{colspan:h.length},[ho,P("div",{class:"communicationsViewEmailPreview",innerHTML:le.raw.HTML},null,8,ko)],8,bo)])]),"footer.prepend":l(()=>[t(H,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:U},{default:l(()=>[O("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):$("",!0)],64))}});const No=Q({__name:"Emails",props:{registration:{}},setup(e){const v=A(!1);return(o,s)=>(u(),C(Me,null,{default:l(()=>[t(et,null,{default:l(()=>[t(xe,null,{default:l(()=>[O(" E-Mails (#"+R(o.registration.Reference)+" "+R(o.registration.User.DisplayName)+") ",1)]),_:1})]),_:1}),t(He,null,{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[t(H,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:s[0]||(s[0]=i=>v.value=!0)},{default:l(()=>[O("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Mo,{registration:o.registration,"show-editor":v.value,onCloseEditor:s[1]||(s[1]=i=>v.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1}))}}),Lo=Q({__name:"EditNoteCategoryDialog",props:Z({convention:{},noteCategory:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Z(["update:noteCategory"],["update:modelValue"]),setup(e,{emit:v}){const o=e,{title:s=""}=o,i=me(e,"modelValue"),r=ot(o,v,void 0,void 0,"noteCategory"),a=A(Te(r.value));de(r,()=>{a.value=Te(r.value)});const n=()=>{i.value=!1},d=()=>{a.value=Te(r.value)},c=()=>{r.value=a.value};return(g,_)=>(u(),C(Ze,{modelValue:i.value,"onUpdate:modelValue":_[2]||(_[2]=m=>i.value=m),onReset:d,onSave:c,title:I(s),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0},{default:l(()=>[t(Ae,{class:"pa-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6",md:"4"},{default:l(()=>[t(ae,{modelValue:a.value.Name,"onUpdate:modelValue":_[0]||(_[0]=m=>a.value.Name=m),label:"Internal name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(M,{cols:"12",sm:"6",md:"4"},{default:l(()=>[t(pa,{modelValue:a.value.Groups,"onUpdate:modelValue":_[1]||(_[1]=m=>a.value.Groups=m),convention:g.convention,label:"Groups",variant:"outlined","hide-details":""},null,8,["modelValue","convention"])]),_:1})]),_:1})]),_:1})]),actions:l(()=>[t(H,{color:"blue-darken-1",variant:"text",onClick:n},{default:l(()=>[O(" Cancel ")]),_:1}),t(H,{color:"blue-darken-1",variant:"text",onClick:d},{default:l(()=>[O(" Reset ")]),_:1}),t(Ye),t(H,{color:"blue-darken-1",variant:"text",onClick:c},{default:l(()=>[O(" Save ")]),_:1})]),_:1},8,["modelValue","title"]))}}),Fo=()=>{const e=A(""),v=()=>{const o={x:window.innerWidth,y:window.innerHeight};o.x<600?e.value="xs":o.x>=600&&o.x<960?e.value="sm":o.x>=960&&o.x<1280?e.value="md":o.x>=1280&&o.x<1920?e.value="lg":o.x>=1920&&o.x<2560?e.value="xl":o.x>=2560&&(e.value="xxl")};return window.addEventListener("resize",v),v(),e},wo={style:{"list-style":"none"}},Po=Q({__name:"NoteCategories",props:{hideHistory:{type:Boolean},convention:{},showEditor:{type:Boolean}},emits:["close"],setup(e,{emit:v}){const o=_e(),s=A(!1),i=A(!1),r=A(""),a=A([]),n=A([{key:"Name",title:"Name"},{key:"Groups",title:"Groups"},{key:"actions",title:"",sortable:!1}]),d=Fo();A([{key:"CreatedAt",order:"asc"}]);const c=()=>({ID:0,NoteCategoryUUID:ye(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"",Groups:[],Notes:[]}),g=A(-1),_=A(c()),m=A(c()),f=()=>{m.value.NoteCategoryUUID=ye(),_.value=Object.assign({},c()),g.value=-1,s.value=!0},U=B=>{g.value=a.value.indexOf(B),_.value=Object.assign({},B),s.value=!0},k=B=>{g.value=a.value.indexOf(B),_.value=Object.assign({},B),i.value=!0},q=()=>{o.deleteNoteCategory(_.value.NoteCategoryUUID).then(B=>{B&&(a.value.splice(g.value,1),N())})},p=()=>{s.value=!1,Je(()=>{_.value=Object.assign({},m.value),g.value=-1})},N=()=>{i.value=!1,Je(()=>{_.value=Object.assign({},m.value),g.value=-1})},h=()=>{o.saveNoteCategory(_.value).then(B=>{B&&(g.value>-1?Object.assign(a.value[g.value],B):a.value.push(B),p())})};return(()=>{o.getNoteCategories(e.convention.ConventionUUID).then(B=>{B&&(a.value=B)})})(),(B,ie)=>(u(),C(I(Pt),{headers:n.value,items:a.value,"sort-by":[{key:"calories",order:"asc"}],class:"elevation-1"},{top:l(()=>[t(bt,{color:"primary"},Xe({default:l(()=>[t(Sa,null,{default:l(()=>[O("Note Categories")]),_:1}),t(Bl,{class:"mx-4 d-none d-sm-inline-flex",inset:!0,vertical:!0}),t(Ye,{class:"d-none d-sm-inline-flex"}),I(d)!="xs"?(u(),C(H,{key:0,dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:f},{default:l(()=>[O(" New Item ")]),_:1})):$("",!0),t(H,{dark:"",class:"mb-2",icon:"mdi:mdi-window-close",onClick:ie[0]||(ie[0]=X=>v("close"))}),t(Ea,{modelValue:i.value,"onUpdate:modelValue":ie[1]||(ie[1]=X=>i.value=X),onDelete:q},null,8,["modelValue"])]),_:2},[I(d)=="xs"?{name:"extension",fn:l(()=>[t(Ye),t(H,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:f},{default:l(()=>[O(" New Item ")]),_:1})]),key:"0"}:void 0]),1024),s.value?(u(),C(Lo,{key:0,modelValue:s.value,"onUpdate:modelValue":ie[2]||(ie[2]=X=>s.value=X),"note-category":_.value,"onUpdate:noteCategory":[ie[3]||(ie[3]=X=>_.value=X),h],title:r.value,convention:B.convention},null,8,["modelValue","note-category","title","convention"])):$("",!0)]),"item.Groups":l(({item:X})=>[P("ul",wo,[(u(!0),T(L,null,W(X.selectable.Groups,E=>(u(),T("li",{key:E.GroupUUID,class:"py-1"},R(E.Name),1))),128))])]),"item.actions":l(({item:X})=>[t(be,{size:"small",class:"me-2",onClick:E=>U(X.raw)},{default:l(()=>[O(" mdi:mdi-pencil ")]),_:2},1032,["onClick"]),t(be,{size:"small",onClick:E=>k(X.raw)},{default:l(()=>[O(" mdi:mdi-delete ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"]))}}),$o=Q({__name:"SelectNoteCategories",props:Z({convention:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0}}),emits:Z(["change"],["update:modelValue"]),setup(e,{emit:v}){const o=me(e,"modelValue"),s=A([]),i=_e(),r=A([]),a=A(""),n=A(0),d=te(()=>[...r.value].map(_=>({title:_.Name,value:s.value.find(m=>m.NoteCategoryUUID===_.NoteCategoryUUID)||_})));return typeof e.convention=="object"?a.value=e.convention.ConventionUUID:a.value=e.convention||"",(async()=>{const g=[];a.value&&g.push(i.getNoteCategories(a.value));const _=await Promise.all(g);if(a.value&&_.length==1&&(r.value=_[0].sort((m,f)=>m.Name.localeCompare(f.Name))),Array.isArray(o.value))n.value=2,d.value.forEach(m=>{Array.isArray(o.value)&&o.value.find(U=>U.NoteCategoryUUID===m.value.NoteCategoryUUID)&&s.value.push(m.value)});else if(typeof o.value=="string"){n.value=1;try{const m=JSON.parse(o.value);d.value.forEach(f=>{m.find(k=>k.NoteCategoryUUID===f.value.NoteCategoryUUID)&&s.value.push(f.value)})}catch{}}})(),de(s,()=>{switch(n.value){default:case 2:{o.value=s.value,v("change");break}case 1:{o.value=JSON.stringify(s.value),v("change");break}}}),(g,_)=>(u(),C(ra,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=m=>s.value=m),chips:g.chips,multiple:"",label:g.label||"Tags",variant:g.variant||"solo",hint:g.hint,"persistent-hint":!0,clearable:g.clearable,items:d.value,"item-title":"title","item-value":"value"},null,8,["modelValue","chips","label","variant","hint","clearable","items"]))}}),Bo=Q({__name:"EditNoteDialog",props:Z({convention:{},note:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Z(["update:note","saved"],["update:modelValue"]),setup(e,{emit:v}){const o=e,{title:s=""}=o,i=_e(),r=me(e,"modelValue"),a=ot(o,v,void 0,void 0,"note"),n=A(Te(a.value));de(a,()=>{n.value=Te(a.value)});const d=()=>{n.value=Te(a.value)},c=g=>{n.value.NoteCategories===null&&(n.value.NoteCategories=[]),n.value.CreatedAt=void 0,n.value.DeletedAt=void 0,n.value.UpdatedAt=void 0,n.value.Admin=void 0,n.value.AdminID=void 0,n.value.AdminUUID=void 0,i.saveNote(n.value).then(_=>{_?(n.value=Te(_),g&&g("Note Saved"),a.value=n.value,v("saved",a.value)):g&&g("Internal Error Saving Note")}).catch(_=>{g&&g("Error Saving Note:"+_.ErrorMessage)})};return(g,_)=>n.value?(u(),C(Ze,{key:0,"card-class":"pa-4",modelValue:r.value,"onUpdate:modelValue":_[3]||(_[3]=m=>r.value=m),onReset:d,onSave:c,title:I(s),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0,"show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:l(()=>[t(Ae,{class:"pa-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[t($o,{modelValue:n.value.NoteCategories,"onUpdate:modelValue":_[0]||(_[0]=m=>n.value.NoteCategories=m),convention:g.convention,label:"Categories",variant:"outlined","hide-details":"",chips:!0},null,8,["modelValue","convention"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[t(ae,{modelValue:n.value.Subject,"onUpdate:modelValue":_[1]||(_[1]=m=>n.value.Subject=m),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(M,{cols:"12"},{default:l(()=>[t(Gl,{modelValue:n.value.Description,"onUpdate:modelValue":_[2]||(_[2]=m=>n.value.Description=m),label:"Note",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])):$("",!0)}}),Go=Q({__name:"Notes",props:{convention:{},hideHistory:{type:Boolean},registration:{},showEditor:{type:Boolean}},setup(e){const v=_e(),o=()=>({ID:0,NoteUUID:ye(),Description:"",NoteCategories:[],Registration:e.registration,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Subject:""}),s=A(!1),i=A(!1),r=A([]),a=A([]),n=A(o()),d=()=>{n.value=o(),s.value=!0},c=m=>{n.value=m,s.value=!0},g=()=>{v.getRegistrationNotes(e.registration.RegistrationUUID).then(m=>{m&&(m.forEach(f=>{f.CreatedAt=ma(new Date(f.CreatedAt||"")),f.Admin||(f.Admin={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),r.value=m,a.value=m.map(f=>f.NoteUUID))})},_=()=>{g(),setTimeout(()=>{s.value=!1},2e3)};return g(),(m,f)=>(u(),T(L,null,[t(Me,null,{default:l(()=>[t(et,null,{default:l(()=>[t(xe,null,{default:l(()=>[t(K,{class:"flex-row-reverse"},{default:l(()=>[t(M,{class:"text-right flex-shrink-1 flex-grow-0",style:{"flex-grow":"0 !important"}},{default:l(()=>[t(H,{class:"d-sm-none",size:"xs",icon:"mdi:mdi-cog",variant:"text",color:"warning",onClick:f[0]||(f[0]=U=>i.value=!0)}),t(H,{class:"d-none d-sm-inline-flex","prepend-icon":"mdi:mdi-cog",variant:"text",color:"warning",onClick:f[1]||(f[1]=U=>i.value=!0)},{default:l(()=>[O("Categories")]),_:1})]),_:1}),t(M,{class:"text-wrap flex-grow-1"},{default:l(()=>[O(" Notes (#"+R(m.registration.Reference)+" "+R(m.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(He,null,{default:l(()=>[t(gt,{multiple:!0,variant:"accordion",modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=U=>a.value=U)},{default:l(()=>[(u(!0),T(L,null,W(r.value,U=>(u(),C(Ut,{key:`${U.NoteUUID}.${U.UpdatedAt}`,value:U.NoteUUID},{default:l(()=>[t(vt,null,{default:l(()=>[O(R(U.Subject)+" ",1),t(Yl,{class:"ml-4"},{default:l(()=>[(u(!0),T(L,null,W(U.NoteCategories,k=>(u(),C(xl,{key:k.NoteCategoryUUID},{default:l(()=>[O(R(k.Name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),t(ft,null,{default:l(()=>[t(K,null,{default:l(()=>[t(M,null,{default:l(()=>[O(R(U.Description),1)]),_:2},1024)]),_:2},1024),t(K,null,{default:l(()=>[t(M,null,{default:l(()=>[O(R(I(Oe)(U.UpdatedAt||""))+" ",1),U&&U.Admin&&U.Admin.DisplayName?(u(),T(L,{key:0},[O(" - "+R(U.Admin.DisplayName),1)],64)):$("",!0)]),_:2},1024),t(M,{class:"text-right"},{default:l(()=>[t(H,{color:"primary","prepend-icon":"mdi:mdi-pencil",onClick:k=>c(U)},{default:l(()=>[O("Edit")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t($t,null,{default:l(()=>[t(H,{color:"primary",variant:"flat",onClick:d},{default:l(()=>[O("Add Note")]),_:1})]),_:1})]),_:1}),t(mt,{modelValue:s.value,"onUpdate:modelValue":f[5]||(f[5]=U=>s.value=U),title:"Create Note"},{default:l(()=>[t(Bo,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=U=>s.value=U),note:n.value,"onUpdate:note":f[4]||(f[4]=U=>n.value=U),convention:m.convention,title:"Create Note",onSaved:_},null,8,["modelValue","note","convention"])]),_:1},8,["modelValue"]),t(mt,{modelValue:i.value,"onUpdate:modelValue":f[7]||(f[7]=U=>i.value=U),title:"Note Configuration"},{default:l(()=>[t(Po,{convention:m.convention,onClose:f[6]||(f[6]=U=>i.value=!1)},null,8,["convention"])]),_:1},8,["modelValue"])],64))}}),Yo=Q({__name:"StripeRefundPayment",props:Z({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0}}),emits:Z(["refunded"],["update:modelValue"]),setup(e,{emit:v}){const o=me(e,"modelValue"),s=_e(),i=A(!1),r=A("");let a=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const m=e.paymentTransaction.Data.PaymentIntent;m&&(a=m.amount)}const n=A({Amount:a/100,Description:"",Reason:""}),d=A([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),c=A(!1);async function g(m){m.preventDefault(),c.value=!0,s.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,n.value).then(f=>{f?v("refunded",f):_("An unexpected error occurred.")}).catch(f=>{_("An error occurred processing the refund: "+f.toString())}),c.value=!1}const _=m=>{r.value=m,i.value=!0};return(m,f)=>(u(),C(Ze,{modelValue:o.value,"onUpdate:modelValue":f[7]||(f[7]=U=>o.value=U),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:l(()=>[t(Ae,{class:"pa-0"},{default:l(()=>[t(Hl,{ref:"refundForm",id:"refund-form",onSubmit:f[4]||(f[4]=Ct(U=>g(U),["prevent"]))},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:l(()=>[t(ae,{modelValue:n.value.Amount,"onUpdate:modelValue":f[0]||(f[0]=U=>n.value.Amount=U),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(M,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:l(()=>[t(ge,{modelValue:n.value.Reason,"onUpdate:modelValue":f[1]||(f[1]=U=>n.value.Reason=U),modelModifiers:{number:!0},items:d.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(M,{cols:"12"},{default:l(()=>[t(ae,{modelValue:n.value.Description,"onUpdate:modelValue":f[2]||(f[2]=U=>n.value.Description=U),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:l(()=>[t(H,{color:"error",class:"w-100",onClick:f[3]||(f[3]=U=>o.value=!1)},{default:l(()=>[O("Cancel")]),_:1})]),_:1}),t(Ye),t(M,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:l(()=>[t(H,{type:"submit",color:"success",class:"w-100"},Xe({default:l(()=>[O(" Issue Refund ")]),_:2},[c.value?{name:"prepend",fn:l(()=>[t(Dl,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(Ia,{modelValue:i.value,"onUpdate:modelValue":f[6]||(f[6]=U=>i.value=U)},{actions:l(()=>[t(H,{variant:"text",onClick:f[5]||(f[5]=U=>i.value=!1)},{default:l(()=>[O(" Close ")]),_:1})]),default:l(()=>[O(R(r.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),xo=["colspan"],Ho=P("strong",null,"Details",-1),qo=["innerHTML"],jo=Q({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:v}){const o=e;let{hideHistory:s=!1,registration:i,showEditor:r}=o;const a=_e(),n=A([]),d=A(["1"]),c=A([]),g=A([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),_=A(!1),m=A(),f=A(!1),U=A(""),k=A([{key:"CreatedAt",order:"asc"}]),q=()=>({PaymentTransactionUUID:ye(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:i.ID,RegistrationUUID:i.RegistrationUUID,Source:Qt.PAYMENT_TRANSACTION_SOURCE_NULL,Type:Vt.PAYMENT_TRANSACTION_TYPE_NULL}),p=A(q()),{convertTransactions:N,getPaymentTransactionsDisplay:h}=ca();de(o,()=>{s=o.hideHistory,i=o.registration,r=o.showEditor,h(i.RegistrationUUID).then(E=>{c.value=E})});const le=()=>{h(i.RegistrationUUID).then(E=>{c.value=E})};le();const B=()=>{a.saveRegistrationPaymentTransaction(p.value).then(E=>{E&&(N(E.PaymentTransactions),p.value=q(),v("close-editor"),v("change"))})},ie=E=>{const S=c.value.find(V=>V.PaymentTransactionUUID===E);S&&(m.value=S.PaymentTransaction,_.value=!0)},X=E=>{if(E)try{c.value=N(E.PaymentTransactions),m.value=void 0,_.value=!1,U.value="Refund Processed",f.value=!0,v("change")}catch(S){console.error(S)}};return(E,S)=>(u(),T(L,null,[I(r)?(u(),T(L,{key:0},[t(xe,null,{default:l(()=>[O(" Add Transaction ")]),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ge,{items:I(cl),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:p.value.Type,"onUpdate:modelValue":S[0]||(S[0]=V=>p.value.Type=V),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ge,{items:I(vl),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:p.value.Source,"onUpdate:modelValue":S[1]||(S[1]=V=>p.value.Source=V),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"8",md:"10"},{default:l(()=>[t(ae,{label:"Description","hide-details":"",modelValue:p.value.Description,"onUpdate:modelValue":S[2]||(S[2]=V=>p.value.Description=V),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(M,{cols:"12",sm:"4",md:"2"},{default:l(()=>[t(ae,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:p.value.Amount,"onUpdate:modelValue":S[3]||(S[3]=V=>p.value.Amount=V),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"3",md:"2",lg:"1"},{default:l(()=>[t(H,{class:"w-100",onClick:S[4]||(S[4]=V=>v("close-editor")),color:"warning"},{default:l(()=>[O("Cancel")]),_:1})]),_:1}),t(Ye),t(M,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:l(()=>[t(H,{class:"w-100",onClick:B,color:"primary"},{default:l(()=>[O("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):$("",!0),c.value.length&&!I(s)?(u(),C(gt,{key:1,class:"my-2",modelValue:d.value,"onUpdate:modelValue":S[10]||(S[10]=V=>d.value=V)},{default:l(()=>[t(Ut,{value:"1"},{default:l(()=>[t(vt,null,{default:l(()=>[O(" Transaction History ")]),_:1}),t(ft,null,{default:l(()=>[t(I(Pt),{items:c.value,headers:g.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:n.value,"onUpdate:expanded":S[5]||(S[5]=V=>n.value=V),"sort-by":k.value,"onUpdate:sortBy":S[6]||(S[6]=V=>k.value=V),class:"transactionTable"},{"item.Controls":l(({item:V})=>[E.canEdit&&V.raw.PaymentTransaction.Source===I(Qt).PAYMENT_TRANSACTION_SOURCE_STRIPE&&V.raw.PaymentTransaction.Type===I(Vt).PAYMENT_TRANSACTION_TYPE_PAYMENT?(u(),C(H,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:F=>ie(V.key)},null,8,["onClick"])):$("",!0)]),"expanded-row":l(({columns:V,item:F})=>[P("tr",null,[P("td",{colspan:V.length},[Ho,P("div",{innerHTML:F.raw.HTML},null,8,qo)],8,xo)])]),"footer.prepend":l(()=>[t(H,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:le},{default:l(()=>[O("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),_.value&&m.value?(u(),C(Yo,{key:0,modelValue:_.value,"onUpdate:modelValue":S[7]||(S[7]=V=>_.value=V),"payment-transaction":m.value,onRefunded:X},null,8,["modelValue","payment-transaction"])):$("",!0),t(Ia,{modelValue:f.value,"onUpdate:modelValue":S[9]||(S[9]=V=>f.value=V)},{actions:l(()=>[t(H,{variant:"text",onClick:S[8]||(S[8]=V=>f.value=!1)},{default:l(()=>[O(" Close ")]),_:1})]),default:l(()=>[O(R(U.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):$("",!0)],64))}});const zo=(e=void 0,v)=>e===void 0?!1:Lt(e,Nt.GROUP_TYPE_CONVENTION,v.ConventionUUID,v).EditPaymentTransactions,At=e=>(ht("data-v-8af8174d"),e=e(),kt(),e),Qo={class:"mb-4"},Ko={class:"v-row"},Wo={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Jo={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Xo={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},Zo={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},ei=At(()=>P("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),ti={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},ai=At(()=>P("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),li={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},ni=At(()=>P("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),oi={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},ii=At(()=>P("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),si={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},ui=Q({__name:"PaymentActions",props:Z({forms:{},title:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=A(!1),o=A(),s=A([]),i=A(new Date().getTime()),r=A(!1),a=me(e,"modelValue"),n=A(Te(a.value));de(a,()=>{n.value=Te(a.value)});const d=_e();d.getConvention(a.value.ConventionUUID).then(m=>{m&&(r.value=zo(it(),m))});const c=()=>{d.generateRegistrationCharges(a.value.RegistrationUUID,!1).then(m=>{m&&(s.value=m.PaymentTransactions,o.value=m.Registration,i.value=new Date().getTime())}).catch(()=>{})};c();const g=()=>{d.generateRegistrationCharges(a.value.RegistrationUUID,!0).then(m=>{m&&(s.value=m.PaymentTransactions,o.value=m.Registration,i.value=new Date().getTime())})},{totalCharges:_}=ca();return(m,f)=>(u(),C(Me,null,{default:l(()=>[t(et,null,{default:l(()=>[t(xe,null,{default:l(()=>[O(" Payments (#"+R(a.value.Reference)+" "+R(a.value.User.DisplayName)+") ",1)]),_:1})]),_:1}),t(He,null,{default:l(()=>[o.value?(u(),T(L,{key:0},[P("h3",Qo,"#"+R(o.value.Reference)+" "+R(o.value.User.DisplayName),1),P("dl",Ko,[(u(!0),T(L,null,W(s.value,U=>(u(),T(L,{key:U.PaymentTransactionUUID},[U.Type===I(Vt).PAYMENT_TRANSACTION_TYPE_CHARGE?(u(),T("dt",Wo,[P("div",Jo,R(U.Description.split(":")[0])+": ",1),P("div",Xo,R(U.Description.split(":")[1]),1)])):$("",!0),P("dd",Zo," £"+R(U.Amount),1)],64))),128)),ei,P("dd",ti," £"+R(I(_)(s.value)),1),ai,P("dd",li," £"+R(o.value.Total),1),ni,P("dd",oi," £"+R(o.value.Paid),1),ii,P("dd",si," £"+R(o.value.Total-o.value.Paid),1)]),t(K,{class:"flex-row-reverse"},{default:l(()=>[t(M,{class:"text-right"},{default:l(()=>[t(H,{color:"primary",onClick:g},{default:l(()=>[O("Apply Charges")]),_:1})]),_:1}),!v.value&&r.value?(u(),C(M,{key:0},{default:l(()=>[t(H,{color:"secondary",onClick:f[0]||(f[0]=U=>v.value=!0)},{default:l(()=>[O("Transaction Entry")]),_:1})]),_:1})):$("",!0)]),_:1})],64)):$("",!0),t(jo,{"can-edit":r.value,registration:a.value,"show-editor":v.value,onCloseEditor:f[1]||(f[1]=U=>v.value=!1),updated:i.value,onChange:c},null,8,["can-edit","registration","show-editor","updated"])]),_:1})]),_:1}))}});const ri=ct(ui,[["__scopeId","data-v-8af8174d"]]),di=Q({__name:"RegistrationFormStatus",props:Z({forms:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=_e(),o=me(e,"modelValue"),s=(i,r)=>{const a=o.value.Submissions.find(n=>n.SubmissionUUID==r);if(!a){i&&i("Submission not found");return}v.setSubmissionStatus(r,a.Status).then(n=>{n?(o.value.Submissions.forEach((d,c)=>{o.value.Submissions[c].Status=d.Status}),i&&i("Status Saved")):i&&i("Status not saved")}).catch(()=>{i&&i("Status not saved")})};return(i,r)=>(u(),C(Me,null,{default:l(()=>[t(et,null,{default:l(()=>[t(xe,null,{default:l(()=>[O("Status (#"+R(o.value.Reference)+" "+R(o.value.User.DisplayName)+")",1)]),_:1})]),_:1}),t(He,null,{default:l(()=>[t(We,null,{default:l(()=>[(u(!0),T(L,null,W(o.value.Submissions,a=>(u(),C(Ge,{key:a.SubmissionUUID,class:"pa-0"},{default:l(()=>[t(K,{class:"py-2 align-center"},{default:l(()=>[t(M,{cols:"9",sm:"10",md:"10",lg:"9"},{default:l(()=>{var n;return[t(ge,{modelValue:a.Status,"onUpdate:modelValue":d=>a.Status=d,items:I(Kt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((n=i.forms.find(d=>d.FormUUID==a.FormUUID))==null?void 0:n.Name)||""},{selection:l(()=>[t(be,{class:"mr-4 d-none d-sm-inline"},{default:l(()=>{var d;return[O(R((d=I(Kt).find(c=>c.value===a.Status))==null?void 0:d.icon),1)]}),_:2},1024),O(" "+R(I(Mt)(a.Status)),1)]),item:l(({item:d,props:{onClick:c}})=>[t(Ge,{title:d.title,"prepend-icon":d.raw.icon,onClick:c},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(M,{cols:"3",sm:"2",md:"2",lg:"1"},{default:l(()=>[t(nt,{class:"d-none d-sm-inline-flex",title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:n=>s(n.callback,a.SubmissionUUID)},null,8,["onClick"]),t(nt,{class:"d-sm-none",size:"35",icon:"mdi:mdi-content-save",color:"warning",onClick:n=>s(n.callback,a.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}}),mi=e=>(ht("data-v-7d39acf0"),e=e(),kt(),e),ci=mi(()=>P("p",null,"Any tags controlled through registration form fields will be reset when the applicable form is saved. If you don't know what you're doing here, don't touch!",-1)),vi={class:"mb-4"},fi=Q({__name:"RegistrationTags",props:Z({title:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const v=_e(),o=me(e,"modelValue"),s=A(Te(o.value)),i=A(!1),r=A(s.value.Tags);de(o,()=>{s.value=Te(o.value)});const a=({callback:n})=>{const d=[],c=[];s.value.Tags.forEach(g=>{r.value.find(m=>m.TagUUID===g.TagUUID)||d.push(g.TagUUID)}),r.value.forEach(g=>{s.value.Tags.find(m=>g.TagUUID===m.TagUUID)||c.push(g.TagUUID)}),v.updateRegistrationTags(d,c,s.value.RegistrationUUID).then(g=>{g?n&&(n("Tags Saved"),o.value.Tags=g.Tags):n&&n("Error Saving Tags")}).catch(()=>{n&&n("Error Saving Tags")})};return(n,d)=>(u(),C(Me,null,{default:l(()=>[t(et,null,{default:l(()=>[t(xe,null,{default:l(()=>[O("Tags (#"+R(s.value.Reference)+" "+R(s.value.User.DisplayName)+")",1)]),_:1})]),_:1}),t(He,null,{default:l(()=>[t(ql,{class:"my-4"},{default:l(()=>[t(jl,null,{default:l(()=>[O("Caution")]),_:1}),ci]),_:1}),P("h3",vi,"#"+R(s.value.Reference)+" "+R(s.value.User.DisplayName),1),t(ya,{modelValue:s.value.Tags,"onUpdate:modelValue":d[0]||(d[0]=c=>s.value.Tags=c),convention:s.value.ConventionUUID,"show-key":!0,chips:!0,"show-uuid":i.value},null,8,["modelValue","convention","show-uuid"])]),_:1}),t($t,{class:"px-4 align-start"},{default:l(()=>[t(da,{label:"Show UUID",modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=c=>i.value=c)},null,8,["modelValue"]),t(nt,{onClick:a,variant:"flat"})]),_:1})]),_:1}))}});const Ui=ct(fi,[["__scopeId","data-v-7d39acf0"]]),na=Q({__name:"RegistrationActionWindows",props:Z({accommodations:{},convention:{},extras:{},forms:{},interests:{},registration:{},tickets:{},venues:{}},{modelValue:{required:!0}}),emits:Z(["update:registration"],["update:modelValue"]),setup(e,{emit:v}){const o=e,s=me(e,"modelValue"),i=ot(o,v,void 0,void 0,"registration");return(r,a)=>(u(),C(Da,{modelValue:s.value,"onUpdate:modelValue":a[3]||(a[3]=n=>s.value=n)},{default:l(()=>[t(Be,{value:"badges"},{default:l(()=>[s.value=="badges"?(u(),C(Ae,{key:0,class:"pa-0 mx-0",fluid:!0},{default:l(()=>[t(fo,{convention:r.convention,registration:I(i)},null,8,["convention","registration"])]),_:1})):$("",!0)]),_:1}),t(Be,{value:"emails"},{default:l(()=>[s.value=="emails"?(u(),C(Ae,{key:0,class:"pa-0 mx-0",fluid:!0},{default:l(()=>[t(No,{registration:I(i)},null,8,["registration"])]),_:1})):$("",!0)]),_:1}),t(Be,{value:"notes"},{default:l(()=>[s.value=="notes"?(u(),C(Ae,{key:0,class:"pa-0 mx-0",fluid:!0},{default:l(()=>[t(Go,{convention:r.convention,registration:I(i)},null,8,["convention","registration"])]),_:1})):$("",!0)]),_:1}),t(Be,{value:"payments"},{default:l(()=>[s.value=="payments"?(u(),C(Ae,{key:0,class:"pa-0 mx-0",fluid:!0},{default:l(()=>[t(ri,{modelValue:I(i),"onUpdate:modelValue":a[0]||(a[0]=n=>lt(i)?i.value=n:null),forms:r.forms,title:"Registration Payments"},null,8,["modelValue","forms"])]),_:1})):$("",!0)]),_:1}),t(Be,{value:"status"},{default:l(()=>[s.value=="status"?(u(),C(Ae,{key:0,class:"pa-0 mx-0",fluid:!0},{default:l(()=>[t(di,{modelValue:I(i),"onUpdate:modelValue":a[1]||(a[1]=n=>lt(i)?i.value=n:null),forms:r.forms},null,8,["modelValue","forms"])]),_:1})):$("",!0)]),_:1}),t(Be,{value:"tags"},{default:l(()=>[s.value=="tags"?(u(),C(Ae,{key:0,class:"pa-0 mx-0",fluid:!0},{default:l(()=>[t(Ui,{modelValue:I(i),"onUpdate:modelValue":a[2]||(a[2]=n=>lt(i)?i.value=n:null),title:"Registration Tags"},null,8,["modelValue"])]),_:1})):$("",!0)]),_:1})]),_:1},8,["modelValue"]))}}),gi=(e,v)=>e===void 0?!1:Lt(e,Nt.GROUP_TYPE_CONVENTION,v.ConventionUUID,v).ViewPaymentTransactions,oa=Q({__name:"RegistrationActions",props:Z({accommodations:{},convention:{},extras:{},forms:{},interests:{},registration:{},tickets:{},title:{},useDialog:{type:Boolean},venues:{}},{modelValue:{type:Boolean,required:!0}}),emits:Z(["update:registration"],["update:modelValue"]),setup(e,{emit:v}){const o=e,s=me(e,"modelValue"),i=ot(o,v,void 0,void 0,"registration"),r=A("notes"),a=it(),n=[{label:"Badge",value:"badges"},{label:"Emails",value:"emails"},{label:"Notes",value:"notes"},{label:"Status",value:"status"},{label:"Tags",value:"tags"}];return gi(a,o.convention)&&n.splice(2,0,{label:"Payments",value:"payments"}),(d,c)=>d.useDialog?(u(),C(Ze,{key:0,modelValue:s.value,"onUpdate:modelValue":c[3]||(c[3]=g=>s.value=g),title:d.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:"","card-class":"ma-0 pa-0"},{extension:l(()=>[t(ea,{modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=g=>r.value=g),tabs:n,"show-arrows":!0},null,8,["modelValue"])]),default:l(()=>[t(na,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=g=>r.value=g),registration:I(i),"onUpdate:registration":c[2]||(c[2]=g=>lt(i)?i.value=g:null),accommodations:d.accommodations,convention:d.convention,extras:d.extras,forms:d.forms,interests:d.interests,tabs:n,tickets:d.tickets,venues:d.venues},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])]),_:1},8,["modelValue","title"])):(u(),T(L,{key:1},[t(ea,{modelValue:r.value,"onUpdate:modelValue":c[4]||(c[4]=g=>r.value=g),tabs:n,"show-arrows":!0},null,8,["modelValue"]),t(na,{modelValue:r.value,"onUpdate:modelValue":c[5]||(c[5]=g=>r.value=g),registration:I(i),"onUpdate:registration":c[6]||(c[6]=g=>lt(i)?i.value=g:null),accommodations:d.accommodations,convention:d.convention,extras:d.extras,forms:d.forms,interests:d.interests,tabs:n,tickets:d.tickets,venues:d.venues},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])],64))}});const Ai=(e,v=500,o=!1)=>{let s;return(...i)=>{const a=function(){s=void 0,o||e.apply(void 0,i)},n=o&&!s;clearTimeout(s),s=setTimeout(a,v),n&&e.apply(void 0,i)}},Ti=P("h4",null,"Grid Size (Max 12)",-1),_i=Q({__name:"EditAdminLayout",props:Z({layouts:{}},{modelValue:{required:!0}}),emits:Z(["change","delete"],["update:modelValue"]),setup(e,{emit:v}){const o=me(e,"modelValue"),s=A([]),i=_e(),r=A(Object.assign({},...e.layouts.map(f=>f.Panels.map(U=>U.Items.map(k=>{const q={};return q[k.LayoutItemUUID]=k.Meta.LayoutUUID,q}))).flat(2))),a=A(`
Are you sure you wish to delete this layout? All panels relating to it will be
removed and can not be recovered. This action can not be undone once saved.
You will have to create a new layout.
`),n=A(!1),d=()=>({ID:0,LayoutPanelUUID:ye(),AdminLayoutID:o.value.ID,AdminLayoutUUID:o.value.AdminLayoutUUID,Name:"",Order:o.value.Panels.length+1,Items:[],RequiredFormType:Ue.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[],Meta:{}}),c=f=>()=>({ID:0,LayoutItemUUID:ye(),LayoutPanelID:f.ID,LayoutPanelUUID:f.LayoutPanelUUID,Label:"",SourceType:he.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:f.Items.length+1,DefaultSort:!1,Meta:{}}),g=f=>{f.Meta.LayoutUUID=r.value[f.LayoutItemUUID]},_=f=>{const U=s.value.find(k=>k.value===f.SectionFieldUUID);U&&(f.SectionFieldID=U.object.ID,f.SectionField=U.object)};i.getConventionForms(o.value.ConventionUUID).then(f=>{f.forEach(U=>U.Sections.forEach(k=>k.Fields&&s.value.push(...k.Fields.map(q=>{var N;return{title:`${U.Name} - ${k.Name} - ${(N=q.Field)==null?void 0:N.Name}`,value:q.SectionFieldUUID,object:q}})))),s.value.sort(ul("title"))});const m=te(()=>{switch(o.value.Type){case ke.ADMIN_LAYOUT_PANELS:return"Panels";case ke.ADMIN_LAYOUT_TABLE:return"Tabs"}return"Unknown"});return de(o,()=>{v("change")},{deep:!0}),(f,U)=>(u(),C(Ae,{class:"px-0 mx-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ae,{modelValue:o.value.Name,"onUpdate:modelValue":U[0]||(U[0]=k=>o.value.Name=k),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ge,{modelValue:o.value.Type,"onUpdate:modelValue":U[1]||(U[1]=k=>o.value.Type=k),label:"Layout Type",items:I(Wl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,null,{default:l(()=>[t(Ot,{modelValue:o.value.Panels,"onUpdate:modelValue":U[2]||(U[2]=k=>o.value.Panels=k),"new-item":d,closeable:!1,title:m.value,label:"Name","slot-name-prefix":"panel"},Xe({_:2},[W(o.value.Panels,(k,q)=>({name:`panel_${q}`,fn:l(()=>[t(Ae,{class:"px-0 mx-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ae,{modelValue:k.Name,"onUpdate:modelValue":p=>k.Name=p,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ge,{modelValue:k.RequiredFormType,"onUpdate:modelValue":p=>k.RequiredFormType=p,items:I(ml),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6"},{default:l(()=>[t(pa,{label:"Required Groups",variant:"outlined",modelValue:k.RequiredGroupMemberships,"onUpdate:modelValue":p=>k.RequiredGroupMemberships=p,convention:o.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this panel. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ya,{label:"Registration Tags",variant:"outlined",modelValue:k.RequiredRegistrationTags,"onUpdate:modelValue":p=>k.RequiredRegistrationTags=p,convention:o.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024),o.value.Type===I(ke).ADMIN_LAYOUT_PANELS?(u(),C(K,{key:0},{default:l(()=>[t(M,{cols:"12",class:"py-0 my-0"},{default:l(()=>[Ti]),_:1}),t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ae,{modelValue:k.Meta.cols,"onUpdate:modelValue":p=>k.Meta.cols=p,modelModifiers:{number:!0},clearable:!0,"hide-details":"",label:"Default",type:"number",min:"1",max:"12"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ae,{modelValue:k.Meta.cols_xs,"onUpdate:modelValue":p=>k.Meta.cols_xs=p,modelModifiers:{number:!0},clearable:!0,"hide-details":"",label:"XS",type:"number",min:"1",max:"12"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ae,{modelValue:k.Meta.cols_sm,"onUpdate:modelValue":p=>k.Meta.cols_sm=p,modelModifiers:{number:!0},clearable:!0,"hide-details":"",label:"SM",type:"number",min:"1",max:"12"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ae,{modelValue:k.Meta.cols_md,"onUpdate:modelValue":p=>k.Meta.cols_md=p,modelModifiers:{number:!0},clearable:!0,"hide-details":"",label:"MD",type:"number",min:"1",max:"12"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ae,{modelValue:k.Meta.cols_lg,"onUpdate:modelValue":p=>k.Meta.cols_lg=p,modelModifiers:{number:!0},clearable:!0,"hide-details":"",label:"LG",type:"number",min:"1",max:"12"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ae,{modelValue:k.Meta.cols_xl,"onUpdate:modelValue":p=>k.Meta.cols_xl=p,modelModifiers:{number:!0},clearable:!0,"hide-details":"",label:"XL",type:"number",min:"1",max:"12"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024),t(Ot,{modelValue:k.Items,"onUpdate:modelValue":p=>k.Items=p,"new-item":c(k),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Xe({_:2},[W(k.Items,(p,N)=>({name:`item_${N}`,fn:l(()=>[t(Ae,{class:"px-0 mx-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ae,{modelValue:p.Label,"onUpdate:modelValue":h=>p.Label=h,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6"},{default:l(()=>[t(ge,{modelValue:p.SourceType,"onUpdate:modelValue":h=>p.SourceType=h,label:"Source Type",items:I(Jl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(M,{cols:"12",sm:"6"},{default:l(()=>[p.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(u(),C(ge,{key:0,modelValue:p.SectionFieldUUID,"onUpdate:modelValue":h=>p.SectionFieldUUID=h,label:"Form Data",items:s.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:h=>_(p)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):p.SourceType==="LAYOUT_ITEM_SOURCE_META"?(u(),C(ge,{key:1,modelValue:p.MetaField,"onUpdate:modelValue":h=>p.MetaField=h,label:"Miscellaneous Data",items:I(Xl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):p.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(u(),C(ge,{key:2,modelValue:p.UserField,"onUpdate:modelValue":h=>p.UserField=h,label:"User Profile Data",items:I(Zl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):$("",!0)]),_:2},1024)]),_:2},1024),f.layouts&&p.SourceType==="LAYOUT_ITEM_SOURCE_META"&&p.MetaField===I(j).META_DATA_SOURCE_DATA_LAYOUT?(u(),C(K,{key:0},{default:l(()=>[t(M,{cols:"6",sm:"4",lg:"2"},{default:l(()=>[t(ge,{modelValue:r.value[p.LayoutItemUUID],"onUpdate:modelValue":[h=>r.value[p.LayoutItemUUID]=h,h=>g(p)],clearable:!0,items:f.layouts.filter(h=>h.Type===I(ke).ADMIN_LAYOUT_PANELS)||[],multiple:!0,label:"Data Display","item-title":"Name","item-value":"AdminLayoutUUID",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)):$("",!0),o.value.Type===I(ke).ADMIN_LAYOUT_TABLE&&(p.SourceType!==I(he).LAYOUT_ITEM_SOURCE_META||p.MetaField!==I(j).META_DATA_SOURCE_DATA_LAYOUT)?(u(),C(K,{key:1},{default:l(()=>[t(M,null,{default:l(()=>[t(da,{modelValue:p.DefaultSort,"onUpdate:modelValue":h=>p.DefaultSort=h,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue","title"])]),_:1})]),_:1}),t(K,null,{default:l(()=>[t(M,null,{default:l(()=>[t(H,{onClick:U[3]||(U[3]=k=>n.value=!0),"prepend-icon":"mdi:mdi-delete",color:"red-darken-4"},{default:l(()=>[O("Delete Layout")]),_:1})]),_:1})]),_:1}),n.value?(u(),C(Ea,{key:0,modelValue:n.value,"onUpdate:modelValue":U[4]||(U[4]=k=>n.value=k),message:a.value,title:"Delete Layout",subtitle:"Removes this layout and all it's panels",onDelete:U[5]||(U[5]=k=>v("delete"))},null,8,["modelValue","message"])):$("",!0)]),_:1}))}}),pi=Q({__name:"EditAdminLayouts",props:Z({title:{},convention:{}},{modelValue:{type:Boolean,required:!0}}),emits:Z(["save"],["update:modelValue"]),setup(e,{emit:v}){const o=me(e,"modelValue"),s=A([]),i=A([]),r=A([]),a=_e(),n=()=>({ID:0,AdminLayoutUUID:ye(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"New Layout",Type:ke.ADMIN_LAYOUT_PANELS,Panels:[]}),d=()=>{let g=!1;[...new Set(r.value)].forEach(m=>{const f=s.value.findIndex(U=>U.AdminLayoutUUID===m);f<0||f>=s.value.length||(a.saveAdminLayout(s.value[f]).then(U=>{U&&s.value.splice(f,1,U)}).catch(()=>{}),g=!0)}),i.value.forEach(m=>{a.deleteAdminLayout(m).catch(()=>{})}),i.value=[],r.value=[],g&&v("save")},c=g=>{const _=s.value.findIndex(m=>m.AdminLayoutUUID===g.AdminLayoutUUID);_<0||_>=s.value.length||(s.value[_].ID>0&&i.value.push(g.AdminLayoutUUID),s.value.splice(_,1))};return a.getConventionAdminLayouts(e.convention.ConventionUUID).then(g=>{g&&(s.value=g)}).catch(()=>[]),(g,_)=>(u(),C(mt,{modelValue:o.value,"onUpdate:modelValue":_[2]||(_[2]=m=>o.value=m),scrollable:!0,"retain-focus":!0,persistent:!0,fullscreen:!0},{default:l(()=>[t(Ot,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=m=>s.value=m),"new-item":n,closeable:!0,"show-delete":!1,"show-save":!0,"has-order":!1,title:g.title,label:"Name","slot-name-prefix":"panel",onClose:_[1]||(_[1]=m=>o.value=!1),onSave:d},Xe({_:2},[W(s.value,(m,f)=>({name:`panel_${f}`,fn:l(()=>[t(Ae,{class:"px-0 mx-0",fluid:!0},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[t(_i,{modelValue:s.value[f],"onUpdate:modelValue":U=>s.value[f]=U,layouts:s.value,onChange:U=>r.value.push(m.AdminLayoutUUID),onDelete:U=>c(m)},null,8,["modelValue","onUpdate:modelValue","layouts","onChange","onDelete"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","title"])]),_:1},8,["modelValue"]))}});function yi(){const e=A([]);Wa(()=>e.value=[]);function v(o,s){e.value[s]=o}return{refs:e,updateRef:v}}const Di=ia({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:rt,default:"$first"},prevIcon:{type:rt,default:"$prev"},nextIcon:{type:rt,default:"$next"},lastIcon:{type:rt,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...fl(),...Ul(),...gl(),...Al(),...Tl(),..._l(),...pl({tag:"nav"}),...Ja(),...yl({variant:"text"})},"VPagination"),Ii=sa()({name:"VPagination",props:Di(),emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,v){let{slots:o,emit:s}=v;const i=Xa(e,"modelValue"),{t:r,n:a}=Za(),{isRtl:n}=el(),{themeClasses:d}=tl(e),{width:c}=al(),g=ll(-1);Rt(void 0,{scoped:!0});const{resizeRef:_}=Il(E=>{if(!E.length)return;const{target:S,contentRect:V}=E[0],F=S.querySelector(".v-pagination__list > *");if(!F)return;const G=V.width,ne=F.offsetWidth+parseFloat(getComputedStyle(F).marginRight)*2;g.value=k(G,ne)}),m=te(()=>parseInt(e.length,10)),f=te(()=>parseInt(e.start,10)),U=te(()=>e.totalVisible?parseInt(e.totalVisible,10):g.value>=0?g.value:k(c.value,58));function k(E,S){const V=e.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((E-S*V)/S).toFixed(2)))}const q=te(()=>{if(m.value<=0||isNaN(m.value)||m.value>Number.MAX_SAFE_INTEGER)return[];if(U.value<=1)return[i.value];if(m.value<=U.value)return dt(m.value,f.value);const E=U.value%2===0,S=E?U.value/2:Math.floor(U.value/2),V=E?S:S+1,F=m.value-S;if(V-i.value>=0)return[...dt(Math.max(1,U.value-1),f.value),e.ellipsis,m.value];if(i.value-F>=(E?1:0)){const G=U.value-1,ne=m.value-G+f.value;return[f.value,e.ellipsis,...dt(G,ne)]}else{const G=Math.max(1,U.value-3),ne=G===1?i.value:i.value-Math.ceil(G/2)+f.value;return[f.value,e.ellipsis,...dt(G,ne),e.ellipsis,m.value]}});function p(E,S,V){E.preventDefault(),i.value=S,V&&s(V,S)}const{refs:N,updateRef:h}=yi();Rt({VPaginationBtn:{color:pe(e,"color"),border:pe(e,"border"),density:pe(e,"density"),size:pe(e,"size"),variant:pe(e,"variant"),rounded:pe(e,"rounded"),elevation:pe(e,"elevation")}});const le=te(()=>q.value.map((E,S)=>{const V=F=>h(F,S);if(typeof E=="string")return{isActive:!1,key:`ellipsis-${S}`,page:E,props:{ref:V,ellipsis:!0,icon:!0,disabled:!0}};{const F=E===i.value;return{isActive:F,key:E,page:a(E),props:{ref:V,ellipsis:!1,icon:!0,disabled:!!e.disabled||+e.length<2,color:F?e.activeColor:e.color,ariaCurrent:F,ariaLabel:r(F?e.currentPageAriaLabel:e.pageAriaLabel,E),onClick:G=>p(G,E)}}}})),B=te(()=>{const E=!!e.disabled||i.value<=f.value,S=!!e.disabled||i.value>=f.value+m.value-1;return{first:e.showFirstLastPage?{icon:n.value?e.lastIcon:e.firstIcon,onClick:V=>p(V,f.value,"first"),disabled:E,ariaLabel:r(e.firstAriaLabel),ariaDisabled:E}:void 0,prev:{icon:n.value?e.nextIcon:e.prevIcon,onClick:V=>p(V,i.value-1,"prev"),disabled:E,ariaLabel:r(e.previousAriaLabel),ariaDisabled:E},next:{icon:n.value?e.prevIcon:e.nextIcon,onClick:V=>p(V,i.value+1,"next"),disabled:S,ariaLabel:r(e.nextAriaLabel),ariaDisabled:S},last:e.showFirstLastPage?{icon:n.value?e.firstIcon:e.lastIcon,onClick:V=>p(V,f.value+m.value-1,"last"),disabled:S,ariaLabel:r(e.lastAriaLabel),ariaDisabled:S}:void 0}});function ie(){var S;const E=i.value-f.value;(S=N.value[E])==null||S.$el.focus()}function X(E){E.key===zt.left&&!e.disabled&&i.value>+e.start?(i.value=i.value-1,Je(ie)):E.key===zt.right&&!e.disabled&&i.value<f.value+m.value-1&&(i.value=i.value+1,Je(ie))}return fa(()=>t(e.tag,{ref:_,class:["v-pagination",d.value,e.class],style:e.style,role:"navigation","aria-label":r(e.ariaLabel),onKeydown:X,"data-test":"v-pagination-root"},{default:()=>[t("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&t("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[o.first?o.first(B.value.first):t(H,Ve({_as:"VPaginationBtn"},B.value.first),null)]),t("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[o.prev?o.prev(B.value.prev):t(H,Ve({_as:"VPaginationBtn"},B.value.prev),null)]),le.value.map((E,S)=>t("li",{key:E.key,class:["v-pagination__item",{"v-pagination__item--is-active":E.isActive}],"data-test":"v-pagination-item"},[o.item?o.item(E):t(H,Ve({_as:"VPaginationBtn"},E.props),{default:()=>[E.page]})])),t("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[o.next?o.next(B.value.next):t(H,Ve({_as:"VPaginationBtn"},B.value.next),null)]),e.showFirstLastPage&&t("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[o.last?o.last(B.value.last):t(H,Ve({_as:"VPaginationBtn"},B.value.last),null)])])]})),{}}}),Ei=["colspan"],Si={style:{opacity:"var(--v-medium-emphasis-opacity)"}},cs=Q({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:v}){var xt;const o=Ft();v("pageTitle","Registration Manager");const s=nl(),i=ol(),r=A(!0);let a=((xt=s.params.convention)==null?void 0:xt.toString())||"";const n=A({ID:0,ConventionUUID:ye(),OrganisationID:0,OrganisationUUID:Et,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),d=_e(),c=il.getInstance(),g=A([]),_=A({ID:0,AdminLayoutUUID:ye(),ConventionID:n.value.ID,ConventionUUID:n.value.ConventionUUID,Name:"Registration Table",Type:ke.ADMIN_LAYOUT_TABLE,Panels:[]}),m=A([]),f=A([]),U=A([]),k=A([]),q=A([]),p=A([]),N=A(1),h=A(10),le=A([]),B=A(0),ie=A(!1),X=A(""),E=A(""),S=A(""),V=A(""),F=A({FieldUUID:"591c9bca-c78c-4e97-8aef-bc596ef472fb",Value:""}),G=A({FieldUUID:"50189b21-6c55-4c99-a38f-7740a01ec4a4",Value:""}),ne=A({FieldUUID:"1523ef15-f2c3-46b9-a687-dcd7bc2c0a50",Value:""}),fe=A({FieldUUID:"926d43c6-a743-4ab7-bef2-060d762d37a9",Value:""}),ce=A(new Map([["591c9bca-c78c-4e97-8aef-bc596ef472fb",F.value],["50189b21-6c55-4c99-a38f-7740a01ec4a4",G.value],["1523ef15-f2c3-46b9-a687-dcd7bc2c0a50",ne.value],["926d43c6-a743-4ab7-bef2-060d762d37a9",fe.value]])),qe=A(""),je=A(""),tt=A([]),ze=A([]),Ie=A([]),Ne=A([]),Le=A([]),Fe=A([]),Se=A(0),De=A(),we=A(!1),Bt=A(!1),ka=A(!1),st=A(),Gt=A(),Tt=A(),Qe=A(!1),Ma=it(),ve=Ai(()=>{E.value=Date.now().toString()});de(X,D=>{const y=p.value.find(w=>w.uuid===D);if(y){const w=y.headers.find(b=>b.defaultSort===!0);w&&(le.value=[{key:w.key,order:"asc"}],tt.value=[{key:w.key,order:"asc"}])}}),de(Se,D=>{D===8&&Yt()}),de(qe,()=>{ve()}),de(je,()=>{ve()});const Na=()=>{m.value=[],U.value=[],k.value=[],p.value=[];try{d.getConventionAdminLayoutByName(n.value.ConventionUUID,"Registration Table").then(D=>{Se.value+=1,D?_.value=D:(_.value.ConventionID=n.value.ID,_.value.ConventionUUID=n.value.ConventionUUID)})}catch{_.value.ConventionID=n.value.ID,_.value.ConventionUUID=n.value.ConventionUUID}try{d.getConventionAdminLayouts(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(U.value=D)})}catch{}try{d.getConventionForms(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(m.value=D)})}catch{}try{d.getConventionAccommodation(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(ze.value=D)})}catch{}try{d.getConventionVenues(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(Fe.value=D)})}catch{}try{d.getConventionExtras(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(Ie.value=D)})}catch{}try{d.getConventionInterests(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(Ne.value=D)})}catch{}try{d.getConventionTickets(n.value.ConventionUUID).then(D=>{Se.value+=1,D&&(Le.value=D)})}catch{}try{d.getConventionGroups(n.value.ConventionUUID).then(D=>{D&&(f.value=D.sort((y,w)=>y.Name.localeCompare(w.Name)))})}catch{}try{d.getConventionTags(n.value.ConventionUUID).then(D=>{D&&(q.value=D.sort((y,w)=>y.Title.localeCompare(w.Title)).map(y=>(y.Title=`${y.Title} [${y.Key}]`,y)))})}catch{}},_t=({page:D,itemsPerPage:y,sortBy:w})=>{r.value=!0,N.value=D,le.value=w;const b=p.value.find(ue=>ue.uuid==X.value),re=b==null?void 0:b.layout.Items;let se="",Ht="";if(w&&re&&w.length>=1){const ue=re.find(yt=>yt.LayoutItemUUID==w[0].key);switch(Ht=w[0].order||"asc",ue==null?void 0:ue.MetaField){case j.META_DATA_SOURCE_ACCOMMODATION_FORM:se="submission.status";break;case j.META_DATA_SOURCE_BADGE_FORM:se="submission.status";break;case j.META_DATA_SOURCE_DEALER_FORM:se="submission.status";break;case j.META_DATA_SOURCE_REGISTRATION_FORM:se="submission.status";break;case j.META_DATA_SOURCE_REGISTRATION_REFERENCE:se="reference";break;case j.META_DATA_SOURCE_SUBMISSION_DATE:se="created";break;case j.META_DATA_SOURCE_SUBMISSION_STATUS:se="submission.status";break}switch(ue==null?void 0:ue.UserField){case oe.USER_DATA_SOURCE_DISPLAY_NAME:se="user.display_name";break;case oe.USER_DATA_SOURCE_EMAIL:se="user.email";break;case oe.USER_DATA_SOURCE_FIRST_NAME:se="user.firstname";break;case oe.USER_DATA_SOURCE_HANDLE:se="user.handle";break;case oe.USER_DATA_SOURCE_LAST_NAME:se="user.lastname";break}}try{const ue={Direction:Ht,Limit:y,Offset:(D-1)*y,Order:se};b&&b.layout.RequiredRegistrationTags.length>0&&(ue.PanelUUID=b==null?void 0:b.layout.LayoutPanelUUID),(b==null?void 0:b.layout.RequiredFormType)===Ue.FORM_TYPE_ACCOMMODATION&&(ue.Accommodation=!0),(b==null?void 0:b.layout.RequiredFormType)===Ue.FORM_TYPE_BADGE&&(ue.Badge=!0),(b==null?void 0:b.layout.RequiredFormType)===Ue.FORM_TYPE_DEALER&&(ue.Dealer=!0),(b==null?void 0:b.layout.RequiredFormType)===Ue.FORM_TYPE_REGISTRATION&&(ue.Registration=!0),ue.GroupUUID=qe.value||Et,ue.TagUUID=je.value||Et,ue.Email=V.value,ue.Reference=S.value,ue.FieldValues=Array.from(ce.value.values());const yt=E.value;d.searchConventionRegistrations(n.value.ConventionUUID,ue).then(Dt=>{Dt&&yt===E.value&&(B.value=Dt.Total,k.value=Dt.Registrations,p.value.forEach(It=>{const xa=It.layout;It.items=k.value.map(z=>{const ut=[];let Re;z.Leader?Re=z:Re=z.Primary,ut.push({Name:Re.User.DisplayName,UUID:Re.UserUUID,UserUUID:Re.User.UserUUID,IsLeader:!0,Reference:Re.Reference,Paid:Re.Paid,Total:Re.Total}),ut.push(...Re.Members.map(Ce=>({Name:Ce.User.DisplayName,UUID:Ce.UserUUID,UserUUID:Ce.User.UserUUID,IsLeader:!1,Reference:Ce.Reference,Paid:Ce.Paid,Total:Ce.Total})));const ee={};return It.headers.forEach(Ce=>{var qt;const x=xa.Items.find(at=>at.LayoutItemUUID===Ce.key);if(x){if(x.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&x.SectionField)z.Submissions.forEach(at=>{const Ke=at.Data.find(Y=>Y.SectionFieldUUID===x.SectionFieldUUID);if(Ke){Ce.type===dl.ACCOMMODATION?ee[x.LayoutItemUUID]={Data:Ke.Data,Registration:z}:ee[x.LayoutItemUUID]=Ke.Data;return}});else if(x.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&x.UserField)switch(x.UserField){case oe.USER_DATA_SOURCE_AVATAR:ee[x.LayoutItemUUID]=o.GetProfileImageURL(z.UserUUID);break;case oe.USER_DATA_SOURCE_DISPLAY_NAME:ee[x.LayoutItemUUID]=z.User.DisplayName;break;case oe.USER_DATA_SOURCE_EMAIL:ee[x.LayoutItemUUID]=z.User.Additional.Email;break;case oe.USER_DATA_SOURCE_HANDLE:ee[x.LayoutItemUUID]=z.User.Handle;break;case oe.USER_DATA_SOURCE_DATE_OF_BIRTH:ee[x.LayoutItemUUID]=z.User.Additional.DOB;break;case oe.USER_DATA_SOURCE_FIRST_NAME:ee[x.LayoutItemUUID]=z.User.Additional.FirstName;break;case oe.USER_DATA_SOURCE_LAST_NAME:ee[x.LayoutItemUUID]=z.User.Additional.LastName;break;case oe.USER_DATA_SOURCE_TELEGRAM:ee[x.LayoutItemUUID]="";break}else if(x.SourceType==="LAYOUT_ITEM_SOURCE_META"&&x.MetaField){const at=(qt=m.value.find(Y=>Y.Type===Ue.FORM_TYPE_REGISTRATION))==null?void 0:qt.FormUUID,Ke=z.Submissions.find(Y=>Y.FormUUID===at);switch(x.MetaField){case j.META_DATA_SOURCE_REGISTRATION_ACTIONS:ee[x.LayoutItemUUID]=z;break;case j.META_DATA_SOURCE_REGISTRATION_GROUP:ee[x.LayoutItemUUID]=ut;break;case j.META_DATA_SOURCE_REGISTRATION_REFERENCE:ee[x.LayoutItemUUID]=z.Reference;break;case j.META_DATA_SOURCE_SUBMISSION_DATE:if(Ke){const Y=new Date(Ke.CreatedAt||"");ee[x.LayoutItemUUID]=`${Y.getFullYear()}-${(Y.getMonth()+1).toString().padStart(2,"0")}-${Y.getDate().toString().padStart(2,"0")} ${Y.getHours().toString().padStart(2,"0")}:${Y.getMinutes().toString().padStart(2,"0")}:${Y.getSeconds().toString().padStart(2,"0")}`}else{const Y=new Date(z.CreatedAt||"");ee[x.LayoutItemUUID]=`${Y.getFullYear()}-${(Y.getMonth()+1).toString().padStart(2,"0")}-${Y.getDate().toString().padStart(2,"0")} ${Y.getHours().toString().padStart(2,"0")}:${Y.getMinutes().toString().padStart(2,"0")}:${Y.getSeconds().toString().padStart(2,"0")}`}break;case j.META_DATA_SOURCE_ACCOMMODATION_FORM:ee[x.LayoutItemUUID]=z.Submissions.map(Y=>{const J=m.value.find(Pe=>Pe.FormUUID===Y.FormUUID);return{Heading:J==null?void 0:J.Heading,Form:J,Submission:Y,Registration:z}}).filter(Y=>{var J;return((J=Y.Form)==null?void 0:J.Type)===Ue.FORM_TYPE_ACCOMMODATION});break;case j.META_DATA_SOURCE_BADGE_FORM:ee[x.LayoutItemUUID]=z.Submissions.map(Y=>{const J=m.value.find(Pe=>Pe.FormUUID===Y.FormUUID);return{Heading:J==null?void 0:J.Heading,Form:J,Submission:Y,Registration:z}}).filter(Y=>{var J;return((J=Y.Form)==null?void 0:J.Type)===Ue.FORM_TYPE_BADGE});break;case j.META_DATA_SOURCE_DEALER_FORM:ee[x.LayoutItemUUID]=z.Submissions.map(Y=>{const J=m.value.find(Pe=>Pe.FormUUID===Y.FormUUID);return{Heading:J==null?void 0:J.Heading,Form:J,Submission:Y,Registration:z}}).filter(Y=>{var J;return((J=Y.Form)==null?void 0:J.Type)===Ue.FORM_TYPE_DEALER});break;case j.META_DATA_SOURCE_PAYMENT_STATUS:if(z.Paid===0&&z.Total)ee[x.LayoutItemUUID]="REQUIRED";else if(z.Total>z.Paid)ee[x.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const Y=ut.find(J=>J.Paid===0&&(J.Total||0)>0);if(Y){z.Total===0&&Y.Total===0?ee[x.LayoutItemUUID]="NOT_REQUIRED":z.Total===0&&Y.Total||z.Total>0&&Y.Total===0?ee[x.LayoutItemUUID]="MISSING_REQUIRED":z.Paid>=z.Total?ee[x.LayoutItemUUID]="AWAITING_PARTNER":ee[x.LayoutItemUUID]="ALL_REQUIRED";break}else z.Total===0?ee[x.LayoutItemUUID]="NOT_REQUIRED":ee[x.LayoutItemUUID]="COMPLETE"}break;case j.META_DATA_SOURCE_SUBMISSION_STATUS:El(z.Submissions,m.value),ee[x.LayoutItemUUID]=z.Submissions.map(Y=>{const J=m.value.find(Pe=>Pe.FormUUID===Y.FormUUID);return{Heading:J==null?void 0:J.Heading,Form:J,Submission:Y,Registration:z}});break;case j.META_DATA_SOURCE_DATA_LAYOUT:ee[x.LayoutItemUUID]={Registration:z,Layouts:U.value.filter(Y=>{if(x.Meta&&x.Meta.LayoutUUID&&Array.isArray(x.Meta.LayoutUUID))return x.Meta.LayoutUUID.includes(Y.AdminLayoutUUID)})};break}}}}),{key:z.RegistrationUUID,registration:z,...ee}})}),r.value=!1)})}catch{}},La=D=>{ie.value=!1,D&&(_.value=D,Yt())},Yt=()=>{_.value.Panels.forEach(D=>{D.Items.forEach(y=>{(y.SectionField==null||y.SectionField.Field==null)&&m.value.find(w=>{w.Sections.find(b=>{if(b.Fields){const re=b.Fields.find(se=>se.SectionFieldUUID===y.SectionFieldUUID);if(re)return y.SectionField=re,!0}})})})}),_.value.Panels.length>0&&(p.value=[],_.value.Panels.forEach(D=>{const y={uuid:ye(),order:D.Order,name:D.Name,headers:[],items:[],layout:D};D.Items.sort((w,b)=>w.Order>b.Order?1:w.Order==b.Order?0:-1),y.headers=D.Items.map(w=>{var b,re;return{key:w.LayoutItemUUID,title:w.Label||((re=(b=w.SectionField)==null?void 0:b.Field)==null?void 0:re.Label)||"",align:w.Align==="end"?"end":"start",sortable:wa(w),type:Fa(w),defaultSort:w.DefaultSort,meta:w.Meta}}),p.value.push(y)}),p.value=p.value.sort((D,y)=>D.order>y.order?1:D.order==y.order?0:-1)),(X.value==null||X.value=="")&&p.value.length>0&&(X.value=p.value[0].uuid)};a?d.getConvention(a).then(D=>{D&&(n.value=D,_.value.ConventionID=n.value.ID,_.value.ConventionUUID=n.value.ConventionUUID,Na())}).catch(()=>{i.push("/")}):i.push("/");const Fa=D=>{var y,w;if(D.SourceType===he.LAYOUT_ITEM_SOURCE_META)return`${D.SourceType}.${D.MetaField}`;if(D.SourceType===he.LAYOUT_ITEM_SOURCE_FORM)return(w=(y=D.SectionField)==null?void 0:y.Field)==null?void 0:w.Type;if(D.SourceType===he.LAYOUT_ITEM_SOURCE_USER)return`${D.SourceType}.${D.UserField}`},wa=D=>{const y=[j.META_DATA_SOURCE_ACCOMMODATION_FORM,j.META_DATA_SOURCE_BADGE_FORM,j.META_DATA_SOURCE_DEALER_FORM,j.META_DATA_SOURCE_REGISTRATION_FORM,j.META_DATA_SOURCE_REGISTRATION_REFERENCE,j.META_DATA_SOURCE_SUBMISSION_DATE,j.META_DATA_SOURCE_SUBMISSION_STATUS],w=[oe.USER_DATA_SOURCE_DISPLAY_NAME,oe.USER_DATA_SOURCE_EMAIL,oe.USER_DATA_SOURCE_HANDLE,oe.USER_DATA_SOURCE_DATE_OF_BIRTH,oe.USER_DATA_SOURCE_FIRST_NAME,oe.USER_DATA_SOURCE_LAST_NAME];return y.includes(D.MetaField)||w.includes(D.UserField)},Pa=D=>{De.value=D,we.value=!0},$a=D=>{De.value=D,Bt.value=!0},Ba=D=>{De.value=D,ka.value=!0};de(we,D=>{D||(De.value=void 0)}),de(Bt,D=>{D||(De.value=void 0)});const pt=async(D="")=>{Gt.value=await d.getRegistrationGroup(D)},Ga=({registration:D,form:y,submission:w})=>{De.value=D,pt(D.RegistrationUUID).then(()=>{st.value=y,Tt.value=w,Qe.value=!0})},Ya=D=>{d.switchUser(D.UserUUID).then(y=>{y&&zl(y.tokens,y.user,i,!1)}).catch(y=>{console.error(y)})};return c.on("registration.group.leave",D=>{d.leaveRegistrationGroup(D).then(y=>{y&&pt(D).then(()=>{c.emit("registration.group.left",y)})})}),c.on("registration.group.remove.member",D=>{d.leaveRegistrationGroup(D).then(y=>{y&&pt(D).then(()=>{c.emit("registration.group.left",y)})})}),(D,y)=>(u(),C(Kl,null,{default:l(()=>[t(bt,{color:"blue-darken-4"},{default:l(()=>[t(Ta,{modelValue:X.value,"onUpdate:modelValue":y[0]||(y[0]=w=>X.value=w),"show-arrows":""},{default:l(()=>[(u(!0),T(L,null,W(p.value,w=>(u(),C(_a,{key:w.uuid,value:w.uuid},{default:l(()=>[O(R(w.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(Ye),t(H,{icon:"mdi:mdi-cog-outline",onClick:y[1]||(y[1]=w=>ie.value=!0)})]),_:1}),t(Da,{modelValue:X.value,"onUpdate:modelValue":y[23]||(y[23]=w=>X.value=w),disabled:!0,touch:!1},{default:l(()=>[(u(!0),T(L,null,W(p.value,w=>(u(),C(Be,{key:w.uuid,value:w.uuid},{default:l(()=>[w.uuid===X.value?(u(),C(Me,{key:0,class:"pa-2"},{default:l(()=>[t(I(ln),{expanded:g.value,"onUpdate:expanded":y[19]||(y[19]=b=>g.value=b),page:N.value,"onUpdate:page":y[20]||(y[20]=b=>N.value=b),"items-per-page":h.value,"onUpdate:itemsPerPage":y[21]||(y[21]=b=>h.value=b),"sort-by":tt.value,"onUpdate:sortBy":y[22]||(y[22]=b=>tt.value=b),headers:w.headers,"items-length":B.value,items:w.items,"item-value":"key",loading:r.value,search:E.value,"onUpdate:options":_t,"show-expand":""},Xe({top:l(()=>[t(gt,{class:"mb-3"},{default:l(()=>[t(Ut,null,{default:l(()=>[t(vt,{color:"secondary",class:"font-weight-bold pb-0 pt-0"},{default:l(()=>[t(M,{class:"pa-0"},{default:l(()=>[O(" Search Criteria "),t(be,{class:"pl-5",icon:"mdi:mdi-credit-card-search-outline"})]),_:1}),t(M,{class:"d-none d-sm-block pa-0",cols:"0"},{default:l(()=>[t(ae,{modelValue:S.value,"onUpdate:modelValue":y[2]||(y[2]=b=>S.value=b),label:"Badge No.",clearable:!0,"hide-details":"",variant:"plain",onClick:y[3]||(y[3]=Ct(()=>{},["stop"])),"onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{class:"d-none d-md-block pa-0"},{default:l(()=>[t(ae,{modelValue:F.value.Value,"onUpdate:modelValue":y[4]||(y[4]=b=>F.value.Value=b),label:"Furry Name",clearable:!0,"hide-details":"",variant:"plain",onClick:y[5]||(y[5]=Ct(()=>{},["stop"])),"onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1})]),_:1}),t(ft,{class:"pt-2"},{default:l(()=>[t(K,null,{default:l(()=>[t(M,{cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:l(()=>[t(ae,{modelValue:S.value,"onUpdate:modelValue":y[6]||(y[6]=b=>S.value=b),label:"Badge No.",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{cols:"12",sm:"6",md:"4",lg:"5",xl:"2"},{default:l(()=>[t(ae,{modelValue:F.value.Value,"onUpdate:modelValue":y[7]||(y[7]=b=>F.value.Value=b),label:"Furry Name",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{cols:"12",sm:"12",md:"5",lg:"5",xl:"3"},{default:l(()=>[t(ae,{modelValue:V.value,"onUpdate:modelValue":y[8]||(y[8]=b=>V.value=b),label:"E-mail",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{cols:"12",sm:"6",md:"4",lg:"4",xl:"2"},{default:l(()=>[t(ae,{modelValue:G.value.Value,"onUpdate:modelValue":y[9]||(y[9]=b=>G.value.Value=b),label:"Legal Forename",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{cols:"12",sm:"6",md:"4",lg:"4",xl:"2"},{default:l(()=>[t(ae,{modelValue:ne.value.Value,"onUpdate:modelValue":y[10]||(y[10]=b=>ne.value.Value=b),label:"Legal Surname",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{cols:"12",sm:"12",md:"4",lg:"4",xl:"2"},{default:l(()=>[t(ae,{modelValue:fe.value.Value,"onUpdate:modelValue":y[11]||(y[11]=b=>fe.value.Value=b),type:"date",label:"Date of Birth",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":I(ve),onInput:I(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(M,{cols:"12",sm:"6",md:"6",lg:"6",xl:"6"},{default:l(()=>[t(ge,{modelValue:qe.value,"onUpdate:modelValue":y[12]||(y[12]=b=>qe.value=b),label:"Permission Groups",clearable:!0,"hide-details":"",variant:"outlined",items:f.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(M,{cols:"12",sm:"6",md:"6",lg:"6",xl:"6"},{default:l(()=>[t(ge,{modelValue:je.value,"onUpdate:modelValue":y[13]||(y[13]=b=>je.value=b),label:"Tags",clearable:!0,"hide-details":"",variant:"outlined",items:q.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),"expanded-row":l(({columns:b,item:re})=>[P("tr",null,[P("td",{colspan:b.length},[t(oa,{modelValue:we.value,"onUpdate:modelValue":y[15]||(y[15]=se=>we.value=se),registration:re.selectable.registration,"onUpdate:registration":se=>re.selectable.registration=se,accommodations:ze.value,convention:n.value,extras:Ie.value,forms:m.value,interests:Ne.value,tickets:Le.value,title:`Registration Controls (#${re.selectable.registration.Reference} ${re.selectable.registration.User.DisplayName})`,"use-dialog":!1,venues:Fe.value},null,8,["modelValue","registration","onUpdate:registration","accommodations","convention","extras","forms","interests","tickets","title","venues"])],8,Ei)])]),"item.data-table-expand":l(({item:b})=>[g.value.findIndex(re=>re===b.key)>=0?(u(),C(H,{key:0,"append-icon":"mdi:mdi-chevron-up",size:"xs",variant:"flat",onClick:re=>g.value.splice(g.value.findIndex(se=>se===b.key),1)},{default:l(()=>[b.selectable.registration.Notes&&b.selectable.registration.Notes.length>0?(u(),T(L,{key:0},[O(R(b.selectable.registration.Notes.length),1)],64)):$("",!0)]),_:2},1032,["onClick"])):(u(),C(H,{key:1,"append-icon":"mdi:mdi-chevron-down",size:"xs",variant:"flat",onClick:re=>g.value.push(b.key)},{default:l(()=>[b.selectable.registration.Notes&&b.selectable.registration.Notes.length>0?(u(),T(L,{key:0},[O(R(b.selectable.registration.Notes.length),1)],64)):$("",!0)]),_:2},1032,["onClick"]))]),bottom:l(()=>[t(Ae,{fluid:!0},{default:l(()=>[t(K,{class:"align-center"},{default:l(()=>[t(M,{cols:"12",lg:"7","order-lg":"3",xl:"8"},{default:l(()=>[t(Ii,{modelValue:N.value,"onUpdate:modelValue":y[16]||(y[16]=b=>N.value=b),length:Math.ceil(B.value/h.value)},null,8,["modelValue","length"])]),_:1}),t(M,{cols:"6",sm:"4",md:"2",lg:"2",xl:"1","order-lg":"1"},{default:l(()=>[t(ge,{"model-value":h.value,density:"compact","hide-details":"","item-title":"title","item-value":"value",label:"Items per page",min:"-1",max:"100",type:"number",variant:"outlined",items:[{title:"10",value:10},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100},{title:"All",value:-1}],"onUpdate:modelValue":y[17]||(y[17]=b=>h.value=parseInt(b,10))},null,8,["model-value"])]),_:1}),t(M,{cols:"6",sm:"3",md:"2",lg:"1",xl:"1","order-lg":"2"},{default:l(()=>[t(ae,{modelValue:N.value,"onUpdate:modelValue":y[18]||(y[18]=b=>N.value=b),modelModifiers:{number:!0},density:"compact","hide-details":"",label:"Page",min:"1",max:Math.ceil(B.value/h.value),type:"number",variant:"outlined"},null,8,["modelValue","max"])]),_:1}),t(M,{class:"text-right",cols:"12",sm:"5",md:"8",lg:"2",xl:"2","order-lg":"4"},{default:l(()=>[P("span",Si,[h.value===-1?(u(),T(L,{key:0},[O(" 1-"+R(B.value)+" of "+R(B.value),1)],64)):(u(),T(L,{key:1},[O(R((N.value-1)*h.value+1)+"-"+R(N.value*h.value>=B.value?B.value:N.value*h.value)+" of "+R(B.value),1)],64))])]),_:1})]),_:1})]),_:1})]),_:2},[W(w.headers,b=>({name:`item.${b.key}`,fn:l(({item:re})=>[t(vo,{header:b,item:re,accommodations:ze.value,convention:n.value,extras:Ie.value,forms:m.value,interests:Ne.value,tickets:Le.value,user:I(Ma),venues:Fe.value,onOpenActions:Pa,onOpenPayments:$a,onOpenTags:Ba,onReload:y[14]||(y[14]=se=>_t({page:N.value,itemsPerPage:h.value,sortBy:le.value})),onSwitchUser:Ya,onShowForm:Ga},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","user","venues"])])}))]),1032,["expanded","page","items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):$("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),ie.value?(u(),C(pi,{key:0,title:"Edit Layouts",modelValue:ie.value,"onUpdate:modelValue":y[24]||(y[24]=w=>ie.value=w),convention:n.value,onSave:La},null,8,["modelValue","convention"])):$("",!0),De.value?(u(),T(L,{key:1},[we.value?(u(),C(oa,{key:0,modelValue:we.value,"onUpdate:modelValue":y[25]||(y[25]=w=>we.value=w),registration:De.value,"onUpdate:registration":y[26]||(y[26]=w=>De.value=w),accommodations:ze.value,convention:n.value,extras:Ie.value,forms:m.value,interests:Ne.value,tickets:Le.value,title:`Registration Controls (#${De.value.Reference} ${De.value.User.DisplayName})`,"use-dialog":!0,venues:Fe.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","title","venues"])):$("",!0)],64)):$("",!0),Qe.value&&Tt.value&&st.value?(u(),C(mt,{key:2,modelValue:Qe.value,"onUpdate:modelValue":y[30]||(y[30]=w=>Qe.value=w),scrollable:!0,fullscreen:!0,persistent:!0},{default:l(()=>[t(Me,{class:"bg-red-darken-4"},{default:l(()=>[t(bt,{color:"error"},{default:l(()=>[t(Sa,null,{default:l(()=>[O("Submission Editor - Admin Mode")]),_:1}),t(Ye),t(Ql,null,{default:l(()=>[t(H,{icon:"mdi:mdi-window-close",onClick:y[27]||(y[27]=w=>Qe.value=!1)})]),_:1})]),_:1}),t(He,null,{default:l(()=>[t(rl,{modelValue:st.value,"onUpdate:modelValue":y[28]||(y[28]=w=>st.value=w),admin:!0,convention:n.value,data:Tt.value,editable:!0,"registration-group":Gt.value,onClose:y[29]||(y[29]=w=>{Qe.value=!1,_t({page:N.value,itemsPerPage:h.value,sortBy:le.value})})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):$("",!0)]),_:1}))}});export{cs as default};
