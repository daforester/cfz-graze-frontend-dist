import{p as We,n as Qe,e as te,t as Ae,c as Xe,G as Ze,v as o,H as M,x as ke,I as re,a1 as fe,a2 as He,r as v,a3 as _e,K as n,L as N,M as s,$ as pe,S as ee,a8 as Le,Z as B,Q as j,w as be,U as Y,O as y,R as U,N as G,_ as qe,a4 as xe,a0 as et}from"./index-6c694406.js";import{e as tt,T as at,d as ot,c as lt}from"./FormRenderer.vue_vue_type_style_index_0_lang-d226ca2b.js";import{a as nt,F as ne}from"./form-29fd1dbb.js";import{_ as je}from"./ModelDialog.vue_vue_type_script_setup_true_lang-7151e48f.js";import{m as it,k as st,l as ut,n as rt,o as dt,p as mt,q as At,u as _t,r as Ut,s as Tt,t as ct,v as Et,w as vt,x as St,y as Rt,z as Ne,A as Ve,B as Pe,_ as Dt,f as $e,g as It,h as Ot,i as ft,j as pt,d as Ct}from"./VWindowItem-558cc2b6.js";import{a as ie,V as q}from"./VRow-1dd0d181.js";import{V as Te}from"./VTextField-e663cb42.js";import{V as ue}from"./copyToClipboard-a6c647ce.js";import{u as Mt,j as ce}from"./VContainer-44c3b34d.js";import{V as yt,u as gt}from"./VCheckbox-85226ec5.js";import{v as Ee}from"./v4-a960c1f4.js";import{V as we,a as Ge}from"./VList-06af7da0.js";import{V as Se}from"./VBtn-5e983a58.js";import{S as kt}from"./submission-56c4c4f1.js";import{V as Lt}from"./VAvatar-1120a103.js";import{c as bt,e as Je}from"./VCard-49c0d652.js";import{V as ht}from"./VDialog-02ea7407.js";import{s as Oe}from"./sortSubmissions-8ed80f07.js";import{u as Ft}from"./useStoreAPI-699f896d.js";import{u as Nt,V as Vt}from"./VToolbar-9654f62c.js";import{V as Pt}from"./VSpacer-dcd568b4.js";import{V as Be}from"./VTable-a9ab205e.js";import"./index-26b71cef.js";import"./VChip-463a3f5f.js";import"./scopeId-b7915a4c.js";import"./VTextarea-c51afa1d.js";import"./userData-f5095659.js";import"./VForm-50d68cb2.js";import"./VToolbarItems-087410d8.js";import"./VDivider-9cda906e.js";var Ke=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Ke||{});const $t=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ve=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(ve||{});const wt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var L=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(L||{});const Gt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var F=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(F||{});const Bt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Yt=We({itemsLength:{type:[Number,String],required:!0},...it(),...st(),...ut()},"VDataTableServer"),Ht=Qe()({name:"VDataTableServer",props:Yt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,b)=>!0},setup(e,b){let{emit:T,slots:a}=b;const{groupBy:u}=rt(e),{sortBy:r,multiSort:I,mustSort:c}=dt(e),{page:S,itemsPerPage:p}=mt(e),t=te(()=>parseInt(e.itemsLength,10)),{columns:A,headers:l}=At(e,{groupBy:u,showSelect:Ae(e,"showSelect"),showExpand:Ae(e,"showExpand")}),{items:g}=_t(e,A),{toggleSort:R}=Ut({sortBy:r,multiSort:I,mustSort:c,page:S}),{opened:J,isGroupOpen:V,toggleGroup:ae,extractRows:K}=Tt({groupBy:u,sortBy:r}),{pageCount:oe,setItemsPerPage:se}=ct({page:S,itemsPerPage:p,itemsLength:t}),{flatItems:k}=Et(g,u,J),{isSelected:h,select:D,selectAll:$,toggleSelect:W,someSelected:le,allSelected:X}=vt(e,{allItems:g,currentPage:g}),{isExpanded:Z,toggleExpand:Ce}=St(e),Re=te(()=>K(g.value));Rt({page:S,itemsPerPage:p,sortBy:r,groupBy:u,search:Ae(e,"search")}),Xe("v-data-table",{toggleSort:R,sortBy:r}),Ze({VDataTableRows:{hideNoData:Ae(e,"hideNoData"),noDataText:Ae(e,"noDataText"),loading:Ae(e,"loading"),loadingText:Ae(e,"loadingText")}});const Q=te(()=>({page:S.value,itemsPerPage:p.value,sortBy:r.value,pageCount:oe.value,toggleSort:R,setItemsPerPage:se,someSelected:le.value,allSelected:X.value,isSelected:h,select:D,selectAll:$,toggleSelect:W,isExpanded:Z,toggleExpand:Ce,isGroupOpen:V,toggleGroup:ae,items:Re.value,groupedItems:k.value,columns:A.value,headers:l.value}));Mt(()=>{const[Me]=Ne.filterProps(e),[ye]=Ve.filterProps(e),[De]=Pe.filterProps(e),[i]=Be.filterProps(e);return o(Be,ke({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},i),{top:()=>{var d;return(d=a.top)==null?void 0:d.call(a,Q.value)},default:()=>{var d,m,_,z;return a.default?a.default(Q.value):o(M,null,[(d=a.colgroup)==null?void 0:d.call(a,Q.value),o("thead",{class:"v-data-table__thead",role:"rowgroup"},[o(Ve,ke(ye,{sticky:e.fixedHeader}),a)]),(m=a.thead)==null?void 0:m.call(a,Q.value),o("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(Q.value):o(Pe,ke(De,{items:k.value}),a)]),(_=a.tbody)==null?void 0:_.call(a,Q.value),(z=a.tfoot)==null?void 0:z.call(a,Q.value)])},bottom:()=>a.bottom?a.bottom(Q.value):o(Ne,Me,{prepend:a["footer.prepend"]})})})}}),qt=re({__name:"EditAdminLayout",props:fe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:fe(["save"],["update:modelValue"]),setup(e,{emit:b}){const T=He(e,"modelValue"),a=v(_e(e.layout)),u=v([]),r=pe(),I=({callback:t})=>{const A=()=>{t&&t("Failed to Save Layout")},l=()=>{t&&t("Layout Saved")};r.saveAdminLayout(a.value).then(g=>{g?(l(),b("save",g)):A()}).catch(()=>{A()})},c=()=>({ID:0,LayoutPanelUUID:Ee(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:ne.FORM_TYPE_NIL,RequiredGroupMemberships:[]}),S=t=>()=>({ID:0,LayoutItemUUID:Ee(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:ve.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1,DefaultSort:!1}),p=t=>{const A=u.value.find(l=>l.value===t.SectionFieldUUID);A&&(t.SectionFieldID=A.object.ID,t.SectionField=A.object)};return r.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(A=>A.Sections.forEach(l=>l.Fields&&u.value.push(...l.Fields.map(g=>{var J;return{title:`${A.Name} - ${l.Name} - ${(J=g.Field)==null?void 0:J.Name}`,value:g.SectionFieldUUID,object:g}})))),u.value.sort(tt("title"))}),(t,A)=>(n(),N(je,{modelValue:T.value,"onUpdate:modelValue":A[3]||(A[3]=l=>T.value=l),onSave:I,title:t.title,color:"primary"},{default:s(()=>[o(ce,{class:"px-0 mx-0",fluid:!0},{default:s(()=>[o(ie,null,{default:s(()=>[o(q,{cols:"12",sm:"6"},{default:s(()=>[o(Te,{modelValue:a.value.Name,"onUpdate:modelValue":A[0]||(A[0]=l=>a.value.Name=l),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),o(q,{cols:"12",sm:"6"},{default:s(()=>[o(ue,{modelValue:a.value.Type,"onUpdate:modelValue":A[1]||(A[1]=l=>a.value.Type=l),label:"Layout Type",items:ee($t),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),o($e,{modelValue:a.value.Panels,"onUpdate:modelValue":A[2]||(A[2]=l=>a.value.Panels=l),"new-item":c,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Le({_:2},[B(a.value.Panels,(l,g)=>({name:`panel_${g}`,fn:s(()=>[o(ce,{class:"px-0 mx-0",fluid:!0},{default:s(()=>[o(ie,null,{default:s(()=>[o(q,{cols:"12",sm:"6"},{default:s(()=>[o(Te,{modelValue:l.Name,"onUpdate:modelValue":R=>l.Name=R,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(q,{cols:"12",sm:"6"},{default:s(()=>[o(ue,{modelValue:l.RequiredFormType,"onUpdate:modelValue":R=>l.RequiredFormType=R,items:ee(nt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),o(ie,null,{default:s(()=>[o(q,{cols:"12"},{default:s(()=>[o(Dt,{label:"Required Groups",variant:"outlined",modelValue:l.RequiredGroupMemberships,"onUpdate:modelValue":R=>l.RequiredGroupMemberships=R,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o($e,{modelValue:l.Items,"onUpdate:modelValue":R=>l.Items=R,"new-item":S(l),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Le({_:2},[B(l.Items,(R,J)=>({name:`item_${J}`,fn:s(()=>[o(ce,{class:"px-0 mx-0",fluid:!0},{default:s(()=>[o(ie,null,{default:s(()=>[o(q,{cols:"12",sm:"6"},{default:s(()=>[o(Te,{modelValue:R.Label,"onUpdate:modelValue":V=>R.Label=V,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(ie,null,{default:s(()=>[o(q,{cols:"12",sm:"6"},{default:s(()=>[o(ue,{modelValue:R.SourceType,"onUpdate:modelValue":V=>R.SourceType=V,label:"Source Type",items:ee(wt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(q,{cols:"12",sm:"6"},{default:s(()=>[R.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),N(ue,{key:0,modelValue:R.SectionFieldUUID,"onUpdate:modelValue":V=>R.SectionFieldUUID=V,label:"Form Data",items:u.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:V=>p(R)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):R.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),N(ue,{key:1,modelValue:R.MetaField,"onUpdate:modelValue":V=>R.MetaField=V,label:"Miscellaneous Data",items:ee(Gt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):R.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),N(ue,{key:2,modelValue:R.UserField,"onUpdate:modelValue":V=>R.UserField=V,label:"User Profile Data",items:ee(Bt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):j("",!0)]),_:2},1024)]),_:2},1024),o(ie,null,{default:s(()=>[o(q,null,{default:s(()=>[o(yt,{modelValue:R.DefaultSort,"onUpdate:modelValue":V=>R.DefaultSort=V,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ye=e=>(typeof e=="string"&&(e=new Date(e)),`${e.toLocaleString("default",{weekday:"long"})} ${e.getDate()}${jt(e.getDate())} ${e.toLocaleString("default",{month:"long"})}`),jt=e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},Jt=Y("br",null,null,-1),Kt=Y("h3",null,"Accommodation Preferences",-1),zt=Y("h3",null,"Selected Tickets",-1),Wt=re({__name:"EditAccommodationAssignmentDialog",props:fe({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:fe(["update:field"],["update:modelValue"]),setup(e,{emit:b}){const T=e,{convention:a,registration:u,title:r=""}=T,I=pe(),c=He(e,"modelValue"),S=v([]),p=gt(T,b,void 0,void 0,"field"),t=v(_e(p.value));be(p,()=>{t.value=_e(p.value)});const A=v(),l=v(""),g=v(""),R=v([]),J=v({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),V=()=>{c.value=!1},ae=async()=>{var $;const k=await I.getConventionAvailableAccommodation(a.ConventionUUID);k&&(S.value=k);const h=await I.getRegistrationGroup(u.RegistrationUUID||"");h&&(A.value=h);const D=await I.getConventionTickets(a.ConventionUUID);D&&(R.value=D);try{J.value=JSON.parse((($=A.value)==null?void 0:$.TicketData)||"")}catch{}};be(l,()=>{g.value=oe.value.length>0?oe.value[0].value:""});const K=te(()=>S.value.map(k=>({title:`${k.Name}`,value:k.AccommodationUUID}))),oe=te(()=>{const k=se.value,h=S.value.find(D=>D.AccommodationUUID===l.value);return(h==null?void 0:h.Pool.map(D=>{var W;let $;return k.forEach(le=>{D.Costs.forEach(X=>{X.DateStart===(le==null?void 0:le.DateStart)&&X.DateEnd===le.DateEnd&&($===void 0||$>X.Availability)&&($=X.Availability)})}),{title:`${(W=D.Venue)==null?void 0:W.Name} - ${D.Name} (${$} Available)`,value:D.RoomUUID}}))||[]}),se=te(()=>[...J.value.Ticket,...J.value.AddonsChecked,...J.value.ComponentsChecked].map(k=>R.value.find(h=>h.TicketUUID===k)).filter(k=>k!==void 0&&k.RequiresAccommodation));return ae(),(k,h)=>(n(),N(je,{modelValue:c.value,"onUpdate:modelValue":h[2]||(h[2]=D=>c.value=D),title:ee(r),color:"primary"},{default:s(()=>[o(ce,{class:"pa-0",fluid:!0},{default:s(()=>[o(ie,null,{default:s(()=>[o(q,{cols:"12"},{default:s(()=>{var D,$;return[Y("h3",null,"Group Members ("+y((D=A.value)==null?void 0:D.Members.length)+")",1),(n(!0),U(M,null,B(($=A.value)==null?void 0:$.Members,W=>(n(),U(M,{key:W.UUID},[G(" #"+y(W.Reference)+" "+y(W.Name),1),Jt],64))),128))]}),_:1}),o(q,{cols:"12",md:"6"},{default:s(()=>[k.selectedAccommodation.length?(n(),U(M,{key:0},[Kt,o(we,{type:"number"},{default:s(()=>[(n(!0),U(M,null,B(k.selectedAccommodation,(D,$)=>(n(),N(Ge,{key:D.AccommodationUUID},{default:s(()=>[G(y($+1)+". "+y(D.Name),1)]),_:2},1024))),128))]),_:1})],64)):j("",!0)]),_:1}),o(q,{cosl:"12",md:"6"},{default:s(()=>[zt,o(we,{type:"number"},{default:s(()=>[(n(!0),U(M,null,B(se.value,D=>(n(),N(Ge,{key:D==null?void 0:D.TicketUUID},{default:s(()=>[G(y(D.Name)+" ("+y(ee(Ye)(D.DateStart))+" - "+y(ee(Ye)(D.DateEnd))+") ",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),o(ie,null,{default:s(()=>[o(q,{cols:"12",md:"6"},{default:s(()=>[o(ue,{modelValue:l.value,"onUpdate:modelValue":h[0]||(h[0]=D=>l.value=D),items:K.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),o(q,{cols:"12",md:"6"},{default:s(()=>[o(ue,{modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=D=>g.value=D),items:oe.value,"item-title":"title","item-value":"value",label:"Room Pool"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),actions:s(()=>[o(Se,{color:"blue-darken-1",variant:"text",onClick:V},{default:s(()=>[G(" Close ")]),_:1})]),_:1},8,["modelValue","title"]))}}),Qt={key:1,class:"accommodationList"},Xt=re({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},registration:{},value:{default:""},venues:{}},setup(e){const b=v(!1),T=te(()=>{if(!e.value)return[];const a=JSON.parse(e.value),u=e.accommodations.filter(r=>a.includes(r.AccommodationUUID)).sort((r,I)=>{const c=a.findIndex(p=>p===r.AccommodationUUID),S=a.findIndex(p=>p===I.AccommodationUUID);return c>S?1:-1});return _e(u)});return(a,u)=>{var r,I,c;return n(),U(M,null,[a.registration.Allocation?(n(),U(M,{key:0},[G(y((r=a.accommodations.find(S=>S.AccommodationUUID===a.registration.Allocation.AccommodationUUID))==null?void 0:r.Name)+" "+y((c=(I=a.venues)==null?void 0:I.map(S=>S.Rooms.find(p=>p.RoomUUID===a.registration.Allocation.RoomUUID)).filter(S=>S!=null)[0])==null?void 0:c.Name),1)],64)):j("",!0),a.value?(n(),U("ol",Qt,[(n(!0),U(M,null,B(T.value,S=>(n(),U("li",{key:S.AccommodationUUID},y(S.Name),1))),128))])):j("",!0),o(Se,{onClick:u[0]||(u[0]=S=>b.value=!0),variant:"flat",color:"success"},{default:s(()=>[G("Assign Accommodation")]),_:1}),a.convention&&b.value?(n(),N(Wt,{key:2,modelValue:b.value,"onUpdate:modelValue":u[1]||(u[1]=S=>b.value=S),title:"Accommodation Allocation",convention:a.convention,registration:a.registration,"selected-accommodation":T.value},null,8,["modelValue","convention","registration","selected-accommodation"])):j("",!0)],64)}}});const Zt=qe(Xt,[["__scopeId","data-v-14a6c9a0"]]),xt={key:0,class:"addonList"},ea={key:0},ta={key:0},aa=re({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const b=te(()=>{if(!e.value)return;const T=JSON.parse(e.value),a=Object.keys(T),u=_e(e.extras);return u.forEach(r=>{r.Options=r.Options.filter(I=>a.includes(I.OptionUUID)?(I.Choices=I.Choices.filter(c=>c.TagUUID===T[I.OptionUUID].choiceId),T[I.OptionUUID].checked):!1)}),u.filter(r=>r.Options.length>0),u});return(T,a)=>T.value?(n(),U("ul",xt,[(n(!0),U(M,null,B(b.value,u=>(n(),U(M,{key:u.ExtraUUID},[u.Options.length?(n(),U("li",ea,[Y("strong",null,y(u.Name),1),Y("ul",null,[(n(!0),U(M,null,B(u.Options,r=>(n(),U("li",{key:r.OptionUUID},[G(y(r.Name)+" ",1),r.Choices.length==1?(n(),U("small",ta,"("+y(r.Choices[0].Title)+")",1)):j("",!0)]))),128))])])):j("",!0)],64))),128))])):j("",!0)}});const oa=qe(aa,[["__scopeId","data-v-55786e01"]]),la={key:0},na=re({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const b=te(()=>{if(!e.value)return;const T=JSON.parse(e.value);return Object.entries(T).filter(([,a])=>a).map(([a,u])=>e.interests.find(r=>r.InterestUUID===a)).filter(a=>a!==void 0)});return(T,a)=>T.value?(n(),U("ul",la,[(n(!0),U(M,null,B(b.value,u=>(n(),U("li",{key:u.InterestUUID},y(u.Name),1))),128))])):j("",!0)}}),ia=Y("br",null,null,-1),sa=Y("small",null,"Options:",-1),ua=Y("br",null,null,-1),ra=Y("small",null,"Addons:",-1),da=re({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const b=te(()=>{if(!e.value)return;let T={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{T=JSON.parse(e.value),"ticket"in T&&(T.Ticket=T.ticket),"addonsChecked"in T&&(T.AddonsChecked=T.addonsChecked),"componentsChecked"in T&&(T.ComponentsChecked=T.componentsChecked)}catch{}return T.Ticket.filter(a=>{const u=e.tickets.find(r=>r.TicketUUID===a);return!(!u||u.Type!==at.TICKET_TYPE_TICKET)}).map(a=>{const u=e.tickets.find(I=>I.TicketUUID===a),r=_e(u);return r.TicketComponents=u.TicketComponents.filter(I=>T.ComponentsChecked.includes(I.TicketUUID)),r.AddonTickets=u.AddonTickets.filter(I=>T.AddonsChecked.includes(I.TicketUUID)),r})});return(T,a)=>T.value?(n(!0),U(M,{key:0},B(b.value,u=>(n(),U("div",{key:u.TicketUUID},[Y("strong",null,y(u.Name),1),u.TicketComponents.length>0?(n(),U(M,{key:0},[ia,sa,G("  "),(n(!0),U(M,null,B(u.TicketComponents,r=>(n(),U(M,{key:r.TicketUUID},[Y("small",null,y(r.Name),1),G("  ")],64))),128))],64)):j("",!0),u.AddonTickets.length>0?(n(),U(M,{key:1},[ua,ra,G("  "),(n(!0),U(M,null,B(u.AddonTickets,r=>(n(),U("small",{key:r.TicketUUID},[G("("),Y("em",null,y(r.Name),1),G(")")]))),128))],64)):j("",!0)]))),128)):j("",!0)}}),ma={key:0},Aa={key:0},_a=Y("strong",null,"Total:",-1),Ua=re({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:b}){const T=pe(),a=v(),u=v(),r=v(),I=v(),c=v(!1),S=t=>{console.log(t)},p=(t,A,l)=>{u.value=t,T.getRegistrationGroup(l.RegistrationUUID||"").then(g=>{r.value=g,a.value=A,I.value=l,c.value=!0})};return(t,A)=>(n(),U(M,null,[t.header.key=="actions"?(n(),N(Se,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:A[0]||(A[0]=l=>S(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(n(),N(Zt,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,convention:t.convention,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","convention","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(n(),N(oa,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(n(),N(na,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(n(),N(da,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(n(!0),U(M,{key:5},B(t.item.raw[t.header.key],l=>(n(),U("ul",{key:l.Heading},[Y("li",null,[Y("strong",null,y(l.Heading)+":",1),G(" "+y(ee(kt)(l.Submission.Status))+" ",1),o(Se,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:g=>p(l.Registration,l.Form,l.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(n(),N(Lt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(n(),U(M,{key:7},[t.item.raw[t.header.key].length===1?(n(),U("em",ma," Not in a group ")):(n(),U(M,{key:1},[Y("ul",null,[(n(!0),U(M,null,B(t.item.raw[t.header.key],l=>(n(),U("li",{key:l.UUID,class:"ml-0"},[G(" #"+y(l.Reference)+" : "+y(l.Name)+" ",1),l.IsLeader?(n(),U("strong",Aa,"(Leader)")):j("",!0)]))),128))]),_a,G(" "+y(t.item.raw[t.header.key].length),1)],64))],64)):(n(),U(M,{key:8},[G(y(t.item.raw[t.header.key]),1)],64)),c.value&&I.value&&a.value?(n(),N(ht,{key:9,modelValue:c.value,"onUpdate:modelValue":A[3]||(A[3]=l=>c.value=l),scrollable:!0},{default:s(()=>[o(Je,{class:"bg-red-darken-4"},{default:s(()=>[o(bt,null,{default:s(()=>[o(ot,{modelValue:a.value,"onUpdate:modelValue":A[1]||(A[1]=l=>a.value=l),admin:!0,convention:t.convention,data:I.value,editable:!0,"registration-group":r.value,onClose:A[2]||(A[2]=l=>{c.value=!1,b("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0)],64))}}),ja=re({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:b}){var De;const T=Ft();b("pageTitle","Registration Manager");const a=xe(),u=et(),r=v(!0);let I=((De=a.params.convention)==null?void 0:De.toString())||"";const c=v({ID:0,ConventionUUID:Ee(),OrganisationID:0,OrganisationUUID:Nt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),S=pe(),p=v({ID:0,AdminLayoutUUID:Ee(),ConventionID:c.value.ID,ConventionUUID:c.value.ConventionUUID,Name:"Registration Table",Type:Ke.ADMIN_LAYOUT_TABLE,Panels:[]}),t=v([]),A=v([]),l=v([]),g=v(1),R=v(10),J=v([]),V=v(0),ae=v(!1),K=v(""),oe=v(""),se=v(""),k=v(""),h=v([]),D=v([]),$=v([]),W=v([]),le=v([]),X=v([]),Z=v(0);be(Z,i=>{i===7&&Q()});const Ce=()=>{t.value=[],A.value=[],l.value=[];try{S.getConventionAdminLayoutByName(c.value.ConventionUUID,"Registration Table").then(i=>{Z.value+=1,i?p.value=i:(p.value.ConventionID=c.value.ID,p.value.ConventionUUID=c.value.ConventionUUID)})}catch{p.value.ConventionID=c.value.ID,p.value.ConventionUUID=c.value.ConventionUUID}try{S.getConventionForms(c.value.ConventionUUID).then(i=>{Z.value+=1,i&&(t.value=i)})}catch{}try{S.getConventionAccommodation(c.value.ConventionUUID).then(i=>{Z.value+=1,i&&(D.value=i)})}catch{}try{S.getConventionVenues(c.value.ConventionUUID).then(i=>{Z.value+=1,i&&(X.value=i)})}catch{}try{S.getConventionExtras(c.value.ConventionUUID).then(i=>{Z.value+=1,i&&($.value=i)})}catch{}try{S.getConventionInterests(c.value.ConventionUUID).then(i=>{Z.value+=1,i&&(W.value=i)})}catch{}try{S.getConventionTickets(c.value.ConventionUUID).then(i=>{Z.value+=1,i&&(le.value=i)})}catch{}},Re=({page:i,itemsPerPage:d,sortBy:m})=>{g.value=i,J.value=m;const _=l.value.find(w=>w.uuid==K.value),z=_==null?void 0:_.layout.Items;let H="",he="";if(m&&z&&m.length>=1){const w=z.find(Ue=>Ue.LayoutItemUUID==m[0].key);switch(he=m[0].order,w==null?void 0:w.MetaField){case L.META_DATA_SOURCE_ACCOMMODATION_FORM:H="submission.status";break;case L.META_DATA_SOURCE_BADGE_FORM:H="submission.status";break;case L.META_DATA_SOURCE_DEALER_FORM:H="submission.status";break;case L.META_DATA_SOURCE_REGISTRATION_FORM:H="submission.status";break;case L.META_DATA_SOURCE_REGISTRATION_REFERENCE:H="reference";break;case L.META_DATA_SOURCE_SUBMISSION_DATE:H="created";break;case L.META_DATA_SOURCE_SUBMISSION_STATUS:H="submission.status";break}switch(w==null?void 0:w.UserField){case F.USER_DATA_SOURCE_DISPLAY_NAME:H="user.display_name";break;case F.USER_DATA_SOURCE_EMAIL:H="user.email";break;case F.USER_DATA_SOURCE_FIRST_NAME:H="user.firstname";break;case F.USER_DATA_SOURCE_HANDLE:H="user.handle";break;case F.USER_DATA_SOURCE_LAST_NAME:H="user.lastname";break}}try{const w={Direction:he,Limit:d,Offset:(i-1)*d,Order:H};(_==null?void 0:_.layout.RequiredFormType)===ne.FORM_TYPE_ACCOMMODATION&&(w.Accommodation=!0),(_==null?void 0:_.layout.RequiredFormType)===ne.FORM_TYPE_BADGE&&(w.Badge=!0),(_==null?void 0:_.layout.RequiredFormType)===ne.FORM_TYPE_DEALER&&(w.Dealer=!0),(_==null?void 0:_.layout.RequiredFormType)===ne.FORM_TYPE_REGISTRATION&&(w.Registration=!0),w.Email=k.value,w.Reference=se.value,S.searchConventionRegistrations(c.value.ConventionUUID,w).then(Ue=>{Ue&&(V.value=Ue.Total,A.value=Ue.Registrations,l.value.forEach(ge=>{const ze=ge.layout;ge.items=A.value.map(C=>{const P={};return ge.headers.forEach(Fe=>{const f=ze.Items.find(de=>de.LayoutItemUUID===Fe.key);if(f){if(f.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&f.SectionField)C.Submissions.forEach(de=>{const x=de.Data.find(Ie=>Ie.SectionFieldUUID===f.SectionFieldUUID);if(x){Fe.type===lt.ACCOMMODATION?P[f.LayoutItemUUID]={Data:x.Data,Registration:C}:P[f.LayoutItemUUID]=x.Data;return}});else if(f.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&f.UserField)switch(f.UserField){case F.USER_DATA_SOURCE_AVATAR:P[f.LayoutItemUUID]=T.GetProfileImageURL(C.UserUUID);break;case F.USER_DATA_SOURCE_DISPLAY_NAME:P[f.LayoutItemUUID]=C.User.DisplayName;break;case F.USER_DATA_SOURCE_EMAIL:P[f.LayoutItemUUID]=C.User.Additional.Email;break;case F.USER_DATA_SOURCE_HANDLE:P[f.LayoutItemUUID]=C.User.Handle;break;case F.USER_DATA_SOURCE_DATE_OF_BIRTH:P[f.LayoutItemUUID]=C.User.Additional.DOB;break;case F.USER_DATA_SOURCE_FIRST_NAME:P[f.LayoutItemUUID]=C.User.Additional.FirstName;break;case F.USER_DATA_SOURCE_LAST_NAME:P[f.LayoutItemUUID]=C.User.Additional.LastName;break;case F.USER_DATA_SOURCE_TELEGRAM:P[f.LayoutItemUUID]="";break}else if(f.SourceType==="LAYOUT_ITEM_SOURCE_META"&&f.MetaField){const de=[];let x;const Ie=C.Submissions.find(E=>{var O;return((O=E.Form)==null?void 0:O.Type)===ne.FORM_TYPE_REGISTRATION});switch(f.MetaField){case L.META_DATA_SOURCE_REGISTRATION_GROUP:C.Leader?x=C:x=C.Primary,de.push({Name:x.User.DisplayName,UUID:x.UserUUID,IsLeader:!0,Reference:x.Reference}),de.push(...x.Members.map(E=>({Name:E.User.DisplayName,UUID:E.UserUUID,IsLeader:!1,Reference:E.Reference}))),P[f.LayoutItemUUID]=de;break;case L.META_DATA_SOURCE_REGISTRATION_REFERENCE:P[f.LayoutItemUUID]=C.Reference;break;case L.META_DATA_SOURCE_SUBMISSION_DATE:if(Ie){const E=new Date(Ie.CreatedAt||"");P[f.LayoutItemUUID]=`${E.getFullYear()}-${(E.getMonth()+1).toString().padStart(2,"0")}-${E.getDate().toString().padStart(2,"0")} ${E.getHours().toString().padStart(2,"0")}:${E.getMinutes().toString().padStart(2,"0")}:${E.getSeconds().toString().padStart(2,"0")}`}else{const E=new Date(C.CreatedAt||"");P[f.LayoutItemUUID]=`${E.getFullYear()}-${(E.getMonth()+1).toString().padStart(2,"0")}-${E.getDate().toString().padStart(2,"0")} ${E.getHours().toString().padStart(2,"0")}:${E.getMinutes().toString().padStart(2,"0")}:${E.getSeconds().toString().padStart(2,"0")}`}break;case L.META_DATA_SOURCE_ACCOMMODATION_FORM:Oe(C.Submissions,t.value),P[f.LayoutItemUUID]=C.Submissions.map(E=>{const O=t.value.find(me=>me.FormUUID===E.FormUUID);return{Heading:O==null?void 0:O.Heading,Form:O,Submission:E,Registration:C}}).filter(E=>{var O;return((O=E.Form)==null?void 0:O.Type)===ne.FORM_TYPE_ACCOMMODATION});break;case L.META_DATA_SOURCE_BADGE_FORM:Oe(C.Submissions,t.value),P[f.LayoutItemUUID]=C.Submissions.map(E=>{const O=t.value.find(me=>me.FormUUID===E.FormUUID);return{Heading:O==null?void 0:O.Heading,Form:O,Submission:E,Registration:C}}).filter(E=>{var O;return((O=E.Form)==null?void 0:O.Type)===ne.FORM_TYPE_BADGE});break;case L.META_DATA_SOURCE_DEALER_FORM:Oe(C.Submissions,t.value),P[f.LayoutItemUUID]=C.Submissions.map(E=>{const O=t.value.find(me=>me.FormUUID===E.FormUUID);return{Heading:O==null?void 0:O.Heading,Form:O,Submission:E,Registration:C}}).filter(E=>{var O;return((O=E.Form)==null?void 0:O.Type)===ne.FORM_TYPE_DEALER});break;case L.META_DATA_SOURCE_SUBMISSION_STATUS:Oe(C.Submissions,t.value),P[f.LayoutItemUUID]=C.Submissions.map(E=>{const O=t.value.find(me=>me.FormUUID===E.FormUUID);return{Heading:O==null?void 0:O.Heading,Form:O,Submission:E,Registration:C}});break}}}}),P})}),r.value=!1)})}catch{}},Q=()=>{p.value.Panels.forEach(i=>{i.Items.forEach(d=>{(d.SectionField==null||d.SectionField.Field==null)&&t.value.find(m=>{m.Sections.find(_=>{if(_.Fields){const z=_.Fields.find(H=>H.SectionFieldUUID===d.SectionFieldUUID);if(z)return d.SectionField=z,!0}})})})}),p.value.Panels.length>0&&(l.value=[],p.value.Panels.forEach(i=>{const d={uuid:Ee(),order:i.Order,name:i.Name,headers:[],items:[],layout:i};i.Items.sort((m,_)=>m.Order>_.Order?1:m.Order==_.Order?0:-1),d.headers=i.Items.map(m=>{var _,z;return m.DefaultSort&&h.value.push({key:m.LayoutItemUUID,order:"asc"}),{key:m.LayoutItemUUID,title:m.Label||((z=(_=m.SectionField)==null?void 0:_.Field)==null?void 0:z.Label)||"",align:m.Align==="end"?"end":"start",sortable:ye(m),type:Me(m)}}),l.value.push(d)})),(K.value==null||K.value=="")&&l.value.length>0&&(K.value=l.value[0].uuid)};I?S.getConvention(I).then(i=>{i&&(c.value=i,Ce())}).catch(()=>{u.push("/")}):u.push("/");const Me=i=>{var d,m;if(i.SourceType===ve.LAYOUT_ITEM_SOURCE_META)return`${i.SourceType}.${i.MetaField}`;if(i.SourceType===ve.LAYOUT_ITEM_SOURCE_FORM)return(m=(d=i.SectionField)==null?void 0:d.Field)==null?void 0:m.Type;if(i.SourceType===ve.LAYOUT_ITEM_SOURCE_USER)return`${i.SourceType}.${i.UserField}`},ye=i=>{const d=[L.META_DATA_SOURCE_ACCOMMODATION_FORM,L.META_DATA_SOURCE_BADGE_FORM,L.META_DATA_SOURCE_DEALER_FORM,L.META_DATA_SOURCE_REGISTRATION_FORM,L.META_DATA_SOURCE_REGISTRATION_REFERENCE,L.META_DATA_SOURCE_SUBMISSION_DATE,L.META_DATA_SOURCE_SUBMISSION_STATUS],m=[F.USER_DATA_SOURCE_DISPLAY_NAME,F.USER_DATA_SOURCE_EMAIL,F.USER_DATA_SOURCE_HANDLE,F.USER_DATA_SOURCE_DATE_OF_BIRTH,F.USER_DATA_SOURCE_FIRST_NAME,F.USER_DATA_SOURCE_LAST_NAME];return d.includes(i.MetaField)||m.includes(i.UserField)};return(i,d)=>(n(),N(Ct,null,{default:s(()=>[o(Vt,{color:"blue-darken-4"},{default:s(()=>[o(It,{modelValue:K.value,"onUpdate:modelValue":d[0]||(d[0]=m=>K.value=m),"show-arrows":""},{default:s(()=>[(n(!0),U(M,null,B(l.value,m=>(n(),N(Ot,{key:m.uuid,value:m.uuid},{default:s(()=>[G(y(m.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(Pt),o(Se,{icon:"mdi:mdi-cog-outline",onClick:d[1]||(d[1]=m=>ae.value=!0)})]),_:1}),o(pt,{modelValue:K.value,"onUpdate:modelValue":d[9]||(d[9]=m=>K.value=m),disabled:!0},{default:s(()=>[(n(!0),U(M,null,B(l.value,m=>(n(),N(ft,{key:m.uuid,value:m.uuid},{default:s(()=>[m.uuid===K.value?(n(),N(Je,{key:0,class:"pa-2"},{default:s(()=>[o(ee(Ht),{"items-per-page":R.value,"onUpdate:itemsPerPage":d[7]||(d[7]=_=>R.value=_),"sort-by":h.value,"onUpdate:sortBy":d[8]||(d[8]=_=>h.value=_),headers:m.headers,"items-length":V.value,items:m.items,"item-value":"LayoutItemUUID",loading:r.value,search:oe.value,"onUpdate:options":Re},Le({top:s(()=>[o(ce,null,{default:s(()=>[o(ie,null,{default:s(()=>[o(q,null,{default:s(()=>[o(Te,{modelValue:se.value,"onUpdate:modelValue":d[2]||(d[2]=_=>se.value=_),label:"Search by Badge",onInput:d[3]||(d[3]=_=>oe.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),o(q,null,{default:s(()=>[o(Te,{modelValue:k.value,"onUpdate:modelValue":d[4]||(d[4]=_=>k.value=_),label:"Search By Email",onInput:d[5]||(d[5]=_=>oe.value=Date.now().toString())},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:2},[B(m.headers,_=>({name:`item.${_.key}`,fn:s(({item:z})=>[o(Ua,{header:_,item:z,accommodations:D.value,convention:c.value,extras:$.value,interests:W.value,tickets:le.value,venues:X.value,onReload:d[6]||(d[6]=H=>Re({page:g.value,itemsPerPage:R.value,sortBy:J.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):j("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),ae.value?(n(),N(qt,{key:0,title:"Edit Layout",modelValue:ae.value,"onUpdate:modelValue":d[10]||(d[10]=m=>ae.value=m),layout:p.value,onSave:d[11]||(d[11]=m=>{ae.value=!1,Q()})},null,8,["modelValue","layout"])):j("",!0)]),_:1}))}});export{ja as default};
