import{u as X}from"./useGrazeAPI-c1e75c1b.js";import{V as ee}from"./VContainer-c8b4685d.js";import{V as D,a as le}from"./VRow-507c8708.js";import{V as k,u as oe}from"./VCheckbox-e128d928.js";import{d as J,Y as j,Z as ae,o as f,b as x,w as o,c as l,y as p,S as $,k as H,h as ne,M as Z,O as S,F as L,P as se,e as M,G as h,f as d,H as Ne,D as Ve,L as z,aq as Te,z as te}from"./index-181421cc.js";import{_ as ue,a as ge}from"./ModelDialog.vue_vue_type_script_setup_true_lang-fad84fb0.js";import{V as Re}from"./VTextField-0c9ac203.js";import{V as Q}from"./VSelect-b81109c3.js";import{u as A}from"./nil-d01db1aa.js";import{G as Pe,A as we}from"./userData-887aea4a.js";import{u as Se}from"./useAvatar-6bd3a630.js";import{_ as De}from"./SaveButton.vue_vue_type_script_setup_true_lang-ae6005f8.js";import{V as Ge,a as be,c as he}from"./VList-f901a01c.js";import{V as y}from"./VBtn-99c3a21a.js";import{V as Me}from"./VImg-cb210a93.js";import{V as Ce}from"./VDialog-c1da656d.js";import{e as Ye,V as Ae,a as ye,c as ke,d as Le}from"./VCard-1b7e593d.js";import{V as ie}from"./VSpacer-d97ac40e.js";import{b as xe}from"./VToolbar-bce2e74a.js";import{V as We}from"./VTable-77615c8f.js";import{v as q}from"./v4-a960c1f4.js";import"./rounded-1ea7487a.js";import"./index-266f4b76.js";import"./index-517d66df.js";import"./scopeId-dd91c5f8.js";import"./VChip-54ec485a.js";import"./VAvatar-925d3504.js";import"./ssrBoot-e334900c.js";import"./createSimpleFunctional-0e7b9320.js";var G=(n=>(n.GROUP_TYPE_ADMIN="GROUP_TYPE_ADMIN",n.GROUP_TYPE_SYSTEM="GROUP_TYPE_SYSTEM",n.GROUP_TYPE_ORGANISATION="GROUP_TYPE_ORGANISATION",n.GROUP_TYPE_CONVENTION="GROUP_TYPE_CONVENTION",n))(G||{}),P=(n=>(n.OWNER_TYPE_ADMIN="",n.OWNER_TYPE_CONVENTION="conventions",n.OWNER_TYPE_ORGANISATION="organisations",n.OWNER_TYPE_SYSTEM="",n))(P||{}),re=(n=>(n.PERMISSION_TYPE_NULL="PERMISSION_TYPE_NULL",n.PERMISSION_TYPE_EDIT_CONVENTION="PERMISSION_TYPE_EDIT_CONVENTION",n.PERMISSION_TYPE_EDIT_ORGANISATION="PERMISSION_TYPE_EDIT_ORGANISATION",n.PERMISSION_TYPE_MANAGE_USERS="PERMISSION_TYPE_MANAGE_USERS",n.PERMISSION_TYPE_MANAGE_VIEWS="PERMISSION_TYPE_MANAGE_VIEWS",n.PERMISSION_TYPE_EDIT_REGISTRATIONS="PERMISSION_TYPE_EDIT_REGISTRATIONS",n.PERMISSION_TYPE_VIEW_REGISTRATIONS="PERMISSION_TYPE_VIEW_REGISTRATIONS",n))(re||{});const de=J({__name:"EditGroupPermissions",props:j({disabled:{type:Boolean}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(n){const U=ae(n,"modelValue");return(O,m)=>(f(),x(ee,null,{default:o(()=>[l(le,null,{default:o(()=>[l(D,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(k,{modelValue:U.value.EditConvention,"onUpdate:modelValue":m[0]||(m[0]=I=>U.value.EditConvention=I),label:"Edit Convention","hide-details":"",disabled:O.disabled},null,8,["modelValue","disabled"])]),_:1}),l(D,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(k,{modelValue:U.value.EditOrganisation,"onUpdate:modelValue":m[1]||(m[1]=I=>U.value.EditOrganisation=I),label:"Edit Organisation","hide-details":"",disabled:O.disabled},null,8,["modelValue","disabled"])]),_:1}),l(D,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(k,{modelValue:U.value.EditRegistration,"onUpdate:modelValue":m[2]||(m[2]=I=>U.value.EditRegistration=I),label:"Edit Registrations","hide-details":"",disabled:O.disabled},null,8,["modelValue","disabled"])]),_:1}),l(D,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(k,{modelValue:U.value.ManageUsers,"onUpdate:modelValue":m[3]||(m[3]=I=>U.value.ManageUsers=I),label:"Manage Users","hide-details":"",disabled:O.disabled},null,8,["modelValue","disabled"])]),_:1}),l(D,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(k,{modelValue:U.value.ManageViews,"onUpdate:modelValue":m[4]||(m[4]=I=>U.value.ManageViews=I),label:"Manage Views","hide-details":"",disabled:O.disabled},null,8,["modelValue","disabled"])]),_:1}),l(D,{cols:"12",sm:"6",md:"4"},{default:o(()=>[l(k,{modelValue:U.value.ViewRegistration,"onUpdate:modelValue":m[5]||(m[5]=I=>U.value.ViewRegistration=I),label:"View Registrations","hide-details":"",disabled:O.disabled},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}))}}),$e=J({__name:"EditGroupDialog",props:j({conventions:{},organisations:{},group:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:j(["update:group","save"],["update:modelValue"]),setup(n,{emit:U}){const O=n,m=X(),{conventions:I,organisations:C,title:R=""}=O,N=ae(n,"modelValue"),i=oe(O,U,void 0,void 0,"group"),t=p($(i.value)),_=p(null);t.value.OwnerType===P.OWNER_TYPE_CONVENTION?_.value=I.filter(u=>u.ConventionUUID==t.value.OwnerUUID).map(u=>u.ConventionUUID).join(""):t.value.OwnerType===P.OWNER_TYPE_ORGANISATION?_.value=C.filter(u=>u.OrganisationUUID==t.value.OwnerUUID).map(u=>u.OrganisationUUID).join(""):(t.value.Type===G.GROUP_TYPE_SYSTEM||t.value.Type===G.GROUP_TYPE_ADMIN)&&(_.value=null),H(i,()=>{t.value=$(i.value)});const c=p({ID:0,PermissionUUID:A,GroupID:0,GroupUUID:A,EditConvention:!1,EditOrganisation:!1,EditRegistration:!1,ViewRegistration:!1,ManageUsers:!1,ManageViews:!1});m.getPermission(G.GROUP_TYPE_SYSTEM,A).then(u=>{c.value=u,T()}).catch(()=>{});const V=()=>{t.value=$(i.value),T()},b=u=>{if(_.value==null)t.value.Type=G.GROUP_TYPE_ADMIN,t.value.OwnerType=null,t.value.OwnerID=null,t.value.OwnerUUID=null;else{const e=Y.value.find(v=>_.value===v.OwnerUUID);e&&(e.OwnerType==P.OWNER_TYPE_ORGANISATION?t.value.Type=G.GROUP_TYPE_ORGANISATION:e.OwnerType==P.OWNER_TYPE_CONVENTION&&(t.value.Type=G.GROUP_TYPE_CONVENTION),t.value.OwnerType=e.OwnerType,t.value.OwnerID=e.OwnerID,t.value.OwnerUUID=e.OwnerUUID)}m.saveGroup(t.value).then(e=>{e&&u&&u("Group Saved").then(()=>{i.value=e,U("save",e)})}).catch(()=>{u&&u("Failed to Save Group")})},T=()=>{const u=Y.value.find(e=>t.value.OwnerUUID===e.OwnerUUID);u?_.value=u.OwnerUUID:Y.value.length>0&&(_.value=null)},Y=ne(()=>{const u=[];return c.value.ManageUsers&&u.push({Label:"System Admin",OwnerID:null,OwnerUUID:null,OwnerType:null}),u.push(...I.map(e=>({Label:`${e.Name} (Convention)`,OwnerID:e.ID,OwnerUUID:e.ConventionUUID,OwnerType:P.OWNER_TYPE_CONVENTION}))),u.push(...C.map(e=>({Label:`${e.Name} (Organisation)`,OwnerID:e.ID,OwnerUUID:e.OrganisationUUID,OwnerType:P.OWNER_TYPE_ORGANISATION}))),u});return T(),(u,e)=>(f(),x(ue,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=v=>N.value=v),onReset:V,onSave:b,title:Z(R),color:"primary","show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:o(()=>[l(ee,{class:"pa-0",fluid:!0},{default:o(()=>[l(le,null,{default:o(()=>[l(D,{cols:"12",md:"6"},{default:o(()=>[l(Re,{modelValue:t.value.Name,"onUpdate:modelValue":e[0]||(e[0]=v=>t.value.Name=v),label:"Name",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(D,{cols:"12",md:"6"},{default:o(()=>[l(Q,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=v=>_.value=v),label:"Owner",items:Y.value,"item-title":"Label","item-value":"OwnerUUID",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),l(D,{cols:"12"},{default:o(()=>[l(de,{modelValue:t.value.Permission,"onUpdate:modelValue":e[2]||(e[2]=v=>t.value.Permission=v),disabled:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),je=d("p",null," Are you sure you wish to remove this user? If they have permissions from another group these will still be usable. To add the user back into the group you may need to provide them with a new invite link. ",-1),Fe={key:1},Be=["href","onClick"],ze=J({__name:"EditGroupMembersDialog",props:j({group:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:j(["update:group","save"],["update:modelValue"]),setup(n,{emit:U}){const O=n,m=X(),I=Se(),{title:C=""}=O,R=ae(n,"modelValue"),N=oe(O,U,void 0,void 0,"group"),i=p($(N.value)),t=p("");(i.value.Users==null||i.value.Users.length==0)&&m.getGroupMembers(i.value.GroupUUID).then(e=>{e&&(i.value.Users=e)}).catch(()=>{i.value.Users=[]}),m.getGroupInvite(i.value.GroupUUID).then(e=>{if(e){const v=new URL(location.href);v.searchParams.set("token",e),t.value=v.toString()}}),H(N,()=>{i.value=$(N.value)});const _=()=>{window.isSecureContext&&navigator.clipboard&&navigator.clipboard.writeText(t.value)},c=p(!1),V=p(-1),b=p(""),T=()=>{V.value=-1,c.value=!1},Y=e=>{V.value=e,c.value=!0},u=({callback:e})=>{if(!i.value.Users){e&&(e("Failed to Remove User"),setTimeout(T,2e3));return}b.value="",V.value<0||V.value>=i.value.Users.length?(e&&e("Invalid Convention"),setTimeout(T,2e3)):m.removeUserFromGroup(i.value.Users[V.value].UserUUID,i.value.GroupUUID).then(v=>{var E;v?((E=i.value.Users)==null||E.splice(V.value,1),e&&e("User Removed")):e&&e("Failed to Remove User"),setTimeout(T,2e3)}).catch(()=>{e&&(e("Failed to Remove User"),setTimeout(T,2e3))})};return(e,v)=>(f(),x(ue,{modelValue:R.value,"onUpdate:modelValue":v[1]||(v[1]=E=>R.value=E),title:Z(C),color:"primary"},{default:o(()=>[l(ee,{class:"pa-0",fluid:!0},{default:o(()=>[i.value.Users&&i.value.Users.length?(f(),S(L,{key:0},[l(Ge,null,{default:o(()=>[(f(!0),S(L,null,se(i.value.Users,(E,W)=>(f(),x(be,{key:E.UserUUID},{append:o(()=>[l(y,{color:"red-darken-3",icon:"mdi:mdi-window-close",size:"x-small",onClick:F=>Y(W)},null,8,["onClick"])]),prepend:o(()=>[l(Me,{src:Z(I)(E.UserUUID),class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])]),default:o(()=>[l(he,null,{default:o(()=>[M(h(E.DisplayName)+" "+h(E.Handle?`(${E.Handle})`:""),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(Ce,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=E=>c.value=E),width:"auto"},{default:o(()=>[l(Ye,null,{default:o(()=>[l(Ae,null,{default:o(()=>[M(" Remove User from Group ")]),_:1}),l(ye,null,{default:o(()=>[M(" User will no longer have the permissions from this group. ")]),_:1}),l(ke,null,{default:o(()=>[l(le,null,{default:o(()=>[l(D,null,{default:o(()=>[je]),_:1})]),_:1})]),_:1}),l(Le,null,{default:o(()=>[l(y,{color:"primary",onClick:T},{default:o(()=>[M("Cancel")]),_:1}),l(ie),l(De,{color:"red-darken-3",label:"Remove User",onClick:u})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)):(f(),S("p",Fe," No members "))]),_:1})]),actions:o(()=>[l(y,{variant:"text"},{default:o(()=>[d("a",{href:t.value,onClick:Ne(_,["prevent"])},"Invite URL",8,Be)]),_:1})]),_:1},8,["modelValue","title"]))}}),qe=d("h1",{class:"text-center mt-5"},"Processing Invite...",-1),He={key:0,class:"text-center mt-5 text-red text-h5"},Ze=d("p",{class:"text-center mt-5"},"Please contact your admin and request a new one",-1),Je=d("thead",null,[d("tr",null,[d("th",null,"Name"),d("th",{class:"d-none d-md-table-cell"}," Owner "),d("th",null,"Permissions"),d("th")])],-1),Ke={class:"d-block d-md-none mt-2"},Qe=d("strong",null,"Owner",-1),Xe=d("br",null,null,-1),el=d("br",null,null,-1),ll={class:"d-none d-md-table-cell"},al=d("br",null,null,-1),tl=d("br",null,null,-1),ol=d("br",null,null,-1),Cl=J({__name:"GroupsView",emits:["pageTitle"],setup(n,{emit:U}){U("pageTitle","Manage Groups & Permissions");const O=X(),m=Pe(),I=Ve();(!m||!m.Groups.find(a=>a.Permission.ManageUsers))&&I.push("/");const C=p(!0),R=p(),N=p(),i=p([]),t=p([]),_=p([]),c=p(!1),V=p(!1),b=p(!1),T=p(""),u=new URL(location.href).searchParams.get("token")||"";u!==""&&(C.value=!1,O.validateGroupInviteToken(u).then(a=>{a&&(we(a),I.push("/dashboard"))}).catch(()=>{T.value="Invalid Token"})),H(R,()=>{W(N.value,R.value)}),H(N,()=>{W(N.value,R.value)});const e=a=>a.OwnerType===P.OWNER_TYPE_CONVENTION?i.value.filter(r=>r.ConventionUUID===a.OwnerUUID).map(r=>r.Name).join(""):a.OwnerType===P.OWNER_TYPE_ORGANISATION?_.value.filter(r=>r.OrganisationUUID===a.OwnerUUID).map(r=>r.Name).join(""):a.OwnerType===void 0||a.OwnerType===null?"System":"Unknown",v=a=>a.OwnerType===P.OWNER_TYPE_CONVENTION?"Convention":a.OwnerType===P.OWNER_TYPE_ORGANISATION?"Organisation":a.OwnerType===void 0||a.OwnerType===null?"Global":"Unknown",E=()=>{O.getPermissionAccessList(re.PERMISSION_TYPE_MANAGE_USERS).then(a=>{i.value=a.Conventions,_.value=a.Organisations}).catch(()=>{})},W=(a=A,r=A)=>{O.getManageableGroups(a||A,r||A).then(s=>{s&&(t.value=s)}).catch(()=>{})},F=()=>{const a={ID:0,GroupUUID:q(),Type:G.GROUP_TYPE_CONVENTION,Name:"",MinimumNumbers:0,Permission:{ID:0,PermissionUUID:q(),GroupID:0,GroupUUID:q(),EditConvention:!1,EditOrganisation:!1,EditRegistration:!1,ManageUsers:!1,ManageViews:!1,ViewRegistration:!1},Users:[],OwnerID:null,OwnerType:null,OwnerUUID:null};return a.Permission.GroupUUID=a.GroupUUID,a},K=p(F()),w=p(-1),g=p(F()),me=ne(()=>w.value===-1?"New Group":"Edit Group"),ve=()=>{K.value.GroupUUID=q(),g.value=Object.assign({},F()),w.value=-1,c.value=!0},pe=a=>{w.value=t.value.indexOf(a),g.value=Object.assign({},a),V.value=!0},Ue=a=>{w.value=t.value.indexOf(a),g.value=Object.assign({},a),c.value=!0},Ie=a=>{w.value=t.value.indexOf(a),g.value=Object.assign({},a),b.value=!0},Oe=()=>{O.deleteGroup(g.value.GroupUUID).then(a=>{a&&(t.value.splice(w.value,1),fe())})},_e=()=>{c.value=!1,te(()=>{g.value=Object.assign({},K.value),w.value=-1})},fe=()=>{b.value=!1,te(()=>{g.value=Object.assign({},K.value),w.value=-1})},ce=a=>{w.value>-1?Object.assign(t.value[w.value],a):t.value.push(a),_e()};return E(),W(N.value,R.value),(a,r)=>(f(),S("div",null,[C.value?(f(),S(L,{key:1},[l(xe,{color:"primary"},{default:o(()=>[l(Q,{label:"Organisation",modelValue:N.value,"onUpdate:modelValue":r[0]||(r[0]=s=>N.value=s),items:_.value,"item-value":"OrganisationUUID","item-title":"Name",clearable:!0,"hide-details":"",class:"mr-1"},null,8,["modelValue","items"]),l(Q,{label:"Convention",modelValue:R.value,"onUpdate:modelValue":r[1]||(r[1]=s=>R.value=s),items:i.value,"item-value":"ConventionUUID","item-title":"Name",clearable:!0,"hide-details":""},null,8,["modelValue","items"]),l(ie),l(y,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:ve},{default:o(()=>[M(" New Group ")]),_:1}),l(ge,{modelValue:b.value,"onUpdate:modelValue":r[2]||(r[2]=s=>b.value=s),onDelete:Oe},null,8,["modelValue"])]),_:1}),c.value?(f(),x($e,{key:0,modelValue:c.value,"onUpdate:modelValue":r[3]||(r[3]=s=>c.value=s),group:g.value,"onUpdate:group":r[4]||(r[4]=s=>g.value=s),onSave:ce,title:me.value,conventions:i.value,organisations:_.value},null,8,["modelValue","group","title","conventions","organisations"])):z("",!0),V.value?(f(),x(ze,{key:1,modelValue:V.value,"onUpdate:modelValue":r[5]||(r[5]=s=>V.value=s),group:g.value,"onUpdate:group":r[6]||(r[6]=s=>g.value=s),title:`${g.value.Name}`},null,8,["modelValue","group","title"])):z("",!0),l(We,null,{default:o(()=>[Je,d("tbody",null,[(f(!0),S(L,null,se(t.value,(s,Ee)=>(f(),S("tr",{key:s.GroupUUID,class:Te(Ee%2?"bg-grey-lighten-4":"")},[d("td",null,[M(h(s.Name)+" ",1),d("p",Ke,[Qe,Xe,M(" "+h(e(s)),1),el,d("small",null,"("+h(v(s))+")",1)])]),d("td",ll,[M(h(e(s)),1),al,d("small",null,"("+h(v(s))+")",1)]),d("td",null,[l(de,{modelValue:s.Permission,"onUpdate:modelValue":B=>s.Permission=B,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,[l(y,{icon:"mdi:mdi-account-group",size:"x-small",color:"success",class:"mb-1",onClick:B=>pe(s)},null,8,["onClick"]),tl,s.Type!==Z(G).GROUP_TYPE_SYSTEM?(f(),S(L,{key:0},[l(y,{icon:"mdi:mdi-pencil",size:"x-small",color:"primary",class:"mb-1",onClick:B=>Ue(s)},null,8,["onClick"]),ol,l(y,{icon:"mdi:mdi-delete",size:"x-small",color:"error",class:"mb-1",onClick:B=>Ie(s)},null,8,["onClick"])],64)):z("",!0)])],2))),128))])]),_:1})],64)):(f(),S(L,{key:0},[qe,T.value?(f(),S("p",He,h(T.value),1)):z("",!0),Ze],64))]))}});export{Cl as default};
