import{s as K}from"./index-2XRRB2DS.js";import{i as P,r as V,U as G,n as I,q as h,v as n,f as l,x as y,C as E,P as Y,M as w,N as j,c as _,w as ee,B as R,F as B,A,y as J,Q as ae,z as x,X as M}from"./index-idXT61L6.js";import{v as le}from"./v4-yQnnJER4.js";import{V as p,b as S,c as te}from"./VContainer-5QD4nWlt.js";import{a as F,V as q}from"./VToolbar--8syRB9h.js";import{V as Q}from"./scopeId-_w0WS083.js";import{V as X}from"./VToolbarItems-3ZOE0khD.js";import{V as ne,a as z}from"./VRow-9bL1mvUJ.js";import{V as L}from"./VTextField-Atz-Qday.js";import{c as H,e as Z}from"./VCard-QBOZSxYN.js";import{a as oe}from"./VList-qTlekeAH.js";import{V as ie}from"./VDivider-85tnVFH7.js";import{V as se}from"./VAutocomplete-mowwBt4P.js";import{V as ue}from"./VDialog-jDuBb5fS.js";import{s as W,a as re,m as de}from"./FormRenderer.vue_vue_type_style_index_0_lang-lQbSRniL.js";import{V as ve,a as me,b as fe,c as ce}from"./VDataTable-gFscD8tb.js";var v=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.TAG=2]="TAG",e[e.STRING=3]="STRING",e[e.UUID_ARRAY=4]="UUID_ARRAY",e))(v||{});const ge=P({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(e,{emit:b}){const u=V(""),i=V("");typeof e.convention=="object"?(u.value=e.convention.ConventionUUID,i.value=e.convention.OrganisationUUID):u.value=e.convention||"",typeof e.organisation=="object"?i.value=e.organisation.OrganisationUUID:i.value.length===0&&(i.value=e.organisation||"");const r=b,c=V({ID:0,TagUUID:le(),ConventionID:0,ConventionUUID:u.value||G,OrganisationID:0,OrganisationUUID:i.value||G,Title:"",Key:""}),g=Y(),U=()=>{g.saveTag(c.value).then(f=>{f&&(c.value=f,r("save",f),r("close"))})};return(f,d)=>(I(),h(Z,null,{default:n(()=>[l(q,{dark:"",color:"primary"},{default:n(()=>[l(p,{icon:"",dark:"",onClick:d[0]||(d[0]=a=>r("close"))},{default:n(()=>[l(S,null,{default:n(()=>[y("mdi:mdi-close")]),_:1})]),_:1}),l(F,null,{default:n(()=>[y("Add Tag")]),_:1}),l(Q),l(X,null,{default:n(()=>[l(p,{variant:"text",onClick:U},{default:n(()=>[y(" Save ")]),_:1})]),_:1})]),_:1}),l(H,null,{default:n(()=>[l(te,{fluid:!0},{default:n(()=>[l(ne,null,{default:n(()=>[l(z,{cols:"12"},{default:n(()=>[l(L,{label:E(K).formLabelDisplayName,type:"text",variant:"outlined",modelValue:c.value.Title,"onUpdate:modelValue":d[1]||(d[1]=a=>c.value.Title=a)},null,8,["label","modelValue"])]),_:1}),l(z,{cols:"12"},{default:n(()=>[l(L,{label:E(K).formLabelTagKey,type:"text",variant:"outlined",modelValue:c.value.Key,"onUpdate:modelValue":d[2]||(d[2]=a=>c.value.Key=a)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),$e=P({__name:"SelectTags",props:w({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{},showKey:{type:Boolean,default:!1},showUuid:{type:Boolean,default:!1},inputType:{default:()=>v.UNKNOWN}},{modelValue:{required:!0},modelModifiers:{}}),emits:w(["change"],["update:modelValue"]),setup(e,{emit:b}){const u=j(e,"modelValue"),i=b,r=V([]),c=Y(),g=V([]),U=V([]),f=V(""),d=V(""),a=V(v.UNKNOWN),D=_(()=>[...g.value,...U.value].map(s=>({title:`${s.Title}${e.showKey?` [ ${s.Key} ]`:""}${e.showUuid?` (${s.TagUUID})`:""}`,value:r.value.find(t=>t&&t.TagUUID&&t.TagUUID===s.TagUUID)||s})));typeof e.convention=="object"?(f.value=e.convention.ConventionUUID,d.value=e.convention.OrganisationUUID):f.value=e.convention||"",typeof e.organisation=="object"?d.value=e.organisation.OrganisationUUID:d.value.length===0&&(d.value=e.organisation||""),(async()=>{const o=[];f.value&&o.push(c.getConventionTags(f.value)),d.value&&o.push(c.getOrganisationTags(d.value));const s=await Promise.all(o);if(f.value&&d.value?(U.value=s[0].sort((t,m)=>t.Title.localeCompare(m.Title)),g.value=s[1].sort((t,m)=>t.Title.localeCompare(m.Title))):f.value&&s.length==1?U.value=s[0].sort((t,m)=>t.Title.localeCompare(m.Title)):d.value&&s.length==1&&(g.value=s[0].sort((t,m)=>t.Title.localeCompare(m.Title))),e.inputType===v.TAG||e.inputType===v.UNKNOWN&&Array.isArray(u.value))a.value=v.TAG,D.value.forEach(t=>{Array.isArray(u.value)&&u.value.find(N=>N.TagUUID===t.value.TagUUID)&&r.value.push(t.value)});else if(e.inputType===v.JSON||e.inputType===v.UNKNOWN&&typeof u.value=="string"){a.value=v.JSON;try{const t=JSON.parse(u.value);D.value.forEach(m=>{t.find(k=>k.TagUUID===m.value.TagUUID)&&r.value.push(m.value)})}catch{}}else if(e.inputType===v.UUID_ARRAY){a.value=v.UUID_ARRAY;try{const t=u.value,m=[...g.value,...U.value];r.value=t.map(N=>m.find(k=>k.TagUUID==N))}catch{}}else if(e.inputType===v.STRING){a.value=v.STRING;try{if(typeof u.value!="string")return;const t=JSON.parse(u.value),m=[...g.value,...U.value];r.value=t.map(N=>m.find(k=>k.TagUUID==N))}catch{}}})();const T=V(!1),O=()=>{T.value=!0},C=o=>{o.ConventionUUID.length>0?U.value.push(o):o.OrganisationUUID.length>0&&g.value.push(o),r.value.push(o),$()},$=()=>{switch(a.value){default:case v.TAG:{u.value=r.value,i("change");break}case v.JSON:{u.value=JSON.stringify(r.value),i("change");break}case v.STRING:{u.value=JSON.stringify(r.value.map(o=>o&&o.TagUUID?o.TagUUID:"")),i("change");break}case v.UUID_ARRAY:{u.value=r.value.map(o=>o&&o.TagUUID?o.TagUUID:""),i("change");break}}};return ee(r,$),(o,s)=>(I(),R(B,null,[l(se,{modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),chips:o.chips,multiple:"",label:o.label||"Tags",variant:o.variant||"solo",hint:o.hint,"persistent-hint":!0,clearable:o.clearable,items:D.value,"item-title":"title","item-value":"value"},{"prepend-item":n(()=>[l(oe,{title:"New Tag",onClick:s[0]||(s[0]=t=>O())},{prepend:n(()=>[l(S,{icon:"mdi:mdi-plus"})]),_:1}),l(ie,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),l(ue,{modelValue:T.value,"onUpdate:modelValue":s[3]||(s[3]=t=>T.value=t),scrollable:!0},{default:n(()=>[l(ge,{convention:o.convention,organisation:o.organisation,onClose:s[2]||(s[2]=t=>T.value=!1),onSave:C},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}}),Re=P({__name:"EditOrderedItems",props:w({closeable:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},hasOrder:{type:Boolean,default:!0},newItem:{type:[Function,Boolean]},label:{default:"Name"},labelParent:{default:""},title:{default:"Edit Ordered Items"},showSave:{type:Boolean,default:!1},slotNamePrefix:{default:"item"}},{modelValue:{required:!0},modelModifiers:{}}),emits:w(["add","save","close"],["update:modelValue"]),setup(e,{emit:b}){const u=b,i=j(e,"modelValue"),r=()=>{u("save"),u("close")},c=()=>{if(e.newItem){let a;e.hasOrder?(a=e.newItem(),a.Order=i.value.length+1):a=e.newItem(),i.value.push(a)}else e.hasOrder?i.value.push({ID:0,Order:i.value.length+1}):i.value.push({ID:0})},g=a=>{i.value.splice(a,1)},U=a=>{re(a,i.value)},f=a=>{de(a,i.value)},d=a=>e.labelParent&&a[e.labelParent]?a[e.labelParent][e.label]:a[e.label];return i.value.find(a=>a.Order===0)&&W(i.value),i.value.find(a=>i.value.find(D=>D.Order===a.Order&&D!==a))&&W(i.value),(a,D)=>(I(),h(Z,null,{default:n(()=>[l(q,{dark:"",color:"primary"},{default:n(()=>[a.closeable?(I(),h(p,{key:0,icon:"",dark:"",onClick:D[0]||(D[0]=T=>u("close"))},{default:n(()=>[l(S,null,{default:n(()=>[y("mdi:mdi-close")]),_:1})]),_:1})):A("",!0),l(F,null,{default:n(()=>[y(J(a.title),1)]),_:1}),l(Q),l(X,null,{default:n(()=>[a.newItem!==void 0?(I(),h(p,{key:0,variant:"text",onClick:c},{default:n(()=>[y(" Add ")]),_:1})):A("",!0),a.showSave?(I(),h(p,{key:1,variant:"text",onClick:r},{default:n(()=>[y(" Save ")]),_:1})):A("",!0)]),_:1})]),_:1}),l(H,{class:"pa-0"},{default:n(()=>[l(ve,null,{default:n(()=>[(I(!0),R(B,null,ae(i.value,(T,O)=>(I(),h(me,{key:T.ID,class:"mt-0"},{default:n(()=>[l(fe,null,{actions:n(({expanded:C})=>[a.showDelete?(I(),h(p,{key:0,icon:"mdi:mdi-close",size:"x-small",color:"red",class:"mr-1",onClick:$=>g(O)},null,8,["onClick"])):A("",!0),l(S,{class:"align-self-center text-h5",icon:C?"mdi:mdi-chevron-up":"mdi:mdi-chevron-down",variant:"flat",size:"x-small"},null,8,["icon"])]),default:n(()=>[a.hasOrder?(I(),R(B,{key:0},[l(p,{icon:"mdi:mdi-menu-up",size:"x-small",color:"primary",class:"mr-1",onClick:x(C=>f(T),["stop"])},null,8,["onClick"]),l(p,{icon:"mdi:mdi-menu-down",size:"x-small",color:"secondary",class:"mr-4",onClick:x(C=>U(T),["stop"])},null,8,["onClick"])],64)):A("",!0),M(a.$slots,`${a.slotNamePrefix}_${O}_title`,{},()=>[y(J(d(T)),1)])]),_:2},1024),l(ce,{class:"px-0"},{default:n(()=>[M(a.$slots,`${a.slotNamePrefix}_${O}`)]),_:2},1024)]),_:2},1024))),128))]),_:3})]),_:3})]),_:3}))}});export{v as I,$e as _,Re as a};
