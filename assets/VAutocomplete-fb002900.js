import{f as ge,g as ye,a as ke}from"./VSelect-f0602ef2.js";import{i as Fe,j as pe,V as Z,g as Ve}from"./VTextField-3b0954d6.js";import{i as we,u as Ce,V as Me}from"./rounded-5da1b7ec.js";import{p as ae,h as V,y as _,L as G,ah as Ie,ad as ue,am as be,a1 as Se,a as xe,a6 as Ae,s as B,x as J,k as q,c,F as z,m as N,e as Pe,as as De,z as ee}from"./index-0085e4e0.js";import{u as Ke,V as Le,a as le}from"./VList-b7d80e38.js";import{m as _e}from"./index-2624a541.js";import{a as te}from"./VBtn-1a4cf250.js";import{a as Re}from"./VChip-245ad5a6.js";const Te=(e,r,l)=>e==null||r==null?-1:e.toString().toLocaleLowerCase().indexOf(r.toString().toLocaleLowerCase()),Oe=ae({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Ee(e,r,l){var C;const F=[],y=(l==null?void 0:l.default)??Te,h=l!=null&&l.filterKeys?ue(l.filterKeys):!1,v=Object.keys((l==null?void 0:l.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return F;e:for(let M=0;M<e.length;M++){const f=e[M],o={},a={};let k=-1;if(r&&!(l!=null&&l.noFilter)){if(typeof f=="object"){const H=h||Object.keys(f);for(const A of H){const T=be(f,A,f),s=(C=l==null?void 0:l.customKeyFilter)==null?void 0:C[A];if(k=s?s(T,r,f):y(T,r,f),k!==-1&&k!==!1)s?o[A]=k:a[A]=k;else if((l==null?void 0:l.filterMode)==="every")continue e}}else k=y(f,r,f),k!==-1&&k!==!1&&(a.title=k);const I=Object.keys(a).length,S=Object.keys(o).length;if(!I&&!S||(l==null?void 0:l.filterMode)==="union"&&S!==v&&!I||(l==null?void 0:l.filterMode)==="intersection"&&(S!==v||!I))continue}F.push({index:M,matches:{...a,...o}})}return F}function je(e,r,l,F){const y=V(()=>typeof(l==null?void 0:l.value)!="string"&&typeof(l==null?void 0:l.value)!="number"?"":String(l.value)),h=_([]),v=_(new Map),C=V(()=>F!=null&&F.transform?G(r).map(F==null?void 0:F.transform):G(r));Ie(()=>{h.value=[],v.value=new Map;const f=Ee(C.value,y.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),o=G(r);f.forEach(a=>{let{index:k,matches:I}=a;const S=o[k];h.value.push(S),v.value.set(S.value,I)})});function M(f){return v.value.get(f.value)}return{filteredItems:h,filteredMatches:v,getMatches:M}}function Ue(e,r,l){if(r==null)return e;if(Array.isArray(r))throw new Error("Multiple matches is not implemented");return typeof r=="number"&&~r?c(z,null,[c("span",{class:"v-autocomplete__unmask"},[e.substr(0,r)]),c("span",{class:"v-autocomplete__mask"},[e.substr(r,l)]),c("span",{class:"v-autocomplete__unmask"},[e.substr(r+l)])]):e}const Be=ae({autoSelectFirst:{type:[Boolean,String]},search:String,...Oe({filterKeys:["title"]}),...ge(),...Se(Fe({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),..._e({transition:!1})},"VAutocomplete"),Xe=xe()({name:"VAutocomplete",props:Be(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,r){let{slots:l}=r;const{t:F}=Ae(),y=_(),h=B(!1),v=B(!0),C=_(!1),M=_(),f=J(e,"menu"),o=V({get:()=>f.value,set:t=>{var u;f.value&&!t&&((u=M.value)!=null&&u.Î¨openChildren)||(f.value=t)}}),a=B(-1),k=V(()=>{var t;return(t=y.value)==null?void 0:t.color}),{items:I,transformIn:S,transformOut:H}=Ke(e),{textColorClasses:A,textColorStyles:T}=we(k),s=J(e,"search",""),w=J(e,"modelValue",[],t=>S(ue(t)),t=>{const u=H(t);return e.multiple?u:u[0]??null}),P=pe(),{filteredItems:O,getMatches:ne}=je(e,I,V(()=>v.value?void 0:s.value)),b=V(()=>w.value.map(t=>I.value.find(u=>e.valueComparator(u.value,t.value))||t)),x=V(()=>e.hideSelected?O.value.filter(t=>!b.value.some(u=>u.value===t.value)):O.value),$=V(()=>b.value.map(t=>t.props.value)),W=V(()=>b.value[a.value]),E=V(()=>{var u;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&s.value===((u=x.value[0])==null?void 0:u.title))&&x.value.length>0&&!v.value&&!C.value}),Q=V(()=>e.hideNoData&&!I.value.length||e.readonly||(P==null?void 0:P.isReadonly.value)),X=_();function re(t){e.openOnClear&&(o.value=!0),s.value=""}function ce(){Q.value||(o.value=!0)}function oe(t){Q.value||(h.value&&(t.preventDefault(),t.stopPropagation()),o.value=!o.value)}function se(t){var K,n,g;if(e.readonly||P!=null&&P.isReadonly.value)return;const u=y.value.selectionStart,d=$.value.length;if((a.value>-1||["Enter","ArrowDown","ArrowUp"].includes(t.key))&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(o.value=!0),["Escape"].includes(t.key)&&(o.value=!1),["Enter","Escape","Tab"].includes(t.key)&&(E.value&&["Enter","Tab"].includes(t.key)&&D(O.value[0]),v.value=!0),t.key==="ArrowDown"&&E.value&&((K=X.value)==null||K.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(t.key)){if(a.value<0){t.key==="Backspace"&&!s.value&&(a.value=d-1);return}const i=a.value;W.value&&D(W.value),a.value=i>=d-1?d-2:i}if(t.key==="ArrowLeft"){if(a.value<0&&u>0)return;const i=a.value>-1?a.value-1:d-1;b.value[i]?a.value=i:(a.value=-1,y.value.setSelectionRange((n=s.value)==null?void 0:n.length,(g=s.value)==null?void 0:g.length))}if(t.key==="ArrowRight"){if(a.value<0)return;const i=a.value+1;b.value[i]?a.value=i:(a.value=-1,y.value.setSelectionRange(0,0))}}}function ie(t){var u;t.key==="Tab"&&((u=y.value)==null||u.focus())}function ve(t){s.value=t.target.value}function fe(){var t;h.value&&(v.value=!0,(t=y.value)==null||t.focus())}function de(t){h.value=!0,setTimeout(()=>{C.value=!0})}function me(t){C.value=!1}function he(t){(t==null||t===""&&!e.multiple)&&(w.value=[])}const R=B(!1);function D(t){if(e.multiple){const u=$.value.findIndex(d=>e.valueComparator(d,t.value));if(u===-1)w.value=[...w.value,t];else{const d=[...w.value];d.splice(u,1),w.value=d}}else w.value=[t],R.value=!0,s.value=t.title,o.value=!1,v.value=!0,ee(()=>R.value=!1)}return q(h,(t,u)=>{var d;t!==u&&(t?(R.value=!0,s.value=e.multiple?"":String(((d=b.value.at(-1))==null?void 0:d.props.title)??""),v.value=!0,ee(()=>R.value=!1)):(!e.multiple&&!s.value?w.value=[]:E.value&&!C.value&&!b.value.some(K=>{let{value:n}=K;return n===x.value[0].value})&&D(x.value[0]),o.value=!1,s.value="",a.value=-1))}),q(s,t=>{!h.value||R.value||(t&&(o.value=!0),v.value=!t)}),Ce(()=>{const t=!!(e.chips||l.chip),u=!!(!e.hideNoData||x.value.length||l["prepend-item"]||l["append-item"]||l["no-data"]),d=w.value.length>0,[K]=Z.filterProps(e);return c(Z,N({ref:y},K,{modelValue:s.value,"onUpdate:modelValue":he,focused:h.value,"onUpdate:focused":n=>h.value=n,validationValue:w.externalValue,dirty:d,onInput:ve,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":o.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!l.selection,"v-autocomplete--selecting-index":a.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:d?void 0:e.placeholder,"onClick:clear":re,"onMousedown:control":ce,onKeydown:se}),{...l,default:()=>c(z,null,[c(ye,N({ref:M,modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,activator:"parent",contentClass:"v-autocomplete__content",disabled:Q.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:fe},e.menuProps),{default:()=>[u&&c(Le,{ref:X,selected:$.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:ie,onFocusin:de,onFocusout:me,tabindex:"-1"},{default:()=>{var n,g,i;return[(n=l["prepend-item"])==null?void 0:n.call(l),!x.value.length&&!e.hideNoData&&(((g=l["no-data"])==null?void 0:g.call(l))??c(le,{title:F(e.noDataText)},null)),x.value.map((m,L)=>{var Y;const p=N(m.props,{key:L,active:E.value&&L===0?!0:void 0,onClick:()=>D(m)});return((Y=l.item)==null?void 0:Y.call(l,{item:m,index:L,props:p}))??c(le,p,{prepend:j=>{let{isSelected:U}=j;return c(z,null,[e.multiple&&!e.hideSelected?c(ke,{key:m.value,modelValue:U,ripple:!1,tabindex:"-1"},null):void 0,m.props.prependIcon&&c(te,{icon:m.props.prependIcon},null)])},title:()=>{var j,U;return v.value?m.title:Ue(m.title,(j=ne(m))==null?void 0:j.title,((U=s.value)==null?void 0:U.length)??0)}})}),(i=l["append-item"])==null?void 0:i.call(l)]}})]}),b.value.map((n,g)=>{var L;function i(p){p.stopPropagation(),p.preventDefault(),D(n)}const m={"onClick:close":i,onMousedown(p){p.preventDefault(),p.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0};return c("div",{key:n.value,class:["v-autocomplete__selection",g===a.value&&["v-autocomplete__selection--selected",A.value]],style:g===a.value?T.value:{}},[t?l.chip?c(Me,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>{var p;return[(p=l.chip)==null?void 0:p.call(l,{item:n,index:g,props:m})]}}):c(Re,N({key:"chip",closable:e.closableChips,size:"small",text:n.title},m),null):((L=l.selection)==null?void 0:L.call(l,{item:n,index:g}))??c("span",{class:"v-autocomplete__selection-text"},[n.title,e.multiple&&g<b.value.length-1&&c("span",{class:"v-autocomplete__selection-comma"},[Pe(",")])])])})]),"append-inner":function(){var m;for(var n=arguments.length,g=new Array(n),i=0;i<n;i++)g[i]=arguments[i];return c(z,null,[(m=l["append-inner"])==null?void 0:m.call(l,...g),e.menuIcon?c(te,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:oe,onClick:De},null):void 0])}})}),Ve({isFocused:h,isPristine:v,menu:o,search:s,filteredItems:O,select:D},y)}});export{Xe as V,Oe as m,je as u};
