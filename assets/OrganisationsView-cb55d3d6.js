import{d as R,Y as G,Z as N,y as v,S as Q,o as h,b as S,w as a,N as P,c as e,e as r,G as x,M as C,U as ee,V as ae,f as b,_ as E,D as te,r as le,O as A,F as M,X as oe,P as ne}from"./index-03084228.js";import{s as y}from"./index-71069b21.js";import{u as ie}from"./useGrazeAPI-d28dcd3a.js";import{_ as se}from"./SaveButton.vue_vue_type_script_setup_true_lang-3cee039b.js";import{V as k}from"./VForm-ccd929e7.js";import{b as re,V as ue}from"./VToolbar-77250284.js";import{V as I,a as de}from"./VBtn-46db6200.js";import{V as me}from"./VSpacer-0635af43.js";import{V as fe}from"./VToolbarItems-692a95f4.js";import{c as F,e as T,V as q,a as B,d as z}from"./VCard-36beeeb2.js";import{V as Y}from"./VContainer-dd248707.js";import{a as c,V as f}from"./VRow-fadaa17e.js";import{V as j}from"./VImg-7fc4ecca.js";import{V as L}from"./VTextField-af5784b0.js";import{V as ge}from"./VFileInput-1eb87830.js";import{V as K}from"./VDialog-d33c3a6d.js";import{G as pe}from"./userData-887aea4a.js";import{v as ve}from"./v4-a960c1f4.js";import"./rounded-7666c9d2.js";import"./scopeId-68f0792b.js";import"./index-55725bbd.js";import"./index-6ad385cd.js";import"./createSimpleFunctional-a4504c97.js";import"./VAvatar-088a953f.js";import"./VChip-61dc7e7f.js";const $=_=>(ee("data-v-0ea56c93"),_=_(),ae(),_),ce=$(()=>b("p",{class:"mb-2"}," Are you sure you wish to delete this organisation? All data relating to it will be removed including all conventions their respective registrations and payment information. This action can not be undone. ",-1)),_e=$(()=>b("p",{class:"mb-2"}," We are talking some Thanos level shit right here, if you proceed a team of super-powered beings with Daddy issues will hunt you down through time, space and twitter. ",-1)),Ve=$(()=>b("p",null,' To confirm type "I CLICK MY FINGERS" in the box below. ',-1)),Ie=R({__name:"EditOrganisation",props:{modelValue:{required:!0}},emits:G(["change","close","delete"],["update:modelValue"]),setup(_,{emit:V}){const u=ie(),l=P(),O=N(_,"modelValue"),o=v(Q(O.value)),D=v(`${l.GetOrganisationLogoURL(o.value.OrganisationUUID)}?${new Date().getTime()}`),d=v(),n=v(),i=v(!1),g=v(""),m=v(),Z=async()=>{var s;const t=new FormData((s=n.value)==null?void 0:s.$el);if(t.get("Image")&&t.get("Image").size>0)return t.set("OrganisationUUID",o.value.OrganisationUUID),await l.SaveOrganisationLogo(t)},W=()=>{var t;Z(),(t=m.value)==null||t.validate().then(s=>{s&&u.saveOrganisation(o.value).then(p=>{p&&(O.value=p,V("change"),V("close"))})})},U=v({available:t=>!0,min:t=>t.length>=4||"Minimum 4 characters",required:t=>!!t||"Required.",valid:t=>!/[^0-9a-z_-]/.test(t)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),w=()=>{i.value=!1},X=()=>{i.value=!0},H=({callback:t})=>{g.value="",u.deleteOrganisation(o.value.OrganisationUUID).then(s=>{s?t&&t("Organisation Deleted"):t&&t("Failed to Delete Organisation"),setTimeout(()=>{w(),V("delete")},2e3)}).catch(()=>{t&&(t("Failed to Delete Organisation"),setTimeout(w,2e3))})},J=()=>{D.value=URL.createObjectURL(d.value.files[0])};return(t,s)=>(h(),S(k,{"fast-fail":"",ref_key:"form",ref:m},{default:a(()=>[e(T,null,{default:a(()=>[e(re,{dark:"",color:"primary"},{default:a(()=>[e(I,{icon:"",dark:"",onClick:s[0]||(s[0]=p=>V("close"))},{default:a(()=>[e(de,null,{default:a(()=>[r("mdi:mdi-close")]),_:1})]),_:1}),e(ue,null,{default:a(()=>[r(x(o.value.Name),1)]),_:1}),e(me),e(fe,null,{default:a(()=>[e(I,{variant:"text",onClick:X},{default:a(()=>[r(" Delete ")]),_:1}),e(I,{variant:"text",onClick:W},{default:a(()=>[r(" Save ")]),_:1})]),_:1})]),_:1}),e(F,null,{default:a(()=>[e(Y,{fluid:!0},{default:a(()=>[e(c,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(j,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(L,{label:C(y).formLabelName,type:"text",variant:"outlined",modelValue:o.value.Name,"onUpdate:modelValue":s[1]||(s[1]=p=>o.value.Name=p)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(L,{label:C(y).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[U.value.available,U.value.min,U.value.required,U.value.valid],type:"text",variant:"outlined",modelValue:o.value.Slug,"onUpdate:modelValue":s[2]||(s[2]=p=>o.value.Slug=p)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(f,null,{default:a(()=>[e(k,{ref_key:"organisationImageForm",ref:n,enctype:"multipart/form-data"},{default:a(()=>[e(ge,{label:C(y).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:d,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:J},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(K,{modelValue:i.value,"onUpdate:modelValue":s[4]||(s[4]=p=>i.value=p),width:"auto"},{default:a(()=>[e(T,null,{default:a(()=>[e(q,null,{default:a(()=>[r(" Delete Organisation ")]),_:1}),e(B,null,{default:a(()=>[r(" Your will be done ")]),_:1}),e(F,null,{default:a(()=>[e(c,null,{default:a(()=>[e(f,null,{default:a(()=>[ce,_e,Ve]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(f,null,{default:a(()=>[e(L,{modelValue:g.value,"onUpdate:modelValue":s[3]||(s[3]=p=>g.value=p),variant:"outlined",placeholder:"Enter text here",label:"Confirmation"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(z,null,{default:a(()=>[e(se,{color:"red-darken-3",label:"Delete",enabled:g.value=="I CLICK MY FINGERS",onClick:H},null,8,["enabled"]),e(I,{color:"primary",onClick:w},{default:a(()=>[r("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},512))}});const Oe=E(Ie,[["__scopeId","data-v-0ea56c93"]]),De=R({__name:"Organisation",props:{modelValue:{required:!0}},emits:G(["delete"],["update:modelValue"]),setup(_,{emit:V}){const u=pe();(!u||!u.Groups.find(n=>n.Permission.EditConvention)&&!u.Groups.find(n=>n.Permission.EditOrganisation)&&!u.Groups.find(n=>n.Permission.EditRegistration)&&!u.Groups.find(n=>n.Permission.ManageViews)&&!u.Groups.find(n=>n.Permission.ViewRegistration))&&te().push("/");const l=N(_,"modelValue"),O=P(),o=v(!1),D=v(""),d=()=>{D.value=`${O.GetOrganisationLogoURL(l.value.OrganisationUUID)}?${new Date().getTime()}`};return d(),(n,i)=>{const g=le("RouterLink");return h(),A(M,null,[e(T,null,{default:a(()=>[e(j,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"]),e(q,null,{default:a(()=>[r(x(l.value.Name),1)]),_:1}),e(B,null,{default:a(()=>[r(x(l.value.Slug),1)]),_:1}),e(z,null,{default:a(()=>[e(c,{"no-gutters":""},{default:a(()=>[e(f,{class:"ma-1"},{default:a(()=>[e(I,{variant:"tonal",color:"primary",onClick:i[0]||(i[0]=m=>o.value=!0),width:"100%"},{default:a(()=>[r("Edit")]),_:1})]),_:1}),e(f,{class:"ma-1"},{default:a(()=>[e(g,{to:`/dashboard/admin/${l.value.Slug?l.value.Slug:l.value.OrganisationUUID}/groups`},{default:a(()=>[e(I,{variant:"tonal",color:"red",width:"100%"},{default:a(()=>[r("Group Manager")]),_:1})]),_:1},8,["to"])]),_:1}),e(f,{class:"ma-1"},{default:a(()=>[e(g,{to:`/dashboard/admin/${l.value.Slug?l.value.Slug:l.value.OrganisationUUID}/conventions`},{default:a(()=>[e(I,{variant:"tonal",color:"green",width:"100%"},{default:a(()=>[r("Convention Manager")]),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})]),_:1}),e(K,{modelValue:o.value,"onUpdate:modelValue":i[4]||(i[4]=m=>o.value=m),scrollable:!0},{default:a(()=>[e(Oe,{onClose:i[1]||(i[1]=m=>o.value=!1),modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=m=>l.value=m),onDelete:i[3]||(i[3]=m=>{o.value=!1,V("delete")}),onChange:d},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}});const he=E(De,[["__scopeId","data-v-05fdac45"]]),Ue=b("h3",null,"Organisations",-1),We=R({__name:"OrganisationsView",emits:["pageTitle"],setup(_,{emit:V}){const u=oe.getInstance(),l=v([]);V("pageTitle","Organisations");const O=()=>{const d={ID:0,OrganisationUUID:ve(),Name:"New Organisation",Slug:"",Logo:""};u.saveOrganisation(d).then(n=>{n&&l.value.push(n)})},o=d=>{l.value.splice(d,1)};return(()=>{u.getOrganisations().then(d=>{l.value=d})})(),(d,n)=>(h(),S(Y,null,{default:a(()=>[e(c,null,{default:a(()=>[e(f,null,{default:a(()=>[Ue]),_:1}),e(f,{class:"text-right"},{default:a(()=>[e(I,{color:"primary",onClick:O},{default:a(()=>[r("New")]),_:1})]),_:1})]),_:1}),e(c,null,{default:a(()=>[(h(!0),A(M,null,ne(l.value,(i,g)=>(h(),S(f,{key:i.ID,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[e(he,{modelValue:l.value[g],"onUpdate:modelValue":m=>l.value[g]=m,onDelete:m=>o(g)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024))),128))]),_:1})]),_:1}))}});export{We as default};
