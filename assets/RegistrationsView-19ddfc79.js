import{p as kt,n as Nt,e as ue,t as ge,c as Lt,G as Ft,v as t,H as N,x as je,I as se,a0 as Ee,a1 as Ge,r as T,K as ve,M as s,N as Y,O as o,a3 as fe,W as x,a2 as ze,a4 as Z,S as q,w as oe,X as h,Q as k,V as I,P as G,_ as Ye,ac as Pt,ad as wt,E as at,k as $t,f as Bt,d as Gt,o as Yt,ae as ot,Y as vt,Z as _t,a7 as Ht,a6 as xt}from"./index-63765b44.js";import{e as qt,T as jt,d as Qt,V as Kt,c as zt}from"./FormRenderer.vue_vue_type_style_index_0_lang-a0690671.js";import{a as Wt,F as Ae}from"./form-29fd1dbb.js";import{_ as He}from"./ModelDialog.vue_vue_type_script_setup_true_lang-743c2772.js";import{m as Jt,k as Xt,l as Zt,n as ea,o as ta,p as aa,q as oa,u as na,r as la,s as ia,t as sa,v as ra,w as ua,x as da,y as ma,z as nt,A as lt,B as it,a as ca,_ as va,f as st,c as Ut,d as At,e as Tt,b as Et,V as ft,g as _a,h as Ua,i as Aa,j as Ta}from"./VWindowItem-5aaaddde.js";import{V as ee,a as P}from"./VRow-e5dc054c.js";import{V as Te}from"./VTextField-23d4f15f.js";import{V as le}from"./copyToClipboard-5e57e93d.js";import{u as Ea,j as Ce,V as fa}from"./VContainer-9eab6a52.js";import{V as Sa,u as Je}from"./VCheckbox-ec47da7a.js";import{v as Me}from"./v4-a960c1f4.js";import{h as $e,b as Da,a as pa,c as Ia,d as Ra,P as St,u as Dt}from"./useDisplayTransactions-b3bfab84.js";import{V as Be,a as Le}from"./VList-e9def77e.js";import{V as ie}from"./VBtn-361b0e3d.js";import{b as ya,c as pt,d as rt}from"./submission-6136b51d.js";import{V as ga}from"./forwardRefs-d230e625.js";import{V as Oa}from"./VAvatar-efadbd86.js";import{V as It,a as Ca}from"./VToolbar-50805439.js";import{V as Xe,a as ha}from"./scopeId-f38b705c.js";import{c as Ma,e as Rt,V as ba}from"./VCard-2f8e4219.js";import{V as Va}from"./VDialog-a9558fe2.js";import{s as ka}from"./sortSubmissions-8ed80f07.js";import{_ as We}from"./SaveButton.vue_vue_type_script_setup_true_lang-f6a61723.js";import{u as Qe}from"./nil-d01db1aa.js";import{V as ut,a as Na}from"./VTable-48a413e7.js";import"./index-26b71cef.js";import"./VTextarea-cfeb7e81.js";import"./VChip-eda1a0b7.js";import"./userData-793a146d.js";import"./VForm-4530f5af.js";import"./VToolbarItems-0a53a41e.js";import"./VDivider-c6d9d212.js";import"./createSimpleFunctional-dca28f50.js";var yt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(yt||{});const La=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Fe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Fe||{});const Fa=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const Pa=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var X=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(X||{});const wa=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],$a=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},Ba=kt({itemsLength:{type:[Number,String],required:!0},...Jt(),...Xt(),...Zt()},"VDataTableServer"),Ga=Nt()({name:"VDataTableServer",props:Ba(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,p)=>!0},setup(e,p){let{emit:r,slots:l}=p;const{groupBy:n}=ea(e),{sortBy:u,multiSort:c,mustSort:d}=ta(e),{page:E,itemsPerPage:f}=aa(e),v=ue(()=>parseInt(e.itemsLength,10)),{columns:a,headers:i}=oa(e,{groupBy:n,showSelect:ge(e,"showSelect"),showExpand:ge(e,"showExpand")}),{items:_}=na(e,a),{toggleSort:U}=la({sortBy:u,multiSort:c,mustSort:d,page:E}),{opened:K,isGroupOpen:D,toggleGroup:y,extractRows:S}=ia({groupBy:n,sortBy:u}),{pageCount:C,setItemsPerPage:j}=sa({page:E,itemsPerPage:f,itemsLength:v}),{flatItems:ne}=ra(_,n,K),{isSelected:Se,select:De,selectAll:M,toggleSelect:b,someSelected:L,allSelected:g}=ua(e,{allItems:_,currentPage:_}),{isExpanded:$,toggleExpand:W}=da(e),te=ue(()=>S(_.value));ma({page:E,itemsPerPage:f,sortBy:u,groupBy:n,search:ge(e,"search")}),Lt("v-data-table",{toggleSort:U,sortBy:u}),Ft({VDataTableRows:{hideNoData:ge(e,"hideNoData"),noDataText:ge(e,"noDataText"),loading:ge(e,"loading"),loadingText:ge(e,"loadingText")}});const z=ue(()=>({page:E.value,itemsPerPage:f.value,sortBy:u.value,pageCount:C.value,toggleSort:U,setItemsPerPage:j,someSelected:L.value,allSelected:g.value,isSelected:Se,select:De,selectAll:M,toggleSelect:b,isExpanded:$,toggleExpand:W,isGroupOpen:D,toggleGroup:y,items:te.value,groupedItems:ne.value,columns:a.value,headers:i.value}));Ea(()=>{const[de]=nt.filterProps(e),[re]=lt.filterProps(e),[pe]=it.filterProps(e),[Ie]=ut.filterProps(e);return t(ut,je({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Ie),{top:()=>{var Re;return(Re=l.top)==null?void 0:Re.call(l,z.value)},default:()=>{var Re,be,Pe,Ve;return l.default?l.default(z.value):t(N,null,[(Re=l.colgroup)==null?void 0:Re.call(l,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(lt,je(re,{sticky:e.fixedHeader}),l)]),(be=l.thead)==null?void 0:be.call(l,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(z.value):t(it,je(pe,{items:ne.value}),l)]),(Pe=l.tbody)==null?void 0:Pe.call(l,z.value),(Ve=l.tfoot)==null?void 0:Ve.call(l,z.value)])},bottom:()=>l.bottom?l.bottom(z.value):t(nt,de,{prepend:l["footer.prepend"]})})})}}),Ya=se({__name:"EditAdminLayout",props:Ee({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["save"],["update:modelValue"]),setup(e,{emit:p}){const r=Ge(e,"modelValue"),l=T(ve(e.layout)),n=T([]),u=fe(),c=({callback:v})=>{const a=()=>{v&&v("Failed to Save Layout")},i=()=>{v&&v("Layout Saved")};u.saveAdminLayout(l.value).then(_=>{_?(i(),p("save",_)):a()}).catch(()=>{a()})},d=()=>({ID:0,LayoutPanelUUID:Me(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:Ae.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),E=v=>()=>({ID:0,LayoutItemUUID:Me(),LayoutPanelID:v.ID,LayoutPanelUUID:v.LayoutPanelUUID,Label:"",SourceType:Fe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:v.Items.length+1,DefaultSort:!1}),f=v=>{const a=n.value.find(i=>i.value===v.SectionFieldUUID);a&&(v.SectionFieldID=a.object.ID,v.SectionField=a.object)};return u.getConventionForms(e.layout.ConventionUUID).then(v=>{v.forEach(a=>a.Sections.forEach(i=>i.Fields&&n.value.push(...i.Fields.map(_=>{var K;return{title:`${a.Name} - ${i.Name} - ${(K=_.Field)==null?void 0:K.Name}`,value:_.SectionFieldUUID,object:_}})))),n.value.sort(qt("title"))}),(v,a)=>(s(),Y(He,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=i=>r.value=i),onSave:c,title:v.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:l.value.Name,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.Name=i),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(le,{modelValue:l.value.Type,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.Type=i),label:"Layout Type",items:x(La),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(st,{modelValue:l.value.Panels,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.Panels=i),"new-item":d,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ze({_:2},[Z(l.value.Panels,(i,_)=>({name:`panel_${_}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:i.Name,"onUpdate:modelValue":U=>i.Name=U,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(le,{modelValue:i.RequiredFormType,"onUpdate:modelValue":U=>i.RequiredFormType=U,items:x(Wt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(ca,{label:"Required Groups",variant:"outlined",modelValue:i.RequiredGroupMemberships,"onUpdate:modelValue":U=>i.RequiredGroupMemberships=U,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(va,{label:"Registration Tags",variant:"outlined",modelValue:i.RequiredRegistrationTags,"onUpdate:modelValue":U=>i.RequiredRegistrationTags=U,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(st,{modelValue:i.Items,"onUpdate:modelValue":U=>i.Items=U,"new-item":E(i),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ze({_:2},[Z(i.Items,(U,K)=>({name:`item_${K}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:U.Label,"onUpdate:modelValue":D=>U.Label=D,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(le,{modelValue:U.SourceType,"onUpdate:modelValue":D=>U.SourceType=D,label:"Source Type",items:x(Fa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(P,{cols:"12",sm:"6"},{default:o(()=>[U.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(s(),Y(le,{key:0,modelValue:U.SectionFieldUUID,"onUpdate:modelValue":D=>U.SectionFieldUUID=D,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:D=>f(U)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):U.SourceType==="LAYOUT_ITEM_SOURCE_META"?(s(),Y(le,{key:1,modelValue:U.MetaField,"onUpdate:modelValue":D=>U.MetaField=D,label:"Miscellaneous Data",items:x(Pa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):U.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(s(),Y(le,{key:2,modelValue:U.UserField,"onUpdate:modelValue":D=>U.UserField=D,label:"User Profile Data",items:x(wa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):q("",!0)]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(Sa,{modelValue:U.DefaultSort,"onUpdate:modelValue":D=>U.DefaultSort=D,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ha=h("br",null,null,-1),xa=h("h3",null,"Assigned Accommodation",-1),qa=h("br",null,null,-1),ja=h("br",null,null,-1),Qa=h("h3",null,"Accommodation Preferences",-1),Ka=h("h3",null,"Selected Tickets",-1),za=h("br",null,null,-1),Wa=se({__name:"EditAccommodationAssignmentDialog",props:Ee({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:field"],["update:modelValue"]),setup(e,{emit:p}){const r=e,{convention:l,registration:n,title:u=""}=r,c=fe(),d=Ge(e,"modelValue"),E=T({capacity:{max:M=>{var g;const b=C.value.find($=>$.room.RoomUUID===M);return!b||b.room.MaximumCapacity===0?!0:(((g=i.value)==null?void 0:g.Members.length)||0)<=b.room.MaximumCapacity||"Too many people in the group for this room"},min:M=>{var g;const b=C.value.find($=>$.room.RoomUUID===M);return!b||b.room.MinimumCapacity===0?!0:(((g=i.value)==null?void 0:g.Members.length)||0)>=b.room.MinimumCapacity||"Not enough people in the group for this room"}}}),f=T([]),v=Je(r,p,void 0,void 0,"field"),a=T(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const i=T(),_=T(""),U=T(""),K=T([]),D=T({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),y=async()=>{var g;const M=await c.getConventionAvailableAccommodation(l.ConventionUUID);M&&(f.value=M);const b=await c.getRegistrationGroup(n.RegistrationUUID||"");b&&(i.value=b);const L=await c.getConventionTickets(l.ConventionUUID);L&&(K.value=L);try{D.value=JSON.parse(((g=i.value)==null?void 0:g.TicketData)||"")}catch{}};oe(_,()=>{U.value=C.value.length>0?C.value[0].value:""});const S=ue(()=>{const M=j.value;return f.value.map(b=>{let L;return M.forEach(g=>{b.Costs.forEach($=>{$.DateStart===(g==null?void 0:g.DateStart)&&$.DateEnd===g.DateEnd&&(L===void 0||L>$.Availability)&&(L=$.Availability)})}),{label:`${b.Name}`,title:`${b.Name} (${L} Available)`,value:b.AccommodationUUID}})}),C=ue(()=>{const M=j.value,b=f.value.find(L=>L.AccommodationUUID===_.value);return(b==null?void 0:b.Pool.map(L=>{var $,W;let g;return M.forEach(te=>{L.Costs.forEach(z=>{z.DateStart===(te==null?void 0:te.DateStart)&&z.DateEnd===te.DateEnd&&(g===void 0||g>z.Availability)&&(g=z.Availability)})}),{label:`${($=L.Venue)==null?void 0:$.Name} - ${L.Name}`,title:`${(W=L.Venue)==null?void 0:W.Name} - ${L.Name} (${g} Available)`,value:L.RoomUUID,room:L}}))||[]}),j=ue(()=>[...D.value.Ticket,...D.value.AddonsChecked,...D.value.ComponentsChecked].map(M=>K.value.find(b=>b.TicketUUID===M)).filter(M=>M!==void 0&&M.RequiresAccommodation)),ne=M=>{var b;c.assignAccommodation(((b=i.value)==null?void 0:b.Registration.RegistrationUUID)||"",_.value,U.value,!1).then(L=>{L?(y(),M&&M("Room Assigned")):M&&M("Room not assigned")}).catch(()=>{M&&M("Room not assigned")})},Se=M=>{var b,L;(b=i.value)!=null&&b.Registration.AllocationUUID?c.deleteAllocation(((L=i.value)==null?void 0:L.Registration.AllocationUUID)||"").then(g=>{g?(y(),M&&M("Allocation Deleted")):M&&M("Allocation not deleted")}).catch(()=>{M&&M("Allocation not deleted")}):M&&M("Nothing to Delete")},De=M=>{var L,g;const b=(L=f.value.find($=>$.AccommodationUUID===M.AccommodationUUID))==null?void 0:L.Pool;if(b){const $=b.find(W=>W.RoomUUID===M.RoomUUID);if($)return`${(g=$.Venue)==null?void 0:g.Name} - ${$.Name}`}return""};return y(),(M,b)=>{var L;return s(),Y(He,{modelValue:d.value,"onUpdate:modelValue":b[2]||(b[2]=g=>d.value=g),title:x(u),color:"primary","show-close-action":!0,"show-delete-action":!!((L=i.value)!=null&&L.Registration.Allocation),"show-save-action":!!U.value,"save-button-label":"Assign Room",onDelete:Se,onSave:ne,fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"pa-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>{var g;return[t(P,{cols:"12",md:"6"},{default:o(()=>{var $,W;return[h("h3",null,"Group Members ("+k(($=i.value)==null?void 0:$.Members.length)+")",1),(s(!0),I(N,null,Z((W=i.value)==null?void 0:W.Members,te=>(s(),I(N,{key:te.UUID},[G(" #"+k(te.Reference)+" "+k(te.Name),1),Ha],64))),128))]}),_:1}),(g=i.value)!=null&&g.Registration.Allocation?(s(),Y(P,{key:0,cols:"12",md:"6"},{default:o(()=>[xa,t(Be,null,{default:o(()=>{var $;return[(s(!0),I(N,null,Z(($=i.value)==null?void 0:$.Registration.Allocation.Periods,W=>(s(),Y(Le,{key:W.AllocationPeriodUUID},{default:o(()=>{var te;return[G(k((te=f.value.find(z=>z.AccommodationUUID===W.AccommodationUUID))==null?void 0:te.Name)+" ",1),qa,G(" "+k(De(W))+" ",1),ja,h("small",null,"("+k(x($e)(W.DateStart))+" - "+k(x($e)(W.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):q("",!0)]}),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",md:"6"},{default:o(()=>[M.selectedAccommodation.length?(s(),I(N,{key:0},[Qa,t(Be,null,{default:o(()=>[(s(!0),I(N,null,Z(M.selectedAccommodation,(g,$)=>(s(),Y(Le,{key:g.AccommodationUUID},{default:o(()=>[G(k($+1)+". "+k(g.Name),1)]),_:2},1024))),128))]),_:1})],64)):q("",!0)]),_:1}),t(P,{cosl:"12",md:"6"},{default:o(()=>[Ka,t(Be,null,{default:o(()=>[(s(!0),I(N,null,Z(j.value,g=>(s(),Y(Le,{key:g==null?void 0:g.TicketUUID},{default:o(()=>[G(k(g.Name)+" ",1),za,h("small",null,"("+k(x($e)(g.DateStart))+" - "+k(x($e)(g.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",md:"6"},{default:o(()=>[t(le,{modelValue:_.value,"onUpdate:modelValue":b[0]||(b[0]=g=>_.value=g),items:S.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(P,{cols:"12",md:"6"},{default:o(()=>[t(le,{modelValue:U.value,"onUpdate:modelValue":b[1]||(b[1]=g=>U.value=g),items:C.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[E.value.capacity.min,E.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Ja={key:0,class:"accommodationList"},Xa={key:0,class:"text-orange-darken-2"},Za=se({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const p=T(!1),r=ue(()=>{if(!e.value)return[];const n=JSON.parse(e.value),u=e.accommodations.filter(c=>n.includes(c.AccommodationUUID)).sort((c,d)=>{const E=n.findIndex(v=>v===c.AccommodationUUID),f=n.findIndex(v=>v===d.AccommodationUUID);return E>f?1:-1});return ve(u)}),l=ue(()=>{let n;const u=e.forms.find(c=>c.Sections.find(d=>{var E;return(E=d.Fields)==null?void 0:E.find(f=>{var v;if(((v=f.Field)==null?void 0:v.Type)==="TICKET")return n=f,!0})}));return n?!!e.registration.Submissions.find(c=>{if(c.FormUUID==(u==null?void 0:u.FormUUID))return c.Data.find(d=>{if(d.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const E=JSON.parse(d.Data);return e.tickets.filter(f=>f.RequiresAccommodation).find(f=>E.Ticket.includes(f.TicketUUID)||E.AddonsChecked.includes(f.TicketUUID)||E.ComponentsChecked.includes(f.TicketUUID))}})}):!1});return(n,u)=>l.value?(s(),I(N,{key:0},[n.value?(s(),I("ol",Ja,[(s(!0),I(N,null,Z(r.value,c=>(s(),I("li",{key:c.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(d=>d.AccommodationUUID===c.AccommodationUUID)?(s(),I("strong",Xa,k(c.Name),1)):(s(),I(N,{key:1},[G(k(c.Name),1)],64))]))),128))])):q("",!0),t(ie,{onClick:u[0]||(u[0]=c=>p.value=!0),variant:"flat",color:"success"},{default:o(()=>[G("Assign Accommodation")]),_:1}),n.convention&&p.value?(s(),Y(Wa,{key:1,modelValue:p.value,"onUpdate:modelValue":u[1]||(u[1]=c=>p.value=c),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":r.value},null,8,["modelValue","convention","registration","selected-accommodation"])):q("",!0)],64)):q("",!0)}});const eo=Ye(Za,[["__scopeId","data-v-7a102d46"]]),to={key:0,class:"addonList"},ao={key:0},oo={key:0},no=se({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const p=ue(()=>{if(!e.value)return;const r=JSON.parse(e.value),l=Object.keys(r),n=ve(e.extras);return n.forEach(u=>{u.Options=u.Options.filter(c=>l.includes(c.OptionUUID)?(c.Choices=c.Choices.filter(d=>d.TagUUID===r[c.OptionUUID].choiceId),r[c.OptionUUID].checked):!1)}),n.filter(u=>u.Options.length>0),n});return(r,l)=>r.value?(s(),I("ul",to,[(s(!0),I(N,null,Z(p.value,n=>(s(),I(N,{key:n.ExtraUUID},[n.Options.length?(s(),I("li",ao,[h("strong",null,k(n.Name),1),h("ul",null,[(s(!0),I(N,null,Z(n.Options,u=>(s(),I("li",{key:u.OptionUUID},[G(k(u.Name)+" ",1),u.Choices.length==1?(s(),I("small",oo,"("+k(u.Choices[0].Title)+")",1)):q("",!0)]))),128))])])):q("",!0)],64))),128))])):q("",!0)}});const lo=Ye(no,[["__scopeId","data-v-55786e01"]]),io={key:0},so=se({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const p=ue(()=>{if(!e.value)return;const r=JSON.parse(e.value);return Object.entries(r).filter(([,l])=>l).map(([l,n])=>e.interests.find(u=>u.InterestUUID===l)).filter(l=>l!==void 0)});return(r,l)=>r.value?(s(),I("ul",io,[(s(!0),I(N,null,Z(p.value,n=>(s(),I("li",{key:n.InterestUUID},k(n.Name),1))),128))])):q("",!0)}}),ro=h("br",null,null,-1),uo=h("small",null,"Options:",-1),mo=h("br",null,null,-1),co=h("small",null,"Addons:",-1),vo=se({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const p=ue(()=>{if(!e.value)return;let r={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{r=JSON.parse(e.value),"ticket"in r&&(r.Ticket=r.ticket),"addonsChecked"in r&&(r.AddonsChecked=r.addonsChecked),"componentsChecked"in r&&(r.ComponentsChecked=r.componentsChecked)}catch{}return r.Ticket.filter(l=>{const n=e.tickets.find(u=>u.TicketUUID===l);return!(!n||n.Type!==jt.TICKET_TYPE_TICKET)}).map(l=>{const n=e.tickets.find(c=>c.TicketUUID===l),u=ve(n);return u.TicketComponents=n.TicketComponents.filter(c=>r.ComponentsChecked.includes(c.TicketUUID)),u.AddonTickets=n.AddonTickets.filter(c=>r.AddonsChecked.includes(c.TicketUUID)),u})});return(r,l)=>r.value?(s(!0),I(N,{key:0},Z(p.value,n=>(s(),I("div",{key:n.TicketUUID},[h("strong",null,k(n.Name),1),n.TicketComponents.length>0?(s(),I(N,{key:0},[ro,uo,G("  "),(s(!0),I(N,null,Z(n.TicketComponents,u=>(s(),I(N,{key:u.TicketUUID},[h("small",null,k(u.Name),1),G("  ")],64))),128))],64)):q("",!0),n.AddonTickets.length>0?(s(),I(N,{key:1},[mo,co,G("  "),(s(!0),I(N,null,Z(n.AddonTickets,u=>(s(),I("small",{key:u.TicketUUID},[G("("),h("em",null,k(u.Name),1),G(")")]))),128))],64)):q("",!0)]))),128)):q("",!0)}}),_o={key:0,class:"text-blue text-center"},Uo={key:1,class:"text-red text-center"},Ao={key:2,class:"text-orange text-center"},To={key:3,class:"text-orange text-center"},Eo={key:4,class:"text-orange text-center"},fo={key:5,class:"text-orange text-center"},So={key:6,class:"text-green text-center"},Do={key:0},po={key:0},Io=h("strong",null,"Total:",-1),Ro=se({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload"],setup(e,{emit:p}){const r=fe(),l=T(),n=T(),u=T(),c=T(),d=T(!1),E=(a,i,_)=>{n.value=a,r.getRegistrationGroup(_.RegistrationUUID||"").then(U=>{u.value=U,l.value=i,c.value=_,d.value=!0})},f=a=>{p("openActions",a)},v=a=>{p("openPayments",a)};return(a,i)=>(s(),I(N,null,[a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(s(),Y(eo,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(s(),Y(lo,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(s(),Y(so,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(s(),Y(vo,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(s(!0),I(N,{key:4},Z(a.item.raw[a.header.key],_=>(s(),I("ul",{key:_.Heading},[h("li",null,[h("strong",null,k(_.Heading)+": ",1),h("span",{class:Pt(x(ya)(_.Submission.Status))},k(x(pt)(_.Submission.Status)),3),t(ie,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:U=>E(_.Registration,_.Form,_.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(s(),Y(Oa,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(s(),I(N,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(s(),I("div",_o,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(s(),I("div",Uo,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(s(),I("div",Ao,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(s(),I("div",To,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(s(),I("div",Eo,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(s(),I("div",fo,"Awaiting Additional Payments")):(s(),I("div",So,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(s(),I(N,{key:7},[t(ie,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:i[0]||(i[0]=_=>f(a.item.raw[a.header.key]))}),t(ie,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:i[1]||(i[1]=_=>v(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(s(),I(N,{key:8},[a.item.raw[a.header.key].length===1?(s(),I("em",Do," Not in a group ")):(s(),I(N,{key:1},[h("ul",null,[(s(!0),I(N,null,Z(a.item.raw[a.header.key],_=>(s(),I("li",{key:_.UUID,class:"ml-0"},[G(" #"+k(_.Reference)+" : "+k(_.Name)+" ",1),_.IsLeader?(s(),I("strong",po,"(Leader)")):q("",!0)]))),128))]),Io,G(" "+k(a.item.raw[a.header.key].length),1)],64))],64)):(s(),I(N,{key:9},[G(k(a.item.raw[a.header.key]),1)],64)),d.value&&c.value&&l.value?(s(),Y(Va,{key:10,modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=_=>d.value=_),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(Rt,{class:"bg-red-darken-4"},{default:o(()=>[t(It,{color:"error"},{default:o(()=>[t(Ca,null,{default:o(()=>[G("Submission Editor - Admin Mode")]),_:1}),t(Xe),t(ga,null,{default:o(()=>[t(ie,{icon:"mdi:mdi-window-close",onClick:i[2]||(i[2]=_=>d.value=!1)})]),_:1})]),_:1}),t(Ma,null,{default:o(()=>[t(Qt,{modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=_=>l.value=_),admin:!0,convention:a.convention,data:c.value,editable:!0,"registration-group":u.value,onClose:i[4]||(i[4]=_=>{d.value=!1,p("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):q("",!0)],64))}});var yo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],go=function(e){return yo.map(function(p){return p.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Oo=function(e,p,r){Object.keys(p).filter(go).forEach(function(l){var n=p[l];typeof n=="function"&&(l==="onInit"?n(e,r):r.on(l.substring(2),function(u){return n(u,r)}))})},Co=function(e,p,r,l){var n=e.modelEvents?e.modelEvents:null,u=Array.isArray(n)?n.join(" "):n;oe(l,function(c,d){r&&typeof c=="string"&&c!==d&&c!==r.getContent({format:e.outputFormat})&&r.setContent(c)}),r.on(u||"change input undo redo",function(){p.emit("update:modelValue",r.getContent({format:e.outputFormat}))})},ho=function(e,p,r,l,n,u){l.setContent(u()),r.attrs["onUpdate:modelValue"]&&Co(p,r,l,n),Oo(e,r.attrs,l)},dt=0,gt=function(e){var p=Date.now(),r=Math.floor(Math.random()*1e9);return dt++,e+"_"+r+dt+String(p)},Mo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},mt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},bo=function(e,p){return mt(e).concat(mt(p))},Vo=function(e){return e==null},ct=function(){return{listeners:[],scriptId:gt("tiny-script"),scriptLoaded:!1}},ko=function(){var e=ct(),p=function(n,u,c,d){var E=u.createElement("script");E.referrerPolicy="origin",E.type="application/javascript",E.id=n,E.src=c;var f=function(){E.removeEventListener("load",f),d()};E.addEventListener("load",f),u.head&&u.head.appendChild(E)},r=function(n,u,c){e.scriptLoaded?c():(e.listeners.push(c),n.getElementById(e.scriptId)||p(e.scriptId,n,u,function(){e.listeners.forEach(function(d){return d()}),e.scriptLoaded=!0}))},l=function(){e=ct()};return{load:r,reinitialize:l}},No=ko(),Lo=function(){return typeof window<"u"?window:global},Oe=function(){var e=Lo();return e&&e.tinymce?e.tinymce:null},Fo={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},ce=globalThis&&globalThis.__assign||function(){return ce=Object.assign||function(e){for(var p,r=1,l=arguments.length;r<l;r++){p=arguments[r];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&(e[n]=p[n])}return e},ce.apply(this,arguments)},Po=function(e,p,r,l){return e(l||"div",{id:p,ref:r})},wo=function(e,p,r){return e("textarea",{id:p,visibility:"hidden",ref:r})},Ke={selector:void 0,target:void 0},$o=se({props:Fo,setup:function(e,p){var r=e.init?ce(ce({},e.init),Ke):ce({},Ke),l=wt(e),n=l.disabled,u=l.modelValue,c=l.tagName,d=T(null),E=null,f=e.id||gt("tiny-vue"),v=e.init&&e.init.inline||e.inline,a=!!p.attrs["onUpdate:modelValue"],i=!0,_=e.initialValue?e.initialValue:"",U="",K=function(S){return a?function(){return u!=null&&u.value?u.value:""}:function(){return S?_:U}},D=function(){var S=K(i),C=ce(ce({},r),{readonly:e.disabled,target:d.value,plugins:bo(r.plugins,e.plugins),toolbar:e.toolbar||r.toolbar,inline:v,setup:function(j){E=j,j.on("init",function(ne){return ho(ne,e,p,j,u,S)}),typeof r.setup=="function"&&r.setup(j)}});Mo(d.value)&&(d.value.style.visibility=""),Oe().init(C),i=!1};oe(n,function(S){var C;E!==null&&(typeof((C=E.mode)===null||C===void 0?void 0:C.set)=="function"?E.mode.set(S?"readonly":"design"):E.setMode(S?"readonly":"design"))}),oe(c,function(S){var C;a||(U=E.getContent()),(C=Oe())===null||C===void 0||C.remove(E),at(function(){return D()})}),$t(function(){if(Oe()!==null)D();else if(d.value&&d.value.ownerDocument){var S=e.cloudChannel?e.cloudChannel:"6",C=e.apiKey?e.apiKey:"no-api-key",j=Vo(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(C,"/tinymce/").concat(S,"/tinymce.min.js"):e.tinymceScriptSrc;No.load(d.value.ownerDocument,j,D)}}),Bt(function(){Oe()!==null&&Oe().remove(E)}),v||(Gt(function(){i||D()}),Yt(function(){var S;a||(U=E.getContent()),(S=Oe())===null||S===void 0||S.remove(E)}));var y=function(S){var C;U=E.getContent(),(C=Oe())===null||C===void 0||C.remove(E),r=ce(ce(ce({},r),S),Ke),at(function(){return D()})};return p.expose({rerender:y,getEditor:function(){return E}}),function(){return v?Po(ot,f,d,e.tagName):wo(ot,f,d)}}});const Bo=["colspan"],Go=h("strong",null,"E-Mail Content",-1),Yo=["innerHTML"],Ot=se({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:p}){const r=fe(),l=T([]),n=T({From:"",Subject:"",HTML:""}),u=T(""),c=T(""),d=T(""),E=T(!1),f=T([]),v=T([]),a=T([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),i=T([{key:"CreatedAt",order:"asc"}]);oe(n,D=>{d.value=D.From||d.value||"",c.value=D.Subject||c.value||"",u.value=D.HTML||u.value||""});const _=()=>{r.getRegistrationEmails(e.registration.RegistrationUUID).then(D=>{D&&(D.forEach(y=>{y.CreatedAt=Da(new Date(y.CreatedAt||"")),y.Status=$a(y.Status),y.User||(y.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),v.value=D)})};_(),(()=>{r.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(D=>{D&&(l.value=D)})})();const K=({callback:D})=>{r.sendRegistrationEmail(e.registration.RegistrationUUID,d.value,c.value,u.value).then(y=>{y?D&&(D("Email Sent"),_(),setTimeout(()=>{E.value=!1},2e3)):D&&D("Not sent")}).catch(()=>{D&&D("Not sent")})};return(D,y)=>(s(),I(N,null,[D.showEditor?(s(),I(N,{key:0},[t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(Kt,{items:l.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=S=>n.value=S),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12"},{default:o(()=>[t(Te,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=S=>d.value=S),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12"},{default:o(()=>[t(Te,{modelValue:c.value,"onUpdate:modelValue":y[2]||(y[2]=S=>c.value=S),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(P,{cols:"12"},{default:o(()=>[t(x($o),{modelValue:u.value,"onUpdate:modelValue":y[3]||(y[3]=S=>u.value=S),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,null,{default:o(()=>[t(We,{onClick:y[4]||(y[4]=S=>p("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(P,{class:"text-right"},{default:o(()=>[t(We,{onClick:K,label:"Send",color:"error"})]),_:1})]),_:1})],64)):q("",!0),v.value.length&&!D.hideHistory?(s(),Y(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[G(" Email History ")]),_:1}),t(At,null,{default:o(()=>[t(x(Tt),{items:v.value,headers:a.value,"show-expand":!0,"item-value":"EmailUUID",expanded:f.value,"onUpdate:expanded":y[5]||(y[5]=S=>f.value=S),"sort-by":i.value,"onUpdate:sortBy":y[6]||(y[6]=S=>i.value=S)},{"expanded-row":o(({columns:S,item:C})=>[h("tr",null,[h("td",{colspan:S.length},[Go,h("div",{class:"communicationsViewEmailPreview",innerHTML:C.raw.HTML},null,8,Yo)],8,Bo)])]),"footer.prepend":o(()=>[t(ie,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:_},{default:o(()=>[G("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const Ho=e=>(vt("data-v-5d88e57e"),e=e(),_t(),e),xo=["colspan"],qo=Ho(()=>h("strong",null,"Details",-1)),jo=["innerHTML"],Qo=se({__name:"PaymentTransactions",props:{hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:p}){const r=e;let{hideHistory:l=!1,registration:n,showEditor:u}=r;const c=fe(),d=T([]),E=T([]),f=T([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"}]),v=T([{key:"CreatedAt",order:"asc"}]),a=()=>({PaymentTransactionUUID:Me(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:Ra.PAYMENT_TRANSACTION_SOURCE_NULL,Type:St.PAYMENT_TRANSACTION_TYPE_NULL}),i=T(a()),{convertTransactions:_,getPaymentTransactionsDisplay:U}=Dt();oe(r,()=>{l=r.hideHistory,n=r.registration,u=r.showEditor,U(n.RegistrationUUID).then(y=>{E.value=y})});const K=()=>{U(n.RegistrationUUID).then(y=>{E.value=y})};K();const D=()=>{c.saveRegistrationPaymentTransaction(i.value).then(y=>{y&&(_(y.PaymentTransactions),i.value=a(),p("close-editor"),p("change"))})};return(y,S)=>(s(),I(N,null,[x(u)?(s(),I(N,{key:0},[t(ba,null,{default:o(()=>[G(" Add Transaction ")]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6"},{default:o(()=>[t(le,{items:x(pa),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:i.value.Type,"onUpdate:modelValue":S[0]||(S[0]=C=>i.value.Type=C),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(P,{cols:"12",sm:"6"},{default:o(()=>[t(le,{items:x(Ia),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:i.value.Source,"onUpdate:modelValue":S[1]||(S[1]=C=>i.value.Source=C),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(Te,{label:"Description","hide-details":"",modelValue:i.value.Description,"onUpdate:modelValue":S[2]||(S[2]=C=>i.value.Description=C),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(Te,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:i.value.Amount,"onUpdate:modelValue":S[3]||(S[3]=C=>i.value.Amount=C),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(ie,{class:"w-100",onClick:S[4]||(S[4]=C=>p("close-editor")),color:"warning"},{default:o(()=>[G("Cancel")]),_:1})]),_:1}),t(Xe),t(P,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(ie,{class:"w-100",onClick:D,color:"primary"},{default:o(()=>[G("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):q("",!0),E.value.length&&!x(l)?(s(),Y(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[G(" Transaction History ")]),_:1}),t(At,null,{default:o(()=>[t(x(Tt),{items:E.value,headers:f.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:d.value,"onUpdate:expanded":S[5]||(S[5]=C=>d.value=C),"sort-by":v.value,"onUpdate:sortBy":S[6]||(S[6]=C=>v.value=C)},{"expanded-row":o(({columns:C,item:j})=>[h("tr",null,[h("td",{colspan:C.length},[qo,h("div",{innerHTML:j.raw.HTML},null,8,jo)],8,xo)])]),"footer.prepend":o(()=>[t(ie,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:K},{default:o(()=>[G("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const Ko=Ye(Qo,[["__scopeId","data-v-5d88e57e"]]),xe=e=>(vt("data-v-b6837459"),e=e(),_t(),e),zo={class:"mb-4"},Wo={class:"v-row"},Jo={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Xo={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Zo={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},en={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},tn=xe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),an={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},on=xe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),nn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},ln=xe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),sn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},rn=xe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),un={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},dn=se({__name:"PaymentActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const r=e,l=Ge(e,"modelValue"),{registration:n}=r,u=T(!1),c=T(!1),d=T(),E=T([]),f=T(new Date().getTime()),v=Je(r,p,void 0,void 0,"registration"),a=T(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const i=fe(),_=()=>{i.generateRegistrationCharges(n.RegistrationUUID,!1).then(D=>{D&&(E.value=D.PaymentTransactions,d.value=D.Registration,f.value=new Date().getTime())}).catch(()=>{})};_();const U=()=>{i.generateRegistrationCharges(n.RegistrationUUID,!0).then(D=>{D&&(E.value=D.PaymentTransactions,d.value=D.Registration,f.value=new Date().getTime())})},{totalCharges:K}=Dt();return(D,y)=>(s(),Y(He,{modelValue:l.value,"onUpdate:modelValue":y[3]||(y[3]=S=>l.value=S),title:D.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[d.value?(s(),I(N,{key:0},[h("h3",zo,"#"+k(d.value.Reference)+" "+k(d.value.User.DisplayName),1),h("dl",Wo,[(s(!0),I(N,null,Z(E.value,S=>(s(),I(N,{key:S.PaymentTransactionUUID},[S.Type===x(St).PAYMENT_TRANSACTION_TYPE_CHARGE?(s(),I("dt",Jo,[h("div",Xo,k(S.Description.split(":")[0])+": ",1),h("div",Zo,k(S.Description.split(":")[1]),1)])):q("",!0),h("dd",en," £"+k(S.Amount),1)],64))),128)),tn,h("dd",an," £"+k(x(K)(E.value)),1),on,h("dd",nn," £"+k(d.value.Total),1),ln,h("dd",sn," £"+k(d.value.Paid),1),rn,h("dd",un," £"+k(d.value.Total-d.value.Paid),1)]),t(ee,{class:"flex-row-reverse"},{default:o(()=>[t(P,{class:"text-right"},{default:o(()=>[t(ie,{color:"primary",onClick:U},{default:o(()=>[G("Apply Charges")]),_:1})]),_:1}),c.value?q("",!0):(s(),Y(P,{key:0},{default:o(()=>[t(ie,{color:"secondary",onClick:y[0]||(y[0]=S=>c.value=!0)},{default:o(()=>[G("Transaction Entry")]),_:1})]),_:1}))]),_:1})],64)):q("",!0),t(Ko,{registration:x(n),"show-editor":c.value,onCloseEditor:y[1]||(y[1]=S=>c.value=!1),updated:f.value,onChange:_},null,8,["registration","show-editor","updated"]),t(Ot,{registration:x(n),"show-editor":u.value,onCloseEditor:y[2]||(y[2]=S=>u.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const mn=Ye(dn,[["__scopeId","data-v-b6837459"]]),cn=se({__name:"RegistrationActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const r=e,l=Ge(e,"modelValue"),n=T(!1),u=Je(r,p,void 0,void 0,"registration"),c=T(ve(u.value));oe(u,()=>{c.value=ve(u.value)});const d=fe(),E=(f,v)=>{const a=c.value.Submissions.find(i=>i.SubmissionUUID==v);if(!a){f&&f("Submission not found");return}d.setSubmissionStatus(v,a.Status).then(i=>{i?(c.value.Submissions.forEach((_,U)=>{u.value.Submissions[U].Status=_.Status}),f&&f("Status Saved")):f&&f("Status not saved")}).catch(()=>{f&&f("Status not saved")})};return(f,v)=>(s(),Y(He,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=a=>l.value=a),title:f.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[h("h3",null,"#"+k(f.registration.Reference)+" "+k(f.registration.User.DisplayName),1),t(Be,null,{default:o(()=>[(s(!0),I(N,null,Z(c.value.Submissions,a=>(s(),Y(Le,{key:a.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(ee,{class:"py-2 align-center"},{default:o(()=>[t(P,{cols:"8"},{default:o(()=>{var i;return[t(le,{modelValue:a.Status,"onUpdate:modelValue":_=>a.Status=_,items:x(rt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((i=f.forms.find(_=>_.FormUUID==a.FormUUID))==null?void 0:i.Name)||""},{selection:o(()=>[t(fa,{class:"mr-4"},{default:o(()=>{var _;return[G(k((_=x(rt).find(U=>U.value===a.Status))==null?void 0:_.icon),1)]}),_:2},1024),G(" "+k(x(pt)(a.Status)),1)]),item:o(({item:_,props:{onClick:U}})=>[t(Le,{title:_.title,"prepend-icon":_.raw.icon,onClick:U},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(P,{cols:"4"},{default:o(()=>[t(We,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:i=>E(i.callback,a.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(ee,null,{default:o(()=>[t(P,{cols:"12"},{default:o(()=>[t(ie,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:v[0]||(v[0]=a=>n.value=!0)},{default:o(()=>[G("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Ot,{registration:f.registration,"show-editor":n.value,onCloseEditor:v[1]||(v[1]=a=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const jn=se({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:p}){var Ze;const r=ha();p("pageTitle","Registration Manager");const l=Ht(),n=xt(),u=T(!0);let c=((Ze=l.params.convention)==null?void 0:Ze.toString())||"";const d=T({ID:0,ConventionUUID:Me(),OrganisationID:0,OrganisationUUID:Qe,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),E=fe(),f=T({ID:0,AdminLayoutUUID:Me(),ConventionID:d.value.ID,ConventionUUID:d.value.ConventionUUID,Name:"Registration Table",Type:yt.ADMIN_LAYOUT_TABLE,Panels:[]}),v=T([]),a=T([]),i=T([]),_=T([]),U=T([]),K=T(1),D=T(10),y=T([]),S=T(0),C=T(!1),j=T(""),ne=T(""),Se=T(""),De=T(""),M=T(""),b=T(""),L=T([]),g=T([]),$=T([]),W=T([]),te=T([]),z=T([]),de=T(0),re=T(),pe=T(!1),Ie=T(!1);oe(j,m=>{const A=U.value.find(R=>R.uuid===m);if(A){const R=A.headers.find(O=>O.defaultSort===!0);R&&(y.value=[{key:R.key,order:"asc"}],L.value=[{key:R.key,order:"asc"}])}}),oe(de,m=>{m===7&&Ve()}),oe(M,()=>{ne.value=Date.now().toString()}),oe(b,()=>{ne.value=Date.now().toString()});const Re=()=>{v.value=[],i.value=[],U.value=[];try{E.getConventionAdminLayoutByName(d.value.ConventionUUID,"Registration Table").then(m=>{de.value+=1,m?f.value=m:(f.value.ConventionID=d.value.ID,f.value.ConventionUUID=d.value.ConventionUUID)})}catch{f.value.ConventionID=d.value.ID,f.value.ConventionUUID=d.value.ConventionUUID}try{E.getConventionForms(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(v.value=m)})}catch{}try{E.getConventionAccommodation(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(g.value=m)})}catch{}try{E.getConventionVenues(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(z.value=m)})}catch{}try{E.getConventionExtras(d.value.ConventionUUID).then(m=>{de.value+=1,m&&($.value=m)})}catch{}try{E.getConventionInterests(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(W.value=m)})}catch{}try{E.getConventionTickets(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(te.value=m)})}catch{}try{E.getConventionGroups(d.value.ConventionUUID).then(m=>{m&&(a.value=m.sort((A,R)=>A.Name.localeCompare(R.Name)))})}catch{}try{E.getConventionTags(d.value.ConventionUUID).then(m=>{m&&(_.value=m.sort((A,R)=>A.Title.localeCompare(R.Title)).map(A=>(A.Title=`${A.Title} [${A.Key}]`,A)))})}catch{}},be=({page:m,itemsPerPage:A,sortBy:R})=>{u.value=!0,K.value=m,y.value=R;const O=U.value.find(J=>J.uuid==j.value),me=O==null?void 0:O.layout.Items;let ae="",et="";if(R&&me&&R.length>=1){const J=me.find(ke=>ke.LayoutItemUUID==R[0].key);switch(et=R[0].order||"asc",J==null?void 0:J.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:ae="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:ae="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:ae="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ae="submission.status";break}switch(J==null?void 0:J.UserField){case X.USER_DATA_SOURCE_DISPLAY_NAME:ae="user.display_name";break;case X.USER_DATA_SOURCE_EMAIL:ae="user.email";break;case X.USER_DATA_SOURCE_FIRST_NAME:ae="user.firstname";break;case X.USER_DATA_SOURCE_HANDLE:ae="user.handle";break;case X.USER_DATA_SOURCE_LAST_NAME:ae="user.lastname";break}}try{const J={Direction:et,Limit:A,Offset:(m-1)*A,Order:ae};O&&O.layout.RequiredRegistrationTags.length>0&&(J.PanelUUID=O==null?void 0:O.layout.LayoutPanelUUID),(O==null?void 0:O.layout.RequiredFormType)===Ae.FORM_TYPE_ACCOMMODATION&&(J.Accommodation=!0),(O==null?void 0:O.layout.RequiredFormType)===Ae.FORM_TYPE_BADGE&&(J.Badge=!0),(O==null?void 0:O.layout.RequiredFormType)===Ae.FORM_TYPE_DEALER&&(J.Dealer=!0),(O==null?void 0:O.layout.RequiredFormType)===Ae.FORM_TYPE_REGISTRATION&&(J.Registration=!0),J.GroupUUID=M.value||Qe,J.TagUUID=b.value||Qe,J.Email=De.value,J.Reference=Se.value,E.searchConventionRegistrations(d.value.ConventionUUID,J).then(ke=>{ke&&(S.value=ke.Total,i.value=ke.Registrations,U.value.forEach(qe=>{const Vt=qe.layout;qe.items=i.value.map(w=>{const we=[];let _e;w.Leader?_e=w:_e=w.Primary,we.push({Name:_e.User.DisplayName,UUID:_e.UserUUID,UserUUID:_e.User.UserUUID,IsLeader:!0,Reference:_e.Reference,Paid:_e.Paid,Total:_e.Total}),we.push(..._e.Members.map(Ue=>({Name:Ue.User.DisplayName,UUID:Ue.UserUUID,UserUUID:Ue.User.UserUUID,IsLeader:!1,Reference:Ue.Reference,Paid:Ue.Paid,Total:Ue.Total})));const H={};return qe.headers.forEach(Ue=>{var tt;const F=Vt.Items.find(Ne=>Ne.LayoutItemUUID===Ue.key);if(F){if(F.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&F.SectionField)w.Submissions.forEach(Ne=>{const he=Ne.Data.find(V=>V.SectionFieldUUID===F.SectionFieldUUID);if(he){Ue.type===zt.ACCOMMODATION?H[F.LayoutItemUUID]={Data:he.Data,Registration:w}:H[F.LayoutItemUUID]=he.Data;return}});else if(F.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&F.UserField)switch(F.UserField){case X.USER_DATA_SOURCE_AVATAR:H[F.LayoutItemUUID]=r.GetProfileImageURL(w.UserUUID);break;case X.USER_DATA_SOURCE_DISPLAY_NAME:H[F.LayoutItemUUID]=w.User.DisplayName;break;case X.USER_DATA_SOURCE_EMAIL:H[F.LayoutItemUUID]=w.User.Additional.Email;break;case X.USER_DATA_SOURCE_HANDLE:H[F.LayoutItemUUID]=w.User.Handle;break;case X.USER_DATA_SOURCE_DATE_OF_BIRTH:H[F.LayoutItemUUID]=w.User.Additional.DOB;break;case X.USER_DATA_SOURCE_FIRST_NAME:H[F.LayoutItemUUID]=w.User.Additional.FirstName;break;case X.USER_DATA_SOURCE_LAST_NAME:H[F.LayoutItemUUID]=w.User.Additional.LastName;break;case X.USER_DATA_SOURCE_TELEGRAM:H[F.LayoutItemUUID]="";break}else if(F.SourceType==="LAYOUT_ITEM_SOURCE_META"&&F.MetaField){const Ne=(tt=v.value.find(V=>V.Type===Ae.FORM_TYPE_REGISTRATION))==null?void 0:tt.FormUUID,he=w.Submissions.find(V=>V.FormUUID===Ne);switch(F.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:H[F.LayoutItemUUID]=w;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:H[F.LayoutItemUUID]=we;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:H[F.LayoutItemUUID]=w.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(he){const V=new Date(he.CreatedAt||"");H[F.LayoutItemUUID]=`${V.getFullYear()}-${(V.getMonth()+1).toString().padStart(2,"0")}-${V.getDate().toString().padStart(2,"0")} ${V.getHours().toString().padStart(2,"0")}:${V.getMinutes().toString().padStart(2,"0")}:${V.getSeconds().toString().padStart(2,"0")}`}else{const V=new Date(w.CreatedAt||"");H[F.LayoutItemUUID]=`${V.getFullYear()}-${(V.getMonth()+1).toString().padStart(2,"0")}-${V.getDate().toString().padStart(2,"0")} ${V.getHours().toString().padStart(2,"0")}:${V.getMinutes().toString().padStart(2,"0")}:${V.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:H[F.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:H[F.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:H[F.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}}).filter(V=>{var B;return((B=V.Form)==null?void 0:B.Type)===Ae.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if(w.Paid===0&&w.Total)H[F.LayoutItemUUID]="REQUIRED";else if(w.Total>w.Paid)H[F.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const V=we.find(B=>B.Paid===0&&(B.Total||0)>0);if(V){w.Total===0&&V.Total===0?H[F.LayoutItemUUID]="NOT_REQUIRED":w.Total===0&&V.Total||w.Total>0&&V.Total===0?H[F.LayoutItemUUID]="MISSING_REQUIRED":w.Paid>=w.Total?H[F.LayoutItemUUID]="AWAITING_PARTNER":H[F.LayoutItemUUID]="ALL_REQUIRED";break}else w.Total===0?H[F.LayoutItemUUID]="NOT_REQUIRED":H[F.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:ka(w.Submissions,v.value),H[F.LayoutItemUUID]=w.Submissions.map(V=>{const B=v.value.find(ye=>ye.FormUUID===V.FormUUID);return{Heading:B==null?void 0:B.Heading,Form:B,Submission:V,Registration:w}});break}}}}),H})}),u.value=!1)})}catch{}},Pe=m=>{C.value=!1,m&&(f.value=m,Ve())},Ve=()=>{f.value.Panels.forEach(m=>{m.Items.forEach(A=>{(A.SectionField==null||A.SectionField.Field==null)&&v.value.find(R=>{R.Sections.find(O=>{if(O.Fields){const me=O.Fields.find(ae=>ae.SectionFieldUUID===A.SectionFieldUUID);if(me)return A.SectionField=me,!0}})})})}),f.value.Panels.length>0&&(U.value=[],f.value.Panels.forEach(m=>{const A={uuid:Me(),order:m.Order,name:m.Name,headers:[],items:[],layout:m};m.Items.sort((R,O)=>R.Order>O.Order?1:R.Order==O.Order?0:-1),A.headers=m.Items.map(R=>{var O,me;return{key:R.LayoutItemUUID,title:R.Label||((me=(O=R.SectionField)==null?void 0:O.Field)==null?void 0:me.Label)||"",align:R.Align==="end"?"end":"start",sortable:ht(R),type:Ct(R),defaultSort:R.DefaultSort}}),U.value.push(A)}),U.value=U.value.sort((m,A)=>m.order>A.order?1:m.order==A.order?0:-1)),(j.value==null||j.value=="")&&U.value.length>0&&(j.value=U.value[0].uuid)};c?E.getConvention(c).then(m=>{m&&(d.value=m,f.value.ConventionID=d.value.ID,f.value.ConventionUUID=d.value.ConventionUUID,Re())}).catch(()=>{n.push("/")}):n.push("/");const Ct=m=>{var A,R;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_META)return`${m.SourceType}.${m.MetaField}`;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_FORM)return(R=(A=m.SectionField)==null?void 0:A.Field)==null?void 0:R.Type;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_USER)return`${m.SourceType}.${m.UserField}`},ht=m=>{const A=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],R=[X.USER_DATA_SOURCE_DISPLAY_NAME,X.USER_DATA_SOURCE_EMAIL,X.USER_DATA_SOURCE_HANDLE,X.USER_DATA_SOURCE_DATE_OF_BIRTH,X.USER_DATA_SOURCE_FIRST_NAME,X.USER_DATA_SOURCE_LAST_NAME];return A.includes(m.MetaField)||R.includes(m.UserField)},Mt=m=>{re.value=m,pe.value=!0},bt=m=>{re.value=m,Ie.value=!0};return oe(pe,m=>{m||(re.value=void 0)}),oe(Ie,m=>{m||(re.value=void 0)}),(m,A)=>(s(),Y(Na,null,{default:o(()=>[t(It,{color:"blue-darken-4"},{default:o(()=>[t(_a,{modelValue:j.value,"onUpdate:modelValue":A[0]||(A[0]=R=>j.value=R),"show-arrows":""},{default:o(()=>[(s(!0),I(N,null,Z(U.value,R=>(s(),Y(Ua,{key:R.uuid,value:R.uuid},{default:o(()=>[G(k(R.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(Xe),t(ie,{icon:"mdi:mdi-cog-outline",onClick:A[1]||(A[1]=R=>C.value=!0)})]),_:1}),t(Ta,{modelValue:j.value,"onUpdate:modelValue":A[13]||(A[13]=R=>j.value=R),disabled:!0},{default:o(()=>[(s(!0),I(N,null,Z(U.value,R=>(s(),Y(Aa,{key:R.uuid,value:R.uuid},{default:o(()=>[R.uuid===j.value?(s(),Y(Rt,{key:0,class:"pa-2"},{default:o(()=>[t(x(Ga),{"items-per-page":D.value,"onUpdate:itemsPerPage":A[11]||(A[11]=O=>D.value=O),"sort-by":L.value,"onUpdate:sortBy":A[12]||(A[12]=O=>L.value=O),headers:R.headers,"items-length":S.value,items:R.items,"item-value":"LayoutItemUUID",loading:u.value,search:ne.value,"onUpdate:options":be},ze({top:o(()=>[t(Ce,null,{default:o(()=>[t(ee,null,{default:o(()=>[t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:Se.value,"onUpdate:modelValue":A[2]||(A[2]=O=>Se.value=O),label:"Search by Badge",clearable:!0,"hide-details":"","onClick:clear":A[3]||(A[3]=O=>ne.value=Date.now().toString()),onInput:A[4]||(A[4]=O=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:De.value,"onUpdate:modelValue":A[5]||(A[5]=O=>De.value=O),label:"Search By Email",clearable:!0,"hide-details":"","onClick:clear":A[6]||(A[6]=O=>ne.value=Date.now().toString()),onInput:A[7]||(A[7]=O=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(le,{modelValue:M.value,"onUpdate:modelValue":A[8]||(A[8]=O=>M.value=O),label:"Search By Group",clearable:!0,"hide-details":"",items:a.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(P,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(le,{modelValue:b.value,"onUpdate:modelValue":A[9]||(A[9]=O=>b.value=O),label:"Search By Tag",clearable:!0,"hide-details":"",items:_.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[Z(R.headers,O=>({name:`item.${O.key}`,fn:o(({item:me})=>[t(Ro,{header:O,item:me,accommodations:g.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,venues:z.value,onOpenActions:Mt,onOpenPayments:bt,onReload:A[10]||(A[10]=ae=>be({page:K.value,itemsPerPage:D.value,sortBy:y.value}))},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),C.value?(s(),Y(Ya,{key:0,title:"Edit Layout",modelValue:C.value,"onUpdate:modelValue":A[14]||(A[14]=R=>C.value=R),layout:f.value,onSave:Pe},null,8,["modelValue","layout"])):q("",!0),re.value?(s(),I(N,{key:1},[pe.value?(s(),Y(cn,{key:0,modelValue:pe.value,"onUpdate:modelValue":A[15]||(A[15]=R=>pe.value=R),registration:re.value,"onUpdate:registration":A[16]||(A[16]=R=>re.value=R),accommodations:g.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Status & Communications",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):Ie.value?(s(),Y(mn,{key:1,modelValue:Ie.value,"onUpdate:modelValue":A[17]||(A[17]=R=>Ie.value=R),registration:re.value,"onUpdate:registration":A[18]||(A[18]=R=>re.value=R),accommodations:g.value,convention:d.value,extras:$.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Payments",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):q("",!0)],64)):q("",!0)]),_:1}))}});export{jn as default};
