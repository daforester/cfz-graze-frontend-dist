import{I as N,a1 as Q,a2 as ne,r as T,a3 as j,K as n,L as D,M as m,$ as Z,v as s,S as $,a8 as z,Z as E,Q as C,e as H,R as v,H as y,O as h,_ as ee,U as L,N as g,a4 as oe,a0 as ie}from"./index-be20668f.js";import{_ as ue}from"./ModelDialog.vue_vue_type_script_setup_true_lang-ccb2609b.js";import{_ as X,f as se,g as re,h as de,e as me,i as ce,d as ve}from"./VWindowItem-fd43c76e.js";import{c as Ue,T as Ie}from"./filter-1b9f77a2.js";import{a as x,V as M}from"./VRow-74358453.js";import{V as J}from"./VTextField-83363123.js";import{V as P}from"./VSelect-92c34a0b.js";import{j as K}from"./VContainer-347cb348.js";import{v as Y}from"./v4-a960c1f4.js";import{V as te}from"./VBtn-a49f23bb.js";import{u as _e,V as fe}from"./VToolbar-b22774be.js";import{V as Te}from"./VSpacer-35eb1af3.js";import{e as De}from"./VCard-f174e0cb.js";import"./VChip-ba29fa82.js";import"./scopeId-a856d302.js";import"./VAvatar-ed6e3614.js";import"./VDialog-37b0e15b.js";import"./VCheckboxBtn-a916f4c4.js";import"./VTable-c86106ef.js";import"./VToolbarItems-e2c7a063.js";import"./VList-0678f76e.js";var ae=(i=>(i.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",i.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",i))(ae||{});const pe=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var le=(i=>(i.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",i.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",i.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",i))(le||{});const Ae=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}],ye=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}],Se=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Ee=N({__name:"EditAdminLayout",props:Q({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Q(["save"],["update:modelValue"]),setup(i,{emit:p}){const e=ne(i,"modelValue"),o=T(j(i.layout)),l=T([]),t=Z(),r=({callback:c})=>{const d=()=>{c&&c("Failed to Save Layout")},u=()=>{c&&c("Layout Saved")};t.saveAdminLayout(o.value).then(k=>{k?(u(),p("save",k)):d()}).catch(()=>{d()})},f=()=>({ID:0,LayoutPanelUUID:Y(),AdminLayoutID:o.value.ID,AdminLayoutUUID:o.value.AdminLayoutUUID,Name:"",Order:o.value.Panels.length+1,Items:[]}),V=c=>()=>({ID:0,LayoutItemUUID:Y(),LayoutPanelID:c.ID,LayoutPanelUUID:c.LayoutPanelUUID,Label:"",SourceType:le.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:c.Items.length+1}),F=c=>{const d=l.value.find(u=>u.value===c.SectionFieldUUID);d&&(c.SectionFieldID=d.object.ID,c.SectionField=d.object)};return t.getConventionForms(i.layout.ConventionUUID).then(c=>{c.forEach(d=>d.Sections.forEach(u=>u.Fields&&l.value.push(...u.Fields.map(k=>{var R;return{title:`${d.Name} - ${u.Name} - ${(R=k.Field)==null?void 0:R.Name}`,value:k.SectionFieldUUID,object:k}})))),l.value.sort(Ue("title"))}),(c,d)=>(n(),D(ue,{modelValue:e.value,"onUpdate:modelValue":d[3]||(d[3]=u=>e.value=u),onSave:r,title:c.title,color:"primary"},{default:m(()=>[s(K,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[s(x,null,{default:m(()=>[s(M,{cols:"12",sm:"6"},{default:m(()=>[s(J,{modelValue:o.value.Name,"onUpdate:modelValue":d[0]||(d[0]=u=>o.value.Name=u),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(M,{cols:"12",sm:"6"},{default:m(()=>[s(P,{modelValue:o.value.Type,"onUpdate:modelValue":d[1]||(d[1]=u=>o.value.Type=u),label:"Layout Type",items:$(pe),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),s(X,{modelValue:o.value.Panels,"onUpdate:modelValue":d[2]||(d[2]=u=>o.value.Panels=u),"new-item":f,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},z({_:2},[E(o.value.Panels,(u,k)=>({name:`panel_${k}`,fn:m(()=>[s(K,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[s(x,null,{default:m(()=>[s(M,{cols:"12",sm:"6"},{default:m(()=>[s(J,{modelValue:u.Name,"onUpdate:modelValue":U=>u.Name=U,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),s(X,{modelValue:u.Items,"onUpdate:modelValue":U=>u.Items=U,"new-item":V(u),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},z({_:2},[E(u.Items,(U,R)=>({name:`item_${R}`,fn:m(()=>[s(K,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[s(x,null,{default:m(()=>[s(M,{cols:"12",sm:"6"},{default:m(()=>[s(J,{modelValue:U.Label,"onUpdate:modelValue":A=>U.Label=A,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),s(x,null,{default:m(()=>[s(M,{cols:"12",sm:"6"},{default:m(()=>[s(P,{modelValue:U.SourceType,"onUpdate:modelValue":A=>U.SourceType=A,label:"Source Type",items:$(Ae),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(M,{cols:"12",sm:"6"},{default:m(()=>[U.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),D(P,{key:0,modelValue:U.SectionFieldUUID,"onUpdate:modelValue":A=>U.SectionFieldUUID=A,label:"Form Data",items:l.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:A=>F(U)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):U.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),D(P,{key:1,modelValue:U.MetaField,"onUpdate:modelValue":A=>U.MetaField=A,label:"Miscellaneous Data",items:$(ye),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):U.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),D(P,{key:2,modelValue:U.UserField,"onUpdate:modelValue":A=>U.UserField=A,label:"User Profile Data",items:$(Se),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),ke={key:0,class:"accommodationList"},Ce=N({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(i){const p=H(()=>{if(!i.value)return[];const e=JSON.parse(i.value),o=i.accommodations.filter(l=>e.includes(l.AccommodationUUID)).sort((l,t)=>{const r=e.findIndex(V=>V===l.AccommodationUUID),f=e.findIndex(V=>V===t.AccommodationUUID);return r>f?1:-1});return j(o)});return(e,o)=>e.value?(n(),v("ol",ke,[(n(!0),v(y,null,E(p.value,l=>(n(),v("li",{key:l.AccommodationUUID},h(l.Name),1))),128))])):C("",!0)}});const he=ee(Ce,[["__scopeId","data-v-1ba5f67a"]]),Ve={key:0,class:"addonList"},Oe={key:0},Le=N({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(i){const p=H(()=>{if(!i.value)return;const e=JSON.parse(i.value),o=Object.keys(e),l=j(i.extras);return l.forEach(t=>{t.Options=t.Options.filter(r=>o.includes(r.OptionUUID)?(r.Choices=r.Choices.filter(f=>f.TagUUID===e[r.OptionUUID].choiceId),e[r.OptionUUID].checked):!1)}),l.filter(t=>t.Options.length>0),l});return(e,o)=>e.value?(n(),v("ul",Ve,[(n(!0),v(y,null,E(p.value,l=>(n(),v("li",{key:l.ExtraUUID},[L("strong",null,h(l.Name),1),L("ul",null,[(n(!0),v(y,null,E(l.Options,t=>(n(),v("li",{key:t.OptionUUID},[g(h(t.Name)+" ",1),t.Choices.length==1?(n(),v("small",Oe,"("+h(t.Choices[0].Title)+")",1)):C("",!0)]))),128))])]))),128))])):C("",!0)}});const ge=ee(Le,[["__scopeId","data-v-4ed6842b"]]),Re={key:0},Ne=N({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(i){const p=H(()=>{if(!i.value)return;const e=JSON.parse(i.value);return Object.entries(e).filter(([,o])=>o).map(([o,l])=>i.interests.find(t=>t.InterestUUID===o)).filter(o=>o!==void 0)});return(e,o)=>e.value?(n(),v("ul",Re,[(n(!0),v(y,null,E(p.value,l=>(n(),v("li",{key:l.InterestUUID},h(l.Name),1))),128))])):C("",!0)}}),be=L("br",null,null,-1),Me=L("small",null,"Options:",-1),Fe=L("br",null,null,-1),we=L("small",null,"Addons:",-1),Pe=N({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(i){const p=H(()=>{if(!i.value)return;let e={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{e=JSON.parse(i.value),"ticket"in e&&(e.Ticket=e.ticket),"addonsChecked"in e&&(e.AddonsChecked=e.addonsChecked),"componentsChecked"in e&&(e.ComponentsChecked=e.componentsChecked)}catch{}return e.Ticket.filter(o=>{const l=i.tickets.find(t=>t.TicketUUID===o);return!(!l||l.Type!==Ie.TICKET_TYPE_TICKET)}).map(o=>{const l=i.tickets.find(r=>r.TicketUUID===o),t=j(l);return t.TicketComponents=l.TicketComponents.filter(r=>e.ComponentsChecked.includes(r.TicketUUID)),t.AddonTickets=l.AddonTickets.filter(r=>e.AddonsChecked.includes(r.TicketUUID)),t})});return(e,o)=>e.value?(n(!0),v(y,{key:0},E(p.value,l=>(n(),v("div",{key:l.TicketUUID},[L("strong",null,h(l.Name),1),l.TicketComponents.length>0?(n(),v(y,{key:0},[be,Me,g("  "),(n(!0),v(y,null,E(l.TicketComponents,t=>(n(),v(y,{key:t.TicketUUID},[L("small",null,h(t.Name),1),g("  ")],64))),128))],64)):C("",!0),l.AddonTickets.length>0?(n(),v(y,{key:1},[Fe,we,g("  "),(n(!0),v(y,null,E(l.AddonTickets,t=>(n(),v("small",{key:t.TicketUUID},[g("("),L("em",null,h(t.Name),1),g(")")]))),128))],64)):C("",!0)]))),128)):C("",!0)}}),$e=N({__name:"RegListRow",props:{header:{},accommodations:{},extras:{},item:{},interests:{},tickets:{},venues:{}},setup(i){const p=e=>{console.log(e)};return(e,o)=>e.header.key=="actions"?(n(),D(te,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:o[0]||(o[0]=l=>p(e.item.raw))})):e.header.type==="ACCOMMODATION"&&e.accommodations.length>0?(n(),D(he,{key:1,value:e.item.raw[e.header.key],accommodations:e.accommodations},null,8,["value","accommodations"])):e.header.type==="EXTRAS"&&e.extras.length>0?(n(),D(ge,{key:2,value:e.item.raw[e.header.key],extras:e.extras},null,8,["value","extras"])):e.header.type==="INTERESTS"&&e.interests.length>0?(n(),D(Ne,{key:3,value:e.item.raw[e.header.key],interests:e.interests},null,8,["value","interests"])):e.header.type==="TICKET"&&e.tickets.length>0?(n(),D(Pe,{key:4,value:e.item.raw[e.header.key],tickets:e.tickets},null,8,["value","tickets"])):(n(),v(y,{key:5},[g(h(e.item.raw[e.header.key]),1)],64))}}),ut=N({__name:"RegistrationsView",emits:["pageTitle"],setup(i,{emit:p}){var q;p("pageTitle","Registration Manager");const e=oe(),o=ie();let l=((q=e.params.convention)==null?void 0:q.toString())||"";const t=T({ID:0,ConventionUUID:Y(),OrganisationID:0,OrganisationUUID:_e,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),r=Z(),f=T({ID:0,AdminLayoutUUID:Y(),ConventionID:t.value.ID,ConventionUUID:t.value.ConventionUUID,Name:"Registration Table",Type:ae.ADMIN_LAYOUT_TABLE,Panels:[]}),V=T([]),F=T([]),c=T([]),d=T(!1),u=T(""),k=T([]),U=T([]),R=T([]),A=T([]),G=T([]),W=async()=>{V.value=[],F.value=[],c.value=[];try{const a=await r.getConventionAdminLayoutByName(t.value.ConventionUUID,"Registration Table");a?f.value=a:(f.value.ConventionID=t.value.ID,f.value.ConventionUUID=t.value.ConventionUUID)}catch{f.value.ConventionID=t.value.ID,f.value.ConventionUUID=t.value.ConventionUUID}try{const a=await r.getConventionRegistrations(t.value.ConventionUUID);if(!a)return;F.value=a}catch{return}try{const a=await r.getConventionForms(t.value.ConventionUUID);if(!a)return;V.value=a}catch{return}try{const a=await r.getConventionAccommodation(t.value.ConventionUUID);if(!a)return;k.value=a}catch{return}try{const a=await r.getConventionVenues(t.value.ConventionUUID);if(!a)return;G.value=a}catch{return}try{const a=await r.getConventionExtras(t.value.ConventionUUID);if(!a)return;U.value=a}catch{return}try{const a=await r.getConventionInterests(t.value.ConventionUUID);if(!a)return;R.value=a}catch{return}try{const a=await r.getConventionTickets(t.value.ConventionUUID);if(!a)return;A.value=a}catch{return}f.value.Panels.forEach(a=>{a.Items.forEach(_=>{(_.SectionField==null||_.SectionField.Field==null)&&V.value.find(I=>{I.Sections.find(S=>{if(S.Fields){const O=S.Fields.find(b=>b.SectionFieldUUID===_.SectionFieldUUID);if(O)return _.SectionField=O,!0}})})})}),f.value.Panels.length>0&&f.value.Panels.forEach(a=>{const _={uuid:Y(),order:a.Order,name:a.Name,headers:[],items:[]},I={key:"actions",title:"Actions",align:"start",sortable:!1,type:""};_.headers=a.Items.map(S=>{var O,b,w,B;return{key:S.LayoutItemUUID,title:S.Label||((b=(O=S.SectionField)==null?void 0:O.Field)==null?void 0:b.Label)||"",align:S.Align==="end"?"end":"start",sortable:!0,type:((B=(w=S.SectionField)==null?void 0:w.Field)==null?void 0:B.Type)||""}}),_.headers.push(I),_.items=F.value.map(S=>{const O={};return _.headers.forEach(b=>{const w=a.Items.find(B=>B.LayoutItemUUID===b.key);w&&w.SectionField}),O}),c.value.push(_)}),(u.value==null||u.value=="")&&c.value.length>0&&(u.value=c.value[0].uuid)};return l?r.getConvention(l).then(a=>{a&&(t.value=a,W())}).catch(()=>{o.push("/")}):o.push("/"),(a,_)=>(n(),D(ve,null,{default:m(()=>[s(fe,{color:"blue-darken-4"},{default:m(()=>[s(se,{modelValue:u.value,"onUpdate:modelValue":_[0]||(_[0]=I=>u.value=I),"show-arrows":""},{default:m(()=>[(n(!0),v(y,null,E(c.value,I=>(n(),D(re,{key:I.uuid,value:I.uuid},{default:m(()=>[g(h(I.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(Te),s(te,{icon:"mdi:mdi-cog-outline",onClick:_[1]||(_[1]=I=>d.value=!0)})]),_:1}),s(ce,{modelValue:u.value,"onUpdate:modelValue":_[2]||(_[2]=I=>u.value=I)},{default:m(()=>[(n(!0),v(y,null,E(c.value,I=>(n(),D(de,{key:I.uuid,value:I.uuid},{default:m(()=>[I.uuid===u.value?(n(),D(De,{key:0,class:"pa-2"},{default:m(()=>[s($(me),{headers:I.headers,items:I.items,itemsPerPage:"50","item-value":"LayoutItemUUID"},z({_:2},[E(I.headers,S=>({name:`item.${S.key}`,fn:m(({item:O})=>[s($e,{header:S,item:O,accommodations:k.value,extras:U.value,interests:R.value,tickets:A.value,venues:G.value},null,8,["header","item","accommodations","extras","interests","tickets","venues"])])}))]),1032,["headers","items"])]),_:2},1024)):C("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),d.value?(n(),D(Ee,{key:0,title:"Edit Layout",modelValue:d.value,"onUpdate:modelValue":_[3]||(_[3]=I=>d.value=I),layout:f.value,onSave:_[4]||(_[4]=I=>{d.value=!1,W()})},null,8,["modelValue","layout"])):C("",!0)]),_:1}))}});export{ut as default};
