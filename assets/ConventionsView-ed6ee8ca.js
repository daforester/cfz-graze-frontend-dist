import{F as K}from"./form-aee596e2.js";import{P as Q}from"./permission-03f04c02.js";import{I as $,a0 as F,a1 as G,r as v,a2 as E,w as B,K as i,L as f,M as e,Q as C,v as t,$ as M,_ as P,J as Z,R as V,N as I,O as A,S,a3 as W,Z as X,H as ee}from"./index-66519961.js";import{u as Y}from"./useStoreAPI-35819716.js";import{_ as te}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-38f460f9.js";import{u as ae,V as ne}from"./VCheckbox-d720999d.js";import{_ as oe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-c5b16c6e.js";import{s as k}from"./index-71069b21.js";import{a as U,V as p}from"./VRow-10269350.js";import{V as q}from"./VAvatar-f6f7c4c8.js";import{V as T}from"./VTextField-88275153.js";import{V as le}from"./VForm-baadde71.js";import{V as ie}from"./VFileInput-5a9c9523.js";import{n as j,V as h}from"./VContainer-f7530e18.js";import{C as se}from"./canEditConvention-c5ac6da3.js";import{G as z}from"./group-d2a77946.js";import{C as H,a as ue}from"./canEditOrganisation-b4049ca7.js";import{G as J}from"./userData-36b22fbb.js";import{e as re,V as de,c as O,b as me,d as ve}from"./VCard-fe4440b3.js";import{v as ce}from"./v4-a960c1f4.js";import{u as fe}from"./VToolbar-98532de1.js";import"./VChip-5872c4cf.js";import"./scopeId-7eeb3c4f.js";import"./index-c8542385.js";import"./VDialog-ca8944d4.js";import"./VCheckboxBtn-9cf26c16.js";import"./VSpacer-d0a0a75d.js";const pe=(g,a)=>g===void 0?!1:H(g,z.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditRegistration,ge=(g,a)=>g===void 0?!1:H(g,z.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewRegistration,_e=$({__name:"EditConventionDialog",props:F({convention:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:F(["update:convention","save"],["update:modelValue"]),setup(g,{emit:a}){const _=g,y=M(),r=Y(),{title:x=""}=_,D=G(g,"modelValue"),u=ae(_,a,void 0,void 0,"convention"),o=v(E(u.value));B(u,()=>{o.value=E(u.value)});const L=v(`${r.GetConventionLogoURL(o.value.ConventionUUID)}?${new Date().getTime()}`),b=v(),w=v(),N=()=>{L.value=URL.createObjectURL(b.value.files[0])},n=()=>{o.value=E(u.value)},d=async()=>{var l;const s=new FormData((l=w.value)==null?void 0:l.$el);if(s.get("Image")&&s.get("Image").size>0)return s.set("ConventionUUID",o.value.ConventionUUID),await r.SaveConventionLogo(s)},c=s=>{d(),y.saveConvention(o.value).then(l=>{l?s&&s("Convention Data Saved").then(()=>{u.value=l,a("save",l)}):s&&s("Failed to save")}).catch(()=>{s("Failed to save")})};return(s,l)=>(i(),f(oe,{modelValue:D.value,"onUpdate:modelValue":l[5]||(l[5]=m=>D.value=m),onReset:n,onSave:c,title:C(x),color:"primary","show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:e(()=>[t(j,{class:"pa-0",fluid:!0},{default:e(()=>[t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(q,{class:"imgLogo mx-auto",src:L.value||""},null,8,["src"])]),_:1})]),_:1}),t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(T,{label:C(k).formLabelName,name:"Name",variant:"outlined",modelValue:o.value.Name,"onUpdate:modelValue":l[0]||(l[0]=m=>o.value.Name=m)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(T,{label:C(k).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:o.value.Description,"onUpdate:modelValue":l[1]||(l[1]=m=>o.value.Description=m)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(T,{label:C(k).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:o.value.DetailLink,"onUpdate:modelValue":l[2]||(l[2]=m=>o.value.DetailLink=m)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(T,{label:C(k).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:o.value.Slug,"onUpdate:modelValue":l[3]||(l[3]=m=>o.value.Slug=m)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(ne,{label:C(k).formConventionVisible,name:"Visible",modelValue:o.value.Visible,"onUpdate:modelValue":l[4]||(l[4]=m=>o.value.Visible=m)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(U,null,{default:e(()=>[t(p,null,{default:e(()=>[t(le,{ref_key:"conventionImageForm",ref:w,enctype:"multipart/form-data"},{default:e(()=>[t(ie,{label:C(k).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:b,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:N},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}});const Ve=P(_e,[["__scopeId","data-v-58a92662"]]),Ce={key:0,class:"text-green"},Ue={key:1,class:"text-red"},De={key:0,class:"text-green"},Ie={key:1,class:"text-red"},ye=$({__name:"ConventionCard",props:F({open:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(g){const a=G(g,"modelValue"),_=Y(),y=J(),r=v(_.GetConventionLogoURL(a.value.ConventionUUID)),x=v(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),D=v(!1),u=v(!1),o=v(se(y,a.value)),L=v(pe(y,a.value)),b=v(ge(y,a.value)),w=()=>{u.value=!1,r.value=`${_.GetConventionLogoURL(a.value.ConventionUUID)}?ts=${Date.now()}`};return(N,n)=>{const d=Z("RouterLink");return i(),f(re,null,{default:e(()=>[t(me,{class:"flex-1-1 align-content-start"},{default:e(()=>[r.value?(i(),f(q,{key:0,src:r.value,title:a.value.Name,class:"logo text-center"},null,8,["src","title"])):V("",!0),a.value.Name?(i(),f(de,{key:1},{default:e(()=>[I(A(a.value.Name),1)]),_:1})):V("",!0),a.value.Description?(i(),f(O,{key:2,class:"pa-0 flex-1-0"},{default:e(()=>[I(A(a.value.Description),1)]),_:1})):V("",!0),t(O,{class:"px-0 pb-0"},{default:e(()=>[I(" Visibility:  "),a.value.Visible?(i(),S("span",Ce,"Visible")):(i(),S("span",Ue,"Hidden"))]),_:1}),t(O,{class:"px-0 pb-0"},{default:e(()=>[I(" Registration:  "),N.open?(i(),S("span",De,"Open")):(i(),S("span",Ie,"Closed"))]),_:1})]),_:1}),t(ve,null,{default:e(()=>[t(U,{"no-gutters":""},{default:e(()=>[o.value?(i(),f(p,{key:0,class:"ma-1"},{default:e(()=>[t(h,{variant:"tonal",color:"primary",onClick:n[0]||(n[0]=c=>u.value=!0),width:"100%"},{default:e(()=>[I("Edit")]),_:1})]),_:1})):V("",!0),V("",!0),o.value?(i(),f(p,{key:2,class:"ma-1"},{default:e(()=>[t(d,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}`},{default:e(()=>[t(h,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[I("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):V("",!0),b.value||L.value?(i(),f(p,{key:3,class:"ma-1"},{default:e(()=>[t(d,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/registrations`},{default:e(()=>[t(h,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[I("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):V("",!0)]),_:1})]),_:1}),u.value?(i(),f(Ve,{key:0,modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=c=>u.value=c),convention:a.value,"onUpdate:convention":n[2]||(n[2]=c=>a.value=c),onSave:w,title:`${a.value.Name} General Settings`},null,8,["modelValue","convention","title"])):V("",!0),D.value?(i(),f(te,{key:1,"confirmation-text":"I UNDERSTAND",message:x.value,title:"Delete Convention",subtitle:"A quick way to make enemies"},null,8,["message"])):V("",!0)]),_:1})}}});const xe=P(ye,[["__scopeId","data-v-956f1716"]]),Le=$({__name:"ConventionsView",emits:["pageTitle"],setup(g,{emit:a}){var N;a("pageTitle","Conventions");const _=M(),y=J(),r=v([]),x=v([]),D=W();let u=((N=D.params.organisation)==null?void 0:N.toString())||"";const o=v();B(D,()=>{var n,d;u!==((n=D.params.organisation)==null?void 0:n.toString())&&(u=((d=D.params.organisation)==null?void 0:d.toString())||"",L())});const L=()=>{u?_.getOrganisation(u).then(n=>{n&&(o.value=n,_.getConventionList(n.OrganisationUUID).then(d=>{d&&(r.value=d)}),b())}).catch(()=>{}):_.getPermissionAccessList(Q.PERMISSION_TYPE_NULL).then(n=>{n&&(r.value=n.Conventions,b())})},b=()=>{_.getAvailableConventionForms(r.value.map(n=>n.ConventionUUID)).then(n=>{x.value=[...x.value,...n]}).catch(n=>{console.error(n)})},w=()=>{var n,d;if(o.value){const c={ID:0,ConventionUUID:ce(),OrganisationID:((n=o.value)==null?void 0:n.ID)||0,OrganisationUUID:((d=o.value)==null?void 0:d.OrganisationUUID)||fe,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};_.saveConvention(c).then(s=>{s&&r.value.push(s)})}};return L(),(n,d)=>(i(),f(j,null,{default:e(()=>[t(U,null,{default:e(()=>[(i(!0),S(ee,null,X(r.value,(c,s)=>(i(),f(p,{key:c.ID,cols:"12",sm:"6",md:"4",lg:"3",class:"d-flex flex-column"},{default:e(()=>{var l,m;return[t(xe,{modelValue:r.value[s],"onUpdate:modelValue":R=>r.value[s]=R,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((l=c.Organisation)==null?void 0:l.Slug)||((m=c.Organisation)==null?void 0:m.OrganisationUUID)||"",open:!!x.value.find(R=>R.ConventionUUID===c.ConventionUUID&&R.Type===C(K).FORM_TYPE_REGISTRATION&&R.State.New)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open"])]}),_:2},1024))),128))]),_:1}),t(U,null,{default:e(()=>[o.value&&C(ue)(C(y),o.value)?(i(),f(p,{key:0,class:"text-right"},{default:e(()=>[t(h,{color:"primary",onClick:w},{default:e(()=>[I("New")]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1}))}});const Xe=P(Le,[["__scopeId","data-v-df1c2d33"]]);export{Xe as default};
