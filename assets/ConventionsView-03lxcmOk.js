import{F as K}from"./form-0fJbSFPv.js";import{P as W}from"./permission-7wLhDNXq.js";import{i as $,M as F,N as q,r as m,k as A,w as j,n as v,q as g,v as e,f as t,C as I,P as B,_ as M,l as X,A as D,y as Z,x as E,D as ee,B as S,V as te,Q as oe,F as ne}from"./index-ueWa9fY2.js";import{u as H}from"./VSpacer-3WWN8GoN.js";import{_ as ae}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-VLS5oLzv.js";import{u as le}from"./useModel-VCQPTgOc.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-wM85SNZe.js";import{s as P}from"./index-OKsbKlsK.js";import{a as z}from"./VContainer-7bP-n_go.js";import{V as N,a as V}from"./VRow-gI5NkL7C.js";import{V as Q}from"./VAvatar-omnRSJ8i.js";import{V as G}from"./VTextField-gsp785fL.js";import{V as se}from"./VTextarea-d40yTLhc.js";import{V as ue}from"./VCheckbox-qSBh-zSq.js";import{V as re}from"./VForm-9ttllz_T.js";import{V as de}from"./VFileInput-7XIcXXIb.js";import{G as T}from"./group-7fhbY6WJ.js";import{C as w}from"./canDo-8w-iwWYc.js";import{C as me}from"./canEditRegistrations-PHKxD3Wu.js";import{G as J}from"./userData-ugm4DX5j.js";import{V as ve,a as fe,b as ce,c as Y,d as pe,e as ge}from"./VCard-7bgZhcUU.js";import{V as h}from"./VBtn-0EIFTArv.js";import{C as Ce}from"./canEditOrganisation-pymJEzkf.js";import{v as Ve}from"./v4-yQnnJER4.js";import{u as _e}from"./nil-rxyd0N8M.js";import"./createSimpleFunctional-bJOGZ1TV.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-UtBavbX4.js";import"./VOverlay-GvGiVKIx.js";import"./forwardRefs-RQsijjFO.js";import"./scopeId-nquqYkDk.js";import"./VDialog-BY2GzUhj.js";import"./VToolbar-_ntA9rD9.js";import"./VCheckboxBtn-UUJPOHs1.js";import"./VChip-C02bF6B9.js";const Ue=(n=void 0,a=void 0)=>n===void 0?!1:a===void 0?w(n,T.GROUP_TYPE_CONVENTION).EditConvention:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditConvention,De=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewRegistration,Ie=$({__name:"EditConventionDialog",props:F({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:F(["update:convention","delete","save"],["update:modelValue"]),setup(n,{emit:a}){const k=n,O=B(),o=H(),{title:p=""}=k,f=a,_=q(n,"modelValue"),C=le(k,f,void 0,void 0,"convention"),i=m(A(C.value));j(C,()=>{i.value=A(C.value)});const U=m(`${o.GetConventionLogoURL(i.value.ConventionUUID)}?${new Date().getTime()}`),L=m(),y=m(),b=()=>{U.value=URL.createObjectURL(L.value.files[0])},x=()=>{f("delete")},u=()=>{i.value=A(C.value)},s=async()=>{var l;const d=new FormData((l=y.value)==null?void 0:l.$el);if(d.get("Image")&&d.get("Image").size>0)return d.set("ConventionUUID",i.value.ConventionUUID),await o.SaveConventionLogo(d)},r=d=>{s(),O.saveConvention(i.value).then(l=>{l?d&&d("Convention Data Saved").then(()=>{C.value=l,f("save",l)}):d&&d("Failed to save")}).catch(()=>{d("Failed to save")})};return(d,l)=>(v(),g(ie,{modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=c=>_.value=c),onDelete:x,onReset:u,onSave:r,title:I(p),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(z,{class:"pa-0",fluid:!0},{default:e(()=>[t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(Q,{class:"imgLogo mx-auto",src:U.value||""},null,8,["src"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(G,{label:I(P).formLabelName,name:"Name",variant:"outlined",modelValue:i.value.Name,"onUpdate:modelValue":l[0]||(l[0]=c=>i.value.Name=c)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(se,{label:I(P).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:i.value.Description,"onUpdate:modelValue":l[1]||(l[1]=c=>i.value.Description=c)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(G,{label:I(P).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:i.value.DetailLink,"onUpdate:modelValue":l[2]||(l[2]=c=>i.value.DetailLink=c)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(G,{label:I(P).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:i.value.Slug,"onUpdate:modelValue":l[3]||(l[3]=c=>i.value.Slug=c)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(ue,{label:I(P).formConventionVisible,name:"Visible",modelValue:i.value.Visible,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value.Visible=c)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(V,null,{default:e(()=>[t(re,{ref_key:"conventionImageForm",ref:y,enctype:"multipart/form-data"},{default:e(()=>[t(de,{label:I(P).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:L,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:b},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Ne=M(Ie,[["__scopeId","data-v-003c7991"]]),Oe=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewProps,Te=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ViewLostAndFound,we=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditProps,Le=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).EditLostAndFound,Ee=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ConfigureProps,ye=(n,a)=>n===void 0?!1:w(n,T.GROUP_TYPE_CONVENTION,a.ConventionUUID,a).ConfigureLostAndFound,xe=["innerHTML"],Re={key:0,class:"text-green"},Pe={key:1,class:"text-red"},ke={key:0,class:"text-green"},be={key:1,class:"text-red"},Se=$({__name:"ConventionCard",props:F({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:F(["delete"],["update:modelValue"]),setup(n,{emit:a}){const k=B(),O=a,o=q(n,"modelValue"),p=H(),f=J(),_=m(p.GetConventionLogoURL(o.value.ConventionUUID)),C=m(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),i=m(!1),U=m(!1),L=m(Ue(f,o.value)),y=m(me(f,o.value)),b=m(De(f,o.value));m(Oe(f,o.value)),m(Te(f,o.value)),m(we(f,o.value)),m(Le(f,o.value)),m(Ee(f,o.value)),m(ye(f,o.value));const x=()=>{U.value=!1,_.value=`${p.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},u=s=>{k.deleteConvention(o.value.ConventionUUID).then(r=>{r?s&&(s("Convention Deleted"),O("delete")):s&&s("Failed to Delete Convention"),setTimeout(()=>{i.value=!1},2e3)}).catch(()=>{s&&(s("Failed to Delete Organisation"),i.value=!1)})};return(s,r)=>{const d=X("RouterLink");return v(),g(ge,null,{default:e(()=>[t(ve,{class:"flex-1-1 align-content-start"},{default:e(()=>[_.value?(v(),g(Q,{key:0,src:_.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),o.value.Name?(v(),g(fe,{key:1},{default:e(()=>[E(Z(o.value.Name),1)]),_:1})):D("",!0),o.value.Description?(v(),g(ce,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ee("div",{innerHTML:o.value.Description},null,8,xe)]),_:1})):D("",!0),t(Y,{class:"px-0 pb-0"},{default:e(()=>[E(" Visibility:  "),o.value.Visible?(v(),S("span",Re,"Visible")):(v(),S("span",Pe,"Hidden"))]),_:1}),t(Y,{class:"px-0 pb-0"},{default:e(()=>[E(" Registration:  "),s.open?(v(),S("span",ke,"Open")):(v(),S("span",be,"Closed"))]),_:1})]),_:1}),t(pe,null,{default:e(()=>[t(N,{"no-gutters":""},{default:e(()=>[L.value?(v(),g(V,{key:0,class:"ma-1"},{default:e(()=>[t(h,{variant:"tonal",color:"primary",onClick:r[0]||(r[0]=l=>U.value=!0),width:"100%"},{default:e(()=>[E("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),L.value?(v(),g(V,{key:2,class:"ma-1"},{default:e(()=>[t(d,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t(h,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[E("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),b.value||y.value?(v(),g(V,{key:3,class:"ma-1"},{default:e(()=>[t(d,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t(h,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[E("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),D("",!0)]),_:1})]),_:1}),U.value?(v(),g(Ne,{key:0,modelValue:U.value,"onUpdate:modelValue":r[1]||(r[1]=l=>U.value=l),convention:o.value,"onUpdate:convention":r[2]||(r[2]=l=>o.value=l),onDelete:r[3]||(r[3]=l=>i.value=!0),onSave:x,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),i.value?(v(),g(ae,{key:1,modelValue:i.value,"onUpdate:modelValue":r[4]||(r[4]=l=>i.value=l),"confirmation-text":"I UNDERSTAND",message:C.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:u},null,8,["modelValue","message"])):D("",!0)]),_:1})}}}),he=M(Se,[["__scopeId","data-v-00491164"]]),Fe=$({__name:"ConventionsView",emits:["pageTitle"],setup(n,{emit:a}){var x;a("pageTitle","Conventions");const O=B(),o=J(),p=m([]),f=m([]),_=te();let C=((x=_.params.organisation)==null?void 0:x.toString())||"";const i=m();j(_,()=>{var u,s;C!==((u=_.params.organisation)==null?void 0:u.toString())&&(C=((s=_.params.organisation)==null?void 0:s.toString())||"",U())});const U=()=>{C?O.getOrganisation(C).then(u=>{u&&(i.value=u,O.getConventionList(u.OrganisationUUID).then(s=>{s&&(p.value=s,L())}))}).catch(()=>{}):O.getPermissionAccessList(W.PERMISSION_TYPE_NULL).then(u=>{u&&(p.value=u.Conventions,L())})},L=()=>{p.value.forEach(u=>{O.getConventionForms(u.ConventionUUID).then(s=>{s&&(f.value=[...f.value,...s])}).catch(s=>{console.error(s)})})},y=()=>{var u,s;if(i.value){const r={ID:0,ConventionUUID:Ve(),OrganisationID:((u=i.value)==null?void 0:u.ID)||0,OrganisationUUID:((s=i.value)==null?void 0:s.OrganisationUUID)||_e,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};O.saveConvention(r).then(d=>{d&&p.value.push(d)})}},b=u=>{p.value.splice(u,1)};return U(),(u,s)=>(v(),g(z,null,{default:e(()=>[t(N,{class:"justify-center"},{default:e(()=>[(v(!0),S(ne,null,oe(p.value,(r,d)=>(v(),g(V,{key:r.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var l,c;return[t(he,{modelValue:p.value[d],"onUpdate:modelValue":R=>p.value[d]=R,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((l=r.Organisation)==null?void 0:l.Slug)||((c=r.Organisation)==null?void 0:c.OrganisationUUID)||"",open:!!f.value.find(R=>R.ConventionUUID===r.ConventionUUID&&R.Type===I(K).FORM_TYPE_REGISTRATION&&R.State.New),onDelete:R=>b(d)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(N,null,{default:e(()=>[i.value&&I(Ce)(I(o),i.value)?(v(),g(V,{key:0,class:"text-right"},{default:e(()=>[t(h,{color:"primary",onClick:y},{default:e(()=>[E("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}}),Vt=M(Fe,[["__scopeId","data-v-c7b95705"]]);export{Vt as default};
