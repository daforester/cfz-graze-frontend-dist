import{p as we,n as $e,e as X,t as z,c as Ye,G as Be,v as r,H as p,x as Ie,I as Z,a1 as ye,a2 as Ge,r as E,a3 as Te,K as n,L as k,M as S,$ as fe,S as Q,a8 as Oe,Z as V,Q as F,R as _,O as b,_ as he,U as P,N as B,a4 as He,a0 as qe,w as xe}from"./index-0763f85f.js";import{a as je,F as te}from"./form-e2a93b7c.js";import{_ as Je}from"./ModelDialog.vue_vue_type_script_setup_true_lang-b4808fd1.js";import{m as Ke,j as ze,k as We,l as Qe,n as Xe,o as Ze,p as et,u as tt,q as at,r as lt,s as ot,t as nt,v as it,w as st,x as ut,y as Ce,z as ge,A as Me,_ as Le,f as rt,g as dt,h as mt,i as _t,d as Ut}from"./VWindowItem-d5184ada.js";import{e as At,T as Tt,d as ct}from"./FormRenderer.vue_vue_type_style_index_0_lang-40d6b226.js";import{a as Ae,V as W}from"./VRow-615fcf64.js";import{V as Re}from"./VTextField-34d35d71.js";import{V as ee}from"./copyToClipboard-b7517336.js";import{u as St,j as De}from"./VContainer-8dba7b61.js";import{v as oe}from"./v4-a960c1f4.js";import{S as Et}from"./submission-56c4c4f1.js";import{V as pe}from"./VBtn-6482839e.js";import{V as vt}from"./VAvatar-900f64d1.js";import{c as It,e as Ne}from"./VCard-dae25dea.js";import{V as Rt}from"./VDialog-c6a4433b.js";import{s as Dt}from"./sortSubmissions-ed9e4490.js";import{u as Ot}from"./useStoreAPI-80c70d2c.js";import{u as pt,V as ft}from"./VToolbar-2098b57a.js";import{V as yt}from"./VSpacer-1491010a.js";import{V as ke}from"./VTable-549cf978.js";import"./VChip-a24b5795.js";import"./scopeId-1820581b.js";import"./VCheckbox-71d9be25.js";import"./VToolbarItems-ce6b0751.js";import"./VList-87ac8eea.js";import"./VDivider-2ee7dc1b.js";import"./index-71069b21.js";import"./VTextarea-f99d2661.js";import"./userData-7015bd9c.js";import"./VForm-75a23f32.js";var be=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(be||{});const Ct=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ne=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(ne||{});const gt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Y=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Y||{});const Mt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var O=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(O||{});const Lt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],kt=we({itemsLength:{type:[Number,String],required:!0},...Ke(),...ze(),...We()},"VDataTableServer"),ht=$e()({name:"VDataTableServer",props:kt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,L)=>!0},setup(e,L){let{emit:d,slots:l}=L;const{groupBy:i}=Qe(e),{sortBy:u,multiSort:v,mustSort:T}=Xe(e),{page:R,itemsPerPage:g}=Ze(e),t=X(()=>parseInt(e.itemsLength,10)),{columns:m,headers:o}=et(e,{groupBy:i,showSelect:z(e,"showSelect"),showExpand:z(e,"showExpand")}),{items:f}=tt(e,m),{toggleSort:c}=at({sortBy:u,multiSort:v,mustSort:T,page:R}),{opened:H,isGroupOpen:h,toggleGroup:j,extractRows:$}=lt({groupBy:i,sortBy:u}),{pageCount:ie,setItemsPerPage:se}=ot({page:R,itemsPerPage:g,itemsLength:t}),{flatItems:ae}=nt(f,i,H),{isSelected:ue,select:re,selectAll:G,toggleSelect:ce,someSelected:de,allSelected:me}=it(e,{allItems:f,currentPage:f}),{isExpanded:Se,toggleExpand:Ee}=st(e),_e=X(()=>$(f.value));ut({page:R,itemsPerPage:g,sortBy:u,groupBy:i,search:z(e,"search")}),Ye("v-data-table",{toggleSort:c,sortBy:u}),Be({VDataTableRows:{hideNoData:z(e,"hideNoData"),noDataText:z(e,"noDataText"),loading:z(e,"loading"),loadingText:z(e,"loadingText")}});const a=X(()=>({page:R.value,itemsPerPage:g.value,sortBy:u.value,pageCount:ie.value,toggleSort:c,setItemsPerPage:se,someSelected:de.value,allSelected:me.value,isSelected:ue,select:re,selectAll:G,toggleSelect:ce,isExpanded:Se,toggleExpand:Ee,isGroupOpen:h,toggleGroup:j,items:_e.value,groupedItems:ae.value,columns:m.value,headers:o.value}));St(()=>{const[U]=Ce.filterProps(e),[s]=ge.filterProps(e),[A]=Me.filterProps(e),[w]=ke.filterProps(e);return r(ke,Ie({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},w),{top:()=>{var y;return(y=l.top)==null?void 0:y.call(l,a.value)},default:()=>{var y,le,C,x;return l.default?l.default(a.value):r(p,null,[(y=l.colgroup)==null?void 0:y.call(l,a.value),r("thead",{class:"v-data-table__thead",role:"rowgroup"},[r(ge,Ie(s,{sticky:e.fixedHeader}),l)]),(le=l.thead)==null?void 0:le.call(l,a.value),r("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(a.value):r(Me,Ie(A,{items:ae.value}),l)]),(C=l.tbody)==null?void 0:C.call(l,a.value),(x=l.tfoot)==null?void 0:x.call(l,a.value)])},bottom:()=>l.bottom?l.bottom(a.value):r(Ce,U,{prepend:l["footer.prepend"]})})})}}),Nt=Z({__name:"EditAdminLayout",props:ye({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:ye(["save"],["update:modelValue"]),setup(e,{emit:L}){const d=Ge(e,"modelValue"),l=E(Te(e.layout)),i=E([]),u=fe(),v=({callback:t})=>{const m=()=>{t&&t("Failed to Save Layout")},o=()=>{t&&t("Layout Saved")};u.saveAdminLayout(l.value).then(f=>{f?(o(),L("save",f)):m()}).catch(()=>{m()})},T=()=>({ID:0,LayoutPanelUUID:oe(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:te.FORM_TYPE_NIL}),R=t=>()=>({ID:0,LayoutItemUUID:oe(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:ne.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),g=t=>{const m=i.value.find(o=>o.value===t.SectionFieldUUID);m&&(t.SectionFieldID=m.object.ID,t.SectionField=m.object)};return u.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(m=>m.Sections.forEach(o=>o.Fields&&i.value.push(...o.Fields.map(f=>{var H;return{title:`${m.Name} - ${o.Name} - ${(H=f.Field)==null?void 0:H.Name}`,value:f.SectionFieldUUID,object:f}})))),i.value.sort(At("title"))}),(t,m)=>(n(),k(Je,{modelValue:d.value,"onUpdate:modelValue":m[3]||(m[3]=o=>d.value=o),onSave:v,title:t.title,color:"primary"},{default:S(()=>[r(De,{class:"px-0 mx-0",fluid:!0},{default:S(()=>[r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(Re,{modelValue:l.value.Name,"onUpdate:modelValue":m[0]||(m[0]=o=>l.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(W,{cols:"12",sm:"6"},{default:S(()=>[r(ee,{modelValue:l.value.Type,"onUpdate:modelValue":m[1]||(m[1]=o=>l.value.Type=o),label:"Layout Type",items:Q(Ct),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),r(Le,{modelValue:l.value.Panels,"onUpdate:modelValue":m[2]||(m[2]=o=>l.value.Panels=o),"new-item":T,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Oe({_:2},[V(l.value.Panels,(o,f)=>({name:`panel_${f}`,fn:S(()=>[r(De,{class:"px-0 mx-0",fluid:!0},{default:S(()=>[r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(Re,{modelValue:o.Name,"onUpdate:modelValue":c=>o.Name=c,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(W,{cols:"12",sm:"6"},{default:S(()=>[r(ee,{modelValue:o.RequiredFormType,"onUpdate:modelValue":c=>o.RequiredFormType=c,items:Q(je),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),r(Le,{modelValue:o.Items,"onUpdate:modelValue":c=>o.Items=c,"new-item":R(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Oe({_:2},[V(o.Items,(c,H)=>({name:`item_${H}`,fn:S(()=>[r(De,{class:"px-0 mx-0",fluid:!0},{default:S(()=>[r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(Re,{modelValue:c.Label,"onUpdate:modelValue":h=>c.Label=h,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),r(Ae,null,{default:S(()=>[r(W,{cols:"12",sm:"6"},{default:S(()=>[r(ee,{modelValue:c.SourceType,"onUpdate:modelValue":h=>c.SourceType=h,label:"Source Type",items:Q(gt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),r(W,{cols:"12",sm:"6"},{default:S(()=>[c.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),k(ee,{key:0,modelValue:c.SectionFieldUUID,"onUpdate:modelValue":h=>c.SectionFieldUUID=h,label:"Form Data",items:i.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:h=>g(c)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):c.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),k(ee,{key:1,modelValue:c.MetaField,"onUpdate:modelValue":h=>c.MetaField=h,label:"Miscellaneous Data",items:Q(Mt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):c.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),k(ee,{key:2,modelValue:c.UserField,"onUpdate:modelValue":h=>c.UserField=h,label:"User Profile Data",items:Q(Lt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):F("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),bt={key:0,class:"accommodationList"},Vt=Z({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return[];const d=JSON.parse(e.value),l=e.accommodations.filter(i=>d.includes(i.AccommodationUUID)).sort((i,u)=>{const v=d.findIndex(R=>R===i.AccommodationUUID),T=d.findIndex(R=>R===u.AccommodationUUID);return v>T?1:-1});return Te(l)});return(d,l)=>d.value?(n(),_("ol",bt,[(n(!0),_(p,null,V(L.value,i=>(n(),_("li",{key:i.AccommodationUUID},b(i.Name),1))),128))])):F("",!0)}});const Ft=he(Vt,[["__scopeId","data-v-1ba5f67a"]]),Pt={key:0,class:"addonList"},wt={key:0},$t={key:0},Yt=Z({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return;const d=JSON.parse(e.value),l=Object.keys(d),i=Te(e.extras);return i.forEach(u=>{u.Options=u.Options.filter(v=>l.includes(v.OptionUUID)?(v.Choices=v.Choices.filter(T=>T.TagUUID===d[v.OptionUUID].choiceId),d[v.OptionUUID].checked):!1)}),i.filter(u=>u.Options.length>0),i});return(d,l)=>d.value?(n(),_("ul",Pt,[(n(!0),_(p,null,V(L.value,i=>(n(),_(p,{key:i.ExtraUUID},[i.Options.length?(n(),_("li",wt,[P("strong",null,b(i.Name),1),P("ul",null,[(n(!0),_(p,null,V(i.Options,u=>(n(),_("li",{key:u.OptionUUID},[B(b(u.Name)+" ",1),u.Choices.length==1?(n(),_("small",$t,"("+b(u.Choices[0].Title)+")",1)):F("",!0)]))),128))])])):F("",!0)],64))),128))])):F("",!0)}});const Bt=he(Yt,[["__scopeId","data-v-002a6d6d"]]),Gt={key:0},Ht=Z({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return;const d=JSON.parse(e.value);return Object.entries(d).filter(([,l])=>l).map(([l,i])=>e.interests.find(u=>u.InterestUUID===l)).filter(l=>l!==void 0)});return(d,l)=>d.value?(n(),_("ul",Gt,[(n(!0),_(p,null,V(L.value,i=>(n(),_("li",{key:i.InterestUUID},b(i.Name),1))),128))])):F("",!0)}}),qt=P("br",null,null,-1),xt=P("small",null,"Options:",-1),jt=P("br",null,null,-1),Jt=P("small",null,"Addons:",-1),Kt=Z({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const L=X(()=>{if(!e.value)return;let d={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{d=JSON.parse(e.value),"ticket"in d&&(d.Ticket=d.ticket),"addonsChecked"in d&&(d.AddonsChecked=d.addonsChecked),"componentsChecked"in d&&(d.ComponentsChecked=d.componentsChecked)}catch{}return d.Ticket.filter(l=>{const i=e.tickets.find(u=>u.TicketUUID===l);return!(!i||i.Type!==Tt.TICKET_TYPE_TICKET)}).map(l=>{const i=e.tickets.find(v=>v.TicketUUID===l),u=Te(i);return u.TicketComponents=i.TicketComponents.filter(v=>d.ComponentsChecked.includes(v.TicketUUID)),u.AddonTickets=i.AddonTickets.filter(v=>d.AddonsChecked.includes(v.TicketUUID)),u})});return(d,l)=>d.value?(n(!0),_(p,{key:0},V(L.value,i=>(n(),_("div",{key:i.TicketUUID},[P("strong",null,b(i.Name),1),i.TicketComponents.length>0?(n(),_(p,{key:0},[qt,xt,B("  "),(n(!0),_(p,null,V(i.TicketComponents,u=>(n(),_(p,{key:u.TicketUUID},[P("small",null,b(u.Name),1),B("  ")],64))),128))],64)):F("",!0),i.AddonTickets.length>0?(n(),_(p,{key:1},[jt,Jt,B("  "),(n(!0),_(p,null,V(i.AddonTickets,u=>(n(),_("small",{key:u.TicketUUID},[B("("),P("em",null,b(u.Name),1),B(")")]))),128))],64)):F("",!0)]))),128)):F("",!0)}}),zt={key:0},Wt={key:0},Qt=P("strong",null,"Total:",-1),Xt=Z({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:L}){const d=fe(),l=E(),i=E(),u=E(),v=E(),T=E(!1),R=t=>{console.log(t)},g=(t,m,o)=>{i.value=t,d.getRegistrationGroup(o.RegistrationUUID||"").then(f=>{u.value=f,l.value=m,v.value=o,T.value=!0})};return(t,m)=>(n(),_(p,null,[t.header.key=="actions"?(n(),k(pe,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:m[0]||(m[0]=o=>R(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0?(n(),k(Ft,{key:1,value:t.item.raw[t.header.key],accommodations:t.accommodations},null,8,["value","accommodations"])):t.header.type==="EXTRAS"&&t.extras.length>0?(n(),k(Bt,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(n(),k(Ht,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(n(),k(Kt,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(n(!0),_(p,{key:5},V(t.item.raw[t.header.key],o=>(n(),_("ul",{key:o.Heading},[P("li",null,[P("strong",null,b(o.Heading)+":",1),B(" "+b(Q(Et)(o.Submission.Status))+" ",1),r(pe,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>g(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(n(),k(vt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(n(),_(p,{key:7},[t.item.raw[t.header.key].length===1?(n(),_("em",zt," Not in a group ")):(n(),_(p,{key:1},[P("ul",null,[(n(!0),_(p,null,V(t.item.raw[t.header.key],o=>(n(),_("li",{key:o.UUID,class:"ml-0"},[B(b(o.Name)+" ",1),o.IsLeader?(n(),_("strong",Wt,"(Leader)")):F("",!0)]))),128))]),Qt,B(" "+b(t.item.raw[t.header.key].length),1)],64))],64)):(n(),_(p,{key:8},[B(b(t.item.raw[t.header.key]),1)],64)),T.value&&v.value&&l.value?(n(),k(Rt,{key:9,modelValue:T.value,"onUpdate:modelValue":m[3]||(m[3]=o=>T.value=o),scrollable:!0},{default:S(()=>[r(Ne,{class:"bg-red-darken-4"},{default:S(()=>[r(It,null,{default:S(()=>[r(ct,{modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=o=>l.value=o),admin:!0,convention:t.convention,data:v.value,editable:!0,"registration-group":u.value,onClose:m[2]||(m[2]=o=>{T.value=!1,L("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):F("",!0)],64))}}),Ma=Z({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:L}){var _e;const d=Ot();L("pageTitle","Registration Manager");const l=He(),i=qe(),u=E(!0);let v=((_e=l.params.convention)==null?void 0:_e.toString())||"";const T=E({ID:0,ConventionUUID:oe(),OrganisationID:0,OrganisationUUID:pt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),R=fe(),g=E({ID:0,AdminLayoutUUID:oe(),ConventionID:T.value.ID,ConventionUUID:T.value.ConventionUUID,Name:"Registration Table",Type:be.ADMIN_LAYOUT_TABLE,Panels:[]}),t=E([]),m=E([]),o=E([]),f=E(1),c=E(10),H=E([]),h=E(0),j=E(!1),$=E(""),ie=E([]),se=E([]),ae=E([]),ue=E([]),re=E([]),G=E(0);xe(G,a=>{a===7&&me()});const ce=()=>{t.value=[],m.value=[],o.value=[];try{R.getConventionAdminLayoutByName(T.value.ConventionUUID,"Registration Table").then(a=>{G.value+=1,a?g.value=a:(g.value.ConventionID=T.value.ID,g.value.ConventionUUID=T.value.ConventionUUID)})}catch{g.value.ConventionID=T.value.ID,g.value.ConventionUUID=T.value.ConventionUUID}try{R.getConventionForms(T.value.ConventionUUID).then(a=>{G.value+=1,a&&(t.value=a)})}catch{}try{R.getConventionAccommodation(T.value.ConventionUUID).then(a=>{G.value+=1,a&&(ie.value=a)})}catch{}try{R.getConventionVenues(T.value.ConventionUUID).then(a=>{G.value+=1,a&&(re.value=a)})}catch{}try{R.getConventionExtras(T.value.ConventionUUID).then(a=>{G.value+=1,a&&(se.value=a)})}catch{}try{R.getConventionInterests(T.value.ConventionUUID).then(a=>{G.value+=1,a&&(ae.value=a)})}catch{}try{R.getConventionTickets(T.value.ConventionUUID).then(a=>{G.value+=1,a&&(ue.value=a)})}catch{}},de=({page:a,itemsPerPage:U,sortBy:s})=>{f.value=a,H.value=s;const A=o.value.find(C=>C.uuid==$.value),w=A==null?void 0:A.layout.Items;let y="",le="";if(s&&w&&s.length>=1){const C=w.find(x=>x.LayoutItemUUID==s[0].key);switch(le=s[0].order,C==null?void 0:C.MetaField){case Y.META_DATA_SOURCE_REGISTRATION_REFERENCE:y="reference";break;case Y.META_DATA_SOURCE_SUBMISSION_DATE:y="created";break;case Y.META_DATA_SOURCE_SUBMISSION_STATUS:y="submission.status";break}switch(C==null?void 0:C.UserField){case O.USER_DATA_SOURCE_DISPLAY_NAME:y="user.display_name";break;case O.USER_DATA_SOURCE_EMAIL:y="user.email";break;case O.USER_DATA_SOURCE_FIRST_NAME:y="user.firstname";break;case O.USER_DATA_SOURCE_HANDLE:y="user.handle";break;case O.USER_DATA_SOURCE_LAST_NAME:y="user.lastname";break}}try{const C={Direction:le,Limit:U,Offset:(a-1)*U,Order:y};(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_ACCOMMODATION&&(C.Accommodation=!0),(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_BADGE&&(C.Badge=!0),(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_DEALER&&(C.Dealer=!0),(A==null?void 0:A.layout.RequiredFormType)===te.FORM_TYPE_REGISTRATION&&(C.Registration=!0),R.searchConventionRegistrations(T.value.ConventionUUID,C).then(x=>{x&&(h.value=x.Total,m.value=x.Registrations,o.value.forEach(ve=>{const Ve=ve.layout;ve.items=m.value.map(M=>{const N={};return ve.headers.forEach(Fe=>{const I=Ve.Items.find(J=>J.LayoutItemUUID===Fe.key);if(I){if(I.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&I.SectionField)M.Submissions.forEach(J=>{const q=J.Data.find(Ue=>Ue.SectionFieldUUID===I.SectionFieldUUID);if(q){N[I.LayoutItemUUID]=q.Data;return}});else if(I.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&I.UserField)switch(I.UserField){case O.USER_DATA_SOURCE_AVATAR:N[I.LayoutItemUUID]=d.GetProfileImageURL(M.UserUUID);break;case O.USER_DATA_SOURCE_DISPLAY_NAME:N[I.LayoutItemUUID]=M.User.DisplayName;break;case O.USER_DATA_SOURCE_EMAIL:N[I.LayoutItemUUID]=M.User.Additional.Email;break;case O.USER_DATA_SOURCE_HANDLE:N[I.LayoutItemUUID]=M.User.Handle;break;case O.USER_DATA_SOURCE_DATE_OF_BIRTH:N[I.LayoutItemUUID]=M.User.Additional.DOB;break;case O.USER_DATA_SOURCE_FIRST_NAME:N[I.LayoutItemUUID]=M.User.Additional.FirstName;break;case O.USER_DATA_SOURCE_LAST_NAME:N[I.LayoutItemUUID]=M.User.Additional.LastName;break;case O.USER_DATA_SOURCE_TELEGRAM:N[I.LayoutItemUUID]="";break}else if(I.SourceType==="LAYOUT_ITEM_SOURCE_META"&&I.MetaField){const J=[];let q;const Ue=M.Submissions.find(D=>{var K;return((K=D.Form)==null?void 0:K.Type)===te.FORM_TYPE_REGISTRATION});switch(I.MetaField){case Y.META_DATA_SOURCE_REGISTRATION_GROUP:M.Leader?q=M:q=M.Primary,J.push({Name:q.User.DisplayName,UUID:q.UserUUID,IsLeader:!0,Reference:q.Reference}),J.push(...q.Members.map(D=>({Name:D.User.DisplayName,UUID:D.UserUUID,IsLeader:!1,Reference:D.Reference}))),N[I.LayoutItemUUID]=J;break;case Y.META_DATA_SOURCE_REGISTRATION_REFERENCE:N[I.LayoutItemUUID]=M.Reference;break;case Y.META_DATA_SOURCE_SUBMISSION_DATE:if(Ue){const D=new Date(Ue.CreatedAt||"");N[I.LayoutItemUUID]=`${D.getFullYear()}-${D.getMonth().toString().padStart(2,"0")}-${D.getDate().toString().padStart(2,"0")} ${D.getHours().toString().padStart(2,"0")}:${D.getMinutes().toString().padStart(2,"0")}:${D.getSeconds()}`}else{const D=new Date(M.CreatedAt||"");N[I.LayoutItemUUID]=`${D.getFullYear()}-${D.getMonth().toString().padStart(2,"0")}-${D.getDate().toString().padStart(2,"0")} ${D.getHours().toString().padStart(2,"0")}:${D.getMinutes().toString().padStart(2,"0")}:${D.getSeconds()}`}break;case Y.META_DATA_SOURCE_SUBMISSION_STATUS:Dt(M.Submissions,t.value),N[I.LayoutItemUUID]=M.Submissions.map(D=>{const K=t.value.find(Pe=>Pe.FormUUID===D.FormUUID);return{Heading:K==null?void 0:K.Heading,Form:K,Submission:D,Registration:M}});break}}}}),N})}),u.value=!1)})}catch{}},me=()=>{g.value.Panels.forEach(a=>{a.Items.forEach(U=>{(U.SectionField==null||U.SectionField.Field==null)&&t.value.find(s=>{s.Sections.find(A=>{if(A.Fields){const w=A.Fields.find(y=>y.SectionFieldUUID===U.SectionFieldUUID);if(w)return U.SectionField=w,!0}})})})}),g.value.Panels.length>0&&(o.value=[],g.value.Panels.forEach(a=>{const U={uuid:oe(),order:a.Order,name:a.Name,headers:[],items:[],layout:a};a.Items.sort((s,A)=>s.Order>A.Order?1:s.Order==A.Order?0:-1),U.headers=a.Items.map(s=>{var A,w;return{key:s.LayoutItemUUID,title:s.Label||((w=(A=s.SectionField)==null?void 0:A.Field)==null?void 0:w.Label)||"",align:s.Align==="end"?"end":"start",sortable:Ee(s),type:Se(s)}}),o.value.push(U)})),($.value==null||$.value=="")&&o.value.length>0&&($.value=o.value[0].uuid)};v?R.getConvention(v).then(a=>{a&&(T.value=a,ce())}).catch(()=>{i.push("/")}):i.push("/");const Se=a=>{var U,s;if(a.SourceType===ne.LAYOUT_ITEM_SOURCE_META)return`${a.SourceType}.${a.MetaField}`;if(a.SourceType===ne.LAYOUT_ITEM_SOURCE_FORM)return(s=(U=a.SectionField)==null?void 0:U.Field)==null?void 0:s.Type;if(a.SourceType===ne.LAYOUT_ITEM_SOURCE_USER)return`${a.SourceType}.${a.UserField}`},Ee=a=>{const U=[Y.META_DATA_SOURCE_REGISTRATION_REFERENCE,Y.META_DATA_SOURCE_SUBMISSION_DATE,Y.META_DATA_SOURCE_SUBMISSION_STATUS],s=[O.USER_DATA_SOURCE_DISPLAY_NAME,O.USER_DATA_SOURCE_EMAIL,O.USER_DATA_SOURCE_HANDLE,O.USER_DATA_SOURCE_DATE_OF_BIRTH,O.USER_DATA_SOURCE_FIRST_NAME,O.USER_DATA_SOURCE_LAST_NAME];return U.includes(a.MetaField)||s.includes(a.UserField)};return(a,U)=>(n(),k(Ut,null,{default:S(()=>[r(ft,{color:"blue-darken-4"},{default:S(()=>[r(rt,{modelValue:$.value,"onUpdate:modelValue":U[0]||(U[0]=s=>$.value=s),"show-arrows":""},{default:S(()=>[(n(!0),_(p,null,V(o.value,s=>(n(),k(dt,{key:s.uuid,value:s.uuid},{default:S(()=>[B(b(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(yt),r(pe,{icon:"mdi:mdi-cog-outline",onClick:U[1]||(U[1]=s=>j.value=!0)})]),_:1}),r(_t,{modelValue:$.value,"onUpdate:modelValue":U[4]||(U[4]=s=>$.value=s)},{default:S(()=>[(n(!0),_(p,null,V(o.value,s=>(n(),k(mt,{key:s.uuid,value:s.uuid},{default:S(()=>[s.uuid===$.value?(n(),k(Ne,{key:0,class:"pa-2"},{default:S(()=>[r(Q(ht),{"items-per-page":c.value,"onUpdate:itemsPerPage":U[3]||(U[3]=A=>c.value=A),headers:s.headers,"items-length":h.value,items:s.items,"item-value":"LayoutItemUUID",loading:u.value,"onUpdate:options":de},Oe({_:2},[V(s.headers,A=>({name:`item.${A.key}`,fn:S(({item:w})=>[r(Xt,{header:A,item:w,accommodations:ie.value,convention:T.value,extras:se.value,interests:ae.value,tickets:ue.value,venues:re.value,onReload:U[2]||(U[2]=y=>de({page:f.value,itemsPerPage:c.value,sortBy:H.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):F("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),j.value?(n(),k(Nt,{key:0,title:"Edit Layout",modelValue:j.value,"onUpdate:modelValue":U[5]||(U[5]=s=>j.value=s),layout:g.value,onSave:U[6]||(U[6]=s=>{j.value=!1,me()})},null,8,["modelValue","layout"])):F("",!0)]),_:1}))}});export{Ma as default};
