import{p as qe,n as je,e as ee,t as Z,c as Je,G as Ke,v as n,H as f,x as fe,I as te,a1 as be,a2 as We,r as I,a3 as Oe,K as i,L as h,M as d,$ as ge,S as x,a8 as ye,Z as G,Q as w,R as E,N as P,O as N,_ as we,U as Y,a4 as ze,a0 as Qe,w as Xe}from"./index-b8bd8be7.js";import{e as Ze,T as xe,d as et,c as tt}from"./FormRenderer.vue_vue_type_style_index_0_lang-5a97596a.js";import{a as at,F as W}from"./form-e2a93b7c.js";import{_ as lt}from"./ModelDialog.vue_vue_type_script_setup_true_lang-e55e408d.js";import{m as ot,k as nt,l as it,n as st,o as ut,p as rt,q as dt,u as mt,r as _t,s as At,t as Ut,v as Tt,w as Et,x as St,y as ct,z as Ne,A as he,B as Ve,_ as Rt,f as Pe,g as vt,h as It,i as Dt,j as Ot,d as pt}from"./VWindowItem-8ff25e36.js";import{a as oe,V as J}from"./VRow-637c8545.js";import{V as ue}from"./VTextField-14359e9c.js";import{V as le}from"./copyToClipboard-01c73fe4.js";import{u as Ct,j as Ie}from"./VContainer-212d8720.js";import{v as re}from"./v4-a960c1f4.js";import{V as De}from"./VBtn-726f63bb.js";import{e as Fe,b as Mt,V as ft,c as Be}from"./VCard-0a570ca0.js";import{V as Ye}from"./VDialog-ad77bf44.js";import{S as yt}from"./submission-56c4c4f1.js";import{V as gt}from"./VAvatar-b66ae2e2.js";import{s as ve}from"./sortSubmissions-ed9e4490.js";import{u as Ft}from"./useStoreAPI-c8b5cdf7.js";import{u as Lt,V as kt}from"./VToolbar-cdd1bcce.js";import{V as bt}from"./VSpacer-e9a1fddd.js";import{V as Ge}from"./VTable-7ea4c0f2.js";import"./VCheckbox-3b317f11.js";import"./index-26b71cef.js";import"./VList-50c05e4b.js";import"./VDivider-995bc94d.js";import"./VChip-8862e246.js";import"./scopeId-5fc85ac0.js";import"./VTextarea-d28ac8c4.js";import"./userData-bdd28cca.js";import"./VForm-68e07aae.js";import"./VToolbarItems-ec400096.js";var $e=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))($e||{});const Nt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var de=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(de||{});const ht=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var M=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(M||{});const Vt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var y=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(y||{});const Pt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Gt=qe({itemsLength:{type:[Number,String],required:!0},...ot(),...nt(),...it()},"VDataTableServer"),wt=je()({name:"VDataTableServer",props:Gt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,k)=>!0},setup(e,k){let{emit:T,slots:a}=k;const{groupBy:s}=st(e),{sortBy:r,multiSort:O,mustSort:S}=ut(e),{page:c,itemsPerPage:C}=rt(e),t=ee(()=>parseInt(e.itemsLength,10)),{columns:U,headers:l}=dt(e,{groupBy:s,showSelect:Z(e,"showSelect"),showExpand:Z(e,"showExpand")}),{items:g}=mt(e,U),{toggleSort:v}=_t({sortBy:r,multiSort:O,mustSort:S,page:c}),{opened:K,isGroupOpen:V,toggleGroup:z,extractRows:$}=At({groupBy:s,sortBy:r}),{pageCount:ne,setItemsPerPage:ie}=Ut({page:c,itemsPerPage:C,itemsLength:t}),{flatItems:ae}=Tt(g,s,K),{isSelected:me,select:_e,selectAll:Ae,toggleSelect:Ue,someSelected:Te,allSelected:H}=Et(e,{allItems:g,currentPage:g}),{isExpanded:pe,toggleExpand:Ee}=St(e),Se=ee(()=>$(g.value));ct({page:c,itemsPerPage:C,sortBy:r,groupBy:s,search:Z(e,"search")}),Je("v-data-table",{toggleSort:v,sortBy:r}),Ke({VDataTableRows:{hideNoData:Z(e,"hideNoData"),noDataText:Z(e,"noDataText"),loading:Z(e,"loading"),loadingText:Z(e,"loadingText")}});const q=ee(()=>({page:c.value,itemsPerPage:C.value,sortBy:r.value,pageCount:ne.value,toggleSort:v,setItemsPerPage:ie,someSelected:Te.value,allSelected:H.value,isSelected:me,select:_e,selectAll:Ae,toggleSelect:Ue,isExpanded:pe,toggleExpand:Ee,isGroupOpen:V,toggleGroup:z,items:Se.value,groupedItems:ae.value,columns:U.value,headers:l.value}));Ct(()=>{const[Ce]=Ne.filterProps(e),[ce]=he.filterProps(e),[o]=Ve.filterProps(e),[m]=Ge.filterProps(e);return n(Ge,fe({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},m),{top:()=>{var u;return(u=a.top)==null?void 0:u.call(a,q.value)},default:()=>{var u,_,B,F;return a.default?a.default(q.value):n(f,null,[(u=a.colgroup)==null?void 0:u.call(a,q.value),n("thead",{class:"v-data-table__thead",role:"rowgroup"},[n(he,fe(ce,{sticky:e.fixedHeader}),a)]),(_=a.thead)==null?void 0:_.call(a,q.value),n("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(q.value):n(Ve,fe(o,{items:ae.value}),a)]),(B=a.tbody)==null?void 0:B.call(a,q.value),(F=a.tfoot)==null?void 0:F.call(a,q.value)])},bottom:()=>a.bottom?a.bottom(q.value):n(Ne,Ce,{prepend:a["footer.prepend"]})})})}}),Bt=te({__name:"EditAdminLayout",props:be({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:be(["save"],["update:modelValue"]),setup(e,{emit:k}){const T=We(e,"modelValue"),a=I(Oe(e.layout)),s=I([]),r=ge(),O=({callback:t})=>{const U=()=>{t&&t("Failed to Save Layout")},l=()=>{t&&t("Layout Saved")};r.saveAdminLayout(a.value).then(g=>{g?(l(),k("save",g)):U()}).catch(()=>{U()})},S=()=>({ID:0,LayoutPanelUUID:re(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:W.FORM_TYPE_NIL,RequiredGroupMemberships:[]}),c=t=>()=>({ID:0,LayoutItemUUID:re(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:de.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),C=t=>{const U=s.value.find(l=>l.value===t.SectionFieldUUID);U&&(t.SectionFieldID=U.object.ID,t.SectionField=U.object)};return r.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(U=>U.Sections.forEach(l=>l.Fields&&s.value.push(...l.Fields.map(g=>{var K;return{title:`${U.Name} - ${l.Name} - ${(K=g.Field)==null?void 0:K.Name}`,value:g.SectionFieldUUID,object:g}})))),s.value.sort(Ze("title"))}),(t,U)=>(i(),h(lt,{modelValue:T.value,"onUpdate:modelValue":U[3]||(U[3]=l=>T.value=l),onSave:O,title:t.title,color:"primary"},{default:d(()=>[n(Ie,{class:"px-0 mx-0",fluid:!0},{default:d(()=>[n(oe,null,{default:d(()=>[n(J,{cols:"12",sm:"6"},{default:d(()=>[n(ue,{modelValue:a.value.Name,"onUpdate:modelValue":U[0]||(U[0]=l=>a.value.Name=l),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),n(J,{cols:"12",sm:"6"},{default:d(()=>[n(le,{modelValue:a.value.Type,"onUpdate:modelValue":U[1]||(U[1]=l=>a.value.Type=l),label:"Layout Type",items:x(Nt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),n(Pe,{modelValue:a.value.Panels,"onUpdate:modelValue":U[2]||(U[2]=l=>a.value.Panels=l),"new-item":S,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ye({_:2},[G(a.value.Panels,(l,g)=>({name:`panel_${g}`,fn:d(()=>[n(Ie,{class:"px-0 mx-0",fluid:!0},{default:d(()=>[n(oe,null,{default:d(()=>[n(J,{cols:"12",sm:"6"},{default:d(()=>[n(ue,{modelValue:l.Name,"onUpdate:modelValue":v=>l.Name=v,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(J,{cols:"12",sm:"6"},{default:d(()=>[n(le,{modelValue:l.RequiredFormType,"onUpdate:modelValue":v=>l.RequiredFormType=v,items:x(at),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),n(oe,null,{default:d(()=>[n(J,{cols:"12"},{default:d(()=>[n(Rt,{label:"Required Groups",variant:"outlined",modelValue:l.RequiredGroupMemberships,"onUpdate:modelValue":v=>l.RequiredGroupMemberships=v,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),n(Pe,{modelValue:l.Items,"onUpdate:modelValue":v=>l.Items=v,"new-item":c(l),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ye({_:2},[G(l.Items,(v,K)=>({name:`item_${K}`,fn:d(()=>[n(Ie,{class:"px-0 mx-0",fluid:!0},{default:d(()=>[n(oe,null,{default:d(()=>[n(J,{cols:"12",sm:"6"},{default:d(()=>[n(ue,{modelValue:v.Label,"onUpdate:modelValue":V=>v.Label=V,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),n(oe,null,{default:d(()=>[n(J,{cols:"12",sm:"6"},{default:d(()=>[n(le,{modelValue:v.SourceType,"onUpdate:modelValue":V=>v.SourceType=V,label:"Source Type",items:x(ht),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),n(J,{cols:"12",sm:"6"},{default:d(()=>[v.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),h(le,{key:0,modelValue:v.SectionFieldUUID,"onUpdate:modelValue":V=>v.SectionFieldUUID=V,label:"Form Data",items:s.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:V=>C(v)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):v.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),h(le,{key:1,modelValue:v.MetaField,"onUpdate:modelValue":V=>v.MetaField=V,label:"Miscellaneous Data",items:x(Vt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):v.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),h(le,{key:2,modelValue:v.UserField,"onUpdate:modelValue":V=>v.UserField=V,label:"User Profile Data",items:x(Pt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Yt={key:1,class:"accommodationList"},$t=te({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},registration:{},value:{default:""},venues:{}},setup(e){const k=I(!1),T=ee(()=>{if(!e.value)return[];const a=JSON.parse(e.value),s=e.accommodations.filter(r=>a.includes(r.AccommodationUUID)).sort((r,O)=>{const S=a.findIndex(C=>C===r.AccommodationUUID),c=a.findIndex(C=>C===O.AccommodationUUID);return S>c?1:-1});return Oe(s)});return(a,s)=>{var r,O,S;return i(),E(f,null,[a.registration.Allocation?(i(),E(f,{key:0},[P(N((r=a.accommodations.find(c=>c.AccommodationUUID===a.registration.Allocation.AccommodationUUID))==null?void 0:r.Name)+" "+N((S=(O=a.venues)==null?void 0:O.map(c=>c.Rooms.find(C=>C.RoomUUID===a.registration.Allocation.RoomUUID)).filter(c=>c!=null)[0])==null?void 0:S.Name),1)],64)):w("",!0),a.value?(i(),E("ol",Yt,[(i(!0),E(f,null,G(T.value,c=>(i(),E("li",{key:c.AccommodationUUID},N(c.Name),1))),128))])):w("",!0),n(De,{onClick:s[0]||(s[0]=c=>k.value=!0),variant:"flat",color:"success"},{default:d(()=>[P("Assign Accommodation")]),_:1}),n(Ye,{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=c=>k.value=c)},{default:d(()=>[n(Fe,null,{default:d(()=>[n(Mt,null,{default:d(()=>[n(ft,null,{default:d(()=>[P("Accommodation Allocation")]),_:1})]),_:1}),n(Be,null,{default:d(()=>[P(" WIP ")]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const Ht=we($t,[["__scopeId","data-v-2251842e"]]),qt={key:0,class:"addonList"},jt={key:0},Jt={key:0},Kt=te({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const k=ee(()=>{if(!e.value)return;const T=JSON.parse(e.value),a=Object.keys(T),s=Oe(e.extras);return s.forEach(r=>{r.Options=r.Options.filter(O=>a.includes(O.OptionUUID)?(O.Choices=O.Choices.filter(S=>S.TagUUID===T[O.OptionUUID].choiceId),T[O.OptionUUID].checked):!1)}),s.filter(r=>r.Options.length>0),s});return(T,a)=>T.value?(i(),E("ul",qt,[(i(!0),E(f,null,G(k.value,s=>(i(),E(f,{key:s.ExtraUUID},[s.Options.length?(i(),E("li",jt,[Y("strong",null,N(s.Name),1),Y("ul",null,[(i(!0),E(f,null,G(s.Options,r=>(i(),E("li",{key:r.OptionUUID},[P(N(r.Name)+" ",1),r.Choices.length==1?(i(),E("small",Jt,"("+N(r.Choices[0].Title)+")",1)):w("",!0)]))),128))])])):w("",!0)],64))),128))])):w("",!0)}});const Wt=we(Kt,[["__scopeId","data-v-55786e01"]]),zt={key:0},Qt=te({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const k=ee(()=>{if(!e.value)return;const T=JSON.parse(e.value);return Object.entries(T).filter(([,a])=>a).map(([a,s])=>e.interests.find(r=>r.InterestUUID===a)).filter(a=>a!==void 0)});return(T,a)=>T.value?(i(),E("ul",zt,[(i(!0),E(f,null,G(k.value,s=>(i(),E("li",{key:s.InterestUUID},N(s.Name),1))),128))])):w("",!0)}}),Xt=Y("br",null,null,-1),Zt=Y("small",null,"Options:",-1),xt=Y("br",null,null,-1),ea=Y("small",null,"Addons:",-1),ta=te({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const k=ee(()=>{if(!e.value)return;let T={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{T=JSON.parse(e.value),"ticket"in T&&(T.Ticket=T.ticket),"addonsChecked"in T&&(T.AddonsChecked=T.addonsChecked),"componentsChecked"in T&&(T.ComponentsChecked=T.componentsChecked)}catch{}return T.Ticket.filter(a=>{const s=e.tickets.find(r=>r.TicketUUID===a);return!(!s||s.Type!==xe.TICKET_TYPE_TICKET)}).map(a=>{const s=e.tickets.find(O=>O.TicketUUID===a),r=Oe(s);return r.TicketComponents=s.TicketComponents.filter(O=>T.ComponentsChecked.includes(O.TicketUUID)),r.AddonTickets=s.AddonTickets.filter(O=>T.AddonsChecked.includes(O.TicketUUID)),r})});return(T,a)=>T.value?(i(!0),E(f,{key:0},G(k.value,s=>(i(),E("div",{key:s.TicketUUID},[Y("strong",null,N(s.Name),1),s.TicketComponents.length>0?(i(),E(f,{key:0},[Xt,Zt,P("  "),(i(!0),E(f,null,G(s.TicketComponents,r=>(i(),E(f,{key:r.TicketUUID},[Y("small",null,N(r.Name),1),P("  ")],64))),128))],64)):w("",!0),s.AddonTickets.length>0?(i(),E(f,{key:1},[xt,ea,P("  "),(i(!0),E(f,null,G(s.AddonTickets,r=>(i(),E("small",{key:r.TicketUUID},[P("("),Y("em",null,N(r.Name),1),P(")")]))),128))],64)):w("",!0)]))),128)):w("",!0)}}),aa={key:0},la={key:0},oa=Y("strong",null,"Total:",-1),na=te({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:k}){const T=ge(),a=I(),s=I(),r=I(),O=I(),S=I(!1),c=t=>{console.log(t)},C=(t,U,l)=>{s.value=t,T.getRegistrationGroup(l.RegistrationUUID||"").then(g=>{r.value=g,a.value=U,O.value=l,S.value=!0})};return(t,U)=>(i(),E(f,null,[t.header.key=="actions"?(i(),h(De,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:U[0]||(U[0]=l=>c(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(i(),h(Ht,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(i(),h(Wt,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(i(),h(Qt,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(i(),h(ta,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(i(!0),E(f,{key:5},G(t.item.raw[t.header.key],l=>(i(),E("ul",{key:l.Heading},[Y("li",null,[Y("strong",null,N(l.Heading)+":",1),P(" "+N(x(yt)(l.Submission.Status))+" ",1),n(De,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:g=>C(l.Registration,l.Form,l.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),h(gt,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(i(),E(f,{key:7},[t.item.raw[t.header.key].length===1?(i(),E("em",aa," Not in a group ")):(i(),E(f,{key:1},[Y("ul",null,[(i(!0),E(f,null,G(t.item.raw[t.header.key],l=>(i(),E("li",{key:l.UUID,class:"ml-0"},[P(" #"+N(l.Reference)+" : "+N(l.Name)+" ",1),l.IsLeader?(i(),E("strong",la,"(Leader)")):w("",!0)]))),128))]),oa,P(" "+N(t.item.raw[t.header.key].length),1)],64))],64)):(i(),E(f,{key:8},[P(N(t.item.raw[t.header.key]),1)],64)),S.value&&O.value&&a.value?(i(),h(Ye,{key:9,modelValue:S.value,"onUpdate:modelValue":U[3]||(U[3]=l=>S.value=l),scrollable:!0},{default:d(()=>[n(Fe,{class:"bg-red-darken-4"},{default:d(()=>[n(Be,null,{default:d(()=>[n(et,{modelValue:a.value,"onUpdate:modelValue":U[1]||(U[1]=l=>a.value=l),admin:!0,convention:t.convention,data:O.value,editable:!0,"registration-group":r.value,onClose:U[2]||(U[2]=l=>{S.value=!1,k("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):w("",!0)],64))}}),Va=te({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:k}){var ce;const T=Ft();k("pageTitle","Registration Manager");const a=ze(),s=Qe(),r=I(!0);let O=((ce=a.params.convention)==null?void 0:ce.toString())||"";const S=I({ID:0,ConventionUUID:re(),OrganisationID:0,OrganisationUUID:Lt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),c=ge(),C=I({ID:0,AdminLayoutUUID:re(),ConventionID:S.value.ID,ConventionUUID:S.value.ConventionUUID,Name:"Registration Table",Type:$e.ADMIN_LAYOUT_TABLE,Panels:[]}),t=I([]),U=I([]),l=I([]),g=I(1),v=I(10),K=I([]),V=I(0),z=I(!1),$=I(""),ne=I(""),ie=I(""),ae=I(""),me=I([]),_e=I([]),Ae=I([]),Ue=I([]),Te=I([]),H=I(0);Xe(H,o=>{o===7&&Se()});const pe=()=>{t.value=[],U.value=[],l.value=[];try{c.getConventionAdminLayoutByName(S.value.ConventionUUID,"Registration Table").then(o=>{H.value+=1,o?C.value=o:(C.value.ConventionID=S.value.ID,C.value.ConventionUUID=S.value.ConventionUUID)})}catch{C.value.ConventionID=S.value.ID,C.value.ConventionUUID=S.value.ConventionUUID}try{c.getConventionForms(S.value.ConventionUUID).then(o=>{H.value+=1,o&&(t.value=o)})}catch{}try{c.getConventionAccommodation(S.value.ConventionUUID).then(o=>{H.value+=1,o&&(me.value=o)})}catch{}try{c.getConventionVenues(S.value.ConventionUUID).then(o=>{H.value+=1,o&&(Te.value=o)})}catch{}try{c.getConventionExtras(S.value.ConventionUUID).then(o=>{H.value+=1,o&&(_e.value=o)})}catch{}try{c.getConventionInterests(S.value.ConventionUUID).then(o=>{H.value+=1,o&&(Ae.value=o)})}catch{}try{c.getConventionTickets(S.value.ConventionUUID).then(o=>{H.value+=1,o&&(Ue.value=o)})}catch{}},Ee=({page:o,itemsPerPage:m,sortBy:u})=>{g.value=o,K.value=u;const _=l.value.find(b=>b.uuid==$.value),B=_==null?void 0:_.layout.Items;let F="",Le="";if(u&&B&&u.length>=1){const b=B.find(se=>se.LayoutItemUUID==u[0].key);switch(Le=u[0].order,b==null?void 0:b.MetaField){case M.META_DATA_SOURCE_ACCOMMODATION_FORM:F="submission.status";break;case M.META_DATA_SOURCE_BADGE_FORM:F="submission.status";break;case M.META_DATA_SOURCE_DEALER_FORM:F="submission.status";break;case M.META_DATA_SOURCE_REGISTRATION_FORM:F="submission.status";break;case M.META_DATA_SOURCE_REGISTRATION_REFERENCE:F="reference";break;case M.META_DATA_SOURCE_SUBMISSION_DATE:F="created";break;case M.META_DATA_SOURCE_SUBMISSION_STATUS:F="submission.status";break}switch(b==null?void 0:b.UserField){case y.USER_DATA_SOURCE_DISPLAY_NAME:F="user.display_name";break;case y.USER_DATA_SOURCE_EMAIL:F="user.email";break;case y.USER_DATA_SOURCE_FIRST_NAME:F="user.firstname";break;case y.USER_DATA_SOURCE_HANDLE:F="user.handle";break;case y.USER_DATA_SOURCE_LAST_NAME:F="user.lastname";break}}try{const b={Direction:Le,Limit:m,Offset:(o-1)*m,Order:F};(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_ACCOMMODATION&&(b.Accommodation=!0),(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_BADGE&&(b.Badge=!0),(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_DEALER&&(b.Dealer=!0),(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_REGISTRATION&&(b.Registration=!0),b.Email=ae.value,b.Reference=ie.value,c.searchConventionRegistrations(S.value.ConventionUUID,b).then(se=>{se&&(V.value=se.Total,U.value=se.Registrations,l.value.forEach(Me=>{const He=Me.layout;Me.items=U.value.map(p=>{const L={};return Me.headers.forEach(ke=>{const D=He.Items.find(Q=>Q.LayoutItemUUID===ke.key);if(D){if(D.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&D.SectionField)p.Submissions.forEach(Q=>{const j=Q.Data.find(Re=>Re.SectionFieldUUID===D.SectionFieldUUID);if(j){ke.type===tt.ACCOMMODATION?L[D.LayoutItemUUID]={Data:j.Data,Registration:p}:L[D.LayoutItemUUID]=j.Data;return}});else if(D.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&D.UserField)switch(D.UserField){case y.USER_DATA_SOURCE_AVATAR:L[D.LayoutItemUUID]=T.GetProfileImageURL(p.UserUUID);break;case y.USER_DATA_SOURCE_DISPLAY_NAME:L[D.LayoutItemUUID]=p.User.DisplayName;break;case y.USER_DATA_SOURCE_EMAIL:L[D.LayoutItemUUID]=p.User.Additional.Email;break;case y.USER_DATA_SOURCE_HANDLE:L[D.LayoutItemUUID]=p.User.Handle;break;case y.USER_DATA_SOURCE_DATE_OF_BIRTH:L[D.LayoutItemUUID]=p.User.Additional.DOB;break;case y.USER_DATA_SOURCE_FIRST_NAME:L[D.LayoutItemUUID]=p.User.Additional.FirstName;break;case y.USER_DATA_SOURCE_LAST_NAME:L[D.LayoutItemUUID]=p.User.Additional.LastName;break;case y.USER_DATA_SOURCE_TELEGRAM:L[D.LayoutItemUUID]="";break}else if(D.SourceType==="LAYOUT_ITEM_SOURCE_META"&&D.MetaField){const Q=[];let j;const Re=p.Submissions.find(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_REGISTRATION});switch(D.MetaField){case M.META_DATA_SOURCE_REGISTRATION_GROUP:p.Leader?j=p:j=p.Primary,Q.push({Name:j.User.DisplayName,UUID:j.UserUUID,IsLeader:!0,Reference:j.Reference}),Q.push(...j.Members.map(A=>({Name:A.User.DisplayName,UUID:A.UserUUID,IsLeader:!1,Reference:A.Reference}))),L[D.LayoutItemUUID]=Q;break;case M.META_DATA_SOURCE_REGISTRATION_REFERENCE:L[D.LayoutItemUUID]=p.Reference;break;case M.META_DATA_SOURCE_SUBMISSION_DATE:if(Re){const A=new Date(Re.CreatedAt||"");L[D.LayoutItemUUID]=`${A.getFullYear()}-${(A.getMonth()+1).toString().padStart(2,"0")}-${A.getDate().toString().padStart(2,"0")} ${A.getHours().toString().padStart(2,"0")}:${A.getMinutes().toString().padStart(2,"0")}:${A.getSeconds().toString().padStart(2,"0")}`}else{const A=new Date(p.CreatedAt||"");L[D.LayoutItemUUID]=`${A.getFullYear()}-${(A.getMonth()+1).toString().padStart(2,"0")}-${A.getDate().toString().padStart(2,"0")} ${A.getHours().toString().padStart(2,"0")}:${A.getMinutes().toString().padStart(2,"0")}:${A.getSeconds().toString().padStart(2,"0")}`}break;case M.META_DATA_SOURCE_ACCOMMODATION_FORM:ve(p.Submissions,t.value),L[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}}).filter(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_ACCOMMODATION});break;case M.META_DATA_SOURCE_BADGE_FORM:ve(p.Submissions,t.value),L[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}}).filter(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_BADGE});break;case M.META_DATA_SOURCE_DEALER_FORM:ve(p.Submissions,t.value),L[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}}).filter(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_DEALER});break;case M.META_DATA_SOURCE_SUBMISSION_STATUS:ve(p.Submissions,t.value),L[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}});break}}}}),L})}),r.value=!1)})}catch{}},Se=()=>{C.value.Panels.forEach(o=>{o.Items.forEach(m=>{(m.SectionField==null||m.SectionField.Field==null)&&t.value.find(u=>{u.Sections.find(_=>{if(_.Fields){const B=_.Fields.find(F=>F.SectionFieldUUID===m.SectionFieldUUID);if(B)return m.SectionField=B,!0}})})})}),C.value.Panels.length>0&&(l.value=[],C.value.Panels.forEach(o=>{const m={uuid:re(),order:o.Order,name:o.Name,headers:[],items:[],layout:o};o.Items.sort((u,_)=>u.Order>_.Order?1:u.Order==_.Order?0:-1),m.headers=o.Items.map(u=>{var _,B;return{key:u.LayoutItemUUID,title:u.Label||((B=(_=u.SectionField)==null?void 0:_.Field)==null?void 0:B.Label)||"",align:u.Align==="end"?"end":"start",sortable:Ce(u),type:q(u)}}),l.value.push(m)})),($.value==null||$.value=="")&&l.value.length>0&&($.value=l.value[0].uuid)};O?c.getConvention(O).then(o=>{o&&(S.value=o,pe())}).catch(()=>{s.push("/")}):s.push("/");const q=o=>{var m,u;if(o.SourceType===de.LAYOUT_ITEM_SOURCE_META)return`${o.SourceType}.${o.MetaField}`;if(o.SourceType===de.LAYOUT_ITEM_SOURCE_FORM)return(u=(m=o.SectionField)==null?void 0:m.Field)==null?void 0:u.Type;if(o.SourceType===de.LAYOUT_ITEM_SOURCE_USER)return`${o.SourceType}.${o.UserField}`},Ce=o=>{const m=[M.META_DATA_SOURCE_ACCOMMODATION_FORM,M.META_DATA_SOURCE_BADGE_FORM,M.META_DATA_SOURCE_DEALER_FORM,M.META_DATA_SOURCE_REGISTRATION_FORM,M.META_DATA_SOURCE_REGISTRATION_REFERENCE,M.META_DATA_SOURCE_SUBMISSION_DATE,M.META_DATA_SOURCE_SUBMISSION_STATUS],u=[y.USER_DATA_SOURCE_DISPLAY_NAME,y.USER_DATA_SOURCE_EMAIL,y.USER_DATA_SOURCE_HANDLE,y.USER_DATA_SOURCE_DATE_OF_BIRTH,y.USER_DATA_SOURCE_FIRST_NAME,y.USER_DATA_SOURCE_LAST_NAME];return m.includes(o.MetaField)||u.includes(o.UserField)};return(o,m)=>(i(),h(pt,null,{default:d(()=>[n(kt,{color:"blue-darken-4"},{default:d(()=>[n(vt,{modelValue:$.value,"onUpdate:modelValue":m[0]||(m[0]=u=>$.value=u),"show-arrows":""},{default:d(()=>[(i(!0),E(f,null,G(l.value,u=>(i(),h(It,{key:u.uuid,value:u.uuid},{default:d(()=>[P(N(u.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(bt),n(De,{icon:"mdi:mdi-cog-outline",onClick:m[1]||(m[1]=u=>z.value=!0)})]),_:1}),n(Ot,{modelValue:$.value,"onUpdate:modelValue":m[8]||(m[8]=u=>$.value=u),disabled:!0},{default:d(()=>[(i(!0),E(f,null,G(l.value,u=>(i(),h(Dt,{key:u.uuid,value:u.uuid},{default:d(()=>[u.uuid===$.value?(i(),h(Fe,{key:0,class:"pa-2"},{default:d(()=>[n(x(wt),{"items-per-page":v.value,"onUpdate:itemsPerPage":m[7]||(m[7]=_=>v.value=_),headers:u.headers,"items-length":V.value,items:u.items,"item-value":"LayoutItemUUID",loading:r.value,search:ne.value,"onUpdate:options":Ee},ye({top:d(()=>[n(Ie,null,{default:d(()=>[n(oe,null,{default:d(()=>[n(J,null,{default:d(()=>[n(ue,{modelValue:ie.value,"onUpdate:modelValue":m[2]||(m[2]=_=>ie.value=_),label:"Search by Badge",onInput:m[3]||(m[3]=_=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),n(J,null,{default:d(()=>[n(ue,{modelValue:ae.value,"onUpdate:modelValue":m[4]||(m[4]=_=>ae.value=_),label:"Search By Email",onInput:m[5]||(m[5]=_=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:2},[G(u.headers,_=>({name:`item.${_.key}`,fn:d(({item:B})=>[n(na,{header:_,item:B,accommodations:me.value,convention:S.value,extras:_e.value,interests:Ae.value,tickets:Ue.value,venues:Te.value,onReload:m[6]||(m[6]=F=>Ee({page:g.value,itemsPerPage:v.value,sortBy:K.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading","search"])]),_:2},1024)):w("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),z.value?(i(),h(Bt,{key:0,title:"Edit Layout",modelValue:z.value,"onUpdate:modelValue":m[9]||(m[9]=u=>z.value=u),layout:C.value,onSave:m[10]||(m[10]=u=>{z.value=!1,Se()})},null,8,["modelValue","layout"])):w("",!0)]),_:1}))}});export{Va as default};
