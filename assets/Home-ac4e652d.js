import{I as N,a0 as ae,a1 as se,J as le,r as U,w as q,M as e,N as a,O as t,v as i,P as l,R as ie,Q as T,S as y,a2 as re,X as m,a3 as K,K as X,V as c,H as E,a4 as B,W as h,e as Y,L as j,Y as ue,Z as ce,_ as oe}from"./index-5758bb2c.js";import{G as J}from"./userData-e2be7c7f.js";import{_ as de}from"./LoginView.vue_vue_type_script_setup_true_lang-41785bba.js";import{s as H}from"./index-26b71cef.js";import{F as I}from"./form-29fd1dbb.js";import{S as Z,a as me}from"./submission-9dd916bb.js";import{V as ne,a as ve}from"./scopeId-c584a56a.js";import{c as G}from"./canEditForm-787038d8.js";import{s as fe}from"./sortSubmissions-8ed80f07.js";import{P as x,a as pe,f as _e,u as ye}from"./useDisplayTransactions-9f87a122.js";import{V as ge,l as Te}from"./VAlert-6e9b1de1.js";import{_ as he}from"./ModelDialog.vue_vue_type_script_setup_true_lang-020deb08.js";import{V as ke}from"./VForm-7a117ef9.js";import{V as L,a as M}from"./VRow-b00c4132.js";import{V as v,a as Se}from"./VBtn-55e32b78.js";import{j as Q}from"./VContainer-b37db88a.js";import{V as Ie}from"./SaveButton.vue_vue_type_script_setup_true_lang-931b51c3.js";import{V as Ee}from"./VAvatar-dcc9d9fa.js";import{V as ee,a as Ue,b as we,c as te,d as Ae,e as Ce}from"./VCard-0dc1705f.js";import"./emailFormVariant-e5e0aad4.js";import"./LoginButton-2fbef113.js";import"./createSimpleFunctional-55ed7be8.js";import"./forwardRefs-828dcb18.js";import"./VDialog-907a96ea.js";import"./VToolbar-021f2cc0.js";const Re=m("p",{class:"my-4"},[l(" Payments are non-refundable, please check our "),m("a",{target:"_blank",href:"https://www.scotiacon.org.uk/policies"},"policies"),l(" for further information. ")],-1),De=m("p",{class:"my-4"}," You must be over 18 to attend the convention and be able to produce valid ID matching the details on your registration. ",-1),Pe=m("p",{class:"my-4"}," If you are unable to provide valid ID when asked at the convention you will not be issued your attendee badge. ",-1),be=m("p",{class:"my-4"}," Payments should be made by the authorised card holder only. ",-1),Fe=m("p",{class:"my-4"},[l(" Please contact "),m("a",{href:"mailto:registration@scotiacon.org.uk"},"registration@scotiacon.org.uk"),l(" if you need any further assistance. ")],-1),Ve=m("div",{id:"link-authentication-element"},null,-1),Oe=m("div",{id:"payment-element"},null,-1),Me=N({__name:"StripePayment",props:ae({paymentTransactions:{},registration:{}},{modelValue:{type:Boolean,required:!0}}),emits:["update:modelValue"],setup(f){const g=se(f,"modelValue"),k=K(),S=J(),d=le(),n=U(),p=U(),w=U((S==null?void 0:S.Additional.Email)||""),A=U(!1),$=U("");let F;const V=U(!1);q(g,r=>{r&&k.stripePublicKey().then(async u=>{u&&(p.value=await Te(u),await o(p.value))})});const O=r=>{$.value=r,A.value=!0};async function o(r){var b;if(!r)return;const u=await k.stripePaymentIntent(((b=f.registration)==null?void 0:b.RegistrationUUID)||""),_={theme:"stripe"};d.current.value.dark&&(_.theme="night"),F=r.elements({clientSecret:u,appearance:_});const R=F.create("linkAuthentication",{defaultValues:{email:w.value}});R.mount("#link-authentication-element"),R.on("change",z=>{w.value=z.value.email});const s={layout:"tabs"};F.create("payment",s).mount("#payment-element")}async function C(r,u){if(!u)return;r.preventDefault(),V.value=!0;const _=new URL(location.href);_.pathname+="payment/stripe/processing";const{error:R}=await u.confirmPayment({elements:F,confirmParams:{return_url:_.toString(),receipt_email:w.value}});R.type==="card_error"||R.type==="validation_error"?O(R.message):O("An unexpected error occurred."),V.value=!1}return(r,u)=>(e(),a(he,{modelValue:g.value,"onUpdate:modelValue":u[4]||(u[4]=_=>g.value=_),title:"Make a Payment",color:"blue-darken-4",fullscreen:"",persistent:""},{default:t(()=>[i(Q,{class:"pa-0"},{default:t(()=>[i(ge,{class:"mb-2",closable:!0},{title:t(()=>[l(" Payment Information ")]),text:t(()=>[Re,De,Pe,be,Fe]),_:1}),i(ke,{ref_key:"paymentForm",ref:n,id:"payment-form",onSubmit:u[1]||(u[1]=ie(_=>C(_,p.value),["prevent"]))},{default:t(()=>[i(L,null,{default:t(()=>[i(M,null,{default:t(()=>[Ve]),_:1})]),_:1}),i(L,null,{default:t(()=>[i(M,null,{default:t(()=>[Oe]),_:1})]),_:1}),i(L,null,{default:t(()=>[r.registration?(e(),a(M,{key:0,class:"font-weight-bold text-right"},{default:t(()=>[l(" Payment Amount: £"+T(r.registration.Total-r.registration.Paid),1)]),_:1})):y("",!0)]),_:1}),i(L,null,{default:t(()=>[i(M,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:t(()=>[i(v,{color:"error",class:"w-100",onClick:u[0]||(u[0]=_=>g.value=!1)},{default:t(()=>[l("Cancel")]),_:1})]),_:1}),i(ne),i(M,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:t(()=>[i(v,{type:"submit",color:"success",class:"w-100"},re({default:t(()=>[l(" Pay Now ")]),_:2},[V.value?{name:"prepend",fn:t(()=>[i(Se,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),i(Ie,{modelValue:A.value,"onUpdate:modelValue":u[3]||(u[3]=_=>A.value=_)},{actions:t(()=>[i(v,{variant:"text",onClick:u[2]||(u[2]=_=>A.value=!1)},{default:t(()=>[l(" Close ")]),_:1})]),default:t(()=>[l(T($.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Ne={key:0},$e={key:1,class:"v-row"},Ye={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},xe={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Le={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},ze={key:1,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Ge={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Be={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},He={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},je=m("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1),qe={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Ke=m("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Current Payments ",-1),Je={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Qe=m("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance Due ",-1),We={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Xe=N({__name:"AttendeeTransactionList",props:{paymentTransactions:{},registration:{}},setup(f){const g=f,k=U(X(g.paymentTransactions));q(g,()=>{k.value=X(g.paymentTransactions)});const S=(d,n)=>d.Type===x.PAYMENT_TRANSACTION_TYPE_CHARGE&&n.Type!==x.PAYMENT_TRANSACTION_TYPE_CHARGE?-1:d.Type!==x.PAYMENT_TRANSACTION_TYPE_CHARGE&&n.Type===x.PAYMENT_TRANSACTION_TYPE_CHARGE||(d.UpdatedAt||0)>(n.UpdatedAt||0)?1:d.UpdatedAt===n.UpdatedAt?0:-1;return(d,n)=>d.registration.Total==0?(e(),c("p",Ne," Your registration is currently being processed, payment information will appear here when ready. ")):(e(),c("dl",$e,[(e(!0),c(E,null,B(k.value.sort(S),p=>{var w;return e(),c(E,{key:p.PaymentTransactionUUID},[p.Type===h(x).PAYMENT_TRANSACTION_TYPE_CHARGE?(e(),c("dt",Ye,[m("div",xe,T(p.Description.split(":")[0]),1),m("div",Le,T(p.Description.split(":")[1]),1)])):(e(),c("dt",ze,[m("div",Ge,T((w=h(pe).find(A=>A.value===p.Type))==null?void 0:w.title),1),m("div",Be," [ "+T(h(_e)(p.UpdatedAt||""))+" ] "+T(p.Description),1)])),m("dd",He," £"+T(p.Amount),1)],64)}),128)),je,m("dd",qe," £"+T(d.registration.Total),1),Ke,m("dd",Je," £"+T(d.registration.Paid),1),Qe,m("dd",We," £"+T(d.registration.Total-d.registration.Paid),1)]))}}),Ze=f=>(ue("data-v-0f316b60"),f=f(),ce(),f),et=["innerHTML"],tt={key:0},ot={key:0,class:"font-weight-bold float-left pt-1 w-50"},nt={key:1,class:"pa-1"},at={key:0,class:"font-weight-bold float-left pt-1 w-50"},st={key:1},lt={class:"font-weight-bold float-left pt-1 w-50"},it={class:"text-red-darken-4"},rt={key:1,class:"text-red-darken-4 mt-4"},ut=Ze(()=>m("strong",null,"There are forms above that require completion, please edit and save them.",-1)),ct=[ut],dt=N({__name:"OpenConvention",props:{convention:{},forms:{default:()=>[]}},setup(f){const g=ve(),k=K(),{getPaymentTransactions:S}=ye(),d=U(g.GetConventionLogoURL(f.convention.ConventionUUID)),n=U(),p=U([]),w=U(!1),A=Y(()=>{var o;return G(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_REGISTRATION)}),$=Y(()=>{var o;return G(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_DEALER)}),F=Y(()=>{var o;return G(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_ACCOMMODATION)}),V=Y(()=>{var o;return G(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],I.FORM_TYPE_ADDITIONAL)}),O=Y(()=>{var o,C;return n.value&&((o=n.value)!=null&&o.Submissions)?!!((C=n.value)!=null&&C.Submissions.find(r=>{var u;return((u=r.Form)==null?void 0:u.Type)==I.FORM_TYPE_REGISTRATION&&(r.Status==Z.SUBMISSION_STATUS_ACCEPTED||r.Status==Z.SUBMISSION_STATUS_CONFIRMED)})):!1});return q(()=>f.forms,()=>{k.getRegistrationByConvention(f.convention.ConventionUUID).then(o=>{var C;o&&(o.Submissions?(o.Submissions.forEach((r,u)=>{r.Form||(o.Submissions[u].Form=f.forms.find(_=>_.FormUUID===r.FormUUID))}),fe(o.Submissions)):o.Submissions=[],n.value=o,O.value&&S(((C=n.value)==null?void 0:C.RegistrationUUID)||"").then(r=>{p.value=r}))})}),(o,C)=>{const r=j("router-link"),u=j("RouterLink");return e(),a(Ce,{class:"elevation-5 flex-1-0 d-flex flex-column"},{default:t(()=>[i(we,{class:"flex-1-1 align-content-start"},{default:t(()=>[d.value?(e(),a(Ee,{key:0,src:d.value,title:o.convention.Name,class:"logo text-center"},null,8,["src","title"])):y("",!0),o.convention.Name?(e(),a(ee,{key:1,class:"text-center"},{default:t(()=>[l(T(o.convention.Name),1)]),_:1})):y("",!0),o.convention.Description?(e(),a(Ue,{key:2,class:"text-wrap subtitle"},{default:t(()=>[m("div",{innerHTML:o.convention.Description},null,8,et)]),_:1})):y("",!0)]),_:1}),i(te,null,{default:t(()=>{var _,R;return[n.value?(e(),c("dl",tt,[n.value.Reference?(e(),c("dt",ot," Badge No: ")):y("",!0),n.value.Reference?(e(),c("dd",nt," #"+T(n.value.Reference),1)):y("",!0),(e(!0),c(E,null,B((_=n.value)==null?void 0:_.Submissions,s=>{var D,b,z,W;return e(),c(E,{key:s.SubmissionUUID},[s.Form?(e(),c(E,{key:0},[s.Form?(e(),c("dt",at,T(s.Form.Heading),1)):y("",!0),s.Form?(e(),c("dd",st,[l(T(h(me)(s.Status))+" ",1),((D=s.Form)==null?void 0:D.Type)===h(I).FORM_TYPE_REGISTRATION?(e(),a(r,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/registration`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&A.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((b=s.Form)==null?void 0:b.Type)===h(I).FORM_TYPE_ACCOMMODATION?(e(),a(r,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/accommodation`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&F.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((z=s.Form)==null?void 0:z.Type)===h(I).FORM_TYPE_DEALER?(e(),a(r,{key:2,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/dealer`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&$.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((W=s.Form)==null?void 0:W.Type)===h(I).FORM_TYPE_ADDITIONAL?(e(),a(r,{key:3,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/additional`},{default:t(()=>{var P;return[(P=s.Form)!=null&&P.State.Edit&&V.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):y("",!0)])):y("",!0)],64)):y("",!0)],64)}),128)),((R=n.value)==null?void 0:R.Submissions.length)>=1?(e(!0),c(E,{key:2},B(o.forms,s=>{var D;return e(),c(E,{key:s.FormUUID},[(D=n.value)!=null&&D.Submissions.find(b=>b.FormUUID===s.FormUUID)?y("",!0):(e(),c(E,{key:0},[m("dt",lt,T(s.Heading),1),m("dd",it,[l(" Requires Completion "),s.Type===h(I).FORM_TYPE_REGISTRATION?(e(),a(r,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/registration`},{default:t(()=>[s.State.Edit&&A.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===h(I).FORM_TYPE_ACCOMMODATION?(e(),a(r,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/accommodation`},{default:t(()=>[s.State.Edit&&F.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===h(I).FORM_TYPE_DEALER?(e(),a(r,{key:2,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/dealer`},{default:t(()=>[s.State.Edit&&$.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===h(I).FORM_TYPE_ADDITIONAL?(e(),a(r,{key:3,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/additional`},{default:t(()=>[s.State.Edit&&V.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):y("",!0)])],64))],64)}),128)):y("",!0)])):y("",!0),n.value&&n.value.Submissions.length>=1&&o.forms.filter(s=>{var D;return!((D=n.value)!=null&&D.Submissions.find(b=>b.FormUUID==s.FormUUID))}).length?(e(),c("div",rt,ct)):y("",!0)]}),_:1}),O.value&&n.value?(e(),c(E,{key:0},[i(ee,{class:"pb-4 text-center"},{default:t(()=>[l("Payment Information")]),_:1}),i(te,null,{default:t(()=>[i(Xe,{"payment-transactions":p.value,registration:n.value},null,8,["payment-transactions","registration"])]),_:1})],64)):y("",!0),i(Ae,null,{default:t(()=>{var _,R;return[o.convention.DetailLink?(e(),a(v,{key:0,color:"orange",href:o.convention.DetailLink},{default:t(()=>[l(T(h(H).buttonDetails),1)]),_:1},8,["href"])):y("",!0),i(ne),A.value?(e(),c(E,{key:1},[(_=n.value)!=null&&_.Submissions.find(s=>{var D;return((D=s.Form)==null?void 0:D.Type)===h(I).FORM_TYPE_REGISTRATION})?(e(),a(u,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}`},{default:t(()=>[i(v,{color:"primary"},{default:t(()=>[l(T(h(H).buttonViewRegistration),1)]),_:1})]),_:1},8,["to"])):(e(),c(E,{key:0},[(R=o.forms.find(s=>s.Type===h(I).FORM_TYPE_REGISTRATION))!=null&&R.State.New?(e(),a(u,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}`},{default:t(()=>[i(v,{color:"primary"},{default:t(()=>[l(T(h(H).buttonRegister),1)]),_:1})]),_:1},8,["to"])):y("",!0)],64))],64)):O.value&&n.value&&n.value.Total>n.value.Paid?(e(),c(E,{key:2},[i(v,{color:"success",variant:"elevated",onClick:C[0]||(C[0]=s=>w.value=!0)},{default:t(()=>[l("Make Payment")]),_:1}),n.value?(e(),a(Me,{key:0,"payment-transactions":p.value,registration:n.value,modelValue:w.value,"onUpdate:modelValue":C[1]||(C[1]=s=>w.value=s)},null,8,["payment-transactions","registration","modelValue"])):y("",!0)],64)):y("",!0)]}),_:1})]),_:1})}}});const mt=oe(dt,[["__scopeId","data-v-0f316b60"]]),vt=N({__name:"Conventions",setup(f){const g=K(),k=U([]),S=U([]);return g.getOpenConventionsList().then(d=>{d&&(k.value=[...k.value,...d],g.getAvailableConventionForms(k.value.map(n=>n.ConventionUUID)).then(n=>{S.value=[...S.value,...n]}).catch(n=>{console.error(n)}))}),(d,n)=>(e(),a(Q,null,{default:t(()=>[i(L,{class:"justify-center"},{default:t(()=>[(e(!0),c(E,null,B(k.value,p=>(e(),a(M,{key:p.ConventionUUID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:t(()=>[i(mt,{convention:p,forms:S.value.filter(w=>w.ConventionUUID===p.ConventionUUID)},null,8,["convention","forms"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),ft={};function pt(f,g){return e(),c("div")}const _t=oe(ft,[["render",pt]]),yt=N({__name:"MainView",emits:["pageTitle"],setup(f,{emit:g}){g("pageTitle","Scotiacon Registration System"),sessionStorage.getItem("reload")==="true"&&(sessionStorage.removeItem("reload"),setTimeout(()=>{location.reload()},500));const S=localStorage.getItem("gjt_token"),d=localStorage.getItem("ajt_token");S?(localStorage.removeItem("gjt_token"),location.href=S):d&&(localStorage.removeItem("ajt_token"),location.href=d);const n=U(J());return(p,w)=>{const A=j("router-link");return e(),c(E,null,[n.value&&!n.value.Additional.Email?(e(),a(Q,{key:0,class:"bg-red-darken-4 text-center",fluid:!0},{default:t(()=>[l(" Please enter a Contact Email on the "),i(A,{to:"/profile",class:"text-white font-weight-bold"},{default:t(()=>[l("manage account page")]),_:1}),l(" to ensure we can contact you. ")]),_:1})):y("",!0),i(vt),i(_t)],64)}}}),Gt=N({__name:"Home",emits:["pageTitle"],setup(f,{emit:g}){const k=J();return g("pageTitle","Telegram Login"),(S,d)=>(e(),c("div",null,[h(k)?(e(),a(yt,{key:0,onPageTitle:d[0]||(d[0]=n=>g("pageTitle",n))})):(e(),a(de,{key:1}))]))}});export{Gt as default};
