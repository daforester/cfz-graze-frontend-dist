import{_}from"./FormField.vue_vue_type_script_setup_true_lang-af4b6aac.js";import{d as g,X as k,Y as C,y as $,R as q,o as n,b as f,w as D,N as s,G as U,K as u,O as v,F as c,c as S,e as w}from"./index-dc8f0ed9.js";import{_ as E}from"./SaveButton.vue_vue_type_script_setup_true_lang-713df2b2.js";import{u as B}from"./useGrazeAPI-f86c5cec.js";import{G}from"./userData-d733b0cf.js";import{v as p}from"./v4-a960c1f4.js";import{V as H}from"./VContainer-379ff3d5.js";import{a as F,V}from"./VRow-d9973ac5.js";const N={key:0,class:"my-2"},R={key:1,class:"my-2"},x={key:0,class:"my-2"},M={key:1,class:"my-2"},Y=g({__name:"FormRenderer",props:k({convention:{},data:{},editable:{type:Boolean,default:!0},preview:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(r){const o=C(r,"modelValue"),l=G(),y=B(),m=$((()=>{if(r.data!==void 0){const i=q(r.data);return o.value.Sections.forEach(e=>{e.Fields&&e.Fields.forEach(t=>{if(!r.data.Data.find(I=>I.SectionFieldUUID===t.SectionFieldUUID&&I.SectionFieldUUID==t.SectionFieldUUID)){const I={ID:0,SubmissionDataUUID:p(),SubmissionID:r.data.ID,SubmissionUUID:r.data.SubmissionUUID,SectionID:e.ID,SectionUUID:e.SectionUUID,SectionFieldID:t.ID,SectionFieldUUID:t.SectionFieldUUID,Data:t.Value};i.Data.push(I)}})}),i}const a={ID:0,SubmissionUUID:p(),FormID:o.value.ID,FormUUID:o.value.FormUUID,UserID:(l==null?void 0:l.ID)||0,UserUUID:(l==null?void 0:l.UserUUID)||"",Data:[]};return a.Data=o.value.Sections.map(i=>i.Fields?i.Fields.map(e=>({ID:0,SubmissionDataUUID:p(),SubmissionID:a.ID,SubmissionUUID:a.SubmissionUUID,SectionID:i.ID,SectionUUID:i.SectionUUID,SectionFieldID:e.ID,SectionFieldUUID:e.SectionFieldUUID,Data:e.Value})):[]).flat(),a})()),h=(a,i,e)=>{const t=m.value.Data.find(d=>d.SectionUUID===a&&d.SectionFieldUUID===i);t&&(t.Data=e)},b=({callback:a})=>{y.saveSubmission(m.value).then(i=>{i?(m.value=i,a&&a("Saved")):a&&a("Failed to process request")}).catch(()=>{a&&a("Failed to process request")})};return(a,i)=>(n(),f(H,null,{default:D(()=>[o.value.Heading?(n(),s("h2",N,U(o.value.Heading),1)):u("",!0),o.value.Description?(n(),s("p",R,U(o.value.Description),1)):u("",!0),(n(!0),s(c,null,v(o.value.Sections,e=>(n(),s(c,{key:`section_${o.value.ID}.${e.ID}`},[e.Heading?(n(),s("h3",x,U(e.Heading),1)):u("",!0),e.Description?(n(),s("p",M,U(e.Description),1)):u("",!0),e.Fields?(n(!0),s(c,{key:2},v(e.Fields,t=>(n(),s(c,{key:`field_${o.value.ID}.${e.ID}.${t.ID}`},[t.Field?(n(),f(F,{key:0},{default:D(()=>[S(V,null,{default:D(()=>[S(_,{field:t.Field,modelValue:t.Value,"onUpdate:modelValue":d=>t.Value=d,convention:a.convention,required:t.Required,"persistent-hint":!0,disabled:!a.editable,onChange:d=>h(e.SectionUUID,t.SectionFieldUUID,t.Value)},null,8,["field","modelValue","onUpdate:modelValue","convention","required","disabled","onChange"])]),_:2},1024)]),_:2},1024)):u("",!0)],64))),128)):u("",!0)],64))),128)),a.editable&&!a.preview?(n(),f(F,{key:2},{default:D(()=>[S(V,null,{default:D(()=>[S(E,{onClick:b})]),_:1})]),_:1})):u("",!0),w(" "+U(m.value),1)]),_:1}))}});export{Y as _};
