import{i as T,r as p,o as b,n as i,B as c,U as E,W as C,l as k,q as L,v as l,f as r,x as w,F as g,D as o,A as _}from"./index-9cd7f09b.js";import{G as D}from"./userData-0bcf18a8.js";import{S as R}from"./setupLogin-6ed27aa6.js";import{E as V}from"./emailFormVariant-e5e0aad4.js";import{b as B,V as U,c as x,e as y}from"./VCard-93f8d770.js";import{a as I}from"./VContainer-b58cc8a8.js";import"./createSimpleFunctional-5e57f4ef.js";import"./VAvatar-44eaf18a.js";const h=T({__name:"TelegramLoginForm",props:{mode:{},telegramLogin:{},redirectUrl:{default:""},requestAccess:{default:""},size:{default:""},userpic:{type:Boolean,default:!1},radius:{default:""}},emits:["callback"],setup(t,{emit:d}){const n=p(),a=e=>{d("callback",e)};return b(()=>{const e=document.createElement("script");e.async=!0,e.src="https://telegram.org/js/telegram-widget.js?22",e.setAttribute("data-size",t.size||""),e.setAttribute("data-userpic",t.userpic?"true":"false"),e.setAttribute("data-telegram-login",t.telegramLogin),e.setAttribute("data-request-access",t.requestAccess||""),t.radius&&e.setAttribute("data-radius",t.radius||""),t.mode==="callback"?(window.onTelegramAuth=a,e.setAttribute("data-onauth","window.onTelegramAuth(user)")):e.setAttribute("data-auth-url",t.redirectUrl||""),n.value.appendChild(e)}),(e,m)=>(i(),c("div",{ref_key:"telegram",ref:n},null,512))}}),M={class:"form-group row"},N={class:"col"},O=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),q=o("h2",null,"Telegram",-1),G={class:"form-group row"},z={class:"col"},F=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),Q=T({__name:"LoginWithTelegramView",props:{variant:{default:()=>V.COMBINED}},emits:["pageTitle"],setup(t,{emit:d}){d("pageTitle","Telegram Login");const n=E(),a=p(new Map),e=D(),m=C.getInstance();m.getLoginURLs(location.href.substring(0,location.href.length-9)).then(s=>{a.value=s});const f=s=>{m.oAuthLogin("telegram","","","",s).then(({created:A,tokens:u,user:v})=>{R(u,v,n,A)})};return e&&t.variant!=="ADD_CREDENTIAL"&&(Date.now()-new Date(e.CreatedAt||"").getTime()>2e4?n.push("/"):n.push("/profile")),(s,A)=>{const u=k("router-link");return i(),c("div",null,[s.variant=="ADD_CREDENTIAL"?(i(),L(I,{key:0,style:{"max-width":"550px"}},{default:l(()=>[r(y,null,{default:l(()=>[r(B,{class:"text-center"},{default:l(()=>[r(U,null,{default:l(()=>[w("Add a Telegram Account")]),_:1})]),_:1}),r(x,{class:"text-center"},{default:l(()=>[a.value.size>0?(i(),c(g,{key:0},[r(h,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:f,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",M,[o("div",N,[r(u,{to:"/"},{default:l(()=>[O]),_:1})])])],64)):_("",!0)]),_:1})]),_:1})]),_:1})):(i(),c(g,{key:1},[q,a.value.size>0?(i(),c(g,{key:0},[r(h,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:f,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",G,[o("div",z,[r(u,{to:"/"},{default:l(()=>[F]),_:1})])])],64)):_("",!0)],64))])}}});export{Q as default};
