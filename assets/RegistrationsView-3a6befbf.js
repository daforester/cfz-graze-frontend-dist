import{p as Fe,n as Ne,e as z,t as j,c as Pe,G as we,v as u,H as g,x as Te,I as W,a1 as pe,a2 as Ye,r as S,a3 as Ue,K as i,L as C,M as T,$ as Re,S as K,a8 as Ee,Z as M,Q as P,R as A,O as F,_ as Le,U as w,N as H,a4 as Be,a0 as $e,w as He}from"./index-79b94c65.js";import{a as Ge,F as te}from"./form-e2a93b7c.js";import{_ as xe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-fdcce377.js";import{m as qe,j as je,k as Je,l as Ke,n as ze,o as We,p as Qe,u as Xe,q as Ze,r as et,s as tt,t as at,v as lt,w as ot,x as nt,y as fe,z as ye,A as Oe,_ as Ce,f as it,g as st,h as ut,i as rt,d as dt}from"./VWindowItem-1d72e2d9.js";import{e as mt,T as Ut,d as ct}from"./FormRenderer.vue_vue_type_style_index_0_lang-0fed2094.js";import{a as me,V as J}from"./VRow-741be95c.js";import{V as Ae}from"./VTextField-6fd598e1.js";import{V as Z}from"./copyToClipboard-68708478.js";import{u as _t,j as Se}from"./VContainer-dfcde8ad.js";import{v as ae}from"./v4-a960c1f4.js";import{S as vt}from"./submission-56c4c4f1.js";import{V as Ie}from"./VBtn-f57c602b.js";import{V as Tt}from"./VAvatar-9aba60f6.js";import{c as At,e as ke}from"./VCard-d9cd837a.js";import{V as St}from"./VDialog-1ff49a29.js";import{s as Et}from"./sortSubmissions-ed9e4490.js";import{u as It}from"./useStoreAPI-cc5862d2.js";import{u as Dt,V as Rt}from"./VToolbar-755c83c2.js";import{V as pt}from"./VSpacer-02a2a63c.js";import{V as ge}from"./VTable-f012aa0b.js";import"./VChip-1d2acc85.js";import"./scopeId-3ce22178.js";import"./VCheckbox-0051ad29.js";import"./VToolbarItems-c9529a8a.js";import"./VList-12c08dd7.js";import"./index-71069b21.js";import"./VTextarea-ff30e974.js";import"./userData-9df5c106.js";import"./VForm-ddb783bb.js";var he=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(he||{});const ft=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var le=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(le||{});const yt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var De=(e=>(e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(De||{});const Ot=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var p=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(p||{});const Ct=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],gt=Fe({itemsLength:{type:[Number,String],required:!0},...qe(),...je(),...Je()},"VDataTableServer"),Lt=Ne()({name:"VDataTableServer",props:gt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,y)=>!0},setup(e,y){let{emit:r,slots:a}=y;const{groupBy:n}=Ke(e),{sortBy:s,multiSort:E,mustSort:_}=ze(e),{page:I,itemsPerPage:f}=We(e),l=z(()=>parseInt(e.itemsLength,10)),{columns:d,headers:o}=Qe(e,{groupBy:n,showSelect:j(e,"showSelect"),showExpand:j(e,"showExpand")}),{items:R}=Xe(e,d),{toggleSort:v}=Ze({sortBy:s,multiSort:E,mustSort:_,page:I}),{opened:B,isGroupOpen:L,toggleGroup:x,extractRows:N}=et({groupBy:n,sortBy:s}),{pageCount:oe,setItemsPerPage:ne}=tt({page:I,itemsPerPage:f,itemsLength:l}),{flatItems:ee}=at(R,n,B),{isSelected:ie,select:se,selectAll:Y,toggleSelect:ce,someSelected:ue,allSelected:re}=lt(e,{allItems:R,currentPage:R}),{isExpanded:_e,toggleExpand:ve}=ot(e),de=z(()=>N(R.value));nt({page:I,itemsPerPage:f,sortBy:s,groupBy:n,search:j(e,"search")}),Pe("v-data-table",{toggleSort:v,sortBy:s}),we({VDataTableRows:{hideNoData:j(e,"hideNoData"),noDataText:j(e,"noDataText"),loading:j(e,"loading"),loadingText:j(e,"loadingText")}});const t=z(()=>({page:I.value,itemsPerPage:f.value,sortBy:s.value,pageCount:oe.value,toggleSort:v,setItemsPerPage:ne,someSelected:ue.value,allSelected:re.value,isSelected:ie,select:se,selectAll:Y,toggleSelect:ce,isExpanded:_e,toggleExpand:ve,isGroupOpen:L,toggleGroup:x,items:de.value,groupedItems:ee.value,columns:d.value,headers:o.value}));_t(()=>{const[m]=fe.filterProps(e),[U]=ye.filterProps(e),[c]=Oe.filterProps(e),[k]=ge.filterProps(e);return u(ge,Te({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},k),{top:()=>{var O;return(O=a.top)==null?void 0:O.call(a,t.value)},default:()=>{var O,h,G,Q;return a.default?a.default(t.value):u(g,null,[(O=a.colgroup)==null?void 0:O.call(a,t.value),u("thead",{class:"v-data-table__thead",role:"rowgroup"},[u(ye,Te(U,{sticky:e.fixedHeader}),a)]),(h=a.thead)==null?void 0:h.call(a,t.value),u("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(t.value):u(Oe,Te(c,{items:ee.value}),a)]),(G=a.tbody)==null?void 0:G.call(a,t.value),(Q=a.tfoot)==null?void 0:Q.call(a,t.value)])},bottom:()=>a.bottom?a.bottom(t.value):u(fe,m,{prepend:a["footer.prepend"]})})})}}),kt=W({__name:"EditAdminLayout",props:pe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:pe(["save"],["update:modelValue"]),setup(e,{emit:y}){const r=Ye(e,"modelValue"),a=S(Ue(e.layout)),n=S([]),s=Re(),E=({callback:l})=>{const d=()=>{l&&l("Failed to Save Layout")},o=()=>{l&&l("Layout Saved")};s.saveAdminLayout(a.value).then(R=>{R?(o(),y("save",R)):d()}).catch(()=>{d()})},_=()=>({ID:0,LayoutPanelUUID:ae(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:te.FORM_TYPE_NIL}),I=l=>()=>({ID:0,LayoutItemUUID:ae(),LayoutPanelID:l.ID,LayoutPanelUUID:l.LayoutPanelUUID,Label:"",SourceType:le.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:l.Items.length+1}),f=l=>{const d=n.value.find(o=>o.value===l.SectionFieldUUID);d&&(l.SectionFieldID=d.object.ID,l.SectionField=d.object)};return s.getConventionForms(e.layout.ConventionUUID).then(l=>{l.forEach(d=>d.Sections.forEach(o=>o.Fields&&n.value.push(...o.Fields.map(R=>{var B;return{title:`${d.Name} - ${o.Name} - ${(B=R.Field)==null?void 0:B.Name}`,value:R.SectionFieldUUID,object:R}})))),n.value.sort(mt("title"))}),(l,d)=>(i(),C(xe,{modelValue:r.value,"onUpdate:modelValue":d[3]||(d[3]=o=>r.value=o),onSave:E,title:l.title,color:"primary"},{default:T(()=>[u(Se,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[u(me,null,{default:T(()=>[u(J,{cols:"12",sm:"6"},{default:T(()=>[u(Ae,{modelValue:a.value.Name,"onUpdate:modelValue":d[0]||(d[0]=o=>a.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),u(J,{cols:"12",sm:"6"},{default:T(()=>[u(Z,{modelValue:a.value.Type,"onUpdate:modelValue":d[1]||(d[1]=o=>a.value.Type=o),label:"Layout Type",items:K(ft),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),u(Ce,{modelValue:a.value.Panels,"onUpdate:modelValue":d[2]||(d[2]=o=>a.value.Panels=o),"new-item":_,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Ee({_:2},[M(a.value.Panels,(o,R)=>({name:`panel_${R}`,fn:T(()=>[u(Se,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[u(me,null,{default:T(()=>[u(J,{cols:"12",sm:"6"},{default:T(()=>[u(Ae,{modelValue:o.Name,"onUpdate:modelValue":v=>o.Name=v,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),u(J,{cols:"12",sm:"6"},{default:T(()=>[u(Z,{modelValue:o.RequiredFormType,"onUpdate:modelValue":v=>o.RequiredFormType=v,items:K(Ge),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),u(Ce,{modelValue:o.Items,"onUpdate:modelValue":v=>o.Items=v,"new-item":I(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Ee({_:2},[M(o.Items,(v,B)=>({name:`item_${B}`,fn:T(()=>[u(Se,{class:"px-0 mx-0",fluid:!0},{default:T(()=>[u(me,null,{default:T(()=>[u(J,{cols:"12",sm:"6"},{default:T(()=>[u(Ae,{modelValue:v.Label,"onUpdate:modelValue":L=>v.Label=L,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),u(me,null,{default:T(()=>[u(J,{cols:"12",sm:"6"},{default:T(()=>[u(Z,{modelValue:v.SourceType,"onUpdate:modelValue":L=>v.SourceType=L,label:"Source Type",items:K(yt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),u(J,{cols:"12",sm:"6"},{default:T(()=>[v.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),C(Z,{key:0,modelValue:v.SectionFieldUUID,"onUpdate:modelValue":L=>v.SectionFieldUUID=L,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:L=>f(v)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):v.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),C(Z,{key:1,modelValue:v.MetaField,"onUpdate:modelValue":L=>v.MetaField=L,label:"Miscellaneous Data",items:K(Ot),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):v.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),C(Z,{key:2,modelValue:v.UserField,"onUpdate:modelValue":L=>v.UserField=L,label:"User Profile Data",items:K(Ct),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),ht={key:0,class:"accommodationList"},bt=W({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return[];const r=JSON.parse(e.value),a=e.accommodations.filter(n=>r.includes(n.AccommodationUUID)).sort((n,s)=>{const E=r.findIndex(I=>I===n.AccommodationUUID),_=r.findIndex(I=>I===s.AccommodationUUID);return E>_?1:-1});return Ue(a)});return(r,a)=>r.value?(i(),A("ol",ht,[(i(!0),A(g,null,M(y.value,n=>(i(),A("li",{key:n.AccommodationUUID},F(n.Name),1))),128))])):P("",!0)}});const Vt=Le(bt,[["__scopeId","data-v-1ba5f67a"]]),Mt={key:0,class:"addonList"},Ft={key:0},Nt=W({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return;const r=JSON.parse(e.value),a=Object.keys(r),n=Ue(e.extras);return n.forEach(s=>{s.Options=s.Options.filter(E=>a.includes(E.OptionUUID)?(E.Choices=E.Choices.filter(_=>_.TagUUID===r[E.OptionUUID].choiceId),r[E.OptionUUID].checked):!1)}),n.filter(s=>s.Options.length>0),n});return(r,a)=>r.value?(i(),A("ul",Mt,[(i(!0),A(g,null,M(y.value,n=>(i(),A("li",{key:n.ExtraUUID},[w("strong",null,F(n.Name),1),w("ul",null,[(i(!0),A(g,null,M(n.Options,s=>(i(),A("li",{key:s.OptionUUID},[H(F(s.Name)+" ",1),s.Choices.length==1?(i(),A("small",Ft,"("+F(s.Choices[0].Title)+")",1)):P("",!0)]))),128))])]))),128))])):P("",!0)}});const Pt=Le(Nt,[["__scopeId","data-v-4ed6842b"]]),wt={key:0},Yt=W({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return;const r=JSON.parse(e.value);return Object.entries(r).filter(([,a])=>a).map(([a,n])=>e.interests.find(s=>s.InterestUUID===a)).filter(a=>a!==void 0)});return(r,a)=>r.value?(i(),A("ul",wt,[(i(!0),A(g,null,M(y.value,n=>(i(),A("li",{key:n.InterestUUID},F(n.Name),1))),128))])):P("",!0)}}),Bt=w("br",null,null,-1),$t=w("small",null,"Options:",-1),Ht=w("br",null,null,-1),Gt=w("small",null,"Addons:",-1),xt=W({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const y=z(()=>{if(!e.value)return;let r={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{r=JSON.parse(e.value),"ticket"in r&&(r.Ticket=r.ticket),"addonsChecked"in r&&(r.AddonsChecked=r.addonsChecked),"componentsChecked"in r&&(r.ComponentsChecked=r.componentsChecked)}catch{}return r.Ticket.filter(a=>{const n=e.tickets.find(s=>s.TicketUUID===a);return!(!n||n.Type!==Ut.TICKET_TYPE_TICKET)}).map(a=>{const n=e.tickets.find(E=>E.TicketUUID===a),s=Ue(n);return s.TicketComponents=n.TicketComponents.filter(E=>r.ComponentsChecked.includes(E.TicketUUID)),s.AddonTickets=n.AddonTickets.filter(E=>r.AddonsChecked.includes(E.TicketUUID)),s})});return(r,a)=>r.value?(i(!0),A(g,{key:0},M(y.value,n=>(i(),A("div",{key:n.TicketUUID},[w("strong",null,F(n.Name),1),n.TicketComponents.length>0?(i(),A(g,{key:0},[Bt,$t,H("  "),(i(!0),A(g,null,M(n.TicketComponents,s=>(i(),A(g,{key:s.TicketUUID},[w("small",null,F(s.Name),1),H("  ")],64))),128))],64)):P("",!0),n.AddonTickets.length>0?(i(),A(g,{key:1},[Ht,Gt,H("  "),(i(!0),A(g,null,M(n.AddonTickets,s=>(i(),A("small",{key:s.TicketUUID},[H("("),w("em",null,F(s.Name),1),H(")")]))),128))],64)):P("",!0)]))),128)):P("",!0)}}),qt=W({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:y}){const r=Re(),a=S(),n=S(),s=S(),E=S(),_=S(!1),I=l=>{console.log(l)},f=(l,d,o)=>{n.value=l,r.getRegistrationGroup(o.RegistrationUUID||"").then(R=>{s.value=R,a.value=d,E.value=o,_.value=!0})};return(l,d)=>(i(),A(g,null,[l.header.key=="actions"?(i(),C(Ie,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:d[0]||(d[0]=o=>I(l.item.raw))})):l.header.type==="ACCOMMODATION"&&l.accommodations.length>0?(i(),C(Vt,{key:1,value:l.item.raw[l.header.key],accommodations:l.accommodations},null,8,["value","accommodations"])):l.header.type==="EXTRAS"&&l.extras.length>0?(i(),C(Pt,{key:2,value:l.item.raw[l.header.key],extras:l.extras},null,8,["value","extras"])):l.header.type==="INTERESTS"&&l.interests.length>0?(i(),C(Yt,{key:3,value:l.item.raw[l.header.key],interests:l.interests},null,8,["value","interests"])):l.header.type==="TICKET"&&l.tickets.length>0?(i(),C(xt,{key:4,value:l.item.raw[l.header.key],tickets:l.tickets},null,8,["value","tickets"])):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(i(!0),A(g,{key:5},M(l.item.raw[l.header.key],o=>(i(),A("ul",{key:o.Heading},[w("li",null,[w("strong",null,F(o.Heading)+":",1),H(" "+F(K(vt)(o.Submission.Status))+" ",1),u(Ie,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:R=>f(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):l.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),C(Tt,{key:6,class:"rounded-circle",src:l.item.raw[l.header.key],height:"32",width:"32"},null,8,["src"])):(i(),A(g,{key:7},[H(F(l.item.raw[l.header.key]),1)],64)),_.value&&E.value&&a.value?(i(),C(St,{key:8,modelValue:_.value,"onUpdate:modelValue":d[3]||(d[3]=o=>_.value=o),scrollable:!0},{default:T(()=>[u(ke,{class:"bg-red-darken-4"},{default:T(()=>[u(At,null,{default:T(()=>[u(ct,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=o=>a.value=o),admin:!0,convention:l.convention,data:E.value,editable:!0,"registration-group":s.value,onClose:d[2]||(d[2]=o=>{_.value=!1,y("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0)],64))}}),Da=W({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:y}){var de;const r=It();y("pageTitle","Registration Manager");const a=Be(),n=$e(),s=S(!0);let E=((de=a.params.convention)==null?void 0:de.toString())||"";const _=S({ID:0,ConventionUUID:ae(),OrganisationID:0,OrganisationUUID:Dt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),I=Re(),f=S({ID:0,AdminLayoutUUID:ae(),ConventionID:_.value.ID,ConventionUUID:_.value.ConventionUUID,Name:"Registration Table",Type:he.ADMIN_LAYOUT_TABLE,Panels:[]}),l=S([]),d=S([]),o=S([]),R=S(1),v=S(10),B=S([]),L=S(0),x=S(!1),N=S(""),oe=S([]),ne=S([]),ee=S([]),ie=S([]),se=S([]),Y=S(0);He(Y,t=>{t===7&&re()});const ce=()=>{l.value=[],d.value=[],o.value=[];try{I.getConventionAdminLayoutByName(_.value.ConventionUUID,"Registration Table").then(t=>{Y.value+=1,t?f.value=t:(f.value.ConventionID=_.value.ID,f.value.ConventionUUID=_.value.ConventionUUID)})}catch{f.value.ConventionID=_.value.ID,f.value.ConventionUUID=_.value.ConventionUUID}try{I.getConventionForms(_.value.ConventionUUID).then(t=>{Y.value+=1,t&&(l.value=t)})}catch{}try{I.getConventionAccommodation(_.value.ConventionUUID).then(t=>{Y.value+=1,t&&(oe.value=t)})}catch{}try{I.getConventionVenues(_.value.ConventionUUID).then(t=>{Y.value+=1,t&&(se.value=t)})}catch{}try{I.getConventionExtras(_.value.ConventionUUID).then(t=>{Y.value+=1,t&&(ne.value=t)})}catch{}try{I.getConventionInterests(_.value.ConventionUUID).then(t=>{Y.value+=1,t&&(ee.value=t)})}catch{}try{I.getConventionTickets(_.value.ConventionUUID).then(t=>{Y.value+=1,t&&(ie.value=t)})}catch{}},ue=({page:t,itemsPerPage:m,sortBy:U})=>{R.value=t,B.value=U;const c=o.value.find(h=>h.uuid==N.value),k=c==null?void 0:c.layout.Items;let O="";if(U&&k&&U.length>=1){const h=k.find(G=>G.LayoutItemUUID==U[0].key);switch(h==null?void 0:h.UserField){case p.USER_DATA_SOURCE_DISPLAY_NAME:O="user.display_name";break;case p.USER_DATA_SOURCE_HANDLE:O="user.handle";break;case p.USER_DATA_SOURCE_EMAIL:O="user.email";break}}try{const h={Offset:(t-1)*m,Order:O,Limit:m};(c==null?void 0:c.layout.RequiredFormType)===te.FORM_TYPE_ACCOMMODATION&&(h.Accommodation=!0),(c==null?void 0:c.layout.RequiredFormType)===te.FORM_TYPE_BADGE&&(h.Badge=!0),(c==null?void 0:c.layout.RequiredFormType)===te.FORM_TYPE_DEALER&&(h.Dealer=!0),I.searchConventionRegistrations(_.value.ConventionUUID,h).then(G=>{G&&(L.value=G.Total,d.value=G.Registrations,o.value.forEach(Q=>{const be=Q.layout;Q.items=d.value.map(b=>{const V={};return Q.headers.forEach(Ve=>{const D=be.Items.find(X=>X.LayoutItemUUID===Ve.key);if(D){if(D.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&D.SectionField)b.Submissions.forEach(X=>{const q=X.Data.find($=>$.SectionFieldUUID===D.SectionFieldUUID);if(q){V[D.LayoutItemUUID]=q.Data;return}});else if(D.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&D.UserField)switch(D.UserField){case p.USER_DATA_SOURCE_AVATAR:V[D.LayoutItemUUID]=r.GetProfileImageURL(b.UserUUID);break;case p.USER_DATA_SOURCE_DISPLAY_NAME:V[D.LayoutItemUUID]=b.User.DisplayName;break;case p.USER_DATA_SOURCE_EMAIL:V[D.LayoutItemUUID]=b.User.Additional.Email;break;case p.USER_DATA_SOURCE_HANDLE:V[D.LayoutItemUUID]=b.User.Handle;break;case p.USER_DATA_SOURCE_DATE_OF_BIRTH:V[D.LayoutItemUUID]=b.User.Additional.DOB;break;case p.USER_DATA_SOURCE_FIRST_NAME:V[D.LayoutItemUUID]=b.User.Additional.FirstName;break;case p.USER_DATA_SOURCE_LAST_NAME:V[D.LayoutItemUUID]=b.User.Additional.LastName;break;case p.USER_DATA_SOURCE_TELEGRAM:V[D.LayoutItemUUID]="";break}else if(D.SourceType==="LAYOUT_ITEM_SOURCE_META"&&D.MetaField){const X=b.Submissions.find(q=>{var $;return(($=q.Form)==null?void 0:$.Type)===te.FORM_TYPE_REGISTRATION});switch(D.MetaField){case De.META_DATA_SOURCE_SUBMISSION_DATE:X?V[D.LayoutItemUUID]=new Date(X.CreatedAt||"").toLocaleString():V[D.LayoutItemUUID]=new Date(b.CreatedAt||"").toLocaleString();break;case De.META_DATA_SOURCE_SUBMISSION_STATUS:Et(b.Submissions,l.value),V[D.LayoutItemUUID]=b.Submissions.map(q=>{const $=l.value.find(Me=>Me.FormUUID===q.FormUUID);return{Heading:$==null?void 0:$.Heading,Form:$,Submission:q,Registration:b}});break}}}}),V})}),s.value=!1)})}catch{}},re=()=>{f.value.Panels.forEach(t=>{t.Items.forEach(m=>{(m.SectionField==null||m.SectionField.Field==null)&&l.value.find(U=>{U.Sections.find(c=>{if(c.Fields){const k=c.Fields.find(O=>O.SectionFieldUUID===m.SectionFieldUUID);if(k)return m.SectionField=k,!0}})})})}),f.value.Panels.length>0&&(o.value=[],f.value.Panels.forEach(t=>{const m={uuid:ae(),order:t.Order,name:t.Name,headers:[],items:[],layout:t},U={key:"actions",title:"Actions",align:"start",sortable:!1,type:""};t.Items.sort((c,k)=>c.Order>k.Order?1:c.Order==k.Order?0:-1),m.headers=t.Items.map(c=>{var k,O;return{key:c.LayoutItemUUID,title:c.Label||((O=(k=c.SectionField)==null?void 0:k.Field)==null?void 0:O.Label)||"",align:c.Align==="end"?"end":"start",sortable:ve(c),type:_e(c)}}),m.headers.push(U),o.value.push(m)})),(N.value==null||N.value=="")&&o.value.length>0&&(N.value=o.value[0].uuid)};E?I.getConvention(E).then(t=>{t&&(_.value=t,ce())}).catch(()=>{n.push("/")}):n.push("/");const _e=t=>{var m,U;if(t.SourceType===le.LAYOUT_ITEM_SOURCE_META)return`${t.SourceType}.${t.MetaField}`;if(t.SourceType===le.LAYOUT_ITEM_SOURCE_FORM)return(U=(m=t.SectionField)==null?void 0:m.Field)==null?void 0:U.Type;if(t.SourceType===le.LAYOUT_ITEM_SOURCE_USER)return`${t.SourceType}.${t.UserField}`},ve=t=>[p.USER_DATA_SOURCE_DISPLAY_NAME,p.USER_DATA_SOURCE_EMAIL,p.USER_DATA_SOURCE_HANDLE,p.USER_DATA_SOURCE_DATE_OF_BIRTH,p.USER_DATA_SOURCE_FIRST_NAME,p.USER_DATA_SOURCE_LAST_NAME].includes(t.UserField);return(t,m)=>(i(),C(dt,null,{default:T(()=>[u(Rt,{color:"blue-darken-4"},{default:T(()=>[u(it,{modelValue:N.value,"onUpdate:modelValue":m[0]||(m[0]=U=>N.value=U),"show-arrows":""},{default:T(()=>[(i(!0),A(g,null,M(o.value,U=>(i(),C(st,{key:U.uuid,value:U.uuid},{default:T(()=>[H(F(U.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),u(pt),u(Ie,{icon:"mdi:mdi-cog-outline",onClick:m[1]||(m[1]=U=>x.value=!0)})]),_:1}),u(rt,{modelValue:N.value,"onUpdate:modelValue":m[4]||(m[4]=U=>N.value=U)},{default:T(()=>[(i(!0),A(g,null,M(o.value,U=>(i(),C(ut,{key:U.uuid,value:U.uuid},{default:T(()=>[U.uuid===N.value?(i(),C(ke,{key:0,class:"pa-2"},{default:T(()=>[u(K(Lt),{"items-per-page":v.value,"onUpdate:itemsPerPage":m[3]||(m[3]=c=>v.value=c),headers:U.headers,"items-length":L.value,items:U.items,"item-value":"LayoutItemUUID",loading:s.value,"onUpdate:options":ue},Ee({_:2},[M(U.headers,c=>({name:`item.${c.key}`,fn:T(({item:k})=>[u(qt,{header:c,item:k,accommodations:oe.value,convention:_.value,extras:ne.value,interests:ee.value,tickets:ie.value,venues:se.value,onReload:m[2]||(m[2]=O=>ue({page:R.value,itemsPerPage:v.value,sortBy:B.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):P("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),x.value?(i(),C(kt,{key:0,title:"Edit Layout",modelValue:x.value,"onUpdate:modelValue":m[5]||(m[5]=U=>x.value=U),layout:f.value,onSave:m[6]||(m[6]=U=>{x.value=!1,re()})},null,8,["modelValue","layout"])):P("",!0)]),_:1}))}});export{Da as default};
