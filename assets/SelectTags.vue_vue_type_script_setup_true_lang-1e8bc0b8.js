import{s as D}from"./index-ba0d422e.js";import{u as A}from"./useGrazeAPI-df8c1e39.js";import{v as K}from"./v4-a960c1f4.js";import{V as b,a as N}from"./VBtn-1a4cf250.js";import{V as $,b as x}from"./VToolbar-fbfc308f.js";import{V as E}from"./VSpacer-aa9e32e7.js";import{V as F}from"./VSheet-d98c0058.js";import{V as M}from"./VContainer-5c295873.js";import{a as J,V as y}from"./VRow-b02a39ca.js";import{V as h}from"./VTextField-3b0954d6.js";import{c as P,e as q}from"./VCard-5c28dba8.js";import{d as w,y as f,o as B,b as z,w as s,c as a,e as V,L as C,X as k,Y as G,h as R,k as X,N as Y,F as H}from"./index-0085e4e0.js";import{V as Q}from"./VAutocomplete-fb002900.js";import{V as W}from"./VDialog-200449af.js";import{a as Z,b as _}from"./VList-b7d80e38.js";const O="00000000-0000-0000-0000-000000000000",ee=w({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(t,{emit:c}){const u=f(""),n=f("");typeof t.convention=="object"?(u.value=t.convention.ConventionUUID,n.value=t.convention.OrganisationUUID):u.value=t.convention||"",typeof t.organisation=="object"?n.value=t.organisation.OrganisationUUID:n.value.length===0&&(n.value=t.organisation||"");const v=f({ID:0,TagUUID:K(),ConventionID:0,ConventionUUID:u.value||O,OrganisationID:0,OrganisationUUID:n.value||O,Title:"",Key:""}),g=A(),p=()=>{g.saveTag(v.value).then(m=>{m&&(v.value=m,c("save",v.value),c("close"))})};return(m,i)=>(B(),z(q,null,{default:s(()=>[a(x,{dark:"",color:"primary"},{default:s(()=>[a(b,{icon:"",dark:"",onClick:i[0]||(i[0]=d=>c("close"))},{default:s(()=>[a(N,null,{default:s(()=>[V("mdi:mdi-close")]),_:1})]),_:1}),a($,null,{default:s(()=>[V("Add Tag")]),_:1}),a(E),a(F,null,{default:s(()=>[a(b,{variant:"text",onClick:p},{default:s(()=>[V(" Save ")]),_:1})]),_:1})]),_:1}),a(P,null,{default:s(()=>[a(M,{fluid:""},{default:s(()=>[a(J,null,{default:s(()=>[a(y,{cols:"12"},{default:s(()=>[a(h,{label:C(D).formLabelDisplayName,type:"text",variant:"outlined",modelValue:v.value.Title,"onUpdate:modelValue":i[1]||(i[1]=d=>v.value.Title=d)},null,8,["label","modelValue"])]),_:1}),a(y,{cols:"12"},{default:s(()=>[a(h,{label:C(D).formLabelTagKey,type:"text",variant:"outlined",modelValue:v.value.Key,"onUpdate:modelValue":i[2]||(i[2]=d=>v.value.Key=d)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),pe=w({__name:"SelectTags",props:k({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0}}),emits:k(["change"],["update:modelValue"]),setup(t,{emit:c}){const u=G(t,"modelValue"),n=f([]),v=A(),g=f([]),p=f([]),m=f(""),i=f(""),d=f(0),T=R(()=>[...g.value,...p.value].map(l=>({title:l.Title,value:n.value.find(e=>e.TagUUID===l.TagUUID)||l})));typeof t.convention=="object"?(m.value=t.convention.ConventionUUID,i.value=t.convention.OrganisationUUID):m.value=t.convention||"",typeof t.organisation=="object"?i.value=t.organisation.OrganisationUUID:i.value.length===0&&(i.value=t.organisation||""),(async()=>{const o=[];m.value&&o.push(v.getConventionTags(m.value)),i.value&&o.push(v.getOrganisationTags(i.value));const l=await Promise.all(o);if(m.value&&i.value?(p.value=l[0].sort((e,r)=>e.Title.localeCompare(r.Title)),g.value=l[1].sort((e,r)=>e.Title.localeCompare(r.Title))):m.value&&l.length==1?p.value=l[0].sort((e,r)=>e.Title.localeCompare(r.Title)):i.value&&l.length==1&&(g.value=l[0].sort((e,r)=>e.Title.localeCompare(r.Title))),Array.isArray(u.value))d.value=2,T.value.forEach(e=>{Array.isArray(u.value)&&u.value.find(I=>I.TagUUID===e.value.TagUUID)&&n.value.push(e.value)});else if(typeof u.value=="string"){d.value=1;try{const e=JSON.parse(u.value);T.value.forEach(r=>{e.find(j=>j.TagUUID===r.value.TagUUID)&&n.value.push(r.value)})}catch{}}})();const U=f(!1),L=()=>{U.value=!0},S=o=>{o.ConventionUUID.length>0?p.value.push(o):o.OrganisationUUID.length>0&&g.value.push(o),n.value.push(o)};return X(n,()=>{switch(d.value){default:case 2:{u.value=n.value,c("change");break}case 1:{u.value=JSON.stringify(n.value),c("change");break}}}),(o,l)=>(B(),Y(H,null,[a(Q,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),chips:o.chips,multiple:"",label:o.label||"Tags",variant:o.variant||"solo",hint:o.hint,"persistent-hint":!0,clearable:o.clearable,items:T.value,"item-title":"title","item-value":"value"},{"prepend-item":s(()=>[a(Z,{title:"New Tag",onClick:l[0]||(l[0]=e=>L())},{prepend:s(()=>[a(N,{icon:"mdi:mdi-plus"})]),_:1}),a(_,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),a(W,{modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value=e),scrollable:!0},{default:s(()=>[a(ee,{convention:o.convention,organisation:o.organisation,onClose:l[2]||(l[2]=e=>U.value=!1),onSave:S},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}});export{O as N,pe as _};
