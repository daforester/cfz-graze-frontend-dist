import{p as je,n as Je,e as ee,t as Z,c as Ke,G as We,v as n,H as f,x as ye,I as te,a1 as Ne,a2 as ze,r as I,a3 as De,K as i,L as h,M as m,$ as Fe,S as x,a8 as ge,Z as G,Q as B,R as E,N as P,O as k,_ as we,U as Y,a4 as Qe,a0 as Xe,w as Ze}from"./index-e8318105.js";import{e as xe,T as et,d as tt,c as at}from"./FormRenderer.vue_vue_type_style_index_0_lang-63ee8df7.js";import{a as lt,F as W}from"./form-29fd1dbb.js";import{_ as ot}from"./ModelDialog.vue_vue_type_script_setup_true_lang-8d5fb095.js";import{m as nt,k as it,l as st,n as ut,o as rt,p as dt,q as mt,u as _t,r as At,s as Ut,t as Tt,v as Et,w as St,x as ct,y as Rt,z as he,A as Ve,B as Pe,_ as vt,f as Ge,g as It,h as Dt,i as Ot,j as pt,d as Ct}from"./VWindowItem-e3c4ee6a.js";import{a as oe,V as J}from"./VRow-5f4c417a.js";import{V as ue}from"./VTextField-844d1ca8.js";import{V as le}from"./copyToClipboard-1f2cd13a.js";import{u as Mt,j as ve}from"./VContainer-e1270078.js";import{v as re}from"./v4-a960c1f4.js";import{V as Ie}from"./VBtn-d373672f.js";import{e as Le,b as ft,V as yt,c as Ye}from"./VCard-bc62a89b.js";import{V as $e}from"./VDialog-0f8b6115.js";import{S as gt}from"./submission-56c4c4f1.js";import{V as Ft}from"./VAvatar-4b37c661.js";import{s as Re}from"./sortSubmissions-8ed80f07.js";import{u as Lt}from"./useStoreAPI-fa1280b9.js";import{u as bt,V as kt}from"./VToolbar-b905851e.js";import{V as Nt}from"./VSpacer-0466d463.js";import{V as Be}from"./VTable-54f1133a.js";import"./VCheckbox-7f42ebd2.js";import"./index-26b71cef.js";import"./VList-b21575d1.js";import"./VDivider-8e679238.js";import"./VChip-4409644a.js";import"./scopeId-8d2760cc.js";import"./VTextarea-d5a145c7.js";import"./userData-af5d0c4a.js";import"./VForm-60c60a9a.js";import"./VToolbarItems-d7a868be.js";var He=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(He||{});const ht=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var de=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(de||{});const Vt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var M=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(M||{});const Pt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var y=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(y||{});const Gt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Bt=je({itemsLength:{type:[Number,String],required:!0},...nt(),...it(),...st()},"VDataTableServer"),wt=Je()({name:"VDataTableServer",props:Bt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,L)=>!0},setup(e,L){let{emit:T,slots:a}=L;const{groupBy:s}=ut(e),{sortBy:u,multiSort:O,mustSort:S}=rt(e),{page:c,itemsPerPage:C}=dt(e),t=ee(()=>parseInt(e.itemsLength,10)),{columns:U,headers:l}=mt(e,{groupBy:s,showSelect:Z(e,"showSelect"),showExpand:Z(e,"showExpand")}),{items:g}=_t(e,U),{toggleSort:v}=At({sortBy:u,multiSort:O,mustSort:S,page:c}),{opened:K,isGroupOpen:V,toggleGroup:z,extractRows:$}=Ut({groupBy:s,sortBy:u}),{pageCount:ne,setItemsPerPage:ie}=Tt({page:c,itemsPerPage:C,itemsLength:t}),{flatItems:ae}=Et(g,s,K),{isSelected:Oe,select:me,selectAll:_e,toggleSelect:Ae,someSelected:Ue,allSelected:Te}=St(e,{allItems:g,currentPage:g}),{isExpanded:q,toggleExpand:pe}=ct(e),Ee=ee(()=>$(g.value));Rt({page:c,itemsPerPage:C,sortBy:u,groupBy:s,search:Z(e,"search")}),Ke("v-data-table",{toggleSort:v,sortBy:u}),We({VDataTableRows:{hideNoData:Z(e,"hideNoData"),noDataText:Z(e,"noDataText"),loading:Z(e,"loading"),loadingText:Z(e,"loadingText")}});const H=ee(()=>({page:c.value,itemsPerPage:C.value,sortBy:u.value,pageCount:ne.value,toggleSort:v,setItemsPerPage:ie,someSelected:Ue.value,allSelected:Te.value,isSelected:Oe,select:me,selectAll:_e,toggleSelect:Ae,isExpanded:q,toggleExpand:pe,isGroupOpen:V,toggleGroup:z,items:Ee.value,groupedItems:ae.value,columns:U.value,headers:l.value}));Mt(()=>{const[Ce]=he.filterProps(e),[Me]=Ve.filterProps(e),[Se]=Pe.filterProps(e),[o]=Be.filterProps(e);return n(Be,ye({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},o),{top:()=>{var r;return(r=a.top)==null?void 0:r.call(a,H.value)},default:()=>{var r,d,_,w;return a.default?a.default(H.value):n(f,null,[(r=a.colgroup)==null?void 0:r.call(a,H.value),n("thead",{class:"v-data-table__thead",role:"rowgroup"},[n(Ve,ye(Me,{sticky:e.fixedHeader}),a)]),(d=a.thead)==null?void 0:d.call(a,H.value),n("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(H.value):n(Pe,ye(Se,{items:ae.value}),a)]),(_=a.tbody)==null?void 0:_.call(a,H.value),(w=a.tfoot)==null?void 0:w.call(a,H.value)])},bottom:()=>a.bottom?a.bottom(H.value):n(he,Ce,{prepend:a["footer.prepend"]})})})}}),Yt=te({__name:"EditAdminLayout",props:Ne({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ne(["save"],["update:modelValue"]),setup(e,{emit:L}){const T=ze(e,"modelValue"),a=I(De(e.layout)),s=I([]),u=Fe(),O=({callback:t})=>{const U=()=>{t&&t("Failed to Save Layout")},l=()=>{t&&t("Layout Saved")};u.saveAdminLayout(a.value).then(g=>{g?(l(),L("save",g)):U()}).catch(()=>{U()})},S=()=>({ID:0,LayoutPanelUUID:re(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:W.FORM_TYPE_NIL,RequiredGroupMemberships:[]}),c=t=>()=>({ID:0,LayoutItemUUID:re(),LayoutPanelID:t.ID,LayoutPanelUUID:t.LayoutPanelUUID,Label:"",SourceType:de.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:t.Items.length+1}),C=t=>{const U=s.value.find(l=>l.value===t.SectionFieldUUID);U&&(t.SectionFieldID=U.object.ID,t.SectionField=U.object)};return u.getConventionForms(e.layout.ConventionUUID).then(t=>{t.forEach(U=>U.Sections.forEach(l=>l.Fields&&s.value.push(...l.Fields.map(g=>{var K;return{title:`${U.Name} - ${l.Name} - ${(K=g.Field)==null?void 0:K.Name}`,value:g.SectionFieldUUID,object:g}})))),s.value.sort(xe("title"))}),(t,U)=>(i(),h(ot,{modelValue:T.value,"onUpdate:modelValue":U[3]||(U[3]=l=>T.value=l),onSave:O,title:t.title,color:"primary"},{default:m(()=>[n(ve,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[n(oe,null,{default:m(()=>[n(J,{cols:"12",sm:"6"},{default:m(()=>[n(ue,{modelValue:a.value.Name,"onUpdate:modelValue":U[0]||(U[0]=l=>a.value.Name=l),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),n(J,{cols:"12",sm:"6"},{default:m(()=>[n(le,{modelValue:a.value.Type,"onUpdate:modelValue":U[1]||(U[1]=l=>a.value.Type=l),label:"Layout Type",items:x(ht),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),n(Ge,{modelValue:a.value.Panels,"onUpdate:modelValue":U[2]||(U[2]=l=>a.value.Panels=l),"new-item":S,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ge({_:2},[G(a.value.Panels,(l,g)=>({name:`panel_${g}`,fn:m(()=>[n(ve,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[n(oe,null,{default:m(()=>[n(J,{cols:"12",sm:"6"},{default:m(()=>[n(ue,{modelValue:l.Name,"onUpdate:modelValue":v=>l.Name=v,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(J,{cols:"12",sm:"6"},{default:m(()=>[n(le,{modelValue:l.RequiredFormType,"onUpdate:modelValue":v=>l.RequiredFormType=v,items:x(lt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),n(oe,null,{default:m(()=>[n(J,{cols:"12"},{default:m(()=>[n(vt,{label:"Required Groups",variant:"outlined",modelValue:l.RequiredGroupMemberships,"onUpdate:modelValue":v=>l.RequiredGroupMemberships=v,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),n(Ge,{modelValue:l.Items,"onUpdate:modelValue":v=>l.Items=v,"new-item":c(l),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ge({_:2},[G(l.Items,(v,K)=>({name:`item_${K}`,fn:m(()=>[n(ve,{class:"px-0 mx-0",fluid:!0},{default:m(()=>[n(oe,null,{default:m(()=>[n(J,{cols:"12",sm:"6"},{default:m(()=>[n(ue,{modelValue:v.Label,"onUpdate:modelValue":V=>v.Label=V,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),n(oe,null,{default:m(()=>[n(J,{cols:"12",sm:"6"},{default:m(()=>[n(le,{modelValue:v.SourceType,"onUpdate:modelValue":V=>v.SourceType=V,label:"Source Type",items:x(Vt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),n(J,{cols:"12",sm:"6"},{default:m(()=>[v.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(i(),h(le,{key:0,modelValue:v.SectionFieldUUID,"onUpdate:modelValue":V=>v.SectionFieldUUID=V,label:"Form Data",items:s.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:V=>C(v)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):v.SourceType==="LAYOUT_ITEM_SOURCE_META"?(i(),h(le,{key:1,modelValue:v.MetaField,"onUpdate:modelValue":V=>v.MetaField=V,label:"Miscellaneous Data",items:x(Pt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):v.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(i(),h(le,{key:2,modelValue:v.UserField,"onUpdate:modelValue":V=>v.UserField=V,label:"User Profile Data",items:x(Gt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):B("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),$t={key:1,class:"accommodationList"},Ht=te({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},registration:{},value:{default:""},venues:{}},setup(e){const L=I(!1),T=ee(()=>{if(!e.value)return[];const a=JSON.parse(e.value),s=e.accommodations.filter(u=>a.includes(u.AccommodationUUID)).sort((u,O)=>{const S=a.findIndex(C=>C===u.AccommodationUUID),c=a.findIndex(C=>C===O.AccommodationUUID);return S>c?1:-1});return De(s)});return(a,s)=>{var u,O,S;return i(),E(f,null,[a.registration.Allocation?(i(),E(f,{key:0},[P(k((u=a.accommodations.find(c=>c.AccommodationUUID===a.registration.Allocation.AccommodationUUID))==null?void 0:u.Name)+" "+k((S=(O=a.venues)==null?void 0:O.map(c=>c.Rooms.find(C=>C.RoomUUID===a.registration.Allocation.RoomUUID)).filter(c=>c!=null)[0])==null?void 0:S.Name),1)],64)):B("",!0),a.value?(i(),E("ol",$t,[(i(!0),E(f,null,G(T.value,c=>(i(),E("li",{key:c.AccommodationUUID},k(c.Name),1))),128))])):B("",!0),n(Ie,{onClick:s[0]||(s[0]=c=>L.value=!0),variant:"flat",color:"success"},{default:m(()=>[P("Assign Accommodation")]),_:1}),n($e,{modelValue:L.value,"onUpdate:modelValue":s[1]||(s[1]=c=>L.value=c)},{default:m(()=>[n(Le,null,{default:m(()=>[n(ft,null,{default:m(()=>[n(yt,null,{default:m(()=>[P("Accommodation Allocation")]),_:1})]),_:1}),n(Ye,null,{default:m(()=>[P(" WIP ")]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const qt=we(Ht,[["__scopeId","data-v-2251842e"]]),jt={key:0,class:"addonList"},Jt={key:0},Kt={key:0},Wt=te({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const L=ee(()=>{if(!e.value)return;const T=JSON.parse(e.value),a=Object.keys(T),s=De(e.extras);return s.forEach(u=>{u.Options=u.Options.filter(O=>a.includes(O.OptionUUID)?(O.Choices=O.Choices.filter(S=>S.TagUUID===T[O.OptionUUID].choiceId),T[O.OptionUUID].checked):!1)}),s.filter(u=>u.Options.length>0),s});return(T,a)=>T.value?(i(),E("ul",jt,[(i(!0),E(f,null,G(L.value,s=>(i(),E(f,{key:s.ExtraUUID},[s.Options.length?(i(),E("li",Jt,[Y("strong",null,k(s.Name),1),Y("ul",null,[(i(!0),E(f,null,G(s.Options,u=>(i(),E("li",{key:u.OptionUUID},[P(k(u.Name)+" ",1),u.Choices.length==1?(i(),E("small",Kt,"("+k(u.Choices[0].Title)+")",1)):B("",!0)]))),128))])])):B("",!0)],64))),128))])):B("",!0)}});const zt=we(Wt,[["__scopeId","data-v-55786e01"]]),Qt={key:0},Xt=te({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const L=ee(()=>{if(!e.value)return;const T=JSON.parse(e.value);return Object.entries(T).filter(([,a])=>a).map(([a,s])=>e.interests.find(u=>u.InterestUUID===a)).filter(a=>a!==void 0)});return(T,a)=>T.value?(i(),E("ul",Qt,[(i(!0),E(f,null,G(L.value,s=>(i(),E("li",{key:s.InterestUUID},k(s.Name),1))),128))])):B("",!0)}}),Zt=Y("br",null,null,-1),xt=Y("small",null,"Options:",-1),ea=Y("br",null,null,-1),ta=Y("small",null,"Addons:",-1),aa=te({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const L=ee(()=>{if(!e.value)return;let T={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{T=JSON.parse(e.value),"ticket"in T&&(T.Ticket=T.ticket),"addonsChecked"in T&&(T.AddonsChecked=T.addonsChecked),"componentsChecked"in T&&(T.ComponentsChecked=T.componentsChecked)}catch{}return T.Ticket.filter(a=>{const s=e.tickets.find(u=>u.TicketUUID===a);return!(!s||s.Type!==et.TICKET_TYPE_TICKET)}).map(a=>{const s=e.tickets.find(O=>O.TicketUUID===a),u=De(s);return u.TicketComponents=s.TicketComponents.filter(O=>T.ComponentsChecked.includes(O.TicketUUID)),u.AddonTickets=s.AddonTickets.filter(O=>T.AddonsChecked.includes(O.TicketUUID)),u})});return(T,a)=>T.value?(i(!0),E(f,{key:0},G(L.value,s=>(i(),E("div",{key:s.TicketUUID},[Y("strong",null,k(s.Name),1),s.TicketComponents.length>0?(i(),E(f,{key:0},[Zt,xt,P("  "),(i(!0),E(f,null,G(s.TicketComponents,u=>(i(),E(f,{key:u.TicketUUID},[Y("small",null,k(u.Name),1),P("  ")],64))),128))],64)):B("",!0),s.AddonTickets.length>0?(i(),E(f,{key:1},[ea,ta,P("  "),(i(!0),E(f,null,G(s.AddonTickets,u=>(i(),E("small",{key:u.TicketUUID},[P("("),Y("em",null,k(u.Name),1),P(")")]))),128))],64)):B("",!0)]))),128)):B("",!0)}}),la={key:0},oa={key:0},na=Y("strong",null,"Total:",-1),ia=te({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:L}){const T=Fe(),a=I(),s=I(),u=I(),O=I(),S=I(!1),c=t=>{console.log(t)},C=(t,U,l)=>{s.value=t,T.getRegistrationGroup(l.RegistrationUUID||"").then(g=>{u.value=g,a.value=U,O.value=l,S.value=!0})};return(t,U)=>(i(),E(f,null,[t.header.key=="actions"?(i(),h(Ie,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:U[0]||(U[0]=l=>c(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(i(),h(qt,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(i(),h(zt,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(i(),h(Xt,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(i(),h(aa,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(i(!0),E(f,{key:5},G(t.item.raw[t.header.key],l=>(i(),E("ul",{key:l.Heading},[Y("li",null,[Y("strong",null,k(l.Heading)+":",1),P(" "+k(x(gt)(l.Submission.Status))+" ",1),n(Ie,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:g=>C(l.Registration,l.Form,l.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(i(),h(Ft,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(i(),E(f,{key:7},[t.item.raw[t.header.key].length===1?(i(),E("em",la," Not in a group ")):(i(),E(f,{key:1},[Y("ul",null,[(i(!0),E(f,null,G(t.item.raw[t.header.key],l=>(i(),E("li",{key:l.UUID,class:"ml-0"},[P(" #"+k(l.Reference)+" : "+k(l.Name)+" ",1),l.IsLeader?(i(),E("strong",oa,"(Leader)")):B("",!0)]))),128))]),na,P(" "+k(t.item.raw[t.header.key].length),1)],64))],64)):(i(),E(f,{key:8},[P(k(t.item.raw[t.header.key]),1)],64)),S.value&&O.value&&a.value?(i(),h($e,{key:9,modelValue:S.value,"onUpdate:modelValue":U[3]||(U[3]=l=>S.value=l),scrollable:!0},{default:m(()=>[n(Le,{class:"bg-red-darken-4"},{default:m(()=>[n(Ye,null,{default:m(()=>[n(tt,{modelValue:a.value,"onUpdate:modelValue":U[1]||(U[1]=l=>a.value=l),admin:!0,convention:t.convention,data:O.value,editable:!0,"registration-group":u.value,onClose:U[2]||(U[2]=l=>{S.value=!1,L("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):B("",!0)],64))}}),Pa=te({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:L}){var Se;const T=Lt();L("pageTitle","Registration Manager");const a=Qe(),s=Xe(),u=I(!0);let O=((Se=a.params.convention)==null?void 0:Se.toString())||"";const S=I({ID:0,ConventionUUID:re(),OrganisationID:0,OrganisationUUID:bt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),c=Fe(),C=I({ID:0,AdminLayoutUUID:re(),ConventionID:S.value.ID,ConventionUUID:S.value.ConventionUUID,Name:"Registration Table",Type:He.ADMIN_LAYOUT_TABLE,Panels:[]}),t=I([]),U=I([]),l=I([]),g=I(1),v=I(10),K=I([]),V=I(0),z=I(!1),$=I(""),ne=I(""),ie=I(""),ae=I(""),Oe=I([]),me=I([]),_e=I([]),Ae=I([]),Ue=I([]),Te=I([]),q=I(0);Ze(q,o=>{o===7&&H()});const pe=()=>{t.value=[],U.value=[],l.value=[];try{c.getConventionAdminLayoutByName(S.value.ConventionUUID,"Registration Table").then(o=>{q.value+=1,o?C.value=o:(C.value.ConventionID=S.value.ID,C.value.ConventionUUID=S.value.ConventionUUID)})}catch{C.value.ConventionID=S.value.ID,C.value.ConventionUUID=S.value.ConventionUUID}try{c.getConventionForms(S.value.ConventionUUID).then(o=>{q.value+=1,o&&(t.value=o)})}catch{}try{c.getConventionAccommodation(S.value.ConventionUUID).then(o=>{q.value+=1,o&&(me.value=o)})}catch{}try{c.getConventionVenues(S.value.ConventionUUID).then(o=>{q.value+=1,o&&(Te.value=o)})}catch{}try{c.getConventionExtras(S.value.ConventionUUID).then(o=>{q.value+=1,o&&(_e.value=o)})}catch{}try{c.getConventionInterests(S.value.ConventionUUID).then(o=>{q.value+=1,o&&(Ae.value=o)})}catch{}try{c.getConventionTickets(S.value.ConventionUUID).then(o=>{q.value+=1,o&&(Ue.value=o)})}catch{}},Ee=({page:o,itemsPerPage:r,sortBy:d})=>{g.value=o,K.value=d;const _=l.value.find(b=>b.uuid==$.value),w=_==null?void 0:_.layout.Items;let N="",be="";if(d&&w&&d.length>=1){const b=w.find(se=>se.LayoutItemUUID==d[0].key);switch(be=d[0].order,b==null?void 0:b.MetaField){case M.META_DATA_SOURCE_ACCOMMODATION_FORM:N="submission.status";break;case M.META_DATA_SOURCE_BADGE_FORM:N="submission.status";break;case M.META_DATA_SOURCE_DEALER_FORM:N="submission.status";break;case M.META_DATA_SOURCE_REGISTRATION_FORM:N="submission.status";break;case M.META_DATA_SOURCE_REGISTRATION_REFERENCE:N="reference";break;case M.META_DATA_SOURCE_SUBMISSION_DATE:N="created";break;case M.META_DATA_SOURCE_SUBMISSION_STATUS:N="submission.status";break}switch(b==null?void 0:b.UserField){case y.USER_DATA_SOURCE_DISPLAY_NAME:N="user.display_name";break;case y.USER_DATA_SOURCE_EMAIL:N="user.email";break;case y.USER_DATA_SOURCE_FIRST_NAME:N="user.firstname";break;case y.USER_DATA_SOURCE_HANDLE:N="user.handle";break;case y.USER_DATA_SOURCE_LAST_NAME:N="user.lastname";break}}try{const b={Direction:be,Limit:r,Offset:(o-1)*r,Order:N};(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_ACCOMMODATION&&(b.Accommodation=!0),(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_BADGE&&(b.Badge=!0),(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_DEALER&&(b.Dealer=!0),(_==null?void 0:_.layout.RequiredFormType)===W.FORM_TYPE_REGISTRATION&&(b.Registration=!0),b.Email=ae.value,b.Reference=ie.value,c.searchConventionRegistrations(S.value.ConventionUUID,b).then(se=>{se&&(V.value=se.Total,U.value=se.Registrations,l.value.forEach(fe=>{const qe=fe.layout;fe.items=U.value.map(p=>{const F={};return fe.headers.forEach(ke=>{const D=qe.Items.find(Q=>Q.LayoutItemUUID===ke.key);if(D){if(D.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&D.SectionField)p.Submissions.forEach(Q=>{const j=Q.Data.find(ce=>ce.SectionFieldUUID===D.SectionFieldUUID);if(j){ke.type===at.ACCOMMODATION?F[D.LayoutItemUUID]={Data:j.Data,Registration:p}:F[D.LayoutItemUUID]=j.Data;return}});else if(D.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&D.UserField)switch(D.UserField){case y.USER_DATA_SOURCE_AVATAR:F[D.LayoutItemUUID]=T.GetProfileImageURL(p.UserUUID);break;case y.USER_DATA_SOURCE_DISPLAY_NAME:F[D.LayoutItemUUID]=p.User.DisplayName;break;case y.USER_DATA_SOURCE_EMAIL:F[D.LayoutItemUUID]=p.User.Additional.Email;break;case y.USER_DATA_SOURCE_HANDLE:F[D.LayoutItemUUID]=p.User.Handle;break;case y.USER_DATA_SOURCE_DATE_OF_BIRTH:F[D.LayoutItemUUID]=p.User.Additional.DOB;break;case y.USER_DATA_SOURCE_FIRST_NAME:F[D.LayoutItemUUID]=p.User.Additional.FirstName;break;case y.USER_DATA_SOURCE_LAST_NAME:F[D.LayoutItemUUID]=p.User.Additional.LastName;break;case y.USER_DATA_SOURCE_TELEGRAM:F[D.LayoutItemUUID]="";break}else if(D.SourceType==="LAYOUT_ITEM_SOURCE_META"&&D.MetaField){const Q=[];let j;const ce=p.Submissions.find(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_REGISTRATION});switch(D.MetaField){case M.META_DATA_SOURCE_REGISTRATION_GROUP:p.Leader?j=p:j=p.Primary,Q.push({Name:j.User.DisplayName,UUID:j.UserUUID,IsLeader:!0,Reference:j.Reference}),Q.push(...j.Members.map(A=>({Name:A.User.DisplayName,UUID:A.UserUUID,IsLeader:!1,Reference:A.Reference}))),F[D.LayoutItemUUID]=Q;break;case M.META_DATA_SOURCE_REGISTRATION_REFERENCE:F[D.LayoutItemUUID]=p.Reference;break;case M.META_DATA_SOURCE_SUBMISSION_DATE:if(ce){const A=new Date(ce.CreatedAt||"");F[D.LayoutItemUUID]=`${A.getFullYear()}-${(A.getMonth()+1).toString().padStart(2,"0")}-${A.getDate().toString().padStart(2,"0")} ${A.getHours().toString().padStart(2,"0")}:${A.getMinutes().toString().padStart(2,"0")}:${A.getSeconds().toString().padStart(2,"0")}`}else{const A=new Date(p.CreatedAt||"");F[D.LayoutItemUUID]=`${A.getFullYear()}-${(A.getMonth()+1).toString().padStart(2,"0")}-${A.getDate().toString().padStart(2,"0")} ${A.getHours().toString().padStart(2,"0")}:${A.getMinutes().toString().padStart(2,"0")}:${A.getSeconds().toString().padStart(2,"0")}`}break;case M.META_DATA_SOURCE_ACCOMMODATION_FORM:Re(p.Submissions,t.value),F[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}}).filter(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_ACCOMMODATION});break;case M.META_DATA_SOURCE_BADGE_FORM:Re(p.Submissions,t.value),F[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}}).filter(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_BADGE});break;case M.META_DATA_SOURCE_DEALER_FORM:Re(p.Submissions,t.value),F[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}}).filter(A=>{var R;return((R=A.Form)==null?void 0:R.Type)===W.FORM_TYPE_DEALER});break;case M.META_DATA_SOURCE_SUBMISSION_STATUS:Re(p.Submissions,t.value),F[D.LayoutItemUUID]=p.Submissions.map(A=>{const R=t.value.find(X=>X.FormUUID===A.FormUUID);return{Heading:R==null?void 0:R.Heading,Form:R,Submission:A,Registration:p}});break}}}}),F})}),u.value=!1)})}catch{}},H=()=>{C.value.Panels.forEach(o=>{o.Items.forEach(r=>{(r.SectionField==null||r.SectionField.Field==null)&&t.value.find(d=>{d.Sections.find(_=>{if(_.Fields){const w=_.Fields.find(N=>N.SectionFieldUUID===r.SectionFieldUUID);if(w)return r.SectionField=w,!0}})})})}),C.value.Panels.length>0&&(l.value=[],C.value.Panels.forEach(o=>{const r={uuid:re(),order:o.Order,name:o.Name,headers:[],items:[],layout:o};o.Items.sort((d,_)=>d.Order>_.Order?1:d.Order==_.Order?0:-1),r.headers=o.Items.map(d=>{var _,w;return{key:d.LayoutItemUUID,title:d.Label||((w=(_=d.SectionField)==null?void 0:_.Field)==null?void 0:w.Label)||"",align:d.Align==="end"?"end":"start",sortable:Me(d),type:Ce(d)}}),l.value.push(r)})),($.value==null||$.value=="")&&l.value.length>0&&($.value=l.value[0].uuid)};O?c.getConvention(O).then(o=>{o&&(S.value=o,pe())}).catch(()=>{s.push("/")}):s.push("/");const Ce=o=>{var r,d;if(o.SourceType===de.LAYOUT_ITEM_SOURCE_META)return`${o.SourceType}.${o.MetaField}`;if(o.SourceType===de.LAYOUT_ITEM_SOURCE_FORM)return(d=(r=o.SectionField)==null?void 0:r.Field)==null?void 0:d.Type;if(o.SourceType===de.LAYOUT_ITEM_SOURCE_USER)return`${o.SourceType}.${o.UserField}`},Me=o=>{const r=[M.META_DATA_SOURCE_ACCOMMODATION_FORM,M.META_DATA_SOURCE_BADGE_FORM,M.META_DATA_SOURCE_DEALER_FORM,M.META_DATA_SOURCE_REGISTRATION_FORM,M.META_DATA_SOURCE_REGISTRATION_REFERENCE,M.META_DATA_SOURCE_SUBMISSION_DATE,M.META_DATA_SOURCE_SUBMISSION_STATUS],d=[y.USER_DATA_SOURCE_DISPLAY_NAME,y.USER_DATA_SOURCE_EMAIL,y.USER_DATA_SOURCE_HANDLE,y.USER_DATA_SOURCE_DATE_OF_BIRTH,y.USER_DATA_SOURCE_FIRST_NAME,y.USER_DATA_SOURCE_LAST_NAME];return r.includes(o.MetaField)||d.includes(o.UserField)};return(o,r)=>(i(),h(Ct,null,{default:m(()=>[n(kt,{color:"blue-darken-4"},{default:m(()=>[n(It,{modelValue:$.value,"onUpdate:modelValue":r[0]||(r[0]=d=>$.value=d),"show-arrows":""},{default:m(()=>[(i(!0),E(f,null,G(l.value,d=>(i(),h(Dt,{key:d.uuid,value:d.uuid},{default:m(()=>[P(k(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(Nt),n(Ie,{icon:"mdi:mdi-cog-outline",onClick:r[1]||(r[1]=d=>z.value=!0)})]),_:1}),n(pt,{modelValue:$.value,"onUpdate:modelValue":r[8]||(r[8]=d=>$.value=d),disabled:!0},{default:m(()=>[(i(!0),E(f,null,G(l.value,d=>(i(),h(Ot,{key:d.uuid,value:d.uuid},{default:m(()=>[d.uuid===$.value?(i(),h(Le,{key:0,class:"pa-2"},{default:m(()=>[n(x(wt),{"items-per-page":v.value,"onUpdate:itemsPerPage":r[7]||(r[7]=_=>v.value=_),headers:d.headers,"items-length":V.value,items:d.items,"item-value":"LayoutItemUUID",loading:u.value,search:ne.value,"sort-by":Oe.value,"onUpdate:options":Ee},ge({top:m(()=>[n(ve,null,{default:m(()=>[n(oe,null,{default:m(()=>[n(J,null,{default:m(()=>[n(ue,{modelValue:ie.value,"onUpdate:modelValue":r[2]||(r[2]=_=>ie.value=_),label:"Search by Badge",onInput:r[3]||(r[3]=_=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),n(J,null,{default:m(()=>[n(ue,{modelValue:ae.value,"onUpdate:modelValue":r[4]||(r[4]=_=>ae.value=_),label:"Search By Email",onInput:r[5]||(r[5]=_=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:2},[G(d.headers,_=>({name:`item.${_.key}`,fn:m(({item:w})=>[n(ia,{header:_,item:w,accommodations:me.value,convention:S.value,extras:_e.value,interests:Ae.value,tickets:Ue.value,venues:Te.value,onReload:r[6]||(r[6]=N=>Ee({page:g.value,itemsPerPage:v.value,sortBy:K.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading","search","sort-by"])]),_:2},1024)):B("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),z.value?(i(),h(Yt,{key:0,title:"Edit Layout",modelValue:z.value,"onUpdate:modelValue":r[9]||(r[9]=d=>z.value=d),layout:C.value,onSave:r[10]||(r[10]=d=>{z.value=!1,H()})},null,8,["modelValue","layout"])):B("",!0)]),_:1}))}});export{Pa as default};
