import{p as Ne,n as Pe,e as W,t as j,c as we,G as Ye,v as r,H as M,x as Ae,I as Q,a1 as fe,a2 as $e,r as A,a3 as ce,K as s,L,M as v,$ as pe,S as z,a8 as De,Z as V,Q as w,R as T,O as N,_ as Me,U as Y,N as G,a4 as Be,a0 as He,w as Ge}from"./index-4a25dcfa.js";import{a as xe,F as ee}from"./form-e2a93b7c.js";import{_ as qe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-a22e8346.js";import{m as je,j as Je,k as Ke,l as ze,n as We,o as Qe,p as Xe,u as Ze,q as et,r as tt,s as at,t as lt,v as ot,w as nt,x as it,y as Oe,z as ye,A as Ce,_ as ge,f as st,g as ut,h as rt,i as dt,d as mt}from"./VWindowItem-c9313c98.js";import{e as Ut,T as ct,d as _t}from"./FormRenderer.vue_vue_type_style_index_0_lang-7054227e.js";import{a as Ue,V as J}from"./VRow-f6a03976.js";import{V as Ee}from"./VTextField-f8719587.js";import{V as Z}from"./copyToClipboard-7f303c91.js";import{u as St,j as Ie}from"./VContainer-69edc0fd.js";import{v as le}from"./v4-a960c1f4.js";import{S as vt}from"./submission-56c4c4f1.js";import{V as Re}from"./VBtn-bbbdae65.js";import{V as Tt}from"./VAvatar-cc0f62a5.js";import{c as At,e as ke}from"./VCard-ffe4f128.js";import{V as Et}from"./VDialog-2fcb4785.js";import{s as It}from"./sortSubmissions-ed9e4490.js";import{u as Dt}from"./useStoreAPI-7f2b5582.js";import{u as Rt,V as pt}from"./VToolbar-2d2e6172.js";import{V as ft}from"./VSpacer-1f52008e.js";import{V as Le}from"./VTable-80b5e4b5.js";import"./VChip-bcbd4683.js";import"./scopeId-30540d81.js";import"./VCheckbox-8e10d9ba.js";import"./VToolbarItems-16eb0dab.js";import"./VList-0b6a8220.js";import"./VDivider-02fe315e.js";import"./index-71069b21.js";import"./VTextarea-aef0b83f.js";import"./userData-44f934f6.js";import"./VForm-b372c523.js";var he=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(he||{});const Ot=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var oe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(oe||{});const yt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var K=(e=>(e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(K||{});const Ct=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var p=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(p||{});const gt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Lt=Ne({itemsLength:{type:[Number,String],required:!0},...je(),...Je(),...Ke()},"VDataTableServer"),Mt=Pe()({name:"VDataTableServer",props:Lt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,g)=>!0},setup(e,g){let{emit:d,slots:a}=g;const{groupBy:n}=ze(e),{sortBy:u,multiSort:E,mustSort:_}=We(e),{page:I,itemsPerPage:y}=Qe(e),l=W(()=>parseInt(e.itemsLength,10)),{columns:m,headers:o}=Xe(e,{groupBy:n,showSelect:j(e,"showSelect"),showExpand:j(e,"showExpand")}),{items:f}=Ze(e,m),{toggleSort:S}=et({sortBy:u,multiSort:E,mustSort:_,page:I}),{opened:B,isGroupOpen:k,toggleGroup:q,extractRows:P}=tt({groupBy:n,sortBy:u}),{pageCount:ne,setItemsPerPage:ie}=at({page:I,itemsPerPage:y,itemsLength:l}),{flatItems:te}=lt(f,n,B),{isSelected:se,select:ue,selectAll:$,toggleSelect:_e,someSelected:re,allSelected:de}=ot(e,{allItems:f,currentPage:f}),{isExpanded:Se,toggleExpand:ve}=nt(e),me=W(()=>P(f.value));it({page:I,itemsPerPage:y,sortBy:u,groupBy:n,search:j(e,"search")}),we("v-data-table",{toggleSort:S,sortBy:u}),Ye({VDataTableRows:{hideNoData:j(e,"hideNoData"),noDataText:j(e,"noDataText"),loading:j(e,"loading"),loadingText:j(e,"loadingText")}});const t=W(()=>({page:I.value,itemsPerPage:y.value,sortBy:u.value,pageCount:ne.value,toggleSort:S,setItemsPerPage:ie,someSelected:re.value,allSelected:de.value,isSelected:se,select:ue,selectAll:$,toggleSelect:_e,isExpanded:Se,toggleExpand:ve,isGroupOpen:k,toggleGroup:q,items:me.value,groupedItems:te.value,columns:m.value,headers:o.value}));St(()=>{const[U]=Oe.filterProps(e),[i]=ye.filterProps(e),[c]=Ce.filterProps(e),[F]=Le.filterProps(e);return r(Le,Ae({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},F),{top:()=>{var C;return(C=a.top)==null?void 0:C.call(a,t.value)},default:()=>{var C,ae,O,x;return a.default?a.default(t.value):r(M,null,[(C=a.colgroup)==null?void 0:C.call(a,t.value),r("thead",{class:"v-data-table__thead",role:"rowgroup"},[r(ye,Ae(i,{sticky:e.fixedHeader}),a)]),(ae=a.thead)==null?void 0:ae.call(a,t.value),r("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(t.value):r(Ce,Ae(c,{items:te.value}),a)]),(O=a.tbody)==null?void 0:O.call(a,t.value),(x=a.tfoot)==null?void 0:x.call(a,t.value)])},bottom:()=>a.bottom?a.bottom(t.value):r(Oe,U,{prepend:a["footer.prepend"]})})})}}),kt=Q({__name:"EditAdminLayout",props:fe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:fe(["save"],["update:modelValue"]),setup(e,{emit:g}){const d=$e(e,"modelValue"),a=A(ce(e.layout)),n=A([]),u=pe(),E=({callback:l})=>{const m=()=>{l&&l("Failed to Save Layout")},o=()=>{l&&l("Layout Saved")};u.saveAdminLayout(a.value).then(f=>{f?(o(),g("save",f)):m()}).catch(()=>{m()})},_=()=>({ID:0,LayoutPanelUUID:le(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:ee.FORM_TYPE_NIL}),I=l=>()=>({ID:0,LayoutItemUUID:le(),LayoutPanelID:l.ID,LayoutPanelUUID:l.LayoutPanelUUID,Label:"",SourceType:oe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:l.Items.length+1}),y=l=>{const m=n.value.find(o=>o.value===l.SectionFieldUUID);m&&(l.SectionFieldID=m.object.ID,l.SectionField=m.object)};return u.getConventionForms(e.layout.ConventionUUID).then(l=>{l.forEach(m=>m.Sections.forEach(o=>o.Fields&&n.value.push(...o.Fields.map(f=>{var B;return{title:`${m.Name} - ${o.Name} - ${(B=f.Field)==null?void 0:B.Name}`,value:f.SectionFieldUUID,object:f}})))),n.value.sort(Ut("title"))}),(l,m)=>(s(),L(qe,{modelValue:d.value,"onUpdate:modelValue":m[3]||(m[3]=o=>d.value=o),onSave:E,title:l.title,color:"primary"},{default:v(()=>[r(Ie,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[r(Ue,null,{default:v(()=>[r(J,{cols:"12",sm:"6"},{default:v(()=>[r(Ee,{modelValue:a.value.Name,"onUpdate:modelValue":m[0]||(m[0]=o=>a.value.Name=o),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(J,{cols:"12",sm:"6"},{default:v(()=>[r(Z,{modelValue:a.value.Type,"onUpdate:modelValue":m[1]||(m[1]=o=>a.value.Type=o),label:"Layout Type",items:z(Ot),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),r(ge,{modelValue:a.value.Panels,"onUpdate:modelValue":m[2]||(m[2]=o=>a.value.Panels=o),"new-item":_,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},De({_:2},[V(a.value.Panels,(o,f)=>({name:`panel_${f}`,fn:v(()=>[r(Ie,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[r(Ue,null,{default:v(()=>[r(J,{cols:"12",sm:"6"},{default:v(()=>[r(Ee,{modelValue:o.Name,"onUpdate:modelValue":S=>o.Name=S,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(J,{cols:"12",sm:"6"},{default:v(()=>[r(Z,{modelValue:o.RequiredFormType,"onUpdate:modelValue":S=>o.RequiredFormType=S,items:z(xe),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),r(ge,{modelValue:o.Items,"onUpdate:modelValue":S=>o.Items=S,"new-item":I(o),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},De({_:2},[V(o.Items,(S,B)=>({name:`item_${B}`,fn:v(()=>[r(Ie,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[r(Ue,null,{default:v(()=>[r(J,{cols:"12",sm:"6"},{default:v(()=>[r(Ee,{modelValue:S.Label,"onUpdate:modelValue":k=>S.Label=k,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),r(Ue,null,{default:v(()=>[r(J,{cols:"12",sm:"6"},{default:v(()=>[r(Z,{modelValue:S.SourceType,"onUpdate:modelValue":k=>S.SourceType=k,label:"Source Type",items:z(yt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),r(J,{cols:"12",sm:"6"},{default:v(()=>[S.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(s(),L(Z,{key:0,modelValue:S.SectionFieldUUID,"onUpdate:modelValue":k=>S.SectionFieldUUID=k,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:k=>y(S)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):S.SourceType==="LAYOUT_ITEM_SOURCE_META"?(s(),L(Z,{key:1,modelValue:S.MetaField,"onUpdate:modelValue":k=>S.MetaField=k,label:"Miscellaneous Data",items:z(Ct),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):S.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(s(),L(Z,{key:2,modelValue:S.UserField,"onUpdate:modelValue":k=>S.UserField=k,label:"User Profile Data",items:z(gt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),ht={key:0,class:"accommodationList"},bt=Q({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(e){const g=W(()=>{if(!e.value)return[];const d=JSON.parse(e.value),a=e.accommodations.filter(n=>d.includes(n.AccommodationUUID)).sort((n,u)=>{const E=d.findIndex(I=>I===n.AccommodationUUID),_=d.findIndex(I=>I===u.AccommodationUUID);return E>_?1:-1});return ce(a)});return(d,a)=>d.value?(s(),T("ol",ht,[(s(!0),T(M,null,V(g.value,n=>(s(),T("li",{key:n.AccommodationUUID},N(n.Name),1))),128))])):w("",!0)}});const Vt=Me(bt,[["__scopeId","data-v-1ba5f67a"]]),Ft={key:0,class:"addonList"},Nt={key:0},Pt=Q({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const g=W(()=>{if(!e.value)return;const d=JSON.parse(e.value),a=Object.keys(d),n=ce(e.extras);return n.forEach(u=>{u.Options=u.Options.filter(E=>a.includes(E.OptionUUID)?(E.Choices=E.Choices.filter(_=>_.TagUUID===d[E.OptionUUID].choiceId),d[E.OptionUUID].checked):!1)}),n.filter(u=>u.Options.length>0),n});return(d,a)=>d.value?(s(),T("ul",Ft,[(s(!0),T(M,null,V(g.value,n=>(s(),T("li",{key:n.ExtraUUID},[Y("strong",null,N(n.Name),1),Y("ul",null,[(s(!0),T(M,null,V(n.Options,u=>(s(),T("li",{key:u.OptionUUID},[G(N(u.Name)+" ",1),u.Choices.length==1?(s(),T("small",Nt,"("+N(u.Choices[0].Title)+")",1)):w("",!0)]))),128))])]))),128))])):w("",!0)}});const wt=Me(Pt,[["__scopeId","data-v-4ed6842b"]]),Yt={key:0},$t=Q({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const g=W(()=>{if(!e.value)return;const d=JSON.parse(e.value);return Object.entries(d).filter(([,a])=>a).map(([a,n])=>e.interests.find(u=>u.InterestUUID===a)).filter(a=>a!==void 0)});return(d,a)=>d.value?(s(),T("ul",Yt,[(s(!0),T(M,null,V(g.value,n=>(s(),T("li",{key:n.InterestUUID},N(n.Name),1))),128))])):w("",!0)}}),Bt=Y("br",null,null,-1),Ht=Y("small",null,"Options:",-1),Gt=Y("br",null,null,-1),xt=Y("small",null,"Addons:",-1),qt=Q({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const g=W(()=>{if(!e.value)return;let d={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{d=JSON.parse(e.value),"ticket"in d&&(d.Ticket=d.ticket),"addonsChecked"in d&&(d.AddonsChecked=d.addonsChecked),"componentsChecked"in d&&(d.ComponentsChecked=d.componentsChecked)}catch{}return d.Ticket.filter(a=>{const n=e.tickets.find(u=>u.TicketUUID===a);return!(!n||n.Type!==ct.TICKET_TYPE_TICKET)}).map(a=>{const n=e.tickets.find(E=>E.TicketUUID===a),u=ce(n);return u.TicketComponents=n.TicketComponents.filter(E=>d.ComponentsChecked.includes(E.TicketUUID)),u.AddonTickets=n.AddonTickets.filter(E=>d.AddonsChecked.includes(E.TicketUUID)),u})});return(d,a)=>d.value?(s(!0),T(M,{key:0},V(g.value,n=>(s(),T("div",{key:n.TicketUUID},[Y("strong",null,N(n.Name),1),n.TicketComponents.length>0?(s(),T(M,{key:0},[Bt,Ht,G("  "),(s(!0),T(M,null,V(n.TicketComponents,u=>(s(),T(M,{key:u.TicketUUID},[Y("small",null,N(u.Name),1),G("  ")],64))),128))],64)):w("",!0),n.AddonTickets.length>0?(s(),T(M,{key:1},[Gt,xt,G("  "),(s(!0),T(M,null,V(n.AddonTickets,u=>(s(),T("small",{key:u.TicketUUID},[G("("),Y("em",null,N(u.Name),1),G(")")]))),128))],64)):w("",!0)]))),128)):w("",!0)}}),jt=Q({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:g}){const d=pe(),a=A(),n=A(),u=A(),E=A(),_=A(!1),I=l=>{console.log(l)},y=(l,m,o)=>{n.value=l,d.getRegistrationGroup(o.RegistrationUUID||"").then(f=>{u.value=f,a.value=m,E.value=o,_.value=!0})};return(l,m)=>(s(),T(M,null,[l.header.key=="actions"?(s(),L(Re,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:m[0]||(m[0]=o=>I(l.item.raw))})):l.header.type==="ACCOMMODATION"&&l.accommodations.length>0?(s(),L(Vt,{key:1,value:l.item.raw[l.header.key],accommodations:l.accommodations},null,8,["value","accommodations"])):l.header.type==="EXTRAS"&&l.extras.length>0?(s(),L(wt,{key:2,value:l.item.raw[l.header.key],extras:l.extras},null,8,["value","extras"])):l.header.type==="INTERESTS"&&l.interests.length>0?(s(),L($t,{key:3,value:l.item.raw[l.header.key],interests:l.interests},null,8,["value","interests"])):l.header.type==="TICKET"&&l.tickets.length>0?(s(),L(qt,{key:4,value:l.item.raw[l.header.key],tickets:l.tickets},null,8,["value","tickets"])):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(s(!0),T(M,{key:5},V(l.item.raw[l.header.key],o=>(s(),T("ul",{key:o.Heading},[Y("li",null,[Y("strong",null,N(o.Heading)+":",1),G(" "+N(z(vt)(o.Submission.Status))+" ",1),r(Re,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>y(o.Registration,o.Form,o.Submission)},null,8,["onClick"])])]))),128)):l.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(s(),L(Tt,{key:6,class:"rounded-circle",src:l.item.raw[l.header.key],height:"32",width:"32"},null,8,["src"])):(s(),T(M,{key:7},[G(N(l.item.raw[l.header.key]),1)],64)),_.value&&E.value&&a.value?(s(),L(Et,{key:8,modelValue:_.value,"onUpdate:modelValue":m[3]||(m[3]=o=>_.value=o),scrollable:!0},{default:v(()=>[r(ke,{class:"bg-red-darken-4"},{default:v(()=>[r(At,null,{default:v(()=>[r(_t,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=o=>a.value=o),admin:!0,convention:l.convention,data:E.value,editable:!0,"registration-group":u.value,onClose:m[2]||(m[2]=o=>{_.value=!1,g("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):w("",!0)],64))}}),pa=Q({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:g}){var me;const d=Dt();g("pageTitle","Registration Manager");const a=Be(),n=He(),u=A(!0);let E=((me=a.params.convention)==null?void 0:me.toString())||"";const _=A({ID:0,ConventionUUID:le(),OrganisationID:0,OrganisationUUID:Rt,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),I=pe(),y=A({ID:0,AdminLayoutUUID:le(),ConventionID:_.value.ID,ConventionUUID:_.value.ConventionUUID,Name:"Registration Table",Type:he.ADMIN_LAYOUT_TABLE,Panels:[]}),l=A([]),m=A([]),o=A([]),f=A(1),S=A(10),B=A([]),k=A(0),q=A(!1),P=A(""),ne=A([]),ie=A([]),te=A([]),se=A([]),ue=A([]),$=A(0);Ge($,t=>{t===7&&de()});const _e=()=>{l.value=[],m.value=[],o.value=[];try{I.getConventionAdminLayoutByName(_.value.ConventionUUID,"Registration Table").then(t=>{$.value+=1,t?y.value=t:(y.value.ConventionID=_.value.ID,y.value.ConventionUUID=_.value.ConventionUUID)})}catch{y.value.ConventionID=_.value.ID,y.value.ConventionUUID=_.value.ConventionUUID}try{I.getConventionForms(_.value.ConventionUUID).then(t=>{$.value+=1,t&&(l.value=t)})}catch{}try{I.getConventionAccommodation(_.value.ConventionUUID).then(t=>{$.value+=1,t&&(ne.value=t)})}catch{}try{I.getConventionVenues(_.value.ConventionUUID).then(t=>{$.value+=1,t&&(ue.value=t)})}catch{}try{I.getConventionExtras(_.value.ConventionUUID).then(t=>{$.value+=1,t&&(ie.value=t)})}catch{}try{I.getConventionInterests(_.value.ConventionUUID).then(t=>{$.value+=1,t&&(te.value=t)})}catch{}try{I.getConventionTickets(_.value.ConventionUUID).then(t=>{$.value+=1,t&&(se.value=t)})}catch{}},re=({page:t,itemsPerPage:U,sortBy:i})=>{f.value=t,B.value=i;const c=o.value.find(O=>O.uuid==P.value),F=c==null?void 0:c.layout.Items;let C="",ae="";if(i&&F&&i.length>=1){const O=F.find(x=>x.LayoutItemUUID==i[0].key);switch(ae=i[0].order,O==null?void 0:O.MetaField){case K.META_DATA_SOURCE_SUBMISSION_DATE:C="created";break;case K.META_DATA_SOURCE_SUBMISSION_STATUS:C="submission.status";break}switch(O==null?void 0:O.UserField){case p.USER_DATA_SOURCE_DISPLAY_NAME:C="user.display_name";break;case p.USER_DATA_SOURCE_EMAIL:C="user.email";break;case p.USER_DATA_SOURCE_FIRST_NAME:C="user.firstname";break;case p.USER_DATA_SOURCE_HANDLE:C="user.handle";break;case p.USER_DATA_SOURCE_LAST_NAME:C="user.lastname";break}}try{const O={Direction:ae,Limit:U,Offset:(t-1)*U,Order:C};(c==null?void 0:c.layout.RequiredFormType)===ee.FORM_TYPE_ACCOMMODATION&&(O.Accommodation=!0),(c==null?void 0:c.layout.RequiredFormType)===ee.FORM_TYPE_BADGE&&(O.Badge=!0),(c==null?void 0:c.layout.RequiredFormType)===ee.FORM_TYPE_DEALER&&(O.Dealer=!0),(c==null?void 0:c.layout.RequiredFormType)===ee.FORM_TYPE_REGISTRATION&&(O.Registration=!0),I.searchConventionRegistrations(_.value.ConventionUUID,O).then(x=>{x&&(k.value=x.Total,m.value=x.Registrations,o.value.forEach(Te=>{const be=Te.layout;Te.items=m.value.map(h=>{const b={};return Te.headers.forEach(Ve=>{const D=be.Items.find(X=>X.LayoutItemUUID===Ve.key);if(D){if(D.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&D.SectionField)h.Submissions.forEach(X=>{const R=X.Data.find(H=>H.SectionFieldUUID===D.SectionFieldUUID);if(R){b[D.LayoutItemUUID]=R.Data;return}});else if(D.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&D.UserField)switch(D.UserField){case p.USER_DATA_SOURCE_AVATAR:b[D.LayoutItemUUID]=d.GetProfileImageURL(h.UserUUID);break;case p.USER_DATA_SOURCE_DISPLAY_NAME:b[D.LayoutItemUUID]=h.User.DisplayName;break;case p.USER_DATA_SOURCE_EMAIL:b[D.LayoutItemUUID]=h.User.Additional.Email;break;case p.USER_DATA_SOURCE_HANDLE:b[D.LayoutItemUUID]=h.User.Handle;break;case p.USER_DATA_SOURCE_DATE_OF_BIRTH:b[D.LayoutItemUUID]=h.User.Additional.DOB;break;case p.USER_DATA_SOURCE_FIRST_NAME:b[D.LayoutItemUUID]=h.User.Additional.FirstName;break;case p.USER_DATA_SOURCE_LAST_NAME:b[D.LayoutItemUUID]=h.User.Additional.LastName;break;case p.USER_DATA_SOURCE_TELEGRAM:b[D.LayoutItemUUID]="";break}else if(D.SourceType==="LAYOUT_ITEM_SOURCE_META"&&D.MetaField){const X=h.Submissions.find(R=>{var H;return((H=R.Form)==null?void 0:H.Type)===ee.FORM_TYPE_REGISTRATION});switch(D.MetaField){case K.META_DATA_SOURCE_SUBMISSION_DATE:if(X){const R=new Date(X.CreatedAt||"");b[D.LayoutItemUUID]=`${R.getFullYear()}-${R.getMonth().toString().padStart(2,"0")}-${R.getDate().toString().padStart(2,"0")} ${R.getHours().toString().padStart(2,"0")}:${R.getMinutes().toString().padStart(2,"0")}:${R.getSeconds()}`}else{const R=new Date(h.CreatedAt||"");b[D.LayoutItemUUID]=`${R.getFullYear()}-${R.getMonth().toString().padStart(2,"0")}-${R.getDate().toString().padStart(2,"0")} ${R.getHours().toString().padStart(2,"0")}:${R.getMinutes().toString().padStart(2,"0")}:${R.getSeconds()}`}break;case K.META_DATA_SOURCE_SUBMISSION_STATUS:It(h.Submissions,l.value),b[D.LayoutItemUUID]=h.Submissions.map(R=>{const H=l.value.find(Fe=>Fe.FormUUID===R.FormUUID);return{Heading:H==null?void 0:H.Heading,Form:H,Submission:R,Registration:h}});break}}}}),b})}),u.value=!1)})}catch{}},de=()=>{y.value.Panels.forEach(t=>{t.Items.forEach(U=>{(U.SectionField==null||U.SectionField.Field==null)&&l.value.find(i=>{i.Sections.find(c=>{if(c.Fields){const F=c.Fields.find(C=>C.SectionFieldUUID===U.SectionFieldUUID);if(F)return U.SectionField=F,!0}})})})}),y.value.Panels.length>0&&(o.value=[],y.value.Panels.forEach(t=>{const U={uuid:le(),order:t.Order,name:t.Name,headers:[],items:[],layout:t};t.Items.sort((i,c)=>i.Order>c.Order?1:i.Order==c.Order?0:-1),U.headers=t.Items.map(i=>{var c,F;return{key:i.LayoutItemUUID,title:i.Label||((F=(c=i.SectionField)==null?void 0:c.Field)==null?void 0:F.Label)||"",align:i.Align==="end"?"end":"start",sortable:ve(i),type:Se(i)}}),o.value.push(U)})),(P.value==null||P.value=="")&&o.value.length>0&&(P.value=o.value[0].uuid)};E?I.getConvention(E).then(t=>{t&&(_.value=t,_e())}).catch(()=>{n.push("/")}):n.push("/");const Se=t=>{var U,i;if(t.SourceType===oe.LAYOUT_ITEM_SOURCE_META)return`${t.SourceType}.${t.MetaField}`;if(t.SourceType===oe.LAYOUT_ITEM_SOURCE_FORM)return(i=(U=t.SectionField)==null?void 0:U.Field)==null?void 0:i.Type;if(t.SourceType===oe.LAYOUT_ITEM_SOURCE_USER)return`${t.SourceType}.${t.UserField}`},ve=t=>{const U=[K.META_DATA_SOURCE_SUBMISSION_DATE,K.META_DATA_SOURCE_SUBMISSION_STATUS],i=[p.USER_DATA_SOURCE_DISPLAY_NAME,p.USER_DATA_SOURCE_EMAIL,p.USER_DATA_SOURCE_HANDLE,p.USER_DATA_SOURCE_DATE_OF_BIRTH,p.USER_DATA_SOURCE_FIRST_NAME,p.USER_DATA_SOURCE_LAST_NAME];return U.includes(t.MetaField)||i.includes(t.UserField)};return(t,U)=>(s(),L(mt,null,{default:v(()=>[r(pt,{color:"blue-darken-4"},{default:v(()=>[r(st,{modelValue:P.value,"onUpdate:modelValue":U[0]||(U[0]=i=>P.value=i),"show-arrows":""},{default:v(()=>[(s(!0),T(M,null,V(o.value,i=>(s(),L(ut,{key:i.uuid,value:i.uuid},{default:v(()=>[G(N(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(ft),r(Re,{icon:"mdi:mdi-cog-outline",onClick:U[1]||(U[1]=i=>q.value=!0)})]),_:1}),r(dt,{modelValue:P.value,"onUpdate:modelValue":U[4]||(U[4]=i=>P.value=i)},{default:v(()=>[(s(!0),T(M,null,V(o.value,i=>(s(),L(rt,{key:i.uuid,value:i.uuid},{default:v(()=>[i.uuid===P.value?(s(),L(ke,{key:0,class:"pa-2"},{default:v(()=>[r(z(Mt),{"items-per-page":S.value,"onUpdate:itemsPerPage":U[3]||(U[3]=c=>S.value=c),headers:i.headers,"items-length":k.value,items:i.items,"item-value":"LayoutItemUUID",loading:u.value,"onUpdate:options":re},De({_:2},[V(i.headers,c=>({name:`item.${c.key}`,fn:v(({item:F})=>[r(jt,{header:c,item:F,accommodations:ne.value,convention:_.value,extras:ie.value,interests:te.value,tickets:se.value,venues:ue.value,onReload:U[2]||(U[2]=C=>re({page:f.value,itemsPerPage:S.value,sortBy:B.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):w("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),q.value?(s(),L(kt,{key:0,title:"Edit Layout",modelValue:q.value,"onUpdate:modelValue":U[5]||(U[5]=i=>q.value=i),layout:y.value,onSave:U[6]||(U[6]=i=>{q.value=!1,de()})},null,8,["modelValue","layout"])):w("",!0)]),_:1}))}});export{pa as default};
