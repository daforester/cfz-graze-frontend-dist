import{I as S,a0 as O,r as o,K as s,L as g,M as a,v as t,N as i,O as y,Q as p,S as r,P as H,R as C,H as G,U as f,$ as K,V as Q,W as J,_ as X}from"./index-5f076c3f.js";import{s as N}from"./index-71069b21.js";import{S as q}from"./setupLogin-b85f42dc.js";import{E as d}from"./emailFormVariant-e5e0aad4.js";import{V as _,a as L}from"./VRow-0ef1b1df.js";import{V as B}from"./VTextField-e130b985.js";import{V as D}from"./VBtn-4189d8b7.js";import{j as $}from"./VContainer-c825bc01.js";import{V as Y}from"./VForm-c79847a7.js";import{G as ee}from"./userData-bca27b65.js";import{b as ae,V as te,c as le,e as se}from"./VCard-1988631a.js";import"./VAvatar-36d291c5.js";const b=h=>(Q("data-v-289c018a"),h=h(),J(),h),re={key:1,class:"ma-auto text-left"},oe={key:2,class:"ma-auto text-left"},ne={key:3,class:"ma-auto text-left"},ue=b(()=>f("br",null,null,-1)),ie=b(()=>f("br",null,null,-1)),de={class:"text-red-darken-1 font-weight-bold"},ce=b(()=>f("br",null,null,-1)),me=b(()=>f("br",null,null,-1)),ve=b(()=>f("br",null,null,-1)),fe=b(()=>f("span",{class:"text-red-darken-4"}," Please contact registration for further assistance. ",-1)),pe=S({__name:"EmailLoginForm",props:{variant:{default:()=>d.COMBINED}},setup(h){const A=O(),V=K(),k=o(!0),M=o(!1),R=o(!1),w=o(!1),c=o(""),E=o(""),I=o(!1),m=o({required:e=>!!e||"Required.",min:e=>e.length>=8||"Min 8 characters",email:e=>!!e.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),n=o(""),u=o(!1),x=new URL(location.href).searchParams.get("token")||"";x!==""&&(k.value=!1,w.value=!0,V.validateAccount(x).then(({created:e,tokens:l,user:v})=>{try{q(l,v,A,e)}catch(F){console.error(F)}}).catch(e=>{n.value=e.ErrorMessage}));const T=()=>(n.value="",!(m.value.required(c.value)!==!0||m.value.email(c.value)!==!0||m.value.required(E.value)!==!0||m.value.min(E.value)!==!0)),W=e=>{if(e.preventDefault(),!T())return;const v=new URL(location.href).searchParams.get("state");u.value=!0,V.oAuthLogin("internal",c.value,E.value,v||"").then(({created:F,tokens:j,user:Z})=>{q(j,Z,A,F)}).catch(()=>{n.value="Login failed, check credentials or register",u.value=!1})},U=e=>{e.preventDefault(),T()&&(u.value=!0,V.registerAccount(c.value,E.value).then(l=>{k.value=!1,l&&(R.value=!0)}).catch(()=>{n.value="Unable to register, address may be in use",u.value=!1}))},z=()=>{V.requestLoginLink(c.value).then(e=>{k.value=!1,e&&(M.value=!0)}).catch(()=>{n.value="A problem was encountered, please try again",u.value=!1})};return(e,l)=>k.value?(s(),g(Y,{key:0,onSubmit:l[3]||(l[3]=H(()=>{},["stop"])),class:"ma-auto vForm",disabled:u.value},{default:a(()=>[t(L,null,{default:a(()=>[t(_,null,{default:a(()=>[t(B,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=v=>c.value=v),rules:[m.value.required,m.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(L,null,{default:a(()=>[t(_,null,{default:a(()=>[t(B,{margin:"normal",required:"",name:"password",label:"Password",type:I.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:E.value,"onUpdate:modelValue":l[1]||(l[1]=v=>E.value=v),"append-icon":I.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":l[2]||(l[2]=v=>I.value=!I.value),counter:"",hint:"At least 8 characters",rules:[m.value.required,m.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),n.value?(s(),g(L,{key:0},{default:a(()=>[t(_,{class:"text-red-darken-1 font-weight-bold"},{default:a(()=>[i(y(n.value),1)]),_:1})]),_:1})):p("",!0),t(L,{justify:"space-between"},{default:a(()=>[e.variant===r(d).COMBINED||e.variant===r(d).REGISTER?(s(),g(_,{key:0,cols:"12",sm:"6"},{default:a(()=>[t(D,{onClick:U,color:"orange-darken-2",disabled:u.value},{default:a(()=>[i(" Register ")]),_:1},8,["disabled"])]),_:1})):p("",!0),e.variant===r(d).COMBINED||e.variant===r(d).LOGIN?(s(),g(_,{key:1,cols:"12",sm:"6"},{default:a(()=>[t(D,{onClick:W,color:"primary",disabled:u.value,type:"submit"},{default:a(()=>[i(" Sign In ")]),_:1},8,["disabled"])]),_:1})):p("",!0),e.variant===r(d).ADD_CREDENTIAL?(s(),g(_,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:a(()=>[t(D,{onClick:U,color:"orange-darken-2",disabled:u.value},{default:a(()=>[i(" Add Email ")]),_:1},8,["disabled"])]),_:1})):p("",!0)]),_:1}),e.variant===r(d).COMBINED||e.variant===r(d).LOGIN?(s(),g($,{key:1},{default:a(()=>[t(L,null,{default:a(()=>[t(_,null,{default:a(()=>[t(D,{variant:"text",onClick:z},{default:a(()=>[i(y(r(N).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)]),_:1},8,["disabled"])):M.value?(s(),C("p",re,y(r(N).messageResetEmail),1)):R.value?(s(),C("p",oe,y(r(N).messageVerifyNewAccountEmail),1)):w.value?(s(),C("p",ne,[i(y(r(N).messageVerifiedNewAccountMessage)+" ",1),n.value?(s(),C(G,{key:0},[ue,ie,f("span",de,[i(" An error occurred creating account:"),ce,i(" "+y(n.value),1)]),me,ve,fe],64)):p("",!0)])):p("",!0)}});const P=X(pe,[["__scopeId","data-v-289c018a"]]),_e=f("h2",null,"Email",-1),Ne=S({__name:"LoginWithEmailView",props:{variant:{default:()=>d.COMBINED}},emits:["pageTitle"],setup(h,{emit:A}){A("pageTitle","Email Login");const V=O(),k=ee(),R=new URL(location.href).searchParams.get("token")||"";return k&&h.variant!=="ADD_CREDENTIAL"&&!R&&V.push("/"),(w,c)=>w.variant=="ADD_CREDENTIAL"?(s(),g($,{key:0,style:{"max-width":"550px"}},{default:a(()=>[t(se,null,{default:a(()=>[t(ae,{class:"text-center"},{default:a(()=>[t(te,null,{default:a(()=>[i("Add an E-Mail Address")]),_:1})]),_:1}),t(le,null,{default:a(()=>[t(P,{variant:w.variant},null,8,["variant"])]),_:1})]),_:1})]),_:1})):(s(),C(G,{key:1},[_e,t(P,{variant:w.variant},null,8,["variant"])],64))}});export{Ne as default};
