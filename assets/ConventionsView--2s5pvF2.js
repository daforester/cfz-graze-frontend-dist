import{F as X}from"./form-0fJbSFPv.js";import{P as Z}from"./permission-7wLhDNXq.js";import{i as M,M as F,N as z,r as m,k as $,w as H,n as r,q as v,v as e,f as t,C as L,P as Y,_ as q,b as ee,l as te,A as U,y as oe,x as k,D as ne,B as O,V as ae,Q as le,F as ie,W as se}from"./index-ik0QYYk7.js";import{a as K}from"./scopeId-q2hM7sKD.js";import{_ as ue}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-zkzDbkDV.js";import{u as re}from"./useModel-qMLlZnHV.js";import{_ as de}from"./ModelDialog.vue_vue_type_script_setup_true_lang-jz96FwpL.js";import{s as h}from"./index-OKsbKlsK.js";import{a as Q}from"./VContainer-3X6hK5Ga.js";import{V as N,a as p}from"./VRow-922kOt7T.js";import{V as W}from"./VAvatar-kAeKjQJv.js";import{V as A}from"./VTextField-PkW1NbAg.js";import{V as me}from"./VTextarea-Mo9uioWZ.js";import{V as ve}from"./VCheckbox-sLuCfUkr.js";import{V as ce}from"./VForm-Q8JlxWIU.js";import{V as fe}from"./VFileInput-h2JHDtkf.js";import{G as B}from"./group-7fhbY6WJ.js";import{C as G}from"./canDo-vn18dSlC.js";import{C as pe}from"./canEditRegistrations-2LoHnn1-.js";import{C as ge}from"./canViewOperations-Rse78M8K.js";import{G as J}from"./userData-zNLAVkC1.js";import{V as Ce,a as Ve,b as _e,c as j,d as De,e as Ue}from"./VCard-UAQatwM3.js";import{V as R}from"./VBtn-mOo7GuVa.js";import{C as Ie}from"./canEditOrganisation-sDS3BKzt.js";import{v as ye}from"./v4-yQnnJER4.js";import"./createSimpleFunctional-KHzSE-WO.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-4EY2_pMb.js";import"./forwardRefs-5Xa4SWKH.js";import"./VDialog-hvGXMXR_.js";import"./VToolbar-YGxJNE-d.js";import"./VCheckboxBtn-qREdG6g9.js";import"./VChip-QoMeCmC_.js";const we=(g=void 0,C=void 0)=>g===void 0?!1:C===void 0?G(g,B.GROUP_TYPE_CONVENTION).EditConvention:G(g,B.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).EditConvention,Le=(g,C)=>g===void 0?!1:G(g,B.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).ViewRegistration,Ne=M({__name:"EditConventionDialog",props:F({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:F(["update:convention","delete","save"],["update:modelValue"]),setup(g,{emit:C}){const S=g,w=Y(),o=K(),{title:c=""}=S,V=C,I=z(g,"modelValue"),_=re(S,V,void 0,void 0,"convention"),a=m($(_.value));H(_,()=>{a.value=$(_.value)});const D=m(`${o.GetConventionLogoURL(a.value.ConventionUUID)}?${new Date().getTime()}`),y=m(),x=m(),E=()=>{D.value=URL.createObjectURL(y.value.files[0])},T=()=>{V("delete")},u=()=>{a.value=$(_.value)},d=async()=>{var l;const i=new FormData((l=x.value)==null?void 0:l.$el);if(i.get("Image")&&i.get("Image").size>0)return i.set("ConventionUUID",a.value.ConventionUUID),await o.SaveConventionLogo(i)},f=i=>{d(),w.saveConvention(a.value).then(l=>{l?i&&i("Convention Data Saved").then(()=>{_.value=l,V("save",l)}):i&&i("Failed to save")}).catch(()=>{i("Failed to save")})};return(i,l)=>(r(),v(de,{modelValue:I.value,"onUpdate:modelValue":l[5]||(l[5]=n=>I.value=n),onDelete:T,onReset:u,onSave:f,title:L(c),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(Q,{class:"pa-0",fluid:!0},{default:e(()=>[t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(W,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(A,{label:L(h).formLabelName,name:"Name",variant:"outlined",modelValue:a.value.Name,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.Name=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(me,{label:L(h).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:a.value.Description,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.Description=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(A,{label:L(h).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:a.value.DetailLink,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.DetailLink=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(A,{label:L(h).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:a.value.Slug,"onUpdate:modelValue":l[3]||(l[3]=n=>a.value.Slug=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(ve,{label:L(h).formConventionVisible,name:"Visible",modelValue:a.value.Visible,"onUpdate:modelValue":l[4]||(l[4]=n=>a.value.Visible=n)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(p,null,{default:e(()=>[t(ce,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[t(fe,{label:L(h).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),xe=q(Ne,[["__scopeId","data-v-319537e0"]]),ke=["innerHTML"],be={key:0,class:"text-green"},Se={key:1,class:"text-red"},Te={key:0,class:"text-green"},he={key:1,class:"text-red"},Re=M({__name:"ConventionCard",props:F({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:F(["delete","duplicated"],["update:modelValue"]),setup(g,{emit:C}){const S=Y(),w=C,o=z(g,"modelValue"),c=K(),V=J(),I=m(c.GetConventionLogoURL(o.value.ConventionUUID)),_=m(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),a=m(!1),D=m(!1),y=m(!1),x=m(we(V,o.value)),E=m(pe(V,o.value)),T=m(Le(V,o.value)),u=m(ge(V,o.value)),d=()=>{y.value=!1,I.value=`${c.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},f=n=>{S.deleteConvention(o.value.ConventionUUID).then(s=>{s?n&&(n("Convention Deleted"),w("delete")):n&&n("Failed to Delete Convention"),setTimeout(()=>{D.value=!1},2e3)}).catch(()=>{n&&(n("Failed to Delete Organisation"),D.value=!1)})},i=()=>{S.duplicateConvention(o.value.ConventionUUID).then(n=>{n&&w("duplicated",n)})},l=n=>{n.altKey&&n.ctrlKey&&n.code==="KeyA"&&(a.value=!a.value)};return window.addEventListener("keydown",l),ee(()=>{window.removeEventListener("keydown",l)}),(n,s)=>{const P=te("RouterLink");return r(),v(Ue,null,{default:e(()=>[t(Ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[I.value?(r(),v(W,{key:0,src:I.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),o.value.Name?(r(),v(Ve,{key:1},{default:e(()=>[k(oe(o.value.Name)+" ",1),x.value&&a.value?(r(),v(R,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:i})):U("",!0)]),_:1})):U("",!0),o.value.Description?(r(),v(_e,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ne("div",{innerHTML:o.value.Description},null,8,ke)]),_:1})):U("",!0),t(j,{class:"px-0 pb-0"},{default:e(()=>[k(" Visibility:  "),o.value.Visible?(r(),O("span",be,"Visible")):(r(),O("span",Se,"Hidden"))]),_:1}),t(j,{class:"px-0 pb-0"},{default:e(()=>[k(" Registration:  "),n.open?(r(),O("span",Te,"Open")):(r(),O("span",he,"Closed"))]),_:1})]),_:1}),t(De,null,{default:e(()=>[t(N,{"no-gutters":""},{default:e(()=>[x.value?(r(),v(p,{key:0,class:"ma-1"},{default:e(()=>[t(R,{variant:"tonal",color:"primary",onClick:s[0]||(s[0]=b=>y.value=!0),width:"100%"},{default:e(()=>[k("Edit")]),_:1})]),_:1})):U("",!0),U("",!0),x.value?(r(),v(p,{key:2,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t(R,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[k("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),T.value||E.value?(r(),v(p,{key:3,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t(R,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[k("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),u.value?(r(),v(p,{key:4,class:"ma-1"},{default:e(()=>[t(P,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/operations`},{default:e(()=>[t(R,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[k("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),y.value?(r(),v(xe,{key:0,modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=b=>y.value=b),convention:o.value,"onUpdate:convention":s[2]||(s[2]=b=>o.value=b),onDelete:s[3]||(s[3]=b=>D.value=!0),onSave:d,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),D.value?(r(),v(ue,{key:1,modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=b=>D.value=b),"confirmation-text":"I UNDERSTAND",message:_.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:f},null,8,["modelValue","message"])):U("",!0)]),_:1})}}}),Ee=q(Re,[["__scopeId","data-v-9433b945"]]),Oe=M({__name:"ConventionsView",emits:["pageTitle"],setup(g,{emit:C}){var T;C("pageTitle","Conventions");const w=Y(),o=J(),c=m([]),V=m([]),I=ae();let _=((T=I.params.organisation)==null?void 0:T.toString())||"";const a=m();H(I,()=>{var u,d;_!==((u=I.params.organisation)==null?void 0:u.toString())&&(_=((d=I.params.organisation)==null?void 0:d.toString())||"",D())});const D=()=>{_?w.getOrganisation(_).then(u=>{u&&(a.value=u,w.getConventionList(u.OrganisationUUID).then(d=>{d&&(c.value=d.sort((f,i)=>f.ID>i.ID?-1:f.ID<i.ID?1:0),y())}))}).catch(()=>{}):w.getPermissionAccessList(Z.PERMISSION_TYPE_NULL).then(u=>{u&&(c.value=u.Conventions,y())})},y=()=>{c.value.forEach(u=>{w.getConventionForms(u.ConventionUUID).then(d=>{d&&(V.value=[...V.value,...d])}).catch(d=>{console.error(d)})})},x=()=>{var u,d;if(a.value){const f={ID:0,ConventionUUID:ye(),OrganisationID:((u=a.value)==null?void 0:u.ID)||0,OrganisationUUID:((d=a.value)==null?void 0:d.OrganisationUUID)||se,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};w.saveConvention(f).then(i=>{i&&c.value.push(i)})}},E=u=>{c.value.splice(u,1)};return D(),(u,d)=>(r(),v(Q,null,{default:e(()=>[t(N,{class:"justify-center"},{default:e(()=>[(r(!0),O(ie,null,le(c.value,(f,i)=>(r(),v(p,{key:f.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var l,n;return[t(Ee,{modelValue:c.value[i],"onUpdate:modelValue":s=>c.value[i]=s,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((l=f.Organisation)==null?void 0:l.Slug)||((n=f.Organisation)==null?void 0:n.OrganisationUUID)||"",open:!!V.value.find(s=>s.ConventionUUID===f.ConventionUUID&&s.Type===L(X).FORM_TYPE_REGISTRATION&&s.State&&s.State.New),onDelete:s=>E(i),onDuplicated:s=>c.value.push(s)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),t(N,null,{default:e(()=>[a.value&&L(Ie)(L(o),a.value)?(r(),v(p,{key:0,class:"text-right"},{default:e(()=>[t(R,{color:"primary",onClick:x},{default:e(()=>[k("New")]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}}),ft=q(Oe,[["__scopeId","data-v-76e8f543"]]);export{ft as default};
