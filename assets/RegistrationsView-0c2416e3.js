import{p as kt,n as Nt,e as ue,t as ge,c as Lt,G as Ft,v as t,H as N,x as je,I as ie,a0 as Ee,a1 as Ge,r as A,K as ve,M as s,N as H,O as o,a3 as fe,W as q,a2 as ze,a4 as Z,S as j,w as oe,X as M,Q as P,V as I,P as Y,_ as Ye,ac as Pt,E as at,k as wt,f as $t,d as Bt,o as Gt,ad as ot,Y as vt,Z as _t,a7 as Yt,a6 as Ht}from"./index-fd039bbf.js";import{e as xt,T as qt,d as jt,V as Qt,c as Kt}from"./FormRenderer.vue_vue_type_style_index_0_lang-caf84061.js";import{a as zt,F as Ae}from"./form-29fd1dbb.js";import{_ as He}from"./ModelDialog.vue_vue_type_script_setup_true_lang-23af8286.js";import{m as Wt,k as Jt,l as Xt,n as Zt,o as ea,p as ta,q as aa,u as oa,r as na,s as la,t as ia,v as sa,w as ra,x as ua,y as da,z as nt,A as lt,B as it,a as ma,_ as ca,f as st,c as Ut,d as At,e as Tt,b as Et,V as ft,g as va,h as _a,i as Ua,j as Aa}from"./VWindowItem-867b14b7.js";import{V as ee,a as w}from"./VRow-eb7ca009.js";import{V as Te}from"./VTextField-432895e5.js";import{V as ne}from"./copyToClipboard-116ab9d7.js";import{u as Ta,j as Ce,V as Ea}from"./VContainer-6c2443d8.js";import{V as fa,u as Je}from"./VCheckbox-dc30e65c.js";import{v as Me}from"./v4-a960c1f4.js";import{h as $e,b as Sa,a as Da,c as Ia,d as pa,P as St,u as Dt}from"./useDisplayTransactions-395bb5bc.js";import{V as Be,a as Le}from"./VList-e74935d6.js";import{V as le}from"./VBtn-ea688579.js";import{b as It,c as rt}from"./submission-2c955912.js";import{V as Ra}from"./forwardRefs-9945fb57.js";import{V as ya}from"./VAvatar-7993a765.js";import{V as pt,a as ga}from"./VToolbar-3fb450ae.js";import{V as Xe,a as Oa}from"./scopeId-f6a90536.js";import{c as Ca,e as Rt,V as ha}from"./VCard-3209ead3.js";import{V as Ma}from"./VDialog-e7697d0a.js";import{s as ba}from"./sortSubmissions-8ed80f07.js";import{_ as We}from"./SaveButton.vue_vue_type_script_setup_true_lang-aabba4c8.js";import{u as Qe}from"./nil-d01db1aa.js";import{V as ut,a as Va}from"./VTable-edef279d.js";import"./index-26b71cef.js";import"./VTextarea-95954adb.js";import"./VChip-b3495130.js";import"./userData-b06ffc8d.js";import"./VForm-8848c8b5.js";import"./VToolbarItems-0226c5c5.js";import"./VDivider-d6863b80.js";import"./createSimpleFunctional-36978db2.js";var yt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(yt||{});const ka=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Fe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Fe||{});const Na=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var K=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(K||{});const La=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var X=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(X||{});const Fa=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Pa=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Send Error"}return"Unknown"},wa=kt({itemsLength:{type:[Number,String],required:!0},...Wt(),...Jt(),...Xt()},"VDataTableServer"),$a=Nt()({name:"VDataTableServer",props:wa(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,D)=>!0},setup(e,D){let{emit:r,slots:l}=D;const{groupBy:n}=Zt(e),{sortBy:u,multiSort:c,mustSort:d}=ea(e),{page:U,itemsPerPage:T}=ta(e),v=ue(()=>parseInt(e.itemsLength,10)),{columns:a,headers:i}=aa(e,{groupBy:n,showSelect:ge(e,"showSelect"),showExpand:ge(e,"showExpand")}),{items:E}=oa(e,a),{toggleSort:_}=na({sortBy:u,multiSort:c,mustSort:d,page:U}),{opened:V,isGroupOpen:f,toggleGroup:k,extractRows:R}=la({groupBy:n,sortBy:u}),{pageCount:O,setItemsPerPage:Q}=ia({page:U,itemsPerPage:T,itemsLength:v}),{flatItems:se}=sa(E,n,V),{isSelected:Se,select:De,selectAll:C,toggleSelect:h,someSelected:L,allSelected:y}=ra(e,{allItems:E,currentPage:E}),{isExpanded:B,toggleExpand:W}=ua(e),te=ue(()=>R(E.value));da({page:U,itemsPerPage:T,sortBy:u,groupBy:n,search:ge(e,"search")}),Lt("v-data-table",{toggleSort:_,sortBy:u}),Ft({VDataTableRows:{hideNoData:ge(e,"hideNoData"),noDataText:ge(e,"noDataText"),loading:ge(e,"loading"),loadingText:ge(e,"loadingText")}});const z=ue(()=>({page:U.value,itemsPerPage:T.value,sortBy:u.value,pageCount:O.value,toggleSort:_,setItemsPerPage:Q,someSelected:L.value,allSelected:y.value,isSelected:Se,select:De,selectAll:C,toggleSelect:h,isExpanded:B,toggleExpand:W,isGroupOpen:f,toggleGroup:k,items:te.value,groupedItems:se.value,columns:a.value,headers:i.value}));Ta(()=>{const[de]=nt.filterProps(e),[re]=lt.filterProps(e),[Ie]=it.filterProps(e),[pe]=ut.filterProps(e);return t(ut,je({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},pe),{top:()=>{var Re;return(Re=l.top)==null?void 0:Re.call(l,z.value)},default:()=>{var Re,be,Pe,Ve;return l.default?l.default(z.value):t(N,null,[(Re=l.colgroup)==null?void 0:Re.call(l,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(lt,je(re,{sticky:e.fixedHeader}),l)]),(be=l.thead)==null?void 0:be.call(l,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(z.value):t(it,je(Ie,{items:se.value}),l)]),(Pe=l.tbody)==null?void 0:Pe.call(l,z.value),(Ve=l.tfoot)==null?void 0:Ve.call(l,z.value)])},bottom:()=>l.bottom?l.bottom(z.value):t(nt,de,{prepend:l["footer.prepend"]})})})}}),Ba=ie({__name:"EditAdminLayout",props:Ee({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["save"],["update:modelValue"]),setup(e,{emit:D}){const r=Ge(e,"modelValue"),l=A(ve(e.layout)),n=A([]),u=fe(),c=({callback:v})=>{const a=()=>{v&&v("Failed to Save Layout")},i=()=>{v&&v("Layout Saved")};u.saveAdminLayout(l.value).then(E=>{E?(i(),D("save",E)):a()}).catch(()=>{a()})},d=()=>({ID:0,LayoutPanelUUID:Me(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:Ae.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),U=v=>()=>({ID:0,LayoutItemUUID:Me(),LayoutPanelID:v.ID,LayoutPanelUUID:v.LayoutPanelUUID,Label:"",SourceType:Fe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:v.Items.length+1,DefaultSort:!1}),T=v=>{const a=n.value.find(i=>i.value===v.SectionFieldUUID);a&&(v.SectionFieldID=a.object.ID,v.SectionField=a.object)};return u.getConventionForms(e.layout.ConventionUUID).then(v=>{v.forEach(a=>a.Sections.forEach(i=>i.Fields&&n.value.push(...i.Fields.map(E=>{var V;return{title:`${a.Name} - ${i.Name} - ${(V=E.Field)==null?void 0:V.Name}`,value:E.SectionFieldUUID,object:E}})))),n.value.sort(xt("title"))}),(v,a)=>(s(),H(He,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=i=>r.value=i),onSave:c,title:v.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:l.value.Name,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value.Name=i),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:l.value.Type,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value.Type=i),label:"Layout Type",items:q(ka),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(st,{modelValue:l.value.Panels,"onUpdate:modelValue":a[2]||(a[2]=i=>l.value.Panels=i),"new-item":d,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},ze({_:2},[Z(l.value.Panels,(i,E)=>({name:`panel_${E}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:i.Name,"onUpdate:modelValue":_=>i.Name=_,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:i.RequiredFormType,"onUpdate:modelValue":_=>i.RequiredFormType=_,items:q(zt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ma,{label:"Required Groups",variant:"outlined",modelValue:i.RequiredGroupMemberships,"onUpdate:modelValue":_=>i.RequiredGroupMemberships=_,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ca,{label:"Registration Tags",variant:"outlined",modelValue:i.RequiredRegistrationTags,"onUpdate:modelValue":_=>i.RequiredRegistrationTags=_,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(st,{modelValue:i.Items,"onUpdate:modelValue":_=>i.Items=_,"new-item":U(i),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},ze({_:2},[Z(i.Items,(_,V)=>({name:`item_${V}`,fn:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6"},{default:o(()=>[t(Te,{modelValue:_.Label,"onUpdate:modelValue":f=>_.Label=f,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{modelValue:_.SourceType,"onUpdate:modelValue":f=>_.SourceType=f,label:"Source Type",items:q(Na),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(w,{cols:"12",sm:"6"},{default:o(()=>[_.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(s(),H(ne,{key:0,modelValue:_.SectionFieldUUID,"onUpdate:modelValue":f=>_.SectionFieldUUID=f,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:f=>T(_)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):_.SourceType==="LAYOUT_ITEM_SOURCE_META"?(s(),H(ne,{key:1,modelValue:_.MetaField,"onUpdate:modelValue":f=>_.MetaField=f,label:"Miscellaneous Data",items:q(La),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):_.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(s(),H(ne,{key:2,modelValue:_.UserField,"onUpdate:modelValue":f=>_.UserField=f,label:"User Profile Data",items:q(Fa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):j("",!0)]),_:2},1024)]),_:2},1024),t(ee,null,{default:o(()=>[t(w,null,{default:o(()=>[t(fa,{modelValue:_.DefaultSort,"onUpdate:modelValue":f=>_.DefaultSort=f,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ga=M("br",null,null,-1),Ya=M("h3",null,"Assigned Accommodation",-1),Ha=M("br",null,null,-1),xa=M("br",null,null,-1),qa=M("h3",null,"Accommodation Preferences",-1),ja=M("h3",null,"Selected Tickets",-1),Qa=M("br",null,null,-1),Ka=ie({__name:"EditAccommodationAssignmentDialog",props:Ee({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:field"],["update:modelValue"]),setup(e,{emit:D}){const r=e,{convention:l,registration:n,title:u=""}=r,c=fe(),d=Ge(e,"modelValue"),U=A({capacity:{max:C=>{var y;const h=O.value.find(B=>B.room.RoomUUID===C);return!h||h.room.MaximumCapacity===0?!0:(((y=i.value)==null?void 0:y.Members.length)||0)<=h.room.MaximumCapacity||"Too many people in the group for this room"},min:C=>{var y;const h=O.value.find(B=>B.room.RoomUUID===C);return!h||h.room.MinimumCapacity===0?!0:(((y=i.value)==null?void 0:y.Members.length)||0)>=h.room.MinimumCapacity||"Not enough people in the group for this room"}}}),T=A([]),v=Je(r,D,void 0,void 0,"field"),a=A(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const i=A(),E=A(""),_=A(""),V=A([]),f=A({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),k=async()=>{var y;const C=await c.getConventionAvailableAccommodation(l.ConventionUUID);C&&(T.value=C);const h=await c.getRegistrationGroup(n.RegistrationUUID||"");h&&(i.value=h);const L=await c.getConventionTickets(l.ConventionUUID);L&&(V.value=L);try{f.value=JSON.parse(((y=i.value)==null?void 0:y.TicketData)||"")}catch{}};oe(E,()=>{_.value=O.value.length>0?O.value[0].value:""});const R=ue(()=>{const C=Q.value;return T.value.map(h=>{let L;return C.forEach(y=>{h.Costs.forEach(B=>{B.DateStart===(y==null?void 0:y.DateStart)&&B.DateEnd===y.DateEnd&&(L===void 0||L>B.Availability)&&(L=B.Availability)})}),{label:`${h.Name}`,title:`${h.Name} (${L} Available)`,value:h.AccommodationUUID}})}),O=ue(()=>{const C=Q.value,h=T.value.find(L=>L.AccommodationUUID===E.value);return(h==null?void 0:h.Pool.map(L=>{var B,W;let y;return C.forEach(te=>{L.Costs.forEach(z=>{z.DateStart===(te==null?void 0:te.DateStart)&&z.DateEnd===te.DateEnd&&(y===void 0||y>z.Availability)&&(y=z.Availability)})}),{label:`${(B=L.Venue)==null?void 0:B.Name} - ${L.Name}`,title:`${(W=L.Venue)==null?void 0:W.Name} - ${L.Name} (${y} Available)`,value:L.RoomUUID,room:L}}))||[]}),Q=ue(()=>[...f.value.Ticket,...f.value.AddonsChecked,...f.value.ComponentsChecked].map(C=>V.value.find(h=>h.TicketUUID===C)).filter(C=>C!==void 0&&C.RequiresAccommodation)),se=C=>{var h;c.assignAccommodation(((h=i.value)==null?void 0:h.Registration.RegistrationUUID)||"",E.value,_.value,!1).then(L=>{L?(k(),C&&C("Room Assigned")):C&&C("Room not assigned")}).catch(()=>{C&&C("Room not assigned")})},Se=C=>{var h,L;(h=i.value)!=null&&h.Registration.AllocationUUID?c.deleteAllocation(((L=i.value)==null?void 0:L.Registration.AllocationUUID)||"").then(y=>{y?(k(),C&&C("Allocation Deleted")):C&&C("Allocation not deleted")}).catch(()=>{C&&C("Allocation not deleted")}):C&&C("Nothing to Delete")},De=C=>{var L,y;const h=(L=T.value.find(B=>B.AccommodationUUID===C.AccommodationUUID))==null?void 0:L.Pool;if(h){const B=h.find(W=>W.RoomUUID===C.RoomUUID);if(B)return`${(y=B.Venue)==null?void 0:y.Name} - ${B.Name}`}return""};return k(),(C,h)=>{var L;return s(),H(He,{modelValue:d.value,"onUpdate:modelValue":h[2]||(h[2]=y=>d.value=y),title:q(u),color:"primary","show-close-action":!0,"show-delete-action":!!((L=i.value)!=null&&L.Registration.Allocation),"show-save-action":!!_.value,"save-button-label":"Assign Room",onDelete:Se,onSave:se,fullscreen:!0,persistent:!0},{default:o(()=>[t(Ce,{class:"pa-0",fluid:!0},{default:o(()=>[t(ee,null,{default:o(()=>{var y;return[t(w,{cols:"12",md:"6"},{default:o(()=>{var B,W;return[M("h3",null,"Group Members ("+P((B=i.value)==null?void 0:B.Members.length)+")",1),(s(!0),I(N,null,Z((W=i.value)==null?void 0:W.Members,te=>(s(),I(N,{key:te.UUID},[Y(" #"+P(te.Reference)+" "+P(te.Name),1),Ga],64))),128))]}),_:1}),(y=i.value)!=null&&y.Registration.Allocation?(s(),H(w,{key:0,cols:"12",md:"6"},{default:o(()=>[Ya,t(Be,null,{default:o(()=>{var B;return[(s(!0),I(N,null,Z((B=i.value)==null?void 0:B.Registration.Allocation.Periods,W=>(s(),H(Le,{key:W.AllocationPeriodUUID},{default:o(()=>{var te;return[Y(P((te=T.value.find(z=>z.AccommodationUUID===W.AccommodationUUID))==null?void 0:te.Name)+" ",1),Ha,Y(" "+P(De(W))+" ",1),xa,M("small",null,"("+P(q($e)(W.DateStart))+" - "+P(q($e)(W.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):j("",!0)]}),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12",md:"6"},{default:o(()=>[C.selectedAccommodation.length?(s(),I(N,{key:0},[qa,t(Be,null,{default:o(()=>[(s(!0),I(N,null,Z(C.selectedAccommodation,(y,B)=>(s(),H(Le,{key:y.AccommodationUUID},{default:o(()=>[Y(P(B+1)+". "+P(y.Name),1)]),_:2},1024))),128))]),_:1})],64)):j("",!0)]),_:1}),t(w,{cosl:"12",md:"6"},{default:o(()=>[ja,t(Be,null,{default:o(()=>[(s(!0),I(N,null,Z(Q.value,y=>(s(),H(Le,{key:y==null?void 0:y.TicketUUID},{default:o(()=>[Y(P(y.Name)+" ",1),Qa,M("small",null,"("+P(q($e)(y.DateStart))+" - "+P(q($e)(y.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12",md:"6"},{default:o(()=>[t(ne,{modelValue:E.value,"onUpdate:modelValue":h[0]||(h[0]=y=>E.value=y),items:R.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(w,{cols:"12",md:"6"},{default:o(()=>[t(ne,{modelValue:_.value,"onUpdate:modelValue":h[1]||(h[1]=y=>_.value=y),items:O.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[U.value.capacity.min,U.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),za={key:0,class:"accommodationList"},Wa={key:0,class:"text-orange-darken-2"},Ja=ie({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const D=A(!1),r=ue(()=>{if(!e.value)return[];const n=JSON.parse(e.value),u=e.accommodations.filter(c=>n.includes(c.AccommodationUUID)).sort((c,d)=>{const U=n.findIndex(v=>v===c.AccommodationUUID),T=n.findIndex(v=>v===d.AccommodationUUID);return U>T?1:-1});return ve(u)}),l=ue(()=>{let n;const u=e.forms.find(c=>c.Sections.find(d=>{var U;return(U=d.Fields)==null?void 0:U.find(T=>{var v;if(((v=T.Field)==null?void 0:v.Type)==="TICKET")return n=T,!0})}));return n?!!e.registration.Submissions.find(c=>{if(c.FormUUID==(u==null?void 0:u.FormUUID))return c.Data.find(d=>{if(d.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const U=JSON.parse(d.Data);return e.tickets.filter(T=>T.RequiresAccommodation).find(T=>U.Ticket.includes(T.TicketUUID)||U.AddonsChecked.includes(T.TicketUUID)||U.ComponentsChecked.includes(T.TicketUUID))}})}):!1});return(n,u)=>l.value?(s(),I(N,{key:0},[n.value?(s(),I("ol",za,[(s(!0),I(N,null,Z(r.value,c=>(s(),I("li",{key:c.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(d=>d.AccommodationUUID===c.AccommodationUUID)?(s(),I("strong",Wa,P(c.Name),1)):(s(),I(N,{key:1},[Y(P(c.Name),1)],64))]))),128))])):j("",!0),t(le,{onClick:u[0]||(u[0]=c=>D.value=!0),variant:"flat",color:"success"},{default:o(()=>[Y("Assign Accommodation")]),_:1}),n.convention&&D.value?(s(),H(Ka,{key:1,modelValue:D.value,"onUpdate:modelValue":u[1]||(u[1]=c=>D.value=c),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":r.value},null,8,["modelValue","convention","registration","selected-accommodation"])):j("",!0)],64)):j("",!0)}});const Xa=Ye(Ja,[["__scopeId","data-v-7a102d46"]]),Za={key:0,class:"addonList"},eo={key:0},to={key:0},ao=ie({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const D=ue(()=>{if(!e.value)return;const r=JSON.parse(e.value),l=Object.keys(r),n=ve(e.extras);return n.forEach(u=>{u.Options=u.Options.filter(c=>l.includes(c.OptionUUID)?(c.Choices=c.Choices.filter(d=>d.TagUUID===r[c.OptionUUID].choiceId),r[c.OptionUUID].checked):!1)}),n.filter(u=>u.Options.length>0),n});return(r,l)=>r.value?(s(),I("ul",Za,[(s(!0),I(N,null,Z(D.value,n=>(s(),I(N,{key:n.ExtraUUID},[n.Options.length?(s(),I("li",eo,[M("strong",null,P(n.Name),1),M("ul",null,[(s(!0),I(N,null,Z(n.Options,u=>(s(),I("li",{key:u.OptionUUID},[Y(P(u.Name)+" ",1),u.Choices.length==1?(s(),I("small",to,"("+P(u.Choices[0].Title)+")",1)):j("",!0)]))),128))])])):j("",!0)],64))),128))])):j("",!0)}});const oo=Ye(ao,[["__scopeId","data-v-55786e01"]]),no={key:0},lo=ie({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const D=ue(()=>{if(!e.value)return;const r=JSON.parse(e.value);return Object.entries(r).filter(([,l])=>l).map(([l,n])=>e.interests.find(u=>u.InterestUUID===l)).filter(l=>l!==void 0)});return(r,l)=>r.value?(s(),I("ul",no,[(s(!0),I(N,null,Z(D.value,n=>(s(),I("li",{key:n.InterestUUID},P(n.Name),1))),128))])):j("",!0)}}),io=M("br",null,null,-1),so=M("small",null,"Options:",-1),ro=M("br",null,null,-1),uo=M("small",null,"Addons:",-1),mo=ie({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const D=ue(()=>{if(!e.value)return;let r={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{r=JSON.parse(e.value),"ticket"in r&&(r.Ticket=r.ticket),"addonsChecked"in r&&(r.AddonsChecked=r.addonsChecked),"componentsChecked"in r&&(r.ComponentsChecked=r.componentsChecked)}catch{}return r.Ticket.filter(l=>{const n=e.tickets.find(u=>u.TicketUUID===l);return!(!n||n.Type!==qt.TICKET_TYPE_TICKET)}).map(l=>{const n=e.tickets.find(c=>c.TicketUUID===l),u=ve(n);return u.TicketComponents=n.TicketComponents.filter(c=>r.ComponentsChecked.includes(c.TicketUUID)),u.AddonTickets=n.AddonTickets.filter(c=>r.AddonsChecked.includes(c.TicketUUID)),u})});return(r,l)=>r.value?(s(!0),I(N,{key:0},Z(D.value,n=>(s(),I("div",{key:n.TicketUUID},[M("strong",null,P(n.Name),1),n.TicketComponents.length>0?(s(),I(N,{key:0},[io,so,Y("  "),(s(!0),I(N,null,Z(n.TicketComponents,u=>(s(),I(N,{key:u.TicketUUID},[M("small",null,P(u.Name),1),Y("  ")],64))),128))],64)):j("",!0),n.AddonTickets.length>0?(s(),I(N,{key:1},[ro,uo,Y("  "),(s(!0),I(N,null,Z(n.AddonTickets,u=>(s(),I("small",{key:u.TicketUUID},[Y("("),M("em",null,P(u.Name),1),Y(")")]))),128))],64)):j("",!0)]))),128)):j("",!0)}}),co={key:0,class:"text-blue text-center"},vo={key:1,class:"text-red text-center"},_o={key:2,class:"text-orange text-center"},Uo={key:3,class:"text-orange text-center"},Ao={key:4,class:"text-orange text-center"},To={key:5,class:"text-orange text-center"},Eo={key:6,class:"text-green text-center"},fo={key:0},So={key:0},Do=M("strong",null,"Total:",-1),Io=ie({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload"],setup(e,{emit:D}){const r=fe(),l=A(),n=A(),u=A(),c=A(),d=A(!1),U=(a,i,E)=>{n.value=a,r.getRegistrationGroup(E.RegistrationUUID||"").then(_=>{u.value=_,l.value=i,c.value=E,d.value=!0})},T=a=>{D("openActions",a)},v=a=>{D("openPayments",a)};return(a,i)=>(s(),I(N,null,[a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(s(),H(Xa,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(s(),H(oo,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(s(),H(lo,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(s(),H(mo,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(s(!0),I(N,{key:4},Z(a.item.raw[a.header.key],E=>(s(),I("ul",{key:E.Heading},[M("li",null,[M("strong",null,P(E.Heading)+":",1),Y(" "+P(q(It)(E.Submission.Status))+" ",1),t(le,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:_=>U(E.Registration,E.Form,E.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(s(),H(ya,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(s(),I(N,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(s(),I("div",co,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(s(),I("div",vo,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(s(),I("div",_o,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(s(),I("div",Uo,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(s(),I("div",Ao,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(s(),I("div",To,"Awaiting Additional Payments")):(s(),I("div",Eo,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(s(),I(N,{key:7},[t(le,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:i[0]||(i[0]=E=>T(a.item.raw[a.header.key]))}),t(le,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:i[1]||(i[1]=E=>v(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(s(),I(N,{key:8},[a.item.raw[a.header.key].length===1?(s(),I("em",fo," Not in a group ")):(s(),I(N,{key:1},[M("ul",null,[(s(!0),I(N,null,Z(a.item.raw[a.header.key],E=>(s(),I("li",{key:E.UUID,class:"ml-0"},[Y(" #"+P(E.Reference)+" : "+P(E.Name)+" ",1),E.IsLeader?(s(),I("strong",So,"(Leader)")):j("",!0)]))),128))]),Do,Y(" "+P(a.item.raw[a.header.key].length),1)],64))],64)):(s(),I(N,{key:9},[Y(P(a.item.raw[a.header.key]),1)],64)),d.value&&c.value&&l.value?(s(),H(Ma,{key:10,modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=E=>d.value=E),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(Rt,{class:"bg-red-darken-4"},{default:o(()=>[t(pt,{color:"error"},{default:o(()=>[t(ga,null,{default:o(()=>[Y("Submission Editor - Admin Mode")]),_:1}),t(Xe),t(Ra,null,{default:o(()=>[t(le,{icon:"mdi:mdi-window-close",onClick:i[2]||(i[2]=E=>d.value=!1)})]),_:1})]),_:1}),t(Ca,null,{default:o(()=>[t(jt,{modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=E=>l.value=E),admin:!0,convention:a.convention,data:c.value,editable:!0,"registration-group":u.value,onClose:i[4]||(i[4]=E=>{d.value=!1,D("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0)],64))}});var po=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Ro=function(e){return po.map(function(D){return D.toLowerCase()}).indexOf(e.toLowerCase())!==-1},yo=function(e,D,r){Object.keys(D).filter(Ro).forEach(function(l){var n=D[l];typeof n=="function"&&(l==="onInit"?n(e,r):r.on(l.substring(2),function(u){return n(u,r)}))})},go=function(e,D,r,l){var n=e.modelEvents?e.modelEvents:null,u=Array.isArray(n)?n.join(" "):n;oe(l,function(c,d){r&&typeof c=="string"&&c!==d&&c!==r.getContent({format:e.outputFormat})&&r.setContent(c)}),r.on(u||"change input undo redo",function(){D.emit("update:modelValue",r.getContent({format:e.outputFormat}))})},Oo=function(e,D,r,l,n,u){l.setContent(u()),r.attrs["onUpdate:modelValue"]&&go(D,r,l,n),yo(e,r.attrs,l)},dt=0,gt=function(e){var D=Date.now(),r=Math.floor(Math.random()*1e9);return dt++,e+"_"+r+dt+String(D)},Co=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},mt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},ho=function(e,D){return mt(e).concat(mt(D))},Mo=function(e){return e==null},ct=function(){return{listeners:[],scriptId:gt("tiny-script"),scriptLoaded:!1}},bo=function(){var e=ct(),D=function(n,u,c,d){var U=u.createElement("script");U.referrerPolicy="origin",U.type="application/javascript",U.id=n,U.src=c;var T=function(){U.removeEventListener("load",T),d()};U.addEventListener("load",T),u.head&&u.head.appendChild(U)},r=function(n,u,c){e.scriptLoaded?c():(e.listeners.push(c),n.getElementById(e.scriptId)||D(e.scriptId,n,u,function(){e.listeners.forEach(function(d){return d()}),e.scriptLoaded=!0}))},l=function(){e=ct()};return{load:r,reinitialize:l}},Vo=bo(),ko=function(){return typeof window<"u"?window:global},Oe=function(){var e=ko();return e&&e.tinymce?e.tinymce:null},No={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},ce=globalThis&&globalThis.__assign||function(){return ce=Object.assign||function(e){for(var D,r=1,l=arguments.length;r<l;r++){D=arguments[r];for(var n in D)Object.prototype.hasOwnProperty.call(D,n)&&(e[n]=D[n])}return e},ce.apply(this,arguments)},Lo=function(e,D,r,l){return e(l||"div",{id:D,ref:r})},Fo=function(e,D,r){return e("textarea",{id:D,visibility:"hidden",ref:r})},Ke={selector:void 0,target:void 0},Po=ie({props:No,setup:function(e,D){var r=e.init?ce(ce({},e.init),Ke):ce({},Ke),l=Pt(e),n=l.disabled,u=l.modelValue,c=l.tagName,d=A(null),U=null,T=e.id||gt("tiny-vue"),v=e.init&&e.init.inline||e.inline,a=!!D.attrs["onUpdate:modelValue"],i=!0,E=e.initialValue?e.initialValue:"",_="",V=function(R){return a?function(){return u!=null&&u.value?u.value:""}:function(){return R?E:_}},f=function(){var R=V(i),O=ce(ce({},r),{readonly:e.disabled,target:d.value,plugins:ho(r.plugins,e.plugins),toolbar:e.toolbar||r.toolbar,inline:v,setup:function(Q){U=Q,Q.on("init",function(se){return Oo(se,e,D,Q,u,R)}),typeof r.setup=="function"&&r.setup(Q)}});Co(d.value)&&(d.value.style.visibility=""),Oe().init(O),i=!1};oe(n,function(R){var O;U!==null&&(typeof((O=U.mode)===null||O===void 0?void 0:O.set)=="function"?U.mode.set(R?"readonly":"design"):U.setMode(R?"readonly":"design"))}),oe(c,function(R){var O;a||(_=U.getContent()),(O=Oe())===null||O===void 0||O.remove(U),at(function(){return f()})}),wt(function(){if(Oe()!==null)f();else if(d.value&&d.value.ownerDocument){var R=e.cloudChannel?e.cloudChannel:"6",O=e.apiKey?e.apiKey:"no-api-key",Q=Mo(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(O,"/tinymce/").concat(R,"/tinymce.min.js"):e.tinymceScriptSrc;Vo.load(d.value.ownerDocument,Q,f)}}),$t(function(){Oe()!==null&&Oe().remove(U)}),v||(Bt(function(){i||f()}),Gt(function(){var R;a||(_=U.getContent()),(R=Oe())===null||R===void 0||R.remove(U)}));var k=function(R){var O;_=U.getContent(),(O=Oe())===null||O===void 0||O.remove(U),r=ce(ce(ce({},r),R),Ke),at(function(){return f()})};return D.expose({rerender:k,getEditor:function(){return U}}),function(){return v?Lo(ot,T,d,e.tagName):Fo(ot,T,d)}}});const wo=["colspan"],$o=M("strong",null,"E-Mail Content",-1),Bo=["innerHTML"],Ot=ie({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:D}){const r=fe(),l=A([]),n=A({From:"",Subject:"",HTML:""}),u=A(""),c=A(""),d=A(""),U=A(!1),T=A([]),v=A([]),a=A([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]);oe(n,V=>{d.value=V.From||d.value||"",c.value=V.Subject||c.value||"",u.value=V.HTML||u.value||""});const i=()=>{r.getRegistrationEmails(e.registration.RegistrationUUID).then(V=>{V&&(V.forEach(f=>{f.CreatedAt=Sa(new Date(f.CreatedAt||"")),f.Status=Pa(f.Status),f.User||(f.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),v.value=V)})};i(),(()=>{r.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(V=>{V&&(l.value=V)})})();const _=({callback:V})=>{r.sendRegistrationEmail(e.registration.RegistrationUUID,d.value,c.value,u.value).then(f=>{f?V&&(V("Email Sent"),i(),setTimeout(()=>{U.value=!1},2e3)):V&&V("Not sent")}).catch(()=>{V&&V("Not sent")})};return(V,f)=>(s(),I(N,null,[V.showEditor?(s(),I(N,{key:0},[t(ee,null,{default:o(()=>[t(w,null,{default:o(()=>[t(Qt,{items:l.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":f[0]||(f[0]=k=>n.value=k),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12"},{default:o(()=>[t(Te,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=k=>d.value=k),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(w,{cols:"12"},{default:o(()=>[t(Te,{modelValue:c.value,"onUpdate:modelValue":f[2]||(f[2]=k=>c.value=k),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(w,{cols:"12"},{default:o(()=>[t(q(Po),{modelValue:u.value,"onUpdate:modelValue":f[3]||(f[3]=k=>u.value=k),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(w,null,{default:o(()=>[t(We,{onClick:f[4]||(f[4]=k=>D("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(w,{class:"text-right"},{default:o(()=>[t(We,{onClick:_,label:"Send",color:"error"})]),_:1})]),_:1})],64)):j("",!0),v.value.length&&!V.hideHistory?(s(),H(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[Y(" Email History ")]),_:1}),t(At,null,{default:o(()=>[t(q(Tt),{items:v.value,headers:a.value,"show-expand":!0,"item-value":"EmailUUID",expanded:T.value,"onUpdate:expanded":f[5]||(f[5]=k=>T.value=k)},{"expanded-row":o(({columns:k,item:R})=>[M("tr",null,[M("td",{colspan:k.length},[$o,M("div",{class:"communicationsViewEmailPreview",innerHTML:R.raw.HTML},null,8,Bo)],8,wo)])]),"footer.prepend":o(()=>[t(le,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:i},{default:o(()=>[Y("Refresh")]),_:1})]),_:1},8,["items","headers","expanded"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const Go=e=>(vt("data-v-ee66eb82"),e=e(),_t(),e),Yo=["colspan"],Ho=Go(()=>M("strong",null,"Details",-1)),xo=["innerHTML"],qo=ie({__name:"PaymentTransactions",props:{hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:D}){const r=e;let{hideHistory:l=!1,registration:n,showEditor:u}=r;const c=fe(),d=A([]),U=A([]),T=A([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"}]),v=A([{key:"CreatedAt",order:"asc"}]),a=()=>({PaymentTransactionUUID:Me(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:pa.PAYMENT_TRANSACTION_SOURCE_NULL,Type:St.PAYMENT_TRANSACTION_TYPE_NULL}),i=A(a()),{convertTransactions:E,getPaymentTransactionsDisplay:_}=Dt();oe(r,()=>{l=r.hideHistory,n=r.registration,u=r.showEditor,_(n.RegistrationUUID).then(k=>{U.value=k})});const V=()=>{_(n.RegistrationUUID).then(k=>{U.value=k})};V();const f=()=>{c.saveRegistrationPaymentTransaction(i.value).then(k=>{k&&(E(k.PaymentTransactions),i.value=a(),D("close-editor"),D("change"))})};return(k,R)=>(s(),I(N,null,[q(u)?(s(),I(N,{key:0},[t(ha,null,{default:o(()=>[Y(" Add Transaction ")]),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{items:q(Da),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:i.value.Type,"onUpdate:modelValue":R[0]||(R[0]=O=>i.value.Type=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(w,{cols:"12",sm:"6"},{default:o(()=>[t(ne,{items:q(Ia),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:i.value.Source,"onUpdate:modelValue":R[1]||(R[1]=O=>i.value.Source=O),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(Te,{label:"Description","hide-details":"",modelValue:i.value.Description,"onUpdate:modelValue":R[2]||(R[2]=O=>i.value.Description=O),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(w,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(Te,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:i.value.Amount,"onUpdate:modelValue":R[3]||(R[3]=O=>i.value.Amount=O),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(le,{class:"w-100",onClick:R[4]||(R[4]=O=>D("close-editor")),color:"warning"},{default:o(()=>[Y("Cancel")]),_:1})]),_:1}),t(Xe),t(w,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(le,{class:"w-100",onClick:f,color:"primary"},{default:o(()=>[Y("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):j("",!0),U.value.length&&!q(l)?(s(),H(ft,{key:1,class:"my-2"},{default:o(()=>[t(Et,null,{default:o(()=>[t(Ut,null,{default:o(()=>[Y(" Transaction History ")]),_:1}),t(At,null,{default:o(()=>[t(q(Tt),{items:U.value,headers:T.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:d.value,"onUpdate:expanded":R[5]||(R[5]=O=>d.value=O),"sort-by":v.value,"onUpdate:sortBy":R[6]||(R[6]=O=>v.value=O)},{"expanded-row":o(({columns:O,item:Q})=>[M("tr",null,[M("td",{colspan:O.length},[Ho,M("div",{innerHTML:Q.raw.HTML},null,8,xo)],8,Yo)])]),"footer.prepend":o(()=>[t(le,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:V},{default:o(()=>[Y("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const jo=Ye(qo,[["__scopeId","data-v-ee66eb82"]]),xe=e=>(vt("data-v-76d30f00"),e=e(),_t(),e),Qo={class:"v-row"},Ko={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},zo={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},Wo={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},Jo={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},Xo=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),Zo={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},en=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),tn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},an=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),on={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},nn=xe(()=>M("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),ln={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},sn=ie({__name:"PaymentActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:D}){const r=e,l=Ge(e,"modelValue"),{registration:n}=r,u=A(!1),c=A(!1),d=A(),U=A([]),T=A(new Date().getTime()),v=Je(r,D,void 0,void 0,"registration"),a=A(ve(v.value));oe(v,()=>{a.value=ve(v.value)});const i=fe(),E=()=>{i.generateRegistrationCharges(n.RegistrationUUID,!1).then(f=>{f&&(U.value=f.PaymentTransactions,d.value=f.Registration,T.value=new Date().getTime())}).catch(()=>{})};E();const _=()=>{i.generateRegistrationCharges(n.RegistrationUUID,!0).then(f=>{f&&(U.value=f.PaymentTransactions,d.value=f.Registration,T.value=new Date().getTime())})},{totalCharges:V}=Dt();return(f,k)=>(s(),H(He,{modelValue:l.value,"onUpdate:modelValue":k[3]||(k[3]=R=>l.value=R),title:f.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[d.value?(s(),I(N,{key:0},[M("dl",Qo,[(s(!0),I(N,null,Z(U.value,R=>(s(),I(N,{key:R.PaymentTransactionUUID},[R.Type===q(St).PAYMENT_TRANSACTION_TYPE_CHARGE?(s(),I("dt",Ko,[M("div",zo,P(R.Description.split(":")[0])+": ",1),M("div",Wo,P(R.Description.split(":")[1]),1)])):j("",!0),M("dd",Jo," £"+P(R.Amount),1)],64))),128)),Xo,M("dd",Zo," £"+P(q(V)(U.value)),1),en,M("dd",tn," £"+P(d.value.Total),1),an,M("dd",on," £"+P(d.value.Paid),1),nn,M("dd",ln," £"+P(d.value.Total-d.value.Paid),1)]),t(ee,{class:"flex-row-reverse"},{default:o(()=>[t(w,{class:"text-right"},{default:o(()=>[t(le,{color:"primary",onClick:_},{default:o(()=>[Y("Apply Charges")]),_:1})]),_:1}),c.value?j("",!0):(s(),H(w,{key:0},{default:o(()=>[t(le,{color:"secondary",onClick:k[0]||(k[0]=R=>c.value=!0)},{default:o(()=>[Y("Transaction Entry")]),_:1})]),_:1}))]),_:1})],64)):j("",!0),t(jo,{registration:q(n),"show-editor":c.value,onCloseEditor:k[1]||(k[1]=R=>c.value=!1),updated:T.value,onChange:E},null,8,["registration","show-editor","updated"]),t(Ot,{registration:q(n),"show-editor":u.value,onCloseEditor:k[2]||(k[2]=R=>u.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const rn=Ye(sn,[["__scopeId","data-v-76d30f00"]]),un=ie({__name:"RegistrationActions",props:Ee({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ee(["update:registration"],["update:modelValue"]),setup(e,{emit:D}){const r=e,l=Ge(e,"modelValue"),n=A(!1),u=Je(r,D,void 0,void 0,"registration"),c=A(ve(u.value));oe(u,()=>{c.value=ve(u.value)});const d=fe(),U=(T,v)=>{const a=c.value.Submissions.find(i=>i.SubmissionUUID==v);if(!a){T&&T("Submission not found");return}d.setSubmissionStatus(v,a.Status).then(i=>{i?(c.value.Submissions.forEach((E,_)=>{u.value.Submissions[_].Status=E.Status}),T&&T("Status Saved")):T&&T("Status not saved")}).catch(()=>{T&&T("Status not saved")})};return(T,v)=>(s(),H(He,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=a=>l.value=a),title:T.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Ce,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(Be,null,{default:o(()=>[(s(!0),I(N,null,Z(c.value.Submissions,a=>(s(),H(Le,{key:a.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(ee,{class:"py-2 align-center"},{default:o(()=>[t(w,{cols:"8"},{default:o(()=>{var i;return[t(ne,{modelValue:a.Status,"onUpdate:modelValue":E=>a.Status=E,items:q(rt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((i=T.forms.find(E=>E.FormUUID==a.FormUUID))==null?void 0:i.Name)||""},{selection:o(()=>[t(Ea,{class:"mr-4"},{default:o(()=>{var E;return[Y(P((E=q(rt).find(_=>_.value===a.Status))==null?void 0:E.icon),1)]}),_:2},1024),Y(" "+P(q(It)(a.Status)),1)]),item:o(({item:E,props:{onClick:_}})=>[t(Le,{title:E.title,"prepend-icon":E.raw.icon,onClick:_},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(w,{cols:"4"},{default:o(()=>[t(We,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:i=>U(i.callback,a.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(ee,null,{default:o(()=>[t(w,{cols:"12"},{default:o(()=>[t(le,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:v[0]||(v[0]=a=>n.value=!0)},{default:o(()=>[Y("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Ot,{registration:T.registration,"show-editor":n.value,onCloseEditor:v[1]||(v[1]=a=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const Hn=ie({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:D}){var Ze;const r=Oa();D("pageTitle","Registration Manager");const l=Yt(),n=Ht(),u=A(!0);let c=((Ze=l.params.convention)==null?void 0:Ze.toString())||"";const d=A({ID:0,ConventionUUID:Me(),OrganisationID:0,OrganisationUUID:Qe,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),U=fe(),T=A({ID:0,AdminLayoutUUID:Me(),ConventionID:d.value.ID,ConventionUUID:d.value.ConventionUUID,Name:"Registration Table",Type:yt.ADMIN_LAYOUT_TABLE,Panels:[]}),v=A([]),a=A([]),i=A([]),E=A([]),_=A([]),V=A(1),f=A(10),k=A([]),R=A(0),O=A(!1),Q=A(""),se=A(""),Se=A(""),De=A(""),C=A(""),h=A(""),L=A([]),y=A([]),B=A([]),W=A([]),te=A([]),z=A([]),de=A(0),re=A(),Ie=A(!1),pe=A(!1);oe(de,m=>{m===7&&Ve()}),oe(C,()=>{se.value=Date.now().toString()}),oe(h,()=>{se.value=Date.now().toString()});const Re=()=>{v.value=[],i.value=[],_.value=[];try{U.getConventionAdminLayoutByName(d.value.ConventionUUID,"Registration Table").then(m=>{de.value+=1,m?T.value=m:(T.value.ConventionID=d.value.ID,T.value.ConventionUUID=d.value.ConventionUUID)})}catch{T.value.ConventionID=d.value.ID,T.value.ConventionUUID=d.value.ConventionUUID}try{U.getConventionForms(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(v.value=m)})}catch{}try{U.getConventionAccommodation(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(y.value=m)})}catch{}try{U.getConventionVenues(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(z.value=m)})}catch{}try{U.getConventionExtras(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(B.value=m)})}catch{}try{U.getConventionInterests(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(W.value=m)})}catch{}try{U.getConventionTickets(d.value.ConventionUUID).then(m=>{de.value+=1,m&&(te.value=m)})}catch{}try{U.getConventionGroups(d.value.ConventionUUID).then(m=>{m&&(a.value=m.sort((S,p)=>S.Name.localeCompare(p.Name)))})}catch{}try{U.getConventionTags(d.value.ConventionUUID).then(m=>{m&&(E.value=m.sort((S,p)=>S.Title.localeCompare(p.Title)).map(S=>(S.Title=`${S.Title} [${S.Key}]`,S)))})}catch{}},be=({page:m,itemsPerPage:S,sortBy:p})=>{u.value=!0,V.value=m,k.value=p;const g=_.value.find(J=>J.uuid==Q.value),me=g==null?void 0:g.layout.Items;let ae="",et="";if(p&&me&&p.length>=1){const J=me.find(ke=>ke.LayoutItemUUID==p[0].key);switch(et=p[0].order,J==null?void 0:J.MetaField){case K.META_DATA_SOURCE_ACCOMMODATION_FORM:ae="submission.status";break;case K.META_DATA_SOURCE_BADGE_FORM:ae="submission.status";break;case K.META_DATA_SOURCE_DEALER_FORM:ae="submission.status";break;case K.META_DATA_SOURCE_REGISTRATION_FORM:ae="submission.status";break;case K.META_DATA_SOURCE_REGISTRATION_REFERENCE:ae="reference";break;case K.META_DATA_SOURCE_SUBMISSION_DATE:ae="created";break;case K.META_DATA_SOURCE_SUBMISSION_STATUS:ae="submission.status";break}switch(J==null?void 0:J.UserField){case X.USER_DATA_SOURCE_DISPLAY_NAME:ae="user.display_name";break;case X.USER_DATA_SOURCE_EMAIL:ae="user.email";break;case X.USER_DATA_SOURCE_FIRST_NAME:ae="user.firstname";break;case X.USER_DATA_SOURCE_HANDLE:ae="user.handle";break;case X.USER_DATA_SOURCE_LAST_NAME:ae="user.lastname";break}}try{const J={Direction:et,Limit:S,Offset:(m-1)*S,Order:ae};g&&g.layout.RequiredRegistrationTags.length>0&&(J.PanelUUID=g==null?void 0:g.layout.LayoutPanelUUID),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_ACCOMMODATION&&(J.Accommodation=!0),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_BADGE&&(J.Badge=!0),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_DEALER&&(J.Dealer=!0),(g==null?void 0:g.layout.RequiredFormType)===Ae.FORM_TYPE_REGISTRATION&&(J.Registration=!0),J.GroupUUID=C.value||Qe,J.TagUUID=h.value||Qe,J.Email=De.value,J.Reference=Se.value,U.searchConventionRegistrations(d.value.ConventionUUID,J).then(ke=>{ke&&(R.value=ke.Total,i.value=ke.Registrations,_.value.forEach(qe=>{const Vt=qe.layout;qe.items=i.value.map($=>{const we=[];let _e;$.Leader?_e=$:_e=$.Primary,we.push({Name:_e.User.DisplayName,UUID:_e.UserUUID,UserUUID:_e.User.UserUUID,IsLeader:!0,Reference:_e.Reference,Paid:_e.Paid,Total:_e.Total}),we.push(..._e.Members.map(Ue=>({Name:Ue.User.DisplayName,UUID:Ue.UserUUID,UserUUID:Ue.User.UserUUID,IsLeader:!1,Reference:Ue.Reference,Paid:Ue.Paid,Total:Ue.Total})));const x={};return qe.headers.forEach(Ue=>{var tt;const F=Vt.Items.find(Ne=>Ne.LayoutItemUUID===Ue.key);if(F){if(F.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&F.SectionField)$.Submissions.forEach(Ne=>{const he=Ne.Data.find(b=>b.SectionFieldUUID===F.SectionFieldUUID);if(he){Ue.type===Kt.ACCOMMODATION?x[F.LayoutItemUUID]={Data:he.Data,Registration:$}:x[F.LayoutItemUUID]=he.Data;return}});else if(F.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&F.UserField)switch(F.UserField){case X.USER_DATA_SOURCE_AVATAR:x[F.LayoutItemUUID]=r.GetProfileImageURL($.UserUUID);break;case X.USER_DATA_SOURCE_DISPLAY_NAME:x[F.LayoutItemUUID]=$.User.DisplayName;break;case X.USER_DATA_SOURCE_EMAIL:x[F.LayoutItemUUID]=$.User.Additional.Email;break;case X.USER_DATA_SOURCE_HANDLE:x[F.LayoutItemUUID]=$.User.Handle;break;case X.USER_DATA_SOURCE_DATE_OF_BIRTH:x[F.LayoutItemUUID]=$.User.Additional.DOB;break;case X.USER_DATA_SOURCE_FIRST_NAME:x[F.LayoutItemUUID]=$.User.Additional.FirstName;break;case X.USER_DATA_SOURCE_LAST_NAME:x[F.LayoutItemUUID]=$.User.Additional.LastName;break;case X.USER_DATA_SOURCE_TELEGRAM:x[F.LayoutItemUUID]="";break}else if(F.SourceType==="LAYOUT_ITEM_SOURCE_META"&&F.MetaField){const Ne=(tt=v.value.find(b=>b.Type===Ae.FORM_TYPE_REGISTRATION))==null?void 0:tt.FormUUID,he=$.Submissions.find(b=>b.FormUUID===Ne);switch(F.MetaField){case K.META_DATA_SOURCE_REGISTRATION_ACTIONS:x[F.LayoutItemUUID]=$;break;case K.META_DATA_SOURCE_REGISTRATION_GROUP:x[F.LayoutItemUUID]=we;break;case K.META_DATA_SOURCE_REGISTRATION_REFERENCE:x[F.LayoutItemUUID]=$.Reference;break;case K.META_DATA_SOURCE_SUBMISSION_DATE:if(he){const b=new Date(he.CreatedAt||"");x[F.LayoutItemUUID]=`${b.getFullYear()}-${(b.getMonth()+1).toString().padStart(2,"0")}-${b.getDate().toString().padStart(2,"0")} ${b.getHours().toString().padStart(2,"0")}:${b.getMinutes().toString().padStart(2,"0")}:${b.getSeconds().toString().padStart(2,"0")}`}else{const b=new Date($.CreatedAt||"");x[F.LayoutItemUUID]=`${b.getFullYear()}-${(b.getMonth()+1).toString().padStart(2,"0")}-${b.getDate().toString().padStart(2,"0")} ${b.getHours().toString().padStart(2,"0")}:${b.getMinutes().toString().padStart(2,"0")}:${b.getSeconds().toString().padStart(2,"0")}`}break;case K.META_DATA_SOURCE_ACCOMMODATION_FORM:x[F.LayoutItemUUID]=$.Submissions.map(b=>{const G=v.value.find(ye=>ye.FormUUID===b.FormUUID);return{Heading:G==null?void 0:G.Heading,Form:G,Submission:b,Registration:$}}).filter(b=>{var G;return((G=b.Form)==null?void 0:G.Type)===Ae.FORM_TYPE_ACCOMMODATION});break;case K.META_DATA_SOURCE_BADGE_FORM:x[F.LayoutItemUUID]=$.Submissions.map(b=>{const G=v.value.find(ye=>ye.FormUUID===b.FormUUID);return{Heading:G==null?void 0:G.Heading,Form:G,Submission:b,Registration:$}}).filter(b=>{var G;return((G=b.Form)==null?void 0:G.Type)===Ae.FORM_TYPE_BADGE});break;case K.META_DATA_SOURCE_DEALER_FORM:x[F.LayoutItemUUID]=$.Submissions.map(b=>{const G=v.value.find(ye=>ye.FormUUID===b.FormUUID);return{Heading:G==null?void 0:G.Heading,Form:G,Submission:b,Registration:$}}).filter(b=>{var G;return((G=b.Form)==null?void 0:G.Type)===Ae.FORM_TYPE_DEALER});break;case K.META_DATA_SOURCE_PAYMENT_STATUS:if($.Paid===0&&$.Total)x[F.LayoutItemUUID]="REQUIRED";else if($.Total>$.Paid)x[F.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const b=we.find(G=>G.Paid===0&&(G.Total||0)>0);if(b){$.Total===0&&b.Total===0?x[F.LayoutItemUUID]="NOT_REQUIRED":$.Total===0&&b.Total||$.Total>0&&b.Total===0?x[F.LayoutItemUUID]="MISSING_REQUIRED":$.Paid>=$.Total?x[F.LayoutItemUUID]="AWAITING_PARTNER":x[F.LayoutItemUUID]="ALL_REQUIRED";break}else $.Total===0?x[F.LayoutItemUUID]="NOT_REQUIRED":x[F.LayoutItemUUID]="COMPLETE"}break;case K.META_DATA_SOURCE_SUBMISSION_STATUS:ba($.Submissions,v.value),x[F.LayoutItemUUID]=$.Submissions.map(b=>{const G=v.value.find(ye=>ye.FormUUID===b.FormUUID);return{Heading:G==null?void 0:G.Heading,Form:G,Submission:b,Registration:$}});break}}}}),x})}),u.value=!1)})}catch{}},Pe=m=>{O.value=!1,m&&(T.value=m,Ve())},Ve=()=>{T.value.Panels.forEach(m=>{m.Items.forEach(S=>{(S.SectionField==null||S.SectionField.Field==null)&&v.value.find(p=>{p.Sections.find(g=>{if(g.Fields){const me=g.Fields.find(ae=>ae.SectionFieldUUID===S.SectionFieldUUID);if(me)return S.SectionField=me,!0}})})})}),T.value.Panels.length>0&&(_.value=[],T.value.Panels.forEach(m=>{const S={uuid:Me(),order:m.Order,name:m.Name,headers:[],items:[],layout:m};m.Items.sort((p,g)=>p.Order>g.Order?1:p.Order==g.Order?0:-1),S.headers=m.Items.map(p=>{var g,me;return p.DefaultSort&&L.value.push({key:p.LayoutItemUUID,order:"asc"}),{key:p.LayoutItemUUID,title:p.Label||((me=(g=p.SectionField)==null?void 0:g.Field)==null?void 0:me.Label)||"",align:p.Align==="end"?"end":"start",sortable:ht(p),type:Ct(p)}}),_.value.push(S)}),_.value=_.value.sort((m,S)=>m.order>S.order?1:m.order==S.order?0:-1)),(Q.value==null||Q.value=="")&&_.value.length>0&&(Q.value=_.value[0].uuid)};c?U.getConvention(c).then(m=>{m&&(d.value=m,T.value.ConventionID=d.value.ID,T.value.ConventionUUID=d.value.ConventionUUID,Re())}).catch(()=>{n.push("/")}):n.push("/");const Ct=m=>{var S,p;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_META)return`${m.SourceType}.${m.MetaField}`;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_FORM)return(p=(S=m.SectionField)==null?void 0:S.Field)==null?void 0:p.Type;if(m.SourceType===Fe.LAYOUT_ITEM_SOURCE_USER)return`${m.SourceType}.${m.UserField}`},ht=m=>{const S=[K.META_DATA_SOURCE_ACCOMMODATION_FORM,K.META_DATA_SOURCE_BADGE_FORM,K.META_DATA_SOURCE_DEALER_FORM,K.META_DATA_SOURCE_REGISTRATION_FORM,K.META_DATA_SOURCE_REGISTRATION_REFERENCE,K.META_DATA_SOURCE_SUBMISSION_DATE,K.META_DATA_SOURCE_SUBMISSION_STATUS],p=[X.USER_DATA_SOURCE_DISPLAY_NAME,X.USER_DATA_SOURCE_EMAIL,X.USER_DATA_SOURCE_HANDLE,X.USER_DATA_SOURCE_DATE_OF_BIRTH,X.USER_DATA_SOURCE_FIRST_NAME,X.USER_DATA_SOURCE_LAST_NAME];return S.includes(m.MetaField)||p.includes(m.UserField)},Mt=m=>{re.value=m,Ie.value=!0},bt=m=>{re.value=m,pe.value=!0};return oe(Ie,m=>{m||(re.value=void 0)}),oe(pe,m=>{m||(re.value=void 0)}),(m,S)=>(s(),H(Va,null,{default:o(()=>[t(pt,{color:"blue-darken-4"},{default:o(()=>[t(va,{modelValue:Q.value,"onUpdate:modelValue":S[0]||(S[0]=p=>Q.value=p),"show-arrows":""},{default:o(()=>[(s(!0),I(N,null,Z(_.value,p=>(s(),H(_a,{key:p.uuid,value:p.uuid},{default:o(()=>[Y(P(p.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(Xe),t(le,{icon:"mdi:mdi-cog-outline",onClick:S[1]||(S[1]=p=>O.value=!0)})]),_:1}),t(Aa,{modelValue:Q.value,"onUpdate:modelValue":S[11]||(S[11]=p=>Q.value=p),disabled:!0},{default:o(()=>[(s(!0),I(N,null,Z(_.value,p=>(s(),H(Ua,{key:p.uuid,value:p.uuid},{default:o(()=>[p.uuid===Q.value?(s(),H(Rt,{key:0,class:"pa-2"},{default:o(()=>[t(q($a),{"items-per-page":f.value,"onUpdate:itemsPerPage":S[9]||(S[9]=g=>f.value=g),"sort-by":L.value,"onUpdate:sortBy":S[10]||(S[10]=g=>L.value=g),headers:p.headers,"items-length":R.value,items:p.items,"item-value":"LayoutItemUUID",loading:u.value,search:se.value,"onUpdate:options":be},ze({top:o(()=>[t(Ce,null,{default:o(()=>[t(ee,null,{default:o(()=>[t(w,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:Se.value,"onUpdate:modelValue":S[2]||(S[2]=g=>Se.value=g),label:"Search by Badge",clearable:!0,"hide-details":"",onInput:S[3]||(S[3]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(w,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(Te,{modelValue:De.value,"onUpdate:modelValue":S[4]||(S[4]=g=>De.value=g),label:"Search By Email",clearable:!0,"hide-details":"",onInput:S[5]||(S[5]=g=>se.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(w,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ne,{modelValue:C.value,"onUpdate:modelValue":S[6]||(S[6]=g=>C.value=g),label:"Search By Group",clearable:!0,"hide-details":"",items:a.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(w,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ne,{modelValue:h.value,"onUpdate:modelValue":S[7]||(S[7]=g=>h.value=g),label:"Search By Tag",clearable:!0,"hide-details":"",items:E.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[Z(p.headers,g=>({name:`item.${g.key}`,fn:o(({item:me})=>[t(Io,{header:g,item:me,accommodations:y.value,convention:d.value,extras:B.value,forms:v.value,interests:W.value,tickets:te.value,venues:z.value,onOpenActions:Mt,onOpenPayments:bt,onReload:S[8]||(S[8]=ae=>be({page:V.value,itemsPerPage:f.value,sortBy:k.value}))},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):j("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),O.value?(s(),H(Ba,{key:0,title:"Edit Layout",modelValue:O.value,"onUpdate:modelValue":S[12]||(S[12]=p=>O.value=p),layout:T.value,onSave:Pe},null,8,["modelValue","layout"])):j("",!0),re.value?(s(),I(N,{key:1},[Ie.value?(s(),H(un,{key:0,modelValue:Ie.value,"onUpdate:modelValue":S[13]||(S[13]=p=>Ie.value=p),registration:re.value,"onUpdate:registration":S[14]||(S[14]=p=>re.value=p),accommodations:y.value,convention:d.value,extras:B.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Status & Communications",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):pe.value?(s(),H(rn,{key:1,modelValue:pe.value,"onUpdate:modelValue":S[15]||(S[15]=p=>pe.value=p),registration:re.value,"onUpdate:registration":S[16]||(S[16]=p=>re.value=p),accommodations:y.value,convention:d.value,extras:B.value,forms:v.value,interests:W.value,tickets:te.value,title:"Registration Payments",venues:z.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):j("",!0)],64)):j("",!0)]),_:1}))}});export{Hn as default};
