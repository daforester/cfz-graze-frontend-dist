import{I as M,a0 as ae,a1 as se,J as le,r as w,w as j,M as e,N as a,O as t,v as r,P as l,R as ie,Q as T,S as p,a2 as re,X as d,a3 as q,K as X,V as u,H as C,a4 as G,W as k,e as x,L as H,Y as ue,Z as ce,_ as oe}from"./index-7642285f.js";import{G as K}from"./userData-bffc6b9a.js";import{_ as de}from"./LoginView.vue_vue_type_script_setup_true_lang-5f495d82.js";import{s as B}from"./index-26b71cef.js";import{F as S}from"./form-29fd1dbb.js";import{S as Z,a as me}from"./submission-2c955912.js";import{V as ne,a as ve}from"./scopeId-ed151457.js";import{c as z}from"./canEditForm-1bd557fa.js";import{s as pe}from"./sortSubmissions-8ed80f07.js";import{P as Y,a as fe,f as _e,u as ye}from"./useDisplayTransactions-bf8839cd.js";import{V as ge,l as Te}from"./VAlert-fd0deab9.js";import{_ as ke}from"./ModelDialog.vue_vue_type_script_setup_true_lang-fe9722fb.js";import{V as he}from"./VForm-b63bae9b.js";import{V as O,a as b}from"./VRow-d1eb8eeb.js";import{V as v,a as Se}from"./VBtn-12aa1498.js";import{j as J}from"./VContainer-464f25ab.js";import{V as Ie}from"./SaveButton.vue_vue_type_script_setup_true_lang-132caf18.js";import{V as Ee}from"./VAvatar-31463285.js";import{V as ee,a as Ue,b as Ce,c as te,d as we,e as Ae}from"./VCard-047856e1.js";import"./emailFormVariant-e5e0aad4.js";import"./LoginButton-be793285.js";import"./createSimpleFunctional-23065a3a.js";import"./forwardRefs-a7588780.js";import"./VDialog-93c59b67.js";import"./VToolbar-8a48ab1d.js";const Re=d("p",{class:"my-4"},[l(" Payments are non-refundable, please check our "),d("a",{target:"_blank",href:"https://www.scotiacon.org.uk/policies"},"policies"),l(" for further information. ")],-1),De=d("p",{class:"my-4"}," You must be over 18 to attend the convention and be able to produce valid ID matching the details on your registration. ",-1),Pe=d("p",{class:"my-4"}," If you are unable to provide valid ID when asked at the convention you will not be issued your attendee badge. ",-1),be=d("p",{class:"my-4"}," Payments should be made by the authorised card holder only. ",-1),Fe=d("p",{class:"my-4"},[l(" Please contact "),d("a",{href:"mailto:registration@scotiacon.org.uk"},"registration@scotiacon.org.uk"),l(" if you need any further assistance. ")],-1),Ve=d("div",{id:"express-checkout-element"},null,-1),Oe=d("div",{id:"link-authentication-element"},null,-1),Me=d("div",{id:"payment-element"},null,-1),Ne=M({__name:"StripePayment",props:ae({paymentTransactions:{},registration:{}},{modelValue:{type:Boolean,required:!0}}),emits:["update:modelValue"],setup(f){const _=se(f,"modelValue"),I=q(),h=K();le();const c=w(),n=w(),y=w((h==null?void 0:h.Additional.Email)||""),E=w(!1),D=w("");let L;const F=w(!1);j(_,m=>{m&&I.stripePublicKey().then(async i=>{i&&(n.value=await Te(i),await $(n.value))})});const N=m=>{D.value=m,E.value=!0};async function $(m){if(!m)return;const i={mode:"payment",amount:1099,currency:"usd"},U=m.elements(i).create("expressCheckout");U.mount("#express-checkout-element"),U.on("click",P=>{const s={emailRequired:!0};P.resolve(s)})}async function o(m,i){if(!i)return;m.preventDefault(),F.value=!0;const g=new URL(location.href);g.pathname+="payment/stripe/processing";const{error:U}=await i.confirmPayment({elements:L,confirmParams:{return_url:g.toString(),receipt_email:y.value}});U.type==="card_error"||U.type==="validation_error"?N(U.message):N("An unexpected error occurred."),F.value=!1}return(m,i)=>(e(),a(ke,{modelValue:_.value,"onUpdate:modelValue":i[4]||(i[4]=g=>_.value=g),title:"Make a Payment",color:"blue-darken-4",fullscreen:"",persistent:""},{default:t(()=>[r(J,{class:"pa-0"},{default:t(()=>[r(ge,{class:"mb-2",closable:!0},{title:t(()=>[l(" Payment Information ")]),text:t(()=>[Re,De,Pe,be,Fe]),_:1}),r(he,{ref_key:"paymentForm",ref:c,id:"payment-form",onSubmit:i[1]||(i[1]=ie(g=>o(g,n.value),["prevent"]))},{default:t(()=>[r(O,null,{default:t(()=>[r(b,null,{default:t(()=>[Ve]),_:1})]),_:1}),r(O,null,{default:t(()=>[r(b,null,{default:t(()=>[Oe]),_:1})]),_:1}),r(O,null,{default:t(()=>[r(b,null,{default:t(()=>[Me]),_:1})]),_:1}),r(O,null,{default:t(()=>[m.registration?(e(),a(b,{key:0,class:"font-weight-bold text-right"},{default:t(()=>[l(" Payment Amount: £"+T(m.registration.Total-m.registration.Paid),1)]),_:1})):p("",!0)]),_:1}),r(O,null,{default:t(()=>[r(b,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:t(()=>[r(v,{color:"error",class:"w-100",onClick:i[0]||(i[0]=g=>_.value=!1)},{default:t(()=>[l("Cancel")]),_:1})]),_:1}),r(ne),r(b,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:t(()=>[r(v,{type:"submit",color:"success",class:"w-100"},re({default:t(()=>[l(" Pay Now ")]),_:2},[F.value?{name:"prepend",fn:t(()=>[r(Se,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),r(Ie,{modelValue:E.value,"onUpdate:modelValue":i[3]||(i[3]=g=>E.value=g)},{actions:t(()=>[r(v,{variant:"text",onClick:i[2]||(i[2]=g=>E.value=!1)},{default:t(()=>[l(" Close ")]),_:1})]),default:t(()=>[l(T(D.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),$e={key:0},xe={key:1,class:"v-row"},Ye={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Le={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},ze={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},Ge={key:1,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Be={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},He={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},je={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},qe=d("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1),Ke={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Je=d("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Current Payments ",-1),Qe={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},We=d("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance Due ",-1),Xe={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Ze=M({__name:"AttendeeTransactionList",props:{paymentTransactions:{},registration:{}},setup(f){const _=f,I=w(X(_.paymentTransactions));j(_,()=>{I.value=X(_.paymentTransactions)});const h=(c,n)=>c.Type===Y.PAYMENT_TRANSACTION_TYPE_CHARGE&&n.Type!==Y.PAYMENT_TRANSACTION_TYPE_CHARGE?-1:c.Type!==Y.PAYMENT_TRANSACTION_TYPE_CHARGE&&n.Type===Y.PAYMENT_TRANSACTION_TYPE_CHARGE||(c.UpdatedAt||0)>(n.UpdatedAt||0)?1:c.UpdatedAt===n.UpdatedAt?0:-1;return(c,n)=>c.registration.Total==0?(e(),u("p",$e," Your registration is currently being processed, payment information will appear here when ready. ")):(e(),u("dl",xe,[(e(!0),u(C,null,G(I.value.sort(h),y=>{var E;return e(),u(C,{key:y.PaymentTransactionUUID},[y.Type===k(Y).PAYMENT_TRANSACTION_TYPE_CHARGE?(e(),u("dt",Ye,[d("div",Le,T(y.Description.split(":")[0]),1),d("div",ze,T(y.Description.split(":")[1]),1)])):(e(),u("dt",Ge,[d("div",Be,T((E=k(fe).find(D=>D.value===y.Type))==null?void 0:E.title),1),d("div",He," [ "+T(k(_e)(y.UpdatedAt||""))+" ] "+T(y.Description),1)])),d("dd",je," £"+T(y.Amount),1)],64)}),128)),qe,d("dd",Ke," £"+T(c.registration.Total),1),Je,d("dd",Qe," £"+T(c.registration.Paid),1),We,d("dd",Xe," £"+T(c.registration.Total-c.registration.Paid),1)]))}}),et=f=>(ue("data-v-8e41c2b1"),f=f(),ce(),f),tt=["innerHTML"],ot={key:0},nt={key:0,class:"font-weight-bold float-left pt-1 w-50"},at={key:1,class:"pa-1"},st={key:0,class:"font-weight-bold float-left pt-1 w-50"},lt={key:1},it={class:"font-weight-bold float-left pt-1 w-50"},rt={class:"text-red-darken-4"},ut={key:1,class:"text-red-darken-4 mt-4"},ct=et(()=>d("strong",null,"There are forms above that require completion, please edit and save them.",-1)),dt=[ct],mt=M({__name:"OpenConvention",props:{convention:{},forms:{default:()=>[]}},setup(f){const _=ve(),I=q(),{getPaymentTransactions:h}=ye(),c=w(_.GetConventionLogoURL(f.convention.ConventionUUID)),n=w(),y=w([]),E=w(!1),D=x(()=>{var o;return z(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],S.FORM_TYPE_REGISTRATION)}),L=x(()=>{var o;return z(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],S.FORM_TYPE_DEALER)}),F=x(()=>{var o;return z(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],S.FORM_TYPE_ACCOMMODATION)}),N=x(()=>{var o;return z(f.forms,((o=n.value)==null?void 0:o.Submissions)||[],S.FORM_TYPE_ADDITIONAL)}),$=x(()=>{var o,m;return n.value&&((o=n.value)!=null&&o.Submissions)?!!((m=n.value)!=null&&m.Submissions.find(i=>{var g;return((g=i.Form)==null?void 0:g.Type)==S.FORM_TYPE_REGISTRATION&&(i.Status==Z.SUBMISSION_STATUS_ACCEPTED||i.Status==Z.SUBMISSION_STATUS_COMPLETED)})):!1});return j(()=>f.forms,()=>{I.getRegistrationByConvention(f.convention.ConventionUUID).then(o=>{var m;o&&(o.Submissions?(o.Submissions.forEach((i,g)=>{i.Form||(o.Submissions[g].Form=f.forms.find(U=>U.FormUUID===i.FormUUID))}),pe(o.Submissions)):o.Submissions=[],n.value=o,$.value&&h(((m=n.value)==null?void 0:m.RegistrationUUID)||"").then(i=>{y.value=i}))})}),(o,m)=>{const i=H("router-link"),g=H("RouterLink");return e(),a(Ae,{class:"elevation-5 flex-1-0 d-flex flex-column"},{default:t(()=>[r(Ce,{class:"flex-1-1 align-content-start"},{default:t(()=>[c.value?(e(),a(Ee,{key:0,src:c.value,title:o.convention.Name,class:"logo text-center"},null,8,["src","title"])):p("",!0),o.convention.Name?(e(),a(ee,{key:1,class:"text-center"},{default:t(()=>[l(T(o.convention.Name),1)]),_:1})):p("",!0),o.convention.Description?(e(),a(Ue,{key:2,class:"text-wrap subtitle"},{default:t(()=>[d("div",{innerHTML:o.convention.Description},null,8,tt)]),_:1})):p("",!0)]),_:1}),r(te,null,{default:t(()=>{var U,P;return[n.value?(e(),u("dl",ot,[n.value.Reference?(e(),u("dt",nt," Badge No: ")):p("",!0),n.value.Reference?(e(),u("dd",at," #"+T(n.value.Reference),1)):p("",!0),(e(!0),u(C,null,G((U=n.value)==null?void 0:U.Submissions,s=>{var A,V,Q,W;return e(),u(C,{key:s.SubmissionUUID},[s.Form?(e(),u(C,{key:0},[s.Form?(e(),u("dt",st,T(s.Form.Heading),1)):p("",!0),s.Form?(e(),u("dd",lt,[l(T(k(me)(s.Status))+" ",1),((A=s.Form)==null?void 0:A.Type)===k(S).FORM_TYPE_REGISTRATION?(e(),a(i,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/registration`},{default:t(()=>{var R;return[(R=s.Form)!=null&&R.State.Edit&&D.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((V=s.Form)==null?void 0:V.Type)===k(S).FORM_TYPE_ACCOMMODATION?(e(),a(i,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/accommodation`},{default:t(()=>{var R;return[(R=s.Form)!=null&&R.State.Edit&&F.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((Q=s.Form)==null?void 0:Q.Type)===k(S).FORM_TYPE_DEALER?(e(),a(i,{key:2,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/dealer`},{default:t(()=>{var R;return[(R=s.Form)!=null&&R.State.Edit&&L.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):((W=s.Form)==null?void 0:W.Type)===k(S).FORM_TYPE_ADDITIONAL?(e(),a(i,{key:3,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/additional`},{default:t(()=>{var R;return[(R=s.Form)!=null&&R.State.Edit&&N.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]}),_:2},1032,["to"])):p("",!0)])):p("",!0)],64)):p("",!0)],64)}),128)),((P=n.value)==null?void 0:P.Submissions.length)>=1?(e(!0),u(C,{key:2},G(o.forms,s=>{var A;return e(),u(C,{key:s.FormUUID},[(A=n.value)!=null&&A.Submissions.find(V=>V.FormUUID===s.FormUUID)?p("",!0):(e(),u(C,{key:0},[d("dt",it,T(s.Heading),1),d("dd",rt,[l(" Requires Completion "),s.Type===k(S).FORM_TYPE_REGISTRATION?(e(),a(i,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/registration`},{default:t(()=>[s.State.Edit&&D.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===k(S).FORM_TYPE_ACCOMMODATION?(e(),a(i,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/accommodation`},{default:t(()=>[s.State.Edit&&F.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===k(S).FORM_TYPE_DEALER?(e(),a(i,{key:2,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/dealer`},{default:t(()=>[s.State.Edit&&L.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):s.Type===k(S).FORM_TYPE_ADDITIONAL?(e(),a(i,{key:3,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}/additional`},{default:t(()=>[s.State.Edit&&N.value?(e(),a(v,{key:0,size:"small",variant:"text",color:"success"},{default:t(()=>[l(" Edit ")]),_:1})):(e(),a(v,{key:1,size:"small",variant:"text",color:"warning"},{default:t(()=>[l("View")]),_:1}))]),_:2},1032,["to"])):p("",!0)])],64))],64)}),128)):p("",!0)])):p("",!0),n.value&&n.value.Submissions.length>=1&&o.forms.filter(s=>{var A;return!((A=n.value)!=null&&A.Submissions.find(V=>V.FormUUID==s.FormUUID))}).length?(e(),u("div",ut,dt)):p("",!0)]}),_:1}),$.value&&n.value?(e(),u(C,{key:0},[r(ee,{class:"pb-4 text-center"},{default:t(()=>[l("Payment Information")]),_:1}),r(te,null,{default:t(()=>[r(Ze,{"payment-transactions":y.value,registration:n.value},null,8,["payment-transactions","registration"])]),_:1})],64)):p("",!0),r(we,null,{default:t(()=>{var U,P;return[o.convention.DetailLink?(e(),a(v,{key:0,color:"orange",href:o.convention.DetailLink},{default:t(()=>[l(T(k(B).buttonDetails),1)]),_:1},8,["href"])):p("",!0),r(ne),D.value?(e(),u(C,{key:1},[(U=n.value)!=null&&U.Submissions.find(s=>{var A;return((A=s.Form)==null?void 0:A.Type)===k(S).FORM_TYPE_REGISTRATION})?(e(),a(g,{key:1,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}`},{default:t(()=>[r(v,{color:"primary"},{default:t(()=>[l(T(k(B).buttonViewRegistration),1)]),_:1})]),_:1},8,["to"])):(e(),u(C,{key:0},[(P=o.forms.find(s=>s.Type===k(S).FORM_TYPE_REGISTRATION))!=null&&P.State.New?(e(),a(g,{key:0,to:`/register/${o.convention.Slug||o.convention.ConventionUUID}`},{default:t(()=>[r(v,{color:"primary"},{default:t(()=>[l(T(k(B).buttonRegister),1)]),_:1})]),_:1},8,["to"])):p("",!0)],64))],64)):$.value&&n.value&&n.value.Total>n.value.Paid?(e(),u(C,{key:2},[r(v,{color:"success",variant:"elevated",onClick:m[0]||(m[0]=s=>E.value=!0)},{default:t(()=>[l("Make Payment")]),_:1}),n.value?(e(),a(Ne,{key:0,"payment-transactions":y.value,registration:n.value,modelValue:E.value,"onUpdate:modelValue":m[1]||(m[1]=s=>E.value=s)},null,8,["payment-transactions","registration","modelValue"])):p("",!0)],64)):p("",!0)]}),_:1})]),_:1})}}});const vt=oe(mt,[["__scopeId","data-v-8e41c2b1"]]),pt=M({__name:"Conventions",setup(f){const _=q(),I=w([]),h=w([]);return _.getOpenConventionsList().then(c=>{c&&(I.value=[...I.value,...c],_.getAvailableConventionForms(I.value.map(n=>n.ConventionUUID)).then(n=>{h.value=[...h.value,...n]}).catch(n=>{console.error(n)}))}),(c,n)=>(e(),a(J,null,{default:t(()=>[r(O,{class:"justify-center"},{default:t(()=>[(e(!0),u(C,null,G(I.value,y=>(e(),a(b,{key:y.ConventionUUID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:t(()=>[r(vt,{convention:y,forms:h.value.filter(E=>E.ConventionUUID===y.ConventionUUID)},null,8,["convention","forms"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),ft={};function _t(f,_){return e(),u("div")}const yt=oe(ft,[["render",_t]]),gt=M({__name:"MainView",emits:["pageTitle"],setup(f,{emit:_}){_("pageTitle","Scotiacon Registration System"),sessionStorage.getItem("reload")==="true"&&(sessionStorage.removeItem("reload"),setTimeout(()=>{location.reload()},500));const h=localStorage.getItem("gjt_token"),c=localStorage.getItem("ajt_token");h?(localStorage.removeItem("gjt_token"),location.href=h):c&&(localStorage.removeItem("ajt_token"),location.href=c);const n=w(K());return(y,E)=>{const D=H("router-link");return e(),u(C,null,[n.value&&!n.value.Additional.Email?(e(),a(J,{key:0,class:"bg-red-darken-4 text-center",fluid:!0},{default:t(()=>[l(" Please enter a Contact Email on the "),r(D,{to:"/profile",class:"text-white font-weight-bold"},{default:t(()=>[l("manage account page")]),_:1}),l(" to ensure we can contact you. ")]),_:1})):p("",!0),r(pt),r(yt)],64)}}}),Bt=M({__name:"Home",emits:["pageTitle"],setup(f,{emit:_}){const I=K();return _("pageTitle","Telegram Login"),(h,c)=>(e(),u("div",null,[k(I)?(e(),a(gt,{key:0,onPageTitle:c[0]||(c[0]=n=>_("pageTitle",n))})):(e(),a(de,{key:1}))]))}});export{Bt as default};
