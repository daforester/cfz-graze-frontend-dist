import{m as we,u as Ce,a as be,b as Se}from"./VSelect-TlGUS_wy.js";import{c as xe,V as le}from"./VTextField-DzX3_YW1.js";import{j as pe,u as Me,V as te,A as Ie}from"./VContainer-MiGBCU6e.js";import{p as re,r as L,c as I,C as E,h as Ae,aD as Z,aH as Pe,R as _e,d as De,ae as Ke,s as j,u as Y,w as Q,X as ae,aa as Re,f as s,F as X,m as W,aN as Le,x as Te,aO as Oe,aP as ue}from"./index-4nrgYz2t.js";import{u as Ne,f as Ee}from"./forwardRefs-0mKwUGv9.js";import{e as je,V as Be,a as ne}from"./VList-RG-cidUg.js";import{m as Ue,a as He}from"./VAvatar-dY9XQbgr.js";import{V as ze}from"./VCheckboxBtn-AYcu1Sap.js";import{a as Qe}from"./VChip-kxMH1pPL.js";const We=(e,c,t)=>e==null||c==null?-1:e.toString().toLocaleLowerCase().indexOf(c.toString().toLocaleLowerCase()),Xe=re({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function $e(e,c,t){var x;const m=[],v=(t==null?void 0:t.default)??We,h=t!=null&&t.filterKeys?Z(t.filterKeys):!1,k=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return m;e:for(let d=0;d<e.length;d++){const[w,p=w]=Z(e[d]),r={},u={};let y=-1;if(c&&!(t!=null&&t.noFilter)){if(typeof w=="object"){const T=h||Object.keys(p);for(const M of T){const B=Pe(p,M,p),O=(x=t==null?void 0:t.customKeyFilter)==null?void 0:x[M];if(y=O?O(B,c,w):v(B,c,w),y!==-1&&y!==!1)O?r[M]=y:u[M]=y;else if((t==null?void 0:t.filterMode)==="every")continue e}}else y=v(w,c,w),y!==-1&&y!==!1&&(u.title=y);const A=Object.keys(u).length,P=Object.keys(r).length;if(!A&&!P||(t==null?void 0:t.filterMode)==="union"&&P!==k&&!A||(t==null?void 0:t.filterMode)==="intersection"&&(P!==k||!A))continue}m.push({index:d,matches:{...u,...r}})}return m}function Ge(e,c,t,m){const v=L([]),h=L(new Map),k=I(()=>m!=null&&m.transform?E(c).map(d=>[d,m.transform(d)]):E(c));Ae(()=>{const d=typeof t=="function"?t():E(t),w=typeof d!="string"&&typeof d!="number"?"":String(d),p=$e(k.value,w,{customKeyFilter:{...e.customKeyFilter,...E(m==null?void 0:m.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),r=E(c),u=[],y=new Map;p.forEach(A=>{let{index:P,matches:T}=A;const M=r[P];u.push(M),y.set(M.value,T)}),v.value=u,h.value=y});function x(d){return h.value.get(d.value)}return{filteredItems:v,filteredMatches:h,getMatches:x}}function Je(e,c,t){if(c==null)return e;if(Array.isArray(c))throw new Error("Multiple matches is not implemented");return typeof c=="number"&&~c?s(X,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,c)]),s("span",{class:"v-autocomplete__mask"},[e.substr(c,t)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(c+t)])]):e}const Ye=re({autoSelectFirst:{type:[Boolean,String]},search:String,...Xe({filterKeys:["title"]}),...we(),..._e(xe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ue({transition:!1})},"VAutocomplete"),ol=De()({name:"VAutocomplete",props:Ye(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,c){let{slots:t}=c;const{t:m}=Ke(),v=L(),h=j(!1),k=j(!0),x=j(!1),d=L(),w=L(),p=Y(e,"menu"),r=I({get:()=>p.value,set:l=>{var a;p.value&&!l&&((a=d.value)!=null&&a.Î¨openChildren)||(p.value=l)}}),u=j(-1),y=I(()=>{var l;return(l=v.value)==null?void 0:l.color}),A=I(()=>r.value?e.closeText:e.openText),{items:P,transformIn:T,transformOut:M}=je(e),{textColorClasses:B,textColorStyles:O}=pe(y),g=Y(e,"search",""),o=Y(e,"modelValue",[],l=>T(l===null?[null]:Z(l)),l=>{const a=M(l);return e.multiple?a:a[0]??null}),oe=I(()=>typeof e.counterValue=="function"?e.counterValue(o.value):typeof e.counterValue=="number"?e.counterValue:o.value.length),R=Ne(),{filteredItems:$,getMatches:se}=Ge(e,P,()=>k.value?"":g.value),C=I(()=>e.hideSelected?$.value.filter(l=>!o.value.some(a=>a.value===l.value)):$.value),ce=I(()=>o.value.map(l=>l.props.value)),U=I(()=>{var a;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&g.value===((a=C.value[0])==null?void 0:a.title))&&C.value.length>0&&!k.value&&!x.value}),G=I(()=>e.hideNoData&&!C.value.length||e.readonly||(R==null?void 0:R.isReadonly.value)),J=L(),{onListScroll:ie,onListKeydown:fe}=Ce(J,v);function ve(l){e.openOnClear&&(r.value=!0),g.value=""}function de(){G.value||(r.value=!0)}function me(l){G.value||(h.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function he(l){var b,n,V;if(e.readonly||R!=null&&R.isReadonly.value)return;const a=v.value.selectionStart,f=o.value.length;if((u.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),U.value&&["Enter","Tab"].includes(l.key)&&_(C.value[0]),l.key==="ArrowDown"&&U.value&&((b=J.value)==null||b.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(u.value<0){l.key==="Backspace"&&!g.value&&(u.value=f-1);return}const i=u.value,S=o.value[u.value];S&&!S.props.disabled&&_(S),u.value=i>=f-1?f-2:i}if(l.key==="ArrowLeft"){if(u.value<0&&a>0)return;const i=u.value>-1?u.value-1:f-1;o.value[i]?u.value=i:(u.value=-1,v.value.setSelectionRange((n=g.value)==null?void 0:n.length,(V=g.value)==null?void 0:V.length))}if(l.key==="ArrowRight"){if(u.value<0)return;const i=u.value+1;o.value[i]?u.value=i:(u.value=-1,v.value.setSelectionRange(0,0))}}}function ge(l){if(ue(v.value,":autofill")||ue(v.value,":-webkit-autofill")){const a=P.value.find(f=>f.title===l.target.value);a&&_(a)}}function ye(){var l;h.value&&(k.value=!0,(l=v.value)==null||l.focus())}function Ve(l){h.value=!0,setTimeout(()=>{x.value=!0})}function Fe(l){x.value=!1}function ke(l){(l==null||l===""&&!e.multiple)&&(o.value=[])}const N=j(!1);function _(l){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!l.props.disabled)if(e.multiple){const f=o.value.findIndex(b=>e.valueComparator(b.value,l.value));if(f===-1)o.value=[...o.value,l];else{const b=[...o.value];b.splice(f,1),o.value=b}}else o.value=a?[l]:[],N.value=!0,g.value=a?l.title:"",r.value=!1,k.value=!0,ae(()=>N.value=!1)}return Q(h,(l,a)=>{var f;l!==a&&(l?(N.value=!0,g.value=e.multiple?"":String(((f=o.value.at(-1))==null?void 0:f.props.title)??""),k.value=!0,ae(()=>N.value=!1)):(!e.multiple&&g.value==null?o.value=[]:U.value&&!x.value&&!o.value.some(b=>{let{value:n}=b;return n===C.value[0].value})&&_(C.value[0]),r.value=!1,g.value="",u.value=-1))}),Q(g,l=>{!h.value||N.value||(l&&(r.value=!0),k.value=!l)}),Q(r,()=>{if(!e.hideSelected&&r.value&&o.value.length){const l=C.value.findIndex(a=>o.value.some(f=>a.value===f.value));Re&&window.requestAnimationFrame(()=>{var a;l>=0&&((a=w.value)==null||a.scrollToIndex(l))})}}),Q(C,(l,a)=>{h.value&&(!l.length&&e.hideNoData&&(r.value=!1),!a.length&&l.length&&(r.value=!0))}),Me(()=>{const l=!!(e.chips||t.chip),a=!!(!e.hideNoData||C.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),f=o.value.length>0,b=le.filterProps(e);return s(le,W({ref:v},b,{modelValue:g.value,"onUpdate:modelValue":[n=>g.value=n,ke],focused:h.value,"onUpdate:focused":n=>h.value=n,validationValue:o.externalValue,counterValue:oe.value,dirty:f,onChange:ge,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!t.selection,"v-autocomplete--selecting-index":u.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:f?void 0:e.placeholder,"onClick:clear":ve,"onMousedown:control":de,onKeydown:he}),{...t,default:()=>s(X,null,[s(be,W({ref:d,modelValue:r.value,"onUpdate:modelValue":n=>r.value=n,activator:"parent",contentClass:"v-autocomplete__content",disabled:G.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ye},e.menuProps),{default:()=>[a&&s(Be,{ref:J,selected:ce.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:fe,onFocusin:Ve,onFocusout:Fe,onScrollPassive:ie,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},{default:()=>{var n,V,i;return[(n=t["prepend-item"])==null?void 0:n.call(t),!C.value.length&&!e.hideNoData&&(((V=t["no-data"])==null?void 0:V.call(t))??s(ne,{title:m(e.noDataText)},null)),s(Se,{ref:w,renderless:!0,items:C.value},{default:S=>{var ee;let{item:F,index:D,itemRef:K}=S;const q=W(F.props,{ref:K,key:D,active:U.value&&D===0?!0:void 0,onClick:()=>_(F)});return((ee=t.item)==null?void 0:ee.call(t,{item:F,index:D,props:q}))??s(ne,q,{prepend:H=>{let{isSelected:z}=H;return s(X,null,[e.multiple&&!e.hideSelected?s(ze,{key:F.value,modelValue:z,ripple:!1,tabindex:"-1"},null):void 0,F.props.prependAvatar&&s(He,{image:F.props.prependAvatar},null),F.props.prependIcon&&s(te,{icon:F.props.prependIcon},null)])},title:()=>{var H,z;return k.value?F.title:Je(F.title,(H=se(F))==null?void 0:H.title,((z=g.value)==null?void 0:z.length)??0)}})}}),(i=t["append-item"])==null?void 0:i.call(t)]}})]}),o.value.map((n,V)=>{function i(K){K.stopPropagation(),K.preventDefault(),_(n,!1)}const S={"onClick:close":i,onMousedown(K){K.preventDefault(),K.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},F=l?!!t.chip:!!t.selection,D=F?Le(l?t.chip({item:n,index:V,props:S}):t.selection({item:n,index:V})):void 0;if(!(F&&!D))return s("div",{key:n.value,class:["v-autocomplete__selection",V===u.value&&["v-autocomplete__selection--selected",B.value]],style:V===u.value?O.value:{}},[l?t.chip?s(Ie,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>[D]}):s(Qe,W({key:"chip",closable:e.closableChips,size:"small",text:n.title,disabled:n.props.disabled},S),null):D??s("span",{class:"v-autocomplete__selection-text"},[n.title,e.multiple&&V<o.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[Te(",")])])])})]),"append-inner":function(){var S;for(var n=arguments.length,V=new Array(n),i=0;i<n;i++)V[i]=arguments[i];return s(X,null,[(S=t["append-inner"])==null?void 0:S.call(t,...V),e.menuIcon?s(te,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:me,onClick:Oe,"aria-label":m(A.value),title:m(A.value)},null):void 0])}})}),Ee({isFocused:h,isPristine:k,menu:r,search:g,filteredItems:$,select:_},v)}});export{ol as V,Xe as m,Ge as u};
