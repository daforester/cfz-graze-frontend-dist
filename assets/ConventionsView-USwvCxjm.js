import{F as J}from"./form-0fJbSFPv.js";import{P as K}from"./permission-7wLhDNXq.js";import{i as G,M as h,N as q,r as d,k as F,w as j,n as u,q as v,v as e,f as t,C as I,P as M,_ as B,l as X,A as U,y as Z,x as L,D as ee,B as O,V as te,Q as oe,F as ne,W as ae}from"./index-41IJS01i.js";import{a as H}from"./scopeId-baCNzk1D.js";import{_ as le}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-aNqa56bU.js";import{u as ie}from"./useModel-PmLeMbsE.js";import{_ as se}from"./ModelDialog.vue_vue_type_script_setup_true_lang-DJXR7oHz.js";import{s as k}from"./index-OKsbKlsK.js";import{a as z}from"./VContainer-lPovId9T.js";import{V as y,a as c}from"./VRow-ae5UZ6iz.js";import{V as Q}from"./VAvatar-CZft4VQ3.js";import{V as P}from"./VTextField-MYtMmQHt.js";import{V as ue}from"./VTextarea-5xIzUEcs.js";import{V as re}from"./VCheckbox-QHvPi3AI.js";import{V as me}from"./VForm-s0LvMePn.js";import{V as de}from"./VFileInput-5_0BxA4t.js";import{G as $}from"./group-7fhbY6WJ.js";import{C as A}from"./canDo-AeLGJhzt.js";import{C as ve}from"./canEditRegistrations-nApI-YAF.js";import{C as fe}from"./canViewOperations-pTrwOete.js";import{G as W}from"./userData-NldHUAPs.js";import{V as ce,a as pe,b as ge,c as Y,d as Ve,e as Ce}from"./VCard-vOfwfjKF.js";import{V as E}from"./VBtn-GAwK3LQu.js";import{C as _e}from"./canEditOrganisation-UdlC1DD9.js";import{v as De}from"./v4-yQnnJER4.js";import"./createSimpleFunctional-ZG5be4T3.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-amHFbeBE.js";import"./forwardRefs-RvIpVBRs.js";import"./VDialog-siuv95_7.js";import"./VToolbar-0H73B2oL.js";import"./VCheckboxBtn-p6vrc5FA.js";import"./VChip-foobwB0G.js";const Ue=(p=void 0,g=void 0)=>p===void 0?!1:g===void 0?A(p,$.GROUP_TYPE_CONVENTION).EditConvention:A(p,$.GROUP_TYPE_CONVENTION,g.ConventionUUID,g).EditConvention,Ie=(p,g)=>p===void 0?!1:A(p,$.GROUP_TYPE_CONVENTION,g.ConventionUUID,g).ViewRegistration,ye=G({__name:"EditConventionDialog",props:h({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:h(["update:convention","delete","save"],["update:modelValue"]),setup(p,{emit:g}){const S=p,w=M(),n=H(),{title:f=""}=S,V=g,_=q(p,"modelValue"),C=ie(S,V,void 0,void 0,"convention"),a=d(F(C.value));j(C,()=>{a.value=F(C.value)});const D=d(`${n.GetConventionLogoURL(a.value.ConventionUUID)}?${new Date().getTime()}`),N=d(),x=d(),R=()=>{D.value=URL.createObjectURL(N.value.files[0])},b=()=>{V("delete")},s=()=>{a.value=F(C.value)},r=async()=>{var l;const o=new FormData((l=x.value)==null?void 0:l.$el);if(o.get("Image")&&o.get("Image").size>0)return o.set("ConventionUUID",a.value.ConventionUUID),await n.SaveConventionLogo(o)},m=o=>{r(),w.saveConvention(a.value).then(l=>{l?o&&o("Convention Data Saved").then(()=>{C.value=l,V("save",l)}):o&&o("Failed to save")}).catch(()=>{o("Failed to save")})};return(o,l)=>(u(),v(se,{modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=i=>_.value=i),onDelete:b,onReset:s,onSave:m,title:I(f),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(z,{class:"pa-0",fluid:!0},{default:e(()=>[t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(Q,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(P,{label:I(k).formLabelName,name:"Name",variant:"outlined",modelValue:a.value.Name,"onUpdate:modelValue":l[0]||(l[0]=i=>a.value.Name=i)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(ue,{label:I(k).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:a.value.Description,"onUpdate:modelValue":l[1]||(l[1]=i=>a.value.Description=i)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(P,{label:I(k).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:a.value.DetailLink,"onUpdate:modelValue":l[2]||(l[2]=i=>a.value.DetailLink=i)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(P,{label:I(k).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:a.value.Slug,"onUpdate:modelValue":l[3]||(l[3]=i=>a.value.Slug=i)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(re,{label:I(k).formConventionVisible,name:"Visible",modelValue:a.value.Visible,"onUpdate:modelValue":l[4]||(l[4]=i=>a.value.Visible=i)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(c,null,{default:e(()=>[t(me,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[t(de,{label:I(k).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:N,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:R},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),we=B(ye,[["__scopeId","data-v-319537e0"]]),Ne=["innerHTML"],Le={key:0,class:"text-green"},xe={key:1,class:"text-red"},be={key:0,class:"text-green"},Te={key:1,class:"text-red"},ke=G({__name:"ConventionCard",props:h({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:h(["delete"],["update:modelValue"]),setup(p,{emit:g}){const S=M(),w=g,n=q(p,"modelValue"),f=H(),V=W(),_=d(f.GetConventionLogoURL(n.value.ConventionUUID)),C=d(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),a=d(!1),D=d(!1),N=d(Ue(V,n.value)),x=d(ve(V,n.value)),R=d(Ie(V,n.value)),b=d(fe(V,n.value)),s=()=>{D.value=!1,_.value=`${f.GetConventionLogoURL(n.value.ConventionUUID)}?ts=${Date.now()}`},r=m=>{S.deleteConvention(n.value.ConventionUUID).then(o=>{o?m&&(m("Convention Deleted"),w("delete")):m&&m("Failed to Delete Convention"),setTimeout(()=>{a.value=!1},2e3)}).catch(()=>{m&&(m("Failed to Delete Organisation"),a.value=!1)})};return(m,o)=>{const l=X("RouterLink");return u(),v(Ce,null,{default:e(()=>[t(ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[_.value?(u(),v(Q,{key:0,src:_.value,title:n.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),n.value.Name?(u(),v(pe,{key:1},{default:e(()=>[L(Z(n.value.Name),1)]),_:1})):U("",!0),n.value.Description?(u(),v(ge,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ee("div",{innerHTML:n.value.Description},null,8,Ne)]),_:1})):U("",!0),t(Y,{class:"px-0 pb-0"},{default:e(()=>[L(" Visibility:  "),n.value.Visible?(u(),O("span",Le,"Visible")):(u(),O("span",xe,"Hidden"))]),_:1}),t(Y,{class:"px-0 pb-0"},{default:e(()=>[L(" Registration:  "),m.open?(u(),O("span",be,"Open")):(u(),O("span",Te,"Closed"))]),_:1})]),_:1}),t(Ve,null,{default:e(()=>[t(y,{"no-gutters":""},{default:e(()=>[N.value?(u(),v(c,{key:0,class:"ma-1"},{default:e(()=>[t(E,{variant:"tonal",color:"primary",onClick:o[0]||(o[0]=i=>D.value=!0),width:"100%"},{default:e(()=>[L("Edit")]),_:1})]),_:1})):U("",!0),U("",!0),N.value?(u(),v(c,{key:2,class:"ma-1"},{default:e(()=>[t(l,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}`},{default:e(()=>[t(E,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[L("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),R.value||x.value?(u(),v(c,{key:3,class:"ma-1"},{default:e(()=>[t(l,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/registrations`},{default:e(()=>[t(E,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[L("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),b.value?(u(),v(c,{key:4,class:"ma-1"},{default:e(()=>[t(l,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/operations`},{default:e(()=>[t(E,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[L("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),D.value?(u(),v(we,{key:0,modelValue:D.value,"onUpdate:modelValue":o[1]||(o[1]=i=>D.value=i),convention:n.value,"onUpdate:convention":o[2]||(o[2]=i=>n.value=i),onDelete:o[3]||(o[3]=i=>a.value=!0),onSave:s,title:`${n.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),a.value?(u(),v(le,{key:1,modelValue:a.value,"onUpdate:modelValue":o[4]||(o[4]=i=>a.value=i),"confirmation-text":"I UNDERSTAND",message:C.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:r},null,8,["modelValue","message"])):U("",!0)]),_:1})}}}),Se=B(ke,[["__scopeId","data-v-ef070fe0"]]),Re=G({__name:"ConventionsView",emits:["pageTitle"],setup(p,{emit:g}){var b;g("pageTitle","Conventions");const w=M(),n=W(),f=d([]),V=d([]),_=te();let C=((b=_.params.organisation)==null?void 0:b.toString())||"";const a=d();j(_,()=>{var s,r;C!==((s=_.params.organisation)==null?void 0:s.toString())&&(C=((r=_.params.organisation)==null?void 0:r.toString())||"",D())});const D=()=>{C?w.getOrganisation(C).then(s=>{s&&(a.value=s,w.getConventionList(s.OrganisationUUID).then(r=>{r&&(f.value=r,N())}))}).catch(()=>{}):w.getPermissionAccessList(K.PERMISSION_TYPE_NULL).then(s=>{s&&(f.value=s.Conventions,N())})},N=()=>{f.value.forEach(s=>{w.getConventionForms(s.ConventionUUID).then(r=>{r&&(V.value=[...V.value,...r])}).catch(r=>{console.error(r)})})},x=()=>{var s,r;if(a.value){const m={ID:0,ConventionUUID:De(),OrganisationID:((s=a.value)==null?void 0:s.ID)||0,OrganisationUUID:((r=a.value)==null?void 0:r.OrganisationUUID)||ae,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};w.saveConvention(m).then(o=>{o&&f.value.push(o)})}},R=s=>{f.value.splice(s,1)};return D(),(s,r)=>(u(),v(z,null,{default:e(()=>[t(y,{class:"justify-center"},{default:e(()=>[(u(!0),O(ne,null,oe(f.value,(m,o)=>(u(),v(c,{key:m.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var l,i;return[t(Se,{modelValue:f.value[o],"onUpdate:modelValue":T=>f.value[o]=T,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((l=m.Organisation)==null?void 0:l.Slug)||((i=m.Organisation)==null?void 0:i.OrganisationUUID)||"",open:!!V.value.find(T=>T.ConventionUUID===m.ConventionUUID&&T.Type===I(J).FORM_TYPE_REGISTRATION&&T.State.New),onDelete:T=>R(o)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(y,null,{default:e(()=>[a.value&&I(_e)(I(n),a.value)?(u(),v(c,{key:0,class:"text-right"},{default:e(()=>[t(E,{color:"primary",onClick:x},{default:e(()=>[L("New")]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}}),dt=B(Re,[["__scopeId","data-v-f6915eaa"]]);export{dt as default};
