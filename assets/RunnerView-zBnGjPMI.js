import{m as h,u as $,n as B,A as F,_ as G}from"./useTokenManager-MLztCGvS.js";import{i as N,r as n,b as J,B as S,q as U,A as R,v as t,F as q,P as z,V as j,U as H,n as f,f as a,x as d,y as K,C as Y}from"./index-qxDaNdmW.js";import{b as Q}from"./SaveButton.vue_vue_type_script_setup_true_lang-njbZoRnY.js";import{a as x}from"./VContainer--8Yh9_lo.js";import{V as w,a as E,b as L,c as M,d as W,e as O}from"./VCard-czP0Tocg.js";import{V as I,a as X}from"./VBtn-Z2Y_q0bw.js";import{a as Z,V as ee}from"./VRow-0joQ6avW.js";import{a as te}from"./VTable-Os2sskrs.js";import"./VCheckboxBtn-MjxQbhxv.js";import"./VTextField-v1w0WjcD.js";import"./forwardRefs-pvmbbguz.js";import"./VAvatar-5eNdf9u8.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-0j3wsUwb.js";import"./VDialog-VbNTGXMC.js";import"./scopeId-BXLb_qM2.js";import"./createSimpleFunctional-EIemeP1T.js";import"./VToolbar-g1R_CXgH.js";import"./useDisplayTransactions-nxeivq89.js";import"./VList-_DRPJpxf.js";import"./VDivider--iWefNez.js";import"./VSelect-ZPOVRhSp.js";import"./VChip-P7Hrmz26.js";import"./userData-1XvFSlIL.js";import"./canEditRegistrations-A1ez9bSf.js";import"./group-7fhbY6WJ.js";import"./canDo-yWCfI_4r.js";import"./nil-rxyd0N8M.js";import"./VAutocomplete-6djI41o7.js";import"./form-0fJbSFPv.js";import"./submission-40fey8Hx.js";import"./v4-yQnnJER4.js";import"./VDataTable-_cIy66xe.js";import"./DeleteDialog.vue_vue_type_script_setup_true_lang-DJwH6NBJ.js";import"./VTextarea-ersPNNpJ.js";import"./VForm-mHh8nD4R.js";import"./VNavigationDrawer-p1vGZVH6.js";const ae=N({__name:"RunnerSocket",emits:["data","ready","updating","updated"],setup(b,{emit:D}){const A=z(),g=j(),c=H(),l=D,y=n(),V=n(),p=n(),m=n(!1),C=n(!1),_=n(""),i=n(!1),s=h({mode:"host",wsUri:A.getRunnerSocketURL()}),T=B();s.on("authenticated",()=>{r()}),s.on("auth_failed",()=>{m.value=!1}),s.on("convention_data",o=>{if(!o)return;const e=o;y.value=e.Convention,l("updated",e),l("ready")}),s.on("error",o=>{const e=o;_.value=`Error: ${$(e.Message)}`,i.value=!0,m.value||(C.value=!0)}),s.on("joined",()=>{m.value=!0;const o={Command:"GET_CURRENT_REGISTRATION",Params:new Map,Data:""};s.JSON(o),l("ready")}),s.on("kicked",()=>{c.push("/")}),s.on("open",()=>{const o=T.getTokenByService("GrazeAPI");s.send(`AUTH ${o==null?void 0:o.AccessToken}`)}),s.on("runner_data",o=>{if(!o)return;const e=o;if(!(!e.RunnerLayout||!e.Registration)){if(l("data",e),V.value=e.RunnerLayout,p.value=e.Registration,!y.value||e.RunnerLayout.ConventionUUID!==y.value.ConventionUUID){l("updating"),u(e.RunnerLayout.ConventionUUID);return}l("ready")}});const r=()=>{const o={Key:g.params.session||"",Mode:"runner",UserUUID:g.params.user||""},e={Command:"SET_MODE",Params:new Map,Data:JSON.stringify(o)};s.JSON(e)},u=o=>{const k={Command:"GET_CONVENTION_DATA",Params:new Map,Data:JSON.stringify({ConventionUUID:o})};s.JSON(k)};J(()=>{s.destroy()});const v=()=>{c.push("/")},P=()=>{location.reload()};return(o,e)=>(f(),S(q,null,[i.value?(f(),U(Q,{key:0,modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=k=>i.value=k),message:_.value,timeout:1e4},null,8,["modelValue","message"])):R("",!0),C.value?(f(),U(x,{key:1},{default:t(()=>[a(O,{"max-width":"620",class:"mx-auto",elevation:"10"},{default:t(()=>[a(w,{class:"bg-red-darken-4"},{default:t(()=>[a(E,null,{default:t(()=>[d(" Connection Failure ")]),_:1}),a(L,{style:{opacity:"0.8"}},{default:t(()=>[d(" Failed to establish connection to host ")]),_:1})]),_:1}),a(M,{class:"mt-4"},{default:t(()=>[d(K(_.value),1)]),_:1}),a(W,{class:"justify-space-between"},{default:t(()=>[a(I,{"prepend-icon":"mdi:mdi-home",variant:"flat",color:"primary",onClick:e[1]||(e[1]=k=>Y(c).push("/"))},{default:t(()=>[d(" Dashboard ")]),_:1}),a(I,{"prepend-icon":"mdi:mdi-reload",variant:"flat",color:"success",onClick:P},{default:t(()=>[d(" Retry ")]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0),m.value?(f(),U(x,{key:2,fluid:!0},{default:t(()=>[a(ee,null,{default:t(()=>[a(Z,{class:"text-center"},{default:t(()=>[a(I,{"prepend-icon":"mdi:mdi-link-variant-remove",variant:"flat",color:"error",onClick:v,elevation:"10"},{default:t(()=>[d(" Disconnect ")]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0)],64))}}),$e=N({__name:"RunnerView",emits:["pageTitle"],setup(b,{emit:D}){D("pageTitle","Registration Runner");const g=n([]),c=n(),l=n([]),y=n([]),V=n([]),p=n({ID:0,AdminLayoutUUID:"",ConventionID:0,ConventionUUID:"",Name:"",RunnerLayoutUUID:"",Type:F.ADMIN_LAYOUT_PANELS,Panels:[]}),m=n(),C=n([]),_=n([]),i=n(!1),s=r=>{p.value=r.RunnerLayout,m.value=r.Registration},T=r=>{g.value=r.Accommodations,c.value=r.Convention,l.value=r.Extras,y.value=r.Forms,V.value=r.Interests,C.value=r.Tickets,_.value=r.Venues,p.value&&(i.value=!0)};return(r,u)=>(f(),S("div",null,[i.value&&p.value&&c.value&&m.value?(f(),U(te,{key:0},{default:t(()=>[a(G,{convention:c.value,tickets:C.value,accommodations:g.value,extras:l.value,venues:_.value,interests:V.value,forms:y.value,layout:p.value,"onUpdate:layout":u[0]||(u[0]=v=>p.value=v),modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=v=>m.value=v)},null,8,["convention","tickets","accommodations","extras","venues","interests","forms","layout","modelValue"])]),_:1})):i.value?(f(),U(x,{key:1},{default:t(()=>[a(O,{"max-width":"620",class:"mx-auto",elevation:"10"},{default:t(()=>[a(w,{class:"bg-orange-darken-3"},{default:t(()=>[a(E,null,{default:t(()=>[d(" Awaiting Data ")]),_:1}),a(L,{style:{opacity:"0.9"}},{default:t(()=>[d(" Display will update as soon as host provides registration details ")]),_:1})]),_:1}),a(M,{class:"mt-4 text-center"},{default:t(()=>[a(X,{indeterminate:!0,size:60,width:"8",color:"orange"})]),_:1})]),_:1})]),_:1})):R("",!0),a(ae,{onData:s,onReady:u[2]||(u[2]=v=>i.value=!0),onUpdating:u[3]||(u[3]=v=>i.value=!1),onUpdated:T})]))}});export{$e as default};
