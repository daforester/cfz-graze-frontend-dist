import{I as T,r as p,k as b,L as i,U as u,a1 as E,a5 as C,K as k,M as L,N as l,v as r,O as w,W as o,H as g,R as A}from"./index-3a749005.js";import{G as R}from"./userData-c8b97626.js";import{S as V}from"./setupLogin-5d0a7190.js";import{E as D}from"./emailFormVariant-e5e0aad4.js";import{b as I,V as U,c as y,e as B}from"./VCard-9137d6a4.js";import{j as M}from"./VContainer-01364598.js";import"./VAvatar-114852f3.js";const h=T({__name:"TelegramLoginForm",props:{mode:{},telegramLogin:{},redirectUrl:{default:""},requestAccess:{default:""},size:{default:""},userpic:{type:Boolean,default:!1},radius:{default:""}},emits:["callback"],setup(t,{emit:d}){const n=p(),a=e=>{d("callback",e)};return b(()=>{const e=document.createElement("script");e.async=!0,e.src="https://telegram.org/js/telegram-widget.js?22",e.setAttribute("data-size",t.size||""),e.setAttribute("data-userpic",t.userpic?"true":"false"),e.setAttribute("data-telegram-login",t.telegramLogin),e.setAttribute("data-request-access",t.requestAccess||""),t.radius&&e.setAttribute("data-radius",t.radius||""),t.mode==="callback"?(window.onTelegramAuth=a,e.setAttribute("data-onauth","window.onTelegramAuth(user)")):e.setAttribute("data-auth-url",t.redirectUrl||""),n.value.appendChild(e)}),(e,m)=>(i(),u("div",{ref_key:"telegram",ref:n},null,512))}}),N={class:"form-group row"},O={class:"col"},x=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),G=o("h2",null,"Telegram",-1),q={class:"form-group row"},z={class:"col"},H=o("button",{class:"btn btn-danger form-control"}," Cancel ",-1),J=T({__name:"LoginWithTelegramView",props:{variant:{default:()=>D.COMBINED}},emits:["pageTitle"],setup(t,{emit:d}){d("pageTitle","Telegram Login");const n=E(),a=p(new Map),e=R(),m=C.getInstance();m.getLoginURLs(location.href.substring(0,location.href.length-9)).then(s=>{a.value=s});const f=s=>{m.oAuthLogin("telegram","","","",s).then(({created:_,tokens:c,user:v})=>{V(c,v,n,_)})};return e&&t.variant!=="ADD_CREDENTIAL"&&(Date.now()-new Date(e.CreatedAt||"").getTime()>2e4?n.push("/"):n.push("/profile")),(s,_)=>{const c=k("router-link");return s.variant=="ADD_CREDENTIAL"?(i(),L(M,{key:0,style:{"max-width":"550px"}},{default:l(()=>[r(B,null,{default:l(()=>[r(I,{class:"text-center"},{default:l(()=>[r(U,null,{default:l(()=>[w("Add a Telegram Account")]),_:1})]),_:1}),r(y,{class:"text-center"},{default:l(()=>[a.value.size>0?(i(),u(g,{key:0},[r(h,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:f,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",N,[o("div",O,[r(c,{to:"/"},{default:l(()=>[x]),_:1})])])],64)):A("",!0)]),_:1})]),_:1})]),_:1})):(i(),u(g,{key:1},[G,a.value.size>0?(i(),u(g,{key:0},[r(h,{mode:"callback","telegram-login":a.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":a.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:f,variant:s.variant},null,8,["telegram-login","redirect-url","variant"]),o("div",q,[o("div",z,[r(c,{to:"/"},{default:l(()=>[H]),_:1})])])],64)):A("",!0)],64))}}});export{J as default};
