import{a as M,b as K,c as G,C as Y,V as H}from"./VExpansionPanel-1a86b1f5.js";import{s as A}from"./index-ba0d422e.js";import{T as k}from"./ticket-b671e8ba.js";import{u as R}from"./useGrazeAPI-41a94fc6.js";import{a as V,V as m}from"./VRow-bbf645cf.js";import{V as z,a as X}from"./VChip-ef914c47.js";import{V as T}from"./VTextField-bed8b720.js";import{V as q}from"./VSelect-e4d5ef04.js";import{V as x}from"./VBtn-aed54004.js";import{d as N,X as y,Y as S,y as g,h as F,o as c,N as D,c as e,w as t,F as C,O as $,b,e as P,G as L,L as U,f as r,R as j,K as J}from"./index-629d6ed3.js";import{_ as Q}from"./SelectTags.vue_vue_type_script_setup_true_lang-a4bd00f1.js";import{_ as O}from"./SaveButton.vue_vue_type_script_setup_true_lang-922758a2.js";import{a as E}from"./VSheet-405b4919.js";import{v as B}from"./v4-a960c1f4.js";import{V as W}from"./VContainer-10e79729.js";const Z=r("p",{title:"Automatically calculated",class:"text-grey-lighten-1"},"Applicable Tickets:",-1),ee=N({__name:"AccommodationCost",props:y({convention:{}},{modelValue:{required:!0}}),emits:y(["deleted"],["update:modelValue"]),setup(v,{emit:p}){const l=S(v,"modelValue"),u=g([]);R().getConventionTickets(v.convention.ConventionUUID).then(i=>{i&&(u.value=i)});const _=[{title:"Per Room",value:"PER_ROOM"},{title:"Per Person",value:"PER_PERSON"}],h=()=>{p("deleted")},s=F(()=>u.value.filter(i=>(i.Type===k.TICKET_TYPE_TICKET||i.Type===k.TICKET_TYPE_ADD_ON)&&i.RequiresAccommodation&&i.DateStart===l.value.DateStart&&i.DateEnd===l.value.DateEnd));return(i,d)=>(c(),D(C,null,[e(V,{class:"align-center",dense:""},{default:t(()=>[e(m,{class:"flex-grow-0 flex-shrink-1 text-no-wrap font-italic"},{default:t(()=>[Z]),_:1}),e(m,{class:"flex-grow-1"},{default:t(()=>[e(z,null,{default:t(()=>[(c(!0),D(C,null,$(s.value,o=>(c(),b(X,{key:o.ID,title:"Automatically calculated",disabled:""},{default:t(()=>[P(L(o.Name),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(V,{dense:""},{default:t(()=>[e(m,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(T,{label:U(A).formLabelDateStart,type:"date",variant:"outlined",modelValue:l.value.DateStart,"onUpdate:modelValue":d[0]||(d[0]=o=>l.value.DateStart=o)},null,8,["label","modelValue"])]),_:1}),e(m,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(T,{label:U(A).formLabelDateEnd,type:"date",variant:"outlined",modelValue:l.value.DateEnd,"onUpdate:modelValue":d[1]||(d[1]=o=>l.value.DateEnd=o)},null,8,["label","modelValue"])]),_:1}),e(m,{cols:"5",sm:"6",md:"3"},{default:t(()=>[e(T,{label:U(A).formLabelPrice,type:"number","prepend-inner-icon":"mdi:mdi-currency-gbp",variant:"outlined",modelValue:l.value.Price,"onUpdate:modelValue":d[2]||(d[2]=o=>l.value.Price=o),modelModifiers:{number:!0}},null,8,["label","modelValue"])]),_:1}),e(m,{cols:"5",sm:"4",md:"2"},{default:t(()=>[e(q,{label:U(A).formLabelPriceType,variant:"outlined",modelValue:l.value.Type,"onUpdate:modelValue":d[3]||(d[3]=o=>l.value.Type=o),items:_,"item-value":"value","item-title":"title"},null,8,["label","modelValue"])]),_:1}),e(m,{cols:"2",sm:"2",md:"1",class:"text-right"},{default:t(()=>[e(x,{color:"red",icon:"mdi:mdi-minus",onClick:h})]),_:1})]),_:1})],64))}}),oe=r("h4",null," Room Pool ",-1),te=r("p",{class:"mb-4"}," Hotel rooms that can be used for this accommodation option. ",-1),ae=r("p",null," Pool total: ",-1),le=r("h4",null," Accommodation Costs ",-1),ne=r("p",{class:"mb-4"}," How much the attendee is charged by the convention for the accommodation. ",-1),ie=N({__name:"Accommodation",props:y({convention:{},venues:{}},{modelValue:{required:!0}}),emits:y(["deleted"],["update:modelValue"]),setup(v,{emit:p}){const l=R(),u=S(v,"modelValue"),a=g(j(u.value)),_=F(()=>v.venues.map(o=>o.Rooms.map(n=>({title:` ${o.Name} - ${n.Name}`,value:n}))).flat()),h=()=>{a.value.Costs||(a.value.Costs=[]),a.value.Costs.push({ID:0,CostUUID:B(),Availability:0,DateStart:"",DateEnd:"",Price:0,Type:Y.PER_ROOM})},s=o=>{a.value.Costs.splice(o,1)},i=({callback:o})=>{l.deleteAccommodation(a.value.AccommodationUUID).then(n=>{n?o&&(o("Accommodation Deleted"),p("deleted")):o&&o("Failed to Delete Accommodation")}).catch(()=>{o&&o("Failed to Delete Accommodation")})},d=({callback:o})=>{l.saveAccommodation(a.value).then(n=>{n?(a.value.ID=n.ID,u.value=n,o&&o("Accommodation Saved")):o&&o("Failed to Save Accommodation")}).catch(()=>{o&&o("Failed to Save Accommodation")})};return(o,n)=>(c(),b(M,null,{default:t(()=>[e(K,null,{default:t(()=>[P(L(a.value.Name),1)]),_:1}),e(G,null,{default:t(()=>[e(E,null,{default:t(()=>[e(V,null,{default:t(()=>[e(m,null,{default:t(()=>[e(T,{modelValue:a.value.Name,"onUpdate:modelValue":n[0]||(n[0]=f=>a.value.Name=f),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(m,null,{default:t(()=>[oe,te,e(q,{clearable:!0,modelValue:a.value.Pool,"onUpdate:modelValue":n[1]||(n[1]=f=>a.value.Pool=f),items:_.value,label:"Select",multiple:"",hint:"Pick appropriate rooms","persistent-hint":"",variant:"outlined","item-title":"title","item-value":"value",eager:!0},null,8,["modelValue","items"]),ae,r("p",null,[e(Q,{label:"Required Tags",variant:"outlined",modelValue:a.value.RequiredTags,"onUpdate:modelValue":n[2]||(n[2]=f=>a.value.RequiredTags=f),convention:o.convention,organisation:o.convention.OrganisationUUID,chips:!0,clearable:!0,hint:"Tags that a user must have to select this accommodation."},null,8,["modelValue","convention","organisation"])]),le,ne,a.value.Costs?(c(!0),D(C,{key:0},$(a.value.Costs,(f,I)=>(c(),b(ee,{key:`venue-room-${a.value.ID}-cost-${f.ID}`,convention:o.convention,modelValue:a.value.Costs[I],"onUpdate:modelValue":w=>a.value.Costs[I]=w,onDeleted:w=>s(I)},null,8,["convention","modelValue","onUpdate:modelValue","onDeleted"]))),128)):J("",!0)]),_:1})]),_:1}),e(V,{"no-gutters":""},{default:t(()=>[e(m,{class:"text-left"},{default:t(()=>[e(x,{color:"primary","prepend-icon":"mdi:mdi-plus",onClick:h},{default:t(()=>[P("Add Row")]),_:1})]),_:1}),e(m,{class:"text-right"},{default:t(()=>[e(O,{class:"mr-2",color:"red-darken-3",label:"Delete",onClick:i}),e(O,{onClick:d})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),se=r("h3",null,"Accommodation",-1),ue=r("p",null," Accommodation options presented to attendees, these are effectively virtual room types which are linked to the available room pools created in the venues tab. ",-1),de=r("p",null," Use the venues tab to configure internal data about the venues and room supply. ",-1),ge=N({__name:"AccommodationEditorView",props:{modelValue:{required:!0}},emits:["update:modelValue"],setup(v){const p=R(),l=S(v,"modelValue"),u=g([]),a=g([]);p.getConventionAccommodation(l.value.ConventionUUID).then(s=>{s&&(u.value=s)}),p.getConventionVenues(l.value.ConventionUUID).then(s=>{s&&(a.value=s)});const _=()=>{const s={ID:0,AccommodationUUID:B(),ConventionID:l.value.ID,ConventionUUID:l.value.ConventionUUID,Order:u.value.length+1,Name:"New Accommodation Option",Pool:[],Costs:[],RequiredTags:[]};p.saveAccommodation(s).then(i=>{i&&u.value.push(i)})},h=s=>{u.value.splice(s,1)};return(s,i)=>(c(),D(C,null,[e(W,{fluid:!0,class:"px-0"},{default:t(()=>[e(V,null,{default:t(()=>[e(m,null,{default:t(()=>[se]),_:1})]),_:1})]),_:1}),ue,de,e(E,null,{default:t(()=>[e(H,{variant:"accordion"},{default:t(()=>[(c(!0),D(C,null,$(u.value,(d,o)=>(c(),b(ie,{key:d.AccommodationUUID,convention:l.value,venues:a.value,modelValue:u.value[o],"onUpdate:modelValue":n=>u.value[o]=n,onDeleted:n=>h(o)},null,8,["convention","venues","modelValue","onUpdate:modelValue","onDeleted"]))),128))]),_:1}),e(E,{class:"pa-2"},{default:t(()=>[e(x,{color:"primary",onClick:_},{default:t(()=>[P("Add Accommodation")]),_:1})]),_:1})]),_:1})],64))}});export{ge as _};
