import{p as Me,n as Fe,e as K,t as q,c as Ne,G as Pe,v as r,H as C,x as Te,I as z,a1 as fe,a2 as we,r as S,a3 as ce,K as s,L,M as v,$ as pe,S as J,a8 as Ee,Z as k,Q as P,R as A,O as M,_ as Le,U as w,N as H,a4 as Ye,a0 as Be,w as $e}from"./index-25f41150.js";import{a as He,F as ee}from"./form-e2a93b7c.js";import{_ as xe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-f22b9d4e.js";import{m as Ge,j as qe,k as je,l as Je,n as Ke,o as ze,p as We,u as Qe,q as Xe,r as Ze,s as et,t as tt,v as at,w as lt,x as ot,y as Re,z as ye,A as Oe,_ as Ce,f as nt,g as it,h as st,i as ut,d as rt}from"./VWindowItem-0f662fd3.js";import{e as dt,T as mt,d as ct}from"./FormRenderer.vue_vue_type_style_index_0_lang-d1ea3ad1.js";import{a as me,V as j}from"./VRow-df9d4574.js";import{V as Ae}from"./VTextField-45573a95.js";import{V as X}from"./copyToClipboard-85dcca9e.js";import{u as Ut,j as Se}from"./VContainer-459212ff.js";import{v as te}from"./v4-a960c1f4.js";import{S as _t}from"./submission-56c4c4f1.js";import{V as Ie}from"./VBtn-b43a7716.js";import{c as vt,e as ke}from"./VCard-c23c6a8c.js";import{V as Tt}from"./VDialog-7f954098.js";import{u as At,V as St}from"./VToolbar-fdafeef6.js";import{V as Et}from"./VSpacer-f1bba5ed.js";import{V as ge}from"./VTable-e6f88803.js";import"./VChip-1dc1efee.js";import"./scopeId-c1903d43.js";import"./VAvatar-9a046181.js";import"./VCheckbox-e1509766.js";import"./VToolbarItems-dd443a9e.js";import"./VList-5553742f.js";import"./index-71069b21.js";import"./VTextarea-89b15867.js";import"./userData-bf2ea0be.js";import"./VForm-1e090097.js";var he=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(he||{});const It=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var ae=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(ae||{});const Dt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var De=(e=>(e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(De||{});const pt=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var y=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(y||{});const ft=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Rt=Me({itemsLength:{type:[Number,String],required:!0},...Ge(),...qe(),...je()},"VDataTableServer"),yt=Fe()({name:"VDataTableServer",props:Rt(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,O)=>!0},setup(e,O){let{emit:d,slots:t}=O;const{groupBy:o}=Je(e),{sortBy:u,multiSort:c,mustSort:E}=Ke(e),{page:I,itemsPerPage:h}=ze(e),l=K(()=>parseInt(e.itemsLength,10)),{columns:i,headers:n}=We(e,{groupBy:o,showSelect:q(e,"showSelect"),showExpand:q(e,"showExpand")}),{items:p}=Qe(e,i),{toggleSort:T}=Xe({sortBy:u,multiSort:c,mustSort:E,page:I}),{opened:B,isGroupOpen:f,toggleGroup:F,extractRows:le}=Ze({groupBy:o,sortBy:u}),{pageCount:oe,setItemsPerPage:ne}=et({page:I,itemsPerPage:h,itemsLength:l}),{flatItems:Z}=tt(p,o,B),{isSelected:ie,select:Y,selectAll:Ue,toggleSelect:se,someSelected:ue,allSelected:_e}=at(e,{allItems:p,currentPage:p}),{isExpanded:ve,toggleExpand:re}=lt(e),a=K(()=>le(p.value));ot({page:I,itemsPerPage:h,sortBy:u,groupBy:o,search:q(e,"search")}),Ne("v-data-table",{toggleSort:T,sortBy:u}),Pe({VDataTableRows:{hideNoData:q(e,"hideNoData"),noDataText:q(e,"noDataText"),loading:q(e,"loading"),loadingText:q(e,"loadingText")}});const m=K(()=>({page:I.value,itemsPerPage:h.value,sortBy:u.value,pageCount:oe.value,toggleSort:T,setItemsPerPage:ne,someSelected:ue.value,allSelected:_e.value,isSelected:ie,select:Y,selectAll:Ue,toggleSelect:se,isExpanded:ve,toggleExpand:re,isGroupOpen:f,toggleGroup:F,items:a.value,groupedItems:Z.value,columns:i.value,headers:n.value}));Ut(()=>{const[U]=Re.filterProps(e),[_]=ye.filterProps(e),[g]=Oe.filterProps(e),[b]=ge.filterProps(e);return r(ge,Te({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},b),{top:()=>{var R;return(R=t.top)==null?void 0:R.call(t,m.value)},default:()=>{var R,x,W,de;return t.default?t.default(m.value):r(C,null,[(R=t.colgroup)==null?void 0:R.call(t,m.value),r("thead",{class:"v-data-table__thead",role:"rowgroup"},[r(ye,Te(_,{sticky:e.fixedHeader}),t)]),(x=t.thead)==null?void 0:x.call(t,m.value),r("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[t.body?t.body(m.value):r(Oe,Te(g,{items:Z.value}),t)]),(W=t.tbody)==null?void 0:W.call(t,m.value),(de=t.tfoot)==null?void 0:de.call(t,m.value)])},bottom:()=>t.bottom?t.bottom(m.value):r(Re,U,{prepend:t["footer.prepend"]})})})}}),Ot=z({__name:"EditAdminLayout",props:fe({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:fe(["save"],["update:modelValue"]),setup(e,{emit:O}){const d=we(e,"modelValue"),t=S(ce(e.layout)),o=S([]),u=pe(),c=({callback:l})=>{const i=()=>{l&&l("Failed to Save Layout")},n=()=>{l&&l("Layout Saved")};u.saveAdminLayout(t.value).then(p=>{p?(n(),O("save",p)):i()}).catch(()=>{i()})},E=()=>({ID:0,LayoutPanelUUID:te(),AdminLayoutID:t.value.ID,AdminLayoutUUID:t.value.AdminLayoutUUID,Name:"",Order:t.value.Panels.length+1,Items:[],RequiredFormType:ee.FORM_TYPE_NIL}),I=l=>()=>({ID:0,LayoutItemUUID:te(),LayoutPanelID:l.ID,LayoutPanelUUID:l.LayoutPanelUUID,Label:"",SourceType:ae.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:l.Items.length+1}),h=l=>{const i=o.value.find(n=>n.value===l.SectionFieldUUID);i&&(l.SectionFieldID=i.object.ID,l.SectionField=i.object)};return u.getConventionForms(e.layout.ConventionUUID).then(l=>{l.forEach(i=>i.Sections.forEach(n=>n.Fields&&o.value.push(...n.Fields.map(p=>{var B;return{title:`${i.Name} - ${n.Name} - ${(B=p.Field)==null?void 0:B.Name}`,value:p.SectionFieldUUID,object:p}})))),o.value.sort(dt("title"))}),(l,i)=>(s(),L(xe,{modelValue:d.value,"onUpdate:modelValue":i[3]||(i[3]=n=>d.value=n),onSave:c,title:l.title,color:"primary"},{default:v(()=>[r(Se,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[r(me,null,{default:v(()=>[r(j,{cols:"12",sm:"6"},{default:v(()=>[r(Ae,{modelValue:t.value.Name,"onUpdate:modelValue":i[0]||(i[0]=n=>t.value.Name=n),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(j,{cols:"12",sm:"6"},{default:v(()=>[r(X,{modelValue:t.value.Type,"onUpdate:modelValue":i[1]||(i[1]=n=>t.value.Type=n),label:"Layout Type",items:J(It),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),r(Ce,{modelValue:t.value.Panels,"onUpdate:modelValue":i[2]||(i[2]=n=>t.value.Panels=n),"new-item":E,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Ee({_:2},[k(t.value.Panels,(n,p)=>({name:`panel_${p}`,fn:v(()=>[r(Se,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[r(me,null,{default:v(()=>[r(j,{cols:"12",sm:"6"},{default:v(()=>[r(Ae,{modelValue:n.Name,"onUpdate:modelValue":T=>n.Name=T,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(j,{cols:"12",sm:"6"},{default:v(()=>[r(X,{modelValue:n.RequiredFormType,"onUpdate:modelValue":T=>n.RequiredFormType=T,items:J(He),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:2},1024),r(Ce,{modelValue:n.Items,"onUpdate:modelValue":T=>n.Items=T,"new-item":I(n),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Ee({_:2},[k(n.Items,(T,B)=>({name:`item_${B}`,fn:v(()=>[r(Se,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[r(me,null,{default:v(()=>[r(j,{cols:"12",sm:"6"},{default:v(()=>[r(Ae,{modelValue:T.Label,"onUpdate:modelValue":f=>T.Label=f,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),r(me,null,{default:v(()=>[r(j,{cols:"12",sm:"6"},{default:v(()=>[r(X,{modelValue:T.SourceType,"onUpdate:modelValue":f=>T.SourceType=f,label:"Source Type",items:J(Dt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),r(j,{cols:"12",sm:"6"},{default:v(()=>[T.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(s(),L(X,{key:0,modelValue:T.SectionFieldUUID,"onUpdate:modelValue":f=>T.SectionFieldUUID=f,label:"Form Data",items:o.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:f=>h(T)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):T.SourceType==="LAYOUT_ITEM_SOURCE_META"?(s(),L(X,{key:1,modelValue:T.MetaField,"onUpdate:modelValue":f=>T.MetaField=f,label:"Miscellaneous Data",items:J(pt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):T.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(s(),L(X,{key:2,modelValue:T.UserField,"onUpdate:modelValue":f=>T.UserField=f,label:"User Profile Data",items:J(ft),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ct={key:0,class:"accommodationList"},gt=z({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(e){const O=K(()=>{if(!e.value)return[];const d=JSON.parse(e.value),t=e.accommodations.filter(o=>d.includes(o.AccommodationUUID)).sort((o,u)=>{const c=d.findIndex(I=>I===o.AccommodationUUID),E=d.findIndex(I=>I===u.AccommodationUUID);return c>E?1:-1});return ce(t)});return(d,t)=>d.value?(s(),A("ol",Ct,[(s(!0),A(C,null,k(O.value,o=>(s(),A("li",{key:o.AccommodationUUID},M(o.Name),1))),128))])):P("",!0)}});const Lt=Le(gt,[["__scopeId","data-v-1ba5f67a"]]),kt={key:0,class:"addonList"},ht={key:0},bt=z({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const O=K(()=>{if(!e.value)return;const d=JSON.parse(e.value),t=Object.keys(d),o=ce(e.extras);return o.forEach(u=>{u.Options=u.Options.filter(c=>t.includes(c.OptionUUID)?(c.Choices=c.Choices.filter(E=>E.TagUUID===d[c.OptionUUID].choiceId),d[c.OptionUUID].checked):!1)}),o.filter(u=>u.Options.length>0),o});return(d,t)=>d.value?(s(),A("ul",kt,[(s(!0),A(C,null,k(O.value,o=>(s(),A("li",{key:o.ExtraUUID},[w("strong",null,M(o.Name),1),w("ul",null,[(s(!0),A(C,null,k(o.Options,u=>(s(),A("li",{key:u.OptionUUID},[H(M(u.Name)+" ",1),u.Choices.length==1?(s(),A("small",ht,"("+M(u.Choices[0].Title)+")",1)):P("",!0)]))),128))])]))),128))])):P("",!0)}});const Vt=Le(bt,[["__scopeId","data-v-4ed6842b"]]),Mt={key:0},Ft=z({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const O=K(()=>{if(!e.value)return;const d=JSON.parse(e.value);return Object.entries(d).filter(([,t])=>t).map(([t,o])=>e.interests.find(u=>u.InterestUUID===t)).filter(t=>t!==void 0)});return(d,t)=>d.value?(s(),A("ul",Mt,[(s(!0),A(C,null,k(O.value,o=>(s(),A("li",{key:o.InterestUUID},M(o.Name),1))),128))])):P("",!0)}}),Nt=w("br",null,null,-1),Pt=w("small",null,"Options:",-1),wt=w("br",null,null,-1),Yt=w("small",null,"Addons:",-1),Bt=z({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const O=K(()=>{if(!e.value)return;let d={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{d=JSON.parse(e.value),"ticket"in d&&(d.Ticket=d.ticket),"addonsChecked"in d&&(d.AddonsChecked=d.addonsChecked),"componentsChecked"in d&&(d.ComponentsChecked=d.componentsChecked)}catch{}return d.Ticket.filter(t=>{const o=e.tickets.find(u=>u.TicketUUID===t);return!(!o||o.Type!==mt.TICKET_TYPE_TICKET)}).map(t=>{const o=e.tickets.find(c=>c.TicketUUID===t),u=ce(o);return u.TicketComponents=o.TicketComponents.filter(c=>d.ComponentsChecked.includes(c.TicketUUID)),u.AddonTickets=o.AddonTickets.filter(c=>d.AddonsChecked.includes(c.TicketUUID)),u})});return(d,t)=>d.value?(s(!0),A(C,{key:0},k(O.value,o=>(s(),A("div",{key:o.TicketUUID},[w("strong",null,M(o.Name),1),o.TicketComponents.length>0?(s(),A(C,{key:0},[Nt,Pt,H("  "),(s(!0),A(C,null,k(o.TicketComponents,u=>(s(),A(C,{key:u.TicketUUID},[w("small",null,M(u.Name),1),H("  ")],64))),128))],64)):P("",!0),o.AddonTickets.length>0?(s(),A(C,{key:1},[wt,Yt,H("  "),(s(!0),A(C,null,k(o.AddonTickets,u=>(s(),A("small",{key:u.TicketUUID},[H("("),w("em",null,M(u.Name),1),H(")")]))),128))],64)):P("",!0)]))),128)):P("",!0)}}),$t=z({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["reload"],setup(e,{emit:O}){const d=pe(),t=S(),o=S(),u=S(),c=S(),E=S(!1),I=l=>{console.log(l)},h=(l,i,n)=>{o.value=l,d.getRegistrationGroup(n.RegistrationUUID||"").then(p=>{u.value=p,t.value=i,c.value=n,E.value=!0})};return(l,i)=>(s(),A(C,null,[l.header.key=="actions"?(s(),L(Ie,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:i[0]||(i[0]=n=>I(l.item.raw))})):l.header.type==="ACCOMMODATION"&&l.accommodations.length>0?(s(),L(Lt,{key:1,value:l.item.raw[l.header.key],accommodations:l.accommodations},null,8,["value","accommodations"])):l.header.type==="EXTRAS"&&l.extras.length>0?(s(),L(Vt,{key:2,value:l.item.raw[l.header.key],extras:l.extras},null,8,["value","extras"])):l.header.type==="INTERESTS"&&l.interests.length>0?(s(),L(Ft,{key:3,value:l.item.raw[l.header.key],interests:l.interests},null,8,["value","interests"])):l.header.type==="TICKET"&&l.tickets.length>0?(s(),L(Bt,{key:4,value:l.item.raw[l.header.key],tickets:l.tickets},null,8,["value","tickets"])):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(s(!0),A(C,{key:5},k(l.item.raw[l.header.key],n=>(s(),A("ul",{key:n.Heading},[w("li",null,[w("strong",null,M(n.Heading)+":",1),H(" "+M(J(_t)(n.Submission.Status))+" ",1),r(Ie,{icon:"mdi:mdi-form-select",variant:"flat",onClick:p=>h(n.Registration,n.Form,n.Submission)},null,8,["onClick"])])]))),128)):(s(),A(C,{key:6},[H(M(l.item.raw[l.header.key]),1)],64)),E.value&&c.value&&t.value?(s(),L(Tt,{key:7,modelValue:E.value,"onUpdate:modelValue":i[3]||(i[3]=n=>E.value=n),scrollable:!0},{default:v(()=>[r(ke,{class:"bg-red-darken-4"},{default:v(()=>[r(vt,null,{default:v(()=>[r(ct,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=n=>t.value=n),admin:!0,convention:l.convention,data:c.value,editable:!0,"registration-group":u.value,onClose:i[2]||(i[2]=n=>{E.value=!1,O("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0)],64))}}),va=z({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:O}){var re;O("pageTitle","Registration Manager");const d=Ye(),t=Be(),o=S(!0);let u=((re=d.params.convention)==null?void 0:re.toString())||"";const c=S({ID:0,ConventionUUID:te(),OrganisationID:0,OrganisationUUID:At,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),E=pe(),I=S({ID:0,AdminLayoutUUID:te(),ConventionID:c.value.ID,ConventionUUID:c.value.ConventionUUID,Name:"Registration Table",Type:he.ADMIN_LAYOUT_TABLE,Panels:[]}),h=S([]),l=S([]),i=S([]),n=S(1),p=S(10),T=S([]),B=S(0),f=S(!1),F=S(""),le=S([]),oe=S([]),ne=S([]),Z=S([]),ie=S([]),Y=S(0);$e(Y,a=>{a===7&&ue()});const Ue=()=>{h.value=[],l.value=[],i.value=[];try{E.getConventionAdminLayoutByName(c.value.ConventionUUID,"Registration Table").then(a=>{Y.value+=1,a?I.value=a:(I.value.ConventionID=c.value.ID,I.value.ConventionUUID=c.value.ConventionUUID)})}catch{I.value.ConventionID=c.value.ID,I.value.ConventionUUID=c.value.ConventionUUID}try{E.getConventionForms(c.value.ConventionUUID).then(a=>{Y.value+=1,a&&(h.value=a)})}catch{}try{E.getConventionAccommodation(c.value.ConventionUUID).then(a=>{Y.value+=1,a&&(le.value=a)})}catch{}try{E.getConventionVenues(c.value.ConventionUUID).then(a=>{Y.value+=1,a&&(ie.value=a)})}catch{}try{E.getConventionExtras(c.value.ConventionUUID).then(a=>{Y.value+=1,a&&(oe.value=a)})}catch{}try{E.getConventionInterests(c.value.ConventionUUID).then(a=>{Y.value+=1,a&&(ne.value=a)})}catch{}try{E.getConventionTickets(c.value.ConventionUUID).then(a=>{Y.value+=1,a&&(Z.value=a)})}catch{}},se=({page:a,itemsPerPage:m,sortBy:U})=>{n.value=a,T.value=U;const _=i.value.find(R=>R.uuid==F.value),g=_==null?void 0:_.layout.Items;let b="";if(U&&g&&U.length>=1){const R=g.find(x=>x.LayoutItemUUID==U[0].key);switch(R==null?void 0:R.UserField){case y.USER_DATA_SOURCE_DISPLAY_NAME:b="user.display_name";break;case y.USER_DATA_SOURCE_HANDLE:b="user.handle";break;case y.USER_DATA_SOURCE_EMAIL:b="user.email";break}}try{const R={Offset:(a-1)*m,Order:b,Limit:m};(_==null?void 0:_.layout.RequiredFormType)===ee.FORM_TYPE_ACCOMMODATION&&(R.Accommodation=!0),(_==null?void 0:_.layout.RequiredFormType)===ee.FORM_TYPE_BADGE&&(R.Badge=!0),(_==null?void 0:_.layout.RequiredFormType)===ee.FORM_TYPE_DEALER&&(R.Dealer=!0),E.searchConventionRegistrations(c.value.ConventionUUID,R).then(x=>{x&&(B.value=x.Total,l.value=x.Registrations,i.value.forEach(W=>{const de=W.layout;W.items=l.value.map(N=>{const V={};return W.headers.forEach(be=>{const D=de.Items.find(Q=>Q.LayoutItemUUID===be.key);if(D){if(D.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&D.SectionField)N.Submissions.forEach(Q=>{const G=Q.Data.find($=>$.SectionFieldUUID===D.SectionFieldUUID);if(G){V[D.LayoutItemUUID]=G.Data;return}});else if(D.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&D.UserField)switch(D.UserField){case y.USER_DATA_SOURCE_DISPLAY_NAME:V[D.LayoutItemUUID]=N.User.DisplayName;break;case y.USER_DATA_SOURCE_EMAIL:V[D.LayoutItemUUID]=N.User.Additional.Email;break;case y.USER_DATA_SOURCE_HANDLE:V[D.LayoutItemUUID]=N.User.Handle;break;case y.USER_DATA_SOURCE_DATE_OF_BIRTH:V[D.LayoutItemUUID]=N.User.Additional.DOB;break;case y.USER_DATA_SOURCE_FIRST_NAME:V[D.LayoutItemUUID]=N.User.Additional.FirstName;break;case y.USER_DATA_SOURCE_LAST_NAME:V[D.LayoutItemUUID]=N.User.Additional.LastName;break;case y.USER_DATA_SOURCE_TELEGRAM:V[D.LayoutItemUUID]="";break}else if(D.SourceType==="LAYOUT_ITEM_SOURCE_META"&&D.MetaField){const Q=N.Submissions.find(G=>{var $;return(($=G.Form)==null?void 0:$.Type)===ee.FORM_TYPE_REGISTRATION});switch(D.MetaField){case De.META_DATA_SOURCE_SUBMISSION_DATE:Q?V[D.LayoutItemUUID]=new Date(Q.CreatedAt||"").toLocaleString():V[D.LayoutItemUUID]=new Date(N.CreatedAt||"").toLocaleString();break;case De.META_DATA_SOURCE_SUBMISSION_STATUS:V[D.LayoutItemUUID]=N.Submissions.map(G=>{const $=h.value.find(Ve=>Ve.FormUUID===G.FormUUID);return{Heading:$==null?void 0:$.Heading,Form:$,Submission:G,Registration:N}});break}}}}),V})}),o.value=!1)})}catch{}},ue=()=>{I.value.Panels.forEach(a=>{a.Items.forEach(m=>{(m.SectionField==null||m.SectionField.Field==null)&&h.value.find(U=>{U.Sections.find(_=>{if(_.Fields){const g=_.Fields.find(b=>b.SectionFieldUUID===m.SectionFieldUUID);if(g)return m.SectionField=g,!0}})})})}),I.value.Panels.length>0&&(i.value=[],I.value.Panels.forEach(a=>{const m={uuid:te(),order:a.Order,name:a.Name,headers:[],items:[],layout:a},U={key:"actions",title:"Actions",align:"start",sortable:!1,type:""};a.Items.sort((_,g)=>_.Order>g.Order?1:_.Order==g.Order?0:-1),m.headers=a.Items.map(_=>{var g,b;return{key:_.LayoutItemUUID,title:_.Label||((b=(g=_.SectionField)==null?void 0:g.Field)==null?void 0:b.Label)||"",align:_.Align==="end"?"end":"start",sortable:ve(_),type:_e(_)}}),m.headers.push(U),i.value.push(m)})),(F.value==null||F.value=="")&&i.value.length>0&&(F.value=i.value[0].uuid)};u?E.getConvention(u).then(a=>{a&&(c.value=a,Ue())}).catch(()=>{t.push("/")}):t.push("/");const _e=a=>{var m,U;if(a.SourceType===ae.LAYOUT_ITEM_SOURCE_META)return`${a.SourceType}.${a.MetaField}`;if(a.SourceType===ae.LAYOUT_ITEM_SOURCE_FORM)return(U=(m=a.SectionField)==null?void 0:m.Field)==null?void 0:U.Type;if(a.SourceType===ae.LAYOUT_ITEM_SOURCE_USER)return`${a.SourceType}.${a.UserField}`},ve=a=>[y.USER_DATA_SOURCE_DISPLAY_NAME,y.USER_DATA_SOURCE_EMAIL,y.USER_DATA_SOURCE_HANDLE,y.USER_DATA_SOURCE_DATE_OF_BIRTH,y.USER_DATA_SOURCE_FIRST_NAME,y.USER_DATA_SOURCE_LAST_NAME].includes(a.UserField);return(a,m)=>(s(),L(rt,null,{default:v(()=>[r(St,{color:"blue-darken-4"},{default:v(()=>[r(nt,{modelValue:F.value,"onUpdate:modelValue":m[0]||(m[0]=U=>F.value=U),"show-arrows":""},{default:v(()=>[(s(!0),A(C,null,k(i.value,U=>(s(),L(it,{key:U.uuid,value:U.uuid},{default:v(()=>[H(M(U.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(Et),r(Ie,{icon:"mdi:mdi-cog-outline",onClick:m[1]||(m[1]=U=>f.value=!0)})]),_:1}),r(ut,{modelValue:F.value,"onUpdate:modelValue":m[4]||(m[4]=U=>F.value=U)},{default:v(()=>[(s(!0),A(C,null,k(i.value,U=>(s(),L(st,{key:U.uuid,value:U.uuid},{default:v(()=>[U.uuid===F.value?(s(),L(ke,{key:0,class:"pa-2"},{default:v(()=>[r(J(yt),{"items-per-page":p.value,"onUpdate:itemsPerPage":m[3]||(m[3]=_=>p.value=_),headers:U.headers,"items-length":B.value,items:U.items,"item-value":"LayoutItemUUID",loading:o.value,"onUpdate:options":se},Ee({_:2},[k(U.headers,_=>({name:`item.${_.key}`,fn:v(({item:g})=>[r($t,{header:_,item:g,accommodations:le.value,convention:c.value,extras:oe.value,interests:ne.value,tickets:Z.value,venues:ie.value,onReload:m[2]||(m[2]=b=>se({page:n.value,itemsPerPage:p.value,sortBy:T.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):P("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),f.value?(s(),L(Ot,{key:0,title:"Edit Layout",modelValue:f.value,"onUpdate:modelValue":m[5]||(m[5]=U=>f.value=U),layout:I.value,onSave:m[6]||(m[6]=U=>{f.value=!1,ue()})},null,8,["modelValue","layout"])):P("",!0)]),_:1}))}});export{va as default};
