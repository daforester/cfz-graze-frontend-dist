import{p as he,n as ge,e as G,t as H,c as ke,G as Me,v as i,H as h,x as Ue,I as j,a1 as Se,a2 as be,r as I,a3 as ie,K as s,L as g,M as v,$ as Re,S as W,a8 as Ae,Z as M,Q as P,R as A,O as w,_ as Oe,U as Y,N as $,a4 as Ve,a0 as Ne,w as Fe}from"./index-3dbbdf8e.js";import{_ as Pe}from"./ModelDialog.vue_vue_type_script_setup_true_lang-4a5b3c6e.js";import{m as we,j as Be,k as Ye,l as $e,n as xe,o as He,p as Ge,u as je,q as Je,r as Ke,s as qe,t as ze,v as We,w as Qe,x as Xe,y as Ee,z as Ie,A as De,_ as fe,f as Ze,g as et,h as tt,i as at,d as lt}from"./VWindowItem-2ff1291d.js";import{c as ot,T as nt}from"./filter-37ad3f81.js";import{a as se,V as q}from"./VRow-1a236f65.js";import{V as _e}from"./VTextField-1dcfda12.js";import{V as z}from"./VSelect-1f832848.js";import{u as st,j as ve}from"./VContainer-b139e2d0.js";import{v as Q}from"./v4-a960c1f4.js";import{S as it}from"./submission-56c4c4f1.js";import{V as ye}from"./VBtn-e20edf1c.js";import{u as ut,V as rt}from"./VToolbar-509851c5.js";import{V as dt}from"./VSpacer-c6ec1d11.js";import{e as mt}from"./VCard-b458aba9.js";import{V as pe}from"./VTable-1a6d55f4.js";import"./VChip-021f1336.js";import"./scopeId-0b94c62e.js";import"./VAvatar-27a9acec.js";import"./VDialog-b1ddca4e.js";import"./VCheckboxBtn-ca8bc703.js";import"./VToolbarItems-8d8a646f.js";import"./VList-bdf607a3.js";var Ce=(t=>(t.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",t.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",t))(Ce||{});const ct=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var X=(t=>(t.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",t.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",t.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",t))(X||{});const Ut=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Te=(t=>(t.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",t.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",t))(Te||{});const _t=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var f=(t=>(t.USER_DATA_SOURCE_NULL="",t.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",t.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",t.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",t.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",t.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",t.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",t.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",t.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",t))(f||{});const vt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],At=he({itemsLength:{type:[Number,String],required:!0},...we(),...Be(),...Ye()},"VDataTableServer"),Tt=ge()({name:"VDataTableServer",props:At(),emits:{"update:modelValue":t=>!0,"update:page":t=>!0,"update:itemsPerPage":t=>!0,"update:sortBy":t=>!0,"update:options":t=>!0,"update:expanded":t=>!0,"update:groupBy":t=>!0,"click:row":(t,p)=>!0},setup(t,p){let{emit:o,slots:e}=p;const{groupBy:l}=$e(t),{sortBy:n,multiSort:u,mustSort:D}=xe(t),{page:S,itemsPerPage:N}=He(t),T=G(()=>parseInt(t.itemsLength,10)),{columns:r,headers:_}=Ge(t,{groupBy:l,showSelect:H(t,"showSelect"),showExpand:H(t,"showExpand")}),{items:R}=je(t,r),{toggleSort:U}=Je({sortBy:n,multiSort:u,mustSort:D,page:S}),{opened:O,isGroupOpen:y,toggleGroup:Z,extractRows:ee}=Ke({groupBy:l,sortBy:n}),{pageCount:te,setItemsPerPage:ae}=qe({page:S,itemsPerPage:N,itemsLength:T}),{flatItems:b}=ze(R,l,O),{isSelected:ue,select:re,selectAll:le,toggleSelect:de,someSelected:me,allSelected:oe}=We(t,{allItems:R,currentPage:R}),{isExpanded:a,toggleExpand:m}=Qe(t),d=G(()=>ee(R.value));Xe({page:S,itemsPerPage:N,sortBy:n,groupBy:l,search:H(t,"search")}),ke("v-data-table",{toggleSort:U,sortBy:n}),Me({VDataTableRows:{hideNoData:H(t,"hideNoData"),noDataText:H(t,"noDataText"),loading:H(t,"loading"),loadingText:H(t,"loadingText")}});const c=G(()=>({page:S.value,itemsPerPage:N.value,sortBy:n.value,pageCount:te.value,toggleSort:U,setItemsPerPage:ae,someSelected:me.value,allSelected:oe.value,isSelected:ue,select:re,selectAll:le,toggleSelect:de,isExpanded:a,toggleExpand:m,isGroupOpen:y,toggleGroup:Z,items:d.value,groupedItems:b.value,columns:r.value,headers:_.value}));st(()=>{const[C]=Ee.filterProps(t),[V]=Ie.filterProps(t),[F]=De.filterProps(t),[x]=pe.filterProps(t);return i(pe,Ue({class:["v-data-table",{"v-data-table--loading":t.loading},t.class],style:t.style},x),{top:()=>{var B;return(B=e.top)==null?void 0:B.call(e,c.value)},default:()=>{var B,ne,k,L;return e.default?e.default(c.value):i(h,null,[(B=e.colgroup)==null?void 0:B.call(e,c.value),i("thead",{class:"v-data-table__thead",role:"rowgroup"},[i(Ie,Ue(V,{sticky:t.fixedHeader}),e)]),(ne=e.thead)==null?void 0:ne.call(e,c.value),i("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[e.body?e.body(c.value):i(De,Ue(F,{items:b.value}),e)]),(k=e.tbody)==null?void 0:k.call(e,c.value),(L=e.tfoot)==null?void 0:L.call(e,c.value)])},bottom:()=>e.bottom?e.bottom(c.value):i(Ee,C,{prepend:e["footer.prepend"]})})})}}),St=j({__name:"EditAdminLayout",props:Se({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Se(["save"],["update:modelValue"]),setup(t,{emit:p}){const o=be(t,"modelValue"),e=I(ie(t.layout)),l=I([]),n=Re(),u=({callback:T})=>{const r=()=>{T&&T("Failed to Save Layout")},_=()=>{T&&T("Layout Saved")};n.saveAdminLayout(e.value).then(R=>{R?(_(),p("save",R)):r()}).catch(()=>{r()})},D=()=>({ID:0,LayoutPanelUUID:Q(),AdminLayoutID:e.value.ID,AdminLayoutUUID:e.value.AdminLayoutUUID,Name:"",Order:e.value.Panels.length+1,Items:[]}),S=T=>()=>({ID:0,LayoutItemUUID:Q(),LayoutPanelID:T.ID,LayoutPanelUUID:T.LayoutPanelUUID,Label:"",SourceType:X.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:T.Items.length+1}),N=T=>{const r=l.value.find(_=>_.value===T.SectionFieldUUID);r&&(T.SectionFieldID=r.object.ID,T.SectionField=r.object)};return n.getConventionForms(t.layout.ConventionUUID).then(T=>{T.forEach(r=>r.Sections.forEach(_=>_.Fields&&l.value.push(..._.Fields.map(R=>{var O;return{title:`${r.Name} - ${_.Name} - ${(O=R.Field)==null?void 0:O.Name}`,value:R.SectionFieldUUID,object:R}})))),l.value.sort(ot("title"))}),(T,r)=>(s(),g(Pe,{modelValue:o.value,"onUpdate:modelValue":r[3]||(r[3]=_=>o.value=_),onSave:u,title:T.title,color:"primary"},{default:v(()=>[i(ve,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[i(se,null,{default:v(()=>[i(q,{cols:"12",sm:"6"},{default:v(()=>[i(_e,{modelValue:e.value.Name,"onUpdate:modelValue":r[0]||(r[0]=_=>e.value.Name=_),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),i(q,{cols:"12",sm:"6"},{default:v(()=>[i(z,{modelValue:e.value.Type,"onUpdate:modelValue":r[1]||(r[1]=_=>e.value.Type=_),label:"Layout Type",items:W(ct),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),i(fe,{modelValue:e.value.Panels,"onUpdate:modelValue":r[2]||(r[2]=_=>e.value.Panels=_),"new-item":D,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Ae({_:2},[M(e.value.Panels,(_,R)=>({name:`panel_${R}`,fn:v(()=>[i(ve,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[i(se,null,{default:v(()=>[i(q,{cols:"12",sm:"6"},{default:v(()=>[i(_e,{modelValue:_.Name,"onUpdate:modelValue":U=>_.Name=U,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),i(fe,{modelValue:_.Items,"onUpdate:modelValue":U=>_.Items=U,"new-item":S(_),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Ae({_:2},[M(_.Items,(U,O)=>({name:`item_${O}`,fn:v(()=>[i(ve,{class:"px-0 mx-0",fluid:!0},{default:v(()=>[i(se,null,{default:v(()=>[i(q,{cols:"12",sm:"6"},{default:v(()=>[i(_e,{modelValue:U.Label,"onUpdate:modelValue":y=>U.Label=y,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),i(se,null,{default:v(()=>[i(q,{cols:"12",sm:"6"},{default:v(()=>[i(z,{modelValue:U.SourceType,"onUpdate:modelValue":y=>U.SourceType=y,label:"Source Type",items:W(Ut),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),i(q,{cols:"12",sm:"6"},{default:v(()=>[U.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(s(),g(z,{key:0,modelValue:U.SectionFieldUUID,"onUpdate:modelValue":y=>U.SectionFieldUUID=y,label:"Form Data",items:l.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:y=>N(U)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):U.SourceType==="LAYOUT_ITEM_SOURCE_META"?(s(),g(z,{key:1,modelValue:U.MetaField,"onUpdate:modelValue":y=>U.MetaField=y,label:"Miscellaneous Data",items:W(_t),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):U.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(s(),g(z,{key:2,modelValue:U.UserField,"onUpdate:modelValue":y=>U.UserField=y,label:"User Profile Data",items:W(vt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Et={key:0,class:"accommodationList"},It=j({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},value:{default:""}},setup(t){const p=G(()=>{if(!t.value)return[];const o=JSON.parse(t.value),e=t.accommodations.filter(l=>o.includes(l.AccommodationUUID)).sort((l,n)=>{const u=o.findIndex(S=>S===l.AccommodationUUID),D=o.findIndex(S=>S===n.AccommodationUUID);return u>D?1:-1});return ie(e)});return(o,e)=>o.value?(s(),A("ol",Et,[(s(!0),A(h,null,M(p.value,l=>(s(),A("li",{key:l.AccommodationUUID},w(l.Name),1))),128))])):P("",!0)}});const Dt=Oe(It,[["__scopeId","data-v-1ba5f67a"]]),ft={key:0,class:"addonList"},pt={key:0},Rt=j({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(t){const p=G(()=>{if(!t.value)return;const o=JSON.parse(t.value),e=Object.keys(o),l=ie(t.extras);return l.forEach(n=>{n.Options=n.Options.filter(u=>e.includes(u.OptionUUID)?(u.Choices=u.Choices.filter(D=>D.TagUUID===o[u.OptionUUID].choiceId),o[u.OptionUUID].checked):!1)}),l.filter(n=>n.Options.length>0),l});return(o,e)=>o.value?(s(),A("ul",ft,[(s(!0),A(h,null,M(p.value,l=>(s(),A("li",{key:l.ExtraUUID},[Y("strong",null,w(l.Name),1),Y("ul",null,[(s(!0),A(h,null,M(l.Options,n=>(s(),A("li",{key:n.OptionUUID},[$(w(n.Name)+" ",1),n.Choices.length==1?(s(),A("small",pt,"("+w(n.Choices[0].Title)+")",1)):P("",!0)]))),128))])]))),128))])):P("",!0)}});const Ot=Oe(Rt,[["__scopeId","data-v-4ed6842b"]]),yt={key:0},Ct=j({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(t){const p=G(()=>{if(!t.value)return;const o=JSON.parse(t.value);return Object.entries(o).filter(([,e])=>e).map(([e,l])=>t.interests.find(n=>n.InterestUUID===e)).filter(e=>e!==void 0)});return(o,e)=>o.value?(s(),A("ul",yt,[(s(!0),A(h,null,M(p.value,l=>(s(),A("li",{key:l.InterestUUID},w(l.Name),1))),128))])):P("",!0)}}),Lt=Y("br",null,null,-1),ht=Y("small",null,"Options:",-1),gt=Y("br",null,null,-1),kt=Y("small",null,"Addons:",-1),Mt=j({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(t){const p=G(()=>{if(!t.value)return;let o={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{o=JSON.parse(t.value),"ticket"in o&&(o.Ticket=o.ticket),"addonsChecked"in o&&(o.AddonsChecked=o.addonsChecked),"componentsChecked"in o&&(o.ComponentsChecked=o.componentsChecked)}catch{}return o.Ticket.filter(e=>{const l=t.tickets.find(n=>n.TicketUUID===e);return!(!l||l.Type!==nt.TICKET_TYPE_TICKET)}).map(e=>{const l=t.tickets.find(u=>u.TicketUUID===e),n=ie(l);return n.TicketComponents=l.TicketComponents.filter(u=>o.ComponentsChecked.includes(u.TicketUUID)),n.AddonTickets=l.AddonTickets.filter(u=>o.AddonsChecked.includes(u.TicketUUID)),n})});return(o,e)=>o.value?(s(!0),A(h,{key:0},M(p.value,l=>(s(),A("div",{key:l.TicketUUID},[Y("strong",null,w(l.Name),1),l.TicketComponents.length>0?(s(),A(h,{key:0},[Lt,ht,$("  "),(s(!0),A(h,null,M(l.TicketComponents,n=>(s(),A(h,{key:n.TicketUUID},[Y("small",null,w(n.Name),1),$("  ")],64))),128))],64)):P("",!0),l.AddonTickets.length>0?(s(),A(h,{key:1},[gt,kt,$("  "),(s(!0),A(h,null,M(l.AddonTickets,n=>(s(),A("small",{key:n.TicketUUID},[$("("),Y("em",null,w(n.Name),1),$(")")]))),128))],64)):P("",!0)]))),128)):P("",!0)}}),bt=["innerHTML"],Vt=j({__name:"RegListRow",props:{header:{},accommodations:{},extras:{},item:{},interests:{},tickets:{},venues:{}},setup(t){const p=e=>{console.log(e)},o=e=>e.map(l=>`<strong>${l.Heading}:</strong> ${it(l.Status)}<br/>`).join("");return(e,l)=>e.header.key=="actions"?(s(),g(ye,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:l[0]||(l[0]=n=>p(e.item.raw))})):e.header.type==="ACCOMMODATION"&&e.accommodations.length>0?(s(),g(Dt,{key:1,value:e.item.raw[e.header.key],accommodations:e.accommodations},null,8,["value","accommodations"])):e.header.type==="EXTRAS"&&e.extras.length>0?(s(),g(Ot,{key:2,value:e.item.raw[e.header.key],extras:e.extras},null,8,["value","extras"])):e.header.type==="INTERESTS"&&e.interests.length>0?(s(),g(Ct,{key:3,value:e.item.raw[e.header.key],interests:e.interests},null,8,["value","interests"])):e.header.type==="TICKET"&&e.tickets.length>0?(s(),g(Mt,{key:4,value:e.item.raw[e.header.key],tickets:e.tickets},null,8,["value","tickets"])):e.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"?(s(),A("div",{key:5,innerHTML:`${o(e.item.raw[e.header.key])}`},null,8,bt)):(s(),A(h,{key:6},[$(w(e.item.raw[e.header.key]),1)],64))}}),la=j({__name:"RegistrationsView",emits:["pageTitle"],setup(t,{emit:p}){var oe;p("pageTitle","Registration Manager");const o=Ve(),e=Ne(),l=I(!0);let n=((oe=o.params.convention)==null?void 0:oe.toString())||"";const u=I({ID:0,ConventionUUID:Q(),OrganisationID:0,OrganisationUUID:ut,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),D=Re(),S=I({ID:0,AdminLayoutUUID:Q(),ConventionID:u.value.ID,ConventionUUID:u.value.ConventionUUID,Name:"Registration Table",Type:Ce.ADMIN_LAYOUT_TABLE,Panels:[]}),N=I([]),T=I([]),r=I([]),_=I(10),R=I(0),U=I(!1),O=I(""),y=I([]),Z=I([]),ee=I([]),te=I([]),ae=I([]),b=I(0);Fe(b,a=>{a===7&&le()});const ue=()=>{N.value=[],T.value=[],r.value=[];try{D.getConventionAdminLayoutByName(u.value.ConventionUUID,"Registration Table").then(a=>{b.value+=1,a?S.value=a:(S.value.ConventionID=u.value.ID,S.value.ConventionUUID=u.value.ConventionUUID)})}catch{S.value.ConventionID=u.value.ID,S.value.ConventionUUID=u.value.ConventionUUID}try{D.getConventionForms(u.value.ConventionUUID).then(a=>{b.value+=1,a&&(N.value=a)})}catch{}try{D.getConventionAccommodation(u.value.ConventionUUID).then(a=>{b.value+=1,a&&(y.value=a)})}catch{}try{D.getConventionVenues(u.value.ConventionUUID).then(a=>{b.value+=1,a&&(ae.value=a)})}catch{}try{D.getConventionExtras(u.value.ConventionUUID).then(a=>{b.value+=1,a&&(Z.value=a)})}catch{}try{D.getConventionInterests(u.value.ConventionUUID).then(a=>{b.value+=1,a&&(ee.value=a)})}catch{}try{D.getConventionTickets(u.value.ConventionUUID).then(a=>{b.value+=1,a&&(te.value=a)})}catch{}},re=({page:a,itemsPerPage:m,sortBy:d})=>{const c=r.value.find(F=>F.uuid==O.value),C=c==null?void 0:c.layout.Items;let V="";if(d&&C&&d.length>=1){const F=C.find(x=>x.LayoutItemUUID==d[0].key);switch(F==null?void 0:F.UserField){case f.USER_DATA_SOURCE_DISPLAY_NAME:V="user.display_name";break;case f.USER_DATA_SOURCE_HANDLE:V="user.handle";break;case f.USER_DATA_SOURCE_EMAIL:V="user.email";break}}try{const F={Offset:(a-1)*m,Order:V,Limit:m};D.searchConventionRegistrations(u.value.ConventionUUID,F).then(x=>{x&&(R.value=x.Total,T.value=x.Registrations,r.value.forEach(B=>{const ne=B.layout;B.items=T.value.map(k=>{const L={};return B.headers.forEach(Le=>{const E=ne.Items.find(J=>J.LayoutItemUUID===Le.key);if(E){if(E.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&E.SectionField)k.Submissions.forEach(J=>{const K=J.Data.find(ce=>ce.SectionFieldUUID===E.SectionFieldUUID);if(K){L[E.LayoutItemUUID]=K.Data;return}});else if(E.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&E.UserField)switch(E.UserField){case f.USER_DATA_SOURCE_DISPLAY_NAME:L[E.LayoutItemUUID]=k.User.DisplayName;break;case f.USER_DATA_SOURCE_EMAIL:L[E.LayoutItemUUID]=k.User.Additional.Email;break;case f.USER_DATA_SOURCE_HANDLE:L[E.LayoutItemUUID]=k.User.Handle;break;case f.USER_DATA_SOURCE_DATE_OF_BIRTH:L[E.LayoutItemUUID]=k.User.Additional.DOB;break;case f.USER_DATA_SOURCE_FIRST_NAME:L[E.LayoutItemUUID]=k.User.Additional.FirstName;break;case f.USER_DATA_SOURCE_LAST_NAME:L[E.LayoutItemUUID]=k.User.Additional.LastName;break;case f.USER_DATA_SOURCE_TELEGRAM:L[E.LayoutItemUUID]="";break}else if(E.SourceType==="LAYOUT_ITEM_SOURCE_META"&&E.MetaField)switch(E.MetaField){case Te.META_DATA_SOURCE_SUBMISSION_DATE:L[E.LayoutItemUUID]=new Date(k.CreatedAt).toLocaleString();break;case Te.META_DATA_SOURCE_SUBMISSION_STATUS:L[E.LayoutItemUUID]=k.Submissions.map(J=>{const K=N.value.find(ce=>ce.FormUUID===J.FormUUID);return{Heading:K==null?void 0:K.Heading,Status:J.Status}});break}}}),L})}),l.value=!1)})}catch{}},le=()=>{S.value.Panels.forEach(a=>{a.Items.forEach(m=>{(m.SectionField==null||m.SectionField.Field==null)&&N.value.find(d=>{d.Sections.find(c=>{if(c.Fields){const C=c.Fields.find(V=>V.SectionFieldUUID===m.SectionFieldUUID);if(C)return m.SectionField=C,!0}})})})}),S.value.Panels.length>0&&(r.value=[],S.value.Panels.forEach(a=>{const m={uuid:Q(),order:a.Order,name:a.Name,headers:[],items:[],layout:a},d={key:"actions",title:"Actions",align:"start",sortable:!1,type:""};a.Items.sort((c,C)=>c.Order>C.Order?1:c.Order==C.Order?0:-1),m.headers=a.Items.map(c=>{var C,V;return{key:c.LayoutItemUUID,title:c.Label||((V=(C=c.SectionField)==null?void 0:C.Field)==null?void 0:V.Label)||"",align:c.Align==="end"?"end":"start",sortable:me(c),type:de(c)}}),m.headers.push(d),r.value.push(m)})),(O.value==null||O.value=="")&&r.value.length>0&&(O.value=r.value[0].uuid)};n?D.getConvention(n).then(a=>{a&&(u.value=a,ue())}).catch(()=>{e.push("/")}):e.push("/");const de=a=>{var m,d;if(a.SourceType===X.LAYOUT_ITEM_SOURCE_META)return`${a.SourceType}.${a.MetaField}`;if(a.SourceType===X.LAYOUT_ITEM_SOURCE_FORM)return(d=(m=a.SectionField)==null?void 0:m.Field)==null?void 0:d.Type;if(a.SourceType===X.LAYOUT_ITEM_SOURCE_USER)return`${a.SourceType}.${a.UserField}`},me=a=>[f.USER_DATA_SOURCE_DISPLAY_NAME,f.USER_DATA_SOURCE_EMAIL,f.USER_DATA_SOURCE_HANDLE,f.USER_DATA_SOURCE_DATE_OF_BIRTH,f.USER_DATA_SOURCE_FIRST_NAME,f.USER_DATA_SOURCE_LAST_NAME].includes(a.UserField);return(a,m)=>(s(),g(lt,null,{default:v(()=>[i(rt,{color:"blue-darken-4"},{default:v(()=>[i(Ze,{modelValue:O.value,"onUpdate:modelValue":m[0]||(m[0]=d=>O.value=d),"show-arrows":""},{default:v(()=>[(s(!0),A(h,null,M(r.value,d=>(s(),g(et,{key:d.uuid,value:d.uuid},{default:v(()=>[$(w(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(dt),i(ye,{icon:"mdi:mdi-cog-outline",onClick:m[1]||(m[1]=d=>U.value=!0)})]),_:1}),i(at,{modelValue:O.value,"onUpdate:modelValue":m[3]||(m[3]=d=>O.value=d)},{default:v(()=>[(s(!0),A(h,null,M(r.value,d=>(s(),g(tt,{key:d.uuid,value:d.uuid},{default:v(()=>[d.uuid===O.value?(s(),g(mt,{key:0,class:"pa-2"},{default:v(()=>[i(W(Tt),{"items-per-page":_.value,"onUpdate:itemsPerPage":m[2]||(m[2]=c=>_.value=c),headers:d.headers,"items-length":R.value,items:d.items,"item-value":"LayoutItemUUID",loading:l.value,"onUpdate:options":re},Ae({_:2},[M(d.headers,c=>({name:`item.${c.key}`,fn:v(({item:C})=>[i(Vt,{header:c,item:C,accommodations:y.value,extras:Z.value,interests:ee.value,tickets:te.value,venues:ae.value},null,8,["header","item","accommodations","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","headers","items-length","items","loading"])]),_:2},1024)):P("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),U.value?(s(),g(St,{key:0,title:"Edit Layout",modelValue:U.value,"onUpdate:modelValue":m[4]||(m[4]=d=>U.value=d),layout:S.value,onSave:m[5]||(m[5]=d=>{U.value=!1,le()})},null,8,["modelValue","layout"])):P("",!0)]),_:1}))}});export{la as default};
