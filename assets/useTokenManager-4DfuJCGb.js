var ct=Object.defineProperty;var mt=(e,o,t)=>o in e?ct(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var Z=(e,o,t)=>(mt(e,typeof o!="symbol"?o+"":o,t),t);import{i as G,M as Y,N as J,r as g,k as ee,w as ne,c as j,n,q as S,v as l,y as C,D as w,F as N,x as D,B as T,Q as x,f as s,C as U,A as L,P as te,G as vt,H as ft,_ as ke,U as At,ai as Tt,a0 as Te,O as Me,aj as Et,X as ye,o as _t,b as Ut,ak as gt,al as St,am as xe,z as Ct,a6 as Dt,a3 as yt,E as It,an as Ye,ao as pt,T as Rt}from"./index-ueWa9fY2.js";import{u as Ve}from"./useModel-VCQPTgOc.js";import{_ as Ee}from"./ModelDialog.vue_vue_type_script_setup_true_lang-wM85SNZe.js";import{h as ie,b as Ie,a as ht,c as Nt,d as Ke,P as je,u as Ot}from"./useDisplayTransactions-gNpHGWYJ.js";import{a as se,V as ue}from"./VContainer-7bP-n_go.js";import{V as K,a as P}from"./VRow-gI5NkL7C.js";import{V as fe,a as Ae,c as Ne,d as kt}from"./VList-unIAQIij.js";import{V as Ue}from"./VSelect-7SmNbcSM.js";import{G as Se}from"./userData-ugm4DX5j.js";import{C as pe}from"./canEditRegistrations-PHKxD3Wu.js";import{V as $,a as tt}from"./VBtn-0EIFTArv.js";import{T as Mt,V as at}from"./VAutocomplete-joEZePlf.js";import{u as Le,V as _e}from"./VSpacer-3WWN8GoN.js";import{a as Vt,_ as Je,V as nt}from"./SaveButton.vue_vue_type_script_setup_true_lang-UtBavbX4.js";import{G as Lt}from"./group-7fhbY6WJ.js";import{C as bt}from"./canDo-8w-iwWYc.js";import{V as be,a as Re,c as we,d as ot,e as Pe}from"./VCard-7bgZhcUU.js";import{V as lt}from"./VAvatar-omnRSJ8i.js";import{V as re}from"./VTextField-gsp785fL.js";import{F as Ce}from"./form-0fJbSFPv.js";import{b as wt,c as Pt,S as Ft}from"./submission-40fey8Hx.js";import{v as ge}from"./v4-yQnnJER4.js";import{b as Fe,c as $e,d as Be,a as Ge,V as He}from"./VDataTable-k6mBKRlB.js";import{_ as $t}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-VLS5oLzv.js";import{_ as Bt}from"./SelectGroups.vue_vue_type_script_setup_true_lang-GK9M64en.js";import{a as Gt,V as Ht}from"./VToolbar-_ntA9rD9.js";import{V as xt}from"./VDivider-y_A7AG_O.js";import{V as it}from"./VTextarea-d40yTLhc.js";import{V as qe}from"./VDialog-BY2GzUhj.js";import{V as Yt,a as Oe}from"./VChip-C02bF6B9.js";import{V as Kt}from"./VForm-9ttllz_T.js";import{u as jt}from"./nil-rxyd0N8M.js";import{b as Jt,V as qt}from"./VNavigationDrawer-pftcCYmy.js";var zt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(zt||{});const ho=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var De=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(De||{});const No=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var q=(e=>(e.META_DATA_SOURCE_NULL="",e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_ADMIN_FORM="META_DATA_SOURCE_ADMIN_FORM",e.META_DATA_SOURCE_BADGE_DISPLAY="META_DATA_SOURCE_BADGE_DISPLAY",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_CHECKIN_CONTROL="META_DATA_SOURCE_CHECKIN_CONTROL",e.META_DATA_SOURCE_CHECKIN_STATUS="META_DATA_SOURCE_CHECKIN_STATUS",e.META_DATA_SOURCE_DATA_LAYOUT="META_DATA_SOURCE_DATA_LAYOUT",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_EMAILS="META_DATA_SOURCE_EMAILS",e.META_DATA_SOURCE_NOTES="META_DATA_SOURCE_NOTES",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_PAYMENTS="META_DATA_SOURCE_PAYMENTS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_REGISTRATION_TOOLS_DROP="META_DATA_SOURCE_REGISTRATION_TOOLS_DROP",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e.META_DATA_SOURCE_TAGS="META_DATA_SOURCE_TAGS",e))(q||{});const Oo=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Actions Dropdown",value:"META_DATA_SOURCE_REGISTRATION_TOOLS_DROP"},{title:"Badge Display",value:"META_DATA_SOURCE_BADGE_DISPLAY"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Check In Control",value:"META_DATA_SOURCE_CHECKIN_CONTROL"},{title:"Check In Status",value:"META_DATA_SOURCE_CHECKIN_STATUS"},{title:"Data Display",value:"META_DATA_SOURCE_DATA_LAYOUT"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Emails",value:"META_DATA_SOURCE_EMAILS"},{title:"Notes",value:"META_DATA_SOURCE_NOTES"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Payments",value:"META_DATA_SOURCE_PAYMENTS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"},{title:"Tags",value:"META_DATA_SOURCE_TAGS"}];var oe=(e=>(e.PANEL_STYLE_FLEX="PANEL_STYLE_FLEX",e.PANEL_STYLE_NAV_BOTTOM="PANEL_STYLE_NAV_BOTTOM",e.PANEL_STYLE_NAV_LEFT="PANEL_STYLE_NAV_LEFT",e.PANEL_STYLE_NAV_RIGHT="PANEL_STYLE_NAV_RIGHT",e.PANEL_STYLE_NAV_TOP="PANEL_STYLE_NAV_TOP",e))(oe||{});const ko=[{title:"Body Flexible",value:"PANEL_STYLE_FLEX"},{title:"Fixed Bottom",value:"PANEL_STYLE_NAV_BOTTOM"},{title:"Fixed Left",value:"PANEL_STYLE_NAV_LEFT"},{title:"Fixed Right",value:"PANEL_STYLE_NAV_RIGHT"},{title:"Fixed Top",value:"PANEL_STYLE_NAV_TOP"}];var ve=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_CONTACTS="USER_DATA_SOURCE_CONTACTS",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(ve||{});const Mo=[{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"Contact Details",value:"USER_DATA_SOURCE_CONTACTS"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}];var X=(e=>(e.CHECK_IN_STATUS_PENDING="CHECK_IN_STATUS_PENDING",e.CHECK_IN_STATUS_COMPLETED="CHECK_IN_STATUS_COMPLETED",e.CHECK_IN_STATUS_REJECTED="CHECK_IN_STATUS_REJECTED",e.CHECK_IN_STATUS_REVOKED="CHECK_IN_STATUS_REVOKED",e))(X||{});const Qt=[{title:"Pending",value:"CHECK_IN_STATUS_PENDING"},{title:"Completed",value:"CHECK_IN_STATUS_COMPLETED"},{title:"Rejected",value:"CHECK_IN_STATUS_REJECTED"},{title:"Revoked",value:"CHECK_IN_STATUS_REVOKED"}],ce=e=>{var o;return((o=Qt.find(t=>t.value===e))==null?void 0:o.title)||""},Xt=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},Vo=e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`,Wt=w("br",null,null,-1),Zt=w("h3",null,"Assigned Accommodation",-1),ea=w("br",null,null,-1),ta=w("br",null,null,-1),aa=w("h3",null,"Accommodation Preferences",-1),na=w("h3",null,"Selected Tickets",-1),oa=w("br",null,null,-1),la=G({__name:"EditAccommodationAssignmentDialog",props:Y({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Y(["update:field"],["update:modelValue"]),setup(e,{emit:o}){const t=e,{convention:a,registration:i,title:c=""}=t,E=o,r=te(),u=J(e,"modelValue"),m=g({capacity:{max:b=>{var I;const V=R.value.find(B=>B.room.RoomUUID===b);return!V||V.room.MaximumCapacity===0?!0:(((I=d.value)==null?void 0:I.Members.length)||0)<=V.room.MaximumCapacity||"Too many people in the group for this room"},min:b=>{var I;const V=R.value.find(B=>B.room.RoomUUID===b);return!V||V.room.MinimumCapacity===0?!0:(((I=d.value)==null?void 0:I.Members.length)||0)>=V.room.MinimumCapacity||"Not enough people in the group for this room"}}}),A=g([]),f=Ve(t,E,void 0,void 0,"field"),v=g(ee(f.value));ne(f,()=>{v.value=ee(f.value)});const d=g(),_=g(""),y=g(""),k=g([]),M=g({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),O=async()=>{var I;const b=await r.getConventionAvailableAccommodation(a.ConventionUUID);b&&(A.value=b);const V=await r.getRegistrationGroup(i.RegistrationUUID||"");V&&(d.value=V);const h=await r.getConventionTickets(a.ConventionUUID);h&&(k.value=h);try{M.value=JSON.parse(((I=d.value)==null?void 0:I.TicketData)||"")}catch{}};ne(_,()=>{y.value=R.value.length>0?R.value[0].value:""});const p=j(()=>{const b=H.value;return A.value.map(V=>{let h;return b.forEach(I=>{V.Costs.forEach(B=>{B.DateStart===(I==null?void 0:I.DateStart)&&B.DateEnd===I.DateEnd&&(h===void 0||h>B.Availability)&&(h=B.Availability)})}),{label:`${V.Name}`,title:`${V.Name} (${h} Available)`,value:V.AccommodationUUID}})}),R=j(()=>{const b=H.value,V=A.value.find(h=>h.AccommodationUUID===_.value);return(V==null?void 0:V.Pool.map(h=>{var B,W;let I;return b.forEach(ae=>{h.Costs.forEach(de=>{de.DateStart===(ae==null?void 0:ae.DateStart)&&de.DateEnd===ae.DateEnd&&(I===void 0||I>de.Availability)&&(I=de.Availability)})}),{label:`${(B=h.Venue)==null?void 0:B.Name} - ${h.Name}`,title:`${(W=h.Venue)==null?void 0:W.Name} - ${h.Name} (${I} Available)`,value:h.RoomUUID,room:h}}))||[]}),H=j(()=>[...M.value.Ticket,...M.value.AddonsChecked,...M.value.ComponentsChecked].map(b=>k.value.find(V=>V.TicketUUID===b)).filter(b=>b!==void 0&&b.RequiresAccommodation)),F=b=>{var V;r.assignAccommodation(((V=d.value)==null?void 0:V.Registration.RegistrationUUID)||"",_.value,y.value,!1).then(h=>{h?(O(),b&&b("Room Assigned")):b&&b("Room not assigned")}).catch(()=>{b&&b("Room not assigned")})},z=b=>{var V,h;(V=d.value)!=null&&V.Registration.AllocationUUID?r.deleteAllocation(((h=d.value)==null?void 0:h.Registration.AllocationUUID)||"").then(I=>{I?(O(),b&&b("Allocation Deleted")):b&&b("Allocation not deleted")}).catch(()=>{b&&b("Allocation not deleted")}):b&&b("Nothing to Delete")},Q=b=>{var h,I;const V=(h=A.value.find(B=>B.AccommodationUUID===b.AccommodationUUID))==null?void 0:h.Pool;if(V){const B=V.find(W=>W.RoomUUID===b.RoomUUID);if(B)return`${(I=B.Venue)==null?void 0:I.Name} - ${B.Name}`}return""};return O(),(b,V)=>{var h;return n(),S(Ee,{modelValue:u.value,"onUpdate:modelValue":V[2]||(V[2]=I=>u.value=I),title:U(c),color:"primary","show-close-action":!0,"show-delete-action":!!((h=d.value)!=null&&h.Registration.Allocation),"show-save-action":!!y.value,"save-button-label":"Assign Room",onDelete:z,onSave:F,fullscreen:!0,persistent:!0},{default:l(()=>[s(se,{class:"pa-0",fluid:!0},{default:l(()=>[s(K,null,{default:l(()=>{var I;return[s(P,{cols:"12",md:"6"},{default:l(()=>{var B,W;return[w("h3",null,"Group Members ("+C((B=d.value)==null?void 0:B.Members.length)+")",1),(n(!0),T(N,null,x((W=d.value)==null?void 0:W.Members,ae=>(n(),T(N,{key:ae.UUID},[D(" #"+C(ae.Reference)+" "+C(ae.Name),1),Wt],64))),128))]}),_:1}),(I=d.value)!=null&&I.Registration.Allocation?(n(),S(P,{key:0,cols:"12",md:"6"},{default:l(()=>[Zt,s(fe,null,{default:l(()=>{var B;return[(n(!0),T(N,null,x((B=d.value)==null?void 0:B.Registration.Allocation.Periods,W=>(n(),S(Ae,{key:W.AllocationPeriodUUID},{default:l(()=>{var ae;return[D(C((ae=A.value.find(de=>de.AccommodationUUID===W.AccommodationUUID))==null?void 0:ae.Name)+" ",1),ea,D(" "+C(Q(W))+" ",1),ta,w("small",null,"("+C(U(ie)(W.DateStart))+" - "+C(U(ie)(W.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):L("",!0)]}),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12",md:"6"},{default:l(()=>[b.selectedAccommodation.length?(n(),T(N,{key:0},[aa,s(fe,null,{default:l(()=>[(n(!0),T(N,null,x(b.selectedAccommodation,(I,B)=>(n(),S(Ae,{key:I.AccommodationUUID},{default:l(()=>[D(C(B+1)+". "+C(I.Name),1)]),_:2},1024))),128))]),_:1})],64)):L("",!0)]),_:1}),s(P,{cosl:"12",md:"6"},{default:l(()=>[na,s(fe,null,{default:l(()=>[(n(!0),T(N,null,x(H.value,I=>(n(),S(Ae,{key:I==null?void 0:I.TicketUUID},{default:l(()=>[D(C(I.Name)+" ",1),oa,w("small",null,"("+C(U(ie)(I.DateStart))+" - "+C(U(ie)(I.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12",md:"6"},{default:l(()=>[s(Ue,{modelValue:_.value,"onUpdate:modelValue":V[0]||(V[0]=I=>_.value=I),items:p.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),s(P,{cols:"12",md:"6"},{default:l(()=>[s(Ue,{modelValue:y.value,"onUpdate:modelValue":V[1]||(V[1]=I=>y.value=I),items:R.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[m.value.capacity.min,m.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),ia=e=>(vt("data-v-33548a38"),e=e(),ft(),e),sa={key:0,class:"accommodationList"},ra={key:0,class:"text-orange-darken-2"},ua={key:1,class:"accommodationList"},da=ia(()=>w("br",null,null,-1)),ca=G({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const o=Se(),t=pe(o,e.convention),a=g(!1),i=j(()=>e.registration.Allocation.Periods.map(r=>{var u;return{DateStart:r.DateStart,DateEnd:r.DateEnd,Accommodation:r.Accommodation||((u=e.accommodations)==null?void 0:u.find(m=>m.AccommodationUUID==r.AccommodationUUID))}}).sort((r,u)=>r.DateStart>u.DateStart?1:r.DateStart==u.DateStart?0:-1));e.registration&&e.registration.Allocation&&e.registration.Allocation.Periods&&e.registration.Allocation.Periods.forEach(r=>{var m;if(r.Accommodation)return;const u=(m=e.accommodations)==null?void 0:m.find(A=>A.AccommodationUUID==r.AccommodationUUID);u&&(r.Accommodation=u)});const c=j(()=>{if(!e.value)return[];const r=JSON.parse(e.value),u=e.accommodations.filter(m=>r.includes(m.AccommodationUUID)).sort((m,A)=>{const f=r.findIndex(d=>d===m.AccommodationUUID),v=r.findIndex(d=>d===A.AccommodationUUID);return f>v?1:-1});return ee(u)}),E=j(()=>{let r;const u=e.forms.find(m=>!!m.Sections.find(A=>{var f;return A.Fields?!!((f=A.Fields)!=null&&f.find(v=>{var d;return((d=v.Field)==null?void 0:d.Type)==="TICKET"?(r=v,!0):!1})):!1}));return r?!!e.registration.Submissions.find(m=>{if(m.FormUUID==(u==null?void 0:u.FormUUID))return!!m.Data.find(A=>{if(A.SectionFieldUUID==(r==null?void 0:r.SectionFieldUUID)){const f=JSON.parse(A.Data);return e.tickets.filter(v=>v.RequiresAccommodation).find(v=>f.Ticket.includes(v.TicketUUID)||f.AddonsChecked.includes(v.TicketUUID)||f.ComponentsChecked.includes(v.TicketUUID))}})}):!1});return(r,u)=>E.value?(n(),T(N,{key:0},[r.value?(n(),T("ol",sa,[(n(!0),T(N,null,x(c.value,m=>(n(),T("li",{key:m.AccommodationUUID},[r.registration&&r.registration.Allocation&&r.registration.Allocation.Periods.find(A=>A.AccommodationUUID===m.AccommodationUUID)?(n(),T("strong",ra,C(m.Name),1)):(n(),T(N,{key:1},[D(C(m.Name),1)],64))]))),128))])):(n(),T("ul",ua,[(n(!0),T(N,null,x(i.value,m=>{var A;return n(),T("li",{key:m.DateStart},[D(C((A=m.Accommodation)==null?void 0:A.Name)+" ("+C(U(ie)(m.DateStart))+" - "+C(U(ie)(m.DateEnd))+")",1),da])}),128))])),U(t)?(n(),S($,{key:2,onClick:u[0]||(u[0]=m=>a.value=!0),variant:"flat",color:"success"},{default:l(()=>[D("Assign Accommodation")]),_:1})):L("",!0),r.convention&&a.value?(n(),S(la,{key:3,modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m),title:"Accommodation Allocation",convention:r.convention,registration:r.registration,tickets:r.tickets,"selected-accommodation":c.value},null,8,["modelValue","convention","registration","tickets","selected-accommodation"])):L("",!0)],64)):L("",!0)}}),ma=ke(ca,[["__scopeId","data-v-33548a38"]]),va={key:0,class:"addonList"},fa={key:0},Aa={key:0},Ta=G({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const o=j(()=>{if(!e.value)return;const t=JSON.parse(e.value),a=Object.keys(t),i=ee(e.extras);return i.forEach(c=>{c.Options=c.Options.filter(E=>a.includes(E.OptionUUID)?(E.Choices=E.Choices.filter(r=>r.TagUUID===t[E.OptionUUID].choiceId),t[E.OptionUUID].checked):!1)}),i.filter(c=>c.Options.length>0),i});return(t,a)=>t.value?(n(),T("ul",va,[(n(!0),T(N,null,x(o.value,i=>(n(),T(N,{key:i.ExtraUUID},[i.Options.length?(n(),T("li",fa,[w("strong",null,C(i.Name),1),w("ul",null,[(n(!0),T(N,null,x(i.Options,c=>(n(),T("li",{key:c.OptionUUID},[D(C(c.Name)+" ",1),c.Choices.length==1?(n(),T("small",Aa,"("+C(c.Choices[0].Title)+")",1)):L("",!0)]))),128))])])):L("",!0)],64))),128))])):L("",!0)}}),Ea=ke(Ta,[["__scopeId","data-v-55786e01"]]),_a={key:0},Ua=G({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const o=j(()=>{if(!e.value)return;const t=JSON.parse(e.value);return Object.entries(t).filter(([,a])=>a).map(([a,i])=>e.interests.find(c=>c.InterestUUID===a)).filter(a=>a!==void 0)});return(t,a)=>t.value?(n(),T("ul",_a,[(n(!0),T(N,null,x(o.value,i=>(n(),T("li",{key:i.InterestUUID},C(i.Name),1))),128))])):L("",!0)}}),ga=w("br",null,null,-1),Sa=w("small",null,"Options:",-1),Ca=w("br",null,null,-1),Da=w("small",null,"Addons:",-1),ya=G({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const o=j(()=>{if(!e.value)return;let t={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{t=JSON.parse(e.value),"ticket"in t&&(t.Ticket=t.ticket),"addonsChecked"in t&&(t.AddonsChecked=t.addonsChecked),"componentsChecked"in t&&(t.ComponentsChecked=t.componentsChecked)}catch{}return t.Ticket.filter(a=>{const i=e.tickets.find(c=>c.TicketUUID===a);return!(!i||i.Type!==Mt.TICKET_TYPE_TICKET)}).map(a=>{const i=e.tickets.find(E=>E.TicketUUID===a),c=ee(i);return c.TicketComponents=i.TicketComponents.filter(E=>t.ComponentsChecked.includes(E.TicketUUID)),c.AddonTickets=i.AddonTickets.filter(E=>t.AddonsChecked.includes(E.TicketUUID)),c})});return(t,a)=>t.value?(n(!0),T(N,{key:0},x(o.value,i=>(n(),T("div",{key:i.TicketUUID},[w("strong",null,C(i.Name),1),i.TicketComponents.length>0?(n(),T(N,{key:0},[ga,Sa,D("  "),(n(!0),T(N,null,x(i.TicketComponents,c=>(n(),T(N,{key:c.TicketUUID},[w("small",null,C(c.Name),1),D("  ")],64))),128))],64)):L("",!0),i.AddonTickets.length>0?(n(),T(N,{key:1},[Ca,Da,D("  "),(n(!0),T(N,null,x(i.AddonTickets,c=>(n(),T("small",{key:c.TicketUUID},[D("("),w("em",null,C(c.Name),1),D(")")]))),128))],64)):L("",!0)]))),128)):L("",!0)}}),st=G({__name:"DataPanelAccommodation",props:Y({accommodations:{},convention:{},data:{},forms:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){return J(e,"modelValue"),(o,t)=>(n(),T("div",null,[s(ma,{value:o.data,accommodations:o.accommodations,convention:o.convention,forms:o.forms,registration:o.registration,tickets:o.tickets,venues:o.venues},null,8,["value","accommodations","convention","forms","registration","tickets","venues"])]))}}),Ia={key:0,class:"text-red-darken-4 font-weight-bold"},pa={key:1,class:"text-orange-darken-2 font-weight-bold"},Ra=G({__name:"DataPanelAge",props:Y({data:{},forms:{},registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=J(e,"modelValue"),t=new Date,a=t.getFullYear(),i=(t.getMonth()+1).toLocaleString("en-US",{minimumIntegerDigits:2}),c=t.getDate().toLocaleString("en-US",{minimumIntegerDigits:2}),E=g(!1),r=g(`${a}-${i}-${c}`),u=g(18);e.forms.find(v=>v.Sections.find(d=>d.Fields?d.Fields.find(_=>{var y;return _.SectionFieldUUID===o.value.SectionFieldUUID?(o.value.SectionField=_,(y=_.Field)==null||y.Values.forEach(k=>{switch(k.Title){case"UNDER_AGE_APPLY_TAG":k.Value.length>0&&(E.value=!0);break;case"BEFORE_DATE":r.value=k.Value;break;case"MIN_AGE":u.value=parseInt(k.Value);break}}),!0):!1}):!1));const m=v=>({registration:A(v,e.registration.CreatedAt||"",u.value),convention:A(v,r.value,u.value)}),A=(v,d,_)=>{if(v>=d)return!1;const y=f(v),M=f(d).getTime()-y.getTime(),O=1e3*60*60*24*365.25;return M/O>=_},f=v=>{const[d,_,y]=v.split("-");return new Date(parseInt(d),parseInt(_)-1,parseInt(y))};return(v,d)=>(n(),T("div",null,[w("p",null,[D(C(U(ie)(v.data,{withDay:!1,withYear:!0}))+" ",1),E.value&&m(v.data).convention&&m(v.data).registration?(n(),S(ue,{key:0,icon:"mdi:mdi-check",color:"success"})):E.value&&!m(v.data).convention?(n(),S(ue,{key:1,icon:"mdi:mdi-alert",color:"error"})):E.value&&m(v.data).convention&&!m(v.data).registration?(n(),S(ue,{key:2,icon:"mdi:mdi-alert",color:"warning"})):L("",!0)]),E.value?(n(),T(N,{key:0},[m(v.data).convention?m(v.data).registration?L("",!0):(n(),T("p",pa," Attendee was under "+C(u.value)+" at time of registration ",1)):(n(),T("p",Ia," Attendee is under "+C(u.value),1))],64)):L("",!0)]))}}),rt=(e,o)=>e===void 0?!1:bt(e,Lt.GROUP_TYPE_CONVENTION,o.ConventionUUID,o).CheckIn,ha={key:0,class:"font-weight-bold pt-2"},ut=G({__name:"Badges",props:{cardClass:{default:""},convention:{},hideDownload:{type:Boolean,default:!1},hideNfc:{type:Boolean,default:!1},registration:{},showTitle:{type:Boolean,default:!0}},setup(e){const o=te(),t=Le(),a=At(),i=g([]);let c;const E=Tt();E&&"$NDEFReader"in E.appContext.config.globalProperties&&(c=E.appContext.config.globalProperties.$NDEFReader);const r=g(!!c),u=g(e.registration.BadgeSerialNumber),m=g(a.currentRoute.value.name=="RunnerView"),A=g(""),f=g(!1),v=g(2),d=Se();let _=!1,y=!1;e.convention&&(_=rt(d,e.convention),y=pe(d,e.convention)),ne(()=>e.registration,()=>{p(),u.value=e.registration.BadgeSerialNumber});const k=R=>{var F;const H=document.createElement("a");H.download=`${((F=e.convention)==null?void 0:F.Name)||""} Badge Image - ${e.registration.Reference} - ${e.registration.User.DisplayName}.jpg`,H.href=R,document.body.appendChild(H),H.click(),document.body.removeChild(H)},M=async R=>t.GetConBadgeImageURL(e.registration.RegistrationUUID,R),O=()=>{if(r.value)try{const R=new c;R.addEventListener("readingerror",()=>{A.value="Error Reading Card",f.value=!0}),R.addEventListener("reading",H=>{if(H.serialNumber){const F=H.serialNumber;A.value="Obtained Card Details",f.value=!0,u.value=F,o.setBadgeSerial(e.registration.RegistrationUUID,u.value).then(z=>{z?(A.value="Badge Serial Saved",f.value=!0):(A.value="Failed to Save Badge Serial",f.value=!0)})}else A.value="Serial Number not Found",f.value=!0}),R.scan&&R.scan()}catch{}},p=()=>{o.getConBadgeList(e.registration.RegistrationUUID).then(R=>{R&&(i.value=[],R.forEach(H=>{M(H).then(F=>{i.value.push({template:H,url:F})})}))}).catch(()=>{})};return p(),(R,H)=>(n(!0),T(N,null,x(i.value,F=>(n(),S(Pe,{key:F.template,class:Te(R.cardClass)},{default:l(()=>[s(be,null,{default:l(()=>[R.showTitle?(n(),S(Re,{key:0,class:"text-center"},{default:l(()=>[D(" Badges (#"+C(R.registration.Reference)+" "+C(R.registration.User.DisplayName)+") ",1)]),_:1})):L("",!0)]),_:1}),s(we,{class:"text-center"},{default:l(()=>[s(lt,{class:"d-block ma-auto",src:F.url,height:"280",width:"280"},null,8,["src"]),u.value?(n(),T("p",ha,C(u.value),1)):L("",!0)]),_:2},1024),!R.hideDownload||!R.hideNfc?(n(),S(ot,{key:0,class:"justify-center"},{default:l(()=>[!R.hideNfc&&r.value&&(U(y)||U(_)||m.value)?(n(),S($,{key:0,"prepend-icon":"mdi:mdi-nfc",color:"warning",variant:"flat",onClick:O},{default:l(()=>[D("Link Card")]),_:1})):L("",!0),R.hideDownload?L("",!0):(n(),S($,{key:1,color:"primary","prepend-icon":"mdi:mdi-download",variant:"flat",onClick:z=>k(F.url)},{default:l(()=>[D("Download")]),_:2},1032,["onClick"]))]),_:2},1024)):L("",!0),s(Vt,{modelValue:f.value,"onUpdate:modelValue":H[0]||(H[0]=z=>f.value=z),message:A.value,timeout:v.value*1e3},null,8,["modelValue","message","timeout"])]),_:2},1032,["class"]))),128))}}),Na=G({__name:"DataPanelText",props:Y({convention:{},data:{},forms:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const o=J(e,"modelValue"),t=J(e,"registration"),a=g(e.data),i=j(()=>u.value?"":a.value!==e.data?"mdi:mdi-content-save":""),c=Se(),E=te(),r=g(pe(c,e.convention)),u=g(!1),m=()=>{u.value=!0,E.directEditFieldData(t.value.RegistrationUUID,o.value.LayoutItemUUID,a.value).then(A=>{A&&t.value.Submissions.find(f=>!!f.Data.find(v=>{if(v.SectionFieldUUID===o.value.SectionFieldUUID)return v.Data=A,!0})),u.value=!1}).catch(()=>{})};return(A,f)=>o.value.Meta&&o.value.Meta.DirectEdit&&(r.value||o.value.Meta.DirectEditPermission==="View")?(n(),S(re,{key:0,modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=v=>a.value=v),"append-inner-icon":i.value,"onClick:appendInner":m},Me({_:2},[u.value?{name:"append-inner",fn:l(()=>[s(tt,{color:"primary",indeterminate:"",size:30})]),key:"0"}:void 0]),1032,["modelValue","append-inner-icon"])):(n(),T(N,{key:1},[D(C(A.data),1)],64))}}),Oa={key:4},ka={key:8},Ma=G({__name:"FormDataItem",props:Y({accommodations:{},convention:{},extras:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const o=J(e,"modelValue"),t=J(e,"registration"),a=j(()=>{var f,v,d,_;const m=o.value,A=()=>{var y;for(let k=0;k<e.forms.length;k+=1)for(let M=0;M<e.forms[k].Sections.length;M+=1)if(e.forms[k].Sections[M].Fields){const O=(y=e.forms[k].Sections[M].Fields)==null?void 0:y.find(p=>p.SectionFieldUUID===m.SectionFieldUUID);if(O)return O}};return((v=(f=m.SectionField)==null?void 0:f.Field)==null?void 0:v.Type)||((_=(d=A())==null?void 0:d.Field)==null?void 0:_.Type)}),i=j(()=>{for(let m=0;m<t.value.Submissions.length;m+=1){const f=t.value.Submissions[m].Data.find(v=>v.SectionFieldUUID===o.value.SectionFieldUUID);if(f)return f.Data}return""}),c=te(),E=Le(),r=g(""),u=g("");if(a.value==="BADGE_IMAGE")try{const m=JSON.parse(i.value||"{}");m.fileUUID&&(u.value=E.GetBadgeImageURL(m.fileUUID)),t.value&&c.getConBadgeDisplayName(t.value.RegistrationUUID).then(A=>{A&&(r.value=A)}).catch(()=>{})}catch{}return(m,A)=>a.value==="ACCOMMODATION"?(n(),S(st,{key:0,convention:m.convention,tickets:m.tickets,accommodations:m.accommodations,venues:m.venues,registration:t.value,forms:m.forms,modelValue:o.value,"onUpdate:modelValue":A[0]||(A[0]=f=>o.value=f),data:i.value},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue","data"])):a.value==="EXTRAS"?(n(),S(Ea,{key:1,value:i.value,extras:m.extras},null,8,["value","extras"])):a.value==="TICKET"?(n(),S(ya,{key:2,value:i.value,tickets:m.tickets},null,8,["value","tickets"])):a.value==="INTERESTS"?(n(),S(Ua,{key:3,value:i.value,interests:m.interests},null,8,["value","interests"])):a.value==="CHECKBOX"?(n(),T("div",Oa,[i.value?(n(),S(ue,{key:0,icon:"mdi:mdi-check",color:"success"})):(n(),S(ue,{key:1,icon:"mdi:mdi-close",color:"error"}))])):a.value==="AGE"?(n(),S(Ra,{key:5,data:i.value,forms:m.forms,registration:t.value,modelValue:o.value,"onUpdate:modelValue":A[1]||(A[1]=f=>o.value=f)},null,8,["data","forms","registration","modelValue"])):a.value==="BADGE_IMAGE"?(n(),S(ut,{key:6,convention:m.convention,registration:t.value,"show-title":!1,"card-class":m.itemClass},null,8,["convention","registration","card-class"])):a.value==="TEXT"?(n(),S(Na,{key:7,convention:m.convention,data:i.value,forms:m.forms,modelValue:o.value,"onUpdate:modelValue":A[2]||(A[2]=f=>o.value=f),registration:t.value,"onUpdate:registration":A[3]||(A[3]=f=>t.value=f)},null,8,["convention","data","forms","modelValue","registration"])):(n(),T("div",ka,C(i.value),1))}}),Va={key:0},La={key:0},ba=w("strong",null,"Total:",-1),wa=G({__name:"DataPanelRegistrationGroup",props:{registration:{}},setup(e){const o=j(()=>{const t=[];let a;return e.registration.Leader?a=e.registration:a=e.registration.Primary,t.push({Name:a.User.DisplayName,UUID:a.UserUUID,UserUUID:a.User.UserUUID,IsLeader:!0,Reference:a.Reference,Paid:a.Paid,Total:a.Total}),t.push(...a.Members.map(i=>({Name:i.User.DisplayName,UUID:i.UserUUID,UserUUID:i.User.UserUUID,IsLeader:!1,Reference:i.Reference,Paid:i.Paid,Total:i.Total}))),t});return(t,a)=>t.registration.Members.length===0&&!t.registration.Primary?(n(),T("em",Va," Not in a group ")):(n(),T(N,{key:1},[w("ul",null,[(n(!0),T(N,null,x(o.value,i=>(n(),T("li",{key:i.UUID,class:"ml-0"},[D(" #"+C(i.Reference)+" : "+C(i.Name)+" ",1),i.IsLeader?(n(),T("strong",La,"(Leader)")):L("",!0)]))),128))]),ba,D(" "+C(o.value.length),1)],64))}}),Pa=G({__name:"DataPanelSubmissionDate",props:{registration:{}},setup(e){const o=j(()=>{const t=e.registration.Submissions.find(a=>{var i;return((i=a.Form)==null?void 0:i.Type)===Ce.FORM_TYPE_REGISTRATION});return t?t.CreatedAt||"":e.registration.CreatedAt||""});return(t,a)=>(n(),T("div",null,C(U(ie)(o.value,{withDay:!1,withYear:!0})),1))}}),Fa={class:"text-grey-lighten-1"},$a=G({__name:"DataPanelSubmissionStatus",props:{convention:{},forms:{},registration:{}},emits:["showForm"],setup(e,{emit:o}){const t=o,a=Se(),i=pe(a,e.convention),c=j(()=>e.registration.Submissions.map(u=>{const m=e.forms.find(A=>A.FormUUID===u.FormUUID);if(m)return{Heading:m.Heading,Form:m,Submission:u,Registration:e.registration}}).filter(u=>!!u)),E=(u,m,A)=>{t("showForm",u,m,A)},r=u=>({ID:0,SubmissionUUID:ge(),FormID:u.ID,FormUUID:u.FormUUID,Form:u,UserID:e.registration.UserID,UserUUID:e.registration.UserUUID,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Registration:e.registration,Data:[],Status:Ft.SUBMISSION_STATUS_NULL});return(u,m)=>(n(),T(N,null,[w("ul",null,[(n(!0),T(N,null,x(u.forms.filter(A=>A.Type===U(Ce).FORM_TYPE_ADMIN&&c.value.findIndex(f=>f.Form.ID===A.ID)<0),A=>(n(),T("li",{key:A.Heading},[w("strong",Fa,C(A.Heading),1),U(i)?(n(),S($,{key:0,class:"text-grey-lighten-1",icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>E(u.registration,A,r(A))},null,8,["onClick"])):L("",!0)]))),128))]),w("ul",null,[(n(!0),T(N,null,x(c.value,A=>(n(),T("li",{key:A.Heading},[w("strong",null,[D(C(A.Heading),1),A.Form.Type!==U(Ce).FORM_TYPE_ADMIN?(n(),T(N,{key:0},[D(": ")],64)):L("",!0)]),A.Form.Type!==U(Ce).FORM_TYPE_ADMIN?(n(),T("span",{key:0,class:Te(U(wt)(A.Submission.Status))},C(U(Pt)(A.Submission.Status)),3)):L("",!0),U(i)?(n(),S($,{key:1,icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>E(A.Registration,A.Form,A.Submission)},null,8,["onClick"])):L("",!0)]))),128))])],64))}}),Ba={key:0,class:"text-blue"},Ga={key:1,class:"text-red"},Ha={key:2,class:"text-orange"},xa={key:3,class:"text-orange"},Ya={key:4,class:"text-orange"},Ka={key:5,class:"text-orange"},ja={key:6,class:"text-green"},Ja=G({__name:"DataPanelPaymentStatus",props:{registration:{}},setup(e){const o=j(()=>{if(e.registration.Paid===0&&e.registration.Total)return"REQUIRED";if(e.registration.Total>e.registration.Paid)return"ADDITIONAL_REQUIRED";const t=e.registration.Members.find(a=>a.Paid===0&&(a.Total||0)>0);return t?e.registration.Total===0&&t.Total===0?"NOT_REQUIRED":e.registration.Total===0&&t.Total||e.registration.Total>0&&t.Total===0?"MISSING_REQUIRED":e.registration.Paid>=e.registration.Total?"AWAITING_PARTNER":"ALL_REQUIRED":e.registration.Total===0?"NOT_REQUIRED":"COMPLETE"});return(t,a)=>o.value=="NOT_REQUIRED"?(n(),T("div",Ba,"No Payment Requested")):o.value=="MISSING_REQUIRED"?(n(),T("div",Ga,"Partner Payment Not Requested")):o.value=="AWAITING_PARTNER"?(n(),T("div",Ha,"Awaiting Partner Payment")):o.value=="ALL_REQUIRED"?(n(),T("div",xa,"Awaiting Payments")):o.value=="REQUIRED"?(n(),T("div",Ya,"Awaiting Payment")):o.value=="ADDITIONAL_REQUIRED"?(n(),T("div",Ka,"Awaiting Additional Payments")):(n(),T("div",ja,"Completed"))}});var qa=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],za=function(e){return qa.map(function(o){return o.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Qa=function(e,o,t){Object.keys(o).filter(za).forEach(function(a){var i=o[a];typeof i=="function"&&(a==="onInit"?i(e,t):t.on(a.substring(2),function(c){return i(c,t)}))})},Xa=function(e,o,t,a){var i=e.modelEvents?e.modelEvents:null,c=Array.isArray(i)?i.join(" "):i;ne(a,function(E,r){t&&typeof E=="string"&&E!==r&&E!==t.getContent({format:e.outputFormat})&&t.setContent(E)}),t.on(c||"change input undo redo",function(){o.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},Wa=function(e,o,t,a,i,c){a.setContent(c()),t.attrs["onUpdate:modelValue"]&&Xa(o,t,a,i),Qa(e,t.attrs,a)},ze=0,dt=function(e){var o=Date.now(),t=Math.floor(Math.random()*1e9);return ze++,e+"_"+t+ze+String(o)},Za=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Qe=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},en=function(e,o){return Qe(e).concat(Qe(o))},tn=function(e){return e==null},Xe=function(){return{listeners:[],scriptId:dt("tiny-script"),scriptLoaded:!1}},an=function(){var e=Xe(),o=function(i,c,E,r){var u=c.createElement("script");u.referrerPolicy="origin",u.type="application/javascript",u.id=i,u.src=E;var m=function(){u.removeEventListener("load",m),r()};u.addEventListener("load",m),c.head&&c.head.appendChild(u)},t=function(i,c,E){e.scriptLoaded?E():(e.listeners.push(E),i.getElementById(e.scriptId)||o(e.scriptId,i,c,function(){e.listeners.forEach(function(r){return r()}),e.scriptLoaded=!0}))},a=function(){e=Xe()};return{load:t,reinitialize:a}},nn=an(),on=function(){return typeof window<"u"?window:global},me=function(){var e=on();return e&&e.tinymce?e.tinymce:null},ln={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},le=function(){return le=Object.assign||function(e){for(var o,t=1,a=arguments.length;t<a;t++){o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},le.apply(this,arguments)},sn=function(e,o,t,a){return e(a||"div",{id:o,ref:t})},rn=function(e,o,t){return e("textarea",{id:o,visibility:"hidden",ref:t})},he={selector:void 0,target:void 0},un=G({props:ln,setup:function(e,o){var t=e.init?le(le({},e.init),he):le({},he),a=Et(e),i=a.disabled,c=a.modelValue,E=a.tagName,r=g(null),u=null,m=e.id||dt("tiny-vue"),A=e.init&&e.init.inline||e.inline,f=!!o.attrs["onUpdate:modelValue"],v=!0,d=e.initialValue?e.initialValue:"",_="",y=function(O){return f?function(){return c!=null&&c.value?c.value:""}:function(){return O?d:_}},k=function(){var O=y(v),p=le(le({},t),{readonly:e.disabled,target:r.value,plugins:en(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:A,setup:function(R){u=R,R.on("init",function(H){return Wa(H,e,o,R,c,O)}),typeof t.setup=="function"&&t.setup(R)}});Za(r.value)&&(r.value.style.visibility=""),me().init(p),v=!1};ne(i,function(O){var p;u!==null&&(typeof((p=u.mode)===null||p===void 0?void 0:p.set)=="function"?u.mode.set(O?"readonly":"design"):u.setMode(O?"readonly":"design"))}),ne(E,function(O){var p;f||(_=u.getContent()),(p=me())===null||p===void 0||p.remove(u),ye(function(){return k()})}),_t(function(){if(me()!==null)k();else if(r.value&&r.value.ownerDocument){var O=e.cloudChannel?e.cloudChannel:"6",p=e.apiKey?e.apiKey:"no-api-key",R=tn(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(p,"/tinymce/").concat(O,"/tinymce.min.js"):e.tinymceScriptSrc;nn.load(r.value.ownerDocument,R,k)}}),Ut(function(){me()!==null&&me().remove(u)}),A||(gt(function(){v||k()}),St(function(){var O;f||(_=u.getContent()),(O=me())===null||O===void 0||O.remove(u)}));var M=function(O){var p;_=u.getContent(),(p=me())===null||p===void 0||p.remove(u),t=le(le(le({},t),O),he),ye(function(){return k()})};return o.expose({rerender:M,getEditor:function(){return u}}),function(){return A?sn(xe,m,r,e.tagName):rn(xe,m,r)}}});const dn=["colspan"],cn=w("strong",null,"E-Mail Content",-1),mn=["innerHTML"],vn=G({__name:"Communications",props:{expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:o}){const t=te(),a=g([]),i=g({From:"",Subject:"",HTML:""}),c=g(""),E=g(""),r=g(""),u=g(!1),m=g(e.expanded?["1"]:[]),A=g([]),f=g([]),v=g([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),d=g([{key:"CreatedAt",order:"asc"}]);ne(i,O=>{r.value=O.From||r.value||"",E.value=O.Subject||E.value||"",c.value=O.HTML||c.value||""});const _=o,y=()=>{t.getRegistrationEmails(e.registration.RegistrationUUID).then(O=>{O&&(O.forEach(p=>{p.CreatedAt=Ie(new Date(p.CreatedAt||"")),p.Status=Xt(p.Status),p.User||(p.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),f.value=O)})};y(),(()=>{t.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(O=>{O&&(a.value=O)})})();const M=({callback:O})=>{t.sendRegistrationEmail(e.registration.RegistrationUUID,r.value,E.value,c.value).then(p=>{p?O&&(O("Email Sent"),y(),setTimeout(()=>{u.value=!1},2e3)):O&&O("Not sent")}).catch(()=>{O&&O("Not sent")})};return(O,p)=>(n(),T(N,null,[O.showEditor?(n(),S(se,{key:0,class:"px-0",style:{"max-width":"calc(100vw - 64px)"}},{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[s(at,{items:a.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=R=>i.value=R),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12"},{default:l(()=>[s(re,{modelValue:r.value,"onUpdate:modelValue":p[1]||(p[1]=R=>r.value=R),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12"},{default:l(()=>[s(re,{modelValue:E.value,"onUpdate:modelValue":p[2]||(p[2]=R=>E.value=R),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12"},{default:l(()=>[s(U(un),{modelValue:c.value,"onUpdate:modelValue":p[3]||(p[3]=R=>c.value=R),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[s(Je,{onClick:p[4]||(p[4]=R=>_("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),s(P,{class:"text-right"},{default:l(()=>[s(Je,{onClick:M,label:"Send",color:"error"})]),_:1})]),_:1})]),_:1})):L("",!0),f.value.length&&!O.hideHistory?(n(),S(He,{key:1,class:"my-2",multiple:!0,modelValue:m.value,"onUpdate:modelValue":p[7]||(p[7]=R=>m.value=R)},{default:l(()=>[s(Ge,{value:"1"},{default:l(()=>[s(Fe,null,{default:l(()=>[D(" Email History ")]),_:1}),s($e,null,{default:l(()=>[s(Be,{items:f.value,headers:v.value,"show-expand":!0,"item-value":"EmailUUID",expanded:A.value,"onUpdate:expanded":p[5]||(p[5]=R=>A.value=R),"sort-by":d.value,"onUpdate:sortBy":p[6]||(p[6]=R=>d.value=R)},{"expanded-row":l(({columns:R,item:H})=>[w("tr",null,[w("td",{colspan:R.length},[cn,w("div",{class:"communicationsViewEmailPreview",innerHTML:H.HTML},null,8,mn)],8,dn)])]),"footer.prepend":l(()=>[s($,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:y},{default:l(()=>[D("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):L("",!0)],64))}}),fn=G({__name:"Emails",props:{allowSending:{type:Boolean,default:!0},expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!0},registration:{},textClass:{default:""}},setup(e){const o=g(!1);return(t,a)=>(n(),T(N,null,[s(Pe,null,{default:l(()=>[t.showTitle?(n(),S(be,{key:0},{default:l(()=>[s(Re,null,{default:l(()=>[D(" E-Mails (#"+C(t.registration.Reference)+" "+C(t.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})):L("",!0),s(we,{class:Te(t.textClass)},{default:l(()=>[t.allowSending?(n(),S(K,{key:0},{default:l(()=>[s(P,{cols:"12"},{default:l(()=>[s($,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:a[0]||(a[0]=i=>o.value=!0)},{default:l(()=>[D(" Prepare Email ")]),_:1})]),_:1})]),_:1})):L("",!0)]),_:1},8,["class"])]),_:1}),s(vn,{registration:t.registration,expanded:t.expanded,"hide-history":t.hideHistory,"show-editor":o.value,onCloseEditor:a[1]||(a[1]=i=>o.value=!1)},null,8,["registration","expanded","hide-history","show-editor"])],64))}}),An=G({__name:"EditNoteCategoryDialog",props:Y({convention:{},noteCategory:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Y(["update:noteCategory"],["update:modelValue"]),setup(e,{emit:o}){const t=e,{title:a=""}=t,i=o,c=J(e,"modelValue"),E=Ve(t,i,void 0,void 0,"noteCategory"),r=g(ee(E.value));ne(E,()=>{r.value=ee(E.value)});const u=()=>{c.value=!1},m=()=>{r.value=ee(E.value)},A=()=>{E.value=r.value};return(f,v)=>(n(),S(Ee,{modelValue:c.value,"onUpdate:modelValue":v[2]||(v[2]=d=>c.value=d),onReset:m,onSave:A,title:U(a),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0},{default:l(()=>[s(se,{class:"pa-0",fluid:!0},{default:l(()=>[s(K,null,{default:l(()=>[s(P,{cols:"12",sm:"6",md:"4"},{default:l(()=>[s(re,{modelValue:r.value.Name,"onUpdate:modelValue":v[0]||(v[0]=d=>r.value.Name=d),label:"Internal name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12",sm:"6",md:"4"},{default:l(()=>[s(Bt,{modelValue:r.value.Groups,"onUpdate:modelValue":v[1]||(v[1]=d=>r.value.Groups=d),convention:f.convention,label:"Groups",variant:"outlined","hide-details":""},null,8,["modelValue","convention"])]),_:1})]),_:1})]),_:1})]),actions:l(()=>[s($,{color:"blue-darken-1",variant:"text",onClick:u},{default:l(()=>[D(" Cancel ")]),_:1}),s($,{color:"blue-darken-1",variant:"text",onClick:m},{default:l(()=>[D(" Reset ")]),_:1}),s(_e),s($,{color:"blue-darken-1",variant:"text",onClick:A},{default:l(()=>[D(" Save ")]),_:1})]),_:1},8,["modelValue","title"]))}}),Tn=()=>{const e=g(""),o=()=>{const t={x:window.innerWidth,y:window.innerHeight};t.x<600?e.value="xs":t.x>=600&&t.x<960?e.value="sm":t.x>=960&&t.x<1280?e.value="md":t.x>=1280&&t.x<1920?e.value="lg":t.x>=1920&&t.x<2560?e.value="xl":t.x>=2560&&(e.value="xxl")};return window.addEventListener("resize",o),o(),e},En={style:{"list-style":"none"}},_n=G({__name:"NoteCategories",props:{hideHistory:{type:Boolean},convention:{},showEditor:{type:Boolean}},emits:["close"],setup(e,{emit:o}){const t=te(),a=o,i=g(!1),c=g(!1),E=g(""),r=g([]),u=g([{key:"Name",title:"Name"},{key:"Groups",title:"Groups"},{key:"actions",title:"",sortable:!1}]),m=Tn();g([{key:"CreatedAt",order:"asc"}]);const A=()=>({ID:0,NoteCategoryUUID:ge(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"",Groups:[],Notes:[]}),f=g(-1),v=g(A()),d=g(A()),_=()=>{d.value.NoteCategoryUUID=ge(),v.value=Object.assign({},A()),f.value=-1,i.value=!0},y=F=>{f.value=r.value.indexOf(F),v.value=Object.assign({},F),i.value=!0},k=F=>{f.value=r.value.indexOf(F),v.value=Object.assign({},F),c.value=!0},M=()=>{t.deleteNoteCategory(v.value.NoteCategoryUUID).then(F=>{F&&(r.value.splice(f.value,1),p())})},O=()=>{i.value=!1,ye(()=>{v.value=Object.assign({},d.value),f.value=-1})},p=()=>{c.value=!1,ye(()=>{v.value=Object.assign({},d.value),f.value=-1})},R=()=>{t.saveNoteCategory(v.value).then(F=>{F&&(f.value>-1?Object.assign(r.value[f.value],F):r.value.push(F),O())})};return(()=>{t.getNoteCategories(e.convention.ConventionUUID).then(F=>{F&&(r.value=F)})})(),(F,z)=>(n(),S(Be,{headers:u.value,items:r.value,"sort-by":[{key:"calories",order:"asc"}],class:"elevation-1"},{top:l(()=>[s(Ht,{color:"primary"},Me({default:l(()=>[s(Gt,null,{default:l(()=>[D("Note Categories")]),_:1}),s(xt,{class:"mx-4 d-none d-sm-inline-flex",inset:!0,vertical:!0}),s(_e,{class:"d-none d-sm-inline-flex"}),U(m)!="xs"?(n(),S($,{key:0,dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:_},{default:l(()=>[D(" New Item ")]),_:1})):L("",!0),s($,{dark:"",class:"mb-2",icon:"mdi:mdi-window-close",onClick:z[0]||(z[0]=Q=>a("close"))}),s($t,{modelValue:c.value,"onUpdate:modelValue":z[1]||(z[1]=Q=>c.value=Q),onDelete:M},null,8,["modelValue"])]),_:2},[U(m)=="xs"?{name:"extension",fn:l(()=>[s(_e),s($,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:_},{default:l(()=>[D(" New Item ")]),_:1})]),key:"0"}:void 0]),1024),i.value?(n(),S(An,{key:0,modelValue:i.value,"onUpdate:modelValue":z[2]||(z[2]=Q=>i.value=Q),"note-category":v.value,"onUpdate:noteCategory":[z[3]||(z[3]=Q=>v.value=Q),R],title:E.value,convention:F.convention},null,8,["modelValue","note-category","title","convention"])):L("",!0)]),"item.Groups":l(({item:Q})=>[w("ul",En,[(n(!0),T(N,null,x(Q.Groups,b=>(n(),T("li",{key:b.GroupUUID,class:"py-1"},C(b.Name),1))),128))])]),"item.actions":l(({item:Q})=>[s(ue,{size:"small",class:"me-2",onClick:b=>y(Q)},{default:l(()=>[D(" mdi:mdi-pencil ")]),_:2},1032,["onClick"]),s(ue,{size:"small",onClick:b=>k(Q)},{default:l(()=>[D(" mdi:mdi-delete ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"]))}}),Un=G({__name:"SelectNoteCategories",props:Y({convention:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:Y(["change"],["update:modelValue"]),setup(e,{emit:o}){const t=J(e,"modelValue"),a=o,i=g([]),c=te(),E=g([]),r=g(""),u=g(0),m=j(()=>[...E.value].map(v=>({title:v.Name,value:i.value.find(d=>d.NoteCategoryUUID===v.NoteCategoryUUID)||v})));return typeof e.convention=="object"?r.value=e.convention.ConventionUUID:r.value=e.convention||"",(async()=>{const f=[];r.value&&f.push(c.getNoteCategories(r.value));const v=await Promise.all(f);if(r.value&&v.length==1&&(E.value=v[0].sort((d,_)=>d.Name.localeCompare(_.Name))),Array.isArray(t.value))u.value=2,m.value.forEach(d=>{Array.isArray(t.value)&&t.value.find(y=>y.NoteCategoryUUID===d.value.NoteCategoryUUID)&&i.value.push(d.value)});else if(typeof t.value=="string"){u.value=1;try{const d=JSON.parse(t.value);m.value.forEach(_=>{d.find(k=>k.NoteCategoryUUID===_.value.NoteCategoryUUID)&&i.value.push(_.value)})}catch{}}})(),ne(i,()=>{switch(u.value){default:case 2:{t.value=i.value,a("change");break}case 1:{t.value=JSON.stringify(i.value),a("change");break}}}),(f,v)=>(n(),S(at,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=d=>i.value=d),chips:f.chips,multiple:"",label:f.label||"Tags",variant:f.variant||"solo",hint:f.hint,"persistent-hint":!0,clearable:f.clearable,items:m.value,"item-title":"title","item-value":"value"},null,8,["modelValue","chips","label","variant","hint","clearable","items"]))}}),gn=G({__name:"EditNoteDialog",props:Y({convention:{},note:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Y(["update:note","saved"],["update:modelValue"]),setup(e,{emit:o}){const t=e,{title:a=""}=t,i=te(),c=o,E=J(e,"modelValue"),r=Ve(t,c,void 0,void 0,"note"),u=g(ee(r.value));ne(r,()=>{u.value=ee(r.value)});const m=()=>{u.value=ee(r.value)},A=f=>{u.value.NoteCategories===null&&(u.value.NoteCategories=[]),u.value.CreatedAt=void 0,u.value.DeletedAt=void 0,u.value.UpdatedAt=void 0,u.value.Admin=void 0,u.value.AdminID=void 0,u.value.AdminUUID=void 0,i.saveNote(u.value).then(v=>{v?(u.value=ee(v),f&&f("Note Saved"),r.value=u.value,c("saved",r.value)):f&&f("Internal Error Saving Note")}).catch(v=>{f&&f("Error Saving Note:"+v.ErrorMessage)})};return(f,v)=>u.value?(n(),S(Ee,{key:0,"card-class":"pa-4",modelValue:E.value,"onUpdate:modelValue":v[3]||(v[3]=d=>E.value=d),onReset:m,onSave:A,title:U(a),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0,"show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:l(()=>[s(se,{class:"pa-0",fluid:!0},{default:l(()=>[s(K,null,{default:l(()=>[s(P,{cols:"12"},{default:l(()=>[s(Un,{modelValue:u.value.NoteCategories,"onUpdate:modelValue":v[0]||(v[0]=d=>u.value.NoteCategories=d),convention:f.convention,label:"Categories",variant:"outlined","hide-details":"",chips:!0},null,8,["modelValue","convention"])]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12"},{default:l(()=>[s(re,{modelValue:u.value.Subject,"onUpdate:modelValue":v[1]||(v[1]=d=>u.value.Subject=d),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12"},{default:l(()=>[s(it,{modelValue:u.value.Description,"onUpdate:modelValue":v[2]||(v[2]=d=>u.value.Description=d),label:"Note",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])):L("",!0)}}),Sn=G({__name:"Notes",props:{allowAdding:{type:Boolean,default:!0},cardClass:{default:""},convention:{},expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean},registration:{},showControlPanel:{type:Boolean,default:!0},showEditor:{type:Boolean},showTitle:{type:Boolean,default:!0},textClass:{default:""}},setup(e){const o=te(),t=()=>({ID:0,NoteUUID:ge(),Description:"",NoteCategories:[],Registration:e.registration,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Subject:""}),a=g(!1),i=g(!1),c=g([]),E=g([]),r=g(t()),u=()=>{r.value=t(),a.value=!0},m=v=>{r.value=v,a.value=!0},A=()=>{o.getRegistrationNotes(e.registration.RegistrationUUID).then(v=>{v&&(v.forEach(d=>{d.CreatedAt=Ie(new Date(d.CreatedAt||"")),d.Admin||(d.Admin={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),c.value=v,e.expanded&&(E.value=v.map(d=>d.NoteUUID)))})},f=()=>{A(),setTimeout(()=>{a.value=!1},2e3)};return A(),(v,d)=>(n(),T(N,null,[s(Pe,{class:Te(v.cardClass)},{default:l(()=>[s(be,null,{default:l(()=>[s(Re,null,{default:l(()=>[s(K,{class:"flex-row-reverse"},{default:l(()=>[v.showControlPanel?(n(),S(P,{key:0,class:"text-right flex-shrink-1 flex-grow-0",style:{"flex-grow":"0 !important"}},{default:l(()=>[s($,{class:"d-sm-none",size:"xs",icon:"mdi:mdi-cog",variant:"text",color:"warning",onClick:d[0]||(d[0]=_=>i.value=!0)}),s($,{class:"d-none d-sm-inline-flex","prepend-icon":"mdi:mdi-cog",variant:"text",color:"warning",onClick:d[1]||(d[1]=_=>i.value=!0)},{default:l(()=>[D("Categories")]),_:1})]),_:1})):L("",!0),v.showTitle?(n(),S(P,{key:1,class:"text-wrap flex-grow-1"},{default:l(()=>[D(" Notes (#"+C(v.registration.Reference)+" "+C(v.registration.User.DisplayName)+") ",1)]),_:1})):L("",!0)]),_:1})]),_:1})]),_:1}),s(we,{class:Te(v.textClass)},{default:l(()=>[c.value.length===0?(n(),T(N,{key:0},[D(" No Notes Recorded ")],64)):(n(),S(He,{key:1,multiple:!0,variant:"accordion",modelValue:E.value,"onUpdate:modelValue":d[2]||(d[2]=_=>E.value=_)},{default:l(()=>[(n(!0),T(N,null,x(c.value,_=>(n(),S(Ge,{key:`${_.NoteUUID}.${_.UpdatedAt}`,value:_.NoteUUID},{default:l(()=>[s(Fe,{class:"py-0"},{default:l(()=>[D(C(_.Subject)+" ",1),s(Yt,{class:"ml-4"},{default:l(()=>[_.NoteCategories.length===0?(n(),S(Oe,{key:0},{default:l(()=>[D(" Global ")]),_:1})):L("",!0),(n(!0),T(N,null,x(_.NoteCategories,y=>(n(),S(Oe,{key:y.NoteCategoryUUID},{default:l(()=>[D(C(y.Name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),s($e,null,{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[D(C(_.Description),1)]),_:2},1024)]),_:2},1024),s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[D(C(U(ie)(_.UpdatedAt||""))+" ",1),_&&_.Admin&&_.Admin.DisplayName?(n(),T(N,{key:0},[D(" - "+C(_.Admin.DisplayName),1)],64)):L("",!0)]),_:2},1024),s(P,{class:"text-right"},{default:l(()=>[s($,{color:"primary","prepend-icon":"mdi:mdi-pencil",onClick:y=>m(_)},{default:l(()=>[D("Edit")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["class"]),v.allowAdding?(n(),S(ot,{key:0},{default:l(()=>[s($,{color:"primary",variant:"flat",onClick:u},{default:l(()=>[D("Add Note")]),_:1})]),_:1})):L("",!0)]),_:1},8,["class"]),s(qe,{modelValue:a.value,"onUpdate:modelValue":d[5]||(d[5]=_=>a.value=_),title:"Create Note"},{default:l(()=>[s(gn,{modelValue:a.value,"onUpdate:modelValue":d[3]||(d[3]=_=>a.value=_),note:r.value,"onUpdate:note":d[4]||(d[4]=_=>r.value=_),convention:v.convention,title:"Create Note",onSaved:f},null,8,["modelValue","note","convention"])]),_:1},8,["modelValue"]),s(qe,{modelValue:i.value,"onUpdate:modelValue":d[7]||(d[7]=_=>i.value=_),title:"Note Configuration"},{default:l(()=>[s(_n,{convention:v.convention,onClose:d[6]||(d[6]=_=>i.value=!1)},null,8,["convention"])]),_:1},8,["modelValue"])],64))}}),Cn=G({__name:"StripeRefundPayment",props:Y({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Y(["refunded"],["update:modelValue"]),setup(e,{emit:o}){const t=J(e,"modelValue"),a=o,i=te(),c=g(!1),E=g("");let r=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const d=e.paymentTransaction.Data.PaymentIntent;d&&(r=d.amount)}const u=g({Amount:r/100,Description:"",Reason:""}),m=g([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),A=g(!1);async function f(d){d.preventDefault(),A.value=!0,i.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,u.value).then(_=>{_?a("refunded",_):v("An unexpected error occurred.")}).catch(_=>{v("An error occurred processing the refund: "+_.toString())}),A.value=!1}const v=d=>{E.value=d,c.value=!0};return(d,_)=>(n(),S(Ee,{modelValue:t.value,"onUpdate:modelValue":_[7]||(_[7]=y=>t.value=y),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:l(()=>[s(se,{class:"pa-0"},{default:l(()=>[s(Kt,{ref:"refundForm",id:"refund-form",onSubmit:_[4]||(_[4]=Ct(y=>f(y),["prevent"]))},{default:l(()=>[s(K,null,{default:l(()=>[s(P,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:l(()=>[s(re,{modelValue:u.value.Amount,"onUpdate:modelValue":_[0]||(_[0]=y=>u.value.Amount=y),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(P,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:l(()=>[s(Ue,{modelValue:u.value.Reason,"onUpdate:modelValue":_[1]||(_[1]=y=>u.value.Reason=y),modelModifiers:{number:!0},items:m.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),s(P,{cols:"12"},{default:l(()=>[s(re,{modelValue:u.value.Description,"onUpdate:modelValue":_[2]||(_[2]=y=>u.value.Description=y),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:l(()=>[s($,{color:"error",class:"w-100",onClick:_[3]||(_[3]=y=>t.value=!1)},{default:l(()=>[D("Cancel")]),_:1})]),_:1}),s(_e),s(P,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:l(()=>[s($,{type:"submit",color:"success",class:"w-100"},Me({default:l(()=>[D(" Issue Refund ")]),_:2},[A.value?{name:"prepend",fn:l(()=>[s(tt,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),s(nt,{modelValue:c.value,"onUpdate:modelValue":_[6]||(_[6]=y=>c.value=y)},{actions:l(()=>[s($,{variant:"text",onClick:_[5]||(_[5]=y=>c.value=!1)},{default:l(()=>[D(" Close ")]),_:1})]),default:l(()=>[D(C(E.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Dn=["colspan"],yn=w("strong",null,"Details",-1),In=["innerHTML"],pn=G({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},expanded:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:o}){const t=e;let{expanded:a=!0,hideHistory:i=!1,registration:c,showEditor:E}=t;const r=te(),u=g([]),m=g(a?["1"]:[]),A=g([]),f=g([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),v=g(!1),d=g(),_=g(!1),y=g(""),k=g([{key:"CreatedAt",order:"asc"}]),M=o,O=()=>({PaymentTransactionUUID:ge(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:c.ID,RegistrationUUID:c.RegistrationUUID,Source:Ke.PAYMENT_TRANSACTION_SOURCE_NULL,Type:je.PAYMENT_TRANSACTION_TYPE_NULL}),p=g(O()),{convertTransactions:R,getPaymentTransactionsDisplay:H}=Ot();ne(t,()=>{i=t.hideHistory,c=t.registration,E=t.showEditor,H(c.RegistrationUUID).then(V=>{A.value=V})});const F=()=>{H(c.RegistrationUUID).then(V=>{A.value=V})};F();const z=()=>{r.saveRegistrationPaymentTransaction(p.value).then(V=>{V&&(R(V.PaymentTransactions),p.value=O(),M("close-editor"),M("change"))})},Q=V=>{const h=A.value.find(I=>I.PaymentTransactionUUID===V);h&&(d.value=h.PaymentTransaction,v.value=!0)},b=V=>{if(V)try{A.value=R(V.PaymentTransactions),d.value=void 0,v.value=!1,y.value="Refund Processed",_.value=!0,M("change")}catch(h){console.error(h)}};return(V,h)=>(n(),T(N,null,[U(E)?(n(),T(N,{key:0},[s(Re,null,{default:l(()=>[D(" Add Transaction ")]),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12",sm:"6"},{default:l(()=>[s(Ue,{items:U(ht),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:p.value.Type,"onUpdate:modelValue":h[0]||(h[0]=I=>p.value.Type=I),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),s(P,{cols:"12",sm:"6"},{default:l(()=>[s(Ue,{items:U(Nt),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:p.value.Source,"onUpdate:modelValue":h[1]||(h[1]=I=>p.value.Source=I),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12",sm:"8",md:"10"},{default:l(()=>[s(re,{label:"Description","hide-details":"",modelValue:p.value.Description,"onUpdate:modelValue":h[2]||(h[2]=I=>p.value.Description=I),variant:"outlined"},null,8,["modelValue"])]),_:1}),s(P,{cols:"12",sm:"4",md:"2"},{default:l(()=>[s(re,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:p.value.Amount,"onUpdate:modelValue":h[3]||(h[3]=I=>p.value.Amount=I),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),s(K,null,{default:l(()=>[s(P,{cols:"12",sm:"3",md:"2",lg:"1"},{default:l(()=>[s($,{class:"w-100",onClick:h[4]||(h[4]=I=>M("close-editor")),color:"warning"},{default:l(()=>[D("Cancel")]),_:1})]),_:1}),s(_e),s(P,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:l(()=>[s($,{class:"w-100",onClick:z,color:"primary"},{default:l(()=>[D("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):L("",!0),A.value.length&&!U(i)?(n(),S(He,{key:1,class:"my-2",modelValue:m.value,"onUpdate:modelValue":h[10]||(h[10]=I=>m.value=I)},{default:l(()=>[s(Ge,{value:"1"},{default:l(()=>[s(Fe,null,{default:l(()=>[D(" Transaction History ")]),_:1}),s($e,null,{default:l(()=>[s(Be,{items:A.value,headers:f.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:u.value,"onUpdate:expanded":h[5]||(h[5]=I=>u.value=I),"sort-by":k.value,"onUpdate:sortBy":h[6]||(h[6]=I=>k.value=I),class:"transactionTable"},{"item.Controls":l(({item:I})=>[V.canEdit&&I.PaymentTransaction&&I.PaymentTransaction.Source===U(Ke).PAYMENT_TRANSACTION_SOURCE_STRIPE&&I.PaymentTransaction.Type===U(je).PAYMENT_TRANSACTION_TYPE_PAYMENT?(n(),S($,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:B=>Q(I.PaymentTransactionUUID)},null,8,["onClick"])):L("",!0)]),"expanded-row":l(({columns:I,item:B})=>[w("tr",null,[w("td",{colspan:I.length},[yn,w("div",{innerHTML:B.Data},null,8,In)],8,Dn)])]),"footer.prepend":l(()=>[s($,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:F},{default:l(()=>[D("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),v.value&&d.value?(n(),S(Cn,{key:0,modelValue:v.value,"onUpdate:modelValue":h[7]||(h[7]=I=>v.value=I),"payment-transaction":d.value,onRefunded:b},null,8,["modelValue","payment-transaction"])):L("",!0),s(nt,{modelValue:_.value,"onUpdate:modelValue":h[9]||(h[9]=I=>_.value=I)},{actions:l(()=>[s($,{variant:"text",onClick:h[8]||(h[8]=I=>_.value=!1)},{default:l(()=>[D(" Close ")]),_:1})]),default:l(()=>[D(C(y.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):L("",!0)],64))}}),Rn=G({__name:"DataPanelRegistrationTags",props:Y({registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=J(e,"modelValue"),t=j(()=>{if(!o.value.Meta.Tags||!Array.isArray(o.value.Meta.Tags))return e.registration.Tags;const i=o.value.Meta.Tags;return i.length===0?e.registration.Tags:e.registration.Tags.filter(c=>i.includes(c.TagUUID))}),a=j(()=>o.value.Meta.TagColour?o.value.Meta.TagColour:"");return(i,c)=>(n(!0),T(N,null,x(t.value,E=>(n(),S(Oe,{key:E.TagUUID,color:a.value,class:"ma-1"},{default:l(()=>[D(C(E.Title),1)]),_:2},1032,["color"]))),128))}}),hn=ke(Rn,[["__scopeId","data-v-644b07d0"]]),Nn=w("span",{class:"font-weight-bold pr-2"},"Status:",-1),On={key:0,class:"text-green-darken-2"},kn={key:1,class:"text-yellow-darken-4"},Mn={key:2,class:"text-red-darken-4"},Vn=w("br",null,null,-1),Ln=w("span",{class:"font-weight-bold pr-2"},"Status:",-1),bn={key:0,class:"text-green-darken-2"},wn={key:1,class:"text-yellow-darken-4"},Pn={key:2,class:"text-red-darken-4"},Fn=w("span",null,"Not Checked In",-1),We=G({__name:"DataPanelCheckIn",props:Y({convention:{},showControls:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=J(e,"modelValue"),t=te(),a=Se(),i=rt(a,e.convention),c=g([]),E=g(!1),r=g(!1),u=g(X.CHECK_IN_STATUS_PENDING),m=g(""),A=y=>{E.value=!0,u.value=y},f=()=>{v()},v=()=>{t.getCheckInHistory(o.value.RegistrationUUID).then(y=>{y&&(c.value=y,r.value=!0,y.length&&(o.value.CheckIn=y[0]))}).catch(()=>{})},d=y=>{t.saveCheckIn(o.value.RegistrationUUID,u.value,m.value).then(k=>{k?(o.value.CheckIn=k,y&&(y("Check In Saved"),setTimeout(()=>{E.value=!1},500))):y&&y("Check In Failed")}).catch(()=>{y&&y("Check In Failed")})},_=j(()=>{switch(u.value){case X.CHECK_IN_STATUS_REVOKED:return"yellow-darken-4";case X.CHECK_IN_STATUS_REJECTED:return"red-darken-4";case X.CHECK_IN_STATUS_COMPLETED:return"green-darken-2"}return""});return(y,k)=>(n(),T(N,null,[y.showControls&&U(i)?(n(),S(se,{key:0,class:"px-0"},{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[s($,{color:"error",class:"w-100","prepend-icon":"mdi:mdi-window-close",onClick:k[0]||(k[0]=M=>A(U(X).CHECK_IN_STATUS_REJECTED))},{default:l(()=>[D(" Reject ")]),_:1})]),_:1}),s(P,null,{default:l(()=>[s($,{color:"warning",class:"w-100","prepend-icon":"mdi:mdi-window-close",onClick:k[1]||(k[1]=M=>A(U(X).CHECK_IN_STATUS_REVOKED))},{default:l(()=>[D(" Revoke ")]),_:1})]),_:1}),s(P,null,{default:l(()=>[s($,{color:"success",class:"w-100","prepend-icon":"mdi:mdi-check",onClick:k[2]||(k[2]=M=>A(U(X).CHECK_IN_STATUS_COMPLETED))},{default:l(()=>[D(" Approve ")]),_:1})]),_:1})]),_:1}),s(Ee,{modelValue:E.value,"onUpdate:modelValue":k[4]||(k[4]=M=>E.value=M),color:_.value,fullscreen:!1,"hide-extension":!0,persistent:!1,scrollable:!1,"show-close-action":!0,"show-save-action":!0,"save-button-label":"Confirm",title:`${U(ce)(u.value)} Check-In`,onSave:d},{default:l(()=>[s(it,{modelValue:m.value,"onUpdate:modelValue":k[3]||(k[3]=M=>m.value=M),label:"Notes",variant:"outlined"},null,8,["modelValue"])]),_:1},8,["modelValue","color","title"])]),_:1})):L("",!0),o.value.CheckIn?(n(),S(se,{key:1,class:"px-0"},{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[Nn,o.value.CheckIn.Status===U(X).CHECK_IN_STATUS_COMPLETED?(n(),T("span",On,C(U(ce)(o.value.CheckIn.Status)),1)):o.value.CheckIn.Status===U(X).CHECK_IN_STATUS_REVOKED?(n(),T("span",kn,C(U(ce)(o.value.CheckIn.Status)),1)):o.value.CheckIn.Status===U(X).CHECK_IN_STATUS_REJECTED?(n(),T("span",Mn,C(U(ce)(o.value.CheckIn.Status)),1)):L("",!0),Vn,s($,{style:{"font-size":"0.75rem","text-transform":"none"},"append-icon":"mdi:mdi-chevron-down",size:"xs",variant:"text",onClick:f},{default:l(()=>[D("History")]),_:1})]),_:1}),s(P,{class:"text-right"},{default:l(()=>{var M;return[w("small",null,C((M=o.value.CheckIn.Admin)==null?void 0:M.DisplayName)+" "+C(U(Ie)(o.value.CheckIn.CreatedAt||"")),1)]}),_:1})]),_:1}),s(Ee,{modelValue:r.value,"onUpdate:modelValue":k[5]||(k[5]=M=>r.value=M),fullscreen:!1,"hide-extension":!0,persistent:!1,scrollable:!0,"show-close-action":!0,"show-save-action":!1,title:"Check-In History"},{default:l(()=>[s(fe,null,{default:l(()=>[(n(!0),T(N,null,x(c.value,M=>(n(),S(Ae,{key:M.CheckInUUID},{default:l(()=>[s(Ne,null,{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[Ln,M.Status===U(X).CHECK_IN_STATUS_COMPLETED?(n(),T("span",bn,C(U(ce)(M.Status)),1)):M.Status===U(X).CHECK_IN_STATUS_REVOKED?(n(),T("span",wn,C(U(ce)(M.Status)),1)):M.Status===U(X).CHECK_IN_STATUS_REJECTED?(n(),T("span",Pn,C(U(ce)(M.Status)),1)):L("",!0)]),_:2},1024),s(P,{class:"text-right"},{default:l(()=>{var O;return[w("small",null,C((O=M.Admin)==null?void 0:O.DisplayName)+" "+C(U(Ie)(M.CreatedAt||"")),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024),M.Details?(n(),S(kt,{key:0},{default:l(()=>[D(C(M.Details),1)]),_:2},1024)):L("",!0)]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})):(n(),S(se,{key:2,class:"px-0"},{default:l(()=>[Fn]),_:1}))],64))}}),$n=G({__name:"MetaDataItem",props:Y({accommodations:{},convention:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:Y(["openActions","showForm"],["update:modelValue","update:registration"]),setup(e,{emit:o}){const t=J(e,"modelValue"),a=J(e,"registration"),i=o,c=r=>{i("openActions",r)},E=(r,u,m)=>{i("showForm",r,u,m)};return(r,u)=>t.value.MetaField===U(q).META_DATA_SOURCE_ACCOMMODATION_ALLOCATION?(n(),S(st,{key:0,convention:r.convention,tickets:r.tickets,accommodations:r.accommodations,venues:r.venues,registration:a.value,forms:r.forms,modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=m=>t.value=m),data:""},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue"])):t.value.MetaField===U(q).META_DATA_SOURCE_BADGE_DISPLAY?(n(),S(ut,{key:1,"card-class":r.itemClass,convention:r.convention,registration:a.value,"show-title":!1,"hide-download":t.value.Meta.HideDownloadButton,"hide-nfc":t.value.Meta.HideNFCButton},null,8,["card-class","convention","registration","hide-download","hide-nfc"])):t.value.MetaField===U(q).META_DATA_SOURCE_EMAILS?(n(),S(fn,{key:2,"allow-sending":!1,expanded:!1,"show-title":!1,registration:a.value,"text-class":"pa-0 ma-0"},null,8,["registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_NOTES?(n(),S(Sn,{key:3,"allow-adding":!0,"card-class":r.itemClass,convention:r.convention,expanded:!1,registration:a.value,"show-control-panel":!1,"show-title":!1,"text-class":"pa-0 ma-0"},null,8,["card-class","convention","registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_PAYMENT_STATUS?(n(),S(Ja,{key:4,registration:a.value},null,8,["registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_PAYMENTS?(n(),S(pn,{key:5,registration:a.value,expanded:!1},null,8,["registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_REGISTRATION_ACTIONS?(n(),S($,{key:6,icon:"mdi:mdi-briefcase",variant:"flat",onClick:u[1]||(u[1]=m=>c(a.value))})):t.value.MetaField===U(q).META_DATA_SOURCE_SUBMISSION_STATUS||t.value.MetaField===U(q).META_DATA_SOURCE_ACCOMMODATION_FORM||t.value.MetaField===U(q).META_DATA_SOURCE_ADMIN_FORM||t.value.MetaField===U(q).META_DATA_SOURCE_DEALER_FORM||t.value.MetaField===U(q).META_DATA_SOURCE_BADGE_FORM||t.value.MetaField===U(q).META_DATA_SOURCE_REGISTRATION_FORM?(n(),S($a,{key:7,convention:r.convention,forms:r.forms,registration:a.value,onShowForm:E},null,8,["convention","forms","registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_REGISTRATION_GROUP?(n(),S(wa,{key:8,registration:a.value},null,8,["registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_REGISTRATION_REFERENCE?(n(),T(N,{key:9},[D(C(a.value.Reference),1)],64)):t.value.MetaField===U(q).META_DATA_SOURCE_SUBMISSION_DATE?(n(),S(Pa,{key:10,registration:a.value},null,8,["registration"])):t.value.MetaField===U(q).META_DATA_SOURCE_TAGS?(n(),S(hn,{key:11,registration:a.value,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=m=>t.value=m)},null,8,["registration","modelValue"])):t.value.MetaField===U(q).META_DATA_SOURCE_CHECKIN_CONTROL?(n(),S(We,{key:12,convention:r.convention,"show-controls":!0,modelValue:a.value,"onUpdate:modelValue":u[3]||(u[3]=m=>a.value=m)},null,8,["convention","modelValue"])):t.value.MetaField===U(q).META_DATA_SOURCE_CHECKIN_STATUS?(n(),S(We,{key:13,convention:r.convention,"show-controls":!1,modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=m=>a.value=m)},null,8,["convention","modelValue"])):(n(),T(N,{key:14},[D(" Unhandled Meta Item "+C(t.value),1)],64))}}),Bn=G({__name:"UserDataItem",props:Y({accommodations:{},convention:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const o=J(e,"modelValue"),t=J(e,"registration"),a=Le(),i=j(()=>a.GetProfileImageURL(t.value.UserUUID));return(c,E)=>o.value.UserField===U(ve).USER_DATA_SOURCE_TELEGRAM&&t.value.User.Handle?(n(),T(N,{key:0},[D(" @"+C(t.value.User.Handle),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_AVATAR?(n(),S(lt,{key:1,class:"rounded-circle",src:i.value,height:"32",width:"32"},null,8,["src"])):o.value.UserField===U(ve).USER_DATA_SOURCE_DATE_OF_BIRTH?(n(),T(N,{key:2},[D(C(U(ie)(t.value.User.Additional.DOB,{withYear:!0,withDay:!1})),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_EMAIL?(n(),T(N,{key:3},[D(C(t.value.User.Additional.Email),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_FIRST_NAME?(n(),T(N,{key:4},[D(C(t.value.User.Additional.FirstName),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_LAST_NAME?(n(),T(N,{key:5},[D(C(t.value.User.Additional.LastName),1)],64)):(n(),T(N,{key:6},[D(" Unhandled User Field "+C(o.value),1)],64))}}),Ze=G({__name:"PanelItem",props:Y({accommodations:{},convention:{},extras:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:Y(["openActions","showForm"],["update:modelValue","update:registration"]),setup(e,{emit:o}){const t=J(e,"modelValue"),a=J(e,"registration"),i=o,c=r=>{i("openActions",r)},E=(r,u,m)=>{i("showForm",r,u,m)};return(r,u)=>t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_FORM?(n(),S(Ma,{key:0,accommodations:r.accommodations,convention:r.convention,extras:r.extras,forms:r.forms,interests:r.interests,"item-class":r.itemClass,tickets:r.tickets,venues:r.venues,modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=m=>t.value=m),registration:a.value,"onUpdate:registration":u[1]||(u[1]=m=>a.value=m)},null,8,["accommodations","convention","extras","forms","interests","item-class","tickets","venues","modelValue","registration"])):t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_META?(n(),S($n,{key:1,accommodations:r.accommodations,convention:r.convention,forms:r.forms,interests:r.interests,"item-class":r.itemClass,tickets:r.tickets,venues:r.venues,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=m=>t.value=m),registration:a.value,"onUpdate:registration":u[3]||(u[3]=m=>a.value=m),onOpenActions:c,onShowForm:E},null,8,["accommodations","convention","forms","interests","item-class","tickets","venues","modelValue","registration"])):t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_USER?(n(),S(Bn,{key:2,accommodations:r.accommodations,convention:r.convention,forms:r.forms,interests:r.interests,"item-class":r.itemClass,tickets:r.tickets,venues:r.venues,modelValue:t.value,"onUpdate:modelValue":u[4]||(u[4]=m=>t.value=m),registration:a.value,"onUpdate:registration":u[5]||(u[5]=m=>a.value=m)},null,8,["accommodations","convention","forms","interests","item-class","tickets","venues","modelValue","registration"])):L("",!0)}}),Gn=["onClick"],Hn=["onClick"],Lo=G({__name:"PanelLayout",props:Y({accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{}},{layout:{required:!0},layoutModifiers:{},modelValue:{required:!0},modelModifiers:{}}),emits:Y(["openActions","showForm"],["update:layout","update:modelValue"]),setup(e,{emit:o}){const t=Dt(),a=o,i=J(e,"layout"),c=J(e,"modelValue"),E=g({});i.value&&i.value.Panels&&i.value.Panels.forEach(f=>{E.value[f.LayoutPanelUUID]=!1});const r=f=>{a("openActions",f)},u=(f,v,d)=>{a("showForm",f,v,d)},m=f=>{switch(f.PanelStyle){case oe.PANEL_STYLE_NAV_BOTTOM:return"bottom";case oe.PANEL_STYLE_NAV_LEFT:return"left";case oe.PANEL_STYLE_NAV_RIGHT:return"right";case oe.PANEL_STYLE_NAV_TOP:return"top"}},A=(f,v=!1)=>{switch(f.PanelStyle){case oe.PANEL_STYLE_NAV_BOTTOM:return v?"mdi:mdi-chevron-double-down":"mdi:mdi-chevron-double-up";case oe.PANEL_STYLE_NAV_LEFT:return v?"mdi:mdi-chevron-double-left":"mdi:mdi-chevron-double-right";case oe.PANEL_STYLE_NAV_RIGHT:return v?"mdi:mdi-chevron-double-right":"mdi:mdi-chevron-double-left";case oe.PANEL_STYLE_NAV_TOP:return v?"mdi:mdi-chevron-double-up":"mdi:mdi-chevron-double-down"}};return yt(()=>{if(!i.value||!i.value.RunnerLayoutUUID||i.value.RunnerLayoutUUID==jt)return;It.getInstance().emit("layout_opened",{AdminLayoutUUID:i.value.AdminLayoutUUID,RegistrationUUID:c.value.RegistrationUUID})}),(f,v)=>(n(),T(N,null,[(n(!0),T(N,null,x(i.value.Panels,d=>(n(),T(N,{key:d.LayoutPanelUUID},[m(d)!==void 0?(n(),S(qt,{key:0,permanent:!0,location:m(d),border:U(t).smAndDown.value?1:0,rail:U(t).smAndDown.value&&!E.value[d.LayoutPanelUUID],"rail-width":"30",width:U(t).smAndDown.value?"100%":256,app:""},{default:l(()=>[U(t).smAndDown.value&&!E.value[d.LayoutPanelUUID]?(n(),T("h3",{key:0,class:Te(`bg-secondary fill-height ${m(d)==="top"||m(d)==="bottom"?"px-3 text-right":"py-3 text-left"}`),style:{cursor:"pointer"},onClick:_=>E.value[d.LayoutPanelUUID]=!0},[s(ue,{icon:A(d,!1)},null,8,["icon"])],10,Gn)):(n(),T(N,{key:1},[w("h3",{class:"bg-secondary pa-3 d-flex",style:Ye(U(t).smAndDown.value?"cursor: pointer;":""),onClick:_=>E.value[d.LayoutPanelUUID]=!1},[D(C(d.Name)+" ",1),U(t).smAndDown.value?(n(),T(N,{key:0},[s(_e),s($,{icon:A(d,!0),variant:"plain",size:"sm"},null,8,["icon"])],64)):L("",!0)],12,Hn),s(fe,{class:"bg-panel overflow-y-auto",style:{height:"calc(100vh - 116px)"}},{default:l(()=>[(n(!0),T(N,null,x(d.Items,(_,y)=>(n(),S(Ae,{key:_.LayoutItemUUID},{default:l(()=>[d.Items.length>1?(n(),S(Ne,{key:0,class:"font-weight-bold"},{default:l(()=>[D(C(_.Label),1)]),_:2},1024)):L("",!0),s(Ze,{accommodations:f.accommodations,convention:f.convention,extras:f.extras,forms:f.forms,interests:f.interests,"item-class":"bg-panel border-0",tickets:f.tickets,venues:f.venues,modelValue:d.Items[y],"onUpdate:modelValue":k=>d.Items[y]=k,registration:c.value,onOpenActions:r,onShowForm:u},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)],64))]),_:2},1032,["location","border","rail","width"])):L("",!0)],64))),128)),s(Jt,{class:"py-0"},{default:l(()=>[s(se,null,{default:l(()=>[s(K,null,{default:l(()=>[(n(!0),T(N,null,x(i.value.Panels,d=>{var _,y,k,M,O,p;return n(),T(N,{key:d.LayoutPanelUUID},[d.PanelStyle===U(oe).PANEL_STYLE_FLEX?(n(),S(P,{key:0,cols:((_=d.Meta&&d.Meta.cols)==null?void 0:_.toString())||!1,xs:((y=d.Meta&&d.Meta.cols_xs)==null?void 0:y.toString())||!1,sm:((k=d.Meta&&d.Meta.cols_sm)==null?void 0:k.toString())||!1,md:((M=d.Meta&&d.Meta.cols_md)==null?void 0:M.toString())||!1,lg:((O=d.Meta&&d.Meta.cols_lg)==null?void 0:O.toString())||!1,xl:((p=d.Meta&&d.Meta.cols_xl)==null?void 0:p.toString())||!1,class:"pa-0 pa-sm-2"},{default:l(()=>[s(se,{class:"bg-panel",style:Ye(U(t).smAndUp.value?"border-radius: 15px;":"")},{default:l(()=>[w("h3",null,C(d.Name),1),s(fe,{class:"bg-panel"},{default:l(()=>[(n(!0),T(N,null,x(d.Items,(R,H)=>(n(),S(Ae,{key:R.LayoutItemUUID,class:"px-0"},{default:l(()=>[d.Items.length>1?(n(),S(Ne,{key:0,class:"font-weight-bold"},{default:l(()=>[D(C(R.Label),1)]),_:2},1024)):L("",!0),s(Ze,{accommodations:f.accommodations,convention:f.convention,extras:f.extras,forms:f.forms,interests:f.interests,"item-class":"bg-panel border-0",tickets:f.tickets,venues:f.venues,modelValue:d.Items[H],"onUpdate:modelValue":F=>d.Items[H]=F,registration:c.value,"onUpdate:registration":v[0]||(v[0]=F=>c.value=F),onOpenActions:r,onShowForm:u},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["style"])]),_:2},1032,["cols","xs","sm","md","lg","xl"])):L("",!0)],64)}),128))]),_:1})]),_:1})]),_:1})],64))}});class xn extends pt{constructor(t){super();Z(this,"iAmConnecting",!1);Z(this,"iAmClosing",!1);Z(this,"socket");Z(this,"timer");Z(this,"router");Z(this,"wsUri");this.timer={ping:void 0,reconnect:void 0,timeout:void 0},this.router=t.router,this.wsUri=t.wsUri,this.setupSocket()}destroy(){this.closeSocket(),this.clearTimers()}clearTimers(){this.timer&&(this.timer.ping&&clearInterval(this.timer.ping),this.timer.reconnect&&clearInterval(this.timer.reconnect),this.timer.timeout&&clearTimeout(this.timer.timeout))}closeSocket(){var t;if(this.iAmClosing=!0,this.socket){try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0}this.clearTimers()}pingSocket(){if(!this.socket){this.timer&&this.timer.ping&&clearInterval(this.timer.ping);return}this.socket.send(`PING ${new Date().getTime()}`)}send(t){var a;try{(a=this.socket)==null||a.send(t)}catch{this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3);return}}JSON(t){const a=JSON.stringify(t);this.send(a)}setupSocket(){if(!(!this.wsUri||this.iAmConnecting||this.iAmClosing)){if(this.iAmConnecting=!0,this.socket)try{this.socket.close()}catch{}this.socket=void 0;try{this.socket=new WebSocket(this.wsUri)}catch{if(!this.iAmClosing){this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3);return}}this.socket&&(this.socket.onopen=()=>{this.iAmConnecting=!1,this.emit("open"),this.setConnectionTimeout(),this.timer.ping=setInterval(()=>this.pingSocket(),1e4)},this.socket.onclose=()=>{var t;this.iAmConnecting=!1,this.emit("close");try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0,this.iAmClosing||(this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3))},this.socket.onerror=()=>{var t;this.iAmConnecting=!1,this.emit("error");try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0,this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3)},this.socket.onmessage=t=>{var i;const a=t.data;if(a.substring(0,4)==="PING"){(i=this.socket)==null||i.send(a.replace("PING","PONG"));return}if(a.substring(0,4)==="PONG"){this.setConnectionTimeout(!0);return}if(a.substring(0,1)==="{")this.router.processJSON(a);else{const c=a.match(/(?:[^\s"]+|"[^"]*")+/g);if(!c||c.length<1)throw new Error("invalid command",{cause:{msg:a,file:"socket.ts",line:113}});const E=c.shift();this.router.processCommand(E,...c.values())}this.emit("message",a)})}}setConnectionTimeout(t=!0){t&&clearTimeout(this.timer.timeout),this.timer.timeout=setTimeout(()=>{var a;if(this.socket)try{(a=this.socket)==null||a.close()}catch{}},15e3)}}const Yn=e=>new xn(e);class et extends Object{constructor(t){super(t);Z(this,"body","");Z(this,"params");Z(this,"socket");t!=null&&t.body&&this.setBody(t.body),t!=null&&t.params?this.params=t.params:this.params=new Map,this.socket=t.socket}BindJSON(){return JSON.parse(this.body)}setBody(t){this.body=t}get(t){return this.params.get(t)||""}set(t,a){this.params.set(t,a)}}class Kn extends Object{constructor(t){super(t);Z(this,"registry",new Map);Z(this,"socket");t!=null&&t.socket&&(this.socket=t.socket)}COMMAND(t,a){this.registry.set(t,a)}JSON(t,a){this.registry.set(t,a)}processCommand(t,...a){const i=new et({socket:this.socket});a.forEach((E,r)=>{i.params.set(r,E)});const c=this.registry.get(t);c&&c(i)}processJSON(t){const a=JSON.parse(t);if(!this.registry.has(a.Command))return;const i=new et({socket:this.socket});a.Data&&i.setBody(a.Data),a.Params&&(Object.getPrototypeOf(a)!=Map.prototype&&(a.Params=new Map(Object.entries(a.Params))),Object.getPrototypeOf(a.Params)==Map.prototype&&a.Params.forEach((E,r)=>{i.params.set(r,E)}));const c=this.registry.get(a.Command);c&&c(i)}}const bo=e=>{const o=new Kn({});o.COMMAND("VALID_AUTH",()=>{var a;(a=o.socket)==null||a.emit("authenticated")}),o.COMMAND("INVALID_AUTH",()=>{var a;(a=o.socket)==null||a.emit("auth_failed")}),o.JSON("CLOSE",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("kicked",i)}),o.JSON("CONVENTION_DATA",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("convention_data",i)}),o.JSON("ERROR",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("error",i)}),o.JSON("JOINED",()=>{var a;(a=o.socket)==null||a.emit("joined")}),o.JSON("RUNNER_DATA",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("runner_data",i)}),o.JSON("RUNNER_CONNECTED",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("runner_connected",i)}),o.JSON("RUNNER_DISCONNECTED",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("runner_disconnected",i)}),o.JSON("STARTED",()=>{var a;(a=o.socket)==null||a.emit("started")});const t=Yn({router:o,wsUri:e.wsUri});return o.socket=t,t},jn=Rt.getInstance(),wo=()=>jn;export{zt as A,ma as D,No as L,Oo as M,ko as P,Mo as U,Lo as _,Ea as a,Ua as b,ya as c,We as d,pn as e,ut as f,fn as g,Sn as h,ho as i,oe as j,q as k,De as l,bo as m,wo as n,ve as o,Vo as u};
