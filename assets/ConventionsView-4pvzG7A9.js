import{F as ee}from"./form-0fJbSFPv.js";import{P as te}from"./permission-7wLhDNXq.js";import{i as q,M as $,N as Q,r,k as B,w as J,n as d,q as c,v as e,f as t,C as N,P as j,_ as H,l as oe,A as D,y as ne,x as O,D as ae,B as A,V as le,Q as ie,F as se}from"./index-CA7cWJ0i.js";import{a as K}from"./scopeId-fVmH7TDV.js";import{_ as ue}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-a-Nu6N06.js";import{u as re}from"./useModel-fZzqFXHq.js";import{_ as de}from"./ModelDialog.vue_vue_type_script_setup_true_lang-fSZ_-83r.js";import{s as S}from"./index-OKsbKlsK.js";import{a as W}from"./VContainer-VR4Zw7hl.js";import{V as L,a as g}from"./VRow-lBXInVI7.js";import{V as X}from"./VAvatar-xCek4TCs.js";import{V as Y}from"./VTextField-vLl0ySGN.js";import{V as me}from"./VTextarea-THXwYTDk.js";import{V as ve}from"./VCheckbox-8k5SZsJD.js";import{V as fe}from"./VForm-ycv2b7t4.js";import{V as ce}from"./VFileInput-iYT8wOHh.js";import{G as R}from"./group-7fhbY6WJ.js";import{C as b}from"./canDo-8w-iwWYc.js";import{C as pe}from"./canEditRegistrations-PHKxD3Wu.js";import{G as Z}from"./userData-cBh5uw3z.js";import{C as ge,a as Ce}from"./canConfigureProps-_lAXv_Kl.js";import{V as Ve,a as _e,b as Ue,c as z,d as De,e as Ie}from"./VCard-zjiF5lvP.js";import{V as G}from"./VBtn-T-w1le_5.js";import{C as Ne}from"./canEditOrganisation-pymJEzkf.js";import{v as Le}from"./v4-yQnnJER4.js";import{u as we}from"./nil-rxyd0N8M.js";import"./createSimpleFunctional-xkT6QeOP.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-3ZokBwW0.js";import"./forwardRefs-EQrCdMX8.js";import"./VDialog-fb_rBMaW.js";import"./VToolbar-jJqNrc9I.js";import"./VCheckboxBtn-AEd6YlLh.js";import"./VChip-dYUehu_y.js";const ye=(a=void 0,l=void 0)=>a===void 0?!1:l===void 0?b(a,R.GROUP_TYPE_CONVENTION).EditConvention:b(a,R.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).EditConvention,Ee=(a,l)=>a===void 0?!1:b(a,R.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).ViewRegistration,Te=q({__name:"EditConventionDialog",props:$({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:$(["update:convention","delete","save"],["update:modelValue"]),setup(a,{emit:l}){const F=a,w=j(),o=K(),{title:p=""}=F,v=l,_=Q(a,"modelValue"),C=re(F,v,void 0,void 0,"convention"),n=r(B(C.value));J(C,()=>{n.value=B(C.value)});const U=r(`${o.GetConventionLogoURL(n.value.ConventionUUID)}?${new Date().getTime()}`),y=r(),P=r(),h=()=>{U.value=URL.createObjectURL(y.value.files[0])},k=()=>{v("delete")},s=()=>{n.value=B(C.value)},m=async()=>{var i;const u=new FormData((i=P.value)==null?void 0:i.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",n.value.ConventionUUID),await o.SaveConventionLogo(u)},I=u=>{m(),w.saveConvention(n.value).then(i=>{i?u&&u("Convention Data Saved").then(()=>{C.value=i,v("save",i)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,i)=>(d(),c(de,{modelValue:_.value,"onUpdate:modelValue":i[5]||(i[5]=f=>_.value=f),onDelete:k,onReset:s,onSave:I,title:N(p),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(W,{class:"pa-0",fluid:!0},{default:e(()=>[t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(X,{class:"imgLogo mx-auto",src:U.value||""},null,8,["src"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(S).formLabelName,name:"Name",variant:"outlined",modelValue:n.value.Name,"onUpdate:modelValue":i[0]||(i[0]=f=>n.value.Name=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(me,{label:N(S).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:n.value.Description,"onUpdate:modelValue":i[1]||(i[1]=f=>n.value.Description=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(S).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:n.value.DetailLink,"onUpdate:modelValue":i[2]||(i[2]=f=>n.value.DetailLink=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(S).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:n.value.Slug,"onUpdate:modelValue":i[3]||(i[3]=f=>n.value.Slug=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(ve,{label:N(S).formConventionVisible,name:"Visible",modelValue:n.value.Visible,"onUpdate:modelValue":i[4]||(i[4]=f=>n.value.Visible=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(fe,{ref_key:"conventionImageForm",ref:P,enctype:"multipart/form-data"},{default:e(()=>[t(ce,{label:N(S).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:h},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Oe=H(Te,[["__scopeId","data-v-003c7991"]]),xe=(a,l)=>a===void 0?!1:b(a,R.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).ViewProps,Re=(a,l)=>a===void 0?!1:b(a,R.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).ViewLostAndFound,be=(a,l)=>a===void 0?!1:b(a,R.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).EditLostAndFound,Pe=(a,l)=>a===void 0?!1:b(a,R.GROUP_TYPE_CONVENTION,l.ConventionUUID,l).ConfigureLostAndFound,ke=["innerHTML"],Se={key:0,class:"text-green"},Fe={key:1,class:"text-red"},he={key:0,class:"text-green"},Ae={key:1,class:"text-red"},Ge=q({__name:"ConventionCard",props:$({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:$(["delete"],["update:modelValue"]),setup(a,{emit:l}){const F=j(),w=l,o=Q(a,"modelValue"),p=K(),v=Z(),_=r(p.GetConventionLogoURL(o.value.ConventionUUID)),C=r(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),n=r(!1),U=r(!1),y=r(ye(v,o.value)),P=r(pe(v,o.value)),h=r(Ee(v,o.value)),k=r(xe(v,o.value)),s=r(Re(v,o.value)),m=r(ge(v,o.value)),I=r(be(v,o.value)),u=r(Ce(v,o.value)),i=r(Pe(v,o.value)),f=()=>{U.value=!1,_.value=`${p.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},E=T=>{F.deleteConvention(o.value.ConventionUUID).then(V=>{V?T&&(T("Convention Deleted"),w("delete")):T&&T("Failed to Delete Convention"),setTimeout(()=>{n.value=!1},2e3)}).catch(()=>{T&&(T("Failed to Delete Organisation"),n.value=!1)})};return(T,V)=>{const M=oe("RouterLink");return d(),c(Ie,null,{default:e(()=>[t(Ve,{class:"flex-1-1 align-content-start"},{default:e(()=>[_.value?(d(),c(X,{key:0,src:_.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),o.value.Name?(d(),c(_e,{key:1},{default:e(()=>[O(ne(o.value.Name),1)]),_:1})):D("",!0),o.value.Description?(d(),c(Ue,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ae("div",{innerHTML:o.value.Description},null,8,ke)]),_:1})):D("",!0),t(z,{class:"px-0 pb-0"},{default:e(()=>[O(" Visibility:  "),o.value.Visible?(d(),A("span",Se,"Visible")):(d(),A("span",Fe,"Hidden"))]),_:1}),t(z,{class:"px-0 pb-0"},{default:e(()=>[O(" Registration:  "),T.open?(d(),A("span",he,"Open")):(d(),A("span",Ae,"Closed"))]),_:1})]),_:1}),t(De,null,{default:e(()=>[t(L,{"no-gutters":""},{default:e(()=>[y.value?(d(),c(g,{key:0,class:"ma-1"},{default:e(()=>[t(G,{variant:"tonal",color:"primary",onClick:V[0]||(V[0]=x=>U.value=!0),width:"100%"},{default:e(()=>[O("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),y.value?(d(),c(g,{key:2,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t(G,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[O("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),h.value||P.value?(d(),c(g,{key:3,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t(G,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[O("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),k.value||s.value||m.value||I.value||u.value||i.value?(d(),c(g,{key:4,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/operations`},{default:e(()=>[t(G,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[O("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0)]),_:1})]),_:1}),U.value?(d(),c(Oe,{key:0,modelValue:U.value,"onUpdate:modelValue":V[1]||(V[1]=x=>U.value=x),convention:o.value,"onUpdate:convention":V[2]||(V[2]=x=>o.value=x),onDelete:V[3]||(V[3]=x=>n.value=!0),onSave:f,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),n.value?(d(),c(ue,{key:1,modelValue:n.value,"onUpdate:modelValue":V[4]||(V[4]=x=>n.value=x),"confirmation-text":"I UNDERSTAND",message:C.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:E},null,8,["modelValue","message"])):D("",!0)]),_:1})}}}),$e=H(Ge,[["__scopeId","data-v-5c95f486"]]),Me=q({__name:"ConventionsView",emits:["pageTitle"],setup(a,{emit:l}){var k;l("pageTitle","Conventions");const w=j(),o=Z(),p=r([]),v=r([]),_=le();let C=((k=_.params.organisation)==null?void 0:k.toString())||"";const n=r();J(_,()=>{var s,m;C!==((s=_.params.organisation)==null?void 0:s.toString())&&(C=((m=_.params.organisation)==null?void 0:m.toString())||"",U())});const U=()=>{C?w.getOrganisation(C).then(s=>{s&&(n.value=s,w.getConventionList(s.OrganisationUUID).then(m=>{m&&(p.value=m,y())}))}).catch(()=>{}):w.getPermissionAccessList(te.PERMISSION_TYPE_NULL).then(s=>{s&&(p.value=s.Conventions,y())})},y=()=>{p.value.forEach(s=>{w.getConventionForms(s.ConventionUUID).then(m=>{m&&(v.value=[...v.value,...m])}).catch(m=>{console.error(m)})})},P=()=>{var s,m;if(n.value){const I={ID:0,ConventionUUID:Le(),OrganisationID:((s=n.value)==null?void 0:s.ID)||0,OrganisationUUID:((m=n.value)==null?void 0:m.OrganisationUUID)||we,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};w.saveConvention(I).then(u=>{u&&p.value.push(u)})}},h=s=>{p.value.splice(s,1)};return U(),(s,m)=>(d(),c(W,null,{default:e(()=>[t(L,{class:"justify-center"},{default:e(()=>[(d(!0),A(se,null,ie(p.value,(I,u)=>(d(),c(g,{key:I.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var i,f;return[t($e,{modelValue:p.value[u],"onUpdate:modelValue":E=>p.value[u]=E,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((i=I.Organisation)==null?void 0:i.Slug)||((f=I.Organisation)==null?void 0:f.OrganisationUUID)||"",open:!!v.value.find(E=>E.ConventionUUID===I.ConventionUUID&&E.Type===N(ee).FORM_TYPE_REGISTRATION&&E.State.New),onDelete:E=>h(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(L,null,{default:e(()=>[n.value&&N(Ne)(N(o),n.value)?(d(),c(g,{key:0,class:"text-right"},{default:e(()=>[t(G,{color:"primary",onClick:P},{default:e(()=>[O("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}}),Dt=H(Me,[["__scopeId","data-v-c7b95705"]]);export{Dt as default};
