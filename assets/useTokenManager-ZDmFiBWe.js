var ct=Object.defineProperty;var mt=(e,o,t)=>o in e?ct(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var Z=(e,o,t)=>(mt(e,typeof o!="symbol"?o+"":o,t),t);import{i as B,M as x,N as j,r as S,k as ee,w as ne,c as K,n,q as D,v as l,y,D as w,F as N,x as I,B as T,Q as H,f as r,C as U,A as V,P as te,G as vt,H as ft,_ as ke,ai as At,a2 as Te,O as Me,aj as Tt,X as ye,o as Et,b as _t,ak as Ut,al as gt,am as xe,z as St,a8 as Ct,a5 as Dt,E as yt,an as Ye,ao as It,T as pt}from"./index-mPXI9Qp0.js";import{u as Ve}from"./VCheckboxBtn-WhAXVLBK.js";import{_ as Ee}from"./ModelDialog.vue_vue_type_script_setup_true_lang-36dcX1n6.js";import{h as ie,b as Ie,a as Rt,c as ht,d as Ke,P as je,u as Nt}from"./useDisplayTransactions-dimCVneI.js";import{a as se,V as ue}from"./VContainer-6Lsg3cJy.js";import{V as Y,a as P}from"./VRow-eZfYCw2a.js";import{V as fe,a as Ae,c as Ne,d as Ot}from"./VList-REFCrqJG.js";import{V as Ue}from"./VSelect-rM1vMvZD.js";import{G as Se}from"./userData-MNTZ8rW-.js";import{C as pe}from"./canEditRegistrations-A1ez9bSf.js";import{V as F,a as tt}from"./VBtn-cxRudu0n.js";import{T as kt,V as at}from"./VAutocomplete-NQyM1ESA.js";import{a as Le,V as _e}from"./scopeId-BjV4woaf.js";import{b as Mt,_ as Je,V as nt}from"./SaveButton.vue_vue_type_script_setup_true_lang-B3NEs0YQ.js";import{G as Vt}from"./group-7fhbY6WJ.js";import{C as Lt}from"./canDo-yWCfI_4r.js";import{V as be,a as Re,c as we,d as ot,e as Pe}from"./VCard-UQ8IOvIX.js";import{V as lt}from"./VAvatar-BmvMbWNn.js";import{V as re}from"./VTextField-zsESeaxr.js";import{F as Ce}from"./form-0fJbSFPv.js";import{b as bt,c as wt,S as Pt}from"./submission-40fey8Hx.js";import{v as ge}from"./v4-yQnnJER4.js";import{b as Fe,c as $e,d as Be,a as Ge,V as He,_ as Ft}from"./VDataTable-Rq7vQsh7.js";import{_ as $t}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-EmZlWVkK.js";import{a as Bt,V as Gt}from"./VToolbar-FA7vFCWP.js";import{V as Ht}from"./VDivider-5iBciAug.js";import{V as it}from"./VTextarea-zB5-uVTG.js";import{V as qe}from"./VDialog-9jv_MdM9.js";import{V as xt,a as Oe}from"./VChip-L6Ejrxpk.js";import{V as Yt}from"./VForm-eSarftrn.js";import{u as Kt}from"./nil-rxyd0N8M.js";import{b as jt,V as Jt}from"./VNavigationDrawer-PXlEkY6m.js";var qt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(qt||{});const po=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var De=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(De||{});const Ro=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var J=(e=>(e.META_DATA_SOURCE_NULL="",e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_ADMIN_FORM="META_DATA_SOURCE_ADMIN_FORM",e.META_DATA_SOURCE_BADGE_DISPLAY="META_DATA_SOURCE_BADGE_DISPLAY",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_CHECKIN_CONTROL="META_DATA_SOURCE_CHECKIN_CONTROL",e.META_DATA_SOURCE_CHECKIN_STATUS="META_DATA_SOURCE_CHECKIN_STATUS",e.META_DATA_SOURCE_DATA_LAYOUT="META_DATA_SOURCE_DATA_LAYOUT",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_EMAILS="META_DATA_SOURCE_EMAILS",e.META_DATA_SOURCE_NOTES="META_DATA_SOURCE_NOTES",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_PAYMENTS="META_DATA_SOURCE_PAYMENTS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_REGISTRATION_TOOLS_DROP="META_DATA_SOURCE_REGISTRATION_TOOLS_DROP",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e.META_DATA_SOURCE_TAGS="META_DATA_SOURCE_TAGS",e))(J||{});const ho=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Actions Dropdown",value:"META_DATA_SOURCE_REGISTRATION_TOOLS_DROP"},{title:"Badge Display",value:"META_DATA_SOURCE_BADGE_DISPLAY"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Check In Control",value:"META_DATA_SOURCE_CHECKIN_CONTROL"},{title:"Check In Status",value:"META_DATA_SOURCE_CHECKIN_STATUS"},{title:"Data Display",value:"META_DATA_SOURCE_DATA_LAYOUT"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Emails",value:"META_DATA_SOURCE_EMAILS"},{title:"Notes",value:"META_DATA_SOURCE_NOTES"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Payments",value:"META_DATA_SOURCE_PAYMENTS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"},{title:"Tags",value:"META_DATA_SOURCE_TAGS"}];var oe=(e=>(e.PANEL_STYLE_FLEX="PANEL_STYLE_FLEX",e.PANEL_STYLE_NAV_BOTTOM="PANEL_STYLE_NAV_BOTTOM",e.PANEL_STYLE_NAV_LEFT="PANEL_STYLE_NAV_LEFT",e.PANEL_STYLE_NAV_RIGHT="PANEL_STYLE_NAV_RIGHT",e.PANEL_STYLE_NAV_TOP="PANEL_STYLE_NAV_TOP",e))(oe||{});const No=[{title:"Body Flexible",value:"PANEL_STYLE_FLEX"},{title:"Fixed Bottom",value:"PANEL_STYLE_NAV_BOTTOM"},{title:"Fixed Left",value:"PANEL_STYLE_NAV_LEFT"},{title:"Fixed Right",value:"PANEL_STYLE_NAV_RIGHT"},{title:"Fixed Top",value:"PANEL_STYLE_NAV_TOP"}];var ve=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_CONTACTS="USER_DATA_SOURCE_CONTACTS",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(ve||{});const Oo=[{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"Contact Details",value:"USER_DATA_SOURCE_CONTACTS"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}];var Q=(e=>(e.CHECK_IN_STATUS_PENDING="CHECK_IN_STATUS_PENDING",e.CHECK_IN_STATUS_COMPLETED="CHECK_IN_STATUS_COMPLETED",e.CHECK_IN_STATUS_REJECTED="CHECK_IN_STATUS_REJECTED",e.CHECK_IN_STATUS_REVOKED="CHECK_IN_STATUS_REVOKED",e))(Q||{});const zt=[{title:"Pending",value:"CHECK_IN_STATUS_PENDING"},{title:"Completed",value:"CHECK_IN_STATUS_COMPLETED"},{title:"Rejected",value:"CHECK_IN_STATUS_REJECTED"},{title:"Revoked",value:"CHECK_IN_STATUS_REVOKED"}],ce=e=>{var o;return((o=zt.find(t=>t.value===e))==null?void 0:o.title)||""},Qt=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},ko=e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`,Xt=w("br",null,null,-1),Wt=w("h3",null,"Assigned Accommodation",-1),Zt=w("br",null,null,-1),ea=w("br",null,null,-1),ta=w("h3",null,"Accommodation Preferences",-1),aa=w("h3",null,"Selected Tickets",-1),na=w("br",null,null,-1),oa=B({__name:"EditAccommodationAssignmentDialog",props:x({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["update:field"],["update:modelValue"]),setup(e,{emit:o}){const t=e,{convention:a,registration:i,title:c=""}=t,E=o,s=te(),u=j(e,"modelValue"),m=S({capacity:{max:b=>{var p;const M=L.value.find($=>$.room.RoomUUID===b);return!M||M.room.MaximumCapacity===0?!0:(((p=d.value)==null?void 0:p.Members.length)||0)<=M.room.MaximumCapacity||"Too many people in the group for this room"},min:b=>{var p;const M=L.value.find($=>$.room.RoomUUID===b);return!M||M.room.MinimumCapacity===0?!0:(((p=d.value)==null?void 0:p.Members.length)||0)>=M.room.MinimumCapacity||"Not enough people in the group for this room"}}}),A=S([]),f=Ve(t,E,void 0,void 0,"field"),v=S(ee(f.value));ne(f,()=>{v.value=ee(f.value)});const d=S(),_=S(""),R=S(""),k=S([]),O=S({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),g=async()=>{var p;const b=await s.getConventionAvailableAccommodation(a.ConventionUUID);b&&(A.value=b);const M=await s.getRegistrationGroup(i.RegistrationUUID||"");M&&(d.value=M);const h=await s.getConventionTickets(a.ConventionUUID);h&&(k.value=h);try{O.value=JSON.parse(((p=d.value)==null?void 0:p.TicketData)||"")}catch{}};ne(_,()=>{R.value=L.value.length>0?L.value[0].value:""});const C=K(()=>{const b=q.value;return A.value.map(M=>{let h;return b.forEach(p=>{M.Costs.forEach($=>{$.DateStart===(p==null?void 0:p.DateStart)&&$.DateEnd===p.DateEnd&&(h===void 0||h>$.Availability)&&(h=$.Availability)})}),{label:`${M.Name}`,title:`${M.Name} (${h} Available)`,value:M.AccommodationUUID}})}),L=K(()=>{const b=q.value,M=A.value.find(h=>h.AccommodationUUID===_.value);return(M==null?void 0:M.Pool.map(h=>{var $,X;let p;return b.forEach(ae=>{h.Costs.forEach(de=>{de.DateStart===(ae==null?void 0:ae.DateStart)&&de.DateEnd===ae.DateEnd&&(p===void 0||p>de.Availability)&&(p=de.Availability)})}),{label:`${($=h.Venue)==null?void 0:$.Name} - ${h.Name}`,title:`${(X=h.Venue)==null?void 0:X.Name} - ${h.Name} (${p} Available)`,value:h.RoomUUID,room:h}}))||[]}),q=K(()=>[...O.value.Ticket,...O.value.AddonsChecked,...O.value.ComponentsChecked].map(b=>k.value.find(M=>M.TicketUUID===b)).filter(b=>b!==void 0&&b.RequiresAccommodation)),G=b=>{var M;s.assignAccommodation(((M=d.value)==null?void 0:M.Registration.RegistrationUUID)||"",_.value,R.value,!1).then(h=>{h?(g(),b&&b("Room Assigned")):b&&b("Room not assigned")}).catch(()=>{b&&b("Room not assigned")})},W=b=>{var M,h;(M=d.value)!=null&&M.Registration.AllocationUUID?s.deleteAllocation(((h=d.value)==null?void 0:h.Registration.AllocationUUID)||"").then(p=>{p?(g(),b&&b("Allocation Deleted")):b&&b("Allocation not deleted")}).catch(()=>{b&&b("Allocation not deleted")}):b&&b("Nothing to Delete")},z=b=>{var h,p;const M=(h=A.value.find($=>$.AccommodationUUID===b.AccommodationUUID))==null?void 0:h.Pool;if(M){const $=M.find(X=>X.RoomUUID===b.RoomUUID);if($)return`${(p=$.Venue)==null?void 0:p.Name} - ${$.Name}`}return""};return g(),(b,M)=>{var h;return n(),D(Ee,{modelValue:u.value,"onUpdate:modelValue":M[2]||(M[2]=p=>u.value=p),title:U(c),color:"primary","show-close-action":!0,"show-delete-action":!!((h=d.value)!=null&&h.Registration.Allocation),"show-save-action":!!R.value,"save-button-label":"Assign Room",onDelete:W,onSave:G,fullscreen:!0,persistent:!0},{default:l(()=>[r(se,{class:"pa-0",fluid:!0},{default:l(()=>[r(Y,null,{default:l(()=>{var p;return[r(P,{cols:"12",md:"6"},{default:l(()=>{var $,X;return[w("h3",null,"Group Members ("+y(($=d.value)==null?void 0:$.Members.length)+")",1),(n(!0),T(N,null,H((X=d.value)==null?void 0:X.Members,ae=>(n(),T(N,{key:ae.UUID},[I(" #"+y(ae.Reference)+" "+y(ae.Name),1),Xt],64))),128))]}),_:1}),(p=d.value)!=null&&p.Registration.Allocation?(n(),D(P,{key:0,cols:"12",md:"6"},{default:l(()=>[Wt,r(fe,null,{default:l(()=>{var $;return[(n(!0),T(N,null,H(($=d.value)==null?void 0:$.Registration.Allocation.Periods,X=>(n(),D(Ae,{key:X.AllocationPeriodUUID},{default:l(()=>{var ae;return[I(y((ae=A.value.find(de=>de.AccommodationUUID===X.AccommodationUUID))==null?void 0:ae.Name)+" ",1),Zt,I(" "+y(z(X))+" ",1),ea,w("small",null,"("+y(U(ie)(X.DateStart))+" - "+y(U(ie)(X.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):V("",!0)]}),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12",md:"6"},{default:l(()=>[b.selectedAccommodation.length?(n(),T(N,{key:0},[ta,r(fe,null,{default:l(()=>[(n(!0),T(N,null,H(b.selectedAccommodation,(p,$)=>(n(),D(Ae,{key:p.AccommodationUUID},{default:l(()=>[I(y($+1)+". "+y(p.Name),1)]),_:2},1024))),128))]),_:1})],64)):V("",!0)]),_:1}),r(P,{cosl:"12",md:"6"},{default:l(()=>[aa,r(fe,null,{default:l(()=>[(n(!0),T(N,null,H(q.value,p=>(n(),D(Ae,{key:p==null?void 0:p.TicketUUID},{default:l(()=>[I(y(p.Name)+" ",1),na,w("small",null,"("+y(U(ie)(p.DateStart))+" - "+y(U(ie)(p.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12",md:"6"},{default:l(()=>[r(Ue,{modelValue:_.value,"onUpdate:modelValue":M[0]||(M[0]=p=>_.value=p),items:C.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),r(P,{cols:"12",md:"6"},{default:l(()=>[r(Ue,{modelValue:R.value,"onUpdate:modelValue":M[1]||(M[1]=p=>R.value=p),items:L.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[m.value.capacity.min,m.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),la=e=>(vt("data-v-33548a38"),e=e(),ft(),e),ia={key:0,class:"accommodationList"},sa={key:0,class:"text-orange-darken-2"},ra={key:1,class:"accommodationList"},ua=la(()=>w("br",null,null,-1)),da=B({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const o=Se(),t=pe(o,e.convention),a=S(!1),i=K(()=>e.registration.Allocation.Periods.map(s=>{var u;return{DateStart:s.DateStart,DateEnd:s.DateEnd,Accommodation:s.Accommodation||((u=e.accommodations)==null?void 0:u.find(m=>m.AccommodationUUID==s.AccommodationUUID))}}).sort((s,u)=>s.DateStart>u.DateStart?1:s.DateStart==u.DateStart?0:-1));e.registration&&e.registration.Allocation&&e.registration.Allocation.Periods&&e.registration.Allocation.Periods.forEach(s=>{var m;if(s.Accommodation)return;const u=(m=e.accommodations)==null?void 0:m.find(A=>A.AccommodationUUID==s.AccommodationUUID);u&&(s.Accommodation=u)});const c=K(()=>{if(!e.value)return[];const s=JSON.parse(e.value),u=e.accommodations.filter(m=>s.includes(m.AccommodationUUID)).sort((m,A)=>{const f=s.findIndex(d=>d===m.AccommodationUUID),v=s.findIndex(d=>d===A.AccommodationUUID);return f>v?1:-1});return ee(u)}),E=K(()=>{let s;const u=e.forms.find(m=>!!m.Sections.find(A=>{var f;return A.Fields?!!((f=A.Fields)!=null&&f.find(v=>{var d;return((d=v.Field)==null?void 0:d.Type)==="TICKET"?(s=v,!0):!1})):!1}));return s?!!e.registration.Submissions.find(m=>{if(m.FormUUID==(u==null?void 0:u.FormUUID))return!!m.Data.find(A=>{if(A.SectionFieldUUID==(s==null?void 0:s.SectionFieldUUID)){const f=JSON.parse(A.Data);return e.tickets.filter(v=>v.RequiresAccommodation).find(v=>f.Ticket.includes(v.TicketUUID)||f.AddonsChecked.includes(v.TicketUUID)||f.ComponentsChecked.includes(v.TicketUUID))}})}):!1});return(s,u)=>E.value?(n(),T(N,{key:0},[s.value?(n(),T("ol",ia,[(n(!0),T(N,null,H(c.value,m=>(n(),T("li",{key:m.AccommodationUUID},[s.registration&&s.registration.Allocation&&s.registration.Allocation.Periods.find(A=>A.AccommodationUUID===m.AccommodationUUID)?(n(),T("strong",sa,y(m.Name),1)):(n(),T(N,{key:1},[I(y(m.Name),1)],64))]))),128))])):(n(),T("ul",ra,[(n(!0),T(N,null,H(i.value,m=>{var A;return n(),T("li",{key:m.DateStart},[I(y((A=m.Accommodation)==null?void 0:A.Name)+" ("+y(U(ie)(m.DateStart))+" - "+y(U(ie)(m.DateEnd))+")",1),ua])}),128))])),U(t)?(n(),D(F,{key:2,onClick:u[0]||(u[0]=m=>a.value=!0),variant:"flat",color:"success"},{default:l(()=>[I("Assign Accommodation")]),_:1})):V("",!0),s.convention&&a.value?(n(),D(oa,{key:3,modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m),title:"Accommodation Allocation",convention:s.convention,registration:s.registration,tickets:s.tickets,"selected-accommodation":c.value},null,8,["modelValue","convention","registration","tickets","selected-accommodation"])):V("",!0)],64)):V("",!0)}}),ca=ke(da,[["__scopeId","data-v-33548a38"]]),ma={key:0,class:"addonList"},va={key:0},fa={key:0},Aa=B({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const o=K(()=>{if(!e.value)return;const t=JSON.parse(e.value),a=Object.keys(t),i=ee(e.extras);return i.forEach(c=>{c.Options=c.Options.filter(E=>a.includes(E.OptionUUID)?(E.Choices=E.Choices.filter(s=>s.TagUUID===t[E.OptionUUID].choiceId),t[E.OptionUUID].checked):!1)}),i.filter(c=>c.Options.length>0),i});return(t,a)=>t.value?(n(),T("ul",ma,[(n(!0),T(N,null,H(o.value,i=>(n(),T(N,{key:i.ExtraUUID},[i.Options.length?(n(),T("li",va,[w("strong",null,y(i.Name),1),w("ul",null,[(n(!0),T(N,null,H(i.Options,c=>(n(),T("li",{key:c.OptionUUID},[I(y(c.Name)+" ",1),c.Choices.length==1?(n(),T("small",fa,"("+y(c.Choices[0].Title)+")",1)):V("",!0)]))),128))])])):V("",!0)],64))),128))])):V("",!0)}}),Ta=ke(Aa,[["__scopeId","data-v-55786e01"]]),Ea={key:0},_a=B({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const o=K(()=>{if(!e.value)return;const t=JSON.parse(e.value);return Object.entries(t).filter(([,a])=>a).map(([a,i])=>e.interests.find(c=>c.InterestUUID===a)).filter(a=>a!==void 0)});return(t,a)=>t.value?(n(),T("ul",Ea,[(n(!0),T(N,null,H(o.value,i=>(n(),T("li",{key:i.InterestUUID},y(i.Name),1))),128))])):V("",!0)}}),Ua=w("br",null,null,-1),ga=w("small",null,"Options:",-1),Sa=w("br",null,null,-1),Ca=w("small",null,"Addons:",-1),Da=B({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const o=K(()=>{if(!e.value)return;let t={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{t=JSON.parse(e.value),"ticket"in t&&(t.Ticket=t.ticket),"addonsChecked"in t&&(t.AddonsChecked=t.addonsChecked),"componentsChecked"in t&&(t.ComponentsChecked=t.componentsChecked)}catch{}return t.Ticket.filter(a=>{const i=e.tickets.find(c=>c.TicketUUID===a);return!(!i||i.Type!==kt.TICKET_TYPE_TICKET)}).map(a=>{const i=e.tickets.find(E=>E.TicketUUID===a),c=ee(i);return c.TicketComponents=i.TicketComponents.filter(E=>t.ComponentsChecked.includes(E.TicketUUID)),c.AddonTickets=i.AddonTickets.filter(E=>t.AddonsChecked.includes(E.TicketUUID)),c})});return(t,a)=>t.value?(n(!0),T(N,{key:0},H(o.value,i=>(n(),T("div",{key:i.TicketUUID},[w("strong",null,y(i.Name),1),i.TicketComponents.length>0?(n(),T(N,{key:0},[Ua,ga,I("  "),(n(!0),T(N,null,H(i.TicketComponents,c=>(n(),T(N,{key:c.TicketUUID},[w("small",null,y(c.Name),1),I("  ")],64))),128))],64)):V("",!0),i.AddonTickets.length>0?(n(),T(N,{key:1},[Sa,Ca,I("  "),(n(!0),T(N,null,H(i.AddonTickets,c=>(n(),T("small",{key:c.TicketUUID},[I("("),w("em",null,y(c.Name),1),I(")")]))),128))],64)):V("",!0)]))),128)):V("",!0)}}),st=B({__name:"DataPanelAccommodation",props:x({accommodations:{},convention:{},data:{},forms:{},tickets:{},venues:{},registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){return j(e,"modelValue"),(o,t)=>(n(),T("div",null,[r(ca,{value:o.data,accommodations:o.accommodations,convention:o.convention,forms:o.forms,registration:o.registration,tickets:o.tickets,venues:o.venues},null,8,["value","accommodations","convention","forms","registration","tickets","venues"])]))}}),ya={key:0,class:"text-red-darken-4 font-weight-bold"},Ia={key:1,class:"text-orange-darken-2 font-weight-bold"},pa=B({__name:"DataPanelAge",props:x({data:{},forms:{},registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=j(e,"modelValue"),t=new Date,a=t.getFullYear(),i=(t.getMonth()+1).toLocaleString("en-US",{minimumIntegerDigits:2}),c=t.getDate().toLocaleString("en-US",{minimumIntegerDigits:2}),E=S(!1),s=S(`${a}-${i}-${c}`),u=S(18);e.forms.find(v=>v.Sections.find(d=>d.Fields?d.Fields.find(_=>{var R;return _.SectionFieldUUID===o.value.SectionFieldUUID?(o.value.SectionField=_,(R=_.Field)==null||R.Values.forEach(k=>{switch(k.Title){case"UNDER_AGE_APPLY_TAG":k.Value.length>0&&(E.value=!0);break;case"BEFORE_DATE":s.value=k.Value;break;case"MIN_AGE":u.value=parseInt(k.Value);break}}),!0):!1}):!1));const m=v=>({registration:A(v,e.registration.CreatedAt||"",u.value),convention:A(v,s.value,u.value)}),A=(v,d,_)=>{if(v>=d)return!1;const R=f(v),O=f(d).getTime()-R.getTime(),g=1e3*60*60*24*365.25;return O/g>=_},f=v=>{const[d,_,R]=v.split("-");return new Date(parseInt(d),parseInt(_)-1,parseInt(R))};return(v,d)=>(n(),T("div",null,[w("p",null,[I(y(U(ie)(v.data,{withDay:!1,withYear:!0}))+" ",1),E.value&&m(v.data).convention&&m(v.data).registration?(n(),D(ue,{key:0,icon:"mdi:mdi-check",color:"success"})):E.value&&!m(v.data).convention?(n(),D(ue,{key:1,icon:"mdi:mdi-alert",color:"error"})):E.value&&m(v.data).convention&&!m(v.data).registration?(n(),D(ue,{key:2,icon:"mdi:mdi-alert",color:"warning"})):V("",!0)]),E.value?(n(),T(N,{key:0},[m(v.data).convention?m(v.data).registration?V("",!0):(n(),T("p",Ia," Attendee was under "+y(u.value)+" at time of registration ",1)):(n(),T("p",ya," Attendee is under "+y(u.value),1))],64)):V("",!0)]))}}),rt=(e,o)=>e===void 0?!1:Lt(e,Vt.GROUP_TYPE_CONVENTION,o.ConventionUUID,o).CheckIn,Ra={key:0,class:"font-weight-bold pt-2"},ut=B({__name:"Badges",props:{cardClass:{default:""},convention:{},hideDownload:{type:Boolean,default:!1},hideNfc:{type:Boolean,default:!1},registration:{},showTitle:{type:Boolean,default:!0}},setup(e){const o=te(),t=Le(),a=S([]);let i;const c=At();c&&"$NDEFReader"in c.appContext.config.globalProperties&&(i=c.appContext.config.globalProperties.$NDEFReader);const E=S(!!i),s=S(e.registration.BadgeSerialNumber),u=S(""),m=S(!1),A=S(2),f=Se();let v=!1,d=!1;e.convention&&(v=rt(f,e.convention),d=pe(f,e.convention)),ne(()=>e.registration,()=>{O()});const _=g=>{var L;const C=document.createElement("a");C.download=`${((L=e.convention)==null?void 0:L.Name)||""} Badge Image - ${e.registration.Reference} - ${e.registration.User.DisplayName}.jpg`,C.href=g,document.body.appendChild(C),C.click(),document.body.removeChild(C)},R=async g=>t.GetConBadgeImageURL(e.registration.RegistrationUUID,g),k=()=>{if(E.value)try{const g=new i;g.addEventListener("readingerror",()=>{u.value="Error Reading Card",m.value=!0}),g.addEventListener("reading",C=>{if(C.serialNumber){const L=C.serialNumber;u.value="Obtained Card Details",m.value=!0,s.value=L,o.setBadgeSerial(e.registration.RegistrationUUID,s.value).then(q=>{q?(u.value="Badge Serial Saved",m.value=!0):(u.value="Failed to Save Badge Serial",m.value=!0)})}else u.value="Serial Number not Found",m.value=!0}),g.scan&&g.scan()}catch{}},O=()=>{o.getConBadgeList(e.registration.RegistrationUUID).then(g=>{g&&(a.value=[],g.forEach(C=>{R(C).then(L=>{a.value.push({template:C,url:L})})}))}).catch(()=>{})};return O(),(g,C)=>(n(!0),T(N,null,H(a.value,L=>(n(),D(Pe,{key:L.template,class:Te(g.cardClass)},{default:l(()=>[r(be,null,{default:l(()=>[g.showTitle?(n(),D(Re,{key:0,class:"text-center"},{default:l(()=>[I(" Badges (#"+y(g.registration.Reference)+" "+y(g.registration.User.DisplayName)+") ",1)]),_:1})):V("",!0)]),_:1}),r(we,{class:"text-center"},{default:l(()=>[r(lt,{class:"d-block ma-auto",src:L.url,height:"280",width:"280"},null,8,["src"]),s.value?(n(),T("p",Ra,y(s.value),1)):V("",!0)]),_:2},1024),!g.hideDownload||!g.hideNfc?(n(),D(ot,{key:0,class:"justify-center"},{default:l(()=>[!g.hideNfc&&E.value&&(U(d)||U(v))?(n(),D(F,{key:0,"prepend-icon":"mdi:mdi-nfc",color:"warning",variant:"flat",onClick:k},{default:l(()=>[I("Link Card")]),_:1})):V("",!0),g.hideDownload?V("",!0):(n(),D(F,{key:1,color:"primary","prepend-icon":"mdi:mdi-download",variant:"flat",onClick:q=>_(L.url)},{default:l(()=>[I("Download")]),_:2},1032,["onClick"]))]),_:2},1024)):V("",!0),r(Mt,{modelValue:m.value,"onUpdate:modelValue":C[0]||(C[0]=q=>m.value=q),message:u.value,timeout:A.value*1e3},null,8,["modelValue","message","timeout"])]),_:2},1032,["class"]))),128))}}),ha=B({__name:"DataPanelText",props:x({convention:{},data:{},forms:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const o=j(e,"modelValue"),t=j(e,"registration"),a=S(e.data),i=K(()=>u.value?"":a.value!==e.data?"mdi:mdi-content-save":""),c=Se(),E=te(),s=S(pe(c,e.convention)),u=S(!1),m=()=>{u.value=!0,E.directEditFieldData(t.value.RegistrationUUID,o.value.LayoutItemUUID,a.value).then(A=>{A&&t.value.Submissions.find(f=>!!f.Data.find(v=>{if(v.SectionFieldUUID===o.value.SectionFieldUUID)return v.Data=A,!0})),u.value=!1}).catch(()=>{})};return(A,f)=>o.value.Meta&&o.value.Meta.DirectEdit&&(s.value||o.value.Meta.DirectEditPermission==="View")?(n(),D(re,{key:0,modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=v=>a.value=v),"append-inner-icon":i.value,"onClick:appendInner":m},Me({_:2},[u.value?{name:"append-inner",fn:l(()=>[r(tt,{color:"primary",indeterminate:"",size:30})]),key:"0"}:void 0]),1032,["modelValue","append-inner-icon"])):(n(),T(N,{key:1},[I(y(A.data),1)],64))}}),Na={key:4},Oa={key:8},ka=B({__name:"FormDataItem",props:x({accommodations:{},convention:{},extras:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const o=j(e,"modelValue"),t=j(e,"registration"),a=K(()=>{var f,v,d,_;const m=o.value,A=()=>{var R;for(let k=0;k<e.forms.length;k+=1)for(let O=0;O<e.forms[k].Sections.length;O+=1)if(e.forms[k].Sections[O].Fields){const g=(R=e.forms[k].Sections[O].Fields)==null?void 0:R.find(C=>C.SectionFieldUUID===m.SectionFieldUUID);if(g)return g}};return((v=(f=m.SectionField)==null?void 0:f.Field)==null?void 0:v.Type)||((_=(d=A())==null?void 0:d.Field)==null?void 0:_.Type)}),i=K(()=>{for(let m=0;m<t.value.Submissions.length;m+=1){const f=t.value.Submissions[m].Data.find(v=>v.SectionFieldUUID===o.value.SectionFieldUUID);if(f)return f.Data}return""}),c=te(),E=Le(),s=S(""),u=S("");if(a.value==="BADGE_IMAGE")try{const m=JSON.parse(i.value||"{}");m.fileUUID&&(u.value=E.GetBadgeImageURL(m.fileUUID)),t.value&&c.getConBadgeDisplayName(t.value.RegistrationUUID).then(A=>{A&&(s.value=A)}).catch(()=>{})}catch{}return(m,A)=>a.value==="ACCOMMODATION"?(n(),D(st,{key:0,convention:m.convention,tickets:m.tickets,accommodations:m.accommodations,venues:m.venues,registration:t.value,forms:m.forms,modelValue:o.value,"onUpdate:modelValue":A[0]||(A[0]=f=>o.value=f),data:i.value},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue","data"])):a.value==="EXTRAS"?(n(),D(Ta,{key:1,value:i.value,extras:m.extras},null,8,["value","extras"])):a.value==="TICKET"?(n(),D(Da,{key:2,value:i.value,tickets:m.tickets},null,8,["value","tickets"])):a.value==="INTERESTS"?(n(),D(_a,{key:3,value:i.value,interests:m.interests},null,8,["value","interests"])):a.value==="CHECKBOX"?(n(),T("div",Na,[i.value?(n(),D(ue,{key:0,icon:"mdi:mdi-check",color:"success"})):(n(),D(ue,{key:1,icon:"mdi:mdi-close",color:"error"}))])):a.value==="AGE"?(n(),D(pa,{key:5,data:i.value,forms:m.forms,registration:t.value,modelValue:o.value,"onUpdate:modelValue":A[1]||(A[1]=f=>o.value=f)},null,8,["data","forms","registration","modelValue"])):a.value==="BADGE_IMAGE"?(n(),D(ut,{key:6,convention:m.convention,registration:t.value,"show-title":!1,"card-class":m.itemClass},null,8,["convention","registration","card-class"])):a.value==="TEXT"?(n(),D(ha,{key:7,convention:m.convention,data:i.value,forms:m.forms,modelValue:o.value,"onUpdate:modelValue":A[2]||(A[2]=f=>o.value=f),registration:t.value,"onUpdate:registration":A[3]||(A[3]=f=>t.value=f)},null,8,["convention","data","forms","modelValue","registration"])):(n(),T("div",Oa,y(i.value),1))}}),Ma={key:0},Va={key:0},La=w("strong",null,"Total:",-1),ba=B({__name:"DataPanelRegistrationGroup",props:{registration:{}},setup(e){const o=K(()=>{const t=[];let a;return e.registration.Leader?a=e.registration:a=e.registration.Primary,t.push({Name:a.User.DisplayName,UUID:a.UserUUID,UserUUID:a.User.UserUUID,IsLeader:!0,Reference:a.Reference,Paid:a.Paid,Total:a.Total}),t.push(...a.Members.map(i=>({Name:i.User.DisplayName,UUID:i.UserUUID,UserUUID:i.User.UserUUID,IsLeader:!1,Reference:i.Reference,Paid:i.Paid,Total:i.Total}))),t});return(t,a)=>t.registration.Members.length===0&&!t.registration.Primary?(n(),T("em",Ma," Not in a group ")):(n(),T(N,{key:1},[w("ul",null,[(n(!0),T(N,null,H(o.value,i=>(n(),T("li",{key:i.UUID,class:"ml-0"},[I(" #"+y(i.Reference)+" : "+y(i.Name)+" ",1),i.IsLeader?(n(),T("strong",Va,"(Leader)")):V("",!0)]))),128))]),La,I(" "+y(o.value.length),1)],64))}}),wa=B({__name:"DataPanelSubmissionDate",props:{registration:{}},setup(e){const o=K(()=>{const t=e.registration.Submissions.find(a=>{var i;return((i=a.Form)==null?void 0:i.Type)===Ce.FORM_TYPE_REGISTRATION});return t?t.CreatedAt||"":e.registration.CreatedAt||""});return(t,a)=>(n(),T("div",null,y(U(ie)(o.value,{withDay:!1,withYear:!0})),1))}}),Pa={class:"text-grey-lighten-1"},Fa=B({__name:"DataPanelSubmissionStatus",props:{convention:{},forms:{},registration:{}},emits:["showForm"],setup(e,{emit:o}){const t=o,a=Se(),i=pe(a,e.convention),c=K(()=>e.registration.Submissions.map(u=>{const m=e.forms.find(A=>A.FormUUID===u.FormUUID);if(m)return{Heading:m.Heading,Form:m,Submission:u,Registration:e.registration}}).filter(u=>!!u)),E=(u,m,A)=>{t("showForm",u,m,A)},s=u=>({ID:0,SubmissionUUID:ge(),FormID:u.ID,FormUUID:u.FormUUID,Form:u,UserID:e.registration.UserID,UserUUID:e.registration.UserUUID,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Registration:e.registration,Data:[],Status:Pt.SUBMISSION_STATUS_NULL});return(u,m)=>(n(),T(N,null,[w("ul",null,[(n(!0),T(N,null,H(u.forms.filter(A=>A.Type===U(Ce).FORM_TYPE_ADMIN&&c.value.findIndex(f=>f.Form.ID===A.ID)<0),A=>(n(),T("li",{key:A.Heading},[w("strong",Pa,y(A.Heading),1),U(i)?(n(),D(F,{key:0,class:"text-grey-lighten-1",icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>E(u.registration,A,s(A))},null,8,["onClick"])):V("",!0)]))),128))]),w("ul",null,[(n(!0),T(N,null,H(c.value,A=>(n(),T("li",{key:A.Heading},[w("strong",null,[I(y(A.Heading),1),A.Form.Type!==U(Ce).FORM_TYPE_ADMIN?(n(),T(N,{key:0},[I(": ")],64)):V("",!0)]),A.Form.Type!==U(Ce).FORM_TYPE_ADMIN?(n(),T("span",{key:0,class:Te(U(bt)(A.Submission.Status))},y(U(wt)(A.Submission.Status)),3)):V("",!0),U(i)?(n(),D(F,{key:1,icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:f=>E(A.Registration,A.Form,A.Submission)},null,8,["onClick"])):V("",!0)]))),128))])],64))}}),$a={key:0,class:"text-blue"},Ba={key:1,class:"text-red"},Ga={key:2,class:"text-orange"},Ha={key:3,class:"text-orange"},xa={key:4,class:"text-orange"},Ya={key:5,class:"text-orange"},Ka={key:6,class:"text-green"},ja=B({__name:"DataPanelPaymentStatus",props:{registration:{}},setup(e){const o=K(()=>{if(e.registration.Paid===0&&e.registration.Total)return"REQUIRED";if(e.registration.Total>e.registration.Paid)return"ADDITIONAL_REQUIRED";const t=e.registration.Members.find(a=>a.Paid===0&&(a.Total||0)>0);return t?e.registration.Total===0&&t.Total===0?"NOT_REQUIRED":e.registration.Total===0&&t.Total||e.registration.Total>0&&t.Total===0?"MISSING_REQUIRED":e.registration.Paid>=e.registration.Total?"AWAITING_PARTNER":"ALL_REQUIRED":e.registration.Total===0?"NOT_REQUIRED":"COMPLETE"});return(t,a)=>o.value=="NOT_REQUIRED"?(n(),T("div",$a,"No Payment Requested")):o.value=="MISSING_REQUIRED"?(n(),T("div",Ba,"Partner Payment Not Requested")):o.value=="AWAITING_PARTNER"?(n(),T("div",Ga,"Awaiting Partner Payment")):o.value=="ALL_REQUIRED"?(n(),T("div",Ha,"Awaiting Payments")):o.value=="REQUIRED"?(n(),T("div",xa,"Awaiting Payment")):o.value=="ADDITIONAL_REQUIRED"?(n(),T("div",Ya,"Awaiting Additional Payments")):(n(),T("div",Ka,"Completed"))}});var Ja=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],qa=function(e){return Ja.map(function(o){return o.toLowerCase()}).indexOf(e.toLowerCase())!==-1},za=function(e,o,t){Object.keys(o).filter(qa).forEach(function(a){var i=o[a];typeof i=="function"&&(a==="onInit"?i(e,t):t.on(a.substring(2),function(c){return i(c,t)}))})},Qa=function(e,o,t,a){var i=e.modelEvents?e.modelEvents:null,c=Array.isArray(i)?i.join(" "):i;ne(a,function(E,s){t&&typeof E=="string"&&E!==s&&E!==t.getContent({format:e.outputFormat})&&t.setContent(E)}),t.on(c||"change input undo redo",function(){o.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},Xa=function(e,o,t,a,i,c){a.setContent(c()),t.attrs["onUpdate:modelValue"]&&Qa(o,t,a,i),za(e,t.attrs,a)},ze=0,dt=function(e){var o=Date.now(),t=Math.floor(Math.random()*1e9);return ze++,e+"_"+t+ze+String(o)},Wa=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Qe=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Za=function(e,o){return Qe(e).concat(Qe(o))},en=function(e){return e==null},Xe=function(){return{listeners:[],scriptId:dt("tiny-script"),scriptLoaded:!1}},tn=function(){var e=Xe(),o=function(i,c,E,s){var u=c.createElement("script");u.referrerPolicy="origin",u.type="application/javascript",u.id=i,u.src=E;var m=function(){u.removeEventListener("load",m),s()};u.addEventListener("load",m),c.head&&c.head.appendChild(u)},t=function(i,c,E){e.scriptLoaded?E():(e.listeners.push(E),i.getElementById(e.scriptId)||o(e.scriptId,i,c,function(){e.listeners.forEach(function(s){return s()}),e.scriptLoaded=!0}))},a=function(){e=Xe()};return{load:t,reinitialize:a}},an=tn(),nn=function(){return typeof window<"u"?window:global},me=function(){var e=nn();return e&&e.tinymce?e.tinymce:null},on={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},le=function(){return le=Object.assign||function(e){for(var o,t=1,a=arguments.length;t<a;t++){o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},le.apply(this,arguments)},ln=function(e,o,t,a){return e(a||"div",{id:o,ref:t})},sn=function(e,o,t){return e("textarea",{id:o,visibility:"hidden",ref:t})},he={selector:void 0,target:void 0},rn=B({props:on,setup:function(e,o){var t=e.init?le(le({},e.init),he):le({},he),a=Tt(e),i=a.disabled,c=a.modelValue,E=a.tagName,s=S(null),u=null,m=e.id||dt("tiny-vue"),A=e.init&&e.init.inline||e.inline,f=!!o.attrs["onUpdate:modelValue"],v=!0,d=e.initialValue?e.initialValue:"",_="",R=function(g){return f?function(){return c!=null&&c.value?c.value:""}:function(){return g?d:_}},k=function(){var g=R(v),C=le(le({},t),{readonly:e.disabled,target:s.value,plugins:Za(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:A,setup:function(L){u=L,L.on("init",function(q){return Xa(q,e,o,L,c,g)}),typeof t.setup=="function"&&t.setup(L)}});Wa(s.value)&&(s.value.style.visibility=""),me().init(C),v=!1};ne(i,function(g){var C;u!==null&&(typeof((C=u.mode)===null||C===void 0?void 0:C.set)=="function"?u.mode.set(g?"readonly":"design"):u.setMode(g?"readonly":"design"))}),ne(E,function(g){var C;f||(_=u.getContent()),(C=me())===null||C===void 0||C.remove(u),ye(function(){return k()})}),Et(function(){if(me()!==null)k();else if(s.value&&s.value.ownerDocument){var g=e.cloudChannel?e.cloudChannel:"6",C=e.apiKey?e.apiKey:"no-api-key",L=en(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(C,"/tinymce/").concat(g,"/tinymce.min.js"):e.tinymceScriptSrc;an.load(s.value.ownerDocument,L,k)}}),_t(function(){me()!==null&&me().remove(u)}),A||(Ut(function(){v||k()}),gt(function(){var g;f||(_=u.getContent()),(g=me())===null||g===void 0||g.remove(u)}));var O=function(g){var C;_=u.getContent(),(C=me())===null||C===void 0||C.remove(u),t=le(le(le({},t),g),he),ye(function(){return k()})};return o.expose({rerender:O,getEditor:function(){return u}}),function(){return A?ln(xe,m,s,e.tagName):sn(xe,m,s)}}});const un=["colspan"],dn=w("strong",null,"E-Mail Content",-1),cn=["innerHTML"],mn=B({__name:"Communications",props:{expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:o}){const t=te(),a=S([]),i=S({From:"",Subject:"",HTML:""}),c=S(""),E=S(""),s=S(""),u=S(!1),m=S(e.expanded?["1"]:[]),A=S([]),f=S([]),v=S([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),d=S([{key:"CreatedAt",order:"asc"}]);ne(i,g=>{s.value=g.From||s.value||"",E.value=g.Subject||E.value||"",c.value=g.HTML||c.value||""});const _=o,R=()=>{t.getRegistrationEmails(e.registration.RegistrationUUID).then(g=>{g&&(g.forEach(C=>{C.CreatedAt=Ie(new Date(C.CreatedAt||"")),C.Status=Qt(C.Status),C.User||(C.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),f.value=g)})};R(),(()=>{t.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(g=>{g&&(a.value=g)})})();const O=({callback:g})=>{t.sendRegistrationEmail(e.registration.RegistrationUUID,s.value,E.value,c.value).then(C=>{C?g&&(g("Email Sent"),R(),setTimeout(()=>{u.value=!1},2e3)):g&&g("Not sent")}).catch(()=>{g&&g("Not sent")})};return(g,C)=>(n(),T(N,null,[g.showEditor?(n(),D(se,{key:0,class:"px-0",style:{"max-width":"calc(100vw - 64px)"}},{default:l(()=>[r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[r(at,{items:a.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:i.value,"onUpdate:modelValue":C[0]||(C[0]=L=>i.value=L),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12"},{default:l(()=>[r(re,{modelValue:s.value,"onUpdate:modelValue":C[1]||(C[1]=L=>s.value=L),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(P,{cols:"12"},{default:l(()=>[r(re,{modelValue:E.value,"onUpdate:modelValue":C[2]||(C[2]=L=>E.value=L),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(P,{cols:"12"},{default:l(()=>[r(U(rn),{modelValue:c.value,"onUpdate:modelValue":C[3]||(C[3]=L=>c.value=L),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[r(Je,{onClick:C[4]||(C[4]=L=>_("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),r(P,{class:"text-right"},{default:l(()=>[r(Je,{onClick:O,label:"Send",color:"error"})]),_:1})]),_:1})]),_:1})):V("",!0),f.value.length&&!g.hideHistory?(n(),D(He,{key:1,class:"my-2",multiple:!0,modelValue:m.value,"onUpdate:modelValue":C[7]||(C[7]=L=>m.value=L)},{default:l(()=>[r(Ge,{value:"1"},{default:l(()=>[r(Fe,null,{default:l(()=>[I(" Email History ")]),_:1}),r($e,null,{default:l(()=>[r(Be,{items:f.value,headers:v.value,"show-expand":!0,"item-value":"EmailUUID",expanded:A.value,"onUpdate:expanded":C[5]||(C[5]=L=>A.value=L),"sort-by":d.value,"onUpdate:sortBy":C[6]||(C[6]=L=>d.value=L)},{"expanded-row":l(({columns:L,item:q})=>[w("tr",null,[w("td",{colspan:L.length},[dn,w("div",{class:"communicationsViewEmailPreview",innerHTML:q.HTML},null,8,cn)],8,un)])]),"footer.prepend":l(()=>[r(F,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:R},{default:l(()=>[I("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0)],64))}}),vn=B({__name:"Emails",props:{allowSending:{type:Boolean,default:!0},expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!0},registration:{},textClass:{default:""}},setup(e){const o=S(!1);return(t,a)=>(n(),T(N,null,[r(Pe,null,{default:l(()=>[t.showTitle?(n(),D(be,{key:0},{default:l(()=>[r(Re,null,{default:l(()=>[I(" E-Mails (#"+y(t.registration.Reference)+" "+y(t.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})):V("",!0),r(we,{class:Te(t.textClass)},{default:l(()=>[t.allowSending?(n(),D(Y,{key:0},{default:l(()=>[r(P,{cols:"12"},{default:l(()=>[r(F,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:a[0]||(a[0]=i=>o.value=!0)},{default:l(()=>[I(" Prepare Email ")]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1},8,["class"])]),_:1}),r(mn,{registration:t.registration,expanded:t.expanded,"hide-history":t.hideHistory,"show-editor":o.value,onCloseEditor:a[1]||(a[1]=i=>o.value=!1)},null,8,["registration","expanded","hide-history","show-editor"])],64))}}),fn=B({__name:"EditNoteCategoryDialog",props:x({convention:{},noteCategory:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["update:noteCategory"],["update:modelValue"]),setup(e,{emit:o}){const t=e,{title:a=""}=t,i=o,c=j(e,"modelValue"),E=Ve(t,i,void 0,void 0,"noteCategory"),s=S(ee(E.value));ne(E,()=>{s.value=ee(E.value)});const u=()=>{c.value=!1},m=()=>{s.value=ee(E.value)},A=()=>{E.value=s.value};return(f,v)=>(n(),D(Ee,{modelValue:c.value,"onUpdate:modelValue":v[2]||(v[2]=d=>c.value=d),onReset:m,onSave:A,title:U(a),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0},{default:l(()=>[r(se,{class:"pa-0",fluid:!0},{default:l(()=>[r(Y,null,{default:l(()=>[r(P,{cols:"12",sm:"6",md:"4"},{default:l(()=>[r(re,{modelValue:s.value.Name,"onUpdate:modelValue":v[0]||(v[0]=d=>s.value.Name=d),label:"Internal name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(P,{cols:"12",sm:"6",md:"4"},{default:l(()=>[r(Ft,{modelValue:s.value.Groups,"onUpdate:modelValue":v[1]||(v[1]=d=>s.value.Groups=d),convention:f.convention,label:"Groups",variant:"outlined","hide-details":""},null,8,["modelValue","convention"])]),_:1})]),_:1})]),_:1})]),actions:l(()=>[r(F,{color:"blue-darken-1",variant:"text",onClick:u},{default:l(()=>[I(" Cancel ")]),_:1}),r(F,{color:"blue-darken-1",variant:"text",onClick:m},{default:l(()=>[I(" Reset ")]),_:1}),r(_e),r(F,{color:"blue-darken-1",variant:"text",onClick:A},{default:l(()=>[I(" Save ")]),_:1})]),_:1},8,["modelValue","title"]))}}),An=()=>{const e=S(""),o=()=>{const t={x:window.innerWidth,y:window.innerHeight};t.x<600?e.value="xs":t.x>=600&&t.x<960?e.value="sm":t.x>=960&&t.x<1280?e.value="md":t.x>=1280&&t.x<1920?e.value="lg":t.x>=1920&&t.x<2560?e.value="xl":t.x>=2560&&(e.value="xxl")};return window.addEventListener("resize",o),o(),e},Tn={style:{"list-style":"none"}},En=B({__name:"NoteCategories",props:{hideHistory:{type:Boolean},convention:{},showEditor:{type:Boolean}},emits:["close"],setup(e,{emit:o}){const t=te(),a=o,i=S(!1),c=S(!1),E=S(""),s=S([]),u=S([{key:"Name",title:"Name"},{key:"Groups",title:"Groups"},{key:"actions",title:"",sortable:!1}]),m=An();S([{key:"CreatedAt",order:"asc"}]);const A=()=>({ID:0,NoteCategoryUUID:ge(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"",Groups:[],Notes:[]}),f=S(-1),v=S(A()),d=S(A()),_=()=>{d.value.NoteCategoryUUID=ge(),v.value=Object.assign({},A()),f.value=-1,i.value=!0},R=G=>{f.value=s.value.indexOf(G),v.value=Object.assign({},G),i.value=!0},k=G=>{f.value=s.value.indexOf(G),v.value=Object.assign({},G),c.value=!0},O=()=>{t.deleteNoteCategory(v.value.NoteCategoryUUID).then(G=>{G&&(s.value.splice(f.value,1),C())})},g=()=>{i.value=!1,ye(()=>{v.value=Object.assign({},d.value),f.value=-1})},C=()=>{c.value=!1,ye(()=>{v.value=Object.assign({},d.value),f.value=-1})},L=()=>{t.saveNoteCategory(v.value).then(G=>{G&&(f.value>-1?Object.assign(s.value[f.value],G):s.value.push(G),g())})};return(()=>{t.getNoteCategories(e.convention.ConventionUUID).then(G=>{G&&(s.value=G)})})(),(G,W)=>(n(),D(Be,{headers:u.value,items:s.value,"sort-by":[{key:"calories",order:"asc"}],class:"elevation-1"},{top:l(()=>[r(Gt,{color:"primary"},Me({default:l(()=>[r(Bt,null,{default:l(()=>[I("Note Categories")]),_:1}),r(Ht,{class:"mx-4 d-none d-sm-inline-flex",inset:!0,vertical:!0}),r(_e,{class:"d-none d-sm-inline-flex"}),U(m)!="xs"?(n(),D(F,{key:0,dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:_},{default:l(()=>[I(" New Item ")]),_:1})):V("",!0),r(F,{dark:"",class:"mb-2",icon:"mdi:mdi-window-close",onClick:W[0]||(W[0]=z=>a("close"))}),r($t,{modelValue:c.value,"onUpdate:modelValue":W[1]||(W[1]=z=>c.value=z),onDelete:O},null,8,["modelValue"])]),_:2},[U(m)=="xs"?{name:"extension",fn:l(()=>[r(_e),r(F,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:_},{default:l(()=>[I(" New Item ")]),_:1})]),key:"0"}:void 0]),1024),i.value?(n(),D(fn,{key:0,modelValue:i.value,"onUpdate:modelValue":W[2]||(W[2]=z=>i.value=z),"note-category":v.value,"onUpdate:noteCategory":[W[3]||(W[3]=z=>v.value=z),L],title:E.value,convention:G.convention},null,8,["modelValue","note-category","title","convention"])):V("",!0)]),"item.Groups":l(({item:z})=>[w("ul",Tn,[(n(!0),T(N,null,H(z.Groups,b=>(n(),T("li",{key:b.GroupUUID,class:"py-1"},y(b.Name),1))),128))])]),"item.actions":l(({item:z})=>[r(ue,{size:"small",class:"me-2",onClick:b=>R(z)},{default:l(()=>[I(" mdi:mdi-pencil ")]),_:2},1032,["onClick"]),r(ue,{size:"small",onClick:b=>k(z)},{default:l(()=>[I(" mdi:mdi-delete ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"]))}}),_n=B({__name:"SelectNoteCategories",props:x({convention:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:x(["change"],["update:modelValue"]),setup(e,{emit:o}){const t=j(e,"modelValue"),a=o,i=S([]),c=te(),E=S([]),s=S(""),u=S(0),m=K(()=>[...E.value].map(v=>({title:v.Name,value:i.value.find(d=>d.NoteCategoryUUID===v.NoteCategoryUUID)||v})));return typeof e.convention=="object"?s.value=e.convention.ConventionUUID:s.value=e.convention||"",(async()=>{const f=[];s.value&&f.push(c.getNoteCategories(s.value));const v=await Promise.all(f);if(s.value&&v.length==1&&(E.value=v[0].sort((d,_)=>d.Name.localeCompare(_.Name))),Array.isArray(t.value))u.value=2,m.value.forEach(d=>{Array.isArray(t.value)&&t.value.find(R=>R.NoteCategoryUUID===d.value.NoteCategoryUUID)&&i.value.push(d.value)});else if(typeof t.value=="string"){u.value=1;try{const d=JSON.parse(t.value);m.value.forEach(_=>{d.find(k=>k.NoteCategoryUUID===_.value.NoteCategoryUUID)&&i.value.push(_.value)})}catch{}}})(),ne(i,()=>{switch(u.value){default:case 2:{t.value=i.value,a("change");break}case 1:{t.value=JSON.stringify(i.value),a("change");break}}}),(f,v)=>(n(),D(at,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=d=>i.value=d),chips:f.chips,multiple:"",label:f.label||"Tags",variant:f.variant||"solo",hint:f.hint,"persistent-hint":!0,clearable:f.clearable,items:m.value,"item-title":"title","item-value":"value"},null,8,["modelValue","chips","label","variant","hint","clearable","items"]))}}),Un=B({__name:"EditNoteDialog",props:x({convention:{},note:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["update:note","saved"],["update:modelValue"]),setup(e,{emit:o}){const t=e,{title:a=""}=t,i=te(),c=o,E=j(e,"modelValue"),s=Ve(t,c,void 0,void 0,"note"),u=S(ee(s.value));ne(s,()=>{u.value=ee(s.value)});const m=()=>{u.value=ee(s.value)},A=f=>{u.value.NoteCategories===null&&(u.value.NoteCategories=[]),u.value.CreatedAt=void 0,u.value.DeletedAt=void 0,u.value.UpdatedAt=void 0,u.value.Admin=void 0,u.value.AdminID=void 0,u.value.AdminUUID=void 0,i.saveNote(u.value).then(v=>{v?(u.value=ee(v),f&&f("Note Saved"),s.value=u.value,c("saved",s.value)):f&&f("Internal Error Saving Note")}).catch(v=>{f&&f("Error Saving Note:"+v.ErrorMessage)})};return(f,v)=>u.value?(n(),D(Ee,{key:0,"card-class":"pa-4",modelValue:E.value,"onUpdate:modelValue":v[3]||(v[3]=d=>E.value=d),onReset:m,onSave:A,title:U(a),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0,"show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:l(()=>[r(se,{class:"pa-0",fluid:!0},{default:l(()=>[r(Y,null,{default:l(()=>[r(P,{cols:"12"},{default:l(()=>[r(_n,{modelValue:u.value.NoteCategories,"onUpdate:modelValue":v[0]||(v[0]=d=>u.value.NoteCategories=d),convention:f.convention,label:"Categories",variant:"outlined","hide-details":"",chips:!0},null,8,["modelValue","convention"])]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12"},{default:l(()=>[r(re,{modelValue:u.value.Subject,"onUpdate:modelValue":v[1]||(v[1]=d=>u.value.Subject=d),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(P,{cols:"12"},{default:l(()=>[r(it,{modelValue:u.value.Description,"onUpdate:modelValue":v[2]||(v[2]=d=>u.value.Description=d),label:"Note",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])):V("",!0)}}),gn=B({__name:"Notes",props:{allowAdding:{type:Boolean,default:!0},cardClass:{default:""},convention:{},expanded:{type:Boolean,default:!0},hideHistory:{type:Boolean},registration:{},showControlPanel:{type:Boolean,default:!0},showEditor:{type:Boolean},showTitle:{type:Boolean,default:!0},textClass:{default:""}},setup(e){const o=te(),t=()=>({ID:0,NoteUUID:ge(),Description:"",NoteCategories:[],Registration:e.registration,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Subject:""}),a=S(!1),i=S(!1),c=S([]),E=S([]),s=S(t()),u=()=>{s.value=t(),a.value=!0},m=v=>{s.value=v,a.value=!0},A=()=>{o.getRegistrationNotes(e.registration.RegistrationUUID).then(v=>{v&&(v.forEach(d=>{d.CreatedAt=Ie(new Date(d.CreatedAt||"")),d.Admin||(d.Admin={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),c.value=v,e.expanded&&(E.value=v.map(d=>d.NoteUUID)))})},f=()=>{A(),setTimeout(()=>{a.value=!1},2e3)};return A(),(v,d)=>(n(),T(N,null,[r(Pe,{class:Te(v.cardClass)},{default:l(()=>[r(be,null,{default:l(()=>[r(Re,null,{default:l(()=>[r(Y,{class:"flex-row-reverse"},{default:l(()=>[v.showControlPanel?(n(),D(P,{key:0,class:"text-right flex-shrink-1 flex-grow-0",style:{"flex-grow":"0 !important"}},{default:l(()=>[r(F,{class:"d-sm-none",size:"xs",icon:"mdi:mdi-cog",variant:"text",color:"warning",onClick:d[0]||(d[0]=_=>i.value=!0)}),r(F,{class:"d-none d-sm-inline-flex","prepend-icon":"mdi:mdi-cog",variant:"text",color:"warning",onClick:d[1]||(d[1]=_=>i.value=!0)},{default:l(()=>[I("Categories")]),_:1})]),_:1})):V("",!0),v.showTitle?(n(),D(P,{key:1,class:"text-wrap flex-grow-1"},{default:l(()=>[I(" Notes (#"+y(v.registration.Reference)+" "+y(v.registration.User.DisplayName)+") ",1)]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1}),r(we,{class:Te(v.textClass)},{default:l(()=>[c.value.length===0?(n(),T(N,{key:0},[I(" No Notes Recorded ")],64)):(n(),D(He,{key:1,multiple:!0,variant:"accordion",modelValue:E.value,"onUpdate:modelValue":d[2]||(d[2]=_=>E.value=_)},{default:l(()=>[(n(!0),T(N,null,H(c.value,_=>(n(),D(Ge,{key:`${_.NoteUUID}.${_.UpdatedAt}`,value:_.NoteUUID},{default:l(()=>[r(Fe,{class:"py-0"},{default:l(()=>[I(y(_.Subject)+" ",1),r(xt,{class:"ml-4"},{default:l(()=>[_.NoteCategories.length===0?(n(),D(Oe,{key:0},{default:l(()=>[I(" Global ")]),_:1})):V("",!0),(n(!0),T(N,null,H(_.NoteCategories,R=>(n(),D(Oe,{key:R.NoteCategoryUUID},{default:l(()=>[I(y(R.Name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),r($e,null,{default:l(()=>[r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[I(y(_.Description),1)]),_:2},1024)]),_:2},1024),r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[I(y(U(ie)(_.UpdatedAt||""))+" ",1),_&&_.Admin&&_.Admin.DisplayName?(n(),T(N,{key:0},[I(" - "+y(_.Admin.DisplayName),1)],64)):V("",!0)]),_:2},1024),r(P,{class:"text-right"},{default:l(()=>[r(F,{color:"primary","prepend-icon":"mdi:mdi-pencil",onClick:R=>m(_)},{default:l(()=>[I("Edit")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["class"]),v.allowAdding?(n(),D(ot,{key:0},{default:l(()=>[r(F,{color:"primary",variant:"flat",onClick:u},{default:l(()=>[I("Add Note")]),_:1})]),_:1})):V("",!0)]),_:1},8,["class"]),r(qe,{modelValue:a.value,"onUpdate:modelValue":d[5]||(d[5]=_=>a.value=_),title:"Create Note"},{default:l(()=>[r(Un,{modelValue:a.value,"onUpdate:modelValue":d[3]||(d[3]=_=>a.value=_),note:s.value,"onUpdate:note":d[4]||(d[4]=_=>s.value=_),convention:v.convention,title:"Create Note",onSaved:f},null,8,["modelValue","note","convention"])]),_:1},8,["modelValue"]),r(qe,{modelValue:i.value,"onUpdate:modelValue":d[7]||(d[7]=_=>i.value=_),title:"Note Configuration"},{default:l(()=>[r(En,{convention:v.convention,onClose:d[6]||(d[6]=_=>i.value=!1)},null,8,["convention"])]),_:1},8,["modelValue"])],64))}}),Sn=B({__name:"StripeRefundPayment",props:x({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:x(["refunded"],["update:modelValue"]),setup(e,{emit:o}){const t=j(e,"modelValue"),a=o,i=te(),c=S(!1),E=S("");let s=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const d=e.paymentTransaction.Data.PaymentIntent;d&&(s=d.amount)}const u=S({Amount:s/100,Description:"",Reason:""}),m=S([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),A=S(!1);async function f(d){d.preventDefault(),A.value=!0,i.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,u.value).then(_=>{_?a("refunded",_):v("An unexpected error occurred.")}).catch(_=>{v("An error occurred processing the refund: "+_.toString())}),A.value=!1}const v=d=>{E.value=d,c.value=!0};return(d,_)=>(n(),D(Ee,{modelValue:t.value,"onUpdate:modelValue":_[7]||(_[7]=R=>t.value=R),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:l(()=>[r(se,{class:"pa-0"},{default:l(()=>[r(Yt,{ref:"refundForm",id:"refund-form",onSubmit:_[4]||(_[4]=St(R=>f(R),["prevent"]))},{default:l(()=>[r(Y,null,{default:l(()=>[r(P,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:l(()=>[r(re,{modelValue:u.value.Amount,"onUpdate:modelValue":_[0]||(_[0]=R=>u.value.Amount=R),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),r(P,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:l(()=>[r(Ue,{modelValue:u.value.Reason,"onUpdate:modelValue":_[1]||(_[1]=R=>u.value.Reason=R),modelModifiers:{number:!0},items:m.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),r(P,{cols:"12"},{default:l(()=>[r(re,{modelValue:u.value.Description,"onUpdate:modelValue":_[2]||(_[2]=R=>u.value.Description=R),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:l(()=>[r(F,{color:"error",class:"w-100",onClick:_[3]||(_[3]=R=>t.value=!1)},{default:l(()=>[I("Cancel")]),_:1})]),_:1}),r(_e),r(P,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:l(()=>[r(F,{type:"submit",color:"success",class:"w-100"},Me({default:l(()=>[I(" Issue Refund ")]),_:2},[A.value?{name:"prepend",fn:l(()=>[r(tt,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),r(nt,{modelValue:c.value,"onUpdate:modelValue":_[6]||(_[6]=R=>c.value=R)},{actions:l(()=>[r(F,{variant:"text",onClick:_[5]||(_[5]=R=>c.value=!1)},{default:l(()=>[I(" Close ")]),_:1})]),default:l(()=>[I(y(E.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Cn=["colspan"],Dn=w("strong",null,"Details",-1),yn=["innerHTML"],In=B({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},expanded:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:o}){const t=e;let{expanded:a=!0,hideHistory:i=!1,registration:c,showEditor:E}=t;const s=te(),u=S([]),m=S(a?["1"]:[]),A=S([]),f=S([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),v=S(!1),d=S(),_=S(!1),R=S(""),k=S([{key:"CreatedAt",order:"asc"}]),O=o,g=()=>({PaymentTransactionUUID:ge(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:c.ID,RegistrationUUID:c.RegistrationUUID,Source:Ke.PAYMENT_TRANSACTION_SOURCE_NULL,Type:je.PAYMENT_TRANSACTION_TYPE_NULL}),C=S(g()),{convertTransactions:L,getPaymentTransactionsDisplay:q}=Nt();ne(t,()=>{i=t.hideHistory,c=t.registration,E=t.showEditor,q(c.RegistrationUUID).then(M=>{A.value=M})});const G=()=>{q(c.RegistrationUUID).then(M=>{A.value=M})};G();const W=()=>{s.saveRegistrationPaymentTransaction(C.value).then(M=>{M&&(L(M.PaymentTransactions),C.value=g(),O("close-editor"),O("change"))})},z=M=>{const h=A.value.find(p=>p.PaymentTransactionUUID===M);h&&(d.value=h.PaymentTransaction,v.value=!0)},b=M=>{if(M)try{A.value=L(M.PaymentTransactions),d.value=void 0,v.value=!1,R.value="Refund Processed",_.value=!0,O("change")}catch(h){console.error(h)}};return(M,h)=>(n(),T(N,null,[U(E)?(n(),T(N,{key:0},[r(Re,null,{default:l(()=>[I(" Add Transaction ")]),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12",sm:"6"},{default:l(()=>[r(Ue,{items:U(Rt),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:C.value.Type,"onUpdate:modelValue":h[0]||(h[0]=p=>C.value.Type=p),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),r(P,{cols:"12",sm:"6"},{default:l(()=>[r(Ue,{items:U(ht),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:C.value.Source,"onUpdate:modelValue":h[1]||(h[1]=p=>C.value.Source=p),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12",sm:"8",md:"10"},{default:l(()=>[r(re,{label:"Description","hide-details":"",modelValue:C.value.Description,"onUpdate:modelValue":h[2]||(h[2]=p=>C.value.Description=p),variant:"outlined"},null,8,["modelValue"])]),_:1}),r(P,{cols:"12",sm:"4",md:"2"},{default:l(()=>[r(re,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:C.value.Amount,"onUpdate:modelValue":h[3]||(h[3]=p=>C.value.Amount=p),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),r(Y,null,{default:l(()=>[r(P,{cols:"12",sm:"3",md:"2",lg:"1"},{default:l(()=>[r(F,{class:"w-100",onClick:h[4]||(h[4]=p=>O("close-editor")),color:"warning"},{default:l(()=>[I("Cancel")]),_:1})]),_:1}),r(_e),r(P,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:l(()=>[r(F,{class:"w-100",onClick:W,color:"primary"},{default:l(()=>[I("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):V("",!0),A.value.length&&!U(i)?(n(),D(He,{key:1,class:"my-2",modelValue:m.value,"onUpdate:modelValue":h[10]||(h[10]=p=>m.value=p)},{default:l(()=>[r(Ge,{value:"1"},{default:l(()=>[r(Fe,null,{default:l(()=>[I(" Transaction History ")]),_:1}),r($e,null,{default:l(()=>[r(Be,{items:A.value,headers:f.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:u.value,"onUpdate:expanded":h[5]||(h[5]=p=>u.value=p),"sort-by":k.value,"onUpdate:sortBy":h[6]||(h[6]=p=>k.value=p),class:"transactionTable"},{"item.Controls":l(({item:p})=>[M.canEdit&&p.PaymentTransaction&&p.PaymentTransaction.Source===U(Ke).PAYMENT_TRANSACTION_SOURCE_STRIPE&&p.PaymentTransaction.Type===U(je).PAYMENT_TRANSACTION_TYPE_PAYMENT?(n(),D(F,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:$=>z(p.PaymentTransactionUUID)},null,8,["onClick"])):V("",!0)]),"expanded-row":l(({columns:p,item:$})=>[w("tr",null,[w("td",{colspan:p.length},[Dn,w("div",{innerHTML:$.Data},null,8,yn)],8,Cn)])]),"footer.prepend":l(()=>[r(F,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:G},{default:l(()=>[I("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),v.value&&d.value?(n(),D(Sn,{key:0,modelValue:v.value,"onUpdate:modelValue":h[7]||(h[7]=p=>v.value=p),"payment-transaction":d.value,onRefunded:b},null,8,["modelValue","payment-transaction"])):V("",!0),r(nt,{modelValue:_.value,"onUpdate:modelValue":h[9]||(h[9]=p=>_.value=p)},{actions:l(()=>[r(F,{variant:"text",onClick:h[8]||(h[8]=p=>_.value=!1)},{default:l(()=>[I(" Close ")]),_:1})]),default:l(()=>[I(y(R.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0)],64))}}),pn=B({__name:"DataPanelRegistrationTags",props:x({registration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=j(e,"modelValue"),t=K(()=>{if(!o.value.Meta.Tags||!Array.isArray(o.value.Meta.Tags))return e.registration.Tags;const i=o.value.Meta.Tags;return i.length===0?e.registration.Tags:e.registration.Tags.filter(c=>i.includes(c.TagUUID))}),a=K(()=>o.value.Meta.TagColour?o.value.Meta.TagColour:"");return(i,c)=>(n(!0),T(N,null,H(t.value,E=>(n(),D(Oe,{key:E.TagUUID,color:a.value,class:"ma-1"},{default:l(()=>[I(y(E.Title),1)]),_:2},1032,["color"]))),128))}}),Rn=ke(pn,[["__scopeId","data-v-644b07d0"]]),hn=w("span",{class:"font-weight-bold pr-2"},"Status:",-1),Nn={key:0,class:"text-green-darken-2"},On={key:1,class:"text-yellow-darken-4"},kn={key:2,class:"text-red-darken-4"},Mn=w("br",null,null,-1),Vn=w("span",{class:"font-weight-bold pr-2"},"Status:",-1),Ln={key:0,class:"text-green-darken-2"},bn={key:1,class:"text-yellow-darken-4"},wn={key:2,class:"text-red-darken-4"},Pn=w("span",null,"Not Checked In",-1),We=B({__name:"DataPanelCheckIn",props:x({convention:{},showControls:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=j(e,"modelValue"),t=te(),a=Se(),i=rt(a,e.convention),c=S([]),E=S(!1),s=S(!1),u=S(Q.CHECK_IN_STATUS_PENDING),m=S(""),A=R=>{E.value=!0,u.value=R},f=()=>{v()},v=()=>{t.getCheckInHistory(o.value.RegistrationUUID).then(R=>{R&&(c.value=R,s.value=!0,R.length&&(o.value.CheckIn=R[0]))}).catch(()=>{})},d=R=>{t.saveCheckIn(o.value.RegistrationUUID,u.value,m.value).then(k=>{k?(o.value.CheckIn=k,R&&(R("Check In Saved"),setTimeout(()=>{E.value=!1},500))):R&&R("Check In Failed")}).catch(()=>{R&&R("Check In Failed")})},_=K(()=>{switch(u.value){case Q.CHECK_IN_STATUS_REVOKED:return"yellow-darken-4";case Q.CHECK_IN_STATUS_REJECTED:return"red-darken-4";case Q.CHECK_IN_STATUS_COMPLETED:return"green-darken-2"}return""});return(R,k)=>(n(),T(N,null,[R.showControls&&U(i)?(n(),D(se,{key:0,class:"px-0"},{default:l(()=>[r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[r(F,{color:"error",class:"w-100","prepend-icon":"mdi:mdi-window-close",onClick:k[0]||(k[0]=O=>A(U(Q).CHECK_IN_STATUS_REJECTED))},{default:l(()=>[I(" Reject ")]),_:1})]),_:1}),r(P,null,{default:l(()=>[r(F,{color:"warning",class:"w-100","prepend-icon":"mdi:mdi-window-close",onClick:k[1]||(k[1]=O=>A(U(Q).CHECK_IN_STATUS_REVOKED))},{default:l(()=>[I(" Revoke ")]),_:1})]),_:1}),r(P,null,{default:l(()=>[r(F,{color:"success",class:"w-100","prepend-icon":"mdi:mdi-check",onClick:k[2]||(k[2]=O=>A(U(Q).CHECK_IN_STATUS_COMPLETED))},{default:l(()=>[I(" Approve ")]),_:1})]),_:1})]),_:1}),r(Ee,{modelValue:E.value,"onUpdate:modelValue":k[4]||(k[4]=O=>E.value=O),color:_.value,fullscreen:!1,"hide-extension":!0,persistent:!1,scrollable:!1,"show-close-action":!0,"show-save-action":!0,"save-button-label":"Confirm",title:`${U(ce)(u.value)} Check-In`,onSave:d},{default:l(()=>[r(it,{modelValue:m.value,"onUpdate:modelValue":k[3]||(k[3]=O=>m.value=O),label:"Notes",variant:"outlined"},null,8,["modelValue"])]),_:1},8,["modelValue","color","title"])]),_:1})):V("",!0),o.value.CheckIn?(n(),D(se,{key:1,class:"px-0"},{default:l(()=>[r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[hn,o.value.CheckIn.Status===U(Q).CHECK_IN_STATUS_COMPLETED?(n(),T("span",Nn,y(U(ce)(o.value.CheckIn.Status)),1)):o.value.CheckIn.Status===U(Q).CHECK_IN_STATUS_REVOKED?(n(),T("span",On,y(U(ce)(o.value.CheckIn.Status)),1)):o.value.CheckIn.Status===U(Q).CHECK_IN_STATUS_REJECTED?(n(),T("span",kn,y(U(ce)(o.value.CheckIn.Status)),1)):V("",!0),Mn,r(F,{style:{"font-size":"0.75rem","text-transform":"none"},"append-icon":"mdi:mdi-chevron-down",size:"xs",variant:"text",onClick:f},{default:l(()=>[I("History")]),_:1})]),_:1}),r(P,{class:"text-right"},{default:l(()=>{var O;return[w("small",null,y((O=o.value.CheckIn.Admin)==null?void 0:O.DisplayName)+" "+y(U(Ie)(o.value.CheckIn.CreatedAt||"")),1)]}),_:1})]),_:1}),r(Ee,{modelValue:s.value,"onUpdate:modelValue":k[5]||(k[5]=O=>s.value=O),fullscreen:!1,"hide-extension":!0,persistent:!1,scrollable:!0,"show-close-action":!0,"show-save-action":!1,title:"Check-In History"},{default:l(()=>[r(fe,null,{default:l(()=>[(n(!0),T(N,null,H(c.value,O=>(n(),D(Ae,{key:O.CheckInUUID},{default:l(()=>[r(Ne,null,{default:l(()=>[r(Y,null,{default:l(()=>[r(P,null,{default:l(()=>[Vn,O.Status===U(Q).CHECK_IN_STATUS_COMPLETED?(n(),T("span",Ln,y(U(ce)(O.Status)),1)):O.Status===U(Q).CHECK_IN_STATUS_REVOKED?(n(),T("span",bn,y(U(ce)(O.Status)),1)):O.Status===U(Q).CHECK_IN_STATUS_REJECTED?(n(),T("span",wn,y(U(ce)(O.Status)),1)):V("",!0)]),_:2},1024),r(P,{class:"text-right"},{default:l(()=>{var g;return[w("small",null,y((g=O.Admin)==null?void 0:g.DisplayName)+" "+y(U(Ie)(O.CreatedAt||"")),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024),O.Details?(n(),D(Ot,{key:0},{default:l(()=>[I(y(O.Details),1)]),_:2},1024)):V("",!0)]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1})):(n(),D(se,{key:2,class:"px-0"},{default:l(()=>[Pn]),_:1}))],64))}}),Fn=B({__name:"MetaDataItem",props:x({accommodations:{},convention:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:x(["openActions","showForm"],["update:modelValue","update:registration"]),setup(e,{emit:o}){const t=j(e,"modelValue"),a=j(e,"registration"),i=o,c=s=>{i("openActions",s)},E=(s,u,m)=>{i("showForm",s,u,m)};return(s,u)=>t.value.MetaField===U(J).META_DATA_SOURCE_ACCOMMODATION_ALLOCATION?(n(),D(st,{key:0,convention:s.convention,tickets:s.tickets,accommodations:s.accommodations,venues:s.venues,registration:a.value,forms:s.forms,modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=m=>t.value=m),data:""},null,8,["convention","tickets","accommodations","venues","registration","forms","modelValue"])):t.value.MetaField===U(J).META_DATA_SOURCE_BADGE_DISPLAY?(n(),D(ut,{key:1,"card-class":s.itemClass,convention:s.convention,registration:a.value,"show-title":!1,"hide-download":t.value.Meta.HideDownloadButton,"hide-nfc":t.value.Meta.HideNFCButton},null,8,["card-class","convention","registration","hide-download","hide-nfc"])):t.value.MetaField===U(J).META_DATA_SOURCE_EMAILS?(n(),D(vn,{key:2,"allow-sending":!1,expanded:!1,"show-title":!1,registration:a.value,"text-class":"pa-0 ma-0"},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_NOTES?(n(),D(gn,{key:3,"allow-adding":!0,"card-class":s.itemClass,convention:s.convention,expanded:!1,registration:a.value,"show-control-panel":!1,"show-title":!1,"text-class":"pa-0 ma-0"},null,8,["card-class","convention","registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_PAYMENT_STATUS?(n(),D(ja,{key:4,registration:a.value},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_PAYMENTS?(n(),D(In,{key:5,registration:a.value,expanded:!1},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_ACTIONS?(n(),D(F,{key:6,icon:"mdi:mdi-briefcase",variant:"flat",onClick:u[1]||(u[1]=m=>c(a.value))})):t.value.MetaField===U(J).META_DATA_SOURCE_SUBMISSION_STATUS||t.value.MetaField===U(J).META_DATA_SOURCE_ACCOMMODATION_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_ADMIN_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_DEALER_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_BADGE_FORM||t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_FORM?(n(),D(Fa,{key:7,convention:s.convention,forms:s.forms,registration:a.value,onShowForm:E},null,8,["convention","forms","registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_GROUP?(n(),D(ba,{key:8,registration:a.value},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_REGISTRATION_REFERENCE?(n(),T(N,{key:9},[I(y(a.value.Reference),1)],64)):t.value.MetaField===U(J).META_DATA_SOURCE_SUBMISSION_DATE?(n(),D(wa,{key:10,registration:a.value},null,8,["registration"])):t.value.MetaField===U(J).META_DATA_SOURCE_TAGS?(n(),D(Rn,{key:11,registration:a.value,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=m=>t.value=m)},null,8,["registration","modelValue"])):t.value.MetaField===U(J).META_DATA_SOURCE_CHECKIN_CONTROL?(n(),D(We,{key:12,convention:s.convention,"show-controls":!0,modelValue:a.value,"onUpdate:modelValue":u[3]||(u[3]=m=>a.value=m)},null,8,["convention","modelValue"])):t.value.MetaField===U(J).META_DATA_SOURCE_CHECKIN_STATUS?(n(),D(We,{key:13,convention:s.convention,"show-controls":!1,modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=m=>a.value=m)},null,8,["convention","modelValue"])):(n(),T(N,{key:14},[I(" Unhandled Meta Item "+y(t.value),1)],64))}}),$n=B({__name:"UserDataItem",props:x({accommodations:{},convention:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:["update:modelValue","update:registration"],setup(e){const o=j(e,"modelValue"),t=j(e,"registration"),a=Le(),i=K(()=>a.GetProfileImageURL(t.value.UserUUID));return(c,E)=>o.value.UserField===U(ve).USER_DATA_SOURCE_TELEGRAM&&t.value.User.Handle?(n(),T(N,{key:0},[I(" @"+y(t.value.User.Handle),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_AVATAR?(n(),D(lt,{key:1,class:"rounded-circle",src:i.value,height:"32",width:"32"},null,8,["src"])):o.value.UserField===U(ve).USER_DATA_SOURCE_DATE_OF_BIRTH?(n(),T(N,{key:2},[I(y(U(ie)(t.value.User.Additional.DOB,{withYear:!0,withDay:!1})),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_EMAIL?(n(),T(N,{key:3},[I(y(t.value.User.Additional.Email),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_FIRST_NAME?(n(),T(N,{key:4},[I(y(t.value.User.Additional.FirstName),1)],64)):o.value.UserField===U(ve).USER_DATA_SOURCE_LAST_NAME?(n(),T(N,{key:5},[I(y(t.value.User.Additional.LastName),1)],64)):(n(),T(N,{key:6},[I(" Unhandled User Field "+y(o.value),1)],64))}}),Ze=B({__name:"PanelItem",props:x({accommodations:{},convention:{},extras:{},forms:{},interests:{},itemClass:{},tickets:{},venues:{}},{modelValue:{required:!0},modelModifiers:{},registration:{required:!0},registrationModifiers:{}}),emits:x(["openActions","showForm"],["update:modelValue","update:registration"]),setup(e,{emit:o}){const t=j(e,"modelValue"),a=j(e,"registration"),i=o,c=s=>{i("openActions",s)},E=(s,u,m)=>{i("showForm",s,u,m)};return(s,u)=>t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_FORM?(n(),D(ka,{key:0,accommodations:s.accommodations,convention:s.convention,extras:s.extras,forms:s.forms,interests:s.interests,"item-class":s.itemClass,tickets:s.tickets,venues:s.venues,modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=m=>t.value=m),registration:a.value,"onUpdate:registration":u[1]||(u[1]=m=>a.value=m)},null,8,["accommodations","convention","extras","forms","interests","item-class","tickets","venues","modelValue","registration"])):t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_META?(n(),D(Fn,{key:1,accommodations:s.accommodations,convention:s.convention,forms:s.forms,interests:s.interests,"item-class":s.itemClass,tickets:s.tickets,venues:s.venues,modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=m=>t.value=m),registration:a.value,"onUpdate:registration":u[3]||(u[3]=m=>a.value=m),onOpenActions:c,onShowForm:E},null,8,["accommodations","convention","forms","interests","item-class","tickets","venues","modelValue","registration"])):t.value.SourceType===U(De).LAYOUT_ITEM_SOURCE_USER?(n(),D($n,{key:2,accommodations:s.accommodations,convention:s.convention,forms:s.forms,interests:s.interests,"item-class":s.itemClass,tickets:s.tickets,venues:s.venues,modelValue:t.value,"onUpdate:modelValue":u[4]||(u[4]=m=>t.value=m),registration:a.value,"onUpdate:registration":u[5]||(u[5]=m=>a.value=m)},null,8,["accommodations","convention","forms","interests","item-class","tickets","venues","modelValue","registration"])):V("",!0)}}),Bn=["onClick"],Gn=["onClick"],Mo=B({__name:"PanelLayout",props:x({accommodations:{},convention:{},extras:{},forms:{},interests:{},tickets:{},venues:{}},{layout:{required:!0},layoutModifiers:{},modelValue:{required:!0},modelModifiers:{}}),emits:x(["openActions","showForm"],["update:layout","update:modelValue"]),setup(e,{emit:o}){const t=Ct(),a=o,i=j(e,"layout"),c=j(e,"modelValue"),E=S({});i.value&&i.value.Panels&&i.value.Panels.forEach(f=>{E.value[f.LayoutPanelUUID]=!1});const s=f=>{a("openActions",f)},u=(f,v,d)=>{a("showForm",f,v,d)},m=f=>{switch(f.PanelStyle){case oe.PANEL_STYLE_NAV_BOTTOM:return"bottom";case oe.PANEL_STYLE_NAV_LEFT:return"left";case oe.PANEL_STYLE_NAV_RIGHT:return"right";case oe.PANEL_STYLE_NAV_TOP:return"top"}},A=(f,v=!1)=>{switch(f.PanelStyle){case oe.PANEL_STYLE_NAV_BOTTOM:return v?"mdi:mdi-chevron-double-down":"mdi:mdi-chevron-double-up";case oe.PANEL_STYLE_NAV_LEFT:return v?"mdi:mdi-chevron-double-left":"mdi:mdi-chevron-double-right";case oe.PANEL_STYLE_NAV_RIGHT:return v?"mdi:mdi-chevron-double-right":"mdi:mdi-chevron-double-left";case oe.PANEL_STYLE_NAV_TOP:return v?"mdi:mdi-chevron-double-up":"mdi:mdi-chevron-double-down"}};return Dt(()=>{if(!i.value||!i.value.RunnerLayoutUUID||i.value.RunnerLayoutUUID==Kt)return;yt.getInstance().emit("layout_opened",{AdminLayoutUUID:i.value.AdminLayoutUUID,RegistrationUUID:c.value.RegistrationUUID})}),(f,v)=>(n(),T(N,null,[(n(!0),T(N,null,H(i.value.Panels,d=>(n(),T(N,{key:d.LayoutPanelUUID},[m(d)!==void 0?(n(),D(Jt,{key:0,permanent:!0,location:m(d),border:U(t).smAndDown.value?1:0,rail:U(t).smAndDown.value&&!E.value[d.LayoutPanelUUID],"rail-width":"30",width:U(t).smAndDown.value?"100%":256,app:""},{default:l(()=>[U(t).smAndDown.value&&!E.value[d.LayoutPanelUUID]?(n(),T("h3",{key:0,class:Te(`bg-secondary fill-height ${m(d)==="top"||m(d)==="bottom"?"px-3 text-right":"py-3 text-left"}`),style:{cursor:"pointer"},onClick:_=>E.value[d.LayoutPanelUUID]=!0},[r(ue,{icon:A(d,!1)},null,8,["icon"])],10,Bn)):(n(),T(N,{key:1},[w("h3",{class:"bg-secondary pa-3 d-flex",style:Ye(U(t).smAndDown.value?"cursor: pointer;":""),onClick:_=>E.value[d.LayoutPanelUUID]=!1},[I(y(d.Name)+" ",1),U(t).smAndDown.value?(n(),T(N,{key:0},[r(_e),r(F,{icon:A(d,!0),variant:"plain",size:"sm"},null,8,["icon"])],64)):V("",!0)],12,Gn),r(fe,{class:"bg-panel overflow-y-auto",style:{height:"calc(100vh - 116px)"}},{default:l(()=>[(n(!0),T(N,null,H(d.Items,(_,R)=>(n(),D(Ae,{key:_.LayoutItemUUID},{default:l(()=>[d.Items.length>1?(n(),D(Ne,{key:0,class:"font-weight-bold"},{default:l(()=>[I(y(_.Label),1)]),_:2},1024)):V("",!0),r(Ze,{accommodations:f.accommodations,convention:f.convention,extras:f.extras,forms:f.forms,interests:f.interests,"item-class":"bg-panel border-0",tickets:f.tickets,venues:f.venues,modelValue:d.Items[R],"onUpdate:modelValue":k=>d.Items[R]=k,registration:c.value,onOpenActions:s,onShowForm:u},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)],64))]),_:2},1032,["location","border","rail","width"])):V("",!0)],64))),128)),r(jt,{class:"py-0"},{default:l(()=>[r(se,null,{default:l(()=>[r(Y,null,{default:l(()=>[(n(!0),T(N,null,H(i.value.Panels,d=>{var _,R,k,O,g,C;return n(),T(N,{key:d.LayoutPanelUUID},[d.PanelStyle===U(oe).PANEL_STYLE_FLEX?(n(),D(P,{key:0,cols:((_=d.Meta&&d.Meta.cols)==null?void 0:_.toString())||!1,xs:((R=d.Meta&&d.Meta.cols_xs)==null?void 0:R.toString())||!1,sm:((k=d.Meta&&d.Meta.cols_sm)==null?void 0:k.toString())||!1,md:((O=d.Meta&&d.Meta.cols_md)==null?void 0:O.toString())||!1,lg:((g=d.Meta&&d.Meta.cols_lg)==null?void 0:g.toString())||!1,xl:((C=d.Meta&&d.Meta.cols_xl)==null?void 0:C.toString())||!1,class:"pa-0 pa-sm-2"},{default:l(()=>[r(se,{class:"bg-panel",style:Ye(U(t).smAndUp.value?"border-radius: 15px;":"")},{default:l(()=>[w("h3",null,y(d.Name),1),r(fe,{class:"bg-panel"},{default:l(()=>[(n(!0),T(N,null,H(d.Items,(L,q)=>(n(),D(Ae,{key:L.LayoutItemUUID,class:"px-0"},{default:l(()=>[d.Items.length>1?(n(),D(Ne,{key:0,class:"font-weight-bold"},{default:l(()=>[I(y(L.Label),1)]),_:2},1024)):V("",!0),r(Ze,{accommodations:f.accommodations,convention:f.convention,extras:f.extras,forms:f.forms,interests:f.interests,"item-class":"bg-panel border-0",tickets:f.tickets,venues:f.venues,modelValue:d.Items[q],"onUpdate:modelValue":G=>d.Items[q]=G,registration:c.value,"onUpdate:registration":v[0]||(v[0]=G=>c.value=G),onOpenActions:s,onShowForm:u},null,8,["accommodations","convention","extras","forms","interests","tickets","venues","modelValue","onUpdate:modelValue","registration"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["style"])]),_:2},1032,["cols","xs","sm","md","lg","xl"])):V("",!0)],64)}),128))]),_:1})]),_:1})]),_:1})],64))}});class Hn extends It{constructor(t){super();Z(this,"iAmConnecting",!1);Z(this,"iAmClosing",!1);Z(this,"socket");Z(this,"timer");Z(this,"router");Z(this,"wsUri");this.timer={ping:void 0,reconnect:void 0,timeout:void 0},this.router=t.router,this.wsUri=t.wsUri,this.setupSocket()}destroy(){this.closeSocket(),this.clearTimers()}clearTimers(){this.timer&&(this.timer.ping&&clearInterval(this.timer.ping),this.timer.reconnect&&clearInterval(this.timer.reconnect),this.timer.timeout&&clearTimeout(this.timer.timeout))}closeSocket(){var t;if(this.iAmClosing=!0,this.socket){try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0}this.clearTimers()}pingSocket(){if(!this.socket){this.timer&&this.timer.ping&&clearInterval(this.timer.ping);return}this.socket.send(`PING ${new Date().getTime()}`)}send(t){var a;try{(a=this.socket)==null||a.send(t)}catch{this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3);return}}JSON(t){const a=JSON.stringify(t);this.send(a)}setupSocket(){if(!(!this.wsUri||this.iAmConnecting||this.iAmClosing)){if(this.iAmConnecting=!0,this.socket)try{this.socket.close()}catch{}this.socket=void 0;try{this.socket=new WebSocket(this.wsUri)}catch{if(!this.iAmClosing){this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3);return}}this.socket&&(this.socket.onopen=()=>{this.iAmConnecting=!1,this.emit("open"),this.setConnectionTimeout(),this.timer.ping=setInterval(()=>this.pingSocket(),1e4)},this.socket.onclose=()=>{var t;this.iAmConnecting=!1,this.emit("close");try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0,this.iAmClosing||(this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3))},this.socket.onerror=()=>{var t;this.iAmConnecting=!1,this.emit("error");try{(t=this.socket)==null||t.close()}catch{}this.socket=void 0,this.clearTimers(),this.timer.reconnect=setTimeout(()=>this.setupSocket(),2e3)},this.socket.onmessage=t=>{var i;const a=t.data;if(a.substring(0,4)==="PING"){(i=this.socket)==null||i.send(a.replace("PING","PONG"));return}if(a.substring(0,4)==="PONG"){this.setConnectionTimeout(!0);return}if(a.substring(0,1)==="{")this.router.processJSON(a);else{const c=a.match(/(?:[^\s"]+|"[^"]*")+/g);if(!c||c.length<1)throw new Error("invalid command",{cause:{msg:a,file:"socket.ts",line:113}});const E=c.shift();this.router.processCommand(E,...c.values())}this.emit("message",a)})}}setConnectionTimeout(t=!0){t&&clearTimeout(this.timer.timeout),this.timer.timeout=setTimeout(()=>{var a;if(this.socket)try{(a=this.socket)==null||a.close()}catch{}},15e3)}}const xn=e=>new Hn(e);class et extends Object{constructor(t){super(t);Z(this,"body","");Z(this,"params");Z(this,"socket");t!=null&&t.body&&this.setBody(t.body),t!=null&&t.params?this.params=t.params:this.params=new Map,this.socket=t.socket}BindJSON(){return JSON.parse(this.body)}setBody(t){this.body=t}get(t){return this.params.get(t)||""}set(t,a){this.params.set(t,a)}}class Yn extends Object{constructor(t){super(t);Z(this,"registry",new Map);Z(this,"socket");t!=null&&t.socket&&(this.socket=t.socket)}COMMAND(t,a){this.registry.set(t,a)}JSON(t,a){this.registry.set(t,a)}processCommand(t,...a){const i=new et({socket:this.socket});a.forEach((E,s)=>{i.params.set(s,E)});const c=this.registry.get(t);c&&c(i)}processJSON(t){const a=JSON.parse(t);if(!this.registry.has(a.Command))return;const i=new et({socket:this.socket});a.Data&&i.setBody(a.Data),a.Params&&(Object.getPrototypeOf(a)!=Map.prototype&&(a.Params=new Map(Object.entries(a.Params))),Object.getPrototypeOf(a.Params)==Map.prototype&&a.Params.forEach((E,s)=>{i.params.set(s,E)}));const c=this.registry.get(a.Command);c&&c(i)}}const Vo=e=>{const o=new Yn({});o.COMMAND("VALID_AUTH",()=>{var a;(a=o.socket)==null||a.emit("authenticated")}),o.COMMAND("INVALID_AUTH",()=>{var a;(a=o.socket)==null||a.emit("auth_failed")}),o.JSON("CLOSE",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("kicked",i)}),o.JSON("CONVENTION_DATA",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("convention_data",i)}),o.JSON("ERROR",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("error",i)}),o.JSON("JOINED",()=>{var a;(a=o.socket)==null||a.emit("joined")}),o.JSON("RUNNER_DATA",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("runner_data",i)}),o.JSON("RUNNER_CONNECTED",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("runner_connected",i)}),o.JSON("RUNNER_DISCONNECTED",a=>{var c;const i=a.BindJSON();(c=o.socket)==null||c.emit("runner_disconnected",i)}),o.JSON("STARTED",()=>{var a;(a=o.socket)==null||a.emit("started")});const t=xn({router:o,wsUri:e.wsUri});return o.socket=t,t},Kn=pt.getInstance(),Lo=()=>Kn;export{qt as A,ca as D,Ro as L,ho as M,No as P,Oo as U,Mo as _,Ta as a,_a as b,Da as c,We as d,In as e,ut as f,vn as g,gn as h,po as i,oe as j,J as k,De as l,Vo as m,Lo as n,ve as o,ko as u};
