import{i as O,r as i,q as g,v as e,z as J,B as N,y as V,C as l,x as n,F as G,D as m,f as t,A as p,U as z,P as K,l as Q,n as s,G as X,H as Y,_ as ee}from"./index-QgSUQDwF.js";import{s as I}from"./index-2XRRB2DS.js";import{S as x}from"./setupLogin-8N-V6jp-.js";import{E as u}from"./emailFormVariant-1EY2p0cn.js";import{V as ae}from"./VForm-yiu92J1G.js";import{a as _,V as C}from"./VRow-YydxPjZ2.js";import{V as P}from"./VTextField-KAVWSgOE.js";import{V as b,c as q}from"./VContainer-Xrl4l37f.js";import{G as te}from"./userData-Bgavvc6T.js";import{V as le,a as re,c as se,e as oe}from"./VCard-D6lGZoNj.js";import"./form-xBkTPQv7.js";import"./forwardRefs-SADT1Bm6.js";import"./createSimpleFunctional-RDhqjNtk.js";const y=h=>(X("data-v-afbed17d"),h=h(),Y(),h),ne={key:1,class:"ma-auto text-left"},ue={key:2,class:"ma-auto text-left"},ie={key:3,class:"ma-auto text-left"},de=y(()=>m("br",null,null,-1)),ce=y(()=>m("br",null,null,-1)),me={class:"text-red-darken-1 font-weight-bold"},fe=y(()=>m("br",null,null,-1)),ve=y(()=>m("br",null,null,-1)),pe=y(()=>m("br",null,null,-1)),_e=y(()=>m("span",{class:"text-red-darken-4"}," Please contact registration if you require further assistance. ",-1)),ge={class:"text-center mt-4"},he=O({__name:"EmailLoginForm",props:{variant:{default:()=>u.COMBINED}},setup(h){const E=z(),A=K(),k=i(!0),L=i(!1),T=i(!1),R=i(!1),o=i(""),w=i(""),M=i(!1),f=i({required:a=>!!a||"Required.",min:a=>a.length>=8||"Min 8 characters",email:a=>!!a.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),d=i(""),c=i(!1),B=new URL(location.href).searchParams.get("token")||"";B!==""&&(k.value=!1,R.value=!0,A.validateAccount(B,h.variant).then(({created:a,tokens:r,user:D})=>{try{x(r,D,E,a)}catch(v){console.error(v)}}).catch(a=>{console.error(a),d.value=a.ErrorMessage}));const F=()=>(d.value="",!(f.value.required(o.value)!==!0||f.value.email(o.value)!==!0||f.value.required(w.value)!==!0||f.value.min(w.value)!==!0)),$=a=>{if(a.preventDefault(),!F())return;const D=new URL(location.href).searchParams.get("state");c.value=!0,A.oAuthLogin("internal",o.value,w.value,D||"").then(({created:v,tokens:j,user:H})=>{x(j,H,E,v)}).catch(()=>{d.value="Login failed, check credentials, try another login method or create account",c.value=!1})},U=a=>{a.preventDefault(),F()&&(c.value=!0,A.registerAccount(o.value,w.value).then(r=>{k.value=!1,r&&(T.value=!0)}).catch(()=>{d.value="Unable to register, address may be in use",c.value=!1}))},W=()=>{A.requestLoginLink(o.value).then(a=>{k.value=!1,a&&(L.value=!0)}).catch(()=>{d.value="A problem was encountered, please try again",c.value=!1})},Z=()=>{E.back()};return(a,r)=>{const D=Q("router-link");return k.value?(s(),g(ae,{key:0,onSubmit:r[3]||(r[3]=J(()=>{},["stop"])),class:"ma-auto vForm",disabled:c.value},{default:e(()=>[t(C,null,{default:e(()=>[t(_,null,{default:e(()=>[t(P,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=v=>o.value=v),rules:[f.value.required,f.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(C,null,{default:e(()=>[t(_,null,{default:e(()=>[t(P,{margin:"normal",required:"",name:"password",label:"Password",type:M.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:w.value,"onUpdate:modelValue":r[1]||(r[1]=v=>w.value=v),"append-icon":M.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":r[2]||(r[2]=v=>M.value=!M.value),counter:"",hint:"At least 8 characters",rules:[f.value.required,f.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),d.value?(s(),g(C,{key:0},{default:e(()=>[t(_,{class:"text-red-darken-1 font-weight-bold"},{default:e(()=>[n(V(d.value),1)]),_:1})]),_:1})):p("",!0),t(C,{justify:"space-between"},{default:e(()=>[a.variant===l(u).COMBINED||a.variant===l(u).REGISTER?(s(),g(_,{key:0,cols:"12",sm:"7",order:"2","order-sm":"1"},{default:e(()=>[t(b,{onClick:U,color:"orange-darken-2",disabled:c.value},{default:e(()=>[n(" Create Account ")]),_:1},8,["disabled"])]),_:1})):p("",!0),a.variant===l(u).COMBINED||a.variant===l(u).LOGIN?(s(),g(_,{key:1,cols:"12",sm:"5",order:"1","order-sm":"2"},{default:e(()=>[t(b,{onClick:$,color:"success",disabled:c.value,type:"submit"},{default:e(()=>[n(" Sign In ")]),_:1},8,["disabled"])]),_:1})):p("",!0),a.variant===l(u).ADD_CREDENTIAL?(s(),g(_,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:e(()=>[t(b,{onClick:U,color:"orange-darken-2",disabled:c.value},{default:e(()=>[n(" Add Email ")]),_:1},8,["disabled"])]),_:1})):p("",!0)]),_:1}),a.variant===l(u).COMBINED||a.variant===l(u).LOGIN?(s(),g(q,{key:1},{default:e(()=>[t(C,null,{default:e(()=>[t(_,null,{default:e(()=>[t(b,{variant:"text",onClick:W},{default:e(()=>[n(V(l(I).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0),a.variant===l(u).COMBINED||a.variant===l(u).LOGIN?(s(),g(q,{key:2},{default:e(()=>[t(C,null,{default:e(()=>[t(_,null,{default:e(()=>[t(b,{variant:"flat",color:"primary",onClick:Z},{default:e(()=>[n(V(l(I).buttonReturnToLogin),1)]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)]),_:1},8,["disabled"])):L.value?(s(),N("p",ne,V(l(I).messageResetEmail),1)):T.value?(s(),N("p",ue,V(l(I).messageVerifyNewAccountEmail),1)):R.value?(s(),N("p",ie,[n(V(l(I).messageVerifiedNewAccountMessage)+" ",1),d.value?(s(),N(G,{key:0},[de,ce,m("span",me,[n(" An error occurred creating or recovering account:"),fe,n(" "+V(d.value),1)]),ve,pe,_e,m("div",ge,[t(D,{to:"/"},{default:e(()=>[t(b,{color:"red"},{default:e(()=>[n("Close")]),_:1})]),_:1})])],64)):p("",!0)])):p("",!0)}}}),S=ee(he,[["__scopeId","data-v-afbed17d"]]),ke=m("h2",null,"Email",-1),qe=O({__name:"LoginWithEmailView",props:{variant:{default:()=>u.COMBINED}},emits:["pageTitle"],setup(h,{emit:E}){E("pageTitle","Email Login");const k=z(),L=te(),R=new URL(location.href).searchParams.get("token")||"";return L&&h.variant!=="ADD_CREDENTIAL"&&!R&&(Date.now()-new Date(L.CreatedAt||"").getTime()>2e4?k.push("/"):k.push("/profile")),(o,w)=>o.variant=="ADD_CREDENTIAL"?(s(),g(q,{key:0,style:{"max-width":"550px"}},{default:e(()=>[t(oe,null,{default:e(()=>[t(le,{class:"text-center"},{default:e(()=>[t(re,null,{default:e(()=>[n("Add an E-Mail Address")]),_:1})]),_:1}),t(se,null,{default:e(()=>[t(S,{variant:o.variant},null,8,["variant"])]),_:1})]),_:1})]),_:1})):(s(),N(G,{key:1},[ke,t(S,{variant:o.variant},null,8,["variant"])],64))}});export{qe as default};
