import{p as Gt,n as Bt,e as ce,t as Ce,c as Yt,G as xt,v as t,H as P,x as We,I as ue,a0 as Te,a1 as $e,r as c,K as fe,M as u,N as B,O as o,a3 as De,W as H,a2 as He,a4 as te,S as j,w as ie,X as h,Q as V,V as y,P as w,_ as tt,ac as Ht,ad as qt,E as st,k as jt,f as Qt,d as Kt,o as zt,ae as ut,R as Wt,Y as Jt,Z as Xt,a7 as Zt,a6 as ea,U as ta}from"./index-390866e7.js";import{e as aa,T as oa,V as na,d as la,c as ia}from"./FormRenderer.vue_vue_type_style_index_0_lang-ca67a405.js";import{a as sa,F as pe}from"./form-29fd1dbb.js";import{_ as Ge}from"./ModelDialog.vue_vue_type_script_setup_true_lang-7b6b66f9.js";import{m as ua,k as ra,l as da,n as ma,o as ca,p as va,q as Ua,u as _a,r as Aa,s as Ta,t as fa,v as Ea,w as Sa,x as pa,y as Ra,z as rt,A as dt,B as mt,a as Da,_ as Ia,f as ct,c as pt,d as Rt,e as Dt,b as It,V as yt,g as ya,h as ga,i as Ca,j as Oa}from"./VWindowItem-669f1769.js";import{V as W,a as N}from"./VRow-539e7b05.js";import{V as ve}from"./VTextField-6b86ab3d.js";import{V as se}from"./copyToClipboard-15913226.js";import{u as Ma,j as Re,V as ha}from"./VContainer-127acd6a.js";import{V as Va,u as at}from"./VCheckbox-deaf5846.js";import{v as ke}from"./v4-a960c1f4.js";import{h as Ye,b as ba,a as ka,c as Na,d as vt,P as Ze,u as gt}from"./useDisplayTransactions-d23eadb9.js";import{V as xe,a as Fe}from"./VList-0e335cf5.js";import{V as ne,a as La}from"./VBtn-1a3c2104.js";import{b as Pa,c as Ct,d as Ut}from"./submission-6136b51d.js";import{V as Fa}from"./VAvatar-014d0bff.js";import{s as wa}from"./sortSubmissions-8ed80f07.js";import{V as qe,a as $a}from"./scopeId-b271e52f.js";import{_ as et,V as Ot}from"./SaveButton.vue_vue_type_script_setup_true_lang-373b3df9.js";import{V as Ga}from"./VForm-88719d78.js";import{V as Ba,e as _t,c as Ya}from"./VCard-8e3a0ed8.js";import{G as xa}from"./group-d2a77946.js";import{C as Ha}from"./canDo-2c299106.js";import{G as qa}from"./userData-bfb0c71e.js";import{V as ja}from"./forwardRefs-5ce1b069.js";import{u as Je}from"./nil-d01db1aa.js";import{V as At,a as Qa}from"./VToolbar-49b20949.js";import{V as Tt,a as Ka}from"./VTable-567ed1eb.js";import{V as za}from"./VDialog-f67f3c4d.js";import"./index-26b71cef.js";import"./VTextarea-4099b6fd.js";import"./VChip-f4e55236.js";import"./VToolbarItems-945c5a00.js";import"./VDivider-fda9a7df.js";import"./createSimpleFunctional-d133bcdf.js";var Mt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(Mt||{});const Wa=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var we=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(we||{});const Ja=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const Xa=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var ee=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(ee||{});const Za=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],eo=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},to=Gt({itemsLength:{type:[Number,String],required:!0},...ua(),...ra(),...da()},"VDataTableServer"),ao=Bt()({name:"VDataTableServer",props:to(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,p)=>!0},setup(e,p){let{emit:s,slots:i}=p;const{groupBy:n}=ma(e),{sortBy:a,multiSort:m,mustSort:l}=ca(e),{page:U,itemsPerPage:I}=va(e),_=ce(()=>parseInt(e.itemsLength,10)),{columns:E,headers:v}=Ua(e,{groupBy:n,showSelect:Ce(e,"showSelect"),showExpand:Ce(e,"showExpand")}),{items:T}=_a(e,E),{toggleSort:A}=Aa({sortBy:a,multiSort:m,mustSort:l,page:U}),{opened:Y,isGroupOpen:D,toggleGroup:g,extractRows:C}=Ta({groupBy:n,sortBy:a}),{pageCount:b,setItemsPerPage:J}=fa({page:U,itemsPerPage:I,itemsLength:_}),{flatItems:ae}=Ea(T,n,Y),{isSelected:re,select:K,selectAll:S,toggleSelect:f,someSelected:L,allSelected:M}=Sa(e,{allItems:T,currentPage:T}),{isExpanded:G,toggleExpand:X}=pa(e),oe=ce(()=>C(T.value));Ra({page:U,itemsPerPage:I,sortBy:a,groupBy:n,search:Ce(e,"search")}),Yt("v-data-table",{toggleSort:A,sortBy:a}),xt({VDataTableRows:{hideNoData:Ce(e,"hideNoData"),noDataText:Ce(e,"noDataText"),loading:Ce(e,"loading"),loadingText:Ce(e,"loadingText")}});const z=ce(()=>({page:U.value,itemsPerPage:I.value,sortBy:a.value,pageCount:b.value,toggleSort:A,setItemsPerPage:J,someSelected:L.value,allSelected:M.value,isSelected:re,select:K,selectAll:S,toggleSelect:f,isExpanded:G,toggleExpand:X,isGroupOpen:D,toggleGroup:g,items:oe.value,groupedItems:ae.value,columns:E.value,headers:v.value}));Ma(()=>{const[Me]=rt.filterProps(e),[Ue]=dt.filterProps(e),[de]=mt.filterProps(e),[Ie]=Tt.filterProps(e);return t(Tt,We({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Ie),{top:()=>{var me;return(me=i.top)==null?void 0:me.call(i,z.value)},default:()=>{var me,ye,Ne,he;return i.default?i.default(z.value):t(P,null,[(me=i.colgroup)==null?void 0:me.call(i,z.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(dt,We(Ue,{sticky:e.fixedHeader}),i)]),(ye=i.thead)==null?void 0:ye.call(i,z.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[i.body?i.body(z.value):t(mt,We(de,{items:ae.value}),i)]),(Ne=i.tbody)==null?void 0:Ne.call(i,z.value),(he=i.tfoot)==null?void 0:he.call(i,z.value)])},bottom:()=>i.bottom?i.bottom(z.value):t(rt,Me,{prepend:i["footer.prepend"]})})})}}),oo=ue({__name:"EditAdminLayout",props:Te({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Te(["save"],["update:modelValue"]),setup(e,{emit:p}){const s=$e(e,"modelValue"),i=c(fe(e.layout)),n=c([]),a=De(),m=({callback:_})=>{const E=()=>{_&&_("Failed to Save Layout")},v=()=>{_&&_("Layout Saved")};a.saveAdminLayout(i.value).then(T=>{T?(v(),p("save",T)):E()}).catch(()=>{E()})},l=()=>({ID:0,LayoutPanelUUID:ke(),AdminLayoutID:i.value.ID,AdminLayoutUUID:i.value.AdminLayoutUUID,Name:"",Order:i.value.Panels.length+1,Items:[],RequiredFormType:pe.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),U=_=>()=>({ID:0,LayoutItemUUID:ke(),LayoutPanelID:_.ID,LayoutPanelUUID:_.LayoutPanelUUID,Label:"",SourceType:we.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:_.Items.length+1,DefaultSort:!1}),I=_=>{const E=n.value.find(v=>v.value===_.SectionFieldUUID);E&&(_.SectionFieldID=E.object.ID,_.SectionField=E.object)};return a.getConventionForms(e.layout.ConventionUUID).then(_=>{_.forEach(E=>E.Sections.forEach(v=>v.Fields&&n.value.push(...v.Fields.map(T=>{var Y;return{title:`${E.Name} - ${v.Name} - ${(Y=T.Field)==null?void 0:Y.Name}`,value:T.SectionFieldUUID,object:T}})))),n.value.sort(aa("title"))}),(_,E)=>(u(),B(Ge,{modelValue:s.value,"onUpdate:modelValue":E[3]||(E[3]=v=>s.value=v),onSave:m,title:_.title,color:"primary",fullscreen:!0,persistent:!0},{default:o(()=>[t(Re,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6"},{default:o(()=>[t(ve,{modelValue:i.value.Name,"onUpdate:modelValue":E[0]||(E[0]=v=>i.value.Name=v),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6"},{default:o(()=>[t(se,{modelValue:i.value.Type,"onUpdate:modelValue":E[1]||(E[1]=v=>i.value.Type=v),label:"Layout Type",items:H(Wa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(ct,{modelValue:i.value.Panels,"onUpdate:modelValue":E[2]||(E[2]=v=>i.value.Panels=v),"new-item":l,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},He({_:2},[te(i.value.Panels,(v,T)=>({name:`panel_${T}`,fn:o(()=>[t(Re,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6"},{default:o(()=>[t(ve,{modelValue:v.Name,"onUpdate:modelValue":A=>v.Name=A,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(N,{cols:"12",sm:"6"},{default:o(()=>[t(se,{modelValue:v.RequiredFormType,"onUpdate:modelValue":A=>v.RequiredFormType=A,items:H(sa),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6"},{default:o(()=>[t(Da,{label:"Required Groups",variant:"outlined",modelValue:v.RequiredGroupMemberships,"onUpdate:modelValue":A=>v.RequiredGroupMemberships=A,convention:i.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(N,{cols:"12",sm:"6"},{default:o(()=>[t(Ia,{label:"Registration Tags",variant:"outlined",modelValue:v.RequiredRegistrationTags,"onUpdate:modelValue":A=>v.RequiredRegistrationTags=A,convention:i.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(ct,{modelValue:v.Items,"onUpdate:modelValue":A=>v.Items=A,"new-item":U(v),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},He({_:2},[te(v.Items,(A,Y)=>({name:`item_${Y}`,fn:o(()=>[t(Re,{class:"px-0 mx-0",fluid:!0},{default:o(()=>[t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6"},{default:o(()=>[t(ve,{modelValue:A.Label,"onUpdate:modelValue":D=>A.Label=D,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6"},{default:o(()=>[t(se,{modelValue:A.SourceType,"onUpdate:modelValue":D=>A.SourceType=D,label:"Source Type",items:H(Ja),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(N,{cols:"12",sm:"6"},{default:o(()=>[A.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(u(),B(se,{key:0,modelValue:A.SectionFieldUUID,"onUpdate:modelValue":D=>A.SectionFieldUUID=D,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:D=>I(A)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):A.SourceType==="LAYOUT_ITEM_SOURCE_META"?(u(),B(se,{key:1,modelValue:A.MetaField,"onUpdate:modelValue":D=>A.MetaField=D,label:"Miscellaneous Data",items:H(Xa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):A.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(u(),B(se,{key:2,modelValue:A.UserField,"onUpdate:modelValue":D=>A.UserField=D,label:"User Profile Data",items:H(Za),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):j("",!0)]),_:2},1024)]),_:2},1024),t(W,null,{default:o(()=>[t(N,null,{default:o(()=>[t(Va,{modelValue:A.DefaultSort,"onUpdate:modelValue":D=>A.DefaultSort=D,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),no=h("br",null,null,-1),lo=h("h3",null,"Assigned Accommodation",-1),io=h("br",null,null,-1),so=h("br",null,null,-1),uo=h("h3",null,"Accommodation Preferences",-1),ro=h("h3",null,"Selected Tickets",-1),mo=h("br",null,null,-1),co=ue({__name:"EditAccommodationAssignmentDialog",props:Te({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Te(["update:field"],["update:modelValue"]),setup(e,{emit:p}){const s=e,{convention:i,registration:n,title:a=""}=s,m=De(),l=$e(e,"modelValue"),U=c({capacity:{max:S=>{var M;const f=b.value.find(G=>G.room.RoomUUID===S);return!f||f.room.MaximumCapacity===0?!0:(((M=v.value)==null?void 0:M.Members.length)||0)<=f.room.MaximumCapacity||"Too many people in the group for this room"},min:S=>{var M;const f=b.value.find(G=>G.room.RoomUUID===S);return!f||f.room.MinimumCapacity===0?!0:(((M=v.value)==null?void 0:M.Members.length)||0)>=f.room.MinimumCapacity||"Not enough people in the group for this room"}}}),I=c([]),_=at(s,p,void 0,void 0,"field"),E=c(fe(_.value));ie(_,()=>{E.value=fe(_.value)});const v=c(),T=c(""),A=c(""),Y=c([]),D=c({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),g=async()=>{var M;const S=await m.getConventionAvailableAccommodation(i.ConventionUUID);S&&(I.value=S);const f=await m.getRegistrationGroup(n.RegistrationUUID||"");f&&(v.value=f);const L=await m.getConventionTickets(i.ConventionUUID);L&&(Y.value=L);try{D.value=JSON.parse(((M=v.value)==null?void 0:M.TicketData)||"")}catch{}};ie(T,()=>{A.value=b.value.length>0?b.value[0].value:""});const C=ce(()=>{const S=J.value;return I.value.map(f=>{let L;return S.forEach(M=>{f.Costs.forEach(G=>{G.DateStart===(M==null?void 0:M.DateStart)&&G.DateEnd===M.DateEnd&&(L===void 0||L>G.Availability)&&(L=G.Availability)})}),{label:`${f.Name}`,title:`${f.Name} (${L} Available)`,value:f.AccommodationUUID}})}),b=ce(()=>{const S=J.value,f=I.value.find(L=>L.AccommodationUUID===T.value);return(f==null?void 0:f.Pool.map(L=>{var G,X;let M;return S.forEach(oe=>{L.Costs.forEach(z=>{z.DateStart===(oe==null?void 0:oe.DateStart)&&z.DateEnd===oe.DateEnd&&(M===void 0||M>z.Availability)&&(M=z.Availability)})}),{label:`${(G=L.Venue)==null?void 0:G.Name} - ${L.Name}`,title:`${(X=L.Venue)==null?void 0:X.Name} - ${L.Name} (${M} Available)`,value:L.RoomUUID,room:L}}))||[]}),J=ce(()=>[...D.value.Ticket,...D.value.AddonsChecked,...D.value.ComponentsChecked].map(S=>Y.value.find(f=>f.TicketUUID===S)).filter(S=>S!==void 0&&S.RequiresAccommodation)),ae=S=>{var f;m.assignAccommodation(((f=v.value)==null?void 0:f.Registration.RegistrationUUID)||"",T.value,A.value,!1).then(L=>{L?(g(),S&&S("Room Assigned")):S&&S("Room not assigned")}).catch(()=>{S&&S("Room not assigned")})},re=S=>{var f,L;(f=v.value)!=null&&f.Registration.AllocationUUID?m.deleteAllocation(((L=v.value)==null?void 0:L.Registration.AllocationUUID)||"").then(M=>{M?(g(),S&&S("Allocation Deleted")):S&&S("Allocation not deleted")}).catch(()=>{S&&S("Allocation not deleted")}):S&&S("Nothing to Delete")},K=S=>{var L,M;const f=(L=I.value.find(G=>G.AccommodationUUID===S.AccommodationUUID))==null?void 0:L.Pool;if(f){const G=f.find(X=>X.RoomUUID===S.RoomUUID);if(G)return`${(M=G.Venue)==null?void 0:M.Name} - ${G.Name}`}return""};return g(),(S,f)=>{var L;return u(),B(Ge,{modelValue:l.value,"onUpdate:modelValue":f[2]||(f[2]=M=>l.value=M),title:H(a),color:"primary","show-close-action":!0,"show-delete-action":!!((L=v.value)!=null&&L.Registration.Allocation),"show-save-action":!!A.value,"save-button-label":"Assign Room",onDelete:re,onSave:ae,fullscreen:!0,persistent:!0},{default:o(()=>[t(Re,{class:"pa-0",fluid:!0},{default:o(()=>[t(W,null,{default:o(()=>{var M;return[t(N,{cols:"12",md:"6"},{default:o(()=>{var G,X;return[h("h3",null,"Group Members ("+V((G=v.value)==null?void 0:G.Members.length)+")",1),(u(!0),y(P,null,te((X=v.value)==null?void 0:X.Members,oe=>(u(),y(P,{key:oe.UUID},[w(" #"+V(oe.Reference)+" "+V(oe.Name),1),no],64))),128))]}),_:1}),(M=v.value)!=null&&M.Registration.Allocation?(u(),B(N,{key:0,cols:"12",md:"6"},{default:o(()=>[lo,t(xe,null,{default:o(()=>{var G;return[(u(!0),y(P,null,te((G=v.value)==null?void 0:G.Registration.Allocation.Periods,X=>(u(),B(Fe,{key:X.AllocationPeriodUUID},{default:o(()=>{var oe;return[w(V((oe=I.value.find(z=>z.AccommodationUUID===X.AccommodationUUID))==null?void 0:oe.Name)+" ",1),io,w(" "+V(K(X))+" ",1),so,h("small",null,"("+V(H(Ye)(X.DateStart))+" - "+V(H(Ye)(X.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):j("",!0)]}),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12",md:"6"},{default:o(()=>[S.selectedAccommodation.length?(u(),y(P,{key:0},[uo,t(xe,null,{default:o(()=>[(u(!0),y(P,null,te(S.selectedAccommodation,(M,G)=>(u(),B(Fe,{key:M.AccommodationUUID},{default:o(()=>[w(V(G+1)+". "+V(M.Name),1)]),_:2},1024))),128))]),_:1})],64)):j("",!0)]),_:1}),t(N,{cosl:"12",md:"6"},{default:o(()=>[ro,t(xe,null,{default:o(()=>[(u(!0),y(P,null,te(J.value,M=>(u(),B(Fe,{key:M==null?void 0:M.TicketUUID},{default:o(()=>[w(V(M.Name)+" ",1),mo,h("small",null,"("+V(H(Ye)(M.DateStart))+" - "+V(H(Ye)(M.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12",md:"6"},{default:o(()=>[t(se,{modelValue:T.value,"onUpdate:modelValue":f[0]||(f[0]=M=>T.value=M),items:C.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"12",md:"6"},{default:o(()=>[t(se,{modelValue:A.value,"onUpdate:modelValue":f[1]||(f[1]=M=>A.value=M),items:b.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[U.value.capacity.min,U.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),vo={key:0,class:"accommodationList"},Uo={key:0,class:"text-orange-darken-2"},_o=ue({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const p=c(!1),s=ce(()=>{if(!e.value)return[];const n=JSON.parse(e.value),a=e.accommodations.filter(m=>n.includes(m.AccommodationUUID)).sort((m,l)=>{const U=n.findIndex(_=>_===m.AccommodationUUID),I=n.findIndex(_=>_===l.AccommodationUUID);return U>I?1:-1});return fe(a)}),i=ce(()=>{let n;const a=e.forms.find(m=>m.Sections.find(l=>{var U;return(U=l.Fields)==null?void 0:U.find(I=>{var _;if(((_=I.Field)==null?void 0:_.Type)==="TICKET")return n=I,!0})}));return n?!!e.registration.Submissions.find(m=>{if(m.FormUUID==(a==null?void 0:a.FormUUID))return m.Data.find(l=>{if(l.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const U=JSON.parse(l.Data);return e.tickets.filter(I=>I.RequiresAccommodation).find(I=>U.Ticket.includes(I.TicketUUID)||U.AddonsChecked.includes(I.TicketUUID)||U.ComponentsChecked.includes(I.TicketUUID))}})}):!1});return(n,a)=>i.value?(u(),y(P,{key:0},[n.value?(u(),y("ol",vo,[(u(!0),y(P,null,te(s.value,m=>(u(),y("li",{key:m.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(l=>l.AccommodationUUID===m.AccommodationUUID)?(u(),y("strong",Uo,V(m.Name),1)):(u(),y(P,{key:1},[w(V(m.Name),1)],64))]))),128))])):j("",!0),t(ne,{onClick:a[0]||(a[0]=m=>p.value=!0),variant:"flat",color:"success"},{default:o(()=>[w("Assign Accommodation")]),_:1}),n.convention&&p.value?(u(),B(co,{key:1,modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=m=>p.value=m),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":s.value},null,8,["modelValue","convention","registration","selected-accommodation"])):j("",!0)],64)):j("",!0)}});const Ao=tt(_o,[["__scopeId","data-v-7a102d46"]]),To={key:0,class:"addonList"},fo={key:0},Eo={key:0},So=ue({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const p=ce(()=>{if(!e.value)return;const s=JSON.parse(e.value),i=Object.keys(s),n=fe(e.extras);return n.forEach(a=>{a.Options=a.Options.filter(m=>i.includes(m.OptionUUID)?(m.Choices=m.Choices.filter(l=>l.TagUUID===s[m.OptionUUID].choiceId),s[m.OptionUUID].checked):!1)}),n.filter(a=>a.Options.length>0),n});return(s,i)=>s.value?(u(),y("ul",To,[(u(!0),y(P,null,te(p.value,n=>(u(),y(P,{key:n.ExtraUUID},[n.Options.length?(u(),y("li",fo,[h("strong",null,V(n.Name),1),h("ul",null,[(u(!0),y(P,null,te(n.Options,a=>(u(),y("li",{key:a.OptionUUID},[w(V(a.Name)+" ",1),a.Choices.length==1?(u(),y("small",Eo,"("+V(a.Choices[0].Title)+")",1)):j("",!0)]))),128))])])):j("",!0)],64))),128))])):j("",!0)}});const po=tt(So,[["__scopeId","data-v-55786e01"]]),Ro={key:0},Do=ue({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const p=ce(()=>{if(!e.value)return;const s=JSON.parse(e.value);return Object.entries(s).filter(([,i])=>i).map(([i,n])=>e.interests.find(a=>a.InterestUUID===i)).filter(i=>i!==void 0)});return(s,i)=>s.value?(u(),y("ul",Ro,[(u(!0),y(P,null,te(p.value,n=>(u(),y("li",{key:n.InterestUUID},V(n.Name),1))),128))])):j("",!0)}}),Io=h("br",null,null,-1),yo=h("small",null,"Options:",-1),go=h("br",null,null,-1),Co=h("small",null,"Addons:",-1),Oo=ue({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const p=ce(()=>{if(!e.value)return;let s={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{s=JSON.parse(e.value),"ticket"in s&&(s.Ticket=s.ticket),"addonsChecked"in s&&(s.AddonsChecked=s.addonsChecked),"componentsChecked"in s&&(s.ComponentsChecked=s.componentsChecked)}catch{}return s.Ticket.filter(i=>{const n=e.tickets.find(a=>a.TicketUUID===i);return!(!n||n.Type!==oa.TICKET_TYPE_TICKET)}).map(i=>{const n=e.tickets.find(m=>m.TicketUUID===i),a=fe(n);return a.TicketComponents=n.TicketComponents.filter(m=>s.ComponentsChecked.includes(m.TicketUUID)),a.AddonTickets=n.AddonTickets.filter(m=>s.AddonsChecked.includes(m.TicketUUID)),a})});return(s,i)=>s.value?(u(!0),y(P,{key:0},te(p.value,n=>(u(),y("div",{key:n.TicketUUID},[h("strong",null,V(n.Name),1),n.TicketComponents.length>0?(u(),y(P,{key:0},[Io,yo,w("  "),(u(!0),y(P,null,te(n.TicketComponents,a=>(u(),y(P,{key:a.TicketUUID},[h("small",null,V(a.Name),1),w("  ")],64))),128))],64)):j("",!0),n.AddonTickets.length>0?(u(),y(P,{key:1},[go,Co,w("  "),(u(!0),y(P,null,te(n.AddonTickets,a=>(u(),y("small",{key:a.TicketUUID},[w("("),h("em",null,V(a.Name),1),w(")")]))),128))],64)):j("",!0)]))),128)):j("",!0)}}),Mo={key:0,class:"text-blue text-center"},ho={key:1,class:"text-red text-center"},Vo={key:2,class:"text-orange text-center"},bo={key:3,class:"text-orange text-center"},ko={key:4,class:"text-orange text-center"},No={key:5,class:"text-orange text-center"},Lo={key:6,class:"text-green text-center"},Po={key:0},Fo={key:0},wo=h("strong",null,"Total:",-1),$o=ue({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload","showForm"],setup(e,{emit:p}){const s=(a,m,l)=>{p("showForm",{registration:a,form:m,submission:l})},i=a=>{p("openActions",a)},n=a=>{p("openPayments",a)};return(a,m)=>a.header.type==="ACCOMMODATION"&&a.accommodations.length>0&&a.item.raw[a.header.key]?(u(),B(Ao,{key:0,value:a.item.raw[a.header.key].Data,accommodations:a.accommodations,convention:a.convention,forms:a.forms,tickets:a.tickets,venues:a.venues,registration:a.item.raw[a.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):a.header.type==="EXTRAS"&&a.extras.length>0?(u(),B(po,{key:1,value:a.item.raw[a.header.key],extras:a.extras},null,8,["value","extras"])):a.header.type==="INTERESTS"&&a.interests.length>0?(u(),B(Do,{key:2,value:a.item.raw[a.header.key],interests:a.interests},null,8,["value","interests"])):a.header.type==="TICKET"&&a.tickets.length>0?(u(),B(Oo,{key:3,value:a.item.raw[a.header.key],tickets:a.tickets},null,8,["value","tickets"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(u(!0),y(P,{key:4},te(a.item.raw[a.header.key],l=>(u(),y("ul",{key:l.Heading},[h("li",null,[h("strong",null,V(l.Heading)+": ",1),h("span",{class:Ht(H(Pa)(l.Submission.Status))},V(H(Ct)(l.Submission.Status)),3),t(ne,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:U=>s(l.Registration,l.Form,l.Submission)},null,8,["onClick"])])]))),128)):a.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(u(),B(Fa,{key:5,class:"rounded-circle",src:a.item.raw[a.header.key],height:"32",width:"32"},null,8,["src"])):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(u(),y(P,{key:6},[a.item.raw[a.header.key]=="NOT_REQUIRED"?(u(),y("div",Mo,"No Payment Requested")):a.item.raw[a.header.key]=="MISSING_REQUIRED"?(u(),y("div",ho,"Partner Payment Not Requested")):a.item.raw[a.header.key]=="AWAITING_PARTNER"?(u(),y("div",Vo,"Awaiting Partner Payment")):a.item.raw[a.header.key]=="ALL_REQUIRED"?(u(),y("div",bo,"Awaiting Payments")):a.item.raw[a.header.key]=="REQUIRED"?(u(),y("div",ko,"Awaiting Payment")):a.item.raw[a.header.key]=="ADDITIONAL_REQUIRED"?(u(),y("div",No,"Awaiting Additional Payments")):(u(),y("div",Lo,"Completed"))],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(u(),y(P,{key:7},[t(ne,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:m[0]||(m[0]=l=>i(a.item.raw[a.header.key]))}),t(ne,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:m[1]||(m[1]=l=>n(a.item.raw[a.header.key]))})],64)):a.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(u(),y(P,{key:8},[a.item.raw[a.header.key].length===1?(u(),y("em",Po," Not in a group ")):(u(),y(P,{key:1},[h("ul",null,[(u(!0),y(P,null,te(a.item.raw[a.header.key],l=>(u(),y("li",{key:l.UUID,class:"ml-0"},[w(" #"+V(l.Reference)+" : "+V(l.Name)+" ",1),l.IsLeader?(u(),y("strong",Fo,"(Leader)")):j("",!0)]))),128))]),wo,w(" "+V(a.item.raw[a.header.key].length),1)],64))],64)):(u(),y(P,{key:9},[w(V(a.item.raw[a.header.key]),1)],64))}});var Go=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Bo=function(e){return Go.map(function(p){return p.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Yo=function(e,p,s){Object.keys(p).filter(Bo).forEach(function(i){var n=p[i];typeof n=="function"&&(i==="onInit"?n(e,s):s.on(i.substring(2),function(a){return n(a,s)}))})},xo=function(e,p,s,i){var n=e.modelEvents?e.modelEvents:null,a=Array.isArray(n)?n.join(" "):n;ie(i,function(m,l){s&&typeof m=="string"&&m!==l&&m!==s.getContent({format:e.outputFormat})&&s.setContent(m)}),s.on(a||"change input undo redo",function(){p.emit("update:modelValue",s.getContent({format:e.outputFormat}))})},Ho=function(e,p,s,i,n,a){i.setContent(a()),s.attrs["onUpdate:modelValue"]&&xo(p,s,i,n),Yo(e,s.attrs,i)},ft=0,ht=function(e){var p=Date.now(),s=Math.floor(Math.random()*1e9);return ft++,e+"_"+s+ft+String(p)},qo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Et=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},jo=function(e,p){return Et(e).concat(Et(p))},Qo=function(e){return e==null},St=function(){return{listeners:[],scriptId:ht("tiny-script"),scriptLoaded:!1}},Ko=function(){var e=St(),p=function(n,a,m,l){var U=a.createElement("script");U.referrerPolicy="origin",U.type="application/javascript",U.id=n,U.src=m;var I=function(){U.removeEventListener("load",I),l()};U.addEventListener("load",I),a.head&&a.head.appendChild(U)},s=function(n,a,m){e.scriptLoaded?m():(e.listeners.push(m),n.getElementById(e.scriptId)||p(e.scriptId,n,a,function(){e.listeners.forEach(function(l){return l()}),e.scriptLoaded=!0}))},i=function(){e=St()};return{load:s,reinitialize:i}},zo=Ko(),Wo=function(){return typeof window<"u"?window:global},Oe=function(){var e=Wo();return e&&e.tinymce?e.tinymce:null},Jo={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},Ae=globalThis&&globalThis.__assign||function(){return Ae=Object.assign||function(e){for(var p,s=1,i=arguments.length;s<i;s++){p=arguments[s];for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&(e[n]=p[n])}return e},Ae.apply(this,arguments)},Xo=function(e,p,s,i){return e(i||"div",{id:p,ref:s})},Zo=function(e,p,s){return e("textarea",{id:p,visibility:"hidden",ref:s})},Xe={selector:void 0,target:void 0},en=ue({props:Jo,setup:function(e,p){var s=e.init?Ae(Ae({},e.init),Xe):Ae({},Xe),i=qt(e),n=i.disabled,a=i.modelValue,m=i.tagName,l=c(null),U=null,I=e.id||ht("tiny-vue"),_=e.init&&e.init.inline||e.inline,E=!!p.attrs["onUpdate:modelValue"],v=!0,T=e.initialValue?e.initialValue:"",A="",Y=function(C){return E?function(){return a!=null&&a.value?a.value:""}:function(){return C?T:A}},D=function(){var C=Y(v),b=Ae(Ae({},s),{readonly:e.disabled,target:l.value,plugins:jo(s.plugins,e.plugins),toolbar:e.toolbar||s.toolbar,inline:_,setup:function(J){U=J,J.on("init",function(ae){return Ho(ae,e,p,J,a,C)}),typeof s.setup=="function"&&s.setup(J)}});qo(l.value)&&(l.value.style.visibility=""),Oe().init(b),v=!1};ie(n,function(C){var b;U!==null&&(typeof((b=U.mode)===null||b===void 0?void 0:b.set)=="function"?U.mode.set(C?"readonly":"design"):U.setMode(C?"readonly":"design"))}),ie(m,function(C){var b;E||(A=U.getContent()),(b=Oe())===null||b===void 0||b.remove(U),st(function(){return D()})}),jt(function(){if(Oe()!==null)D();else if(l.value&&l.value.ownerDocument){var C=e.cloudChannel?e.cloudChannel:"6",b=e.apiKey?e.apiKey:"no-api-key",J=Qo(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(b,"/tinymce/").concat(C,"/tinymce.min.js"):e.tinymceScriptSrc;zo.load(l.value.ownerDocument,J,D)}}),Qt(function(){Oe()!==null&&Oe().remove(U)}),_||(Kt(function(){v||D()}),zt(function(){var C;E||(A=U.getContent()),(C=Oe())===null||C===void 0||C.remove(U)}));var g=function(C){var b;A=U.getContent(),(b=Oe())===null||b===void 0||b.remove(U),s=Ae(Ae(Ae({},s),C),Xe),st(function(){return D()})};return p.expose({rerender:g,getEditor:function(){return U}}),function(){return _?Xo(ut,I,l,e.tagName):Zo(ut,I,l)}}});const tn=["colspan"],an=h("strong",null,"E-Mail Content",-1),on=["innerHTML"],Vt=ue({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:p}){const s=De(),i=c([]),n=c({From:"",Subject:"",HTML:""}),a=c(""),m=c(""),l=c(""),U=c(!1),I=c([]),_=c([]),E=c([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),v=c([{key:"CreatedAt",order:"asc"}]);ie(n,D=>{l.value=D.From||l.value||"",m.value=D.Subject||m.value||"",a.value=D.HTML||a.value||""});const T=()=>{s.getRegistrationEmails(e.registration.RegistrationUUID).then(D=>{D&&(D.forEach(g=>{g.CreatedAt=ba(new Date(g.CreatedAt||"")),g.Status=eo(g.Status),g.User||(g.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),_.value=D)})};T(),(()=>{s.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(D=>{D&&(i.value=D)})})();const Y=({callback:D})=>{s.sendRegistrationEmail(e.registration.RegistrationUUID,l.value,m.value,a.value).then(g=>{g?D&&(D("Email Sent"),T(),setTimeout(()=>{U.value=!1},2e3)):D&&D("Not sent")}).catch(()=>{D&&D("Not sent")})};return(D,g)=>(u(),y(P,null,[D.showEditor?(u(),y(P,{key:0},[t(W,null,{default:o(()=>[t(N,null,{default:o(()=>[t(na,{items:i.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=C=>n.value=C),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12"},{default:o(()=>[t(ve,{modelValue:l.value,"onUpdate:modelValue":g[1]||(g[1]=C=>l.value=C),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12"},{default:o(()=>[t(ve,{modelValue:m.value,"onUpdate:modelValue":g[2]||(g[2]=C=>m.value=C),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12"},{default:o(()=>[t(H(en),{modelValue:a.value,"onUpdate:modelValue":g[3]||(g[3]=C=>a.value=C),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(W,null,{default:o(()=>[t(N,null,{default:o(()=>[t(et,{onClick:g[4]||(g[4]=C=>p("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(N,{class:"text-right"},{default:o(()=>[t(et,{onClick:Y,label:"Send",color:"error"})]),_:1})]),_:1})],64)):j("",!0),_.value.length&&!D.hideHistory?(u(),B(yt,{key:1,class:"my-2"},{default:o(()=>[t(It,null,{default:o(()=>[t(pt,null,{default:o(()=>[w(" Email History ")]),_:1}),t(Rt,null,{default:o(()=>[t(H(Dt),{items:_.value,headers:E.value,"show-expand":!0,"item-value":"EmailUUID",expanded:I.value,"onUpdate:expanded":g[5]||(g[5]=C=>I.value=C),"sort-by":v.value,"onUpdate:sortBy":g[6]||(g[6]=C=>v.value=C)},{"expanded-row":o(({columns:C,item:b})=>[h("tr",null,[h("td",{colspan:C.length},[an,h("div",{class:"communicationsViewEmailPreview",innerHTML:b.raw.HTML},null,8,on)],8,tn)])]),"footer.prepend":o(()=>[t(ne,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:T},{default:o(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const nn=ue({__name:"StripeRefundPayment",props:Te({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0}}),emits:Te(["refunded"],["update:modelValue"]),setup(e,{emit:p}){const s=$e(e,"modelValue"),i=De(),n=c(!1),a=c("");let m=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const v=e.paymentTransaction.Data.PaymentIntent;v&&(m=v.amount)}const l=c({Amount:m/100,Description:"",Reason:""}),U=c([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),I=c(!1);async function _(v){v.preventDefault(),I.value=!0,i.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,l.value).then(T=>{T?p("refunded",T):E("An unexpected error occurred.")}).catch(T=>{E("An error occurred processing the refund: "+T.toString())}),I.value=!1}const E=v=>{a.value=v,n.value=!0};return(v,T)=>(u(),B(Ge,{modelValue:s.value,"onUpdate:modelValue":T[7]||(T[7]=A=>s.value=A),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:o(()=>[t(Re,{class:"pa-0"},{default:o(()=>[t(Ga,{ref:"refundForm",id:"refund-form",onSubmit:T[4]||(T[4]=Wt(A=>_(A),["prevent"]))},{default:o(()=>[t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:o(()=>[t(ve,{modelValue:l.value.Amount,"onUpdate:modelValue":T[0]||(T[0]=A=>l.value.Amount=A),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:o(()=>[t(se,{modelValue:l.value.Reason,"onUpdate:modelValue":T[1]||(T[1]=A=>l.value.Reason=A),modelModifiers:{number:!0},items:U.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"12"},{default:o(()=>[t(ve,{modelValue:l.value.Description,"onUpdate:modelValue":T[2]||(T[2]=A=>l.value.Description=A),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(W,null,{default:o(()=>[t(N,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[t(ne,{color:"error",class:"w-100",onClick:T[3]||(T[3]=A=>s.value=!1)},{default:o(()=>[w("Cancel")]),_:1})]),_:1}),t(qe),t(N,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:o(()=>[t(ne,{type:"submit",color:"success",class:"w-100"},He({default:o(()=>[w(" Issue Refund ")]),_:2},[I.value?{name:"prepend",fn:o(()=>[t(La,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(Ot,{modelValue:n.value,"onUpdate:modelValue":T[6]||(T[6]=A=>n.value=A)},{actions:o(()=>[t(ne,{variant:"text",onClick:T[5]||(T[5]=A=>n.value=!1)},{default:o(()=>[w(" Close ")]),_:1})]),default:o(()=>[w(V(a.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),ln=["colspan"],sn=h("strong",null,"Details",-1),un=["innerHTML"],rn=ue({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:p}){const s=e;let{hideHistory:i=!1,registration:n,showEditor:a}=s;const m=De(),l=c([]),U=c([]),I=c([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),_=c(!1),E=c(),v=c(!1),T=c(""),A=c([{key:"CreatedAt",order:"asc"}]),Y=()=>({PaymentTransactionUUID:ke(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:vt.PAYMENT_TRANSACTION_SOURCE_NULL,Type:Ze.PAYMENT_TRANSACTION_TYPE_NULL}),D=c(Y()),{convertTransactions:g,getPaymentTransactionsDisplay:C}=gt();ie(s,()=>{i=s.hideHistory,n=s.registration,a=s.showEditor,C(n.RegistrationUUID).then(K=>{U.value=K})});const b=()=>{C(n.RegistrationUUID).then(K=>{U.value=K})};b();const J=()=>{m.saveRegistrationPaymentTransaction(D.value).then(K=>{K&&(g(K.PaymentTransactions),D.value=Y(),p("close-editor"),p("change"))})},ae=K=>{const S=U.value.find(f=>f.PaymentTransactionUUID===K);S&&(E.value=S.PaymentTransaction,_.value=!0)},re=K=>{if(K)try{U.value=g(K.PaymentTransactions),E.value=void 0,_.value=!1,T.value="Refund Processed",v.value=!0,p("change")}catch(S){console.error(S)}};return(K,S)=>(u(),y(P,null,[H(a)?(u(),y(P,{key:0},[t(Ba,null,{default:o(()=>[w(" Add Transaction ")]),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6"},{default:o(()=>[t(se,{items:H(ka),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:D.value.Type,"onUpdate:modelValue":S[0]||(S[0]=f=>D.value.Type=f),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(N,{cols:"12",sm:"6"},{default:o(()=>[t(se,{items:H(Na),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:D.value.Source,"onUpdate:modelValue":S[1]||(S[1]=f=>D.value.Source=f),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"8",md:"10"},{default:o(()=>[t(ve,{label:"Description","hide-details":"",modelValue:D.value.Description,"onUpdate:modelValue":S[2]||(S[2]=f=>D.value.Description=f),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"4",md:"2"},{default:o(()=>[t(ve,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:D.value.Amount,"onUpdate:modelValue":S[3]||(S[3]=f=>D.value.Amount=f),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"3",md:"2",lg:"1"},{default:o(()=>[t(ne,{class:"w-100",onClick:S[4]||(S[4]=f=>p("close-editor")),color:"warning"},{default:o(()=>[w("Cancel")]),_:1})]),_:1}),t(qe),t(N,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:o(()=>[t(ne,{class:"w-100",onClick:J,color:"primary"},{default:o(()=>[w("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):j("",!0),U.value.length&&!H(i)?(u(),B(yt,{key:1,class:"my-2"},{default:o(()=>[t(It,null,{default:o(()=>[t(pt,null,{default:o(()=>[w(" Transaction History ")]),_:1}),t(Rt,null,{default:o(()=>[t(H(Dt),{items:U.value,headers:I.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:l.value,"onUpdate:expanded":S[5]||(S[5]=f=>l.value=f),"sort-by":A.value,"onUpdate:sortBy":S[6]||(S[6]=f=>A.value=f),class:"transactionTable"},{"item.Controls":o(({item:f})=>[K.canEdit&&f.raw.PaymentTransaction.Source===H(vt).PAYMENT_TRANSACTION_SOURCE_STRIPE&&f.raw.PaymentTransaction.Type===H(Ze).PAYMENT_TRANSACTION_TYPE_PAYMENT?(u(),B(ne,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:L=>ae(f.key)},null,8,["onClick"])):j("",!0)]),"expanded-row":o(({columns:f,item:L})=>[h("tr",null,[h("td",{colspan:f.length},[sn,h("div",{innerHTML:L.raw.HTML},null,8,un)],8,ln)])]),"footer.prepend":o(()=>[t(ne,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:b},{default:o(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),_.value&&E.value?(u(),B(nn,{key:0,modelValue:_.value,"onUpdate:modelValue":S[7]||(S[7]=f=>_.value=f),"payment-transaction":E.value,onRefunded:re},null,8,["modelValue","payment-transaction"])):j("",!0),t(Ot,{modelValue:v.value,"onUpdate:modelValue":S[9]||(S[9]=f=>v.value=f)},{actions:o(()=>[t(ne,{variant:"text",onClick:S[8]||(S[8]=f=>v.value=!1)},{default:o(()=>[w(" Close ")]),_:1})]),default:o(()=>[w(V(T.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):j("",!0)],64))}});const dn=(e=void 0,p)=>e===void 0?!1:Ha(e,xa.GROUP_TYPE_CONVENTION,p.ConventionUUID,p).EditPaymentTransactions,je=e=>(Jt("data-v-a5bd0dd4"),e=e(),Xt(),e),mn={class:"mb-4"},cn={class:"v-row"},vn={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Un={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},_n={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},An={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},Tn=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),fn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},En=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),Sn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},pn=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),Rn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Dn=je(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),In={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},yn=ue({__name:"PaymentActions",props:Te({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Te(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const s=e,i=$e(e,"modelValue"),{registration:n}=s,a=c(!1),m=c(!1),l=c(),U=c([]),I=c(new Date().getTime()),_=c(!1),E=at(s,p,void 0,void 0,"registration"),v=c(fe(E.value));ie(E,()=>{v.value=fe(E.value)});const T=De();T.getConvention(n.ConventionUUID).then(g=>{g&&(_.value=dn(qa(),g))});const A=()=>{T.generateRegistrationCharges(n.RegistrationUUID,!1).then(g=>{g&&(U.value=g.PaymentTransactions,l.value=g.Registration,I.value=new Date().getTime())}).catch(()=>{})};A();const Y=()=>{T.generateRegistrationCharges(n.RegistrationUUID,!0).then(g=>{g&&(U.value=g.PaymentTransactions,l.value=g.Registration,I.value=new Date().getTime())})},{totalCharges:D}=gt();return(g,C)=>(u(),B(Ge,{modelValue:i.value,"onUpdate:modelValue":C[3]||(C[3]=b=>i.value=b),title:g.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Re,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[l.value?(u(),y(P,{key:0},[h("h3",mn,"#"+V(l.value.Reference)+" "+V(l.value.User.DisplayName),1),h("dl",cn,[(u(!0),y(P,null,te(U.value,b=>(u(),y(P,{key:b.PaymentTransactionUUID},[b.Type===H(Ze).PAYMENT_TRANSACTION_TYPE_CHARGE?(u(),y("dt",vn,[h("div",Un,V(b.Description.split(":")[0])+": ",1),h("div",_n,V(b.Description.split(":")[1]),1)])):j("",!0),h("dd",An," £"+V(b.Amount),1)],64))),128)),Tn,h("dd",fn," £"+V(H(D)(U.value)),1),En,h("dd",Sn," £"+V(l.value.Total),1),pn,h("dd",Rn," £"+V(l.value.Paid),1),Dn,h("dd",In," £"+V(l.value.Total-l.value.Paid),1)]),t(W,{class:"flex-row-reverse"},{default:o(()=>[t(N,{class:"text-right"},{default:o(()=>[t(ne,{color:"primary",onClick:Y},{default:o(()=>[w("Apply Charges")]),_:1})]),_:1}),!m.value&&_.value?(u(),B(N,{key:0},{default:o(()=>[t(ne,{color:"secondary",onClick:C[0]||(C[0]=b=>m.value=!0)},{default:o(()=>[w("Transaction Entry")]),_:1})]),_:1})):j("",!0)]),_:1})],64)):j("",!0),t(rn,{"can-edit":_.value,registration:H(n),"show-editor":m.value,onCloseEditor:C[1]||(C[1]=b=>m.value=!1),updated:I.value,onChange:A},null,8,["can-edit","registration","show-editor","updated"]),t(Vt,{registration:H(n),"show-editor":a.value,onCloseEditor:C[2]||(C[2]=b=>a.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const gn=tt(yn,[["__scopeId","data-v-a5bd0dd4"]]),Cn=ue({__name:"RegistrationActions",props:Te({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Te(["update:registration"],["update:modelValue"]),setup(e,{emit:p}){const s=e,i=$e(e,"modelValue"),n=c(!1),a=at(s,p,void 0,void 0,"registration"),m=c(fe(a.value));ie(a,()=>{m.value=fe(a.value)});const l=De(),U=(I,_)=>{const E=m.value.Submissions.find(v=>v.SubmissionUUID==_);if(!E){I&&I("Submission not found");return}l.setSubmissionStatus(_,E.Status).then(v=>{v?(m.value.Submissions.forEach((T,A)=>{a.value.Submissions[A].Status=T.Status}),I&&I("Status Saved")):I&&I("Status not saved")}).catch(()=>{I&&I("Status not saved")})};return(I,_)=>(u(),B(Ge,{modelValue:i.value,"onUpdate:modelValue":_[2]||(_[2]=E=>i.value=E),title:I.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:o(()=>[t(Re,{class:"pa-0 mx-0",fluid:!0},{default:o(()=>[h("h3",null,"#"+V(I.registration.Reference)+" "+V(I.registration.User.DisplayName),1),t(xe,null,{default:o(()=>[(u(!0),y(P,null,te(m.value.Submissions,E=>(u(),B(Fe,{key:E.SubmissionUUID,class:"pa-0"},{default:o(()=>[t(W,{class:"py-2 align-center"},{default:o(()=>[t(N,{cols:"8"},{default:o(()=>{var v;return[t(se,{modelValue:E.Status,"onUpdate:modelValue":T=>E.Status=T,items:H(Ut),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((v=I.forms.find(T=>T.FormUUID==E.FormUUID))==null?void 0:v.Name)||""},{selection:o(()=>[t(ha,{class:"mr-4"},{default:o(()=>{var T;return[w(V((T=H(Ut).find(A=>A.value===E.Status))==null?void 0:T.icon),1)]}),_:2},1024),w(" "+V(H(Ct)(E.Status)),1)]),item:o(({item:T,props:{onClick:A}})=>[t(Fe,{title:T.title,"prepend-icon":T.raw.icon,onClick:A},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(N,{cols:"4"},{default:o(()=>[t(et,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:v=>U(v.callback,E.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(W,null,{default:o(()=>[t(N,{cols:"12"},{default:o(()=>[t(ne,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:_[0]||(_[0]=E=>n.value=!0)},{default:o(()=>[w("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Vt,{registration:I.registration,"show-editor":n.value,onCloseEditor:_[1]||(_[1]=E=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const rl=ue({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:p}){var nt;const s=$a();p("pageTitle","Registration Manager");const i=Zt(),n=ea(),a=c(!0);let m=((nt=i.params.convention)==null?void 0:nt.toString())||"";const l=c({ID:0,ConventionUUID:ke(),OrganisationID:0,OrganisationUUID:Je,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),U=De(),I=ta.getInstance(),_=c({ID:0,AdminLayoutUUID:ke(),ConventionID:l.value.ID,ConventionUUID:l.value.ConventionUUID,Name:"Registration Table",Type:Mt.ADMIN_LAYOUT_TABLE,Panels:[]}),E=c([]),v=c([]),T=c([]),A=c([]),Y=c([]),D=c(1),g=c(10),C=c([]),b=c(0),J=c(!1),ae=c(""),re=c(""),K=c(""),S=c(""),f=c(""),L=c(""),M=c([]),G=c([]),X=c([]),oe=c([]),z=c([]),Me=c([]),Ue=c(0),de=c(),Ie=c(!1),me=c(!1),ye=c(),Ne=c(),he=c(),Ve=c(!1);ie(ae,r=>{const d=Y.value.find(R=>R.uuid===r);if(d){const R=d.headers.find(O=>O.defaultSort===!0);R&&(C.value=[{key:R.key,order:"asc"}],M.value=[{key:R.key,order:"asc"}])}}),ie(Ue,r=>{r===7&&ot()}),ie(f,()=>{re.value=Date.now().toString()}),ie(L,()=>{re.value=Date.now().toString()});const bt=()=>{E.value=[],T.value=[],Y.value=[];try{U.getConventionAdminLayoutByName(l.value.ConventionUUID,"Registration Table").then(r=>{Ue.value+=1,r?_.value=r:(_.value.ConventionID=l.value.ID,_.value.ConventionUUID=l.value.ConventionUUID)})}catch{_.value.ConventionID=l.value.ID,_.value.ConventionUUID=l.value.ConventionUUID}try{U.getConventionForms(l.value.ConventionUUID).then(r=>{Ue.value+=1,r&&(E.value=r)})}catch{}try{U.getConventionAccommodation(l.value.ConventionUUID).then(r=>{Ue.value+=1,r&&(G.value=r)})}catch{}try{U.getConventionVenues(l.value.ConventionUUID).then(r=>{Ue.value+=1,r&&(Me.value=r)})}catch{}try{U.getConventionExtras(l.value.ConventionUUID).then(r=>{Ue.value+=1,r&&(X.value=r)})}catch{}try{U.getConventionInterests(l.value.ConventionUUID).then(r=>{Ue.value+=1,r&&(oe.value=r)})}catch{}try{U.getConventionTickets(l.value.ConventionUUID).then(r=>{Ue.value+=1,r&&(z.value=r)})}catch{}try{U.getConventionGroups(l.value.ConventionUUID).then(r=>{r&&(v.value=r.sort((d,R)=>d.Name.localeCompare(R.Name)))})}catch{}try{U.getConventionTags(l.value.ConventionUUID).then(r=>{r&&(A.value=r.sort((d,R)=>d.Title.localeCompare(R.Title)).map(d=>(d.Title=`${d.Title} [${d.Key}]`,d)))})}catch{}},Qe=({page:r,itemsPerPage:d,sortBy:R})=>{a.value=!0,D.value=r,C.value=R;const O=Y.value.find(Z=>Z.uuid==ae.value),_e=O==null?void 0:O.layout.Items;let le="",lt="";if(R&&_e&&R.length>=1){const Z=_e.find(Le=>Le.LayoutItemUUID==R[0].key);switch(lt=R[0].order||"asc",Z==null?void 0:Z.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:le="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:le="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:le="submission.status";break}switch(Z==null?void 0:Z.UserField){case ee.USER_DATA_SOURCE_DISPLAY_NAME:le="user.display_name";break;case ee.USER_DATA_SOURCE_EMAIL:le="user.email";break;case ee.USER_DATA_SOURCE_FIRST_NAME:le="user.firstname";break;case ee.USER_DATA_SOURCE_HANDLE:le="user.handle";break;case ee.USER_DATA_SOURCE_LAST_NAME:le="user.lastname";break}}try{const Z={Direction:lt,Limit:d,Offset:(r-1)*d,Order:le};O&&O.layout.RequiredRegistrationTags.length>0&&(Z.PanelUUID=O==null?void 0:O.layout.LayoutPanelUUID),(O==null?void 0:O.layout.RequiredFormType)===pe.FORM_TYPE_ACCOMMODATION&&(Z.Accommodation=!0),(O==null?void 0:O.layout.RequiredFormType)===pe.FORM_TYPE_BADGE&&(Z.Badge=!0),(O==null?void 0:O.layout.RequiredFormType)===pe.FORM_TYPE_DEALER&&(Z.Dealer=!0),(O==null?void 0:O.layout.RequiredFormType)===pe.FORM_TYPE_REGISTRATION&&(Z.Registration=!0),Z.GroupUUID=f.value||Je,Z.TagUUID=L.value||Je,Z.Email=S.value,Z.Reference=K.value,U.searchConventionRegistrations(l.value.ConventionUUID,Z).then(Le=>{Le&&(b.value=Le.Total,T.value=Le.Registrations,Y.value.forEach(ze=>{const $t=ze.layout;ze.items=T.value.map($=>{const Be=[];let Ee;$.Leader?Ee=$:Ee=$.Primary,Be.push({Name:Ee.User.DisplayName,UUID:Ee.UserUUID,UserUUID:Ee.User.UserUUID,IsLeader:!0,Reference:Ee.Reference,Paid:Ee.Paid,Total:Ee.Total}),Be.push(...Ee.Members.map(Se=>({Name:Se.User.DisplayName,UUID:Se.UserUUID,UserUUID:Se.User.UserUUID,IsLeader:!1,Reference:Se.Reference,Paid:Se.Paid,Total:Se.Total})));const q={};return ze.headers.forEach(Se=>{var it;const F=$t.Items.find(Pe=>Pe.LayoutItemUUID===Se.key);if(F){if(F.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&F.SectionField)$.Submissions.forEach(Pe=>{const be=Pe.Data.find(k=>k.SectionFieldUUID===F.SectionFieldUUID);if(be){Se.type===ia.ACCOMMODATION?q[F.LayoutItemUUID]={Data:be.Data,Registration:$}:q[F.LayoutItemUUID]=be.Data;return}});else if(F.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&F.UserField)switch(F.UserField){case ee.USER_DATA_SOURCE_AVATAR:q[F.LayoutItemUUID]=s.GetProfileImageURL($.UserUUID);break;case ee.USER_DATA_SOURCE_DISPLAY_NAME:q[F.LayoutItemUUID]=$.User.DisplayName;break;case ee.USER_DATA_SOURCE_EMAIL:q[F.LayoutItemUUID]=$.User.Additional.Email;break;case ee.USER_DATA_SOURCE_HANDLE:q[F.LayoutItemUUID]=$.User.Handle;break;case ee.USER_DATA_SOURCE_DATE_OF_BIRTH:q[F.LayoutItemUUID]=$.User.Additional.DOB;break;case ee.USER_DATA_SOURCE_FIRST_NAME:q[F.LayoutItemUUID]=$.User.Additional.FirstName;break;case ee.USER_DATA_SOURCE_LAST_NAME:q[F.LayoutItemUUID]=$.User.Additional.LastName;break;case ee.USER_DATA_SOURCE_TELEGRAM:q[F.LayoutItemUUID]="";break}else if(F.SourceType==="LAYOUT_ITEM_SOURCE_META"&&F.MetaField){const Pe=(it=E.value.find(k=>k.Type===pe.FORM_TYPE_REGISTRATION))==null?void 0:it.FormUUID,be=$.Submissions.find(k=>k.FormUUID===Pe);switch(F.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:q[F.LayoutItemUUID]=$;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:q[F.LayoutItemUUID]=Be;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:q[F.LayoutItemUUID]=$.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(be){const k=new Date(be.CreatedAt||"");q[F.LayoutItemUUID]=`${k.getFullYear()}-${(k.getMonth()+1).toString().padStart(2,"0")}-${k.getDate().toString().padStart(2,"0")} ${k.getHours().toString().padStart(2,"0")}:${k.getMinutes().toString().padStart(2,"0")}:${k.getSeconds().toString().padStart(2,"0")}`}else{const k=new Date($.CreatedAt||"");q[F.LayoutItemUUID]=`${k.getFullYear()}-${(k.getMonth()+1).toString().padStart(2,"0")}-${k.getDate().toString().padStart(2,"0")} ${k.getHours().toString().padStart(2,"0")}:${k.getMinutes().toString().padStart(2,"0")}:${k.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:q[F.LayoutItemUUID]=$.Submissions.map(k=>{const x=E.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:k,Registration:$}}).filter(k=>{var x;return((x=k.Form)==null?void 0:x.Type)===pe.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:q[F.LayoutItemUUID]=$.Submissions.map(k=>{const x=E.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:k,Registration:$}}).filter(k=>{var x;return((x=k.Form)==null?void 0:x.Type)===pe.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:q[F.LayoutItemUUID]=$.Submissions.map(k=>{const x=E.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:k,Registration:$}}).filter(k=>{var x;return((x=k.Form)==null?void 0:x.Type)===pe.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if($.Paid===0&&$.Total)q[F.LayoutItemUUID]="REQUIRED";else if($.Total>$.Paid)q[F.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const k=Be.find(x=>x.Paid===0&&(x.Total||0)>0);if(k){$.Total===0&&k.Total===0?q[F.LayoutItemUUID]="NOT_REQUIRED":$.Total===0&&k.Total||$.Total>0&&k.Total===0?q[F.LayoutItemUUID]="MISSING_REQUIRED":$.Paid>=$.Total?q[F.LayoutItemUUID]="AWAITING_PARTNER":q[F.LayoutItemUUID]="ALL_REQUIRED";break}else $.Total===0?q[F.LayoutItemUUID]="NOT_REQUIRED":q[F.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:wa($.Submissions,E.value),q[F.LayoutItemUUID]=$.Submissions.map(k=>{const x=E.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:x==null?void 0:x.Heading,Form:x,Submission:k,Registration:$}});break}}}}),q})}),a.value=!1)})}catch{}},kt=r=>{J.value=!1,r&&(_.value=r,ot())},ot=()=>{_.value.Panels.forEach(r=>{r.Items.forEach(d=>{(d.SectionField==null||d.SectionField.Field==null)&&E.value.find(R=>{R.Sections.find(O=>{if(O.Fields){const _e=O.Fields.find(le=>le.SectionFieldUUID===d.SectionFieldUUID);if(_e)return d.SectionField=_e,!0}})})})}),_.value.Panels.length>0&&(Y.value=[],_.value.Panels.forEach(r=>{const d={uuid:ke(),order:r.Order,name:r.Name,headers:[],items:[],layout:r};r.Items.sort((R,O)=>R.Order>O.Order?1:R.Order==O.Order?0:-1),d.headers=r.Items.map(R=>{var O,_e;return{key:R.LayoutItemUUID,title:R.Label||((_e=(O=R.SectionField)==null?void 0:O.Field)==null?void 0:_e.Label)||"",align:R.Align==="end"?"end":"start",sortable:Lt(R),type:Nt(R),defaultSort:R.DefaultSort}}),Y.value.push(d)}),Y.value=Y.value.sort((r,d)=>r.order>d.order?1:r.order==d.order?0:-1)),(ae.value==null||ae.value=="")&&Y.value.length>0&&(ae.value=Y.value[0].uuid)};m?U.getConvention(m).then(r=>{r&&(l.value=r,_.value.ConventionID=l.value.ID,_.value.ConventionUUID=l.value.ConventionUUID,bt())}).catch(()=>{n.push("/")}):n.push("/");const Nt=r=>{var d,R;if(r.SourceType===we.LAYOUT_ITEM_SOURCE_META)return`${r.SourceType}.${r.MetaField}`;if(r.SourceType===we.LAYOUT_ITEM_SOURCE_FORM)return(R=(d=r.SectionField)==null?void 0:d.Field)==null?void 0:R.Type;if(r.SourceType===we.LAYOUT_ITEM_SOURCE_USER)return`${r.SourceType}.${r.UserField}`},Lt=r=>{const d=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],R=[ee.USER_DATA_SOURCE_DISPLAY_NAME,ee.USER_DATA_SOURCE_EMAIL,ee.USER_DATA_SOURCE_HANDLE,ee.USER_DATA_SOURCE_DATE_OF_BIRTH,ee.USER_DATA_SOURCE_FIRST_NAME,ee.USER_DATA_SOURCE_LAST_NAME];return d.includes(r.MetaField)||R.includes(r.UserField)},Pt=r=>{de.value=r,Ie.value=!0},Ft=r=>{de.value=r,me.value=!0};ie(Ie,r=>{r||(de.value=void 0)}),ie(me,r=>{r||(de.value=void 0)});const Ke=async(r="")=>{Ne.value=await U.getRegistrationGroup(r)},wt=({registration:r,form:d,submission:R})=>{de.value=r,Ke(r.RegistrationUUID).then(()=>{ye.value=d,he.value=R,Ve.value=!0})};return I.on("registration.group.leave",r=>{U.leaveRegistrationGroup(r).then(d=>{d&&Ke(r).then(()=>{I.emit("registration.group.left",d)})})}),I.on("registration.group.remove.member",r=>{U.leaveRegistrationGroup(r).then(d=>{d&&Ke(r).then(()=>{I.emit("registration.group.left",d)})})}),(r,d)=>(u(),B(Ka,null,{default:o(()=>[t(At,{color:"blue-darken-4"},{default:o(()=>[t(ya,{modelValue:ae.value,"onUpdate:modelValue":d[0]||(d[0]=R=>ae.value=R),"show-arrows":""},{default:o(()=>[(u(!0),y(P,null,te(Y.value,R=>(u(),B(ga,{key:R.uuid,value:R.uuid},{default:o(()=>[w(V(R.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(qe),t(ne,{icon:"mdi:mdi-cog-outline",onClick:d[1]||(d[1]=R=>J.value=!0)})]),_:1}),t(Oa,{modelValue:ae.value,"onUpdate:modelValue":d[13]||(d[13]=R=>ae.value=R),disabled:!0},{default:o(()=>[(u(!0),y(P,null,te(Y.value,R=>(u(),B(Ca,{key:R.uuid,value:R.uuid},{default:o(()=>[R.uuid===ae.value?(u(),B(_t,{key:0,class:"pa-2"},{default:o(()=>[t(H(ao),{"items-per-page":g.value,"onUpdate:itemsPerPage":d[11]||(d[11]=O=>g.value=O),"sort-by":M.value,"onUpdate:sortBy":d[12]||(d[12]=O=>M.value=O),headers:R.headers,"items-length":b.value,items:R.items,"item-value":"LayoutItemUUID",loading:a.value,search:re.value,"onUpdate:options":Qe},He({top:o(()=>[t(Re,null,{default:o(()=>[t(W,null,{default:o(()=>[t(N,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ve,{modelValue:K.value,"onUpdate:modelValue":d[2]||(d[2]=O=>K.value=O),label:"Search by Badge",clearable:!0,"hide-details":"","onClick:clear":d[3]||(d[3]=O=>re.value=Date.now().toString()),onInput:d[4]||(d[4]=O=>re.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(ve,{modelValue:S.value,"onUpdate:modelValue":d[5]||(d[5]=O=>S.value=O),label:"Search By Email",clearable:!0,"hide-details":"","onClick:clear":d[6]||(d[6]=O=>re.value=Date.now().toString()),onInput:d[7]||(d[7]=O=>re.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(se,{modelValue:f.value,"onUpdate:modelValue":d[8]||(d[8]=O=>f.value=O),label:"Search By Group",clearable:!0,"hide-details":"",items:v.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"12",sm:"6",lg:"3"},{default:o(()=>[t(se,{modelValue:L.value,"onUpdate:modelValue":d[9]||(d[9]=O=>L.value=O),label:"Search By Tag",clearable:!0,"hide-details":"",items:A.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[te(R.headers,O=>({name:`item.${O.key}`,fn:o(({item:_e})=>[t($o,{header:O,item:_e,accommodations:G.value,convention:l.value,extras:X.value,forms:E.value,interests:oe.value,tickets:z.value,venues:Me.value,onOpenActions:Pt,onOpenPayments:Ft,onReload:d[10]||(d[10]=le=>Qe({page:D.value,itemsPerPage:g.value,sortBy:C.value})),onShowForm:wt},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):j("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),J.value?(u(),B(oo,{key:0,title:"Edit Layout",modelValue:J.value,"onUpdate:modelValue":d[14]||(d[14]=R=>J.value=R),layout:_.value,onSave:kt},null,8,["modelValue","layout"])):j("",!0),de.value?(u(),y(P,{key:1},[Ie.value?(u(),B(Cn,{key:0,modelValue:Ie.value,"onUpdate:modelValue":d[15]||(d[15]=R=>Ie.value=R),registration:de.value,"onUpdate:registration":d[16]||(d[16]=R=>de.value=R),accommodations:G.value,convention:l.value,extras:X.value,forms:E.value,interests:oe.value,tickets:z.value,title:"Registration Status & Communications",venues:Me.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):me.value?(u(),B(gn,{key:1,modelValue:me.value,"onUpdate:modelValue":d[17]||(d[17]=R=>me.value=R),registration:de.value,"onUpdate:registration":d[18]||(d[18]=R=>de.value=R),accommodations:G.value,convention:l.value,extras:X.value,forms:E.value,interests:oe.value,tickets:z.value,title:"Registration Payments",venues:Me.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):j("",!0)],64)):j("",!0),Ve.value&&he.value&&ye.value?(u(),B(za,{key:2,modelValue:Ve.value,"onUpdate:modelValue":d[22]||(d[22]=R=>Ve.value=R),scrollable:!0,fullscreen:!0,persistent:!0},{default:o(()=>[t(_t,{class:"bg-red-darken-4"},{default:o(()=>[t(At,{color:"error"},{default:o(()=>[t(Qa,null,{default:o(()=>[w("Submission Editor - Admin Mode")]),_:1}),t(qe),t(ja,null,{default:o(()=>[t(ne,{icon:"mdi:mdi-window-close",onClick:d[19]||(d[19]=R=>Ve.value=!1)})]),_:1})]),_:1}),t(Ya,null,{default:o(()=>[t(la,{modelValue:ye.value,"onUpdate:modelValue":d[20]||(d[20]=R=>ye.value=R),admin:!0,convention:l.value,data:he.value,editable:!0,"registration-group":Ne.value,onClose:d[21]||(d[21]=R=>{Ve.value=!1,Qe({page:D.value,itemsPerPage:g.value,sortBy:C.value})})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):j("",!0)]),_:1}))}});export{rl as default};
