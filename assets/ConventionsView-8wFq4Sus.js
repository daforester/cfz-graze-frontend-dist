import{F as ee}from"./form-0fJbSFPv.js";import{P as te}from"./permission-7wLhDNXq.js";import{i as q,M as G,N as Q,r,k as B,w as W,n as d,q as c,v as e,f as t,C as N,P as j,_ as H,l as oe,A as D,y as ne,x,D as ae,B as A,V as le,Q as ie,F as se,W as ue}from"./index-a8q6Ntdw.js";import{a as J}from"./scopeId-iw13ZnG_.js";import{_ as re}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-NlKt2k_F.js";import{u as de}from"./useModel-CZZwDZBJ.js";import{_ as me}from"./ModelDialog.vue_vue_type_script_setup_true_lang-TfqBK97e.js";import{s as k}from"./index-OKsbKlsK.js";import{a as K}from"./VContainer-4cHB4H44.js";import{V as L,a as g}from"./VRow-y4zYVoIs.js";import{V as X}from"./VAvatar-wOQ2mJXI.js";import{V as Y}from"./VTextField-gnogsfg6.js";import{V as ve}from"./VTextarea-2BAjsoQ7.js";import{V as fe}from"./VCheckbox-esVoL_KS.js";import{V as ce}from"./VForm-kYpWEFbV.js";import{V as pe}from"./VFileInput-Rq-WwsVc.js";import{G as S}from"./group-7fhbY6WJ.js";import{C as P}from"./canDo-7AeBF7R5.js";import{C as ge}from"./canEditRegistrations-PnkBSpHE.js";import{G as Z}from"./userData-Zac3iixu.js";import{C as Ce,a as Ve,b as _e}from"./canConfigureProps-LUzNuXk3.js";import{V as Ue,a as De,b as Ie,c as z,d as Ne,e as Le}from"./VCard-MF7I9-f8.js";import{V as $}from"./VBtn-3I1RKA-t.js";import{C as we}from"./canEditOrganisation-X3YpYl3A.js";import{v as ye}from"./v4-yQnnJER4.js";import"./createSimpleFunctional-NU81K-zH.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-L9MSC6ws.js";import"./forwardRefs-WC4jJZ-m.js";import"./VDialog-ZzE7PiFA.js";import"./VToolbar-REsIz-7I.js";import"./VCheckboxBtn-HnjkpMdS.js";import"./VChip-BhPnSZjU.js";const Ee=(l=void 0,i=void 0)=>l===void 0?!1:i===void 0?P(l,S.GROUP_TYPE_CONVENTION).EditConvention:P(l,S.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).EditConvention,Te=(l,i)=>l===void 0?!1:P(l,S.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).ViewRegistration,xe=q({__name:"EditConventionDialog",props:G({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:G(["update:convention","delete","save"],["update:modelValue"]),setup(l,{emit:i}){const F=l,w=j(),o=J(),{title:p=""}=F,v=i,_=Q(l,"modelValue"),C=de(F,v,void 0,void 0,"convention"),n=r(B(C.value));W(C,()=>{n.value=B(C.value)});const U=r(`${o.GetConventionLogoURL(n.value.ConventionUUID)}?${new Date().getTime()}`),y=r(),b=r(),h=()=>{U.value=URL.createObjectURL(y.value.files[0])},R=()=>{v("delete")},s=()=>{n.value=B(C.value)},m=async()=>{var a;const u=new FormData((a=b.value)==null?void 0:a.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",n.value.ConventionUUID),await o.SaveConventionLogo(u)},I=u=>{m(),w.saveConvention(n.value).then(a=>{a?u&&u("Convention Data Saved").then(()=>{C.value=a,v("save",a)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,a)=>(d(),c(me,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=f=>_.value=f),onDelete:R,onReset:s,onSave:I,title:N(p),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(K,{class:"pa-0",fluid:!0},{default:e(()=>[t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(X,{class:"imgLogo mx-auto",src:U.value||""},null,8,["src"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(k).formLabelName,name:"Name",variant:"outlined",modelValue:n.value.Name,"onUpdate:modelValue":a[0]||(a[0]=f=>n.value.Name=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(ve,{label:N(k).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:n.value.Description,"onUpdate:modelValue":a[1]||(a[1]=f=>n.value.Description=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(k).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:n.value.DetailLink,"onUpdate:modelValue":a[2]||(a[2]=f=>n.value.DetailLink=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(Y,{label:N(k).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:n.value.Slug,"onUpdate:modelValue":a[3]||(a[3]=f=>n.value.Slug=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(fe,{label:N(k).formConventionVisible,name:"Visible",modelValue:n.value.Visible,"onUpdate:modelValue":a[4]||(a[4]=f=>n.value.Visible=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(L,null,{default:e(()=>[t(g,null,{default:e(()=>[t(ce,{ref_key:"conventionImageForm",ref:b,enctype:"multipart/form-data"},{default:e(()=>[t(pe,{label:N(k).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:h},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Oe=H(xe,[["__scopeId","data-v-003c7991"]]),be=(l,i)=>l===void 0?!1:P(l,S.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).ViewLostAndFound,Re=(l,i)=>l===void 0?!1:P(l,S.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).EditLostAndFound,ke=(l,i)=>l===void 0?!1:P(l,S.GROUP_TYPE_CONVENTION,i.ConventionUUID,i).ConfigureLostAndFound,Se=["innerHTML"],Pe={key:0,class:"text-green"},Fe={key:1,class:"text-red"},he={key:0,class:"text-green"},Ae={key:1,class:"text-red"},$e=q({__name:"ConventionCard",props:G({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:G(["delete"],["update:modelValue"]),setup(l,{emit:i}){const F=j(),w=i,o=Q(l,"modelValue"),p=J(),v=Z(),_=r(p.GetConventionLogoURL(o.value.ConventionUUID)),C=r(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),n=r(!1),U=r(!1),y=r(Ee(v,o.value)),b=r(ge(v,o.value)),h=r(Te(v,o.value)),R=r(Ce(v,o.value)),s=r(be(v,o.value)),m=r(Ve(v,o.value)),I=r(Re(v,o.value)),u=r(_e(v,o.value)),a=r(ke(v,o.value)),f=()=>{U.value=!1,_.value=`${p.GetConventionLogoURL(o.value.ConventionUUID)}?ts=${Date.now()}`},E=T=>{F.deleteConvention(o.value.ConventionUUID).then(V=>{V?T&&(T("Convention Deleted"),w("delete")):T&&T("Failed to Delete Convention"),setTimeout(()=>{n.value=!1},2e3)}).catch(()=>{T&&(T("Failed to Delete Organisation"),n.value=!1)})};return(T,V)=>{const M=oe("RouterLink");return d(),c(Le,null,{default:e(()=>[t(Ue,{class:"flex-1-1 align-content-start"},{default:e(()=>[_.value?(d(),c(X,{key:0,src:_.value,title:o.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),o.value.Name?(d(),c(De,{key:1},{default:e(()=>[x(ne(o.value.Name),1)]),_:1})):D("",!0),o.value.Description?(d(),c(Ie,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ae("div",{innerHTML:o.value.Description},null,8,Se)]),_:1})):D("",!0),t(z,{class:"px-0 pb-0"},{default:e(()=>[x(" Visibility:  "),o.value.Visible?(d(),A("span",Pe,"Visible")):(d(),A("span",Fe,"Hidden"))]),_:1}),t(z,{class:"px-0 pb-0"},{default:e(()=>[x(" Registration:  "),T.open?(d(),A("span",he,"Open")):(d(),A("span",Ae,"Closed"))]),_:1})]),_:1}),t(Ne,null,{default:e(()=>[t(L,{"no-gutters":""},{default:e(()=>[y.value?(d(),c(g,{key:0,class:"ma-1"},{default:e(()=>[t($,{variant:"tonal",color:"primary",onClick:V[0]||(V[0]=O=>U.value=!0),width:"100%"},{default:e(()=>[x("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),y.value?(d(),c(g,{key:2,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}`},{default:e(()=>[t($,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[x("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),h.value||b.value?(d(),c(g,{key:3,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/registrations`},{default:e(()=>[t($,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[x("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),R.value||s.value||m.value||I.value||u.value||a.value?(d(),c(g,{key:4,class:"ma-1"},{default:e(()=>[t(M,{to:`/admin/conventions/${o.value.Slug?o.value.Slug:o.value.ConventionUUID}/operations`},{default:e(()=>[t($,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>[x("Operations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0)]),_:1})]),_:1}),U.value?(d(),c(Oe,{key:0,modelValue:U.value,"onUpdate:modelValue":V[1]||(V[1]=O=>U.value=O),convention:o.value,"onUpdate:convention":V[2]||(V[2]=O=>o.value=O),onDelete:V[3]||(V[3]=O=>n.value=!0),onSave:f,title:`${o.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),n.value?(d(),c(re,{key:1,modelValue:n.value,"onUpdate:modelValue":V[4]||(V[4]=O=>n.value=O),"confirmation-text":"I UNDERSTAND",message:C.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:E},null,8,["modelValue","message"])):D("",!0)]),_:1})}}}),Ge=H($e,[["__scopeId","data-v-5c95f486"]]),Me=q({__name:"ConventionsView",emits:["pageTitle"],setup(l,{emit:i}){var R;i("pageTitle","Conventions");const w=j(),o=Z(),p=r([]),v=r([]),_=le();let C=((R=_.params.organisation)==null?void 0:R.toString())||"";const n=r();W(_,()=>{var s,m;C!==((s=_.params.organisation)==null?void 0:s.toString())&&(C=((m=_.params.organisation)==null?void 0:m.toString())||"",U())});const U=()=>{C?w.getOrganisation(C).then(s=>{s&&(n.value=s,w.getConventionList(s.OrganisationUUID).then(m=>{m&&(p.value=m,y())}))}).catch(()=>{}):w.getPermissionAccessList(te.PERMISSION_TYPE_NULL).then(s=>{s&&(p.value=s.Conventions,y())})},y=()=>{p.value.forEach(s=>{w.getConventionForms(s.ConventionUUID).then(m=>{m&&(v.value=[...v.value,...m])}).catch(m=>{console.error(m)})})},b=()=>{var s,m;if(n.value){const I={ID:0,ConventionUUID:ye(),OrganisationID:((s=n.value)==null?void 0:s.ID)||0,OrganisationUUID:((m=n.value)==null?void 0:m.OrganisationUUID)||ue,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};w.saveConvention(I).then(u=>{u&&p.value.push(u)})}},h=s=>{p.value.splice(s,1)};return U(),(s,m)=>(d(),c(K,null,{default:e(()=>[t(L,{class:"justify-center"},{default:e(()=>[(d(!0),A(se,null,ie(p.value,(I,u)=>(d(),c(g,{key:I.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var a,f;return[t(Ge,{modelValue:p.value[u],"onUpdate:modelValue":E=>p.value[u]=E,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((a=I.Organisation)==null?void 0:a.Slug)||((f=I.Organisation)==null?void 0:f.OrganisationUUID)||"",open:!!v.value.find(E=>E.ConventionUUID===I.ConventionUUID&&E.Type===N(ee).FORM_TYPE_REGISTRATION&&E.State.New),onDelete:E=>h(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(L,null,{default:e(()=>[n.value&&N(we)(N(o),n.value)?(d(),c(g,{key:0,class:"text-right"},{default:e(()=>[t($,{color:"primary",onClick:b},{default:e(()=>[x("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}}),Ut=H(Me,[["__scopeId","data-v-c7b95705"]]);export{Ut as default};
