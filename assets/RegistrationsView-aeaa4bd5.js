import{p as ea,n as ta,e as de,t as _e,c as Ma,G as Dt,v as t,H as L,x as Ve,I as Z,a0 as ie,a1 as Ae,r as c,K as ce,w as me,M as m,N,O as a,W as M,X as F,Q as C,V as S,a4 as X,P as V,S as x,a3 as ge,_ as dt,ac as Na,ad as La,E as He,k as wa,f as Pa,d as Fa,o as $a,ae as xt,a2 as qe,R as St,Y as aa,Z as la,aa as We,af as xa,ag as ot,z as Ba,u as Ga,ah as Ya,A as Ha,B as qa,D as ja,s as za,ai as it,aj as Bt,a7 as Qa,a6 as Ka,U as Wa}from"./index-5e9610d5.js";import{T as Ja,V as na,e as Xa,d as Za,c as el}from"./FormRenderer.vue_vue_type_style_index_0_lang-d9832ec8.js";import{F as Te,a as tl}from"./form-3a7bf7fd.js";import{u as tt,V as oa}from"./VCheckbox-50525c16.js";import{_ as at}from"./ModelDialog.vue_vue_type_script_setup_true_lang-6da934de.js";import{h as Ke,b as ia,a as al,c as ll,d as Gt,P as Rt,u as sa}from"./useDisplayTransactions-fcb65005.js";import{V as z,a as b}from"./VRow-2dd6ff78.js";import{V as st,a as Je}from"./VList-30600285.js";import{V as Ue}from"./copyToClipboard-6cd62eb4.js";import{u as ua,j as pe,V as ut,b as nl,m as ol,k as il,c as sl,d as ul,l as rl,a as dl,n as ml}from"./VContainer-a121345e.js";import{V as H,a as vl,u as cl}from"./VBtn-85ca600c.js";import{b as fl,c as ra,S as Ul,d as Yt}from"./submission-6136b51d.js";import{G as bt}from"./group-d2a77946.js";import{C as Ot}from"./canDo-c4127599.js";import{V as da}from"./VAvatar-0d242bdb.js";import{v as Ie}from"./v4-a960c1f4.js";import{s as pl}from"./sortSubmissions-4bc1d48e.js";import{a as ma,V as we}from"./scopeId-86c47b15.js";import{m as gl,k as _l,l as Al,n as Tl,o as yl,p as El,q as Il,u as Dl,r as Sl,s as Rl,t as Cl,v as Vl,w as bl,x as Ol,y as hl,z as Ht,A as qt,B as jt,g as va,h as ca,c as mt,d as vt,e as ht,b as ct,V as ft,a as fa,_ as Ua,j as pa,i as Le,f as Ct}from"./VWindowItem-6fea62d4.js";import{V as Pe,b as je,c as Fe,d as kt,e as be}from"./VCard-d5f91eb5.js";import{_ as Ze,V as ga}from"./SaveButton.vue_vue_type_script_setup_true_lang-8b718f2e.js";import{V as ue}from"./VTextField-f462974a.js";import{_ as _a}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-d5363697.js";import{a as Aa,V as Vt}from"./VToolbar-a99de392.js";import{V as kl}from"./VDivider-f11c8b5c.js";import{V as Ml}from"./VTextarea-806c93be.js";import{V as Nl,a as Ll}from"./VChip-f51d9f74.js";import{V as rt}from"./VDialog-98cf8317.js";import{V as wl}from"./VForm-b058db96.js";import{G as Mt}from"./userData-708fca36.js";import{V as Pl,a as Fl}from"./VAlert-818a5a4c.js";import{S as $l}from"./setupLogin-d224dc60.js";import{V as xl}from"./forwardRefs-6bd9ffa5.js";import{u as Et}from"./nil-d01db1aa.js";import{V as zt,a as Bl}from"./VTable-1653d6a1.js";import"./index-26b71cef.js";import"./VFileInput-e842c819.js";import"./createSimpleFunctional-7e2c2774.js";import"./VToolbarItems-53a1ef65.js";var et=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(et||{});const Gl=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Xe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Xe||{});const Yl=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var ae=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_ADMIN_FORM="META_DATA_SOURCE_ADMIN_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(ae||{});const Hl=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var se=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(se||{});const ql=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],jl=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},zl=e=>e===void 0?!1:Ot(e,bt.GROUP_TYPE_SYSTEM).ManageUsers,Ql=ea({itemsLength:{type:[Number,String],required:!0},...gl(),..._l(),...Al()},"VDataTableServer"),Kl=ta()({name:"VDataTableServer",props:Ql(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,f)=>!0},setup(e,f){let{emit:n,slots:i}=f;const{groupBy:o}=Tl(e),{sortBy:d,multiSort:l,mustSort:s}=yl(e),{page:u,itemsPerPage:A}=El(e),g=de(()=>parseInt(e.itemsLength,10)),{columns:p,headers:r}=Il(e,{groupBy:o,showSelect:_e(e,"showSelect"),showExpand:_e(e,"showExpand")}),{items:v}=Dl(e,p),{toggleSort:_}=Sl({sortBy:d,multiSort:l,mustSort:s,page:u}),{opened:w,isGroupOpen:Y,toggleGroup:R,extractRows:O}=Rl({groupBy:o,sortBy:d}),{pageCount:P,setItemsPerPage:K}=Cl({page:u,itemsPerPage:A,itemsLength:g}),{flatItems:G}=Vl(v,o,w),{isSelected:W,select:te,selectAll:T,toggleSelect:y,someSelected:I,allSelected:h}=bl(e,{allItems:v,currentPage:v}),{isExpanded:$,toggleExpand:ee}=Ol(e),fe=de(()=>O(v.value));hl({page:u,itemsPerPage:A,sortBy:d,groupBy:o,search:_e(e,"search")}),Ma("v-data-table",{toggleSort:_,sortBy:d}),Dt({VDataTableRows:{hideNoData:_e(e,"hideNoData"),noDataText:_e(e,"noDataText"),loading:_e(e,"loading"),loadingText:_e(e,"loadingText")}});const ne=de(()=>({page:u.value,itemsPerPage:A.value,sortBy:d.value,pageCount:P.value,toggleSort:_,setItemsPerPage:K,someSelected:I.value,allSelected:h.value,isSelected:W,select:te,selectAll:T,toggleSelect:y,isExpanded:$,toggleExpand:ee,isGroupOpen:Y,toggleGroup:R,items:fe.value,groupedItems:G.value,columns:p.value,headers:r.value}));ua(()=>{const[$e]=Ht.filterProps(e),[ze]=qt.filterProps(e),[xe]=jt.filterProps(e),[Be]=zt.filterProps(e);return t(zt,Ve({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Be),{top:()=>{var De;return(De=i.top)==null?void 0:De.call(i,ne.value)},default:()=>{var De,Oe,he,ye;return i.default?i.default(ne.value):t(L,null,[(De=i.colgroup)==null?void 0:De.call(i,ne.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(qt,Ve(ze,{sticky:e.fixedHeader}),i)]),(Oe=i.thead)==null?void 0:Oe.call(i,ne.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[i.body?i.body(ne.value):t(jt,Ve(xe,{items:G.value}),i)]),(he=i.tbody)==null?void 0:he.call(i,ne.value),(ye=i.tfoot)==null?void 0:ye.call(i,ne.value)])},bottom:()=>i.bottom?i.bottom(ne.value):t(Ht,$e,{prepend:i["footer.prepend"]})})})}}),Wl=F("br",null,null,-1),Jl=F("h3",null,"Assigned Accommodation",-1),Xl=F("br",null,null,-1),Zl=F("br",null,null,-1),en=F("h3",null,"Accommodation Preferences",-1),tn=F("h3",null,"Selected Tickets",-1),an=F("br",null,null,-1),ln=Z({__name:"EditAccommodationAssignmentDialog",props:ie({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ie(["update:field"],["update:modelValue"]),setup(e,{emit:f}){const n=e,{convention:i,registration:o,title:d=""}=n,l=ge(),s=Ae(e,"modelValue"),u=c({capacity:{max:T=>{var h;const y=P.value.find($=>$.room.RoomUUID===T);return!y||y.room.MaximumCapacity===0?!0:(((h=r.value)==null?void 0:h.Members.length)||0)<=y.room.MaximumCapacity||"Too many people in the group for this room"},min:T=>{var h;const y=P.value.find($=>$.room.RoomUUID===T);return!y||y.room.MinimumCapacity===0?!0:(((h=r.value)==null?void 0:h.Members.length)||0)>=y.room.MinimumCapacity||"Not enough people in the group for this room"}}}),A=c([]),g=tt(n,f,void 0,void 0,"field"),p=c(ce(g.value));me(g,()=>{p.value=ce(g.value)});const r=c(),v=c(""),_=c(""),w=c([]),Y=c({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),R=async()=>{var h;const T=await l.getConventionAvailableAccommodation(i.ConventionUUID);T&&(A.value=T);const y=await l.getRegistrationGroup(o.RegistrationUUID||"");y&&(r.value=y);const I=await l.getConventionTickets(i.ConventionUUID);I&&(w.value=I);try{Y.value=JSON.parse(((h=r.value)==null?void 0:h.TicketData)||"")}catch{}};me(v,()=>{_.value=P.value.length>0?P.value[0].value:""});const O=de(()=>{const T=K.value;return A.value.map(y=>{let I;return T.forEach(h=>{y.Costs.forEach($=>{$.DateStart===(h==null?void 0:h.DateStart)&&$.DateEnd===h.DateEnd&&(I===void 0||I>$.Availability)&&(I=$.Availability)})}),{label:`${y.Name}`,title:`${y.Name} (${I} Available)`,value:y.AccommodationUUID}})}),P=de(()=>{const T=K.value,y=A.value.find(I=>I.AccommodationUUID===v.value);return(y==null?void 0:y.Pool.map(I=>{var $,ee;let h;return T.forEach(fe=>{I.Costs.forEach(ne=>{ne.DateStart===(fe==null?void 0:fe.DateStart)&&ne.DateEnd===fe.DateEnd&&(h===void 0||h>ne.Availability)&&(h=ne.Availability)})}),{label:`${($=I.Venue)==null?void 0:$.Name} - ${I.Name}`,title:`${(ee=I.Venue)==null?void 0:ee.Name} - ${I.Name} (${h} Available)`,value:I.RoomUUID,room:I}}))||[]}),K=de(()=>[...Y.value.Ticket,...Y.value.AddonsChecked,...Y.value.ComponentsChecked].map(T=>w.value.find(y=>y.TicketUUID===T)).filter(T=>T!==void 0&&T.RequiresAccommodation)),G=T=>{var y;l.assignAccommodation(((y=r.value)==null?void 0:y.Registration.RegistrationUUID)||"",v.value,_.value,!1).then(I=>{I?(R(),T&&T("Room Assigned")):T&&T("Room not assigned")}).catch(()=>{T&&T("Room not assigned")})},W=T=>{var y,I;(y=r.value)!=null&&y.Registration.AllocationUUID?l.deleteAllocation(((I=r.value)==null?void 0:I.Registration.AllocationUUID)||"").then(h=>{h?(R(),T&&T("Allocation Deleted")):T&&T("Allocation not deleted")}).catch(()=>{T&&T("Allocation not deleted")}):T&&T("Nothing to Delete")},te=T=>{var I,h;const y=(I=A.value.find($=>$.AccommodationUUID===T.AccommodationUUID))==null?void 0:I.Pool;if(y){const $=y.find(ee=>ee.RoomUUID===T.RoomUUID);if($)return`${(h=$.Venue)==null?void 0:h.Name} - ${$.Name}`}return""};return R(),(T,y)=>{var I;return m(),N(at,{modelValue:s.value,"onUpdate:modelValue":y[2]||(y[2]=h=>s.value=h),title:M(d),color:"primary","show-close-action":!0,"show-delete-action":!!((I=r.value)!=null&&I.Registration.Allocation),"show-save-action":!!_.value,"save-button-label":"Assign Room",onDelete:W,onSave:G,fullscreen:!0,persistent:!0},{default:a(()=>[t(pe,{class:"pa-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>{var h;return[t(b,{cols:"12",md:"6"},{default:a(()=>{var $,ee;return[F("h3",null,"Group Members ("+C(($=r.value)==null?void 0:$.Members.length)+")",1),(m(!0),S(L,null,X((ee=r.value)==null?void 0:ee.Members,fe=>(m(),S(L,{key:fe.UUID},[V(" #"+C(fe.Reference)+" "+C(fe.Name),1),Wl],64))),128))]}),_:1}),(h=r.value)!=null&&h.Registration.Allocation?(m(),N(b,{key:0,cols:"12",md:"6"},{default:a(()=>[Jl,t(st,null,{default:a(()=>{var $;return[(m(!0),S(L,null,X(($=r.value)==null?void 0:$.Registration.Allocation.Periods,ee=>(m(),N(Je,{key:ee.AllocationPeriodUUID},{default:a(()=>{var fe;return[V(C((fe=A.value.find(ne=>ne.AccommodationUUID===ee.AccommodationUUID))==null?void 0:fe.Name)+" ",1),Xl,V(" "+C(te(ee))+" ",1),Zl,F("small",null,"("+C(M(Ke)(ee.DateStart))+" - "+C(M(Ke)(ee.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):x("",!0)]}),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12",md:"6"},{default:a(()=>[T.selectedAccommodation.length?(m(),S(L,{key:0},[en,t(st,null,{default:a(()=>[(m(!0),S(L,null,X(T.selectedAccommodation,(h,$)=>(m(),N(Je,{key:h.AccommodationUUID},{default:a(()=>[V(C($+1)+". "+C(h.Name),1)]),_:2},1024))),128))]),_:1})],64)):x("",!0)]),_:1}),t(b,{cosl:"12",md:"6"},{default:a(()=>[tn,t(st,null,{default:a(()=>[(m(!0),S(L,null,X(K.value,h=>(m(),N(Je,{key:h==null?void 0:h.TicketUUID},{default:a(()=>[V(C(h.Name)+" ",1),an,F("small",null,"("+C(M(Ke)(h.DateStart))+" - "+C(M(Ke)(h.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12",md:"6"},{default:a(()=>[t(Ue,{modelValue:v.value,"onUpdate:modelValue":y[0]||(y[0]=h=>v.value=h),items:O.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",md:"6"},{default:a(()=>[t(Ue,{modelValue:_.value,"onUpdate:modelValue":y[1]||(y[1]=h=>_.value=h),items:P.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[u.value.capacity.min,u.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),nn={key:0,class:"accommodationList"},on={key:0,class:"text-orange-darken-2"},sn=Z({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const f=c(!1),n=de(()=>{if(!e.value)return[];const o=JSON.parse(e.value),d=e.accommodations.filter(l=>o.includes(l.AccommodationUUID)).sort((l,s)=>{const u=o.findIndex(g=>g===l.AccommodationUUID),A=o.findIndex(g=>g===s.AccommodationUUID);return u>A?1:-1});return ce(d)}),i=de(()=>{let o;const d=e.forms.find(l=>l.Sections.find(s=>{var u;return(u=s.Fields)==null?void 0:u.find(A=>{var g;if(((g=A.Field)==null?void 0:g.Type)==="TICKET")return o=A,!0})}));return o?!!e.registration.Submissions.find(l=>{if(l.FormUUID==(d==null?void 0:d.FormUUID))return l.Data.find(s=>{if(s.SectionFieldUUID==(o==null?void 0:o.SectionFieldUUID)){const u=JSON.parse(s.Data);return e.tickets.filter(A=>A.RequiresAccommodation).find(A=>u.Ticket.includes(A.TicketUUID)||u.AddonsChecked.includes(A.TicketUUID)||u.ComponentsChecked.includes(A.TicketUUID))}})}):!1});return(o,d)=>i.value?(m(),S(L,{key:0},[o.value?(m(),S("ol",nn,[(m(!0),S(L,null,X(n.value,l=>(m(),S("li",{key:l.AccommodationUUID},[o.registration&&o.registration.Allocation&&o.registration.Allocation.Periods.find(s=>s.AccommodationUUID===l.AccommodationUUID)?(m(),S("strong",on,C(l.Name),1)):(m(),S(L,{key:1},[V(C(l.Name),1)],64))]))),128))])):x("",!0),t(H,{onClick:d[0]||(d[0]=l=>f.value=!0),variant:"flat",color:"success"},{default:a(()=>[V("Assign Accommodation")]),_:1}),o.convention&&f.value?(m(),N(ln,{key:1,modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=l=>f.value=l),title:"Accommodation Allocation",convention:o.convention,registration:o.registration,"selected-accommodation":n.value},null,8,["modelValue","convention","registration","selected-accommodation"])):x("",!0)],64)):x("",!0)}});const un=dt(sn,[["__scopeId","data-v-7a102d46"]]),rn={key:0,class:"addonList"},dn={key:0},mn={key:0},vn=Z({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const f=de(()=>{if(!e.value)return;const n=JSON.parse(e.value),i=Object.keys(n),o=ce(e.extras);return o.forEach(d=>{d.Options=d.Options.filter(l=>i.includes(l.OptionUUID)?(l.Choices=l.Choices.filter(s=>s.TagUUID===n[l.OptionUUID].choiceId),n[l.OptionUUID].checked):!1)}),o.filter(d=>d.Options.length>0),o});return(n,i)=>n.value?(m(),S("ul",rn,[(m(!0),S(L,null,X(f.value,o=>(m(),S(L,{key:o.ExtraUUID},[o.Options.length?(m(),S("li",dn,[F("strong",null,C(o.Name),1),F("ul",null,[(m(!0),S(L,null,X(o.Options,d=>(m(),S("li",{key:d.OptionUUID},[V(C(d.Name)+" ",1),d.Choices.length==1?(m(),S("small",mn,"("+C(d.Choices[0].Title)+")",1)):x("",!0)]))),128))])])):x("",!0)],64))),128))])):x("",!0)}});const cn=dt(vn,[["__scopeId","data-v-55786e01"]]),fn={key:0},Un=Z({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const f=de(()=>{if(!e.value)return;const n=JSON.parse(e.value);return Object.entries(n).filter(([,i])=>i).map(([i,o])=>e.interests.find(d=>d.InterestUUID===i)).filter(i=>i!==void 0)});return(n,i)=>n.value?(m(),S("ul",fn,[(m(!0),S(L,null,X(f.value,o=>(m(),S("li",{key:o.InterestUUID},C(o.Name),1))),128))])):x("",!0)}}),pn=F("br",null,null,-1),gn=F("small",null,"Options:",-1),_n=F("br",null,null,-1),An=F("small",null,"Addons:",-1),Tn=Z({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const f=de(()=>{if(!e.value)return;let n={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{n=JSON.parse(e.value),"ticket"in n&&(n.Ticket=n.ticket),"addonsChecked"in n&&(n.AddonsChecked=n.addonsChecked),"componentsChecked"in n&&(n.ComponentsChecked=n.componentsChecked)}catch{}return n.Ticket.filter(i=>{const o=e.tickets.find(d=>d.TicketUUID===i);return!(!o||o.Type!==Ja.TICKET_TYPE_TICKET)}).map(i=>{const o=e.tickets.find(l=>l.TicketUUID===i),d=ce(o);return d.TicketComponents=o.TicketComponents.filter(l=>n.ComponentsChecked.includes(l.TicketUUID)),d.AddonTickets=o.AddonTickets.filter(l=>n.AddonsChecked.includes(l.TicketUUID)),d})});return(n,i)=>n.value?(m(!0),S(L,{key:0},X(f.value,o=>(m(),S("div",{key:o.TicketUUID},[F("strong",null,C(o.Name),1),o.TicketComponents.length>0?(m(),S(L,{key:0},[pn,gn,V("  "),(m(!0),S(L,null,X(o.TicketComponents,d=>(m(),S(L,{key:d.TicketUUID},[F("small",null,C(d.Name),1),V("  ")],64))),128))],64)):x("",!0),o.AddonTickets.length>0?(m(),S(L,{key:1},[_n,An,V("  "),(m(!0),S(L,null,X(o.AddonTickets,d=>(m(),S("small",{key:d.TicketUUID},[V("("),F("em",null,C(d.Name),1),V(")")]))),128))],64)):x("",!0)]))),128)):x("",!0)}}),yn={class:"text-grey-lighten-1"},En={key:0,class:"text-blue text-center"},In={key:1,class:"text-red text-center"},Dn={key:2,class:"text-orange text-center"},Sn={key:3,class:"text-orange text-center"},Rn={key:4,class:"text-orange text-center"},Cn={key:5,class:"text-orange text-center"},Vn={key:6,class:"text-green text-center"},bn={key:0},On={key:0},hn=F("strong",null,"Total:",-1),kn=Z({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},user:{},venues:{}},emits:["openActions","openPayments","openTags","reload","showForm","switchUser"],setup(e,{emit:f}){const n=(l,s,u)=>{f("showForm",{registration:l,form:s,submission:u})},i=l=>{f("openActions",l)},o=l=>{f("switchUser",l)},d=l=>{const s=e.item.raw.registration;return{ID:0,SubmissionUUID:Ie(),FormID:l.ID,FormUUID:l.FormUUID,Form:l,UserID:s.UserID,UserUUID:s.UserUUID,RegistrationID:s.ID,RegistrationUUID:s.RegistrationUUID,Registration:s,Data:[],Status:Ul.SUBMISSION_STATUS_NULL}};return(l,s)=>l.header.type==="ACCOMMODATION"&&l.accommodations.length>0&&l.item.raw[l.header.key]?(m(),N(un,{key:0,value:l.item.raw[l.header.key].Data,accommodations:l.accommodations,convention:l.convention,forms:l.forms,tickets:l.tickets,venues:l.venues,registration:l.item.raw[l.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):l.header.type==="EXTRAS"&&l.extras.length>0?(m(),N(cn,{key:1,value:l.item.raw[l.header.key],extras:l.extras},null,8,["value","extras"])):l.header.type==="INTERESTS"&&l.interests.length>0?(m(),N(Un,{key:2,value:l.item.raw[l.header.key],interests:l.interests},null,8,["value","interests"])):l.header.type==="TICKET"&&l.tickets.length>0?(m(),N(Tn,{key:3,value:l.item.raw[l.header.key],tickets:l.tickets},null,8,["value","tickets"])):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ADMIN_FORM"||l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(m(),S(L,{key:4},[F("ul",null,[(m(!0),S(L,null,X(l.forms.filter(u=>u.Type===M(Te).FORM_TYPE_ADMIN&&l.item.raw[l.header.key].findIndex(A=>A.Form.ID===u.ID)<0),u=>(m(),S("li",{key:u.Heading},[F("strong",yn,C(u.Heading),1),t(H,{class:"text-grey-lighten-1",icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:A=>n(l.item.raw.registration,u,d(u))},null,8,["onClick"])]))),128))]),F("ul",null,[(m(!0),S(L,null,X(l.item.raw[l.header.key],u=>(m(),S("li",{key:u.Heading},[F("strong",null,[V(C(u.Heading),1),u.Form.Type!==M(Te).FORM_TYPE_ADMIN?(m(),S(L,{key:0},[V(": ")],64)):x("",!0)]),u.Form.Type!==M(Te).FORM_TYPE_ADMIN?(m(),S("span",{key:0,class:Na(M(fl)(u.Submission.Status))},C(M(ra)(u.Submission.Status)),3)):x("",!0),t(H,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:A=>n(u.Registration,u.Form,u.Submission)},null,8,["onClick"])]))),128))])],64)):l.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(m(),N(da,{key:5,class:"rounded-circle",src:l.item.raw[l.header.key],height:"32",width:"32"},null,8,["src"])):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(m(),S(L,{key:6},[l.item.raw[l.header.key]=="NOT_REQUIRED"?(m(),S("div",En,"No Payment Requested")):l.item.raw[l.header.key]=="MISSING_REQUIRED"?(m(),S("div",In,"Partner Payment Not Requested")):l.item.raw[l.header.key]=="AWAITING_PARTNER"?(m(),S("div",Dn,"Awaiting Partner Payment")):l.item.raw[l.header.key]=="ALL_REQUIRED"?(m(),S("div",Sn,"Awaiting Payments")):l.item.raw[l.header.key]=="REQUIRED"?(m(),S("div",Rn,"Awaiting Payment")):l.item.raw[l.header.key]=="ADDITIONAL_REQUIRED"?(m(),S("div",Cn,"Awaiting Additional Payments")):(m(),S("div",Vn,"Completed"))],64)):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(m(),S(L,{key:7},[t(H,{icon:"mdi:mdi-briefcase",variant:"flat",onClick:s[0]||(s[0]=u=>i(l.item.raw[l.header.key]))}),M(zl)(l.user)?(m(),N(H,{key:0,icon:"mdi:mdi-account-switch-outline",variant:"flat",onClick:s[1]||(s[1]=u=>o(l.item.raw[l.header.key]))})):x("",!0)],64)):l.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(m(),S(L,{key:8},[l.item.raw[l.header.key].length===1?(m(),S("em",bn," Not in a group ")):(m(),S(L,{key:1},[F("ul",null,[(m(!0),S(L,null,X(l.item.raw[l.header.key],u=>(m(),S("li",{key:u.UUID,class:"ml-0"},[V(" #"+C(u.Reference)+" : "+C(u.Name)+" ",1),u.IsLeader?(m(),S("strong",On,"(Leader)")):x("",!0)]))),128))]),hn,V(" "+C(l.item.raw[l.header.key].length),1)],64))],64)):(m(),S(L,{key:9},[V(C(l.item.raw[l.header.key]),1)],64))}}),Qt=Z({__name:"RegistrationActionTabs",props:ie({alignTabs:{},class:{},fixedTabs:{type:Boolean},showArrows:{type:[String,Boolean]},tabs:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const f=e,n=Ae(e,"modelValue");return(i,o)=>(m(),N(va,Ve({modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=d=>n.value=d)},f),{default:a(()=>[(m(!0),S(L,null,X(i.tabs,d=>(m(),N(ca,{value:d.value,key:d.value},{default:a(()=>[V(C(d.label),1)]),_:2},1032,["value"]))),128))]),_:1},16,["modelValue"]))}}),Mn=Z({__name:"Badges",props:{convention:{},registration:{}},setup(e){const f=ge(),n=ma(),i=c([]),o=l=>{var u;const s=document.createElement("a");s.download=`${((u=e.convention)==null?void 0:u.Name)||""} Badge Image - ${e.registration.Reference} - ${e.registration.User.DisplayName}.jpg`,s.href=l,document.body.appendChild(s),s.click(),document.body.removeChild(s)},d=async l=>n.GetConBadgeImageURL(e.registration.RegistrationUUID,l);return f.getConBadgeList(e.registration.RegistrationUUID).then(l=>{l.forEach(s=>{d(s).then(u=>{i.value.push({template:s,url:u})})})}).catch(()=>{}),(l,s)=>(m(!0),S(L,null,X(i.value,u=>(m(),N(be,{key:u.template},{default:a(()=>[t(je,null,{default:a(()=>[t(Pe,null,{default:a(()=>[t(z,{class:"flex-row-reverse"},{default:a(()=>[t(b,{class:"text-wrap flex-grow-1"},{default:a(()=>[V(" Badges (#"+C(l.registration.Reference)+" "+C(l.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[t(da,{src:u.url,height:"280",width:"280"},null,8,["src"])]),_:2},1024),t(kt,null,{default:a(()=>[t(H,{color:"primary","prepend-icon":"mdi:mdi-download",variant:"flat",onClick:A=>o(u.url)},{default:a(()=>[V("Download")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))}});var Nn=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Ln=function(e){return Nn.map(function(f){return f.toLowerCase()}).indexOf(e.toLowerCase())!==-1},wn=function(e,f,n){Object.keys(f).filter(Ln).forEach(function(i){var o=f[i];typeof o=="function"&&(i==="onInit"?o(e,n):n.on(i.substring(2),function(d){return o(d,n)}))})},Pn=function(e,f,n,i){var o=e.modelEvents?e.modelEvents:null,d=Array.isArray(o)?o.join(" "):o;me(i,function(l,s){n&&typeof l=="string"&&l!==s&&l!==n.getContent({format:e.outputFormat})&&n.setContent(l)}),n.on(d||"change input undo redo",function(){f.emit("update:modelValue",n.getContent({format:e.outputFormat}))})},Fn=function(e,f,n,i,o,d){i.setContent(d()),n.attrs["onUpdate:modelValue"]&&Pn(f,n,i,o),wn(e,n.attrs,i)},Kt=0,Ta=function(e){var f=Date.now(),n=Math.floor(Math.random()*1e9);return Kt++,e+"_"+n+Kt+String(f)},$n=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Wt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},xn=function(e,f){return Wt(e).concat(Wt(f))},Bn=function(e){return e==null},Jt=function(){return{listeners:[],scriptId:Ta("tiny-script"),scriptLoaded:!1}},Gn=function(){var e=Jt(),f=function(o,d,l,s){var u=d.createElement("script");u.referrerPolicy="origin",u.type="application/javascript",u.id=o,u.src=l;var A=function(){u.removeEventListener("load",A),s()};u.addEventListener("load",A),d.head&&d.head.appendChild(u)},n=function(o,d,l){e.scriptLoaded?l():(e.listeners.push(l),o.getElementById(e.scriptId)||f(e.scriptId,o,d,function(){e.listeners.forEach(function(s){return s()}),e.scriptLoaded=!0}))},i=function(){e=Jt()};return{load:n,reinitialize:i}},Yn=Gn(),Hn=function(){return typeof window<"u"?window:global},Ne=function(){var e=Hn();return e&&e.tinymce?e.tinymce:null},qn={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},Se=globalThis&&globalThis.__assign||function(){return Se=Object.assign||function(e){for(var f,n=1,i=arguments.length;n<i;n++){f=arguments[n];for(var o in f)Object.prototype.hasOwnProperty.call(f,o)&&(e[o]=f[o])}return e},Se.apply(this,arguments)},jn=function(e,f,n,i){return e(i||"div",{id:f,ref:n})},zn=function(e,f,n){return e("textarea",{id:f,visibility:"hidden",ref:n})},It={selector:void 0,target:void 0},Qn=Z({props:qn,setup:function(e,f){var n=e.init?Se(Se({},e.init),It):Se({},It),i=La(e),o=i.disabled,d=i.modelValue,l=i.tagName,s=c(null),u=null,A=e.id||Ta("tiny-vue"),g=e.init&&e.init.inline||e.inline,p=!!f.attrs["onUpdate:modelValue"],r=!0,v=e.initialValue?e.initialValue:"",_="",w=function(O){return p?function(){return d!=null&&d.value?d.value:""}:function(){return O?v:_}},Y=function(){var O=w(r),P=Se(Se({},n),{readonly:e.disabled,target:s.value,plugins:xn(n.plugins,e.plugins),toolbar:e.toolbar||n.toolbar,inline:g,setup:function(K){u=K,K.on("init",function(G){return Fn(G,e,f,K,d,O)}),typeof n.setup=="function"&&n.setup(K)}});$n(s.value)&&(s.value.style.visibility=""),Ne().init(P),r=!1};me(o,function(O){var P;u!==null&&(typeof((P=u.mode)===null||P===void 0?void 0:P.set)=="function"?u.mode.set(O?"readonly":"design"):u.setMode(O?"readonly":"design"))}),me(l,function(O){var P;p||(_=u.getContent()),(P=Ne())===null||P===void 0||P.remove(u),He(function(){return Y()})}),wa(function(){if(Ne()!==null)Y();else if(s.value&&s.value.ownerDocument){var O=e.cloudChannel?e.cloudChannel:"6",P=e.apiKey?e.apiKey:"no-api-key",K=Bn(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(P,"/tinymce/").concat(O,"/tinymce.min.js"):e.tinymceScriptSrc;Yn.load(s.value.ownerDocument,K,Y)}}),Pa(function(){Ne()!==null&&Ne().remove(u)}),g||(Fa(function(){r||Y()}),$a(function(){var O;p||(_=u.getContent()),(O=Ne())===null||O===void 0||O.remove(u)}));var R=function(O){var P;_=u.getContent(),(P=Ne())===null||P===void 0||P.remove(u),n=Se(Se(Se({},n),O),It),He(function(){return Y()})};return f.expose({rerender:R,getEditor:function(){return u}}),function(){return g?jn(xt,A,s,e.tagName):zn(xt,A,s)}}});const Kn=["colspan"],Wn=F("strong",null,"E-Mail Content",-1),Jn=["innerHTML"],Xn=Z({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:f}){const n=ge(),i=c([]),o=c({From:"",Subject:"",HTML:""}),d=c(""),l=c(""),s=c(""),u=c(!1),A=c([]),g=c(["1"]),p=c([]),r=c([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),v=c([{key:"CreatedAt",order:"asc"}]);me(o,R=>{s.value=R.From||s.value||"",l.value=R.Subject||l.value||"",d.value=R.HTML||d.value||""});const _=()=>{n.getRegistrationEmails(e.registration.RegistrationUUID).then(R=>{R&&(R.forEach(O=>{O.CreatedAt=ia(new Date(O.CreatedAt||"")),O.Status=jl(O.Status),O.User||(O.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),p.value=R)})};_(),(()=>{n.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(R=>{R&&(i.value=R)})})();const Y=({callback:R})=>{n.sendRegistrationEmail(e.registration.RegistrationUUID,s.value,l.value,d.value).then(O=>{O?R&&(R("Email Sent"),_(),setTimeout(()=>{u.value=!1},2e3)):R&&R("Not sent")}).catch(()=>{R&&R("Not sent")})};return(R,O)=>(m(),S(L,null,[R.showEditor?(m(),S(L,{key:0},[t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[t(na,{items:i.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:o.value,"onUpdate:modelValue":O[0]||(O[0]=P=>o.value=P),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12"},{default:a(()=>[t(ue,{modelValue:s.value,"onUpdate:modelValue":O[1]||(O[1]=P=>s.value=P),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:a(()=>[t(ue,{modelValue:l.value,"onUpdate:modelValue":O[2]||(O[2]=P=>l.value=P),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:a(()=>[t(M(Qn),{modelValue:d.value,"onUpdate:modelValue":O[3]||(O[3]=P=>d.value=P),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[t(Ze,{onClick:O[4]||(O[4]=P=>f("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(b,{class:"text-right"},{default:a(()=>[t(Ze,{onClick:Y,label:"Send",color:"error"})]),_:1})]),_:1})],64)):x("",!0),p.value.length&&!R.hideHistory?(m(),N(ft,{key:1,class:"my-2",multiple:!0,modelValue:g.value,"onUpdate:modelValue":O[7]||(O[7]=P=>g.value=P)},{default:a(()=>[t(ct,{value:"1"},{default:a(()=>[t(mt,null,{default:a(()=>[V(" Email History ")]),_:1}),t(vt,null,{default:a(()=>[t(M(ht),{items:p.value,headers:r.value,"show-expand":!0,"item-value":"EmailUUID",expanded:A.value,"onUpdate:expanded":O[5]||(O[5]=P=>A.value=P),"sort-by":v.value,"onUpdate:sortBy":O[6]||(O[6]=P=>v.value=P)},{"expanded-row":a(({columns:P,item:K})=>[F("tr",null,[F("td",{colspan:P.length},[Wn,F("div",{class:"communicationsViewEmailPreview",innerHTML:K.raw.HTML},null,8,Jn)],8,Kn)])]),"footer.prepend":a(()=>[t(H,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:_},{default:a(()=>[V("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):x("",!0)],64))}});const Zn=Z({__name:"Emails",props:{registration:{}},setup(e){const f=c(!1);return(n,i)=>(m(),N(be,null,{default:a(()=>[t(je,null,{default:a(()=>[t(Pe,null,{default:a(()=>[V(" E-Mails (#"+C(n.registration.Reference)+" "+C(n.registration.User.DisplayName)+") ",1)]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12"},{default:a(()=>[t(H,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:i[0]||(i[0]=o=>f.value=!0)},{default:a(()=>[V("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Xn,{registration:n.registration,"show-editor":f.value,onCloseEditor:i[1]||(i[1]=o=>f.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1}))}}),eo=Z({__name:"EditNoteCategoryDialog",props:ie({convention:{},noteCategory:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ie(["update:noteCategory"],["update:modelValue"]),setup(e,{emit:f}){const n=e,{title:i=""}=n,o=Ae(e,"modelValue"),d=tt(n,f,void 0,void 0,"noteCategory"),l=c(ce(d.value));me(d,()=>{l.value=ce(d.value)});const s=()=>{o.value=!1},u=()=>{l.value=ce(d.value)},A=()=>{d.value=l.value};return(g,p)=>(m(),N(at,{modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=r=>o.value=r),onReset:u,onSave:A,title:M(i),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0},{default:a(()=>[t(pe,{class:"pa-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6",md:"4"},{default:a(()=>[t(ue,{modelValue:l.value.Name,"onUpdate:modelValue":p[0]||(p[0]=r=>l.value.Name=r),label:"Internal name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"4"},{default:a(()=>[t(fa,{modelValue:l.value.Groups,"onUpdate:modelValue":p[1]||(p[1]=r=>l.value.Groups=r),convention:g.convention,label:"Groups",variant:"outlined","hide-details":""},null,8,["modelValue","convention"])]),_:1})]),_:1})]),_:1})]),actions:a(()=>[t(H,{color:"blue-darken-1",variant:"text",onClick:s},{default:a(()=>[V(" Cancel ")]),_:1}),t(H,{color:"blue-darken-1",variant:"text",onClick:u},{default:a(()=>[V(" Reset ")]),_:1}),t(we),t(H,{color:"blue-darken-1",variant:"text",onClick:A},{default:a(()=>[V(" Save ")]),_:1})]),_:1},8,["modelValue","title"]))}}),to=()=>{const e=c(""),f=()=>{const n={x:window.innerWidth,y:window.innerHeight};n.x<600?e.value="xs":n.x>=600&&n.x<960?e.value="sm":n.x>=960&&n.x<1280?e.value="md":n.x>=1280&&n.x<1920?e.value="lg":n.x>=1920&&n.x<2560?e.value="xl":n.x>=2560&&(e.value="xxl")};return window.addEventListener("resize",f),f(),e},ao={style:{"list-style":"none"}},lo=Z({__name:"NoteCategories",props:{hideHistory:{type:Boolean},convention:{},showEditor:{type:Boolean}},emits:["close"],setup(e,{emit:f}){const n=ge(),i=c(!1),o=c(!1),d=c(""),l=c([]),s=c([{key:"Name",title:"Name"},{key:"Groups",title:"Groups"},{key:"actions",title:"",sortable:!1}]),u=to();c([{key:"CreatedAt",order:"asc"}]);const A=()=>({ID:0,NoteCategoryUUID:Ie(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"",Groups:[],Notes:[]}),g=c(-1),p=c(A()),r=c(A()),v=()=>{r.value.NoteCategoryUUID=Ie(),p.value=Object.assign({},A()),g.value=-1,i.value=!0},_=G=>{g.value=l.value.indexOf(G),p.value=Object.assign({},G),i.value=!0},w=G=>{g.value=l.value.indexOf(G),p.value=Object.assign({},G),o.value=!0},Y=()=>{n.deleteNoteCategory(p.value.NoteCategoryUUID).then(G=>{G&&(l.value.splice(g.value,1),O())})},R=()=>{i.value=!1,He(()=>{p.value=Object.assign({},r.value),g.value=-1})},O=()=>{o.value=!1,He(()=>{p.value=Object.assign({},r.value),g.value=-1})},P=()=>{n.saveNoteCategory(p.value).then(G=>{G&&(g.value>-1?Object.assign(l.value[g.value],G):l.value.push(G),R())})};return(()=>{n.getNoteCategories(e.convention.ConventionUUID).then(G=>{G&&(l.value=G)})})(),(G,W)=>(m(),N(M(ht),{headers:s.value,items:l.value,"sort-by":[{key:"calories",order:"asc"}],class:"elevation-1"},{top:a(()=>[t(Vt,{color:"primary"},qe({default:a(()=>[t(Aa,null,{default:a(()=>[V("Note Categories")]),_:1}),t(kl,{class:"mx-4 d-none d-sm-inline-flex",inset:!0,vertical:!0}),t(we,{class:"d-none d-sm-inline-flex"}),M(u)!="xs"?(m(),N(H,{key:0,dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:v},{default:a(()=>[V(" New Item ")]),_:1})):x("",!0),t(H,{dark:"",class:"mb-2",icon:"mdi:mdi-window-close",onClick:W[0]||(W[0]=te=>f("close"))}),t(_a,{modelValue:o.value,"onUpdate:modelValue":W[1]||(W[1]=te=>o.value=te),onDelete:Y},null,8,["modelValue"])]),_:2},[M(u)=="xs"?{name:"extension",fn:a(()=>[t(we),t(H,{dark:"",class:"mb-2","prepend-icon":"mdi:mdi-pencil",onClick:v},{default:a(()=>[V(" New Item ")]),_:1})]),key:"0"}:void 0]),1024),i.value?(m(),N(eo,{key:0,modelValue:i.value,"onUpdate:modelValue":W[2]||(W[2]=te=>i.value=te),"note-category":p.value,"onUpdate:noteCategory":[W[3]||(W[3]=te=>p.value=te),P],title:d.value,convention:G.convention},null,8,["modelValue","note-category","title","convention"])):x("",!0)]),"item.Groups":a(({item:te})=>[F("ul",ao,[(m(!0),S(L,null,X(te.selectable.Groups,T=>(m(),S("li",{key:T.GroupUUID,class:"py-1"},C(T.Name),1))),128))])]),"item.actions":a(({item:te})=>[t(ut,{size:"small",class:"me-2",onClick:T=>_(te.raw)},{default:a(()=>[V(" mdi:mdi-pencil ")]),_:2},1032,["onClick"]),t(ut,{size:"small",onClick:T=>w(te.raw)},{default:a(()=>[V(" mdi:mdi-delete ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"]))}}),no=Z({__name:"SelectNoteCategories",props:ie({convention:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0}}),emits:ie(["change"],["update:modelValue"]),setup(e,{emit:f}){const n=Ae(e,"modelValue"),i=c([]),o=ge(),d=c([]),l=c(""),s=c(0),u=de(()=>[...d.value].map(p=>({title:p.Name,value:i.value.find(r=>r.NoteCategoryUUID===p.NoteCategoryUUID)||p})));return typeof e.convention=="object"?l.value=e.convention.ConventionUUID:l.value=e.convention||"",(async()=>{const g=[];l.value&&g.push(o.getNoteCategories(l.value));const p=await Promise.all(g);if(l.value&&p.length==1&&(d.value=p[0].sort((r,v)=>r.Name.localeCompare(v.Name))),Array.isArray(n.value))s.value=2,u.value.forEach(r=>{Array.isArray(n.value)&&n.value.find(_=>_.NoteCategoryUUID===r.value.NoteCategoryUUID)&&i.value.push(r.value)});else if(typeof n.value=="string"){s.value=1;try{const r=JSON.parse(n.value);u.value.forEach(v=>{r.find(w=>w.NoteCategoryUUID===v.value.NoteCategoryUUID)&&i.value.push(v.value)})}catch{}}})(),me(i,()=>{switch(s.value){default:case 2:{n.value=i.value,f("change");break}case 1:{n.value=JSON.stringify(i.value),f("change");break}}}),(g,p)=>(m(),N(na,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=r=>i.value=r),chips:g.chips,multiple:"",label:g.label||"Tags",variant:g.variant||"solo",hint:g.hint,"persistent-hint":!0,clearable:g.clearable,items:u.value,"item-title":"title","item-value":"value"},null,8,["modelValue","chips","label","variant","hint","clearable","items"]))}}),oo=Z({__name:"EditNoteDialog",props:ie({convention:{},note:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:ie(["update:note","saved"],["update:modelValue"]),setup(e,{emit:f}){const n=e,{title:i=""}=n,o=ge(),d=Ae(e,"modelValue"),l=tt(n,f,void 0,void 0,"note"),s=c(ce(l.value));me(l,()=>{s.value=ce(l.value)});const u=()=>{s.value=ce(l.value)},A=g=>{s.value.NoteCategories===null&&(s.value.NoteCategories=[]),s.value.CreatedAt=void 0,s.value.DeletedAt=void 0,s.value.UpdatedAt=void 0,s.value.Admin=void 0,s.value.AdminID=void 0,s.value.AdminUUID=void 0,o.saveNote(s.value).then(p=>{p?(s.value=ce(p),g&&g("Note Saved"),l.value=s.value,f("saved",l.value)):g&&g("Internal Error Saving Note")}).catch(p=>{g&&g("Error Saving Note:"+p.ErrorMessage)})};return(g,p)=>s.value?(m(),N(at,{key:0,"card-class":"pa-4",modelValue:d.value,"onUpdate:modelValue":p[3]||(p[3]=r=>d.value=r),onReset:u,onSave:A,title:M(i),color:"primary",persistent:!0,fullscreen:!1,"hide-extension":!0,"show-close-action":!0,"show-reset-action":!0,"show-save-action":!0},{default:a(()=>[t(pe,{class:"pa-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12"},{default:a(()=>[t(no,{modelValue:s.value.NoteCategories,"onUpdate:modelValue":p[0]||(p[0]=r=>s.value.NoteCategories=r),convention:g.convention,label:"Categories",variant:"outlined","hide-details":"",chips:!0},null,8,["modelValue","convention"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12"},{default:a(()=>[t(ue,{modelValue:s.value.Subject,"onUpdate:modelValue":p[1]||(p[1]=r=>s.value.Subject=r),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:a(()=>[t(Ml,{modelValue:s.value.Description,"onUpdate:modelValue":p[2]||(p[2]=r=>s.value.Description=r),label:"Note",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])):x("",!0)}}),io=Z({__name:"Notes",props:{convention:{},hideHistory:{type:Boolean},registration:{},showEditor:{type:Boolean}},setup(e){const f=ge(),n=()=>({ID:0,NoteUUID:Ie(),Description:"",NoteCategories:[],Registration:e.registration,RegistrationID:e.registration.ID,RegistrationUUID:e.registration.RegistrationUUID,Subject:""}),i=c(!1),o=c(!1),d=c([]),l=c([]),s=c(n()),u=()=>{s.value=n(),i.value=!0},A=r=>{s.value=r,i.value=!0},g=()=>{f.getRegistrationNotes(e.registration.RegistrationUUID).then(r=>{r&&(r.forEach(v=>{v.CreatedAt=ia(new Date(v.CreatedAt||"")),v.Admin||(v.Admin={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),d.value=r,l.value=r.map(v=>v.NoteUUID))})},p=()=>{g(),setTimeout(()=>{i.value=!1},2e3)};return g(),(r,v)=>(m(),S(L,null,[t(be,null,{default:a(()=>[t(je,null,{default:a(()=>[t(Pe,null,{default:a(()=>[t(z,{class:"flex-row-reverse"},{default:a(()=>[t(b,{class:"text-right flex-shrink-1 flex-grow-0",style:{"flex-grow":"0 !important"}},{default:a(()=>[t(H,{class:"d-sm-none",size:"xs",icon:"mdi:mdi-cog",variant:"text",color:"warning",onClick:v[0]||(v[0]=_=>o.value=!0)}),t(H,{class:"d-none d-sm-inline-flex","prepend-icon":"mdi:mdi-cog",variant:"text",color:"warning",onClick:v[1]||(v[1]=_=>o.value=!0)},{default:a(()=>[V("Categories")]),_:1})]),_:1}),t(b,{class:"text-wrap flex-grow-1"},{default:a(()=>[V(" Notes (#"+C(r.registration.Reference)+" "+C(r.registration.User.DisplayName)+") ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[t(ft,{multiple:!0,variant:"accordion",modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=_=>l.value=_)},{default:a(()=>[(m(!0),S(L,null,X(d.value,_=>(m(),N(ct,{key:`${_.NoteUUID}.${_.UpdatedAt}`,value:_.NoteUUID},{default:a(()=>[t(mt,null,{default:a(()=>[V(C(_.Subject)+" ",1),t(Nl,{class:"ml-4"},{default:a(()=>[(m(!0),S(L,null,X(_.NoteCategories,w=>(m(),N(Ll,{key:w.NoteCategoryUUID},{default:a(()=>[V(C(w.Name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),t(vt,null,{default:a(()=>[t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[V(C(_.Description),1)]),_:2},1024)]),_:2},1024),t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[V(C(M(Ke)(_.UpdatedAt||""))+" ",1),_&&_.Admin&&_.Admin.DisplayName?(m(),S(L,{key:0},[V(" - "+C(_.Admin.DisplayName),1)],64)):x("",!0)]),_:2},1024),t(b,{class:"text-right"},{default:a(()=>[t(H,{color:"primary","prepend-icon":"mdi:mdi-pencil",onClick:w=>A(_)},{default:a(()=>[V("Edit")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(kt,null,{default:a(()=>[t(H,{color:"primary",variant:"flat",onClick:u},{default:a(()=>[V("Add Note")]),_:1})]),_:1})]),_:1}),t(rt,{modelValue:i.value,"onUpdate:modelValue":v[5]||(v[5]=_=>i.value=_),title:"Create Note"},{default:a(()=>[t(oo,{modelValue:i.value,"onUpdate:modelValue":v[3]||(v[3]=_=>i.value=_),note:s.value,"onUpdate:note":v[4]||(v[4]=_=>s.value=_),convention:r.convention,title:"Create Note",onSaved:p},null,8,["modelValue","note","convention"])]),_:1},8,["modelValue"]),t(rt,{modelValue:o.value,"onUpdate:modelValue":v[7]||(v[7]=_=>o.value=_),title:"Note Configuration"},{default:a(()=>[t(lo,{convention:r.convention,onClose:v[6]||(v[6]=_=>o.value=!1)},null,8,["convention"])]),_:1},8,["modelValue"])],64))}}),so=Z({__name:"StripeRefundPayment",props:ie({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0}}),emits:ie(["refunded"],["update:modelValue"]),setup(e,{emit:f}){const n=Ae(e,"modelValue"),i=ge(),o=c(!1),d=c("");let l=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const r=e.paymentTransaction.Data.PaymentIntent;r&&(l=r.amount)}const s=c({Amount:l/100,Description:"",Reason:""}),u=c([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),A=c(!1);async function g(r){r.preventDefault(),A.value=!0,i.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,s.value).then(v=>{v?f("refunded",v):p("An unexpected error occurred.")}).catch(v=>{p("An error occurred processing the refund: "+v.toString())}),A.value=!1}const p=r=>{d.value=r,o.value=!0};return(r,v)=>(m(),N(at,{modelValue:n.value,"onUpdate:modelValue":v[7]||(v[7]=_=>n.value=_),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:a(()=>[t(pe,{class:"pa-0"},{default:a(()=>[t(wl,{ref:"refundForm",id:"refund-form",onSubmit:v[4]||(v[4]=St(_=>g(_),["prevent"]))},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:a(()=>[t(ue,{modelValue:s.value.Amount,"onUpdate:modelValue":v[0]||(v[0]=_=>s.value.Amount=_),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:a(()=>[t(Ue,{modelValue:s.value.Reason,"onUpdate:modelValue":v[1]||(v[1]=_=>s.value.Reason=_),modelModifiers:{number:!0},items:u.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12"},{default:a(()=>[t(ue,{modelValue:s.value.Description,"onUpdate:modelValue":v[2]||(v[2]=_=>s.value.Description=_),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:a(()=>[t(H,{color:"error",class:"w-100",onClick:v[3]||(v[3]=_=>n.value=!1)},{default:a(()=>[V("Cancel")]),_:1})]),_:1}),t(we),t(b,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:a(()=>[t(H,{type:"submit",color:"success",class:"w-100"},qe({default:a(()=>[V(" Issue Refund ")]),_:2},[A.value?{name:"prepend",fn:a(()=>[t(vl,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(ga,{modelValue:o.value,"onUpdate:modelValue":v[6]||(v[6]=_=>o.value=_)},{actions:a(()=>[t(H,{variant:"text",onClick:v[5]||(v[5]=_=>o.value=!1)},{default:a(()=>[V(" Close ")]),_:1})]),default:a(()=>[V(C(d.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),uo=["colspan"],ro=F("strong",null,"Details",-1),mo=["innerHTML"],vo=Z({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:f}){const n=e;let{hideHistory:i=!1,registration:o,showEditor:d}=n;const l=ge(),s=c([]),u=c(["1"]),A=c([]),g=c([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),p=c(!1),r=c(),v=c(!1),_=c(""),w=c([{key:"CreatedAt",order:"asc"}]),Y=()=>({PaymentTransactionUUID:Ie(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:o.ID,RegistrationUUID:o.RegistrationUUID,Source:Gt.PAYMENT_TRANSACTION_SOURCE_NULL,Type:Rt.PAYMENT_TRANSACTION_TYPE_NULL}),R=c(Y()),{convertTransactions:O,getPaymentTransactionsDisplay:P}=sa();me(n,()=>{i=n.hideHistory,o=n.registration,d=n.showEditor,P(o.RegistrationUUID).then(T=>{A.value=T})});const K=()=>{P(o.RegistrationUUID).then(T=>{A.value=T})};K();const G=()=>{l.saveRegistrationPaymentTransaction(R.value).then(T=>{T&&(O(T.PaymentTransactions),R.value=Y(),f("close-editor"),f("change"))})},W=T=>{const y=A.value.find(I=>I.PaymentTransactionUUID===T);y&&(r.value=y.PaymentTransaction,p.value=!0)},te=T=>{if(T)try{A.value=O(T.PaymentTransactions),r.value=void 0,p.value=!1,_.value="Refund Processed",v.value=!0,f("change")}catch(y){console.error(y)}};return(T,y)=>(m(),S(L,null,[M(d)?(m(),S(L,{key:0},[t(Pe,null,{default:a(()=>[V(" Add Transaction ")]),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6"},{default:a(()=>[t(Ue,{items:M(al),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:R.value.Type,"onUpdate:modelValue":y[0]||(y[0]=I=>R.value.Type=I),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:a(()=>[t(Ue,{items:M(ll),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:R.value.Source,"onUpdate:modelValue":y[1]||(y[1]=I=>R.value.Source=I),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"8",md:"10"},{default:a(()=>[t(ue,{label:"Description","hide-details":"",modelValue:R.value.Description,"onUpdate:modelValue":y[2]||(y[2]=I=>R.value.Description=I),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"4",md:"2"},{default:a(()=>[t(ue,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:R.value.Amount,"onUpdate:modelValue":y[3]||(y[3]=I=>R.value.Amount=I),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"3",md:"2",lg:"1"},{default:a(()=>[t(H,{class:"w-100",onClick:y[4]||(y[4]=I=>f("close-editor")),color:"warning"},{default:a(()=>[V("Cancel")]),_:1})]),_:1}),t(we),t(b,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:a(()=>[t(H,{class:"w-100",onClick:G,color:"primary"},{default:a(()=>[V("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):x("",!0),A.value.length&&!M(i)?(m(),N(ft,{key:1,class:"my-2",modelValue:u.value,"onUpdate:modelValue":y[10]||(y[10]=I=>u.value=I)},{default:a(()=>[t(ct,{value:"1"},{default:a(()=>[t(mt,null,{default:a(()=>[V(" Transaction History ")]),_:1}),t(vt,null,{default:a(()=>[t(M(ht),{items:A.value,headers:g.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:s.value,"onUpdate:expanded":y[5]||(y[5]=I=>s.value=I),"sort-by":w.value,"onUpdate:sortBy":y[6]||(y[6]=I=>w.value=I),class:"transactionTable"},{"item.Controls":a(({item:I})=>[T.canEdit&&I.raw.PaymentTransaction.Source===M(Gt).PAYMENT_TRANSACTION_SOURCE_STRIPE&&I.raw.PaymentTransaction.Type===M(Rt).PAYMENT_TRANSACTION_TYPE_PAYMENT?(m(),N(H,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:h=>W(I.key)},null,8,["onClick"])):x("",!0)]),"expanded-row":a(({columns:I,item:h})=>[F("tr",null,[F("td",{colspan:I.length},[ro,F("div",{innerHTML:h.raw.HTML},null,8,mo)],8,uo)])]),"footer.prepend":a(()=>[t(H,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:K},{default:a(()=>[V("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),p.value&&r.value?(m(),N(so,{key:0,modelValue:p.value,"onUpdate:modelValue":y[7]||(y[7]=I=>p.value=I),"payment-transaction":r.value,onRefunded:te},null,8,["modelValue","payment-transaction"])):x("",!0),t(ga,{modelValue:v.value,"onUpdate:modelValue":y[9]||(y[9]=I=>v.value=I)},{actions:a(()=>[t(H,{variant:"text",onClick:y[8]||(y[8]=I=>v.value=!1)},{default:a(()=>[V(" Close ")]),_:1})]),default:a(()=>[V(C(_.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):x("",!0)],64))}});const co=(e=void 0,f)=>e===void 0?!1:Ot(e,bt.GROUP_TYPE_CONVENTION,f.ConventionUUID,f).EditPaymentTransactions,Ut=e=>(aa("data-v-8af8174d"),e=e(),la(),e),fo={class:"mb-4"},Uo={class:"v-row"},po={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},go={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},_o={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},Ao={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},To=Ut(()=>F("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),yo={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Eo=Ut(()=>F("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),Io={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Do=Ut(()=>F("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),So={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},Ro=Ut(()=>F("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),Co={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Vo=Z({__name:"PaymentActions",props:ie({forms:{},title:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const f=c(!1),n=c(),i=c([]),o=c(new Date().getTime()),d=c(!1),l=Ae(e,"modelValue"),s=c(ce(l.value));me(l,()=>{s.value=ce(l.value)});const u=ge();u.getConvention(l.value.ConventionUUID).then(r=>{r&&(d.value=co(Mt(),r))});const A=()=>{u.generateRegistrationCharges(l.value.RegistrationUUID,!1).then(r=>{r&&(i.value=r.PaymentTransactions,n.value=r.Registration,o.value=new Date().getTime())}).catch(()=>{})};A();const g=()=>{u.generateRegistrationCharges(l.value.RegistrationUUID,!0).then(r=>{r&&(i.value=r.PaymentTransactions,n.value=r.Registration,o.value=new Date().getTime())})},{totalCharges:p}=sa();return(r,v)=>(m(),N(be,null,{default:a(()=>[t(je,null,{default:a(()=>[t(Pe,null,{default:a(()=>[V(" Payments (#"+C(l.value.Reference)+" "+C(l.value.User.DisplayName)+") ",1)]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[n.value?(m(),S(L,{key:0},[F("h3",fo,"#"+C(n.value.Reference)+" "+C(n.value.User.DisplayName),1),F("dl",Uo,[(m(!0),S(L,null,X(i.value,_=>(m(),S(L,{key:_.PaymentTransactionUUID},[_.Type===M(Rt).PAYMENT_TRANSACTION_TYPE_CHARGE?(m(),S("dt",po,[F("div",go,C(_.Description.split(":")[0])+": ",1),F("div",_o,C(_.Description.split(":")[1]),1)])):x("",!0),F("dd",Ao," £"+C(_.Amount),1)],64))),128)),To,F("dd",yo," £"+C(M(p)(i.value)),1),Eo,F("dd",Io," £"+C(n.value.Total),1),Do,F("dd",So," £"+C(n.value.Paid),1),Ro,F("dd",Co," £"+C(n.value.Total-n.value.Paid),1)]),t(z,{class:"flex-row-reverse"},{default:a(()=>[t(b,{class:"text-right"},{default:a(()=>[t(H,{color:"primary",onClick:g},{default:a(()=>[V("Apply Charges")]),_:1})]),_:1}),!f.value&&d.value?(m(),N(b,{key:0},{default:a(()=>[t(H,{color:"secondary",onClick:v[0]||(v[0]=_=>f.value=!0)},{default:a(()=>[V("Transaction Entry")]),_:1})]),_:1})):x("",!0)]),_:1})],64)):x("",!0),t(vo,{"can-edit":d.value,registration:l.value,"show-editor":f.value,onCloseEditor:v[1]||(v[1]=_=>f.value=!1),updated:o.value,onChange:A},null,8,["can-edit","registration","show-editor","updated"])]),_:1})]),_:1}))}});const bo=dt(Vo,[["__scopeId","data-v-8af8174d"]]),Oo=Z({__name:"RegistrationFormStatus",props:ie({forms:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const f=ge(),n=Ae(e,"modelValue"),i=(o,d)=>{const l=n.value.Submissions.find(s=>s.SubmissionUUID==d);if(!l){o&&o("Submission not found");return}f.setSubmissionStatus(d,l.Status).then(s=>{s?(n.value.Submissions.forEach((u,A)=>{n.value.Submissions[A].Status=u.Status}),o&&o("Status Saved")):o&&o("Status not saved")}).catch(()=>{o&&o("Status not saved")})};return(o,d)=>(m(),N(be,null,{default:a(()=>[t(je,null,{default:a(()=>[t(Pe,null,{default:a(()=>[V("Status (#"+C(n.value.Reference)+" "+C(n.value.User.DisplayName)+")",1)]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[t(st,null,{default:a(()=>[(m(!0),S(L,null,X(n.value.Submissions,l=>(m(),N(Je,{key:l.SubmissionUUID,class:"pa-0"},{default:a(()=>[t(z,{class:"py-2 align-center"},{default:a(()=>[t(b,{cols:"9",sm:"10",md:"10",lg:"9"},{default:a(()=>{var s;return[t(Ue,{modelValue:l.Status,"onUpdate:modelValue":u=>l.Status=u,items:M(Yt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((s=o.forms.find(u=>u.FormUUID==l.FormUUID))==null?void 0:s.Name)||""},{selection:a(()=>[t(ut,{class:"mr-4 d-none d-sm-inline"},{default:a(()=>{var u;return[V(C((u=M(Yt).find(A=>A.value===l.Status))==null?void 0:u.icon),1)]}),_:2},1024),V(" "+C(M(ra)(l.Status)),1)]),item:a(({item:u,props:{onClick:A}})=>[t(Je,{title:u.title,"prepend-icon":u.raw.icon,onClick:A},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(b,{cols:"3",sm:"2",md:"2",lg:"1"},{default:a(()=>[t(Ze,{class:"d-none d-sm-inline-flex",title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:s=>i(s.callback,l.SubmissionUUID)},null,8,["onClick"]),t(Ze,{class:"d-sm-none",size:"35",icon:"mdi:mdi-content-save",color:"warning",onClick:s=>i(s.callback,l.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}}),ho=e=>(aa("data-v-7d39acf0"),e=e(),la(),e),ko=ho(()=>F("p",null,"Any tags controlled through registration form fields will be reset when the applicable form is saved. If you don't know what you're doing here, don't touch!",-1)),Mo={class:"mb-4"},No=Z({__name:"RegistrationTags",props:ie({title:{}},{modelValue:{required:!0}}),emits:["update:modelValue"],setup(e){const f=ge(),n=Ae(e,"modelValue"),i=c(ce(n.value)),o=c(!1),d=c(i.value.Tags);me(n,()=>{i.value=ce(n.value)});const l=({callback:s})=>{const u=[],A=[];i.value.Tags.forEach(g=>{d.value.find(r=>r.TagUUID===g.TagUUID)||u.push(g.TagUUID)}),d.value.forEach(g=>{i.value.Tags.find(r=>g.TagUUID===r.TagUUID)||A.push(g.TagUUID)}),f.updateRegistrationTags(u,A,i.value.RegistrationUUID).then(g=>{g?s&&(s("Tags Saved"),n.value.Tags=g.Tags):s&&s("Error Saving Tags")}).catch(()=>{s&&s("Error Saving Tags")})};return(s,u)=>(m(),N(be,null,{default:a(()=>[t(je,null,{default:a(()=>[t(Pe,null,{default:a(()=>[V("Tags (#"+C(i.value.Reference)+" "+C(i.value.User.DisplayName)+")",1)]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[t(Pl,{class:"my-4"},{default:a(()=>[t(Fl,null,{default:a(()=>[V("Caution")]),_:1}),ko]),_:1}),F("h3",Mo,"#"+C(i.value.Reference)+" "+C(i.value.User.DisplayName),1),t(Ua,{modelValue:i.value.Tags,"onUpdate:modelValue":u[0]||(u[0]=A=>i.value.Tags=A),convention:i.value.ConventionUUID,"show-key":!0,chips:!0,"show-uuid":o.value},null,8,["modelValue","convention","show-uuid"])]),_:1}),t(kt,{class:"px-4 align-start"},{default:a(()=>[t(oa,{label:"Show UUID",modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=A=>o.value=A)},null,8,["modelValue"]),t(Ze,{onClick:l,variant:"flat"})]),_:1})]),_:1}))}});const Lo=dt(No,[["__scopeId","data-v-7d39acf0"]]),Xt=Z({__name:"RegistrationActionWindows",props:ie({accommodations:{},convention:{},extras:{},forms:{},interests:{},registration:{},tickets:{},venues:{}},{modelValue:{required:!0}}),emits:ie(["update:registration"],["update:modelValue"]),setup(e,{emit:f}){const n=e,i=Ae(e,"modelValue"),o=tt(n,f,void 0,void 0,"registration");return(d,l)=>(m(),N(pa,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=s=>i.value=s)},{default:a(()=>[t(Le,{value:"badges"},{default:a(()=>[i.value=="badges"?(m(),N(pe,{key:0,class:"pa-0 mx-0",fluid:!0},{default:a(()=>[t(Mn,{convention:d.convention,registration:M(o)},null,8,["convention","registration"])]),_:1})):x("",!0)]),_:1}),t(Le,{value:"emails"},{default:a(()=>[i.value=="emails"?(m(),N(pe,{key:0,class:"pa-0 mx-0",fluid:!0},{default:a(()=>[t(Zn,{registration:M(o)},null,8,["registration"])]),_:1})):x("",!0)]),_:1}),t(Le,{value:"notes"},{default:a(()=>[i.value=="notes"?(m(),N(pe,{key:0,class:"pa-0 mx-0",fluid:!0},{default:a(()=>[t(io,{convention:d.convention,registration:M(o)},null,8,["convention","registration"])]),_:1})):x("",!0)]),_:1}),t(Le,{value:"payments"},{default:a(()=>[i.value=="payments"?(m(),N(pe,{key:0,class:"pa-0 mx-0",fluid:!0},{default:a(()=>[t(bo,{modelValue:M(o),"onUpdate:modelValue":l[0]||(l[0]=s=>We(o)?o.value=s:null),forms:d.forms,title:"Registration Payments"},null,8,["modelValue","forms"])]),_:1})):x("",!0)]),_:1}),t(Le,{value:"status"},{default:a(()=>[i.value=="status"?(m(),N(pe,{key:0,class:"pa-0 mx-0",fluid:!0},{default:a(()=>[t(Oo,{modelValue:M(o),"onUpdate:modelValue":l[1]||(l[1]=s=>We(o)?o.value=s:null),forms:d.forms},null,8,["modelValue","forms"])]),_:1})):x("",!0)]),_:1}),t(Le,{value:"tags"},{default:a(()=>[i.value=="tags"?(m(),N(pe,{key:0,class:"pa-0 mx-0",fluid:!0},{default:a(()=>[t(Lo,{modelValue:M(o),"onUpdate:modelValue":l[2]||(l[2]=s=>We(o)?o.value=s:null),title:"Registration Tags"},null,8,["modelValue"])]),_:1})):x("",!0)]),_:1})]),_:1},8,["modelValue"]))}}),wo=(e,f)=>e===void 0?!1:Ot(e,bt.GROUP_TYPE_CONVENTION,f.ConventionUUID,f).ViewPaymentTransactions,Zt=Z({__name:"RegistrationActions",props:ie({accommodations:{},convention:{},extras:{},forms:{},interests:{},registration:{},tickets:{},title:{},useDialog:{type:Boolean},venues:{}},{modelValue:{type:Boolean,required:!0}}),emits:ie(["update:registration"],["update:modelValue"]),setup(e,{emit:f}){const n=e,i=Ae(e,"modelValue"),o=tt(n,f,void 0,void 0,"registration"),d=c("notes"),l=Mt(),s=[{label:"Badge",value:"badges"},{label:"Emails",value:"emails"},{label:"Notes",value:"notes"},{label:"Status",value:"status"},{label:"Tags",value:"tags"}];return wo(l,n.convention)&&s.splice(2,0,{label:"Payments",value:"payments"}),(u,A)=>u.useDialog?(m(),N(at,{key:0,modelValue:i.value,"onUpdate:modelValue":A[3]||(A[3]=g=>i.value=g),title:u.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:"","card-class":"ma-0 pa-0"},{extension:a(()=>[t(Qt,{modelValue:d.value,"onUpdate:modelValue":A[0]||(A[0]=g=>d.value=g),tabs:s,"show-arrows":!0},null,8,["modelValue"])]),default:a(()=>[t(Xt,{modelValue:d.value,"onUpdate:modelValue":A[1]||(A[1]=g=>d.value=g),registration:M(o),"onUpdate:registration":A[2]||(A[2]=g=>We(o)?o.value=g:null),accommodations:u.accommodations,convention:u.convention,extras:u.extras,forms:u.forms,interests:u.interests,tabs:s,tickets:u.tickets,venues:u.venues},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])]),_:1},8,["modelValue","title"])):(m(),S(L,{key:1},[t(Qt,{modelValue:d.value,"onUpdate:modelValue":A[4]||(A[4]=g=>d.value=g),tabs:s,"show-arrows":!0},null,8,["modelValue"]),t(Xt,{modelValue:d.value,"onUpdate:modelValue":A[5]||(A[5]=g=>d.value=g),registration:M(o),"onUpdate:registration":A[6]||(A[6]=g=>We(o)?o.value=g:null),accommodations:u.accommodations,convention:u.convention,extras:u.extras,forms:u.forms,interests:u.interests,tabs:s,tickets:u.tickets,venues:u.venues},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])],64))}});const Po=(e,f=500,n=!1)=>{let i;return(...o)=>{const l=function(){i=void 0,n||e.apply(void 0,o)},s=n&&!i;clearTimeout(i),i=setTimeout(l,f),s&&e.apply(void 0,o)}},Fo=Z({__name:"EditAdminLayout",props:{modelValue:{required:!0}},emits:ie(["change","delete"],["update:modelValue"]),setup(e,{emit:f}){const n=Ae(e,"modelValue"),i=c([]),o=ge(),d=c(`
Are you sure you wish to delete this layout? All panels relating to it will be
removed and can not be recovered. This action can not be undone once saved.
You will have to create a new layout.
`),l=c(!1),s=()=>({ID:0,LayoutPanelUUID:Ie(),AdminLayoutID:n.value.ID,AdminLayoutUUID:n.value.AdminLayoutUUID,Name:"",Order:n.value.Panels.length+1,Items:[],RequiredFormType:Te.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),u=p=>()=>({ID:0,LayoutItemUUID:Ie(),LayoutPanelID:p.ID,LayoutPanelUUID:p.LayoutPanelUUID,Label:"",SourceType:Xe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:p.Items.length+1,DefaultSort:!1}),A=p=>{const r=i.value.find(v=>v.value===p.SectionFieldUUID);r&&(p.SectionFieldID=r.object.ID,p.SectionField=r.object)};o.getConventionForms(n.value.ConventionUUID).then(p=>{p.forEach(r=>r.Sections.forEach(v=>v.Fields&&i.value.push(...v.Fields.map(_=>{var Y;return{title:`${r.Name} - ${v.Name} - ${(Y=_.Field)==null?void 0:Y.Name}`,value:_.SectionFieldUUID,object:_}})))),i.value.sort(Xa("title"))});const g=de(()=>{switch(n.value.Type){case et.ADMIN_LAYOUT_PANELS:return"Panels";case et.ADMIN_LAYOUT_TABLE:return"Tabs"}return"Unknown"});return me(n,()=>{f("change")},{deep:!0}),(p,r)=>(m(),N(pe,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6"},{default:a(()=>[t(ue,{modelValue:n.value.Name,"onUpdate:modelValue":r[0]||(r[0]=v=>n.value.Name=v),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:a(()=>[t(Ue,{modelValue:n.value.Type,"onUpdate:modelValue":r[1]||(r[1]=v=>n.value.Type=v),label:"Layout Type",items:M(Gl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[t(Ct,{modelValue:n.value.Panels,"onUpdate:modelValue":r[2]||(r[2]=v=>n.value.Panels=v),"new-item":s,closeable:!1,title:g.value,label:"Name","slot-name-prefix":"panel"},qe({_:2},[X(n.value.Panels,(v,_)=>({name:`panel_${_}`,fn:a(()=>[t(pe,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6"},{default:a(()=>[t(ue,{modelValue:v.Name,"onUpdate:modelValue":w=>v.Name=w,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:a(()=>[t(Ue,{modelValue:v.RequiredFormType,"onUpdate:modelValue":w=>v.RequiredFormType=w,items:M(tl),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6"},{default:a(()=>[t(fa,{label:"Required Groups",variant:"outlined",modelValue:v.RequiredGroupMemberships,"onUpdate:modelValue":w=>v.RequiredGroupMemberships=w,convention:n.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:a(()=>[t(Ua,{label:"Registration Tags",variant:"outlined",modelValue:v.RequiredRegistrationTags,"onUpdate:modelValue":w=>v.RequiredRegistrationTags=w,convention:n.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(Ct,{modelValue:v.Items,"onUpdate:modelValue":w=>v.Items=w,"new-item":u(v),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},qe({_:2},[X(v.Items,(w,Y)=>({name:`item_${Y}`,fn:a(()=>[t(pe,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6"},{default:a(()=>[t(ue,{modelValue:w.Label,"onUpdate:modelValue":R=>w.Label=R,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6"},{default:a(()=>[t(Ue,{modelValue:w.SourceType,"onUpdate:modelValue":R=>w.SourceType=R,label:"Source Type",items:M(Yl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(b,{cols:"12",sm:"6"},{default:a(()=>[w.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(m(),N(Ue,{key:0,modelValue:w.SectionFieldUUID,"onUpdate:modelValue":R=>w.SectionFieldUUID=R,label:"Form Data",items:i.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:R=>A(w)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):w.SourceType==="LAYOUT_ITEM_SOURCE_META"?(m(),N(Ue,{key:1,modelValue:w.MetaField,"onUpdate:modelValue":R=>w.MetaField=R,label:"Miscellaneous Data",items:M(Hl),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):w.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(m(),N(Ue,{key:2,modelValue:w.UserField,"onUpdate:modelValue":R=>w.UserField=R,label:"User Profile Data",items:M(ql),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):x("",!0)]),_:2},1024)]),_:2},1024),t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[t(oa,{modelValue:w.DefaultSort,"onUpdate:modelValue":R=>w.DefaultSort=R,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue","title"])]),_:1})]),_:1}),t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[t(H,{onClick:r[3]||(r[3]=v=>l.value=!0),"prepend-icon":"mdi:mdi-delete",color:"red-darken-4"},{default:a(()=>[V("Delete Layout")]),_:1})]),_:1})]),_:1}),l.value?(m(),N(_a,{key:0,modelValue:l.value,"onUpdate:modelValue":r[4]||(r[4]=v=>l.value=v),message:d.value,title:"Delete Layout",subtitle:"Removes this layout and all it's panels",onDelete:r[5]||(r[5]=v=>f("delete"))},null,8,["modelValue","message"])):x("",!0)]),_:1}))}}),$o=Z({__name:"EditAdminLayouts",props:ie({title:{},convention:{}},{modelValue:{type:Boolean,required:!0}}),emits:ie(["save"],["update:modelValue"]),setup(e,{emit:f}){const n=Ae(e,"modelValue"),i=c([]),o=c([]),d=c([]),l=ge(),s=()=>({ID:0,AdminLayoutUUID:Ie(),ConventionID:e.convention.ID,ConventionUUID:e.convention.ConventionUUID,Name:"New Layout",Type:et.ADMIN_LAYOUT_PANELS,Panels:[]}),u=()=>{let g=!1;[...new Set(d.value)].forEach(r=>{const v=i.value.findIndex(_=>_.AdminLayoutUUID===r);v<0||v>=i.value.length||(l.saveAdminLayout(i.value[v]).then(_=>{_&&i.value.splice(v,1,_)}).catch(()=>{}),g=!0)}),o.value.forEach(r=>{l.deleteAdminLayout(r).catch(()=>{})}),o.value=[],d.value=[],g&&f("save")},A=g=>{const p=i.value.findIndex(r=>r.AdminLayoutUUID===g.AdminLayoutUUID);p<0||p>=i.value.length||(i.value[p].ID>0&&o.value.push(g.AdminLayoutUUID),i.value.splice(p,1))};return l.getConventionAdminLayouts(e.convention.ConventionUUID).then(g=>{g&&(i.value=g)}).catch(()=>[]),(g,p)=>(m(),N(rt,{modelValue:n.value,"onUpdate:modelValue":p[2]||(p[2]=r=>n.value=r),scrollable:!0,"retain-focus":!0,persistent:!0,fullscreen:!0},{default:a(()=>[t(Ct,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=r=>i.value=r),"new-item":s,closeable:!0,"show-delete":!1,"show-save":!0,"has-order":!1,title:g.title,label:"Name","slot-name-prefix":"panel",onClose:p[1]||(p[1]=r=>n.value=!1),onSave:u},qe({_:2},[X(i.value,(r,v)=>({name:`panel_${v}`,fn:a(()=>[t(pe,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12"},{default:a(()=>[t(Fo,{modelValue:i.value[v],"onUpdate:modelValue":_=>i.value[v]=_,onChange:_=>d.value.push(r.AdminLayoutUUID),onDelete:_=>A(r)},null,8,["modelValue","onUpdate:modelValue","onChange","onDelete"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","title"])]),_:1},8,["modelValue"]))}});function xo(){const e=c([]);xa(()=>e.value=[]);function f(n,i){e.value[i]=n}return{refs:e,updateRef:f}}const Bo=ea({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:ot,default:"$first"},prevIcon:{type:ot,default:"$prev"},nextIcon:{type:ot,default:"$next"},lastIcon:{type:ot,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...nl(),...ol(),...il(),...sl(),...ul(),...rl(),...dl({tag:"nav"}),...Ba(),...ml({variant:"text"})},"VPagination"),Go=ta()({name:"VPagination",props:Bo(),emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,f){let{slots:n,emit:i}=f;const o=Ga(e,"modelValue"),{t:d,n:l}=Ya(),{isRtl:s}=Ha(),{themeClasses:u}=qa(e),{width:A}=ja(),g=za(-1);Dt(void 0,{scoped:!0});const{resizeRef:p}=cl(T=>{if(!T.length)return;const{target:y,contentRect:I}=T[0],h=y.querySelector(".v-pagination__list > *");if(!h)return;const $=I.width,ee=h.offsetWidth+parseFloat(getComputedStyle(h).marginRight)*2;g.value=w($,ee)}),r=de(()=>parseInt(e.length,10)),v=de(()=>parseInt(e.start,10)),_=de(()=>e.totalVisible?parseInt(e.totalVisible,10):g.value>=0?g.value:w(A.value,58));function w(T,y){const I=e.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((T-y*I)/y).toFixed(2)))}const Y=de(()=>{if(r.value<=0||isNaN(r.value)||r.value>Number.MAX_SAFE_INTEGER)return[];if(_.value<=1)return[o.value];if(r.value<=_.value)return it(r.value,v.value);const T=_.value%2===0,y=T?_.value/2:Math.floor(_.value/2),I=T?y:y+1,h=r.value-y;if(I-o.value>=0)return[...it(Math.max(1,_.value-1),v.value),e.ellipsis,r.value];if(o.value-h>=(T?1:0)){const $=_.value-1,ee=r.value-$+v.value;return[v.value,e.ellipsis,...it($,ee)]}else{const $=Math.max(1,_.value-3),ee=$===1?o.value:o.value-Math.ceil($/2)+v.value;return[v.value,e.ellipsis,...it($,ee),e.ellipsis,r.value]}});function R(T,y,I){T.preventDefault(),o.value=y,I&&i(I,y)}const{refs:O,updateRef:P}=xo();Dt({VPaginationBtn:{color:_e(e,"color"),border:_e(e,"border"),density:_e(e,"density"),size:_e(e,"size"),variant:_e(e,"variant"),rounded:_e(e,"rounded"),elevation:_e(e,"elevation")}});const K=de(()=>Y.value.map((T,y)=>{const I=h=>P(h,y);if(typeof T=="string")return{isActive:!1,key:`ellipsis-${y}`,page:T,props:{ref:I,ellipsis:!0,icon:!0,disabled:!0}};{const h=T===o.value;return{isActive:h,key:T,page:l(T),props:{ref:I,ellipsis:!1,icon:!0,disabled:!!e.disabled||+e.length<2,color:h?e.activeColor:e.color,ariaCurrent:h,ariaLabel:d(h?e.currentPageAriaLabel:e.pageAriaLabel,T),onClick:$=>R($,T)}}}})),G=de(()=>{const T=!!e.disabled||o.value<=v.value,y=!!e.disabled||o.value>=v.value+r.value-1;return{first:e.showFirstLastPage?{icon:s.value?e.lastIcon:e.firstIcon,onClick:I=>R(I,v.value,"first"),disabled:T,ariaLabel:d(e.firstAriaLabel),ariaDisabled:T}:void 0,prev:{icon:s.value?e.nextIcon:e.prevIcon,onClick:I=>R(I,o.value-1,"prev"),disabled:T,ariaLabel:d(e.previousAriaLabel),ariaDisabled:T},next:{icon:s.value?e.prevIcon:e.nextIcon,onClick:I=>R(I,o.value+1,"next"),disabled:y,ariaLabel:d(e.nextAriaLabel),ariaDisabled:y},last:e.showFirstLastPage?{icon:s.value?e.firstIcon:e.lastIcon,onClick:I=>R(I,v.value+r.value-1,"last"),disabled:y,ariaLabel:d(e.lastAriaLabel),ariaDisabled:y}:void 0}});function W(){var y;const T=o.value-v.value;(y=O.value[T])==null||y.$el.focus()}function te(T){T.key===Bt.left&&!e.disabled&&o.value>+e.start?(o.value=o.value-1,He(W)):T.key===Bt.right&&!e.disabled&&o.value<v.value+r.value-1&&(o.value=o.value+1,He(W))}return ua(()=>t(e.tag,{ref:p,class:["v-pagination",u.value,e.class],style:e.style,role:"navigation","aria-label":d(e.ariaLabel),onKeydown:te,"data-test":"v-pagination-root"},{default:()=>[t("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&t("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[n.first?n.first(G.value.first):t(H,Ve({_as:"VPaginationBtn"},G.value.first),null)]),t("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[n.prev?n.prev(G.value.prev):t(H,Ve({_as:"VPaginationBtn"},G.value.prev),null)]),K.value.map((T,y)=>t("li",{key:T.key,class:["v-pagination__item",{"v-pagination__item--is-active":T.isActive}],"data-test":"v-pagination-item"},[n.item?n.item(T):t(H,Ve({_as:"VPaginationBtn"},T.props),{default:()=>[T.page]})])),t("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[n.next?n.next(G.value.next):t(H,Ve({_as:"VPaginationBtn"},G.value.next),null)]),e.showFirstLastPage&&t("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[n.last?n.last(G.value.last):t(H,Ve({_as:"VPaginationBtn"},G.value.last),null)])])]})),{}}}),Yo=["colspan"],Ho={style:{opacity:"var(--v-medium-emphasis-opacity)"}},Oi=Z({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:f}){var Pt;const n=ma();f("pageTitle","Registration Manager");const i=Qa(),o=Ka(),d=c(!0);let l=((Pt=i.params.convention)==null?void 0:Pt.toString())||"";const s=c({ID:0,ConventionUUID:Ie(),OrganisationID:0,OrganisationUUID:Et,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),u=ge(),A=Wa.getInstance(),g=c([]),p=c({ID:0,AdminLayoutUUID:Ie(),ConventionID:s.value.ID,ConventionUUID:s.value.ConventionUUID,Name:"Registration Table",Type:et.ADMIN_LAYOUT_TABLE,Panels:[]}),r=c([]),v=c([]),_=c([]),w=c([]),Y=c([]),R=c(1),O=c(10),P=c([]),K=c(0),G=c(!1),W=c(""),te=c(""),T=c(""),y=c(""),I=c({FieldUUID:"591c9bca-c78c-4e97-8aef-bc596ef472fb",Value:""}),h=c({FieldUUID:"50189b21-6c55-4c99-a38f-7740a01ec4a4",Value:""}),$=c({FieldUUID:"1523ef15-f2c3-46b9-a687-dcd7bc2c0a50",Value:""}),ee=c({FieldUUID:"926d43c6-a743-4ab7-bef2-060d762d37a9",Value:""}),fe=c(new Map([["591c9bca-c78c-4e97-8aef-bc596ef472fb",I.value],["50189b21-6c55-4c99-a38f-7740a01ec4a4",h.value],["1523ef15-f2c3-46b9-a687-dcd7bc2c0a50",$.value],["926d43c6-a743-4ab7-bef2-060d762d37a9",ee.value]])),ne=c(""),$e=c(""),ze=c([]),xe=c([]),Be=c([]),De=c([]),Oe=c([]),he=c([]),ye=c(0),Ee=c(),ke=c(!1),Nt=c(!1),ya=c(!1),lt=c(),Lt=c(),pt=c(),Ge=c(!1),Ea=Mt(),ve=Po(()=>{te.value=Date.now().toString()});me(W,E=>{const U=Y.value.find(k=>k.uuid===E);if(U){const k=U.headers.find(D=>D.defaultSort===!0);k&&(P.value=[{key:k.key,order:"asc"}],ze.value=[{key:k.key,order:"asc"}])}}),me(ye,E=>{E===7&&wt()}),me(ne,()=>{ve()}),me($e,()=>{ve()});const Ia=()=>{r.value=[],_.value=[],Y.value=[];try{u.getConventionAdminLayoutByName(s.value.ConventionUUID,"Registration Table").then(E=>{ye.value+=1,E?p.value=E:(p.value.ConventionID=s.value.ID,p.value.ConventionUUID=s.value.ConventionUUID)})}catch{p.value.ConventionID=s.value.ID,p.value.ConventionUUID=s.value.ConventionUUID}try{u.getConventionForms(s.value.ConventionUUID).then(E=>{ye.value+=1,E&&(r.value=E)})}catch{}try{u.getConventionAccommodation(s.value.ConventionUUID).then(E=>{ye.value+=1,E&&(xe.value=E)})}catch{}try{u.getConventionVenues(s.value.ConventionUUID).then(E=>{ye.value+=1,E&&(he.value=E)})}catch{}try{u.getConventionExtras(s.value.ConventionUUID).then(E=>{ye.value+=1,E&&(Be.value=E)})}catch{}try{u.getConventionInterests(s.value.ConventionUUID).then(E=>{ye.value+=1,E&&(De.value=E)})}catch{}try{u.getConventionTickets(s.value.ConventionUUID).then(E=>{ye.value+=1,E&&(Oe.value=E)})}catch{}try{u.getConventionGroups(s.value.ConventionUUID).then(E=>{E&&(v.value=E.sort((U,k)=>U.Name.localeCompare(k.Name)))})}catch{}try{u.getConventionTags(s.value.ConventionUUID).then(E=>{E&&(w.value=E.sort((U,k)=>U.Title.localeCompare(k.Title)).map(U=>(U.Title=`${U.Title} [${U.Key}]`,U)))})}catch{}},gt=({page:E,itemsPerPage:U,sortBy:k})=>{d.value=!0,R.value=E,P.value=k;const D=Y.value.find(oe=>oe.uuid==W.value),re=D==null?void 0:D.layout.Items;let le="",Ft="";if(k&&re&&k.length>=1){const oe=re.find(At=>At.LayoutItemUUID==k[0].key);switch(Ft=k[0].order||"asc",oe==null?void 0:oe.MetaField){case ae.META_DATA_SOURCE_ACCOMMODATION_FORM:le="submission.status";break;case ae.META_DATA_SOURCE_BADGE_FORM:le="submission.status";break;case ae.META_DATA_SOURCE_DEALER_FORM:le="submission.status";break;case ae.META_DATA_SOURCE_REGISTRATION_FORM:le="submission.status";break;case ae.META_DATA_SOURCE_REGISTRATION_REFERENCE:le="reference";break;case ae.META_DATA_SOURCE_SUBMISSION_DATE:le="created";break;case ae.META_DATA_SOURCE_SUBMISSION_STATUS:le="submission.status";break}switch(oe==null?void 0:oe.UserField){case se.USER_DATA_SOURCE_DISPLAY_NAME:le="user.display_name";break;case se.USER_DATA_SOURCE_EMAIL:le="user.email";break;case se.USER_DATA_SOURCE_FIRST_NAME:le="user.firstname";break;case se.USER_DATA_SOURCE_HANDLE:le="user.handle";break;case se.USER_DATA_SOURCE_LAST_NAME:le="user.lastname";break}}try{const oe={Direction:Ft,Limit:U,Offset:(E-1)*U,Order:le};D&&D.layout.RequiredRegistrationTags.length>0&&(oe.PanelUUID=D==null?void 0:D.layout.LayoutPanelUUID),(D==null?void 0:D.layout.RequiredFormType)===Te.FORM_TYPE_ACCOMMODATION&&(oe.Accommodation=!0),(D==null?void 0:D.layout.RequiredFormType)===Te.FORM_TYPE_BADGE&&(oe.Badge=!0),(D==null?void 0:D.layout.RequiredFormType)===Te.FORM_TYPE_DEALER&&(oe.Dealer=!0),(D==null?void 0:D.layout.RequiredFormType)===Te.FORM_TYPE_REGISTRATION&&(oe.Registration=!0),oe.GroupUUID=ne.value||Et,oe.TagUUID=$e.value||Et,oe.Email=y.value,oe.Reference=T.value,oe.FieldValues=Array.from(fe.value.values());const At=te.value;u.searchConventionRegistrations(s.value.ConventionUUID,oe).then(Tt=>{Tt&&At===te.value&&(K.value=Tt.Total,_.value=Tt.Registrations,Y.value.forEach(yt=>{const ka=yt.layout;yt.items=_.value.map(q=>{const nt=[];let Re;q.Leader?Re=q:Re=q.Primary,nt.push({Name:Re.User.DisplayName,UUID:Re.UserUUID,UserUUID:Re.User.UserUUID,IsLeader:!0,Reference:Re.Reference,Paid:Re.Paid,Total:Re.Total}),nt.push(...Re.Members.map(Ce=>({Name:Ce.User.DisplayName,UUID:Ce.UserUUID,UserUUID:Ce.User.UserUUID,IsLeader:!1,Reference:Ce.Reference,Paid:Ce.Paid,Total:Ce.Total})));const J={};return yt.headers.forEach(Ce=>{var $t;const j=ka.Items.find(Qe=>Qe.LayoutItemUUID===Ce.key);if(j){if(j.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&j.SectionField)q.Submissions.forEach(Qe=>{const Ye=Qe.Data.find(B=>B.SectionFieldUUID===j.SectionFieldUUID);if(Ye){Ce.type===el.ACCOMMODATION?J[j.LayoutItemUUID]={Data:Ye.Data,Registration:q}:J[j.LayoutItemUUID]=Ye.Data;return}});else if(j.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&j.UserField)switch(j.UserField){case se.USER_DATA_SOURCE_AVATAR:J[j.LayoutItemUUID]=n.GetProfileImageURL(q.UserUUID);break;case se.USER_DATA_SOURCE_DISPLAY_NAME:J[j.LayoutItemUUID]=q.User.DisplayName;break;case se.USER_DATA_SOURCE_EMAIL:J[j.LayoutItemUUID]=q.User.Additional.Email;break;case se.USER_DATA_SOURCE_HANDLE:J[j.LayoutItemUUID]=q.User.Handle;break;case se.USER_DATA_SOURCE_DATE_OF_BIRTH:J[j.LayoutItemUUID]=q.User.Additional.DOB;break;case se.USER_DATA_SOURCE_FIRST_NAME:J[j.LayoutItemUUID]=q.User.Additional.FirstName;break;case se.USER_DATA_SOURCE_LAST_NAME:J[j.LayoutItemUUID]=q.User.Additional.LastName;break;case se.USER_DATA_SOURCE_TELEGRAM:J[j.LayoutItemUUID]="";break}else if(j.SourceType==="LAYOUT_ITEM_SOURCE_META"&&j.MetaField){const Qe=($t=r.value.find(B=>B.Type===Te.FORM_TYPE_REGISTRATION))==null?void 0:$t.FormUUID,Ye=q.Submissions.find(B=>B.FormUUID===Qe);switch(j.MetaField){case ae.META_DATA_SOURCE_REGISTRATION_ACTIONS:J[j.LayoutItemUUID]=q;break;case ae.META_DATA_SOURCE_REGISTRATION_GROUP:J[j.LayoutItemUUID]=nt;break;case ae.META_DATA_SOURCE_REGISTRATION_REFERENCE:J[j.LayoutItemUUID]=q.Reference;break;case ae.META_DATA_SOURCE_SUBMISSION_DATE:if(Ye){const B=new Date(Ye.CreatedAt||"");J[j.LayoutItemUUID]=`${B.getFullYear()}-${(B.getMonth()+1).toString().padStart(2,"0")}-${B.getDate().toString().padStart(2,"0")} ${B.getHours().toString().padStart(2,"0")}:${B.getMinutes().toString().padStart(2,"0")}:${B.getSeconds().toString().padStart(2,"0")}`}else{const B=new Date(q.CreatedAt||"");J[j.LayoutItemUUID]=`${B.getFullYear()}-${(B.getMonth()+1).toString().padStart(2,"0")}-${B.getDate().toString().padStart(2,"0")} ${B.getHours().toString().padStart(2,"0")}:${B.getMinutes().toString().padStart(2,"0")}:${B.getSeconds().toString().padStart(2,"0")}`}break;case ae.META_DATA_SOURCE_ACCOMMODATION_FORM:J[j.LayoutItemUUID]=q.Submissions.map(B=>{const Q=r.value.find(Me=>Me.FormUUID===B.FormUUID);return{Heading:Q==null?void 0:Q.Heading,Form:Q,Submission:B,Registration:q}}).filter(B=>{var Q;return((Q=B.Form)==null?void 0:Q.Type)===Te.FORM_TYPE_ACCOMMODATION});break;case ae.META_DATA_SOURCE_BADGE_FORM:J[j.LayoutItemUUID]=q.Submissions.map(B=>{const Q=r.value.find(Me=>Me.FormUUID===B.FormUUID);return{Heading:Q==null?void 0:Q.Heading,Form:Q,Submission:B,Registration:q}}).filter(B=>{var Q;return((Q=B.Form)==null?void 0:Q.Type)===Te.FORM_TYPE_BADGE});break;case ae.META_DATA_SOURCE_DEALER_FORM:J[j.LayoutItemUUID]=q.Submissions.map(B=>{const Q=r.value.find(Me=>Me.FormUUID===B.FormUUID);return{Heading:Q==null?void 0:Q.Heading,Form:Q,Submission:B,Registration:q}}).filter(B=>{var Q;return((Q=B.Form)==null?void 0:Q.Type)===Te.FORM_TYPE_DEALER});break;case ae.META_DATA_SOURCE_PAYMENT_STATUS:if(q.Paid===0&&q.Total)J[j.LayoutItemUUID]="REQUIRED";else if(q.Total>q.Paid)J[j.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const B=nt.find(Q=>Q.Paid===0&&(Q.Total||0)>0);if(B){q.Total===0&&B.Total===0?J[j.LayoutItemUUID]="NOT_REQUIRED":q.Total===0&&B.Total||q.Total>0&&B.Total===0?J[j.LayoutItemUUID]="MISSING_REQUIRED":q.Paid>=q.Total?J[j.LayoutItemUUID]="AWAITING_PARTNER":J[j.LayoutItemUUID]="ALL_REQUIRED";break}else q.Total===0?J[j.LayoutItemUUID]="NOT_REQUIRED":J[j.LayoutItemUUID]="COMPLETE"}break;case ae.META_DATA_SOURCE_SUBMISSION_STATUS:pl(q.Submissions,r.value),J[j.LayoutItemUUID]=q.Submissions.map(B=>{const Q=r.value.find(Me=>Me.FormUUID===B.FormUUID);return{Heading:Q==null?void 0:Q.Heading,Form:Q,Submission:B,Registration:q}});break}}}}),{key:q.RegistrationUUID,registration:q,...J}})}),d.value=!1)})}catch{}},Da=E=>{G.value=!1,E&&(p.value=E,wt())},wt=()=>{p.value.Panels.forEach(E=>{E.Items.forEach(U=>{(U.SectionField==null||U.SectionField.Field==null)&&r.value.find(k=>{k.Sections.find(D=>{if(D.Fields){const re=D.Fields.find(le=>le.SectionFieldUUID===U.SectionFieldUUID);if(re)return U.SectionField=re,!0}})})})}),p.value.Panels.length>0&&(Y.value=[],p.value.Panels.forEach(E=>{const U={uuid:Ie(),order:E.Order,name:E.Name,headers:[],items:[],layout:E};E.Items.sort((k,D)=>k.Order>D.Order?1:k.Order==D.Order?0:-1),U.headers=E.Items.map(k=>{var D,re;return{key:k.LayoutItemUUID,title:k.Label||((re=(D=k.SectionField)==null?void 0:D.Field)==null?void 0:re.Label)||"",align:k.Align==="end"?"end":"start",sortable:Ra(k),type:Sa(k),defaultSort:k.DefaultSort}}),Y.value.push(U)}),Y.value=Y.value.sort((E,U)=>E.order>U.order?1:E.order==U.order?0:-1)),(W.value==null||W.value=="")&&Y.value.length>0&&(W.value=Y.value[0].uuid)};l?u.getConvention(l).then(E=>{E&&(s.value=E,p.value.ConventionID=s.value.ID,p.value.ConventionUUID=s.value.ConventionUUID,Ia())}).catch(()=>{o.push("/")}):o.push("/");const Sa=E=>{var U,k;if(E.SourceType===Xe.LAYOUT_ITEM_SOURCE_META)return`${E.SourceType}.${E.MetaField}`;if(E.SourceType===Xe.LAYOUT_ITEM_SOURCE_FORM)return(k=(U=E.SectionField)==null?void 0:U.Field)==null?void 0:k.Type;if(E.SourceType===Xe.LAYOUT_ITEM_SOURCE_USER)return`${E.SourceType}.${E.UserField}`},Ra=E=>{const U=[ae.META_DATA_SOURCE_ACCOMMODATION_FORM,ae.META_DATA_SOURCE_BADGE_FORM,ae.META_DATA_SOURCE_DEALER_FORM,ae.META_DATA_SOURCE_REGISTRATION_FORM,ae.META_DATA_SOURCE_REGISTRATION_REFERENCE,ae.META_DATA_SOURCE_SUBMISSION_DATE,ae.META_DATA_SOURCE_SUBMISSION_STATUS],k=[se.USER_DATA_SOURCE_DISPLAY_NAME,se.USER_DATA_SOURCE_EMAIL,se.USER_DATA_SOURCE_HANDLE,se.USER_DATA_SOURCE_DATE_OF_BIRTH,se.USER_DATA_SOURCE_FIRST_NAME,se.USER_DATA_SOURCE_LAST_NAME];return U.includes(E.MetaField)||k.includes(E.UserField)},Ca=E=>{Ee.value=E,ke.value=!0},Va=E=>{Ee.value=E,Nt.value=!0},ba=E=>{Ee.value=E,ya.value=!0};me(ke,E=>{E||(Ee.value=void 0)}),me(Nt,E=>{E||(Ee.value=void 0)});const _t=async(E="")=>{Lt.value=await u.getRegistrationGroup(E)},Oa=({registration:E,form:U,submission:k})=>{Ee.value=E,_t(E.RegistrationUUID).then(()=>{lt.value=U,pt.value=k,Ge.value=!0})},ha=E=>{u.switchUser(E.UserUUID).then(U=>{U&&$l(U.tokens,U.user,o,!1)}).catch(U=>{console.error(U)})};return A.on("registration.group.leave",E=>{u.leaveRegistrationGroup(E).then(U=>{U&&_t(E).then(()=>{A.emit("registration.group.left",U)})})}),A.on("registration.group.remove.member",E=>{u.leaveRegistrationGroup(E).then(U=>{U&&_t(E).then(()=>{A.emit("registration.group.left",U)})})}),(E,U)=>(m(),N(Bl,null,{default:a(()=>[t(Vt,{color:"blue-darken-4"},{default:a(()=>[t(va,{modelValue:W.value,"onUpdate:modelValue":U[0]||(U[0]=k=>W.value=k),"show-arrows":""},{default:a(()=>[(m(!0),S(L,null,X(Y.value,k=>(m(),N(ca,{key:k.uuid,value:k.uuid},{default:a(()=>[V(C(k.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(we),t(H,{icon:"mdi:mdi-cog-outline",onClick:U[1]||(U[1]=k=>G.value=!0)})]),_:1}),t(pa,{modelValue:W.value,"onUpdate:modelValue":U[23]||(U[23]=k=>W.value=k),disabled:!0,touch:!1},{default:a(()=>[(m(!0),S(L,null,X(Y.value,k=>(m(),N(Le,{key:k.uuid,value:k.uuid},{default:a(()=>[k.uuid===W.value?(m(),N(be,{key:0,class:"pa-2"},{default:a(()=>[t(M(Kl),{expanded:g.value,"onUpdate:expanded":U[19]||(U[19]=D=>g.value=D),page:R.value,"onUpdate:page":U[20]||(U[20]=D=>R.value=D),"items-per-page":O.value,"onUpdate:itemsPerPage":U[21]||(U[21]=D=>O.value=D),"sort-by":ze.value,"onUpdate:sortBy":U[22]||(U[22]=D=>ze.value=D),headers:k.headers,"items-length":K.value,items:k.items,"item-value":"key",loading:d.value,search:te.value,"onUpdate:options":gt,"show-expand":""},qe({top:a(()=>[t(ft,{class:"mb-3"},{default:a(()=>[t(ct,null,{default:a(()=>[t(mt,{color:"secondary",class:"font-weight-bold pb-0 pt-0"},{default:a(()=>[t(b,{class:"pa-0"},{default:a(()=>[V(" Search Criteria "),t(ut,{class:"pl-5",icon:"mdi:mdi-credit-card-search-outline"})]),_:1}),t(b,{class:"d-none d-sm-block pa-0",cols:"0"},{default:a(()=>[t(ue,{modelValue:T.value,"onUpdate:modelValue":U[2]||(U[2]=D=>T.value=D),label:"Badge No.",clearable:!0,"hide-details":"",variant:"plain",onClick:U[3]||(U[3]=St(()=>{},["stop"])),"onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{class:"d-none d-md-block pa-0"},{default:a(()=>[t(ue,{modelValue:I.value.Value,"onUpdate:modelValue":U[4]||(U[4]=D=>I.value.Value=D),label:"Furry Name",clearable:!0,"hide-details":"",variant:"plain",onClick:U[5]||(U[5]=St(()=>{},["stop"])),"onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1})]),_:1}),t(vt,{class:"pt-2"},{default:a(()=>[t(z,null,{default:a(()=>[t(b,{cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:a(()=>[t(ue,{modelValue:T.value,"onUpdate:modelValue":U[6]||(U[6]=D=>T.value=D),label:"Badge No.",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{cols:"12",sm:"6",md:"4",lg:"5",xl:"2"},{default:a(()=>[t(ue,{modelValue:I.value.Value,"onUpdate:modelValue":U[7]||(U[7]=D=>I.value.Value=D),label:"Furry Name",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{cols:"12",sm:"12",md:"5",lg:"5",xl:"3"},{default:a(()=>[t(ue,{modelValue:y.value,"onUpdate:modelValue":U[8]||(U[8]=D=>y.value=D),label:"E-mail",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{cols:"12",sm:"6",md:"4",lg:"4",xl:"2"},{default:a(()=>[t(ue,{modelValue:h.value.Value,"onUpdate:modelValue":U[9]||(U[9]=D=>h.value.Value=D),label:"Legal Forename",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{cols:"12",sm:"6",md:"4",lg:"4",xl:"2"},{default:a(()=>[t(ue,{modelValue:$.value.Value,"onUpdate:modelValue":U[10]||(U[10]=D=>$.value.Value=D),label:"Legal Surname",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{cols:"12",sm:"12",md:"4",lg:"4",xl:"2"},{default:a(()=>[t(ue,{modelValue:ee.value.Value,"onUpdate:modelValue":U[11]||(U[11]=D=>ee.value.Value=D),type:"date",label:"Date of Birth",clearable:!0,"hide-details":"",variant:"outlined","onClick:clear":M(ve),onInput:M(ve)},null,8,["modelValue","onClick:clear","onInput"])]),_:1}),t(b,{cols:"12",sm:"6",md:"6",lg:"6",xl:"6"},{default:a(()=>[t(Ue,{modelValue:ne.value,"onUpdate:modelValue":U[12]||(U[12]=D=>ne.value=D),label:"Permission Groups",clearable:!0,"hide-details":"",variant:"outlined",items:v.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"12",sm:"6",md:"6",lg:"6",xl:"6"},{default:a(()=>[t(Ue,{modelValue:$e.value,"onUpdate:modelValue":U[13]||(U[13]=D=>$e.value=D),label:"Tags",clearable:!0,"hide-details":"",variant:"outlined",items:w.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),"expanded-row":a(({columns:D,item:re})=>[F("tr",null,[F("td",{colspan:D.length},[t(Zt,{modelValue:ke.value,"onUpdate:modelValue":U[15]||(U[15]=le=>ke.value=le),registration:re.selectable.registration,"onUpdate:registration":le=>re.selectable.registration=le,accommodations:xe.value,convention:s.value,extras:Be.value,forms:r.value,interests:De.value,tickets:Oe.value,title:`Registration Controls (#${re.selectable.registration.Reference} ${re.selectable.registration.User.DisplayName})`,"use-dialog":!1,venues:he.value},null,8,["modelValue","registration","onUpdate:registration","accommodations","convention","extras","forms","interests","tickets","title","venues"])],8,Yo)])]),"item.data-table-expand":a(({item:D})=>[g.value.findIndex(re=>re===D.key)>=0?(m(),N(H,{key:0,"append-icon":"mdi:mdi-chevron-up",size:"xs",variant:"flat",onClick:re=>g.value.splice(g.value.findIndex(le=>le===D.key),1)},{default:a(()=>[D.selectable.registration.Notes&&D.selectable.registration.Notes.length>0?(m(),S(L,{key:0},[V(C(D.selectable.registration.Notes.length),1)],64)):x("",!0)]),_:2},1032,["onClick"])):(m(),N(H,{key:1,"append-icon":"mdi:mdi-chevron-down",size:"xs",variant:"flat",onClick:re=>g.value.push(D.key)},{default:a(()=>[D.selectable.registration.Notes&&D.selectable.registration.Notes.length>0?(m(),S(L,{key:0},[V(C(D.selectable.registration.Notes.length),1)],64)):x("",!0)]),_:2},1032,["onClick"]))]),bottom:a(()=>[t(pe,{fluid:!0},{default:a(()=>[t(z,{class:"align-center"},{default:a(()=>[t(b,{cols:"12",lg:"7","order-lg":"3",xl:"8"},{default:a(()=>[t(Go,{modelValue:R.value,"onUpdate:modelValue":U[16]||(U[16]=D=>R.value=D),length:Math.ceil(K.value/O.value)},null,8,["modelValue","length"])]),_:1}),t(b,{cols:"6",sm:"4",md:"2",lg:"2",xl:"1","order-lg":"1"},{default:a(()=>[t(Ue,{"model-value":O.value,density:"compact","hide-details":"","item-title":"title","item-value":"value",label:"Items per page",min:"-1",max:"100",type:"number",variant:"outlined",items:[{title:"10",value:10},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100},{title:"All",value:-1}],"onUpdate:modelValue":U[17]||(U[17]=D=>O.value=parseInt(D,10))},null,8,["model-value"])]),_:1}),t(b,{cols:"6",sm:"3",md:"2",lg:"1",xl:"1","order-lg":"2"},{default:a(()=>[t(ue,{modelValue:R.value,"onUpdate:modelValue":U[18]||(U[18]=D=>R.value=D),modelModifiers:{number:!0},density:"compact","hide-details":"",label:"Page",min:"1",max:Math.ceil(K.value/O.value),type:"number",variant:"outlined"},null,8,["modelValue","max"])]),_:1}),t(b,{class:"text-right",cols:"12",sm:"5",md:"8",lg:"2",xl:"2","order-lg":"4"},{default:a(()=>[F("span",Ho,[O.value===-1?(m(),S(L,{key:0},[V(" 1-"+C(K.value)+" of "+C(K.value),1)],64)):(m(),S(L,{key:1},[V(C((R.value-1)*O.value+1)+"-"+C(R.value*O.value>=K.value?K.value:R.value*O.value)+" of "+C(K.value),1)],64))])]),_:1})]),_:1})]),_:1})]),_:2},[X(k.headers,D=>({name:`item.${D.key}`,fn:a(({item:re})=>[t(kn,{header:D,item:re,accommodations:xe.value,convention:s.value,extras:Be.value,forms:r.value,interests:De.value,tickets:Oe.value,user:M(Ea),venues:he.value,onOpenActions:Ca,onOpenPayments:Va,onOpenTags:ba,onReload:U[14]||(U[14]=le=>gt({page:R.value,itemsPerPage:O.value,sortBy:P.value})),onSwitchUser:ha,onShowForm:Oa},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","user","venues"])])}))]),1032,["expanded","page","items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):x("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),G.value?(m(),N($o,{key:0,title:"Edit Layouts",modelValue:G.value,"onUpdate:modelValue":U[24]||(U[24]=k=>G.value=k),convention:s.value,onSave:Da},null,8,["modelValue","convention"])):x("",!0),Ee.value?(m(),S(L,{key:1},[ke.value?(m(),N(Zt,{key:0,modelValue:ke.value,"onUpdate:modelValue":U[25]||(U[25]=k=>ke.value=k),registration:Ee.value,"onUpdate:registration":U[26]||(U[26]=k=>Ee.value=k),accommodations:xe.value,convention:s.value,extras:Be.value,forms:r.value,interests:De.value,tickets:Oe.value,title:`Registration Controls (#${Ee.value.Reference} ${Ee.value.User.DisplayName})`,"use-dialog":!0,venues:he.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","title","venues"])):x("",!0)],64)):x("",!0),Ge.value&&pt.value&&lt.value?(m(),N(rt,{key:2,modelValue:Ge.value,"onUpdate:modelValue":U[30]||(U[30]=k=>Ge.value=k),scrollable:!0,fullscreen:!0,persistent:!0},{default:a(()=>[t(be,{class:"bg-red-darken-4"},{default:a(()=>[t(Vt,{color:"error"},{default:a(()=>[t(Aa,null,{default:a(()=>[V("Submission Editor - Admin Mode")]),_:1}),t(we),t(xl,null,{default:a(()=>[t(H,{icon:"mdi:mdi-window-close",onClick:U[27]||(U[27]=k=>Ge.value=!1)})]),_:1})]),_:1}),t(Fe,null,{default:a(()=>[t(Za,{modelValue:lt.value,"onUpdate:modelValue":U[28]||(U[28]=k=>lt.value=k),admin:!0,convention:s.value,data:pt.value,editable:!0,"registration-group":Lt.value,onClose:U[29]||(U[29]=k=>{Ge.value=!1,gt({page:R.value,itemsPerPage:O.value,sortBy:P.value})})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):x("",!0)]),_:1}))}});export{Oi as default};
