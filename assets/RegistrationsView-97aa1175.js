import{p as ut,n as rt,e as ie,t as Ee,c as dt,G as mt,v as o,H as N,x as we,I as ue,a3 as Ie,a4 as Ye,r as c,K as me,M as l,N as L,O as i,a1 as ke,W as Q,a9 as Be,a0 as K,S as W,w as Se,X as $,Q as M,V as S,P as w,_ as tt,a5 as At,a2 as Ut}from"./index-a2539a30.js";import{e as _t,T as ct,d as vt,c as Tt}from"./FormRenderer.vue_vue_type_style_index_0_lang-56290e42.js";import{a as Et,F as se}from"./form-29fd1dbb.js";import{_ as He}from"./ModelDialog.vue_vue_type_script_setup_true_lang-003c64fc.js";import{m as St,k as Rt,l as Dt,n as It,o as Ot,p as ft,q as pt,u as gt,r as Ct,s as yt,t as Mt,v as ht,w as Nt,x as Vt,y as bt,z as ze,A as Xe,B as Qe,a as Lt,_ as kt,f as Ze,g as Ft,h as Pt,i as $t,j as wt}from"./VWindowItem-e7d07d45.js";import{a as ne,V as q}from"./VRow-0272e6c7.js";import{V as pe}from"./VTextField-40eff1ab.js";import{V as te}from"./copyToClipboard-468b07de.js";import{u as Gt,j as De,V as Bt}from"./VContainer-f2b55bc8.js";import{V as Yt,u as at}from"./VCheckbox-13eac685.js";import{v as ge}from"./v4-a960c1f4.js";import{V as Le,a as Ce}from"./VList-2fee4a5a.js";import{V as ye}from"./VBtn-7e2675d0.js";import{a as ot,b as xe}from"./submission-fa749080.js";import{V as Ht}from"./VAvatar-935d6ee6.js";import{c as qt,e as lt}from"./VCard-bfa3ad63.js";import{V as jt}from"./VDialog-c4d5e64b.js";import{s as Ve}from"./sortSubmissions-8ed80f07.js";import{V as Kt,u as Jt}from"./VSpacer-e80b0540.js";import{u as Ge,V as Wt}from"./VToolbar-ab82386f.js";import{V as et,a as zt}from"./VTable-f1adf7cc.js";import"./index-26b71cef.js";import"./VChip-037d5fe1.js";import"./scopeId-ed117be4.js";import"./VTextarea-7ec6da3f.js";import"./userData-229899c9.js";import"./VForm-6fdfe211.js";import"./VToolbarItems-ec3b2a17.js";import"./VDivider-2cf0869d.js";var nt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(nt||{});const Xt=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Me=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Me||{});const Qt=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var P=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(P||{});const Zt=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var H=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(H||{});const xt=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],ea=ut({itemsLength:{type:[Number,String],required:!0},...St(),...Rt(),...Dt()},"VDataTableServer"),ta=rt()({name:"VDataTableServer",props:ea(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,k)=>!0},setup(e,k){let{emit:D,slots:a}=k;const{groupBy:d}=It(e),{sortBy:u,multiSort:g,mustSort:R}=Ot(e),{page:y,itemsPerPage:f}=ft(e),I=ie(()=>parseInt(e.itemsLength,10)),{columns:t,headers:s}=pt(e,{groupBy:d,showSelect:Ee(e,"showSelect"),showExpand:Ee(e,"showExpand")}),{items:v}=gt(e,t),{toggleSort:A}=Ct({sortBy:u,multiSort:g,mustSort:R,page:y}),{opened:x,isGroupOpen:F,toggleGroup:re,extractRows:Re}=yt({groupBy:d,sortBy:u}),{pageCount:Z,setItemsPerPage:X}=Mt({page:y,itemsPerPage:f,itemsLength:I}),{flatItems:ae}=ht(v,d,x),{isSelected:Ae,select:Ue,selectAll:T,toggleSelect:E,someSelected:p,allSelected:U}=Nt(e,{allItems:v,currentPage:v}),{isExpanded:C,toggleExpand:j}=Vt(e),J=ie(()=>Re(v.value));bt({page:y,itemsPerPage:f,sortBy:u,groupBy:d,search:Ee(e,"search")}),dt("v-data-table",{toggleSort:A,sortBy:u}),mt({VDataTableRows:{hideNoData:Ee(e,"hideNoData"),noDataText:Ee(e,"noDataText"),loading:Ee(e,"loading"),loadingText:Ee(e,"loadingText")}});const G=ie(()=>({page:y.value,itemsPerPage:f.value,sortBy:u.value,pageCount:Z.value,toggleSort:A,setItemsPerPage:X,someSelected:p.value,allSelected:U.value,isSelected:Ae,select:Ue,selectAll:T,toggleSelect:E,isExpanded:C,toggleExpand:j,isGroupOpen:F,toggleGroup:re,items:J.value,groupedItems:ae.value,columns:t.value,headers:s.value}));Gt(()=>{const[oe]=ze.filterProps(e),[_e]=Xe.filterProps(e),[ce]=Qe.filterProps(e),[Fe]=et.filterProps(e);return o(et,we({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Fe),{top:()=>{var de;return(de=a.top)==null?void 0:de.call(a,G.value)},default:()=>{var de,Oe,he,Ne;return a.default?a.default(G.value):o(N,null,[(de=a.colgroup)==null?void 0:de.call(a,G.value),o("thead",{class:"v-data-table__thead",role:"rowgroup"},[o(Xe,we(_e,{sticky:e.fixedHeader}),a)]),(Oe=a.thead)==null?void 0:Oe.call(a,G.value),o("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[a.body?a.body(G.value):o(Qe,we(ce,{items:ae.value}),a)]),(he=a.tbody)==null?void 0:he.call(a,G.value),(Ne=a.tfoot)==null?void 0:Ne.call(a,G.value)])},bottom:()=>a.bottom?a.bottom(G.value):o(ze,oe,{prepend:a["footer.prepend"]})})})}}),aa=ue({__name:"EditAdminLayout",props:Ie({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ie(["save"],["update:modelValue"]),setup(e,{emit:k}){const D=Ye(e,"modelValue"),a=c(me(e.layout)),d=c([]),u=ke(),g=({callback:I})=>{const t=()=>{I&&I("Failed to Save Layout")},s=()=>{I&&I("Layout Saved")};u.saveAdminLayout(a.value).then(v=>{v?(s(),k("save",v)):t()}).catch(()=>{t()})},R=()=>({ID:0,LayoutPanelUUID:ge(),AdminLayoutID:a.value.ID,AdminLayoutUUID:a.value.AdminLayoutUUID,Name:"",Order:a.value.Panels.length+1,Items:[],RequiredFormType:se.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),y=I=>()=>({ID:0,LayoutItemUUID:ge(),LayoutPanelID:I.ID,LayoutPanelUUID:I.LayoutPanelUUID,Label:"",SourceType:Me.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:I.Items.length+1,DefaultSort:!1}),f=I=>{const t=d.value.find(s=>s.value===I.SectionFieldUUID);t&&(I.SectionFieldID=t.object.ID,I.SectionField=t.object)};return u.getConventionForms(e.layout.ConventionUUID).then(I=>{I.forEach(t=>t.Sections.forEach(s=>s.Fields&&d.value.push(...s.Fields.map(v=>{var x;return{title:`${t.Name} - ${s.Name} - ${(x=v.Field)==null?void 0:x.Name}`,value:v.SectionFieldUUID,object:v}})))),d.value.sort(_t("title"))}),(I,t)=>(l(),L(He,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=s=>D.value=s),onSave:g,title:I.title,color:"primary"},{default:i(()=>[o(De,{class:"px-0 mx-0",fluid:!0},{default:i(()=>[o(ne,null,{default:i(()=>[o(q,{cols:"12",sm:"6"},{default:i(()=>[o(pe,{modelValue:a.value.Name,"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.Name=s),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),o(q,{cols:"12",sm:"6"},{default:i(()=>[o(te,{modelValue:a.value.Type,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.Type=s),label:"Layout Type",items:Q(Xt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),o(Ze,{modelValue:a.value.Panels,"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.Panels=s),"new-item":R,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},Be({_:2},[K(a.value.Panels,(s,v)=>({name:`panel_${v}`,fn:i(()=>[o(De,{class:"px-0 mx-0",fluid:!0},{default:i(()=>[o(ne,null,{default:i(()=>[o(q,{cols:"12",sm:"6"},{default:i(()=>[o(pe,{modelValue:s.Name,"onUpdate:modelValue":A=>s.Name=A,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(q,{cols:"12",sm:"6"},{default:i(()=>[o(te,{modelValue:s.RequiredFormType,"onUpdate:modelValue":A=>s.RequiredFormType=A,items:Q(Et),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),o(ne,null,{default:i(()=>[o(q,{cols:"12",sm:"6"},{default:i(()=>[o(Lt,{label:"Required Groups",variant:"outlined",modelValue:s.RequiredGroupMemberships,"onUpdate:modelValue":A=>s.RequiredGroupMemberships=A,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),o(q,{cols:"12",sm:"6"},{default:i(()=>[o(kt,{label:"Registration Tags",variant:"outlined",modelValue:s.RequiredRegistrationTags,"onUpdate:modelValue":A=>s.RequiredRegistrationTags=A,convention:a.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(Ze,{modelValue:s.Items,"onUpdate:modelValue":A=>s.Items=A,"new-item":y(s),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},Be({_:2},[K(s.Items,(A,x)=>({name:`item_${x}`,fn:i(()=>[o(De,{class:"px-0 mx-0",fluid:!0},{default:i(()=>[o(ne,null,{default:i(()=>[o(q,{cols:"12",sm:"6"},{default:i(()=>[o(pe,{modelValue:A.Label,"onUpdate:modelValue":F=>A.Label=F,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(ne,null,{default:i(()=>[o(q,{cols:"12",sm:"6"},{default:i(()=>[o(te,{modelValue:A.SourceType,"onUpdate:modelValue":F=>A.SourceType=F,label:"Source Type",items:Q(Qt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(q,{cols:"12",sm:"6"},{default:i(()=>[A.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(l(),L(te,{key:0,modelValue:A.SectionFieldUUID,"onUpdate:modelValue":F=>A.SectionFieldUUID=F,label:"Form Data",items:d.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:F=>f(A)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):A.SourceType==="LAYOUT_ITEM_SOURCE_META"?(l(),L(te,{key:1,modelValue:A.MetaField,"onUpdate:modelValue":F=>A.MetaField=F,label:"Miscellaneous Data",items:Q(Zt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):A.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(l(),L(te,{key:2,modelValue:A.UserField,"onUpdate:modelValue":F=>A.UserField=F,label:"User Profile Data",items:Q(xt),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):W("",!0)]),_:2},1024)]),_:2},1024),o(ne,null,{default:i(()=>[o(q,null,{default:i(()=>[o(Yt,{modelValue:A.DefaultSort,"onUpdate:modelValue":F=>A.DefaultSort=F,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),be=e=>(typeof e=="string"&&(e=new Date(e)),`${e.toLocaleString("default",{weekday:"long"})} ${e.getDate()}${oa(e.getDate())} ${e.toLocaleString("default",{month:"long"})}`),oa=e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},la=$("br",null,null,-1),na=$("h3",null,"Assigned Accommodation",-1),ia=$("br",null,null,-1),sa=$("br",null,null,-1),ua=$("h3",null,"Accommodation Preferences",-1),ra=$("h3",null,"Selected Tickets",-1),da=$("br",null,null,-1),ma=ue({__name:"EditAccommodationAssignmentDialog",props:Ie({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ie(["update:field"],["update:modelValue"]),setup(e,{emit:k}){const D=e,{convention:a,registration:d,title:u=""}=D,g=ke(),R=Ye(e,"modelValue"),y=c({capacity:{max:T=>{var U;const E=Z.value.find(C=>C.room.RoomUUID===T);return!E||E.room.MaximumCapacity===0?!0:(((U=s.value)==null?void 0:U.Members.length)||0)<=E.room.MaximumCapacity||"Too many people in the group for this room"},min:T=>{var U;const E=Z.value.find(C=>C.room.RoomUUID===T);return!E||E.room.MinimumCapacity===0?!0:(((U=s.value)==null?void 0:U.Members.length)||0)>=E.room.MinimumCapacity||"Not enough people in the group for this room"}}}),f=c([]),I=at(D,k,void 0,void 0,"field"),t=c(me(I.value));Se(I,()=>{t.value=me(I.value)});const s=c(),v=c(""),A=c(""),x=c([]),F=c({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),re=async()=>{var U;const T=await g.getConventionAvailableAccommodation(a.ConventionUUID);T&&(f.value=T);const E=await g.getRegistrationGroup(d.RegistrationUUID||"");E&&(s.value=E);const p=await g.getConventionTickets(a.ConventionUUID);p&&(x.value=p);try{F.value=JSON.parse(((U=s.value)==null?void 0:U.TicketData)||"")}catch{}};Se(v,()=>{A.value=Z.value.length>0?Z.value[0].value:""});const Re=ie(()=>{const T=X.value;return f.value.map(E=>{let p;return T.forEach(U=>{E.Costs.forEach(C=>{C.DateStart===(U==null?void 0:U.DateStart)&&C.DateEnd===U.DateEnd&&(p===void 0||p>C.Availability)&&(p=C.Availability)})}),{label:`${E.Name}`,title:`${E.Name} (${p} Available)`,value:E.AccommodationUUID}})}),Z=ie(()=>{const T=X.value,E=f.value.find(p=>p.AccommodationUUID===v.value);return(E==null?void 0:E.Pool.map(p=>{var C,j;let U;return T.forEach(J=>{p.Costs.forEach(G=>{G.DateStart===(J==null?void 0:J.DateStart)&&G.DateEnd===J.DateEnd&&(U===void 0||U>G.Availability)&&(U=G.Availability)})}),{label:`${(C=p.Venue)==null?void 0:C.Name} - ${p.Name}`,title:`${(j=p.Venue)==null?void 0:j.Name} - ${p.Name} (${U} Available)`,value:p.RoomUUID,room:p}}))||[]}),X=ie(()=>[...F.value.Ticket,...F.value.AddonsChecked,...F.value.ComponentsChecked].map(T=>x.value.find(E=>E.TicketUUID===T)).filter(T=>T!==void 0&&T.RequiresAccommodation)),ae=T=>{var E;g.assignAccommodation(((E=s.value)==null?void 0:E.Registration.RegistrationUUID)||"",v.value,A.value,!1).then(p=>{p?(re(),T&&T("Room Assigned")):T&&T("Room not assigned")}).catch(()=>{T&&T("Room not assigned")})},Ae=T=>{var E,p;(E=s.value)!=null&&E.Registration.AllocationUUID?g.deleteAllocation(((p=s.value)==null?void 0:p.Registration.AllocationUUID)||"").then(U=>{U?(re(),T&&T("Allocation Deleted")):T&&T("Allocation not deleted")}).catch(()=>{T&&T("Allocation not deleted")}):T&&T("Nothing to Delete")},Ue=T=>{var p,U;const E=(p=f.value.find(C=>C.AccommodationUUID===T.AccommodationUUID))==null?void 0:p.Pool;if(E){const C=E.find(j=>j.RoomUUID===T.RoomUUID);if(C)return`${(U=C.Venue)==null?void 0:U.Name} - ${C.Name}`}return""};return re(),(T,E)=>{var p;return l(),L(He,{modelValue:R.value,"onUpdate:modelValue":E[2]||(E[2]=U=>R.value=U),title:Q(u),color:"primary","show-close-action":!0,"show-delete-action":!!((p=s.value)!=null&&p.Registration.Allocation),"show-save-action":!!A.value,"save-button-label":"Assign Room",onDelete:Ae,onSave:ae},{default:i(()=>[o(De,{class:"pa-0",fluid:!0},{default:i(()=>[o(ne,null,{default:i(()=>{var U;return[o(q,{cols:"12",md:"6"},{default:i(()=>{var C,j;return[$("h3",null,"Group Members ("+M((C=s.value)==null?void 0:C.Members.length)+")",1),(l(!0),S(N,null,K((j=s.value)==null?void 0:j.Members,J=>(l(),S(N,{key:J.UUID},[w(" #"+M(J.Reference)+" "+M(J.Name),1),la],64))),128))]}),_:1}),(U=s.value)!=null&&U.Registration.Allocation?(l(),L(q,{key:0,cols:"12",md:"6"},{default:i(()=>[na,o(Le,null,{default:i(()=>{var C;return[(l(!0),S(N,null,K((C=s.value)==null?void 0:C.Registration.Allocation.Periods,j=>(l(),L(Ce,{key:j.AllocationPeriodUUID},{default:i(()=>{var J;return[w(M((J=f.value.find(G=>G.AccommodationUUID===j.AccommodationUUID))==null?void 0:J.Name)+" ",1),ia,w(" "+M(Ue(j))+" ",1),sa,$("small",null,"("+M(Q(be)(j.DateStart))+" - "+M(Q(be)(j.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):W("",!0)]}),_:1}),o(ne,null,{default:i(()=>[o(q,{cols:"12",md:"6"},{default:i(()=>[T.selectedAccommodation.length?(l(),S(N,{key:0},[ua,o(Le,null,{default:i(()=>[(l(!0),S(N,null,K(T.selectedAccommodation,(U,C)=>(l(),L(Ce,{key:U.AccommodationUUID},{default:i(()=>[w(M(C+1)+". "+M(U.Name),1)]),_:2},1024))),128))]),_:1})],64)):W("",!0)]),_:1}),o(q,{cosl:"12",md:"6"},{default:i(()=>[ra,o(Le,null,{default:i(()=>[(l(!0),S(N,null,K(X.value,U=>(l(),L(Ce,{key:U==null?void 0:U.TicketUUID},{default:i(()=>[w(M(U.Name)+" ",1),da,$("small",null,"("+M(Q(be)(U.DateStart))+" - "+M(Q(be)(U.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),o(ne,null,{default:i(()=>[o(q,{cols:"12",md:"6"},{default:i(()=>[o(te,{modelValue:v.value,"onUpdate:modelValue":E[0]||(E[0]=U=>v.value=U),items:Re.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),o(q,{cols:"12",md:"6"},{default:i(()=>[o(te,{modelValue:A.value,"onUpdate:modelValue":E[1]||(E[1]=U=>A.value=U),items:Z.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[y.value.capacity.min,y.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),Aa={key:0,class:"accommodationList"},Ua={key:0,class:"text-orange-darken-2"},_a=ue({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},registration:{},value:{default:""},venues:{}},setup(e){const k=c(!1),D=ie(()=>{if(!e.value)return[];const a=JSON.parse(e.value),d=e.accommodations.filter(u=>a.includes(u.AccommodationUUID)).sort((u,g)=>{const R=a.findIndex(f=>f===u.AccommodationUUID),y=a.findIndex(f=>f===g.AccommodationUUID);return R>y?1:-1});return me(d)});return(a,d)=>(l(),S(N,null,[a.value?(l(),S("ol",Aa,[(l(!0),S(N,null,K(D.value,u=>(l(),S("li",{key:u.AccommodationUUID},[a.registration&&a.registration.Allocation&&a.registration.Allocation.Periods.find(g=>g.AccommodationUUID===u.AccommodationUUID)?(l(),S("strong",Ua,M(u.Name),1)):(l(),S(N,{key:1},[w(M(u.Name),1)],64))]))),128))])):W("",!0),o(ye,{onClick:d[0]||(d[0]=u=>k.value=!0),variant:"flat",color:"success"},{default:i(()=>[w("Assign Accommodation")]),_:1}),a.convention&&k.value?(l(),L(ma,{key:1,modelValue:k.value,"onUpdate:modelValue":d[1]||(d[1]=u=>k.value=u),title:"Accommodation Allocation",convention:a.convention,registration:a.registration,"selected-accommodation":D.value},null,8,["modelValue","convention","registration","selected-accommodation"])):W("",!0)],64))}});const ca=tt(_a,[["__scopeId","data-v-c426aacc"]]),va={key:0,class:"addonList"},Ta={key:0},Ea={key:0},Sa=ue({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const k=ie(()=>{if(!e.value)return;const D=JSON.parse(e.value),a=Object.keys(D),d=me(e.extras);return d.forEach(u=>{u.Options=u.Options.filter(g=>a.includes(g.OptionUUID)?(g.Choices=g.Choices.filter(R=>R.TagUUID===D[g.OptionUUID].choiceId),D[g.OptionUUID].checked):!1)}),d.filter(u=>u.Options.length>0),d});return(D,a)=>D.value?(l(),S("ul",va,[(l(!0),S(N,null,K(k.value,d=>(l(),S(N,{key:d.ExtraUUID},[d.Options.length?(l(),S("li",Ta,[$("strong",null,M(d.Name),1),$("ul",null,[(l(!0),S(N,null,K(d.Options,u=>(l(),S("li",{key:u.OptionUUID},[w(M(u.Name)+" ",1),u.Choices.length==1?(l(),S("small",Ea,"("+M(u.Choices[0].Title)+")",1)):W("",!0)]))),128))])])):W("",!0)],64))),128))])):W("",!0)}});const Ra=tt(Sa,[["__scopeId","data-v-55786e01"]]),Da={key:0},Ia=ue({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const k=ie(()=>{if(!e.value)return;const D=JSON.parse(e.value);return Object.entries(D).filter(([,a])=>a).map(([a,d])=>e.interests.find(u=>u.InterestUUID===a)).filter(a=>a!==void 0)});return(D,a)=>D.value?(l(),S("ul",Da,[(l(!0),S(N,null,K(k.value,d=>(l(),S("li",{key:d.InterestUUID},M(d.Name),1))),128))])):W("",!0)}}),Oa=$("br",null,null,-1),fa=$("small",null,"Options:",-1),pa=$("br",null,null,-1),ga=$("small",null,"Addons:",-1),Ca=ue({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const k=ie(()=>{if(!e.value)return;let D={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{D=JSON.parse(e.value),"ticket"in D&&(D.Ticket=D.ticket),"addonsChecked"in D&&(D.AddonsChecked=D.addonsChecked),"componentsChecked"in D&&(D.ComponentsChecked=D.componentsChecked)}catch{}return D.Ticket.filter(a=>{const d=e.tickets.find(u=>u.TicketUUID===a);return!(!d||d.Type!==ct.TICKET_TYPE_TICKET)}).map(a=>{const d=e.tickets.find(g=>g.TicketUUID===a),u=me(d);return u.TicketComponents=d.TicketComponents.filter(g=>D.ComponentsChecked.includes(g.TicketUUID)),u.AddonTickets=d.AddonTickets.filter(g=>D.AddonsChecked.includes(g.TicketUUID)),u})});return(D,a)=>D.value?(l(!0),S(N,{key:0},K(k.value,d=>(l(),S("div",{key:d.TicketUUID},[$("strong",null,M(d.Name),1),d.TicketComponents.length>0?(l(),S(N,{key:0},[Oa,fa,w("  "),(l(!0),S(N,null,K(d.TicketComponents,u=>(l(),S(N,{key:u.TicketUUID},[$("small",null,M(u.Name),1),w("  ")],64))),128))],64)):W("",!0),d.AddonTickets.length>0?(l(),S(N,{key:1},[pa,ga,w("  "),(l(!0),S(N,null,K(d.AddonTickets,u=>(l(),S("small",{key:u.TicketUUID},[w("("),$("em",null,M(u.Name),1),w(")")]))),128))],64)):W("",!0)]))),128)):W("",!0)}}),ya={key:0},Ma={key:0},ha=$("strong",null,"Total:",-1),Na=ue({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","reload"],setup(e,{emit:k}){const D=ke(),a=c(),d=c(),u=c(),g=c(),R=c(!1),y=t=>{console.log(t)},f=(t,s,v)=>{d.value=t,D.getRegistrationGroup(v.RegistrationUUID||"").then(A=>{u.value=A,a.value=s,g.value=v,R.value=!0})},I=t=>{k("openActions",t)};return(t,s)=>(l(),S(N,null,[t.header.key=="actions"?(l(),L(ye,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:s[0]||(s[0]=v=>y(t.item.raw))})):t.header.type==="ACCOMMODATION"&&t.accommodations.length>0&&t.item.raw[t.header.key]?(l(),L(ca,{key:1,value:t.item.raw[t.header.key].Data,accommodations:t.accommodations,convention:t.convention,venues:t.venues,registration:t.item.raw[t.header.key].Registration},null,8,["value","accommodations","convention","venues","registration"])):t.header.type==="EXTRAS"&&t.extras.length>0?(l(),L(Ra,{key:2,value:t.item.raw[t.header.key],extras:t.extras},null,8,["value","extras"])):t.header.type==="INTERESTS"&&t.interests.length>0?(l(),L(Ia,{key:3,value:t.item.raw[t.header.key],interests:t.interests},null,8,["value","interests"])):t.header.type==="TICKET"&&t.tickets.length>0?(l(),L(Ca,{key:4,value:t.item.raw[t.header.key],tickets:t.tickets},null,8,["value","tickets"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(l(!0),S(N,{key:5},K(t.item.raw[t.header.key],v=>(l(),S("ul",{key:v.Heading},[$("li",null,[$("strong",null,M(v.Heading)+":",1),w(" "+M(Q(ot)(v.Submission.Status))+" ",1),o(ye,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:A=>f(v.Registration,v.Form,v.Submission)},null,8,["onClick"])])]))),128)):t.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(l(),L(Ht,{key:6,class:"rounded-circle",src:t.item.raw[t.header.key],height:"32",width:"32"},null,8,["src"])):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(l(),L(ye,{key:7,icon:"mdi:mdi-email-fast",variant:"flat",onClick:s[1]||(s[1]=v=>I(t.item.raw[t.header.key]))})):t.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(l(),S(N,{key:8},[t.item.raw[t.header.key].length===1?(l(),S("em",ya," Not in a group ")):(l(),S(N,{key:1},[$("ul",null,[(l(!0),S(N,null,K(t.item.raw[t.header.key],v=>(l(),S("li",{key:v.UUID,class:"ml-0"},[w(" #"+M(v.Reference)+" : "+M(v.Name)+" ",1),v.IsLeader?(l(),S("strong",Ma,"(Leader)")):W("",!0)]))),128))]),ha,w(" "+M(t.item.raw[t.header.key].length),1)],64))],64)):(l(),S(N,{key:9},[w(M(t.item.raw[t.header.key]),1)],64)),R.value&&g.value&&a.value?(l(),L(jt,{key:10,modelValue:R.value,"onUpdate:modelValue":s[4]||(s[4]=v=>R.value=v),scrollable:!0},{default:i(()=>[o(lt,{class:"bg-red-darken-4"},{default:i(()=>[o(qt,null,{default:i(()=>[o(vt,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=v=>a.value=v),admin:!0,convention:t.convention,data:g.value,editable:!0,"registration-group":u.value,onClose:s[3]||(s[3]=v=>{R.value=!1,k("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):W("",!0)],64))}}),Va=ue({__name:"RegistrationActions",props:Ie({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:Ie(["update:registration"],["update:modelValue"]),setup(e,{emit:k}){const D=e,a=Ye(e,"modelValue"),d=at(D,k,void 0,void 0,"registration"),u=c(me(d.value));Se(d,()=>{u.value=me(d.value)});const g=R=>{u.value.Submissions.forEach((y,f)=>{d.value.Submissions[f].Status=y.Status}),R&&(R("Saved"),setTimeout(()=>{a.value=!1},2e3))};return(R,y)=>(l(),L(He,{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=f=>a.value=f),onSave:g,title:R.title,"show-close-action":!0,color:"primary"},{default:i(()=>[o(De,{class:"px-0 mx-0",fluid:!0},{default:i(()=>[w(" WORK IN PROGRESS - NOT FUNCTIONAL "),o(Le,null,{default:i(()=>[(l(!0),S(N,null,K(u.value.Submissions,f=>(l(),L(Ce,{key:f.SubmissionUUID},{default:i(()=>{var I;return[o(te,{modelValue:f.Status,"onUpdate:modelValue":t=>f.Status=t,items:Q(xe),"item-text":"title","item-value":"value",label:((I=R.forms.find(t=>t.FormUUID==f.FormUUID))==null?void 0:I.Name)||""},{selection:i(()=>[o(Bt,{class:"mr-4"},{default:i(()=>{var t;return[w(M((t=Q(xe).find(s=>s.value===f.Status))==null?void 0:t.icon),1)]}),_:2},1024),w(" "+M(Q(ot)(f.Status)),1)]),item:i(({item:t,props:{onClick:s}})=>[o(Ce,{title:t.title,"prepend-icon":t.raw.icon,onClick:s},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),uo=ue({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:k}){var qe;const D=Jt();k("pageTitle","Registration Manager");const a=At(),d=Ut(),u=c(!0);let g=((qe=a.params.convention)==null?void 0:qe.toString())||"";const R=c({ID:0,ConventionUUID:ge(),OrganisationID:0,OrganisationUUID:Ge,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),y=ke(),f=c({ID:0,AdminLayoutUUID:ge(),ConventionID:R.value.ID,ConventionUUID:R.value.ConventionUUID,Name:"Registration Table",Type:nt.ADMIN_LAYOUT_TABLE,Panels:[]}),I=c([]),t=c([]),s=c([]),v=c([]),A=c([]),x=c(1),F=c(10),re=c([]),Re=c(0),Z=c(!1),X=c(""),ae=c(""),Ae=c(""),Ue=c(""),T=c(""),E=c(""),p=c([]),U=c([]),C=c([]),j=c([]),J=c([]),G=c([]),oe=c(0),_e=c(),ce=c(!1);Se(oe,n=>{n===7&&Oe()}),Se(T,()=>{ae.value=Date.now().toString()}),Se(E,()=>{ae.value=Date.now().toString()});const Fe=()=>{I.value=[],s.value=[],A.value=[];try{y.getConventionAdminLayoutByName(R.value.ConventionUUID,"Registration Table").then(n=>{oe.value+=1,n?f.value=n:(f.value.ConventionID=R.value.ID,f.value.ConventionUUID=R.value.ConventionUUID)})}catch{f.value.ConventionID=R.value.ID,f.value.ConventionUUID=R.value.ConventionUUID}try{y.getConventionForms(R.value.ConventionUUID).then(n=>{oe.value+=1,n&&(I.value=n)})}catch{}try{y.getConventionAccommodation(R.value.ConventionUUID).then(n=>{oe.value+=1,n&&(U.value=n)})}catch{}try{y.getConventionVenues(R.value.ConventionUUID).then(n=>{oe.value+=1,n&&(G.value=n)})}catch{}try{y.getConventionExtras(R.value.ConventionUUID).then(n=>{oe.value+=1,n&&(C.value=n)})}catch{}try{y.getConventionInterests(R.value.ConventionUUID).then(n=>{oe.value+=1,n&&(j.value=n)})}catch{}try{y.getConventionTickets(R.value.ConventionUUID).then(n=>{oe.value+=1,n&&(J.value=n)})}catch{}try{y.getConventionGroups(R.value.ConventionUUID).then(n=>{n&&(t.value=n.sort((r,m)=>r.Name.localeCompare(m.Name)))})}catch{}try{y.getConventionTags(R.value.ConventionUUID).then(n=>{n&&(v.value=n.sort((r,m)=>r.Title.localeCompare(m.Title)).map(r=>(r.Title=`${r.Title} [${r.Key}]`,r)))})}catch{}},de=({page:n,itemsPerPage:r,sortBy:m})=>{u.value=!0,x.value=n,re.value=m;const _=A.value.find(B=>B.uuid==X.value),le=_==null?void 0:_.layout.Items;let z="",je="";if(m&&le&&m.length>=1){const B=le.find(fe=>fe.LayoutItemUUID==m[0].key);switch(je=m[0].order,B==null?void 0:B.MetaField){case P.META_DATA_SOURCE_ACCOMMODATION_FORM:z="submission.status";break;case P.META_DATA_SOURCE_BADGE_FORM:z="submission.status";break;case P.META_DATA_SOURCE_DEALER_FORM:z="submission.status";break;case P.META_DATA_SOURCE_REGISTRATION_FORM:z="submission.status";break;case P.META_DATA_SOURCE_REGISTRATION_REFERENCE:z="reference";break;case P.META_DATA_SOURCE_SUBMISSION_DATE:z="created";break;case P.META_DATA_SOURCE_SUBMISSION_STATUS:z="submission.status";break}switch(B==null?void 0:B.UserField){case H.USER_DATA_SOURCE_DISPLAY_NAME:z="user.display_name";break;case H.USER_DATA_SOURCE_EMAIL:z="user.email";break;case H.USER_DATA_SOURCE_FIRST_NAME:z="user.firstname";break;case H.USER_DATA_SOURCE_HANDLE:z="user.handle";break;case H.USER_DATA_SOURCE_LAST_NAME:z="user.lastname";break}}try{const B={Direction:je,Limit:r,Offset:(n-1)*r,Order:z};_&&_.layout.RequiredRegistrationTags.length>0&&(B.PanelUUID=_==null?void 0:_.layout.LayoutPanelUUID),(_==null?void 0:_.layout.RequiredFormType)===se.FORM_TYPE_ACCOMMODATION&&(B.Accommodation=!0),(_==null?void 0:_.layout.RequiredFormType)===se.FORM_TYPE_BADGE&&(B.Badge=!0),(_==null?void 0:_.layout.RequiredFormType)===se.FORM_TYPE_DEALER&&(B.Dealer=!0),(_==null?void 0:_.layout.RequiredFormType)===se.FORM_TYPE_REGISTRATION&&(B.Registration=!0),B.GroupUUID=T.value||Ge,B.TagUUID=E.value||Ge,B.Email=Ue.value,B.Reference=Ae.value,y.searchConventionRegistrations(R.value.ConventionUUID,B).then(fe=>{fe&&(Re.value=fe.Total,s.value=fe.Registrations,A.value.forEach(Pe=>{const st=Pe.layout;Pe.items=s.value.map(V=>{const Y={};return Pe.headers.forEach(Ke=>{var Je;const h=st.Items.find(ve=>ve.LayoutItemUUID===Ke.key);if(h){if(h.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&h.SectionField)V.Submissions.forEach(ve=>{const ee=ve.Data.find($e=>$e.SectionFieldUUID===h.SectionFieldUUID);if(ee){Ke.type===Tt.ACCOMMODATION?Y[h.LayoutItemUUID]={Data:ee.Data,Registration:V}:Y[h.LayoutItemUUID]=ee.Data;return}});else if(h.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&h.UserField)switch(h.UserField){case H.USER_DATA_SOURCE_AVATAR:Y[h.LayoutItemUUID]=D.GetProfileImageURL(V.UserUUID);break;case H.USER_DATA_SOURCE_DISPLAY_NAME:Y[h.LayoutItemUUID]=V.User.DisplayName;break;case H.USER_DATA_SOURCE_EMAIL:Y[h.LayoutItemUUID]=V.User.Additional.Email;break;case H.USER_DATA_SOURCE_HANDLE:Y[h.LayoutItemUUID]=V.User.Handle;break;case H.USER_DATA_SOURCE_DATE_OF_BIRTH:Y[h.LayoutItemUUID]=V.User.Additional.DOB;break;case H.USER_DATA_SOURCE_FIRST_NAME:Y[h.LayoutItemUUID]=V.User.Additional.FirstName;break;case H.USER_DATA_SOURCE_LAST_NAME:Y[h.LayoutItemUUID]=V.User.Additional.LastName;break;case H.USER_DATA_SOURCE_TELEGRAM:Y[h.LayoutItemUUID]="";break}else if(h.SourceType==="LAYOUT_ITEM_SOURCE_META"&&h.MetaField){const ve=[];let ee;const $e=(Je=I.value.find(O=>O.Type===se.FORM_TYPE_REGISTRATION))==null?void 0:Je.FormUUID,We=V.Submissions.find(O=>O.FormUUID===$e);switch(h.MetaField){case P.META_DATA_SOURCE_REGISTRATION_ACTIONS:Y[h.LayoutItemUUID]=V;break;case P.META_DATA_SOURCE_REGISTRATION_GROUP:V.Leader?ee=V:ee=V.Primary,ve.push({Name:ee.User.DisplayName,UUID:ee.UserUUID,UserUUID:ee.User.UserUUID,IsLeader:!0,Reference:ee.Reference}),ve.push(...ee.Members.map(O=>({Name:O.User.DisplayName,UUID:O.UserUUID,UserUUID:O.User.UserUUID,IsLeader:!1,Reference:O.Reference}))),Y[h.LayoutItemUUID]=ve;break;case P.META_DATA_SOURCE_REGISTRATION_REFERENCE:Y[h.LayoutItemUUID]=V.Reference;break;case P.META_DATA_SOURCE_SUBMISSION_DATE:if(We){const O=new Date(We.CreatedAt||"");Y[h.LayoutItemUUID]=`${O.getFullYear()}-${(O.getMonth()+1).toString().padStart(2,"0")}-${O.getDate().toString().padStart(2,"0")} ${O.getHours().toString().padStart(2,"0")}:${O.getMinutes().toString().padStart(2,"0")}:${O.getSeconds().toString().padStart(2,"0")}`}else{const O=new Date(V.CreatedAt||"");Y[h.LayoutItemUUID]=`${O.getFullYear()}-${(O.getMonth()+1).toString().padStart(2,"0")}-${O.getDate().toString().padStart(2,"0")} ${O.getHours().toString().padStart(2,"0")}:${O.getMinutes().toString().padStart(2,"0")}:${O.getSeconds().toString().padStart(2,"0")}`}break;case P.META_DATA_SOURCE_ACCOMMODATION_FORM:Ve(V.Submissions,I.value),Y[h.LayoutItemUUID]=V.Submissions.map(O=>{const b=I.value.find(Te=>Te.FormUUID===O.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:O,Registration:V}}).filter(O=>{var b;return((b=O.Form)==null?void 0:b.Type)===se.FORM_TYPE_ACCOMMODATION});break;case P.META_DATA_SOURCE_BADGE_FORM:Ve(V.Submissions,I.value),Y[h.LayoutItemUUID]=V.Submissions.map(O=>{const b=I.value.find(Te=>Te.FormUUID===O.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:O,Registration:V}}).filter(O=>{var b;return((b=O.Form)==null?void 0:b.Type)===se.FORM_TYPE_BADGE});break;case P.META_DATA_SOURCE_DEALER_FORM:Ve(V.Submissions,I.value),Y[h.LayoutItemUUID]=V.Submissions.map(O=>{const b=I.value.find(Te=>Te.FormUUID===O.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:O,Registration:V}}).filter(O=>{var b;return((b=O.Form)==null?void 0:b.Type)===se.FORM_TYPE_DEALER});break;case P.META_DATA_SOURCE_SUBMISSION_STATUS:Ve(V.Submissions,I.value),Y[h.LayoutItemUUID]=V.Submissions.map(O=>{const b=I.value.find(Te=>Te.FormUUID===O.FormUUID);return{Heading:b==null?void 0:b.Heading,Form:b,Submission:O,Registration:V}});break}}}}),Y})}),u.value=!1)})}catch{}},Oe=()=>{f.value.Panels.forEach(n=>{n.Items.forEach(r=>{(r.SectionField==null||r.SectionField.Field==null)&&I.value.find(m=>{m.Sections.find(_=>{if(_.Fields){const le=_.Fields.find(z=>z.SectionFieldUUID===r.SectionFieldUUID);if(le)return r.SectionField=le,!0}})})})}),f.value.Panels.length>0&&(A.value=[],f.value.Panels.forEach(n=>{const r={uuid:ge(),order:n.Order,name:n.Name,headers:[],items:[],layout:n};n.Items.sort((m,_)=>m.Order>_.Order?1:m.Order==_.Order?0:-1),r.headers=n.Items.map(m=>{var _,le;return m.DefaultSort&&p.value.push({key:m.LayoutItemUUID,order:"asc"}),{key:m.LayoutItemUUID,title:m.Label||((le=(_=m.SectionField)==null?void 0:_.Field)==null?void 0:le.Label)||"",align:m.Align==="end"?"end":"start",sortable:Ne(m),type:he(m)}}),A.value.push(r)})),(X.value==null||X.value=="")&&A.value.length>0&&(X.value=A.value[0].uuid)};g?y.getConvention(g).then(n=>{n&&(R.value=n,Fe())}).catch(()=>{d.push("/")}):d.push("/");const he=n=>{var r,m;if(n.SourceType===Me.LAYOUT_ITEM_SOURCE_META)return`${n.SourceType}.${n.MetaField}`;if(n.SourceType===Me.LAYOUT_ITEM_SOURCE_FORM)return(m=(r=n.SectionField)==null?void 0:r.Field)==null?void 0:m.Type;if(n.SourceType===Me.LAYOUT_ITEM_SOURCE_USER)return`${n.SourceType}.${n.UserField}`},Ne=n=>{const r=[P.META_DATA_SOURCE_ACCOMMODATION_FORM,P.META_DATA_SOURCE_BADGE_FORM,P.META_DATA_SOURCE_DEALER_FORM,P.META_DATA_SOURCE_REGISTRATION_FORM,P.META_DATA_SOURCE_REGISTRATION_REFERENCE,P.META_DATA_SOURCE_SUBMISSION_DATE,P.META_DATA_SOURCE_SUBMISSION_STATUS],m=[H.USER_DATA_SOURCE_DISPLAY_NAME,H.USER_DATA_SOURCE_EMAIL,H.USER_DATA_SOURCE_HANDLE,H.USER_DATA_SOURCE_DATE_OF_BIRTH,H.USER_DATA_SOURCE_FIRST_NAME,H.USER_DATA_SOURCE_LAST_NAME];return r.includes(n.MetaField)||m.includes(n.UserField)},it=n=>{_e.value=n,ce.value=!0};return Se(ce,n=>{n||(_e.value=void 0)}),(n,r)=>(l(),L(zt,null,{default:i(()=>[o(Wt,{color:"blue-darken-4"},{default:i(()=>[o(Ft,{modelValue:X.value,"onUpdate:modelValue":r[0]||(r[0]=m=>X.value=m),"show-arrows":""},{default:i(()=>[(l(!0),S(N,null,K(A.value,m=>(l(),L(Pt,{key:m.uuid,value:m.uuid},{default:i(()=>[w(M(m.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(Kt),o(ye,{icon:"mdi:mdi-cog-outline",onClick:r[1]||(r[1]=m=>Z.value=!0)})]),_:1}),o(wt,{modelValue:X.value,"onUpdate:modelValue":r[11]||(r[11]=m=>X.value=m),disabled:!0},{default:i(()=>[(l(!0),S(N,null,K(A.value,m=>(l(),L($t,{key:m.uuid,value:m.uuid},{default:i(()=>[m.uuid===X.value?(l(),L(lt,{key:0,class:"pa-2"},{default:i(()=>[o(Q(ta),{"items-per-page":F.value,"onUpdate:itemsPerPage":r[9]||(r[9]=_=>F.value=_),"sort-by":p.value,"onUpdate:sortBy":r[10]||(r[10]=_=>p.value=_),headers:m.headers,"items-length":Re.value,items:m.items,"item-value":"LayoutItemUUID",loading:u.value,search:ae.value,"onUpdate:options":de},Be({top:i(()=>[o(De,null,{default:i(()=>[o(ne,null,{default:i(()=>[o(q,{cols:"12",sm:"6",lg:"3"},{default:i(()=>[o(pe,{modelValue:Ae.value,"onUpdate:modelValue":r[2]||(r[2]=_=>Ae.value=_),label:"Search by Badge",clearable:!0,"hide-details":"",onInput:r[3]||(r[3]=_=>ae.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),o(q,{cols:"12",sm:"6",lg:"3"},{default:i(()=>[o(pe,{modelValue:Ue.value,"onUpdate:modelValue":r[4]||(r[4]=_=>Ue.value=_),label:"Search By Email",clearable:!0,"hide-details":"",onInput:r[5]||(r[5]=_=>ae.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),o(q,{cols:"12",sm:"6",lg:"3"},{default:i(()=>[o(te,{modelValue:T.value,"onUpdate:modelValue":r[6]||(r[6]=_=>T.value=_),label:"Search By Group",clearable:!0,"hide-details":"",items:t.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),o(q,{cols:"12",sm:"6",lg:"3"},{default:i(()=>[o(te,{modelValue:E.value,"onUpdate:modelValue":r[7]||(r[7]=_=>E.value=_),label:"Search By Tag",clearable:!0,"hide-details":"",items:v.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[K(m.headers,_=>({name:`item.${_.key}`,fn:i(({item:le})=>[o(Na,{header:_,item:le,accommodations:U.value,convention:R.value,extras:C.value,interests:j.value,tickets:J.value,venues:G.value,onOpenActions:it,onReload:r[8]||(r[8]=z=>de({page:x.value,itemsPerPage:F.value,sortBy:re.value}))},null,8,["header","item","accommodations","convention","extras","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):W("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),Z.value?(l(),L(aa,{key:0,title:"Edit Layout",modelValue:Z.value,"onUpdate:modelValue":r[12]||(r[12]=m=>Z.value=m),layout:f.value,onSave:r[13]||(r[13]=m=>{Z.value=!1,Oe()})},null,8,["modelValue","layout"])):W("",!0),ce.value&&_e.value?(l(),L(Va,{key:1,modelValue:ce.value,"onUpdate:modelValue":r[14]||(r[14]=m=>ce.value=m),registration:_e.value,"onUpdate:registration":r[15]||(r[15]=m=>_e.value=m),accommodations:U.value,convention:R.value,extras:C.value,forms:I.value,interests:j.value,tickets:J.value,title:"Registration Status & Communications",venues:G.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):W("",!0)]),_:1}))}});export{uo as default};
