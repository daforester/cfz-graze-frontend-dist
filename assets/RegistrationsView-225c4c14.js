import{I as M,a0 as q,a1 as ae,r as p,a2 as z,K as n,L as S,M as d,$ as X,v as s,S as $,a7 as J,Z as V,Q as O,e as G,R as _,H as y,U as C,O as L,N as h,_ as le,a3 as ne,a9 as oe}from"./index-839cb292.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-a8ed6654.js";import{_ as Q,f as ue,g as se,h as re,e as de,i as me,d as ve}from"./VWindowItem-66fe03a9.js";import{c as ce,T as Ue}from"./filter-f313da07.js";import{a as x,V as F}from"./VRow-328dda39.js";import{V as H}from"./VTextField-d65b4c0c.js";import{V as Y}from"./VSelect-262ce05c.js";import{n as K,V as Z}from"./VContainer-d782aef4.js";import{v as B}from"./v4-a960c1f4.js";import{u as Ie,V as _e}from"./VToolbar-5b16c612.js";import{V as Te}from"./VSpacer-d400ff92.js";import{e as fe}from"./VCard-d9f49962.js";import"./VChip-21c7975b.js";import"./scopeId-f5c5f613.js";import"./index-6e7f979e.js";import"./VAvatar-941ae123.js";import"./VDialog-be08cb13.js";import"./VCheckboxBtn-05422de0.js";import"./VTable-a3b392e4.js";import"./VToolbarItems-ca7b8932.js";import"./VList-1042f362.js";var ee=(u=>(u.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",u.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",u))(ee||{});const De=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var te=(u=>(u.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",u.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",u.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",u))(te||{});const Se=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}],pe=[{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}],ye=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],Ae=M({__name:"EditAdminLayout",props:q({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:q(["save"],["update:modelValue"]),setup(u,{emit:A}){const e=ae(u,"modelValue"),o=p(z(u.layout)),a=p([]),t=X(),U=({callback:m})=>{const r=()=>{m&&m("Failed to Save Layout")},i=()=>{m&&m("Layout Saved")};t.saveAdminLayout(o.value).then(E=>{E?(i(),A("save",E)):r()}).catch(()=>{r()})},T=()=>({ID:0,LayoutPanelUUID:B(),AdminLayoutID:o.value.ID,AdminLayoutUUID:o.value.AdminLayoutUUID,Name:"",Order:o.value.Panels.length+1,Items:[]}),b=m=>()=>({ID:0,LayoutItemUUID:B(),LayoutPanelID:m.ID,LayoutPanelUUID:m.LayoutPanelUUID,Label:"",SourceType:te.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:m.Items.length+1}),P=m=>{const r=a.value.find(i=>i.value===m.SectionFieldUUID);r&&(m.SectionFieldID=r.object.ID,m.SectionField=r.object)};return t.getConventionForms(u.layout.ConventionUUID).then(m=>{m.forEach(r=>r.Sections.forEach(i=>i.Fields&&a.value.push(...i.Fields.map(E=>{var R;return{title:`${r.Name} - ${i.Name} - ${(R=E.Field)==null?void 0:R.Name}`,value:E.SectionFieldUUID,object:E}})))),a.value.sort(ce("title"))}),(m,r)=>(n(),S(ie,{modelValue:e.value,"onUpdate:modelValue":r[3]||(r[3]=i=>e.value=i),onSave:U,title:m.title,color:"primary"},{default:d(()=>[s(K,{class:"px-0 mx-0",fluid:!0},{default:d(()=>[s(x,null,{default:d(()=>[s(F,{cols:"12",sm:"6"},{default:d(()=>[s(H,{modelValue:o.value.Name,"onUpdate:modelValue":r[0]||(r[0]=i=>o.value.Name=i),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),s(F,{cols:"12",sm:"6"},{default:d(()=>[s(Y,{modelValue:o.value.Type,"onUpdate:modelValue":r[1]||(r[1]=i=>o.value.Type=i),label:"Layout Type",items:$(De),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),s(Q,{modelValue:o.value.Panels,"onUpdate:modelValue":r[2]||(r[2]=i=>o.value.Panels=i),"new-item":T,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},J({_:2},[V(o.value.Panels,(i,E)=>({name:`panel_${E}`,fn:d(()=>[s(K,{class:"px-0 mx-0",fluid:!0},{default:d(()=>[s(x,null,{default:d(()=>[s(F,{cols:"12",sm:"6"},{default:d(()=>[s(H,{modelValue:i.Name,"onUpdate:modelValue":v=>i.Name=v,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),s(Q,{modelValue:i.Items,"onUpdate:modelValue":v=>i.Items=v,"new-item":b(i),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},J({_:2},[V(i.Items,(v,R)=>({name:`item_${R}`,fn:d(()=>[s(K,{class:"px-0 mx-0",fluid:!0},{default:d(()=>[s(x,null,{default:d(()=>[s(F,{cols:"12",sm:"6"},{default:d(()=>[s(H,{modelValue:v.Label,"onUpdate:modelValue":f=>v.Label=f,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),s(x,null,{default:d(()=>[s(F,{cols:"12",sm:"6"},{default:d(()=>[s(Y,{modelValue:v.SourceType,"onUpdate:modelValue":f=>v.SourceType=f,label:"Source Type",items:$(Se),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(F,{cols:"12",sm:"6"},{default:d(()=>[v.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(n(),S(Y,{key:0,modelValue:v.SectionFieldUUID,"onUpdate:modelValue":f=>v.SectionFieldUUID=f,label:"Form Data",items:a.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:f=>P(v)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):v.SourceType==="LAYOUT_ITEM_SOURCE_META"?(n(),S(Y,{key:1,modelValue:v.MetaField,"onUpdate:modelValue":f=>v.MetaField=f,label:"Miscellaneous Data",items:$(pe),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):v.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(n(),S(Y,{key:2,modelValue:v.UserField,"onUpdate:modelValue":f=>v.UserField=f,label:"User Profile Data",items:$(ye),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):O("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Ee={key:0,class:"addonList"},Ve={key:0},ke=M({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(u){const A=G(()=>{if(!u.value)return;const e=JSON.parse(u.value),o=Object.keys(e),a=z(u.extras);return a.forEach(t=>{t.Options=t.Options.filter(U=>o.includes(U.OptionUUID)?(U.Choices=U.Choices.filter(T=>T.TagUUID===e[U.OptionUUID].choiceId),e[U.OptionUUID].checked):!1)}),a.filter(t=>t.Options.length>0),a});return(e,o)=>e.value?(n(),_("ul",Ee,[(n(!0),_(y,null,V(A.value,a=>(n(),_("li",{key:a.ExtraUUID},[C("strong",null,L(a.Name),1),C("ul",null,[(n(!0),_(y,null,V(a.Options,t=>(n(),_("li",{key:t.OptionUUID},[h(L(t.Name)+" ",1),t.Choices.length==1?(n(),_("small",Ve,"("+L(t.Choices[0].Title)+")",1)):O("",!0)]))),128))])]))),128))])):O("",!0)}});const Oe=le(ke,[["__scopeId","data-v-4ed6842b"]]),Ce={key:0},Le=M({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(u){const A=G(()=>{if(!u.value)return;const e=JSON.parse(u.value);return Object.entries(e).filter(([,o])=>o).map(([o,a])=>u.interests.find(t=>t.InterestUUID===o)).filter(o=>o!==void 0)});return(e,o)=>e.value?(n(),_("ul",Ce,[(n(!0),_(y,null,V(A.value,a=>(n(),_("li",{key:a.InterestUUID},L(a.Name),1))),128))])):O("",!0)}}),he=C("br",null,null,-1),Re=C("small",null,"Options:",-1),Ne=C("br",null,null,-1),ge=C("small",null,"Addons:",-1),Fe=M({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(u){const A=G(()=>{if(!u.value)return;const e=JSON.parse(u.value);return e.ticket.filter(o=>{const a=u.tickets.find(t=>t.TicketUUID===o);return!(!a||a.Type!==Ue.TICKET_TYPE_TICKET)}).map(o=>{const a=u.tickets.find(U=>U.TicketUUID===o),t=z(a);return t.TicketComponents=a.TicketComponents.filter(U=>e.componentsChecked.includes(U.TicketUUID)),t.AddonTickets=a.AddonTickets.filter(U=>e.addonsChecked.includes(U.TicketUUID)),t})});return(e,o)=>e.value?(n(!0),_(y,{key:0},V(A.value,a=>(n(),_("div",{key:a.TicketUUID},[C("strong",null,L(a.Name),1),a.TicketComponents.length>0?(n(),_(y,{key:0},[he,Re,h("  "),(n(!0),_(y,null,V(a.TicketComponents,t=>(n(),_(y,{key:t.TicketUUID},[C("small",null,L(t.Name),1),h("  ")],64))),128))],64)):O("",!0),a.AddonTickets.length>0?(n(),_(y,{key:1},[Ne,ge,h("  "),(n(!0),_(y,null,V(a.AddonTickets,t=>(n(),_("small",{key:t.TicketUUID},[h("("),C("em",null,L(t.Name),1),h(")")]))),128))],64)):O("",!0)]))),128)):O("",!0)}}),Me=M({__name:"RegListRow",props:{header:{},extras:{},item:{},interests:{},tickets:{}},setup(u){const A=e=>{console.log(e)};return(e,o)=>e.header.key=="actions"?(n(),S(Z,{key:0,size:"small",class:"me-2",icon:"mdi:mdi-pencil",variant:"plain",onClick:o[0]||(o[0]=a=>A(e.item.raw))})):e.header.type==="EXTRAS"&&e.extras.length>0?(n(),S(Oe,{key:1,value:e.item.raw[e.header.key],extras:e.extras},null,8,["value","extras"])):e.header.type==="INTERESTS"&&e.interests.length>0?(n(),S(Le,{key:2,value:e.item.raw[e.header.key],interests:e.interests},null,8,["value","interests"])):e.header.type==="TICKET"&&e.tickets.length>0?(n(),S(Fe,{key:3,value:e.item.raw[e.header.key],tickets:e.tickets},null,8,["value","tickets"])):(n(),_(y,{key:4},[h(L(e.item.raw[e.header.key]),1)],64))}}),lt=M({__name:"RegistrationsView",emits:["pageTitle"],setup(u,{emit:A}){var W;A("pageTitle","Registration Manager");const e=ne(),o=oe();let a=((W=e.params.convention)==null?void 0:W.toString())||"";const t=p({ID:0,ConventionUUID:B(),OrganisationID:0,OrganisationUUID:Ie,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),U=X(),T=p({ID:0,AdminLayoutUUID:B(),ConventionID:t.value.ID,ConventionUUID:t.value.ConventionUUID,Name:"Registration Table",Type:ee.ADMIN_LAYOUT_TABLE,Panels:[]}),b=p([]),P=p([]),m=p([]),r=p(!1),i=p(""),E=p([]),v=p([]),R=p([]),f=async()=>{b.value=[],P.value=[],m.value=[];try{const l=await U.getConventionAdminLayoutByName(t.value.ConventionUUID,"Registration Table");l?T.value=l:(T.value.ConventionID=t.value.ID,T.value.ConventionUUID=t.value.ConventionUUID)}catch{T.value.ConventionID=t.value.ID,T.value.ConventionUUID=t.value.ConventionUUID}try{const l=await U.getConventionSubmissions(t.value.ConventionUUID);if(!l)return;P.value=l}catch{return}try{const l=await U.getConventionForms(t.value.ConventionUUID);if(!l)return;b.value=l}catch{return}try{const l=await U.getConventionExtras(t.value.ConventionUUID);if(!l)return;E.value=l}catch{return}try{const l=await U.getConventionInterests(t.value.ConventionUUID);if(!l)return;v.value=l}catch{return}try{const l=await U.getConventionTickets(t.value.ConventionUUID);if(!l)return;R.value=l}catch{return}T.value.Panels.forEach(l=>{l.Items.forEach(I=>{(I.SectionField==null||I.SectionField.Field==null)&&b.value.find(c=>{c.Sections.find(D=>{if(D.Fields){const k=D.Fields.find(g=>g.SectionFieldUUID===I.SectionFieldUUID);if(k)return I.SectionField=k,!0}})})})}),T.value.Panels.length>0&&T.value.Panels.forEach(l=>{const I={uuid:B(),order:l.Order,name:l.Name,headers:[],items:[]},c={key:"actions",title:"Actions",align:"start",sortable:!1,type:""};I.headers=l.Items.map(D=>{var k,g,N,w;return{key:D.LayoutItemUUID,title:D.Label||((g=(k=D.SectionField)==null?void 0:k.Field)==null?void 0:g.Label)||"",align:D.Align==="end"?"end":"start",sortable:!0,type:((w=(N=D.SectionField)==null?void 0:N.Field)==null?void 0:w.Type)||""}}),I.headers.push(c),I.items=P.value.map(D=>{const k={};return I.headers.forEach(g=>{var w;const N=l.Items.find(j=>j.LayoutItemUUID===g.key);N&&N.SectionField&&(k[N.LayoutItemUUID]=((w=D.Data.find(j=>j.SectionFieldUUID===N.SectionFieldUUID))==null?void 0:w.Data)||"")}),k}),m.value.push(I)}),(i.value==null||i.value=="")&&m.value.length>0&&(i.value=m.value[0].uuid)};return a?U.getConvention(a).then(l=>{l&&(t.value=l,f())}).catch(()=>{o.push("/")}):o.push("/"),(l,I)=>(n(),S(ve,null,{default:d(()=>[s(_e,{color:"blue-darken-4"},{default:d(()=>[s(ue,{modelValue:i.value,"onUpdate:modelValue":I[0]||(I[0]=c=>i.value=c),"show-arrows":""},{default:d(()=>[(n(!0),_(y,null,V(m.value,c=>(n(),S(se,{key:c.uuid,value:c.uuid},{default:d(()=>[h(L(c.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(Te),s(Z,{icon:"mdi:mdi-cog-outline",onClick:I[1]||(I[1]=c=>r.value=!0)})]),_:1}),s(me,{modelValue:i.value,"onUpdate:modelValue":I[2]||(I[2]=c=>i.value=c)},{default:d(()=>[(n(!0),_(y,null,V(m.value,c=>(n(),S(re,{key:c.uuid,value:c.uuid},{default:d(()=>[c.uuid===i.value?(n(),S(fe,{key:0,class:"pa-2"},{default:d(()=>[s($(de),{headers:c.headers,items:c.items,itemsPerPage:"50","item-value":"LayoutItemUUID"},J({_:2},[V(c.headers,D=>({name:`item.${D.key}`,fn:d(({item:k})=>[s(Me,{header:D,item:k,extras:E.value,interests:v.value,tickets:R.value},null,8,["header","item","extras","interests","tickets"])])}))]),1032,["headers","items"])]),_:2},1024)):O("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r.value?(n(),S(Ae,{key:0,title:"Edit Layout",modelValue:r.value,"onUpdate:modelValue":I[3]||(I[3]=c=>r.value=c),layout:T.value,onSave:I[4]||(I[4]=c=>{r.value=!1,f()})},null,8,["modelValue","layout"])):O("",!0)]),_:1}))}});export{lt as default};
