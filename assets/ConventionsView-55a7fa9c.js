import{F as Q}from"./form-29fd1dbb.js";import{P as W}from"./permission-03f04c02.js";import{I as G,a0 as k,a1 as Y,r as c,K as F,w as j,M as r,N as p,O as e,W as I,v as t,a3 as A,_ as B,L as X,S as D,P as L,Q as J,X as Z,V as O,a7 as ee,a4 as te,H as ne}from"./index-bd850ea9.js";import{a as H}from"./scopeId-87dadda8.js";import{_ as oe}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-eb6937e0.js";import{u as ae,V as le}from"./VCheckbox-5d59ed96.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-385850d5.js";import{s as b}from"./index-26b71cef.js";import{V as y,a as _}from"./VRow-adaee2c8.js";import{V as q}from"./VAvatar-0c751efb.js";import{V as $}from"./VTextField-d3028014.js";import{V as se}from"./VTextarea-b2d939ce.js";import{V as ue}from"./VForm-ab6e55c5.js";import{V as re}from"./VFileInput-ed17f38a.js";import{j as z}from"./VContainer-56a5604e.js";import{G as h}from"./group-d2a77946.js";import{C as P,a as de}from"./canEditOrganisation-8fe33599.js";import{G as K}from"./userData-123e8d08.js";import{e as ve,V as me,a as fe,c as M,b as ce,d as pe}from"./VCard-39a2284c.js";import{V as S}from"./VBtn-95d6ccee.js";import{v as ge}from"./v4-a960c1f4.js";import{u as _e}from"./nil-d01db1aa.js";import"./createSimpleFunctional-32d328ca.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-2fb7c102.js";import"./forwardRefs-6eff7908.js";import"./VDialog-b07a91a3.js";import"./VToolbar-df07c74c.js";import"./VChip-462fc16a.js";const Ve=(v=void 0,d=void 0)=>v===void 0?!1:d===void 0?P(v,h.GROUP_TYPE_CONVENTION).EditConvention:P(v,h.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).EditConvention,Ce=(v,d)=>v===void 0?!1:P(v,h.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).EditRegistration,Ue=(v,d)=>v===void 0?!1:P(v,h.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).ViewRegistration,De=G({__name:"EditConventionDialog",props:k({convention:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:k(["update:convention","delete","save"],["update:modelValue"]),setup(v,{emit:d}){const U=v,a=A(),m=H(),{title:N=""}=U,V=Y(v,"modelValue"),g=ae(U,d,void 0,void 0,"convention"),o=c(F(g.value));j(g,()=>{o.value=F(g.value)});const C=c(`${m.GetConventionLogoURL(o.value.ConventionUUID)}?${new Date().getTime()}`),x=c(),w=c(),E=()=>{C.value=URL.createObjectURL(x.value.files[0])},T=()=>{d("delete")},i=()=>{o.value=F(g.value)},l=async()=>{var n;const u=new FormData((n=w.value)==null?void 0:n.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",o.value.ConventionUUID),await m.SaveConventionLogo(u)},s=u=>{l(),a.saveConvention(o.value).then(n=>{n?u&&u("Convention Data Saved").then(()=>{g.value=n,d("save",n)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,n)=>(r(),p(ie,{modelValue:V.value,"onUpdate:modelValue":n[5]||(n[5]=f=>V.value=f),onDelete:T,onReset:i,onSave:s,title:I(N),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(z,{class:"pa-0",fluid:!0},{default:e(()=>[t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(q,{class:"imgLogo mx-auto",src:C.value||""},null,8,["src"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t($,{label:I(b).formLabelName,name:"Name",variant:"outlined",modelValue:o.value.Name,"onUpdate:modelValue":n[0]||(n[0]=f=>o.value.Name=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(se,{label:I(b).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:o.value.Description,"onUpdate:modelValue":n[1]||(n[1]=f=>o.value.Description=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t($,{label:I(b).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:o.value.DetailLink,"onUpdate:modelValue":n[2]||(n[2]=f=>o.value.DetailLink=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t($,{label:I(b).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:o.value.Slug,"onUpdate:modelValue":n[3]||(n[3]=f=>o.value.Slug=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(le,{label:I(b).formConventionVisible,name:"Visible",modelValue:o.value.Visible,"onUpdate:modelValue":n[4]||(n[4]=f=>o.value.Visible=f)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(ue,{ref_key:"conventionImageForm",ref:w,enctype:"multipart/form-data"},{default:e(()=>[t(re,{label:I(b).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:x,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}});const Ie=B(De,[["__scopeId","data-v-319537e0"]]),ye=["innerHTML"],Ne={key:0,class:"text-green"},xe={key:1,class:"text-red"},Le={key:0,class:"text-green"},we={key:1,class:"text-red"},Te=G({__name:"ConventionCard",props:k({open:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:k(["delete"],["update:modelValue"]),setup(v,{emit:d}){const U=A(),a=Y(v,"modelValue"),m=H(),N=K(),V=c(m.GetConventionLogoURL(a.value.ConventionUUID)),g=c(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),o=c(!1),C=c(!1),x=c(Ve(N,a.value)),w=c(Ce(N,a.value)),E=c(Ue(N,a.value)),T=()=>{C.value=!1,V.value=`${m.GetConventionLogoURL(a.value.ConventionUUID)}?ts=${Date.now()}`},i=l=>{U.deleteConvention(a.value.ConventionUUID).then(s=>{s?l&&(l("Convention Deleted"),d("delete")):l&&l("Failed to Delete Convention"),setTimeout(()=>{o.value=!1},2e3)}).catch(()=>{l&&(l("Failed to Delete Organisation"),o.value=!1)})};return(l,s)=>{const u=X("RouterLink");return r(),p(ve,null,{default:e(()=>[t(ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[V.value?(r(),p(q,{key:0,src:V.value,title:a.value.Name,class:"logo text-center"},null,8,["src","title"])):D("",!0),a.value.Name?(r(),p(me,{key:1},{default:e(()=>[L(J(a.value.Name),1)]),_:1})):D("",!0),a.value.Description?(r(),p(fe,{key:2,class:"text-wrap subtitle"},{default:e(()=>[Z("div",{innerHTML:a.value.Description},null,8,ye)]),_:1})):D("",!0),t(M,{class:"px-0 pb-0"},{default:e(()=>[L(" Visibility:  "),a.value.Visible?(r(),O("span",Ne,"Visible")):(r(),O("span",xe,"Hidden"))]),_:1}),t(M,{class:"px-0 pb-0"},{default:e(()=>[L(" Registration:  "),l.open?(r(),O("span",Le,"Open")):(r(),O("span",we,"Closed"))]),_:1})]),_:1}),t(pe,null,{default:e(()=>[t(y,{"no-gutters":""},{default:e(()=>[x.value?(r(),p(_,{key:0,class:"ma-1"},{default:e(()=>[t(S,{variant:"tonal",color:"primary",onClick:s[0]||(s[0]=n=>C.value=!0),width:"100%"},{default:e(()=>[L("Edit")]),_:1})]),_:1})):D("",!0),D("",!0),x.value?(r(),p(_,{key:2,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}`},{default:e(()=>[t(S,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[L("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0),E.value||w.value?(r(),p(_,{key:3,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/registrations`},{default:e(()=>[t(S,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[L("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):D("",!0)]),_:1})]),_:1}),C.value?(r(),p(Ie,{key:0,modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=n=>C.value=n),convention:a.value,"onUpdate:convention":s[2]||(s[2]=n=>a.value=n),onDelete:s[3]||(s[3]=n=>o.value=!0),onSave:T,title:`${a.value.Name} General Settings`},null,8,["modelValue","convention","title"])):D("",!0),o.value?(r(),p(oe,{key:1,modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=n=>o.value=n),"confirmation-text":"I UNDERSTAND",message:g.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:i},null,8,["modelValue","message"])):D("",!0)]),_:1})}}});const Re=B(Te,[["__scopeId","data-v-1d5a45f3"]]),be=G({__name:"ConventionsView",emits:["pageTitle"],setup(v,{emit:d}){var T;d("pageTitle","Conventions");const U=A(),a=K(),m=c([]),N=c([]),V=ee();let g=((T=V.params.organisation)==null?void 0:T.toString())||"";const o=c();j(V,()=>{var i,l;g!==((i=V.params.organisation)==null?void 0:i.toString())&&(g=((l=V.params.organisation)==null?void 0:l.toString())||"",C())});const C=()=>{g?U.getOrganisation(g).then(i=>{i&&(o.value=i,U.getConventionList(i.OrganisationUUID).then(l=>{l&&(m.value=l,x())}))}).catch(()=>{}):U.getPermissionAccessList(W.PERMISSION_TYPE_NULL).then(i=>{i&&(m.value=i.Conventions,x())})},x=()=>{m.value.forEach(i=>{U.getConventionForms(i.ConventionUUID).then(l=>{l&&(N.value=[...N.value,...l])}).catch(l=>{console.error(l)})})},w=()=>{var i,l;if(o.value){const s={ID:0,ConventionUUID:ge(),OrganisationID:((i=o.value)==null?void 0:i.ID)||0,OrganisationUUID:((l=o.value)==null?void 0:l.OrganisationUUID)||_e,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};U.saveConvention(s).then(u=>{u&&m.value.push(u)})}},E=i=>{m.value.splice(i,1)};return C(),(i,l)=>(r(),p(z,null,{default:e(()=>[t(y,{class:"justify-center"},{default:e(()=>[(r(!0),O(ne,null,te(m.value,(s,u)=>(r(),p(_,{key:s.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var n,f;return[t(Re,{modelValue:m.value[u],"onUpdate:modelValue":R=>m.value[u]=R,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((n=s.Organisation)==null?void 0:n.Slug)||((f=s.Organisation)==null?void 0:f.OrganisationUUID)||"",open:!!N.value.find(R=>R.ConventionUUID===s.ConventionUUID&&R.Type===I(Q).FORM_TYPE_REGISTRATION&&R.State.New),onDelete:R=>E(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(y,null,{default:e(()=>[o.value&&I(de)(I(a),o.value)?(r(),p(_,{key:0,class:"text-right"},{default:e(()=>[t(S,{color:"primary",onClick:w},{default:e(()=>[L("New")]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}))}});const lt=B(be,[["__scopeId","data-v-f6915eaa"]]);export{lt as default};
