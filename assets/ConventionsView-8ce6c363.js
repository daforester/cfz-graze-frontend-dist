import{F as J}from"./form-3a7bf7fd.js";import{P as K}from"./permission-435f8ef2.js";import{i as A,M as O,N as Y,r as f,k as h,w as q,n as r,q as p,v as e,C as I,f as t,P as G,_ as B,l as W,A as U,x as w,y as X,D as Z,B as S,V as ee,Q as te,F as oe}from"./index-33cb343b.js";import{a as j}from"./scopeId-975c80a4.js";import{_ as ne}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-3d562118.js";import{u as ae,V as le}from"./VCheckbox-69c59e59.js";import{_ as ie}from"./ModelDialog.vue_vue_type_script_setup_true_lang-1cbbca51.js";import{s as R}from"./index-26b71cef.js";import{V as y,a as _}from"./VRow-5e237e9e.js";import{V as H}from"./VAvatar-97554375.js";import{V as F}from"./VTextField-1f630735.js";import{V as se}from"./VTextarea-d5d99c64.js";import{V as ue}from"./VForm-bcbf62b1.js";import{V as re}from"./VFileInput-617e6cf7.js";import{a as z}from"./VContainer-e59a5738.js";import{G as P}from"./group-d2a77946.js";import{C as $}from"./canDo-99eb87c2.js";import{C as de}from"./canEditRegistrations-68b5b4be.js";import{G as Q}from"./userData-a2936c04.js";import{e as me,V as ve,a as fe,c as M,b as pe,d as ce}from"./VCard-b9e17e07.js";import{V as E}from"./VBtn-fa63250a.js";import{C as ge}from"./canEditOrganisation-afda20f6.js";import{v as _e}from"./v4-a960c1f4.js";import{u as Ce}from"./nil-d01db1aa.js";import"./createSimpleFunctional-9b9833fb.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-d829d1de.js";import"./forwardRefs-cc622295.js";import"./VDialog-aaac471f.js";import"./VToolbar-93d0a800.js";import"./VChip-50c3e563.js";const Ve=(c=void 0,d=void 0)=>c===void 0?!1:d===void 0?$(c,P.GROUP_TYPE_CONVENTION).EditConvention:$(c,P.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).EditConvention,De=(c,d)=>c===void 0?!1:$(c,P.GROUP_TYPE_CONVENTION,d.ConventionUUID,d).ViewRegistration,Ue=A({__name:"EditConventionDialog",props:O({convention:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:O(["update:convention","delete","save"],["update:modelValue"]),setup(c,{emit:d}){const D=c,a=G(),m=j(),{title:x=""}=D,C=Y(c,"modelValue"),g=ae(D,d,void 0,void 0,"convention"),n=f(h(g.value));q(g,()=>{n.value=h(g.value)});const V=f(`${m.GetConventionLogoURL(n.value.ConventionUUID)}?${new Date().getTime()}`),N=f(),L=f(),k=()=>{V.value=URL.createObjectURL(N.value.files[0])},T=()=>{d("delete")},i=()=>{n.value=h(g.value)},l=async()=>{var o;const u=new FormData((o=L.value)==null?void 0:o.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",n.value.ConventionUUID),await m.SaveConventionLogo(u)},s=u=>{l(),a.saveConvention(n.value).then(o=>{o?u&&u("Convention Data Saved").then(()=>{g.value=o,d("save",o)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,o)=>(r(),p(ie,{modelValue:C.value,"onUpdate:modelValue":o[5]||(o[5]=v=>C.value=v),onDelete:T,onReset:i,onSave:s,title:I(x),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(z,{class:"pa-0",fluid:!0},{default:e(()=>[t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(H,{class:"imgLogo mx-auto",src:V.value||""},null,8,["src"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(F,{label:I(R).formLabelName,name:"Name",variant:"outlined",modelValue:n.value.Name,"onUpdate:modelValue":o[0]||(o[0]=v=>n.value.Name=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(se,{label:I(R).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:n.value.Description,"onUpdate:modelValue":o[1]||(o[1]=v=>n.value.Description=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(F,{label:I(R).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:n.value.DetailLink,"onUpdate:modelValue":o[2]||(o[2]=v=>n.value.DetailLink=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(F,{label:I(R).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:n.value.Slug,"onUpdate:modelValue":o[3]||(o[3]=v=>n.value.Slug=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(le,{label:I(R).formConventionVisible,name:"Visible",modelValue:n.value.Visible,"onUpdate:modelValue":o[4]||(o[4]=v=>n.value.Visible=v)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(y,null,{default:e(()=>[t(_,null,{default:e(()=>[t(ue,{ref_key:"conventionImageForm",ref:L,enctype:"multipart/form-data"},{default:e(()=>[t(re,{label:I(R).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:N,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:k},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}});const Ie=B(Ue,[["__scopeId","data-v-319537e0"]]),ye=["innerHTML"],xe={key:0,class:"text-green"},Ne={key:1,class:"text-red"},we={key:0,class:"text-green"},Le={key:1,class:"text-red"},Te=A({__name:"ConventionCard",props:O({open:{type:Boolean,default:!1}},{modelValue:{required:!0}}),emits:O(["delete"],["update:modelValue"]),setup(c,{emit:d}){const D=G(),a=Y(c,"modelValue"),m=j(),x=Q(),C=f(m.GetConventionLogoURL(a.value.ConventionUUID)),g=f(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),n=f(!1),V=f(!1),N=f(Ve(x,a.value)),L=f(de(x,a.value)),k=f(De(x,a.value)),T=()=>{V.value=!1,C.value=`${m.GetConventionLogoURL(a.value.ConventionUUID)}?ts=${Date.now()}`},i=l=>{D.deleteConvention(a.value.ConventionUUID).then(s=>{s?l&&(l("Convention Deleted"),d("delete")):l&&l("Failed to Delete Convention"),setTimeout(()=>{n.value=!1},2e3)}).catch(()=>{l&&(l("Failed to Delete Organisation"),n.value=!1)})};return(l,s)=>{const u=W("RouterLink");return r(),p(me,null,{default:e(()=>[t(pe,{class:"flex-1-1 align-content-start"},{default:e(()=>[C.value?(r(),p(H,{key:0,src:C.value,title:a.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),a.value.Name?(r(),p(ve,{key:1},{default:e(()=>[w(X(a.value.Name),1)]),_:1})):U("",!0),a.value.Description?(r(),p(fe,{key:2,class:"text-wrap subtitle"},{default:e(()=>[Z("div",{innerHTML:a.value.Description},null,8,ye)]),_:1})):U("",!0),t(M,{class:"px-0 pb-0"},{default:e(()=>[w(" Visibility:  "),a.value.Visible?(r(),S("span",xe,"Visible")):(r(),S("span",Ne,"Hidden"))]),_:1}),t(M,{class:"px-0 pb-0"},{default:e(()=>[w(" Registration:  "),l.open?(r(),S("span",we,"Open")):(r(),S("span",Le,"Closed"))]),_:1})]),_:1}),t(ce,null,{default:e(()=>[t(y,{"no-gutters":""},{default:e(()=>[N.value?(r(),p(_,{key:0,class:"ma-1"},{default:e(()=>[t(E,{variant:"tonal",color:"primary",onClick:s[0]||(s[0]=o=>V.value=!0),width:"100%"},{default:e(()=>[w("Edit")]),_:1})]),_:1})):U("",!0),U("",!0),N.value?(r(),p(_,{key:2,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}`},{default:e(()=>[t(E,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>[w("Configuration")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),k.value||L.value?(r(),p(_,{key:3,class:"ma-1"},{default:e(()=>[t(u,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/registrations`},{default:e(()=>[t(E,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>[w("Registrations")]),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),V.value?(r(),p(Ie,{key:0,modelValue:V.value,"onUpdate:modelValue":s[1]||(s[1]=o=>V.value=o),convention:a.value,"onUpdate:convention":s[2]||(s[2]=o=>a.value=o),onDelete:s[3]||(s[3]=o=>n.value=!0),onSave:T,title:`${a.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),n.value?(r(),p(ne,{key:1,modelValue:n.value,"onUpdate:modelValue":s[4]||(s[4]=o=>n.value=o),"confirmation-text":"I UNDERSTAND",message:g.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:i},null,8,["modelValue","message"])):U("",!0)]),_:1})}}});const be=B(Te,[["__scopeId","data-v-1d5a45f3"]]),Re=A({__name:"ConventionsView",emits:["pageTitle"],setup(c,{emit:d}){var T;d("pageTitle","Conventions");const D=G(),a=Q(),m=f([]),x=f([]),C=ee();let g=((T=C.params.organisation)==null?void 0:T.toString())||"";const n=f();q(C,()=>{var i,l;g!==((i=C.params.organisation)==null?void 0:i.toString())&&(g=((l=C.params.organisation)==null?void 0:l.toString())||"",V())});const V=()=>{g?D.getOrganisation(g).then(i=>{i&&(n.value=i,D.getConventionList(i.OrganisationUUID).then(l=>{l&&(m.value=l,N())}))}).catch(()=>{}):D.getPermissionAccessList(K.PERMISSION_TYPE_NULL).then(i=>{i&&(m.value=i.Conventions,N())})},N=()=>{m.value.forEach(i=>{D.getConventionForms(i.ConventionUUID).then(l=>{l&&(x.value=[...x.value,...l])}).catch(l=>{console.error(l)})})},L=()=>{var i,l;if(n.value){const s={ID:0,ConventionUUID:_e(),OrganisationID:((i=n.value)==null?void 0:i.ID)||0,OrganisationUUID:((l=n.value)==null?void 0:l.OrganisationUUID)||Ce,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};D.saveConvention(s).then(u=>{u&&m.value.push(u)})}},k=i=>{m.value.splice(i,1)};return V(),(i,l)=>(r(),p(z,null,{default:e(()=>[t(y,{class:"justify-center"},{default:e(()=>[(r(!0),S(oe,null,te(m.value,(s,u)=>(r(),p(_,{key:s.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var o,v;return[t(be,{modelValue:m.value[u],"onUpdate:modelValue":b=>m.value[u]=b,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((o=s.Organisation)==null?void 0:o.Slug)||((v=s.Organisation)==null?void 0:v.OrganisationUUID)||"",open:!!x.value.find(b=>b.ConventionUUID===s.ConventionUUID&&b.Type===I(J).FORM_TYPE_REGISTRATION&&b.State.New),onDelete:b=>k(u)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete"])]}),_:2},1024))),128))]),_:1}),t(y,null,{default:e(()=>[n.value&&I(ge)(I(a),n.value)?(r(),p(_,{key:0,class:"text-right"},{default:e(()=>[t(E,{color:"primary",onClick:L},{default:e(()=>[w("New")]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}});const st=B(Re,[["__scopeId","data-v-f6915eaa"]]);export{st as default};
