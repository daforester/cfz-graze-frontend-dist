import{s as S}from"./index-2XRRB2DS.js";import{i as N,r as p,W as x,n as g,q as h,v as t,f as a,x as y,C as E,P as q,M as w,N as J,c as Y,w as _,B,F as P,A as k,y as M,Q as ee,z as K,Z as z}from"./index-247IxxqT.js";import{v as ae}from"./v4-yQnnJER4.js";import{V as T,b as O,c as le}from"./VContainer-z5prYnEU.js";import{a as G,V as Q}from"./VToolbar-Ck5tv2pM.js";import{V as R}from"./scopeId-Lv88xeFr.js";import{V as W}from"./VToolbarItems-4YtLQepQ.js";import{V as te,a as L}from"./VRow-Kv-kSw21.js";import{V as j}from"./VTextField-8OV3Ne6g.js";import{c as Z,e as H}from"./VCard-1WHDxHrl.js";import{a as ne}from"./VList-tBK36xSW.js";import{V as oe}from"./VDivider-3CGeNAOs.js";import{V as ie}from"./VAutocomplete-Jn21xqoA.js";import{V as se}from"./VDialog-Zu1XB7yR.js";import{s as F,a as ue,m as re}from"./FormRenderer.vue_vue_type_style_index_0_lang--YIEvyc7.js";import{V as de,a as ve,b as me,c as fe}from"./VDataTable-LI1S1EOy.js";const ce=N({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(l,{emit:D}){const r=p(""),n=p("");typeof l.convention=="object"?(r.value=l.convention.ConventionUUID,n.value=l.convention.OrganisationUUID):r.value=l.convention||"",typeof l.organisation=="object"?n.value=l.organisation.OrganisationUUID:n.value.length===0&&(n.value=l.organisation||"");const d=D,m=p({ID:0,TagUUID:ae(),ConventionID:0,ConventionUUID:r.value||x,OrganisationID:0,OrganisationUUID:n.value||x,Title:"",Key:""}),V=q(),I=()=>{V.saveTag(m.value).then(v=>{v&&(m.value=v,d("save",v),d("close"))})};return(v,u)=>(g(),h(H,null,{default:t(()=>[a(Q,{dark:"",color:"primary"},{default:t(()=>[a(T,{icon:"",dark:"",onClick:u[0]||(u[0]=e=>d("close"))},{default:t(()=>[a(O,null,{default:t(()=>[y("mdi:mdi-close")]),_:1})]),_:1}),a(G,null,{default:t(()=>[y("Add Tag")]),_:1}),a(R),a(W,null,{default:t(()=>[a(T,{variant:"text",onClick:I},{default:t(()=>[y(" Save ")]),_:1})]),_:1})]),_:1}),a(Z,null,{default:t(()=>[a(le,{fluid:!0},{default:t(()=>[a(te,null,{default:t(()=>[a(L,{cols:"12"},{default:t(()=>[a(j,{label:E(S).formLabelDisplayName,type:"text",variant:"outlined",modelValue:m.value.Title,"onUpdate:modelValue":u[1]||(u[1]=e=>m.value.Title=e)},null,8,["label","modelValue"])]),_:1}),a(L,{cols:"12"},{default:t(()=>[a(j,{label:E(S).formLabelTagKey,type:"text",variant:"outlined",modelValue:m.value.Key,"onUpdate:modelValue":u[2]||(u[2]=e=>m.value.Key=e)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Pe=N({__name:"SelectTags",props:w({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{},showKey:{type:Boolean,default:!1},showUuid:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:w(["change"],["update:modelValue"]),setup(l,{emit:D}){const r=J(l,"modelValue"),n=D,d=p([]),m=q(),V=p([]),I=p([]),v=p(""),u=p(""),e=p(0),U=Y(()=>[...V.value,...I.value].map(o=>({title:`${o.Title}${l.showKey?` [ ${o.Key} ]`:""}${l.showUuid?` (${o.TagUUID})`:""}`,value:d.value.find(i=>i.TagUUID===o.TagUUID)||o})));typeof l.convention=="object"?(v.value=l.convention.ConventionUUID,u.value=l.convention.OrganisationUUID):v.value=l.convention||"",typeof l.organisation=="object"?u.value=l.organisation.OrganisationUUID:u.value.length===0&&(u.value=l.organisation||""),(async()=>{const s=[];v.value&&s.push(m.getConventionTags(v.value)),u.value&&s.push(m.getOrganisationTags(u.value));const o=await Promise.all(s);if(v.value&&u.value?(I.value=o[0].sort((i,f)=>i.Title.localeCompare(f.Title)),V.value=o[1].sort((i,f)=>i.Title.localeCompare(f.Title))):v.value&&o.length==1?I.value=o[0].sort((i,f)=>i.Title.localeCompare(f.Title)):u.value&&o.length==1&&(V.value=o[0].sort((i,f)=>i.Title.localeCompare(f.Title))),Array.isArray(r.value))e.value=2,U.value.forEach(i=>{Array.isArray(r.value)&&r.value.find(A=>A.TagUUID===i.value.TagUUID)&&d.value.push(i.value)});else if(typeof r.value=="string"){e.value=1;try{const i=JSON.parse(r.value);U.value.forEach(f=>{i.find(X=>X.TagUUID===f.value.TagUUID)&&d.value.push(f.value)})}catch{}}})();const c=p(!1),b=()=>{c.value=!0},C=s=>{s.ConventionUUID.length>0?I.value.push(s):s.OrganisationUUID.length>0&&V.value.push(s),d.value.push(s),$()},$=()=>{switch(e.value){default:case 2:{r.value=d.value,n("change");break}case 1:{r.value=JSON.stringify(d.value),n("change");break}}};return _(d,$),(s,o)=>(g(),B(P,null,[a(ie,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=i=>d.value=i),chips:s.chips,multiple:"",label:s.label||"Tags",variant:s.variant||"solo",hint:s.hint,"persistent-hint":!0,clearable:s.clearable,items:U.value,"item-title":"title","item-value":"value"},{"prepend-item":t(()=>[a(ne,{title:"New Tag",onClick:o[0]||(o[0]=i=>b())},{prepend:t(()=>[a(O,{icon:"mdi:mdi-plus"})]),_:1}),a(oe,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),a(se,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=i=>c.value=i),scrollable:!0},{default:t(()=>[a(ce,{convention:s.convention,organisation:s.organisation,onClose:o[2]||(o[2]=i=>c.value=!1),onSave:C},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}}),Ne=N({__name:"EditOrderedItems",props:w({closeable:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},hasOrder:{type:Boolean,default:!0},newItem:{type:[Function,Boolean]},label:{default:"Name"},labelParent:{default:""},title:{default:"Edit Ordered Items"},showSave:{type:Boolean,default:!1},slotNamePrefix:{default:"item"}},{modelValue:{required:!0},modelModifiers:{}}),emits:w(["add","save","close"],["update:modelValue"]),setup(l,{emit:D}){const r=D,n=J(l,"modelValue"),d=()=>{r("save"),r("close")},m=()=>{if(l.newItem){let e;l.hasOrder?(e=l.newItem(),e.Order=n.value.length+1):e=l.newItem(),n.value.push(e)}else l.hasOrder?n.value.push({ID:0,Order:n.value.length+1}):n.value.push({ID:0})},V=e=>{n.value.splice(e,1)},I=e=>{ue(e,n.value)},v=e=>{re(e,n.value)},u=e=>l.labelParent&&e[l.labelParent]?e[l.labelParent][l.label]:e[l.label];return n.value.find(e=>e.Order===0)&&F(n.value),n.value.find(e=>n.value.find(U=>U.Order===e.Order&&U!==e))&&F(n.value),(e,U)=>(g(),h(H,null,{default:t(()=>[a(Q,{dark:"",color:"primary"},{default:t(()=>[e.closeable?(g(),h(T,{key:0,icon:"",dark:"",onClick:U[0]||(U[0]=c=>r("close"))},{default:t(()=>[a(O,null,{default:t(()=>[y("mdi:mdi-close")]),_:1})]),_:1})):k("",!0),a(G,null,{default:t(()=>[y(M(e.title),1)]),_:1}),a(R),a(W,null,{default:t(()=>[e.newItem!==void 0?(g(),h(T,{key:0,variant:"text",onClick:m},{default:t(()=>[y(" Add ")]),_:1})):k("",!0),e.showSave?(g(),h(T,{key:1,variant:"text",onClick:d},{default:t(()=>[y(" Save ")]),_:1})):k("",!0)]),_:1})]),_:1}),a(Z,{class:"pa-0"},{default:t(()=>[a(de,null,{default:t(()=>[(g(!0),B(P,null,ee(n.value,(c,b)=>(g(),h(ve,{key:c.ID,class:"mt-0"},{default:t(()=>[a(me,null,{actions:t(({expanded:C})=>[e.showDelete?(g(),h(T,{key:0,icon:"mdi:mdi-close",size:"x-small",color:"red",class:"mr-1",onClick:$=>V(b)},null,8,["onClick"])):k("",!0),a(O,{class:"align-self-center text-h5",icon:C?"mdi:mdi-chevron-up":"mdi:mdi-chevron-down",variant:"flat",size:"x-small"},null,8,["icon"])]),default:t(()=>[e.hasOrder?(g(),B(P,{key:0},[a(T,{icon:"mdi:mdi-menu-up",size:"x-small",color:"primary",class:"mr-1",onClick:K(C=>v(c),["stop"])},null,8,["onClick"]),a(T,{icon:"mdi:mdi-menu-down",size:"x-small",color:"secondary",class:"mr-4",onClick:K(C=>I(c),["stop"])},null,8,["onClick"])],64)):k("",!0),z(e.$slots,`${e.slotNamePrefix}_${b}_title`,{},()=>[y(M(u(c)),1)])]),_:2},1024),a(fe,{class:"px-0"},{default:t(()=>[z(e.$slots,`${e.slotNamePrefix}_${b}`)]),_:2},1024)]),_:2},1024))),128))]),_:3})]),_:3})]),_:3}))}});export{Pe as _,Ne as a};
