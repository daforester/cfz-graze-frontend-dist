import{I as Y,a0 as se,a1 as le,r as F,w as ee,M as t,N as a,O as o,X as v,R as ce,a2 as q,e as M,L as H,v as U,S as y,P as d,Q as S,V as p,H as I,a3 as G,W as g,Y as ue,Z as de,_ as te}from"./index-fb88fab6.js";import{G as ne}from"./userData-30e4ade5.js";import{_ as me}from"./LoginView.vue_vue_type_script_setup_true_lang-ec0d7eaf.js";import{s as j}from"./index-26b71cef.js";import{F as k}from"./form-29fd1dbb.js";import{P as x,a as ve,f as pe,u as fe}from"./useDisplayTransactions-0a2086f5.js";import{S as K,a as _e}from"./submission-9dd916bb.js";import{V as ye,a as ge}from"./scopeId-94c5baf9.js";import{c as $}from"./canEditForm-787038d8.js";import{s as Se}from"./sortSubmissions-8ed80f07.js";import{_ as he}from"./ModelDialog.vue_vue_type_script_setup_true_lang-9cdb7b76.js";import{V as Te}from"./VAvatar-cb25eb61.js";import{V as Q,a as we,b as ke,c as Z,d as Ee,e as Ie}from"./VCard-b56fc5cc.js";import{V as _}from"./VBtn-7e25b5e2.js";import{V as Ue,a as Ce}from"./VRow-64ebf330.js";import{j as oe}from"./VContainer-43a98e03.js";import"./emailFormVariant-e5e0aad4.js";import"./LoginButton-afe15484.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-323871bd.js";import"./forwardRefs-e40dd366.js";import"./VDialog-722b7e14.js";import"./VToolbar-f10f1dae.js";var ae="https://js.stripe.com/v3",Ae=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,J="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Re=function(){for(var i=document.querySelectorAll('script[src^="'.concat(ae,'"]')),l=0;l<i.length;l++){var c=i[l];if(Ae.test(c.src))return c}return null},Pe=function(i){var l=i&&!i.advancedFraudSignals?"?advancedFraudSignals=false":"",c=document.createElement("script");c.src="".concat(ae).concat(l);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(c),c},De=function(i,l){!i||!i._registerWrapper||i._registerWrapper({name:"stripe-js",version:"2.1.2",startTime:l})},z=null,Fe=function(i){return z!==null||(z=new Promise(function(l,c){if(typeof window>"u"||typeof document>"u"){l(null);return}if(window.Stripe&&i&&console.warn(J),window.Stripe){l(window.Stripe);return}try{var s=Re();s&&i?console.warn(J):s||(s=Pe(i)),s.addEventListener("load",function(){window.Stripe?l(window.Stripe):c(new Error("Stripe.js not available"))}),s.addEventListener("error",function(){c(new Error("Failed to load Stripe.js"))})}catch(n){c(n);return}})),z},be=function(i,l,c){if(i===null)return null;var s=i.apply(void 0,l);return De(s,c),s},re=Promise.resolve().then(function(){return Fe(null)}),ie=!1;re.catch(function(u){ie||console.warn(u)});var Oe=function(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];ie=!0;var s=Date.now();return re.then(function(n){return be(n,l,s)})};const Ve=v("div",{id:"link-authentication-element"},null,-1),Ne=v("div",{id:"payment-element"},null,-1),Me=v("button",{id:"submit"},[v("span",{class:"spinner hidden",id:"spinner"}),v("span",{id:"button-text"},"Pay now")],-1),xe=v("div",{id:"payment-message",class:"hidden"},null,-1),Ye=[Ve,Ne,Me,xe];se({registration:{}},{modelValue:{type:Boolean,required:!0}});const B=u=>(ue("data-v-a3eeb036"),u=u(),de(),u),Le=["innerHTML"],$e={key:0},ze={key:0,class:"font-weight-bold float-left pt-1 w-50"},Ge={key:1,class:"pa-1"},Be={key:0,class:"font-weight-bold float-left pt-1 w-50"},je={key:1},He={class:"font-weight-bold float-left pt-1 w-50"},qe={class:"text-red-darken-4"},We={key:1,class:"text-red-darken-4 mt-4"},Xe=B(()=>v("strong",null,"There are forms above that require completion, please edit and save them.",-1)),Ke=[Xe],Qe={class:"v-row"},Ze={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},Je={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},et={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},tt={key:1,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},nt={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},ot={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},at={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},rt=B(()=>v("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),it={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},st=B(()=>v("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Current Payments ",-1)),lt={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},ct=B(()=>v("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance Due ",-1)),ut={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},dt=Y({__name:"OpenConvention",props:{convention:{},forms:{default:()=>[]}},setup(u){const i=ge(),l=q(),{getPaymentTransactions:c}=fe(),s=F(i.GetConventionLogoURL(u.convention.ConventionUUID)),n=F(),R=F([]),N=F(!1),O=M(()=>{var e;return $(u.forms,((e=n.value)==null?void 0:e.Submissions)||[],k.FORM_TYPE_REGISTRATION)}),L=M(()=>{var e;return $(u.forms,((e=n.value)==null?void 0:e.Submissions)||[],k.FORM_TYPE_DEALER)}),P=M(()=>{var e;return $(u.forms,((e=n.value)==null?void 0:e.Submissions)||[],k.FORM_TYPE_ACCOMMODATION)}),w=M(()=>{var e;return $(u.forms,((e=n.value)==null?void 0:e.Submissions)||[],k.FORM_TYPE_ADDITIONAL)}),m=M(()=>{var e,E;return n.value&&((e=n.value)!=null&&e.Submissions)?!!((E=n.value)!=null&&E.Submissions.find(f=>{var D;return((D=f.Form)==null?void 0:D.Type)==k.FORM_TYPE_REGISTRATION&&(f.Status==K.SUBMISSION_STATUS_ACCEPTED||f.Status==K.SUBMISSION_STATUS_CONFIRMED)})):!1}),h=(e,E)=>e.Type===x.PAYMENT_TRANSACTION_TYPE_CHARGE&&E.Type!==x.PAYMENT_TRANSACTION_TYPE_CHARGE?-1:e.Type!==x.PAYMENT_TRANSACTION_TYPE_CHARGE&&E.Type===x.PAYMENT_TRANSACTION_TYPE_CHARGE||(e.UpdatedAt||0)>(E.UpdatedAt||0)?1:e.UpdatedAt===E.UpdatedAt?0:-1;return ee(()=>u.forms,()=>{l.getRegistrationByConvention(u.convention.ConventionUUID).then(e=>{var E;e&&(e.Submissions?(e.Submissions.forEach((f,D)=>{f.Form||(e.Submissions[D].Form=u.forms.find(T=>T.FormUUID===f.FormUUID))}),Se(e.Submissions)):e.Submissions=[],n.value=e,m.value&&c(((E=n.value)==null?void 0:E.RegistrationUUID)||"").then(f=>{R.value=f}))})}),(e,E)=>{const f=H("router-link"),D=H("RouterLink");return t(),a(Ie,{class:"elevation-5 flex-1-0 d-flex flex-column"},{default:o(()=>[U(ke,{class:"flex-1-1 align-content-start"},{default:o(()=>[s.value?(t(),a(Te,{key:0,src:s.value,title:e.convention.Name,class:"logo text-center"},null,8,["src","title"])):y("",!0),e.convention.Name?(t(),a(Q,{key:1,class:"text-center"},{default:o(()=>[d(S(e.convention.Name),1)]),_:1})):y("",!0),e.convention.Description?(t(),a(we,{key:2,class:"text-wrap subtitle"},{default:o(()=>[v("div",{innerHTML:e.convention.Description},null,8,Le)]),_:1})):y("",!0)]),_:1}),U(Z,null,{default:o(()=>{var T,b;return[n.value?(t(),p("dl",$e,[n.value.Reference?(t(),p("dt",ze," Badge No: ")):y("",!0),n.value.Reference?(t(),p("dd",Ge," #"+S(n.value.Reference),1)):y("",!0),(t(!0),p(I,null,G((T=n.value)==null?void 0:T.Submissions,r=>{var C,V,W,X;return t(),p(I,{key:r.SubmissionUUID},[r.Form?(t(),p(I,{key:0},[r.Form?(t(),p("dt",Be,S(r.Form.Heading),1)):y("",!0),r.Form?(t(),p("dd",je,[d(S(g(_e)(r.Status))+" ",1),((C=r.Form)==null?void 0:C.Type)===g(k).FORM_TYPE_REGISTRATION?(t(),a(f,{key:0,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/registration`},{default:o(()=>{var A;return[(A=r.Form)!=null&&A.State.Edit&&O.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]}),_:2},1032,["to"])):((V=r.Form)==null?void 0:V.Type)===g(k).FORM_TYPE_ACCOMMODATION?(t(),a(f,{key:1,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/accommodation`},{default:o(()=>{var A;return[(A=r.Form)!=null&&A.State.Edit&&P.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]}),_:2},1032,["to"])):((W=r.Form)==null?void 0:W.Type)===g(k).FORM_TYPE_DEALER?(t(),a(f,{key:2,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/dealer`},{default:o(()=>{var A;return[(A=r.Form)!=null&&A.State.Edit&&L.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]}),_:2},1032,["to"])):((X=r.Form)==null?void 0:X.Type)===g(k).FORM_TYPE_ADDITIONAL?(t(),a(f,{key:3,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/additional`},{default:o(()=>{var A;return[(A=r.Form)!=null&&A.State.Edit&&w.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]}),_:2},1032,["to"])):y("",!0)])):y("",!0)],64)):y("",!0)],64)}),128)),((b=n.value)==null?void 0:b.Submissions.length)>=1?(t(!0),p(I,{key:2},G(e.forms,r=>{var C;return t(),p(I,{key:r.FormUUID},[(C=n.value)!=null&&C.Submissions.find(V=>V.FormUUID===r.FormUUID)?y("",!0):(t(),p(I,{key:0},[v("dt",He,S(r.Heading),1),v("dd",qe,[d(" Requires Completion "),r.Type===g(k).FORM_TYPE_REGISTRATION?(t(),a(f,{key:0,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/registration`},{default:o(()=>[r.State.Edit&&O.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]),_:2},1032,["to"])):r.Type===g(k).FORM_TYPE_ACCOMMODATION?(t(),a(f,{key:1,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/accommodation`},{default:o(()=>[r.State.Edit&&P.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]),_:2},1032,["to"])):r.Type===g(k).FORM_TYPE_DEALER?(t(),a(f,{key:2,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/dealer`},{default:o(()=>[r.State.Edit&&L.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]),_:2},1032,["to"])):r.Type===g(k).FORM_TYPE_ADDITIONAL?(t(),a(f,{key:3,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}/additional`},{default:o(()=>[r.State.Edit&&w.value?(t(),a(_,{key:0,size:"small",variant:"text",color:"success"},{default:o(()=>[d(" Edit ")]),_:1})):(t(),a(_,{key:1,size:"small",variant:"text",color:"warning"},{default:o(()=>[d("View")]),_:1}))]),_:2},1032,["to"])):y("",!0)])],64))],64)}),128)):y("",!0)])):y("",!0),n.value&&n.value.Submissions.length>=1&&e.forms.filter(r=>{var C;return!((C=n.value)!=null&&C.Submissions.find(V=>V.FormUUID==r.FormUUID))}).length?(t(),p("div",We,Ke)):y("",!0)]}),_:1}),U(Q,{class:"pb-4 text-center"},{default:o(()=>[d("Payment Information")]),_:1}),m.value&&n.value?(t(),a(Z,{key:0},{default:o(()=>[v("dl",Qe,[(t(!0),p(I,null,G(R.value.sort(h),T=>{var b;return t(),p(I,{key:T.PaymentTransactionUUID},[T.Type===g(x).PAYMENT_TRANSACTION_TYPE_CHARGE?(t(),p("dt",Ze,[v("div",Je,S(T.Description.split(":")[0]),1),v("div",et,S(T.Description.split(":")[1]),1)])):(t(),p("dt",tt,[v("div",nt,S((b=g(ve).find(r=>r.value===T.Type))==null?void 0:b.title),1),v("div",ot," [ "+S(g(pe)(T.UpdatedAt||""))+" ] "+S(T.Description),1)])),v("dd",at," £"+S(T.Amount),1)],64)}),128)),rt,v("dd",it," £"+S(n.value.Total),1),st,v("dd",lt," £"+S(n.value.Paid),1),ct,v("dd",ut," £"+S(n.value.Total-n.value.Paid),1)])]),_:1})):y("",!0),U(Ee,null,{default:o(()=>{var T,b;return[e.convention.DetailLink?(t(),a(_,{key:0,color:"orange",href:e.convention.DetailLink},{default:o(()=>[d(S(g(j).buttonDetails),1)]),_:1},8,["href"])):y("",!0),U(ye),O.value?(t(),p(I,{key:1},[(T=n.value)!=null&&T.Submissions.find(r=>{var C;return((C=r.Form)==null?void 0:C.Type)===g(k).FORM_TYPE_REGISTRATION})?(t(),a(D,{key:1,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}`},{default:o(()=>[U(_,{color:"primary"},{default:o(()=>[d(S(g(j).buttonViewRegistration),1)]),_:1})]),_:1},8,["to"])):(t(),p(I,{key:0},[(b=e.forms.find(r=>r.Type===g(k).FORM_TYPE_REGISTRATION))!=null&&b.State.New?(t(),a(D,{key:0,to:`/register/${e.convention.Slug||e.convention.ConventionUUID}`},{default:o(()=>[U(_,{color:"primary"},{default:o(()=>[d(S(g(j).buttonRegister),1)]),_:1})]),_:1},8,["to"])):y("",!0)],64))],64)):(m.value,y("",!0))]}),_:1})]),_:1})}}});const mt=te(dt,[["__scopeId","data-v-a3eeb036"]]),vt=Y({__name:"Conventions",setup(u){const i=q(),l=F([]),c=F([]);return i.getOpenConventionsList().then(s=>{s&&(l.value=[...l.value,...s],i.getAvailableConventionForms(l.value.map(n=>n.ConventionUUID)).then(n=>{c.value=[...c.value,...n]}).catch(n=>{console.error(n)}))}),(s,n)=>(t(),a(oe,null,{default:o(()=>[U(Ce,{class:"justify-center"},{default:o(()=>[(t(!0),p(I,null,G(l.value,R=>(t(),a(Ue,{key:R.ConventionUUID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:o(()=>[U(mt,{convention:R,forms:c.value.filter(N=>N.ConventionUUID===R.ConventionUUID)},null,8,["convention","forms"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),pt={};function ft(u,i){return t(),p("div")}const _t=te(pt,[["render",ft]]),yt=Y({__name:"MainView",emits:["pageTitle"],setup(u,{emit:i}){i("pageTitle","Scotiacon Registration System"),sessionStorage.getItem("reload")==="true"&&(sessionStorage.removeItem("reload"),setTimeout(()=>{location.reload()},500));const c=localStorage.getItem("gjt_token"),s=localStorage.getItem("ajt_token");c?(localStorage.removeItem("gjt_token"),location.href=c):s&&(localStorage.removeItem("ajt_token"),location.href=s);const n=F(ne());return(R,N)=>{const O=H("router-link");return t(),p(I,null,[n.value&&!n.value.Additional.Email?(t(),a(oe,{key:0,class:"bg-red-darken-4 text-center",fluid:!0},{default:o(()=>[d(" Please enter a Contact Email on the "),U(O,{to:"/profile",class:"text-white font-weight-bold"},{default:o(()=>[d("manage account page")]),_:1}),d(" to ensure we can contact you. ")]),_:1})):y("",!0),U(vt),U(_t)],64)}}}),Lt=Y({__name:"Home",emits:["pageTitle"],setup(u,{emit:i}){const l=ne();return i("pageTitle","Telegram Login"),(c,s)=>(t(),p("div",null,[g(l)?(t(),a(yt,{key:0,onPageTitle:s[0]||(s[0]=n=>i("pageTitle",n))})):(t(),a(me,{key:1}))]))}});export{Lt as default};
