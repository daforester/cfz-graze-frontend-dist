import{s as U}from"./index-ba0d422e.js";import{u as k}from"./useGrazeAPI-87ce7f3a.js";import{v as S}from"./v4-a960c1f4.js";import{V as b,a as O}from"./VBtn-10f35354.js";import{V as j,b as K}from"./VToolbar-1f53d858.js";import{V as $}from"./VSpacer-592d841d.js";import{V as x}from"./VSheet-3052b4fb.js";import{V as F}from"./VContainer-06a40627.js";import{a as M,V as I}from"./VRow-590b9d1d.js";import{V as D}from"./VTextField-9e75a076.js";import{c as J,e as P}from"./VCard-90d591b1.js";import{d as N,y as v,o as w,b as q,w as i,c as e,e as T,L as y,X as C,Y as z,h as E,k as G,N as R,F as X}from"./index-b32d0632.js";import{V as Y}from"./VAutocomplete-e0a818d6.js";import{V as H}from"./VDialog-5f6dc991.js";import{a as Q,b as W}from"./VList-a021241e.js";const h="00000000-0000-0000-0000-000000000000",Z=N({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(o,{emit:c}){const m=v(""),s=v("");typeof o.convention=="object"?(m.value=o.convention.ConventionUUID,s.value=o.convention.OrganisationUUID):m.value=o.convention||"",typeof o.organisation=="object"?s.value=o.organisation.OrganisationUUID:s.value.length===0&&(s.value=o.organisation||"");const u=v({ID:0,TagUUID:S(),ConventionID:0,ConventionUUID:m.value||h,OrganisationID:0,OrganisationUUID:s.value||h,Title:"",Key:""}),g=k(),p=()=>{g.saveTag(u.value).then(r=>{r&&(u.value=r,c("save",u.value),c("close"))})};return(r,n)=>(w(),q(P,null,{default:i(()=>[e(K,{dark:"",color:"primary"},{default:i(()=>[e(b,{icon:"",dark:"",onClick:n[0]||(n[0]=d=>c("close"))},{default:i(()=>[e(O,null,{default:i(()=>[T("mdi:mdi-close")]),_:1})]),_:1}),e(j,null,{default:i(()=>[T("Add Tag")]),_:1}),e($),e(x,null,{default:i(()=>[e(b,{variant:"text",onClick:p},{default:i(()=>[T(" Save ")]),_:1})]),_:1})]),_:1}),e(J,null,{default:i(()=>[e(F,{fluid:""},{default:i(()=>[e(M,null,{default:i(()=>[e(I,{cols:"12"},{default:i(()=>[e(D,{label:y(U).formLabelDisplayName,type:"text",variant:"outlined",modelValue:u.value.Title,"onUpdate:modelValue":n[1]||(n[1]=d=>u.value.Title=d)},null,8,["label","modelValue"])]),_:1}),e(I,{cols:"12"},{default:i(()=>[e(D,{label:y(U).formLabelTagKey,type:"text",variant:"outlined",modelValue:u.value.Key,"onUpdate:modelValue":n[2]||(n[2]=d=>u.value.Key=d)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),ce=N({__name:"SelectTags",props:C({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0}}),emits:C(["change"],["update:modelValue"]),setup(o,{emit:c}){const m=z(o,"modelValue"),s=v([]),u=k(),g=v([]),p=v([]),r=v(""),n=v(""),d=v(0);typeof o.convention=="object"?(r.value=o.convention.ConventionUUID,n.value=o.convention.OrganisationUUID):r.value=o.convention||"",typeof o.organisation=="object"?n.value=o.organisation.OrganisationUUID:n.value.length===0&&(n.value=o.organisation||""),(async()=>{const l=[];r.value&&l.push(u.getConventionTags(r.value)),n.value&&l.push(u.getOrganisationTags(n.value));const a=await Promise.all(l);if(r.value&&n.value?(p.value=a[0].sort((t,f)=>t.Title.localeCompare(f.Title)),g.value=a[1].sort((t,f)=>t.Title.localeCompare(f.Title))):r.value&&a.length==1?p.value=a[0].sort((t,f)=>t.Title.localeCompare(f.Title)):n.value&&a.length==1&&(g.value=a[0].sort((t,f)=>t.Title.localeCompare(f.Title))),Array.isArray(m.value))d.value=2;else if(typeof m.value=="string"){d.value=1;try{s.value=JSON.parse(m.value)}catch{}}})();const A=E(()=>[...g.value,...p.value].map(a=>({title:a.Title,value:s.value.find(t=>t.TagUUID===a.TagUUID)||a}))),V=v(!1),B=()=>{V.value=!0},L=l=>{l.ConventionUUID.length>0?p.value.push(l):l.OrganisationUUID.length>0&&g.value.push(l),s.value.push(l)};return G(s,()=>{switch(d.value){default:case 2:{m.value=s.value,c("change");break}case 1:{m.value=JSON.stringify(s.value),c("change");break}}}),(l,a)=>(w(),R(X,null,[e(Y,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value=t),chips:l.chips,multiple:"",label:l.label||"Tags",variant:l.variant||"solo",hint:l.hint,"persistent-hint":!0,clearable:l.clearable,items:A.value,"item-title":"title","item-value":"value"},{"prepend-item":i(()=>[e(Q,{title:"New Tag",onClick:a[0]||(a[0]=t=>B())},{prepend:i(()=>[e(O,{icon:"mdi:mdi-plus"})]),_:1}),e(W,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),e(H,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=t=>V.value=t),scrollable:!0},{default:i(()=>[e(Z,{convention:l.convention,organisation:l.organisation,onClose:a[2]||(a[2]=t=>V.value=!1),onSave:L},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}});export{h as N,ce as _};
