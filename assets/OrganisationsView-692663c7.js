import{I as R,a0 as E,a1 as P,r as d,K as H,M as p,N as w,O as a,v as e,P as f,Q as L,W as O,S as b,a3 as Q,_ as $,a6 as Z,L as J,a8 as X,V as k,a4 as ee,H as N}from"./index-9e3e7471.js";import{s as h}from"./index-26b71cef.js";import{a as F,V as ae}from"./scopeId-dd09bf07.js";import{_ as te}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-9cc7f9f5.js";import{V as G}from"./VForm-fb15eda4.js";import{V as oe,a as le}from"./VToolbar-3b43428f.js";import{V as ne}from"./VToolbarItems-8f1d627a.js";import{V as y}from"./VBtn-f825ccf4.js";import{V as ie,j as A}from"./VContainer-7d03d6aa.js";import{c as se,e as M,V as re,a as ue,b as de,d as me}from"./VCard-3eb05181.js";import{V as I,a as c}from"./VRow-faaa8f8f.js";import{V as B}from"./VAvatar-a487376c.js";import{V as S}from"./VTextField-0319d6ca.js";import{V as ge}from"./VFileInput-e82fcb11.js";import{G as q}from"./userData-d483a7f4.js";import{V as fe}from"./VDialog-c8ff9dd1.js";import{C as pe}from"./canEditOrganisation-3b1334c9.js";import{G as ce}from"./group-d2a77946.js";import{C as ve}from"./canDo-c4127599.js";import{v as _e}from"./v4-a960c1f4.js";import"./createSimpleFunctional-8cce6706.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-223a27f4.js";import"./forwardRefs-78473663.js";import"./VChip-2692a8b3.js";import"./nil-d01db1aa.js";const Ve=(v,m)=>{if(v===void 0)return!1;const n=ve(v,ce.GROUP_TYPE_ORGANISATION,m.OrganisationUUID);return n.EditOrganisation||n.EditConvention||n.ManageViews||n.ViewRegistration||n.EditRegistration||n.ManageUsers},Oe=R({__name:"EditOrganisation",props:{modelValue:{required:!0}},emits:E(["change","close","delete"],["update:modelValue"]),setup(v,{emit:m}){const n=Q(),i=F(),_=P(v,"modelValue"),s=d(H(_.value)),V=d(`${i.GetOrganisationLogoURL(s.value.OrganisationUUID)}?${new Date().getTime()}`),C=d(),o=d(),l=d(!1),D=d(""),u=d(),U=async()=>{var r;const t=new FormData((r=o.value)==null?void 0:r.$el);if(t.get("Image")&&t.get("Image").size>0)return t.set("OrganisationUUID",s.value.OrganisationUUID),await i.SaveOrganisationLogo(t)},z=()=>{var t;U(),(t=u.value)==null||t.validate().then(r=>{r&&n.saveOrganisation(s.value).then(g=>{g&&(_.value=g,m("change"),m("close"))})})},x=d({available:t=>!0,min:t=>t.length>=4||"Minimum 4 characters",required:t=>!!t||"Required.",valid:t=>!/[^0-9a-z_-]/.test(t)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),T=()=>{l.value=!1},Y=()=>{l.value=!0},j=d(`
<p class="mb-2">
  Are you sure you wish to delete this organisation? All data relating to it will be
  removed including all conventions their respective registrations and payment information.
  This action can not be undone.
</p>
<p class="mb-2">
  We are talking some Thanos level shit right here, if you proceed a team of super-powered
  beings with Daddy issues will hunt you down through time, space and a social media
  platform formerly known as twitter.
</p>
<p>
  To confirm type "I CLICK MY FINGERS" in the box below.
</p>
`),K=t=>{D.value="",n.deleteOrganisation(s.value.OrganisationUUID).then(r=>{r?t&&t("Organisation Deleted"):t&&t("Failed to Delete Organisation"),setTimeout(()=>{T(),m("delete")},2e3)}).catch(()=>{t&&(t("Failed to Delete Organisation"),setTimeout(T,2e3))})},W=()=>{V.value=URL.createObjectURL(C.value.files[0])};return(t,r)=>(p(),w(G,{"fast-fail":"",ref_key:"form",ref:u},{default:a(()=>[e(M,null,{default:a(()=>[e(oe,{dark:"",color:"primary"},{default:a(()=>[e(le,null,{default:a(()=>[f(L(s.value.Name),1)]),_:1}),e(ae),e(ne,null,{default:a(()=>[e(y,{variant:"text",onClick:Y},{default:a(()=>[f(" Delete ")]),_:1}),e(y,{variant:"text",onClick:z},{default:a(()=>[f(" Save ")]),_:1}),e(y,{icon:"",dark:"",onClick:r[0]||(r[0]=g=>m("close"))},{default:a(()=>[e(ie,null,{default:a(()=>[f("mdi:mdi-close")]),_:1})]),_:1})]),_:1})]),_:1}),e(se,null,{default:a(()=>[e(A,{fluid:!0},{default:a(()=>[e(I,null,{default:a(()=>[e(c,{cols:"12"},{default:a(()=>[e(B,{class:"imgLogo mx-auto",src:V.value||""},null,8,["src"])]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(c,{cols:"12"},{default:a(()=>[e(S,{label:O(h).formLabelName,type:"text",variant:"outlined",modelValue:s.value.Name,"onUpdate:modelValue":r[1]||(r[1]=g=>s.value.Name=g)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(c,{cols:"12"},{default:a(()=>[e(S,{label:O(h).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[x.value.available,x.value.min,x.value.required,x.value.valid],type:"text",variant:"outlined",modelValue:s.value.Slug,"onUpdate:modelValue":r[2]||(r[2]=g=>s.value.Slug=g)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(c,null,{default:a(()=>[e(G,{ref_key:"organisationImageForm",ref:o,enctype:"multipart/form-data"},{default:a(()=>[e(ge,{label:O(h).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:C,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:W},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l.value?(p(),w(te,{key:0,modelValue:l.value,"onUpdate:modelValue":r[3]||(r[3]=g=>l.value=g),title:`Delete ${s.value.Name}`,subtitle:"Your will be done",message:j.value,"confirmation-text":"I CLICK MY FINGERS",onDelete:K},null,8,["modelValue","title","message"])):b("",!0)]),_:1},512))}});const Ie=$(Oe,[["__scopeId","data-v-db4825de"]]),Ce=R({__name:"OrganisationCard",props:{modelValue:{required:!0}},emits:E(["delete"],["update:modelValue"]),setup(v,{emit:m}){const n=q();(!n||!n.Groups.find(o=>o.Permission.EditConvention)&&!n.Groups.find(o=>o.Permission.EditOrganisation)&&!n.Groups.find(o=>o.Permission.EditRegistration)&&!n.Groups.find(o=>o.Permission.ManageViews)&&!n.Groups.find(o=>o.Permission.ViewRegistration))&&Z().push("/");const i=P(v,"modelValue"),_=F(),s=d(!1),V=d(""),C=()=>{V.value=`${_.GetOrganisationLogoURL(i.value.OrganisationUUID)}?${new Date().getTime()}`};return C(),(o,l)=>{const D=J("RouterLink");return p(),w(M,null,{default:a(()=>[e(de,{class:"flex-1-1 align-content-start"},{default:a(()=>[e(B,{class:"imgLogo mx-auto",src:V.value||""},null,8,["src"]),e(re,null,{default:a(()=>[f(L(i.value.Name),1)]),_:1}),e(ue,null,{default:a(()=>[f(L(i.value.Slug),1)]),_:1})]),_:1}),e(me,null,{default:a(()=>[e(I,{"no-gutters":""},{default:a(()=>[e(c,{class:"ma-1"},{default:a(()=>[e(y,{variant:"tonal",color:"primary",onClick:l[0]||(l[0]=u=>s.value=!0),width:"100%"},{default:a(()=>[f("Edit")]),_:1})]),_:1}),b("",!0),e(c,{class:"ma-1"},{default:a(()=>[e(D,{to:`/admin/organisations/${i.value.Slug?i.value.Slug:i.value.OrganisationUUID}`},{default:a(()=>[e(y,{variant:"tonal",color:"green",width:"100%"},{default:a(()=>[f("Convention Manager")]),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),e(fe,{modelValue:s.value,"onUpdate:modelValue":l[4]||(l[4]=u=>s.value=u),scrollable:!0,fullscreen:!0,persistent:!0},{default:a(()=>[e(Ie,{onClose:l[1]||(l[1]=u=>s.value=!1),modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=u=>i.value=u),onDelete:l[3]||(l[3]=u=>{s.value=!1,m("delete")}),onChange:C},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}});const De=$(Ce,[["__scopeId","data-v-085ee91f"]]),We=R({__name:"OrganisationsView",emits:["pageTitle"],setup(v,{emit:m}){const n=X.getInstance(),i=d([]);m("pageTitle","Organisations");const _=q(),s=()=>{const o={ID:0,OrganisationUUID:_e(),Name:"New Organisation",Slug:"",Logo:""};n.saveOrganisation(o).then(l=>{l&&i.value.push(l)})},V=o=>{i.value.splice(o,1)};return(()=>{n.getOrganisations().then(o=>{i.value=o})})(),(o,l)=>(p(),w(A,null,{default:a(()=>[e(I,null,{default:a(()=>[(p(!0),k(N,null,ee(i.value,(D,u)=>(p(),k(N,{key:D.ID},[O(Ve)(O(_),D)?(p(),w(c,{key:0,cols:"12",sm:"6",md:"4",lg:"3",class:"d-flex flex-column"},{default:a(()=>[e(De,{modelValue:i.value[u],"onUpdate:modelValue":U=>i.value[u]=U,class:"elevation-5 flex-1-0 d-flex flex-column",onDelete:U=>V(u)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024)):b("",!0)],64))),128))]),_:1}),e(I,null,{default:a(()=>[O(pe)(O(_))?(p(),w(c,{key:0,class:"text-right"},{default:a(()=>[e(y,{color:"primary",onClick:s},{default:a(()=>[f("New")]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}))}});export{We as default};
