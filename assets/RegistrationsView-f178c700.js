import{p as kt,n as Nt,e as de,t as Ce,c as Lt,G as Pt,v as t,H as P,x as Qe,I as ue,a0 as _e,a1 as Fe,r as U,K as Ae,M as u,N as G,O as a,a3 as pe,W as x,a2 as xe,a4 as te,S as q,w as ie,X as h,Q as b,V as I,P as w,_ as Xe,ac as Ft,ad as wt,E as ot,k as $t,f as Bt,d as Gt,o as Yt,ae as nt,R as xt,Y as Ht,Z as qt,a7 as jt,a6 as Qt}from"./index-738c3234.js";import{e as Kt,T as zt,d as Wt,V as Jt,c as Xt}from"./FormRenderer.vue_vue_type_style_index_0_lang-0b508acc.js";import{a as Zt,F as Se}from"./form-29fd1dbb.js";import{_ as we}from"./ModelDialog.vue_vue_type_script_setup_true_lang-0bbc45b5.js";import{m as ea,k as ta,l as aa,n as oa,o as na,p as la,q as ia,u as sa,r as ua,s as ra,t as da,v as ma,w as ca,x as va,y as Ua,z as lt,A as it,B as st,a as _a,_ as Aa,f as ut,c as _t,d as At,e as Tt,b as ft,V as Et,g as Ta,h as fa,i as Ea,j as Sa}from"./VWindowItem-b2832d98.js";import{V as J,a as N}from"./VRow-bc576cf0.js";import{V as me}from"./VTextField-40c4b7b1.js";import{V as se}from"./copyToClipboard-8a53a7d5.js";import{u as pa,j as De,V as Da}from"./VContainer-ddcb7e90.js";import{V as Ra,u as Ze}from"./VCheckbox-39223a6e.js";import{v as he}from"./v4-a960c1f4.js";import{h as Ge,b as Ia,a as ya,c as ga,d as rt,P as We,u as St}from"./useDisplayTransactions-3098d201.js";import{V as Ye,a as Le}from"./VList-22d71c73.js";import{V as oe,a as Ca}from"./VBtn-ea854b85.js";import{b as Oa,c as pt,d as dt}from"./submission-6136b51d.js";import{V as Ma}from"./forwardRefs-27122093.js";import{V as ha}from"./VAvatar-78e62430.js";import{V as Dt,a as Va}from"./VToolbar-46d60136.js";import{V as He,a as ba}from"./scopeId-0150fc3a.js";import{c as ka,e as Rt,V as Na}from"./VCard-61879cae.js";import{V as La}from"./VDialog-c9102e94.js";import{s as Pa}from"./sortSubmissions-8ed80f07.js";import{_ as Je,V as It}from"./SaveButton.vue_vue_type_script_setup_true_lang-b6bc6980.js";import{V as Fa}from"./VForm-994bd115.js";import{G as wa}from"./group-d2a77946.js";import{C as $a}from"./canDo-2c299106.js";import{G as Ba}from"./userData-dbbf91c7.js";import{u as Ke}from"./nil-d01db1aa.js";import{V as mt,a as Ga}from"./VTable-39781ef5.js";import"./index-26b71cef.js";import"./VTextarea-6bee8f91.js";import"./VChip-ca1dc518.js";import"./VToolbarItems-85298a93.js";import"./VDivider-1675cca0.js";import"./createSimpleFunctional-69fb0e49.js";var yt=(e=>(e.ADMIN_LAYOUT_PANELS="ADMIN_LAYOUT_PANELS",e.ADMIN_LAYOUT_TABLE="ADMIN_LAYOUT_TABLE",e))(yt||{});const Ya=[{title:"Panel Layout",value:"ADMIN_LAYOUT_PANELS"},{title:"Table Layout",value:"ADMIN_LAYOUT_TABLE"}];var Pe=(e=>(e.LAYOUT_ITEM_SOURCE_FORM="LAYOUT_ITEM_SOURCE_FORM",e.LAYOUT_ITEM_SOURCE_META="LAYOUT_ITEM_SOURCE_META",e.LAYOUT_ITEM_SOURCE_USER="LAYOUT_ITEM_SOURCE_USER",e))(Pe||{});const xa=[{title:"Form Field Submission Data",value:"LAYOUT_ITEM_SOURCE_FORM"},{title:"Miscellaneous Data",value:"LAYOUT_ITEM_SOURCE_META"},{title:"User Profile Data",value:"LAYOUT_ITEM_SOURCE_USER"}];var Q=(e=>(e.META_DATA_SOURCE_ACCOMMODATION_ALLOCATION="META_DATA_SOURCE_ACCOMMODATION_ALLOCATION",e.META_DATA_SOURCE_ACCOMMODATION_FORM="META_DATA_SOURCE_ACCOMMODATION_FORM",e.META_DATA_SOURCE_BADGE_FORM="META_DATA_SOURCE_BADGE_FORM",e.META_DATA_SOURCE_DEALER_FORM="META_DATA_SOURCE_DEALER_FORM",e.META_DATA_SOURCE_PAYMENT_STATUS="META_DATA_SOURCE_PAYMENT_STATUS",e.META_DATA_SOURCE_REGISTRATION_ACTIONS="META_DATA_SOURCE_REGISTRATION_ACTIONS",e.META_DATA_SOURCE_REGISTRATION_FORM="META_DATA_SOURCE_REGISTRATION_FORM",e.META_DATA_SOURCE_REGISTRATION_GROUP="META_DATA_SOURCE_REGISTRATION_GROUP",e.META_DATA_SOURCE_REGISTRATION_REFERENCE="META_DATA_SOURCE_REGISTRATION_REFERENCE",e.META_DATA_SOURCE_SUBMISSION_DATE="META_DATA_SOURCE_SUBMISSION_DATE",e.META_DATA_SOURCE_SUBMISSION_STATUS="META_DATA_SOURCE_SUBMISSION_STATUS",e))(Q||{});const Ha=[{title:"Accommodation Allocation",value:"META_DATA_SOURCE_ACCOMMODATION_ALLOCATION"},{title:"Accommodation Form",value:"META_DATA_SOURCE_ACCOMMODATION_FORM"},{title:"Actions",value:"META_DATA_SOURCE_REGISTRATION_ACTIONS"},{title:"Badge Form",value:"META_DATA_SOURCE_BADGE_FORM"},{title:"Dealer Form",value:"META_DATA_SOURCE_DEALER_FORM"},{title:"Payment Status",value:"META_DATA_SOURCE_PAYMENT_STATUS"},{title:"Registration Group",value:"META_DATA_SOURCE_REGISTRATION_GROUP"},{title:"Registration Reference",value:"META_DATA_SOURCE_REGISTRATION_REFERENCE"},{title:"Registration Form",value:"META_DATA_SOURCE_REGISTRATION_FORM"},{title:"Submission Date",value:"META_DATA_SOURCE_SUBMISSION_DATE"},{title:"Submission Status",value:"META_DATA_SOURCE_SUBMISSION_STATUS"}];var ee=(e=>(e.USER_DATA_SOURCE_NULL="",e.USER_DATA_SOURCE_DISPLAY_NAME="USER_DATA_SOURCE_DISPLAY_NAME",e.USER_DATA_SOURCE_HANDLE="USER_DATA_SOURCE_HANDLE",e.USER_DATA_SOURCE_AVATAR="USER_DATA_SOURCE_AVATAR",e.USER_DATA_SOURCE_FIRST_NAME="USER_DATA_SOURCE_FIRST_NAME",e.USER_DATA_SOURCE_LAST_NAME="USER_DATA_SOURCE_LAST_NAME",e.USER_DATA_SOURCE_DATE_OF_BIRTH="USER_DATA_SOURCE_DATE_OF_BIRTH",e.USER_DATA_SOURCE_EMAIL="USER_DATA_SOURCE_EMAIL",e.USER_DATA_SOURCE_TELEGRAM="USER_DATA_SOURCE_TELEGRAM",e))(ee||{});const qa=[{title:"Display Name",value:"USER_DATA_SOURCE_DISPLAY_NAME"},{title:"Handle",value:"USER_DATA_SOURCE_HANDLE"},{title:"Avatar",value:"USER_DATA_SOURCE_AVATAR"},{title:"First Name",value:"USER_DATA_SOURCE_FIRST_NAME"},{title:"Last Name",value:"USER_DATA_SOURCE_LAST_NAME"},{title:"Date of Birth",value:"USER_DATA_SOURCE_DATE_OF_BIRTH"},{title:"Email Address",value:"USER_DATA_SOURCE_EMAIL"},{title:"Telegram Username",value:"USER_DATA_SOURCE_TELEGRAM"}],ja=e=>{switch(e){case"EMAIL_STATUS_QUEUED":return"Queued";case"EMAIL_STATUS_QUEUE_ERROR":return"Processing";case"EMAIL_STATUS_QUEUE_FAILURE":return"Internal Error";case"EMAIL_STATUS_SENDING":return"Sending";case"EMAIL_STATUS_SENT":return"Sent";case"EMAIL_STATUS_SEND_ERROR":return"Failed to Send"}return"Unknown"},Qa=kt({itemsLength:{type:[Number,String],required:!0},...ea(),...ta(),...aa()},"VDataTableServer"),Ka=Nt()({name:"VDataTableServer",props:Qa(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0,"click:row":(e,D)=>!0},setup(e,D){let{emit:r,slots:l}=D;const{groupBy:n}=oa(e),{sortBy:d,multiSort:_,mustSort:m}=na(e),{page:T,itemsPerPage:f}=la(e),A=de(()=>parseInt(e.itemsLength,10)),{columns:o,headers:i}=ia(e,{groupBy:n,showSelect:Ce(e,"showSelect"),showExpand:Ce(e,"showExpand")}),{items:s}=sa(e,o),{toggleSort:c}=ua({sortBy:d,multiSort:_,mustSort:m,page:T}),{opened:K,isGroupOpen:R,toggleGroup:g,extractRows:M}=ra({groupBy:n,sortBy:d}),{pageCount:V,setItemsPerPage:j}=da({page:T,itemsPerPage:f,itemsLength:A}),{flatItems:ne}=ma(s,n,K),{isSelected:Te,select:z,selectAll:E,toggleSelect:S,someSelected:L,allSelected:C}=ca(e,{allItems:s,currentPage:s}),{isExpanded:B,toggleExpand:X}=va(e),ae=de(()=>M(s.value));Ua({page:T,itemsPerPage:f,sortBy:d,groupBy:n,search:Ce(e,"search")}),Lt("v-data-table",{toggleSort:c,sortBy:d}),Pt({VDataTableRows:{hideNoData:Ce(e,"hideNoData"),noDataText:Ce(e,"noDataText"),loading:Ce(e,"loading"),loadingText:Ce(e,"loadingText")}});const W=de(()=>({page:T.value,itemsPerPage:f.value,sortBy:d.value,pageCount:V.value,toggleSort:c,setItemsPerPage:j,someSelected:L.value,allSelected:C.value,isSelected:Te,select:z,selectAll:E,toggleSelect:S,isExpanded:B,toggleExpand:X,isGroupOpen:R,toggleGroup:g,items:ae.value,groupedItems:ne.value,columns:o.value,headers:i.value}));pa(()=>{const[ce]=lt.filterProps(e),[re]=it.filterProps(e),[Re]=st.filterProps(e),[Ie]=mt.filterProps(e);return t(mt,Qe({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Ie),{top:()=>{var ye;return(ye=l.top)==null?void 0:ye.call(l,W.value)},default:()=>{var ye,Ve,$e,be;return l.default?l.default(W.value):t(P,null,[(ye=l.colgroup)==null?void 0:ye.call(l,W.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(it,Qe(re,{sticky:e.fixedHeader}),l)]),(Ve=l.thead)==null?void 0:Ve.call(l,W.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[l.body?l.body(W.value):t(st,Qe(Re,{items:ne.value}),l)]),($e=l.tbody)==null?void 0:$e.call(l,W.value),(be=l.tfoot)==null?void 0:be.call(l,W.value)])},bottom:()=>l.bottom?l.bottom(W.value):t(lt,ce,{prepend:l["footer.prepend"]})})})}}),za=ue({__name:"EditAdminLayout",props:_e({title:{default:""},layout:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["save"],["update:modelValue"]),setup(e,{emit:D}){const r=Fe(e,"modelValue"),l=U(Ae(e.layout)),n=U([]),d=pe(),_=({callback:A})=>{const o=()=>{A&&A("Failed to Save Layout")},i=()=>{A&&A("Layout Saved")};d.saveAdminLayout(l.value).then(s=>{s?(i(),D("save",s)):o()}).catch(()=>{o()})},m=()=>({ID:0,LayoutPanelUUID:he(),AdminLayoutID:l.value.ID,AdminLayoutUUID:l.value.AdminLayoutUUID,Name:"",Order:l.value.Panels.length+1,Items:[],RequiredFormType:Se.FORM_TYPE_NIL,RequiredGroupMemberships:[],RequiredRegistrationTags:[]}),T=A=>()=>({ID:0,LayoutItemUUID:he(),LayoutPanelID:A.ID,LayoutPanelUUID:A.LayoutPanelUUID,Label:"",SourceType:Pe.LAYOUT_ITEM_SOURCE_FORM,SectionFieldID:void 0,SectionFieldUUID:void 0,SectionField:void 0,MetaField:void 0,UserField:void 0,Align:"",Order:A.Items.length+1,DefaultSort:!1}),f=A=>{const o=n.value.find(i=>i.value===A.SectionFieldUUID);o&&(A.SectionFieldID=o.object.ID,A.SectionField=o.object)};return d.getConventionForms(e.layout.ConventionUUID).then(A=>{A.forEach(o=>o.Sections.forEach(i=>i.Fields&&n.value.push(...i.Fields.map(s=>{var K;return{title:`${o.Name} - ${i.Name} - ${(K=s.Field)==null?void 0:K.Name}`,value:s.SectionFieldUUID,object:s}})))),n.value.sort(Kt("title"))}),(A,o)=>(u(),G(we,{modelValue:r.value,"onUpdate:modelValue":o[3]||(o[3]=i=>r.value=i),onSave:_,title:A.title,color:"primary",fullscreen:!0,persistent:!0},{default:a(()=>[t(De,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6"},{default:a(()=>[t(me,{modelValue:l.value.Name,"onUpdate:modelValue":o[0]||(o[0]=i=>l.value.Name=i),label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6"},{default:a(()=>[t(se,{modelValue:l.value.Type,"onUpdate:modelValue":o[1]||(o[1]=i=>l.value.Type=i),label:"Layout Type",items:x(Ya),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(ut,{modelValue:l.value.Panels,"onUpdate:modelValue":o[2]||(o[2]=i=>l.value.Panels=i),"new-item":m,closeable:!1,title:"Panels",label:"Name","slot-name-prefix":"panel"},xe({_:2},[te(l.value.Panels,(i,s)=>({name:`panel_${s}`,fn:a(()=>[t(De,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6"},{default:a(()=>[t(me,{modelValue:i.Name,"onUpdate:modelValue":c=>i.Name=c,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(N,{cols:"12",sm:"6"},{default:a(()=>[t(se,{modelValue:i.RequiredFormType,"onUpdate:modelValue":c=>i.RequiredFormType=c,items:x(Zt),clearable:!0,label:"Required Form",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024),t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6"},{default:a(()=>[t(_a,{label:"Required Groups",variant:"outlined",modelValue:i.RequiredGroupMemberships,"onUpdate:modelValue":c=>i.RequiredGroupMemberships=c,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Groups that a user must be in to see this form. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024),t(N,{cols:"12",sm:"6"},{default:a(()=>[t(Aa,{label:"Registration Tags",variant:"outlined",modelValue:i.RequiredRegistrationTags,"onUpdate:modelValue":c=>i.RequiredRegistrationTags=c,convention:l.value.ConventionUUID,chips:"",clearable:"",hint:"Tags that a registration must have to appear in results. (Any one)"},null,8,["modelValue","onUpdate:modelValue","convention"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(ut,{modelValue:i.Items,"onUpdate:modelValue":c=>i.Items=c,"new-item":T(i),closeable:!1,title:"Items",label:"Label","slot-name-prefix":"item"},xe({_:2},[te(i.Items,(c,K)=>({name:`item_${K}`,fn:a(()=>[t(De,{class:"px-0 mx-0",fluid:!0},{default:a(()=>[t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6"},{default:a(()=>[t(me,{modelValue:c.Label,"onUpdate:modelValue":R=>c.Label=R,label:"Name",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6"},{default:a(()=>[t(se,{modelValue:c.SourceType,"onUpdate:modelValue":R=>c.SourceType=R,label:"Source Type",items:x(xa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(N,{cols:"12",sm:"6"},{default:a(()=>[c.SourceType==="LAYOUT_ITEM_SOURCE_FORM"?(u(),G(se,{key:0,modelValue:c.SectionFieldUUID,"onUpdate:modelValue":R=>c.SectionFieldUUID=R,label:"Form Data",items:n.value,"item-title":"title","item-value":"value",variant:"outlined","hide-details":"",onBlur:R=>f(c)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"])):c.SourceType==="LAYOUT_ITEM_SOURCE_META"?(u(),G(se,{key:1,modelValue:c.MetaField,"onUpdate:modelValue":R=>c.MetaField=R,label:"Miscellaneous Data",items:x(Ha),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):c.SourceType==="LAYOUT_ITEM_SOURCE_USER"?(u(),G(se,{key:2,modelValue:c.UserField,"onUpdate:modelValue":R=>c.UserField=R,label:"User Profile Data",items:x(qa),"item-title":"title","item-value":"value",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])):q("",!0)]),_:2},1024)]),_:2},1024),t(J,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ra,{modelValue:c.DefaultSort,"onUpdate:modelValue":R=>c.DefaultSort=R,label:"Default Sort","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])}))]),1032,["modelValue","onUpdate:modelValue","new-item"])])}))]),1032,["modelValue"])]),_:1},8,["modelValue","title"]))}}),Wa=h("br",null,null,-1),Ja=h("h3",null,"Assigned Accommodation",-1),Xa=h("br",null,null,-1),Za=h("br",null,null,-1),eo=h("h3",null,"Accommodation Preferences",-1),to=h("h3",null,"Selected Tickets",-1),ao=h("br",null,null,-1),oo=ue({__name:"EditAccommodationAssignmentDialog",props:_e({convention:{},registration:{},selectedAccommodation:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["update:field"],["update:modelValue"]),setup(e,{emit:D}){const r=e,{convention:l,registration:n,title:d=""}=r,_=pe(),m=Fe(e,"modelValue"),T=U({capacity:{max:E=>{var C;const S=V.value.find(B=>B.room.RoomUUID===E);return!S||S.room.MaximumCapacity===0?!0:(((C=i.value)==null?void 0:C.Members.length)||0)<=S.room.MaximumCapacity||"Too many people in the group for this room"},min:E=>{var C;const S=V.value.find(B=>B.room.RoomUUID===E);return!S||S.room.MinimumCapacity===0?!0:(((C=i.value)==null?void 0:C.Members.length)||0)>=S.room.MinimumCapacity||"Not enough people in the group for this room"}}}),f=U([]),A=Ze(r,D,void 0,void 0,"field"),o=U(Ae(A.value));ie(A,()=>{o.value=Ae(A.value)});const i=U(),s=U(""),c=U(""),K=U([]),R=U({Ticket:[],AddonsChecked:[],ComponentsChecked:[]}),g=async()=>{var C;const E=await _.getConventionAvailableAccommodation(l.ConventionUUID);E&&(f.value=E);const S=await _.getRegistrationGroup(n.RegistrationUUID||"");S&&(i.value=S);const L=await _.getConventionTickets(l.ConventionUUID);L&&(K.value=L);try{R.value=JSON.parse(((C=i.value)==null?void 0:C.TicketData)||"")}catch{}};ie(s,()=>{c.value=V.value.length>0?V.value[0].value:""});const M=de(()=>{const E=j.value;return f.value.map(S=>{let L;return E.forEach(C=>{S.Costs.forEach(B=>{B.DateStart===(C==null?void 0:C.DateStart)&&B.DateEnd===C.DateEnd&&(L===void 0||L>B.Availability)&&(L=B.Availability)})}),{label:`${S.Name}`,title:`${S.Name} (${L} Available)`,value:S.AccommodationUUID}})}),V=de(()=>{const E=j.value,S=f.value.find(L=>L.AccommodationUUID===s.value);return(S==null?void 0:S.Pool.map(L=>{var B,X;let C;return E.forEach(ae=>{L.Costs.forEach(W=>{W.DateStart===(ae==null?void 0:ae.DateStart)&&W.DateEnd===ae.DateEnd&&(C===void 0||C>W.Availability)&&(C=W.Availability)})}),{label:`${(B=L.Venue)==null?void 0:B.Name} - ${L.Name}`,title:`${(X=L.Venue)==null?void 0:X.Name} - ${L.Name} (${C} Available)`,value:L.RoomUUID,room:L}}))||[]}),j=de(()=>[...R.value.Ticket,...R.value.AddonsChecked,...R.value.ComponentsChecked].map(E=>K.value.find(S=>S.TicketUUID===E)).filter(E=>E!==void 0&&E.RequiresAccommodation)),ne=E=>{var S;_.assignAccommodation(((S=i.value)==null?void 0:S.Registration.RegistrationUUID)||"",s.value,c.value,!1).then(L=>{L?(g(),E&&E("Room Assigned")):E&&E("Room not assigned")}).catch(()=>{E&&E("Room not assigned")})},Te=E=>{var S,L;(S=i.value)!=null&&S.Registration.AllocationUUID?_.deleteAllocation(((L=i.value)==null?void 0:L.Registration.AllocationUUID)||"").then(C=>{C?(g(),E&&E("Allocation Deleted")):E&&E("Allocation not deleted")}).catch(()=>{E&&E("Allocation not deleted")}):E&&E("Nothing to Delete")},z=E=>{var L,C;const S=(L=f.value.find(B=>B.AccommodationUUID===E.AccommodationUUID))==null?void 0:L.Pool;if(S){const B=S.find(X=>X.RoomUUID===E.RoomUUID);if(B)return`${(C=B.Venue)==null?void 0:C.Name} - ${B.Name}`}return""};return g(),(E,S)=>{var L;return u(),G(we,{modelValue:m.value,"onUpdate:modelValue":S[2]||(S[2]=C=>m.value=C),title:x(d),color:"primary","show-close-action":!0,"show-delete-action":!!((L=i.value)!=null&&L.Registration.Allocation),"show-save-action":!!c.value,"save-button-label":"Assign Room",onDelete:Te,onSave:ne,fullscreen:!0,persistent:!0},{default:a(()=>[t(De,{class:"pa-0",fluid:!0},{default:a(()=>[t(J,null,{default:a(()=>{var C;return[t(N,{cols:"12",md:"6"},{default:a(()=>{var B,X;return[h("h3",null,"Group Members ("+b((B=i.value)==null?void 0:B.Members.length)+")",1),(u(!0),I(P,null,te((X=i.value)==null?void 0:X.Members,ae=>(u(),I(P,{key:ae.UUID},[w(" #"+b(ae.Reference)+" "+b(ae.Name),1),Wa],64))),128))]}),_:1}),(C=i.value)!=null&&C.Registration.Allocation?(u(),G(N,{key:0,cols:"12",md:"6"},{default:a(()=>[Ja,t(Ye,null,{default:a(()=>{var B;return[(u(!0),I(P,null,te((B=i.value)==null?void 0:B.Registration.Allocation.Periods,X=>(u(),G(Le,{key:X.AllocationPeriodUUID},{default:a(()=>{var ae;return[w(b((ae=f.value.find(W=>W.AccommodationUUID===X.AccommodationUUID))==null?void 0:ae.Name)+" ",1),Xa,w(" "+b(z(X))+" ",1),Za,h("small",null,"("+b(x(Ge)(X.DateStart))+" - "+b(x(Ge)(X.DateEnd))+")",1)]}),_:2},1024))),128))]}),_:1})]),_:1})):q("",!0)]}),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12",md:"6"},{default:a(()=>[E.selectedAccommodation.length?(u(),I(P,{key:0},[eo,t(Ye,null,{default:a(()=>[(u(!0),I(P,null,te(E.selectedAccommodation,(C,B)=>(u(),G(Le,{key:C.AccommodationUUID},{default:a(()=>[w(b(B+1)+". "+b(C.Name),1)]),_:2},1024))),128))]),_:1})],64)):q("",!0)]),_:1}),t(N,{cosl:"12",md:"6"},{default:a(()=>[to,t(Ye,null,{default:a(()=>[(u(!0),I(P,null,te(j.value,C=>(u(),G(Le,{key:C==null?void 0:C.TicketUUID},{default:a(()=>[w(b(C.Name)+" ",1),ao,h("small",null,"("+b(x(Ge)(C.DateStart))+" - "+b(x(Ge)(C.DateEnd))+")",1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12",md:"6"},{default:a(()=>[t(se,{modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=C=>s.value=C),items:M.value,"item-title":"title","item-value":"value",label:"Accommodation"},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"12",md:"6"},{default:a(()=>[t(se,{modelValue:c.value,"onUpdate:modelValue":S[1]||(S[1]=C=>c.value=C),items:V.value,"item-title":"title","item-value":"value",label:"Room Pool",rules:[T.value.capacity.min,T.value.capacity.max]},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title","show-delete-action","show-save-action"])}}}),no={key:0,class:"accommodationList"},lo={key:0,class:"text-orange-darken-2"},io=ue({__name:"DataTableItemAccommodation",props:{accommodations:{default:()=>[]},convention:{},forms:{},registration:{},tickets:{default:()=>[]},value:{default:""},venues:{}},setup(e){const D=U(!1),r=de(()=>{if(!e.value)return[];const n=JSON.parse(e.value),d=e.accommodations.filter(_=>n.includes(_.AccommodationUUID)).sort((_,m)=>{const T=n.findIndex(A=>A===_.AccommodationUUID),f=n.findIndex(A=>A===m.AccommodationUUID);return T>f?1:-1});return Ae(d)}),l=de(()=>{let n;const d=e.forms.find(_=>_.Sections.find(m=>{var T;return(T=m.Fields)==null?void 0:T.find(f=>{var A;if(((A=f.Field)==null?void 0:A.Type)==="TICKET")return n=f,!0})}));return n?!!e.registration.Submissions.find(_=>{if(_.FormUUID==(d==null?void 0:d.FormUUID))return _.Data.find(m=>{if(m.SectionFieldUUID==(n==null?void 0:n.SectionFieldUUID)){const T=JSON.parse(m.Data);return e.tickets.filter(f=>f.RequiresAccommodation).find(f=>T.Ticket.includes(f.TicketUUID)||T.AddonsChecked.includes(f.TicketUUID)||T.ComponentsChecked.includes(f.TicketUUID))}})}):!1});return(n,d)=>l.value?(u(),I(P,{key:0},[n.value?(u(),I("ol",no,[(u(!0),I(P,null,te(r.value,_=>(u(),I("li",{key:_.AccommodationUUID},[n.registration&&n.registration.Allocation&&n.registration.Allocation.Periods.find(m=>m.AccommodationUUID===_.AccommodationUUID)?(u(),I("strong",lo,b(_.Name),1)):(u(),I(P,{key:1},[w(b(_.Name),1)],64))]))),128))])):q("",!0),t(oe,{onClick:d[0]||(d[0]=_=>D.value=!0),variant:"flat",color:"success"},{default:a(()=>[w("Assign Accommodation")]),_:1}),n.convention&&D.value?(u(),G(oo,{key:1,modelValue:D.value,"onUpdate:modelValue":d[1]||(d[1]=_=>D.value=_),title:"Accommodation Allocation",convention:n.convention,registration:n.registration,"selected-accommodation":r.value},null,8,["modelValue","convention","registration","selected-accommodation"])):q("",!0)],64)):q("",!0)}});const so=Xe(io,[["__scopeId","data-v-7a102d46"]]),uo={key:0,class:"addonList"},ro={key:0},mo={key:0},co=ue({__name:"DataTableItemExtras",props:{extras:{default:()=>[]},value:{default:""}},setup(e){const D=de(()=>{if(!e.value)return;const r=JSON.parse(e.value),l=Object.keys(r),n=Ae(e.extras);return n.forEach(d=>{d.Options=d.Options.filter(_=>l.includes(_.OptionUUID)?(_.Choices=_.Choices.filter(m=>m.TagUUID===r[_.OptionUUID].choiceId),r[_.OptionUUID].checked):!1)}),n.filter(d=>d.Options.length>0),n});return(r,l)=>r.value?(u(),I("ul",uo,[(u(!0),I(P,null,te(D.value,n=>(u(),I(P,{key:n.ExtraUUID},[n.Options.length?(u(),I("li",ro,[h("strong",null,b(n.Name),1),h("ul",null,[(u(!0),I(P,null,te(n.Options,d=>(u(),I("li",{key:d.OptionUUID},[w(b(d.Name)+" ",1),d.Choices.length==1?(u(),I("small",mo,"("+b(d.Choices[0].Title)+")",1)):q("",!0)]))),128))])])):q("",!0)],64))),128))])):q("",!0)}});const vo=Xe(co,[["__scopeId","data-v-55786e01"]]),Uo={key:0},_o=ue({__name:"DataTableItemInterests",props:{interests:{default:()=>[]},value:{default:""}},setup(e){const D=de(()=>{if(!e.value)return;const r=JSON.parse(e.value);return Object.entries(r).filter(([,l])=>l).map(([l,n])=>e.interests.find(d=>d.InterestUUID===l)).filter(l=>l!==void 0)});return(r,l)=>r.value?(u(),I("ul",Uo,[(u(!0),I(P,null,te(D.value,n=>(u(),I("li",{key:n.InterestUUID},b(n.Name),1))),128))])):q("",!0)}}),Ao=h("br",null,null,-1),To=h("small",null,"Options:",-1),fo=h("br",null,null,-1),Eo=h("small",null,"Addons:",-1),So=ue({__name:"DataTableItemTicket",props:{tickets:{default:()=>[]},value:{default:""}},setup(e){const D=de(()=>{if(!e.value)return;let r={Ticket:[],AddonsChecked:[],ComponentsChecked:[]};try{r=JSON.parse(e.value),"ticket"in r&&(r.Ticket=r.ticket),"addonsChecked"in r&&(r.AddonsChecked=r.addonsChecked),"componentsChecked"in r&&(r.ComponentsChecked=r.componentsChecked)}catch{}return r.Ticket.filter(l=>{const n=e.tickets.find(d=>d.TicketUUID===l);return!(!n||n.Type!==zt.TICKET_TYPE_TICKET)}).map(l=>{const n=e.tickets.find(_=>_.TicketUUID===l),d=Ae(n);return d.TicketComponents=n.TicketComponents.filter(_=>r.ComponentsChecked.includes(_.TicketUUID)),d.AddonTickets=n.AddonTickets.filter(_=>r.AddonsChecked.includes(_.TicketUUID)),d})});return(r,l)=>r.value?(u(!0),I(P,{key:0},te(D.value,n=>(u(),I("div",{key:n.TicketUUID},[h("strong",null,b(n.Name),1),n.TicketComponents.length>0?(u(),I(P,{key:0},[Ao,To,w("  "),(u(!0),I(P,null,te(n.TicketComponents,d=>(u(),I(P,{key:d.TicketUUID},[h("small",null,b(d.Name),1),w("  ")],64))),128))],64)):q("",!0),n.AddonTickets.length>0?(u(),I(P,{key:1},[fo,Eo,w("  "),(u(!0),I(P,null,te(n.AddonTickets,d=>(u(),I("small",{key:d.TicketUUID},[w("("),h("em",null,b(d.Name),1),w(")")]))),128))],64)):q("",!0)]))),128)):q("",!0)}}),po={key:0,class:"text-blue text-center"},Do={key:1,class:"text-red text-center"},Ro={key:2,class:"text-orange text-center"},Io={key:3,class:"text-orange text-center"},yo={key:4,class:"text-orange text-center"},go={key:5,class:"text-orange text-center"},Co={key:6,class:"text-green text-center"},Oo={key:0},Mo={key:0},ho=h("strong",null,"Total:",-1),Vo=ue({__name:"RegListRow",props:{header:{},accommodations:{},convention:{},extras:{},forms:{},item:{},interests:{},tickets:{},venues:{}},emits:["openActions","openPayments","reload"],setup(e,{emit:D}){const r=pe(),l=U(),n=U(),d=U(),_=U(),m=U(!1),T=(o,i,s)=>{n.value=o,r.getRegistrationGroup(s.RegistrationUUID||"").then(c=>{d.value=c,l.value=i,_.value=s,m.value=!0})},f=o=>{D("openActions",o)},A=o=>{D("openPayments",o)};return(o,i)=>(u(),I(P,null,[o.header.type==="ACCOMMODATION"&&o.accommodations.length>0&&o.item.raw[o.header.key]?(u(),G(so,{key:0,value:o.item.raw[o.header.key].Data,accommodations:o.accommodations,convention:o.convention,forms:o.forms,tickets:o.tickets,venues:o.venues,registration:o.item.raw[o.header.key].Registration},null,8,["value","accommodations","convention","forms","tickets","venues","registration"])):o.header.type==="EXTRAS"&&o.extras.length>0?(u(),G(vo,{key:1,value:o.item.raw[o.header.key],extras:o.extras},null,8,["value","extras"])):o.header.type==="INTERESTS"&&o.interests.length>0?(u(),G(_o,{key:2,value:o.item.raw[o.header.key],interests:o.interests},null,8,["value","interests"])):o.header.type==="TICKET"&&o.tickets.length>0?(u(),G(So,{key:3,value:o.item.raw[o.header.key],tickets:o.tickets},null,8,["value","tickets"])):o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_SUBMISSION_STATUS"||o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_ACCOMMODATION_FORM"||o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_DEALER_FORM"||o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_BADGE_FORM"||o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_FORM"?(u(!0),I(P,{key:4},te(o.item.raw[o.header.key],s=>(u(),I("ul",{key:s.Heading},[h("li",null,[h("strong",null,b(s.Heading)+": ",1),h("span",{class:Ft(x(Oa)(s.Submission.Status))},b(x(pt)(s.Submission.Status)),3),t(oe,{icon:"mdi:mdi-form-select",title:"Edit Submitted Data",variant:"flat",onClick:c=>T(s.Registration,s.Form,s.Submission)},null,8,["onClick"])])]))),128)):o.header.type==="LAYOUT_ITEM_SOURCE_USER.USER_DATA_SOURCE_AVATAR"?(u(),G(ha,{key:5,class:"rounded-circle",src:o.item.raw[o.header.key],height:"32",width:"32"},null,8,["src"])):o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_PAYMENT_STATUS"?(u(),I(P,{key:6},[o.item.raw[o.header.key]=="NOT_REQUIRED"?(u(),I("div",po,"No Payment Requested")):o.item.raw[o.header.key]=="MISSING_REQUIRED"?(u(),I("div",Do,"Partner Payment Not Requested")):o.item.raw[o.header.key]=="AWAITING_PARTNER"?(u(),I("div",Ro,"Awaiting Partner Payment")):o.item.raw[o.header.key]=="ALL_REQUIRED"?(u(),I("div",Io,"Awaiting Payments")):o.item.raw[o.header.key]=="REQUIRED"?(u(),I("div",yo,"Awaiting Payment")):o.item.raw[o.header.key]=="ADDITIONAL_REQUIRED"?(u(),I("div",go,"Awaiting Additional Payments")):(u(),I("div",Co,"Completed"))],64)):o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_ACTIONS"?(u(),I(P,{key:7},[t(oe,{icon:"mdi:mdi-email-fast",variant:"flat",onClick:i[0]||(i[0]=s=>f(o.item.raw[o.header.key]))}),t(oe,{icon:"mdi:mdi-cash-multiple",variant:"flat",onClick:i[1]||(i[1]=s=>A(o.item.raw[o.header.key]))})],64)):o.header.type==="LAYOUT_ITEM_SOURCE_META.META_DATA_SOURCE_REGISTRATION_GROUP"?(u(),I(P,{key:8},[o.item.raw[o.header.key].length===1?(u(),I("em",Oo," Not in a group ")):(u(),I(P,{key:1},[h("ul",null,[(u(!0),I(P,null,te(o.item.raw[o.header.key],s=>(u(),I("li",{key:s.UUID,class:"ml-0"},[w(" #"+b(s.Reference)+" : "+b(s.Name)+" ",1),s.IsLeader?(u(),I("strong",Mo,"(Leader)")):q("",!0)]))),128))]),ho,w(" "+b(o.item.raw[o.header.key].length),1)],64))],64)):(u(),I(P,{key:9},[w(b(o.item.raw[o.header.key]),1)],64)),m.value&&_.value&&l.value?(u(),G(La,{key:10,modelValue:m.value,"onUpdate:modelValue":i[5]||(i[5]=s=>m.value=s),scrollable:!0,fullscreen:!0,persistent:!0},{default:a(()=>[t(Rt,{class:"bg-red-darken-4"},{default:a(()=>[t(Dt,{color:"error"},{default:a(()=>[t(Va,null,{default:a(()=>[w("Submission Editor - Admin Mode")]),_:1}),t(He),t(Ma,null,{default:a(()=>[t(oe,{icon:"mdi:mdi-window-close",onClick:i[2]||(i[2]=s=>m.value=!1)})]),_:1})]),_:1}),t(ka,null,{default:a(()=>[t(Wt,{modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=s=>l.value=s),admin:!0,convention:o.convention,data:_.value,editable:!0,"registration-group":d.value,onClose:i[4]||(i[4]=s=>{m.value=!1,D("reload")})},null,8,["modelValue","convention","data","registration-group"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):q("",!0)],64))}});var bo=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],ko=function(e){return bo.map(function(D){return D.toLowerCase()}).indexOf(e.toLowerCase())!==-1},No=function(e,D,r){Object.keys(D).filter(ko).forEach(function(l){var n=D[l];typeof n=="function"&&(l==="onInit"?n(e,r):r.on(l.substring(2),function(d){return n(d,r)}))})},Lo=function(e,D,r,l){var n=e.modelEvents?e.modelEvents:null,d=Array.isArray(n)?n.join(" "):n;ie(l,function(_,m){r&&typeof _=="string"&&_!==m&&_!==r.getContent({format:e.outputFormat})&&r.setContent(_)}),r.on(d||"change input undo redo",function(){D.emit("update:modelValue",r.getContent({format:e.outputFormat}))})},Po=function(e,D,r,l,n,d){l.setContent(d()),r.attrs["onUpdate:modelValue"]&&Lo(D,r,l,n),No(e,r.attrs,l)},ct=0,gt=function(e){var D=Date.now(),r=Math.floor(Math.random()*1e9);return ct++,e+"_"+r+ct+String(D)},Fo=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},vt=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},wo=function(e,D){return vt(e).concat(vt(D))},$o=function(e){return e==null},Ut=function(){return{listeners:[],scriptId:gt("tiny-script"),scriptLoaded:!1}},Bo=function(){var e=Ut(),D=function(n,d,_,m){var T=d.createElement("script");T.referrerPolicy="origin",T.type="application/javascript",T.id=n,T.src=_;var f=function(){T.removeEventListener("load",f),m()};T.addEventListener("load",f),d.head&&d.head.appendChild(T)},r=function(n,d,_){e.scriptLoaded?_():(e.listeners.push(_),n.getElementById(e.scriptId)||D(e.scriptId,n,d,function(){e.listeners.forEach(function(m){return m()}),e.scriptLoaded=!0}))},l=function(){e=Ut()};return{load:r,reinitialize:l}},Go=Bo(),Yo=function(){return typeof window<"u"?window:global},Oe=function(){var e=Yo();return e&&e.tinymce?e.tinymce:null},xo={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},Ue=globalThis&&globalThis.__assign||function(){return Ue=Object.assign||function(e){for(var D,r=1,l=arguments.length;r<l;r++){D=arguments[r];for(var n in D)Object.prototype.hasOwnProperty.call(D,n)&&(e[n]=D[n])}return e},Ue.apply(this,arguments)},Ho=function(e,D,r,l){return e(l||"div",{id:D,ref:r})},qo=function(e,D,r){return e("textarea",{id:D,visibility:"hidden",ref:r})},ze={selector:void 0,target:void 0},jo=ue({props:xo,setup:function(e,D){var r=e.init?Ue(Ue({},e.init),ze):Ue({},ze),l=wt(e),n=l.disabled,d=l.modelValue,_=l.tagName,m=U(null),T=null,f=e.id||gt("tiny-vue"),A=e.init&&e.init.inline||e.inline,o=!!D.attrs["onUpdate:modelValue"],i=!0,s=e.initialValue?e.initialValue:"",c="",K=function(M){return o?function(){return d!=null&&d.value?d.value:""}:function(){return M?s:c}},R=function(){var M=K(i),V=Ue(Ue({},r),{readonly:e.disabled,target:m.value,plugins:wo(r.plugins,e.plugins),toolbar:e.toolbar||r.toolbar,inline:A,setup:function(j){T=j,j.on("init",function(ne){return Po(ne,e,D,j,d,M)}),typeof r.setup=="function"&&r.setup(j)}});Fo(m.value)&&(m.value.style.visibility=""),Oe().init(V),i=!1};ie(n,function(M){var V;T!==null&&(typeof((V=T.mode)===null||V===void 0?void 0:V.set)=="function"?T.mode.set(M?"readonly":"design"):T.setMode(M?"readonly":"design"))}),ie(_,function(M){var V;o||(c=T.getContent()),(V=Oe())===null||V===void 0||V.remove(T),ot(function(){return R()})}),$t(function(){if(Oe()!==null)R();else if(m.value&&m.value.ownerDocument){var M=e.cloudChannel?e.cloudChannel:"6",V=e.apiKey?e.apiKey:"no-api-key",j=$o(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(V,"/tinymce/").concat(M,"/tinymce.min.js"):e.tinymceScriptSrc;Go.load(m.value.ownerDocument,j,R)}}),Bt(function(){Oe()!==null&&Oe().remove(T)}),A||(Gt(function(){i||R()}),Yt(function(){var M;o||(c=T.getContent()),(M=Oe())===null||M===void 0||M.remove(T)}));var g=function(M){var V;c=T.getContent(),(V=Oe())===null||V===void 0||V.remove(T),r=Ue(Ue(Ue({},r),M),ze),ot(function(){return R()})};return D.expose({rerender:g,getEditor:function(){return T}}),function(){return A?Ho(nt,f,m,e.tagName):qo(nt,f,m)}}});const Qo=["colspan"],Ko=h("strong",null,"E-Mail Content",-1),zo=["innerHTML"],Ct=ue({__name:"Communications",props:{hideHistory:{type:Boolean,default:!1},registration:{},showEditor:{type:Boolean}},emits:["close-editor"],setup(e,{emit:D}){const r=pe(),l=U([]),n=U({From:"",Subject:"",HTML:""}),d=U(""),_=U(""),m=U(""),T=U(!1),f=U([]),A=U([]),o=U([{key:"CreatedAt",title:"Date"},{key:"Subject",title:"Subject"},{key:"User.DisplayName",title:"Sender"},{key:"Status",title:"Status"}]),i=U([{key:"CreatedAt",order:"asc"}]);ie(n,R=>{m.value=R.From||m.value||"",_.value=R.Subject||_.value||"",d.value=R.HTML||d.value||""});const s=()=>{r.getRegistrationEmails(e.registration.RegistrationUUID).then(R=>{R&&(R.forEach(g=>{g.CreatedAt=Ia(new Date(g.CreatedAt||"")),g.Status=ja(g.Status),g.User||(g.User={ID:0,UserUUID:"",DisplayName:"System",Handle:"",Credentials:[],Additional:{FirstName:"",LastName:"",DOB:"",Email:""},Data:"",Groups:[],Tags:[]})}),A.value=R)})};s(),(()=>{r.getRegistrationEmailTemplates(e.registration.RegistrationUUID).then(R=>{R&&(l.value=R)})})();const K=({callback:R})=>{r.sendRegistrationEmail(e.registration.RegistrationUUID,m.value,_.value,d.value).then(g=>{g?R&&(R("Email Sent"),s(),setTimeout(()=>{T.value=!1},2e3)):R&&R("Not sent")}).catch(()=>{R&&R("Not sent")})};return(R,g)=>(u(),I(P,null,[R.showEditor?(u(),I(P,{key:0},[t(J,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Jt,{items:l.value,"item-title":"Subject","return-object":"",label:"Template","hide-details":"",modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=M=>n.value=M),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12"},{default:a(()=>[t(me,{modelValue:m.value,"onUpdate:modelValue":g[1]||(g[1]=M=>m.value=M),label:"From",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12"},{default:a(()=>[t(me,{modelValue:_.value,"onUpdate:modelValue":g[2]||(g[2]=M=>_.value=M),label:"Subject",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12"},{default:a(()=>[t(x(jo),{modelValue:d.value,"onUpdate:modelValue":g[3]||(g[3]=M=>d.value=M),"api-key":"g9sce3fktcgvk0i7sp96cahgyk4cos7q27es3ubnlal3xf3z"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Je,{onClick:g[4]||(g[4]=M=>D("close-editor")),label:"Close E-mail Editor",color:"secondary","prepend-icon":"mdi:mdi-window-close"})]),_:1}),t(N,{class:"text-right"},{default:a(()=>[t(Je,{onClick:K,label:"Send",color:"error"})]),_:1})]),_:1})],64)):q("",!0),A.value.length&&!R.hideHistory?(u(),G(Et,{key:1,class:"my-2"},{default:a(()=>[t(ft,null,{default:a(()=>[t(_t,null,{default:a(()=>[w(" Email History ")]),_:1}),t(At,null,{default:a(()=>[t(x(Tt),{items:A.value,headers:o.value,"show-expand":!0,"item-value":"EmailUUID",expanded:f.value,"onUpdate:expanded":g[5]||(g[5]=M=>f.value=M),"sort-by":i.value,"onUpdate:sortBy":g[6]||(g[6]=M=>i.value=M)},{"expanded-row":a(({columns:M,item:V})=>[h("tr",null,[h("td",{colspan:M.length},[Ko,h("div",{class:"communicationsViewEmailPreview",innerHTML:V.raw.HTML},null,8,zo)],8,Qo)])]),"footer.prepend":a(()=>[t(oe,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:s},{default:a(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const Wo=ue({__name:"StripeRefundPayment",props:_e({paymentTransaction:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["refunded"],["update:modelValue"]),setup(e,{emit:D}){const r=Fe(e,"modelValue"),l=pe(),n=U(!1),d=U("");let _=0;if(e.paymentTransaction.Data&&e.paymentTransaction.Data.PaymentIntent&&typeof e.paymentTransaction.Data.PaymentIntent=="object"){const i=e.paymentTransaction.Data.PaymentIntent;i&&(_=i.amount)}const m=U({Amount:_/100,Description:"",Reason:""}),T=U([{title:"Duplicate",value:"duplicate"},{title:"Fraudulent",value:"fraudulent"},{title:"Requested By Customer",value:"requested_by_customer"}]),f=U(!1);async function A(i){i.preventDefault(),f.value=!0,l.refundStripePayment(e.paymentTransaction.PaymentTransactionUUID,m.value).then(s=>{s?D("refunded",s):o("An unexpected error occurred.")}).catch(s=>{o("An error occurred processing the refund: "+s.toString())}),f.value=!1}const o=i=>{d.value=i,n.value=!0};return(i,s)=>(u(),G(we,{modelValue:r.value,"onUpdate:modelValue":s[7]||(s[7]=c=>r.value=c),title:"Refund a Stripe Payment",color:"blue-darken-4",persistent:""},{default:a(()=>[t(De,{class:"pa-0"},{default:a(()=>[t(Fa,{ref:"refundForm",id:"refund-form",onSubmit:s[4]||(s[4]=xt(c=>A(c),["prevent"]))},{default:a(()=>[t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:a(()=>[t(me,{modelValue:m.value.Amount,"onUpdate:modelValue":s[0]||(s[0]=c=>m.value.Amount=c),modelModifiers:{number:!0},label:"Amount",prefix:"£",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6",md:"8",lg:"9",xl:"10"},{default:a(()=>[t(se,{modelValue:m.value.Reason,"onUpdate:modelValue":s[1]||(s[1]=c=>m.value.Reason=c),modelModifiers:{number:!0},items:T.value,"item-title":"title","item-value":"value",label:"Stripe Refund Reason",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"12"},{default:a(()=>[t(me,{modelValue:m.value.Description,"onUpdate:modelValue":s[2]||(s[2]=c=>m.value.Description=c),modelModifiers:{number:!0},label:"Refund Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:a(()=>[t(N,{class:"text-right",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:a(()=>[t(oe,{color:"error",class:"w-100",onClick:s[3]||(s[3]=c=>r.value=!1)},{default:a(()=>[w("Cancel")]),_:1})]),_:1}),t(He),t(N,{class:"text-left",cols:"12",sm:"3",md:"2",lg:"2",xl:"1"},{default:a(()=>[t(oe,{type:"submit",color:"success",class:"w-100"},xe({default:a(()=>[w(" Issue Refund ")]),_:2},[f.value?{name:"prepend",fn:a(()=>[t(Ca,{size:"20",indeterminate:""})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1},512)]),_:1}),t(It,{modelValue:n.value,"onUpdate:modelValue":s[6]||(s[6]=c=>n.value=c)},{actions:a(()=>[t(oe,{variant:"text",onClick:s[5]||(s[5]=c=>n.value=!1)},{default:a(()=>[w(" Close ")]),_:1})]),default:a(()=>[w(b(d.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Jo=["colspan"],Xo=h("strong",null,"Details",-1),Zo=["innerHTML"],en=ue({__name:"PaymentTransactions",props:{canEdit:{type:Boolean},hideHistory:{type:Boolean},updated:{},registration:{},showEditor:{type:Boolean}},emits:["close-editor","change"],setup(e,{emit:D}){const r=e;let{hideHistory:l=!1,registration:n,showEditor:d}=r;const _=pe(),m=U([]),T=U([]),f=U([{key:"CreatedAt",title:"Date"},{key:"Type",title:"Type"},{key:"Source",title:"Source"},{key:"Description",title:"Description"},{key:"Admin",title:"Admin"},{key:"Amount",title:"Amount"},{key:"Controls",title:""}]),A=U(!1),o=U(),i=U(!1),s=U(""),c=U([{key:"CreatedAt",order:"asc"}]),K=()=>({PaymentTransactionUUID:he(),Amount:0,Data:{},Description:"",ID:0,RegistrationID:n.ID,RegistrationUUID:n.RegistrationUUID,Source:rt.PAYMENT_TRANSACTION_SOURCE_NULL,Type:We.PAYMENT_TRANSACTION_TYPE_NULL}),R=U(K()),{convertTransactions:g,getPaymentTransactionsDisplay:M}=St();ie(r,()=>{l=r.hideHistory,n=r.registration,d=r.showEditor,M(n.RegistrationUUID).then(z=>{T.value=z})});const V=()=>{M(n.RegistrationUUID).then(z=>{T.value=z})};V();const j=()=>{_.saveRegistrationPaymentTransaction(R.value).then(z=>{z&&(g(z.PaymentTransactions),R.value=K(),D("close-editor"),D("change"))})},ne=z=>{const E=T.value.find(S=>S.PaymentTransactionUUID===z);E&&(o.value=E.PaymentTransaction,A.value=!0)},Te=z=>{if(z)try{T.value=g(z.PaymentTransactions),o.value=void 0,A.value=!1,s.value="Refund Processed",i.value=!0,D("change")}catch(E){console.error(E)}};return(z,E)=>(u(),I(P,null,[x(d)?(u(),I(P,{key:0},[t(Na,null,{default:a(()=>[w(" Add Transaction ")]),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6"},{default:a(()=>[t(se,{items:x(ya),"item-title":"title","item-value":"value",label:"Transaction Type",clearable:!0,"hide-details":"",modelValue:R.value.Type,"onUpdate:modelValue":E[0]||(E[0]=S=>R.value.Type=S),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),t(N,{cols:"12",sm:"6"},{default:a(()=>[t(se,{items:x(ga),"item-title":"title","item-value":"value",label:"Source",clearable:!0,"hide-details":"",modelValue:R.value.Source,"onUpdate:modelValue":E[1]||(E[1]=S=>R.value.Source=S),variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"8",md:"10"},{default:a(()=>[t(me,{label:"Description","hide-details":"",modelValue:R.value.Description,"onUpdate:modelValue":E[2]||(E[2]=S=>R.value.Description=S),variant:"outlined"},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"4",md:"2"},{default:a(()=>[t(me,{label:"Amount","prepend-inner-icon":"mdi:mdi-currency-gbp","hide-details":"",modelValue:R.value.Amount,"onUpdate:modelValue":E[3]||(E[3]=S=>R.value.Amount=S),modelModifiers:{number:!0},variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"3",md:"2",lg:"1"},{default:a(()=>[t(oe,{class:"w-100",onClick:E[4]||(E[4]=S=>D("close-editor")),color:"warning"},{default:a(()=>[w("Cancel")]),_:1})]),_:1}),t(He),t(N,{cols:"12",sm:"6",md:"3",lg:"2",xl:"2"},{default:a(()=>[t(oe,{class:"w-100",onClick:j,color:"primary"},{default:a(()=>[w("Submit Transaction")]),_:1})]),_:1})]),_:1})],64)):q("",!0),T.value.length&&!x(l)?(u(),G(Et,{key:1,class:"my-2"},{default:a(()=>[t(ft,null,{default:a(()=>[t(_t,null,{default:a(()=>[w(" Transaction History ")]),_:1}),t(At,null,{default:a(()=>[t(x(Tt),{items:T.value,headers:f.value,"show-expand":!1,"item-value":"PaymentTransactionUUID",expanded:m.value,"onUpdate:expanded":E[5]||(E[5]=S=>m.value=S),"sort-by":c.value,"onUpdate:sortBy":E[6]||(E[6]=S=>c.value=S),class:"transactionTable"},{"item.Controls":a(({item:S})=>[z.canEdit&&S.raw.PaymentTransaction.Source===x(rt).PAYMENT_TRANSACTION_SOURCE_STRIPE&&S.raw.PaymentTransaction.Type===x(We).PAYMENT_TRANSACTION_TYPE_PAYMENT?(u(),G(oe,{key:0,icon:"mdi:mdi-credit-card-refund",variant:"text",size:"xs",onClick:L=>ne(S.key)},null,8,["onClick"])):q("",!0)]),"expanded-row":a(({columns:S,item:L})=>[h("tr",null,[h("td",{colspan:S.length},[Xo,h("div",{innerHTML:L.raw.HTML},null,8,Zo)],8,Jo)])]),"footer.prepend":a(()=>[t(oe,{"prepend-icon":"mdi:mdi-refresh",color:"primary",class:"mr-4",onClick:V},{default:a(()=>[w("Refresh")]),_:1})]),_:1},8,["items","headers","expanded","sort-by"]),A.value&&o.value?(u(),G(Wo,{key:0,modelValue:A.value,"onUpdate:modelValue":E[7]||(E[7]=S=>A.value=S),"payment-transaction":o.value,onRefunded:Te},null,8,["modelValue","payment-transaction"])):q("",!0),t(It,{modelValue:i.value,"onUpdate:modelValue":E[9]||(E[9]=S=>i.value=S)},{actions:a(()=>[t(oe,{variant:"text",onClick:E[8]||(E[8]=S=>i.value=!1)},{default:a(()=>[w(" Close ")]),_:1})]),default:a(()=>[w(b(s.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):q("",!0)],64))}});const tn=(e=void 0,D)=>e===void 0?!1:$a(e,wa.GROUP_TYPE_CONVENTION,D.ConventionUUID,D).EditPaymentTransactions,qe=e=>(Ht("data-v-a5bd0dd4"),e=e(),qt(),e),an={class:"mb-4"},on={class:"v-row"},nn={key:0,class:"v-col v-col-10 py-1 v-row mx-0 pl-0"},ln={class:"v-col v-col-12 v-col-sm-4 v-col-md-3 font-weight-bold pb-0 pr-0"},sn={class:"v-col v-col-12 v-col-sm-8 v-col-md-9 font-italic pt-0 pt-sm-3 pb-sm-0 pl-sm-0"},un={class:"v-col v-col-2 align-self-end text-right py-1 text-no-wrap"},rn=qe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Total Charges ",-1)),dn={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},mn=qe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Applied Total ",-1)),cn={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},vn=qe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold"}," Currently Paid ",-1)),Un={class:"v-col v-col-3 align-self-end text-right py-1 text-no-wrap"},_n=qe(()=>h("dt",{class:"v-col v-col-9 py-1 font-weight-bold totals"}," Balance ",-1)),An={class:"v-col v-col-3 align-self-end text-right py-1 totals text-no-wrap"},Tn=ue({__name:"PaymentActions",props:_e({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["update:registration"],["update:modelValue"]),setup(e,{emit:D}){const r=e,l=Fe(e,"modelValue"),{registration:n}=r,d=U(!1),_=U(!1),m=U(),T=U([]),f=U(new Date().getTime()),A=U(!1),o=Ze(r,D,void 0,void 0,"registration"),i=U(Ae(o.value));ie(o,()=>{i.value=Ae(o.value)});const s=pe();s.getConvention(n.ConventionUUID).then(g=>{g&&(A.value=tn(Ba(),g))});const c=()=>{s.generateRegistrationCharges(n.RegistrationUUID,!1).then(g=>{g&&(T.value=g.PaymentTransactions,m.value=g.Registration,f.value=new Date().getTime())}).catch(()=>{})};c();const K=()=>{s.generateRegistrationCharges(n.RegistrationUUID,!0).then(g=>{g&&(T.value=g.PaymentTransactions,m.value=g.Registration,f.value=new Date().getTime())})},{totalCharges:R}=St();return(g,M)=>(u(),G(we,{modelValue:l.value,"onUpdate:modelValue":M[3]||(M[3]=V=>l.value=V),title:g.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:a(()=>[t(De,{class:"pa-0 mx-0",fluid:!0},{default:a(()=>[m.value?(u(),I(P,{key:0},[h("h3",an,"#"+b(m.value.Reference)+" "+b(m.value.User.DisplayName),1),h("dl",on,[(u(!0),I(P,null,te(T.value,V=>(u(),I(P,{key:V.PaymentTransactionUUID},[V.Type===x(We).PAYMENT_TRANSACTION_TYPE_CHARGE?(u(),I("dt",nn,[h("div",ln,b(V.Description.split(":")[0])+": ",1),h("div",sn,b(V.Description.split(":")[1]),1)])):q("",!0),h("dd",un," £"+b(V.Amount),1)],64))),128)),rn,h("dd",dn," £"+b(x(R)(T.value)),1),mn,h("dd",cn," £"+b(m.value.Total),1),vn,h("dd",Un," £"+b(m.value.Paid),1),_n,h("dd",An," £"+b(m.value.Total-m.value.Paid),1)]),t(J,{class:"flex-row-reverse"},{default:a(()=>[t(N,{class:"text-right"},{default:a(()=>[t(oe,{color:"primary",onClick:K},{default:a(()=>[w("Apply Charges")]),_:1})]),_:1}),!_.value&&A.value?(u(),G(N,{key:0},{default:a(()=>[t(oe,{color:"secondary",onClick:M[0]||(M[0]=V=>_.value=!0)},{default:a(()=>[w("Transaction Entry")]),_:1})]),_:1})):q("",!0)]),_:1})],64)):q("",!0),t(en,{"can-edit":A.value,registration:x(n),"show-editor":_.value,onCloseEditor:M[1]||(M[1]=V=>_.value=!1),updated:f.value,onChange:c},null,8,["can-edit","registration","show-editor","updated"]),t(Ct,{registration:x(n),"show-editor":d.value,onCloseEditor:M[2]||(M[2]=V=>d.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const fn=Xe(Tn,[["__scopeId","data-v-a5bd0dd4"]]),En=ue({__name:"RegistrationActions",props:_e({forms:{},registration:{},title:{}},{modelValue:{type:Boolean,required:!0}}),emits:_e(["update:registration"],["update:modelValue"]),setup(e,{emit:D}){const r=e,l=Fe(e,"modelValue"),n=U(!1),d=Ze(r,D,void 0,void 0,"registration"),_=U(Ae(d.value));ie(d,()=>{_.value=Ae(d.value)});const m=pe(),T=(f,A)=>{const o=_.value.Submissions.find(i=>i.SubmissionUUID==A);if(!o){f&&f("Submission not found");return}m.setSubmissionStatus(A,o.Status).then(i=>{i?(_.value.Submissions.forEach((s,c)=>{d.value.Submissions[c].Status=s.Status}),f&&f("Status Saved")):f&&f("Status not saved")}).catch(()=>{f&&f("Status not saved")})};return(f,A)=>(u(),G(we,{modelValue:l.value,"onUpdate:modelValue":A[2]||(A[2]=o=>l.value=o),title:f.title,"show-close-action":!0,color:"primary","close-action-label":"Close",persistent:!0,"retain-focus":!1,scrollable:!0,fullscreen:""},{default:a(()=>[t(De,{class:"pa-0 mx-0",fluid:!0},{default:a(()=>[h("h3",null,"#"+b(f.registration.Reference)+" "+b(f.registration.User.DisplayName),1),t(Ye,null,{default:a(()=>[(u(!0),I(P,null,te(_.value.Submissions,o=>(u(),G(Le,{key:o.SubmissionUUID,class:"pa-0"},{default:a(()=>[t(J,{class:"py-2 align-center"},{default:a(()=>[t(N,{cols:"8"},{default:a(()=>{var i;return[t(se,{modelValue:o.Status,"onUpdate:modelValue":s=>o.Status=s,items:x(dt),"item-text":"title","item-value":"value",variant:"outlined","hide-details":"",label:((i=f.forms.find(s=>s.FormUUID==o.FormUUID))==null?void 0:i.Name)||""},{selection:a(()=>[t(Da,{class:"mr-4"},{default:a(()=>{var s;return[w(b((s=x(dt).find(c=>c.value===o.Status))==null?void 0:s.icon),1)]}),_:2},1024),w(" "+b(x(pt)(o.Status)),1)]),item:a(({item:s,props:{onClick:c}})=>[t(Le,{title:s.title,"prepend-icon":s.raw.icon,onClick:c},null,8,["title","prepend-icon","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label"])]}),_:2},1024),t(N,{cols:"4"},{default:a(()=>[t(Je,{title:"Save","prepend-icon":"mdi:mdi-content-save",color:"warning",onClick:i=>T(i.callback,o.SubmissionUUID)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(J,null,{default:a(()=>[t(N,{cols:"12"},{default:a(()=>[t(oe,{"prepend-icon":"mdi:mdi-email",color:"primary",onClick:A[0]||(A[0]=o=>n.value=!0)},{default:a(()=>[w("Prepare Email")]),_:1})]),_:1})]),_:1}),t(Ct,{registration:f.registration,"show-editor":n.value,onCloseEditor:A[1]||(A[1]=o=>n.value=!1)},null,8,["registration","show-editor"])]),_:1})]),_:1},8,["modelValue","title"]))}});const tl=ue({__name:"RegistrationsView",emits:["pageTitle"],setup(e,{emit:D}){var et;const r=ba();D("pageTitle","Registration Manager");const l=jt(),n=Qt(),d=U(!0);let _=((et=l.params.convention)==null?void 0:et.toString())||"";const m=U({ID:0,ConventionUUID:he(),OrganisationID:0,OrganisationUUID:Ke,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),T=pe(),f=U({ID:0,AdminLayoutUUID:he(),ConventionID:m.value.ID,ConventionUUID:m.value.ConventionUUID,Name:"Registration Table",Type:yt.ADMIN_LAYOUT_TABLE,Panels:[]}),A=U([]),o=U([]),i=U([]),s=U([]),c=U([]),K=U(1),R=U(10),g=U([]),M=U(0),V=U(!1),j=U(""),ne=U(""),Te=U(""),z=U(""),E=U(""),S=U(""),L=U([]),C=U([]),B=U([]),X=U([]),ae=U([]),W=U([]),ce=U(0),re=U(),Re=U(!1),Ie=U(!1);ie(j,v=>{const p=c.value.find(y=>y.uuid===v);if(p){const y=p.headers.find(O=>O.defaultSort===!0);y&&(g.value=[{key:y.key,order:"asc"}],L.value=[{key:y.key,order:"asc"}])}}),ie(ce,v=>{v===7&&be()}),ie(E,()=>{ne.value=Date.now().toString()}),ie(S,()=>{ne.value=Date.now().toString()});const ye=()=>{A.value=[],i.value=[],c.value=[];try{T.getConventionAdminLayoutByName(m.value.ConventionUUID,"Registration Table").then(v=>{ce.value+=1,v?f.value=v:(f.value.ConventionID=m.value.ID,f.value.ConventionUUID=m.value.ConventionUUID)})}catch{f.value.ConventionID=m.value.ID,f.value.ConventionUUID=m.value.ConventionUUID}try{T.getConventionForms(m.value.ConventionUUID).then(v=>{ce.value+=1,v&&(A.value=v)})}catch{}try{T.getConventionAccommodation(m.value.ConventionUUID).then(v=>{ce.value+=1,v&&(C.value=v)})}catch{}try{T.getConventionVenues(m.value.ConventionUUID).then(v=>{ce.value+=1,v&&(W.value=v)})}catch{}try{T.getConventionExtras(m.value.ConventionUUID).then(v=>{ce.value+=1,v&&(B.value=v)})}catch{}try{T.getConventionInterests(m.value.ConventionUUID).then(v=>{ce.value+=1,v&&(X.value=v)})}catch{}try{T.getConventionTickets(m.value.ConventionUUID).then(v=>{ce.value+=1,v&&(ae.value=v)})}catch{}try{T.getConventionGroups(m.value.ConventionUUID).then(v=>{v&&(o.value=v.sort((p,y)=>p.Name.localeCompare(y.Name)))})}catch{}try{T.getConventionTags(m.value.ConventionUUID).then(v=>{v&&(s.value=v.sort((p,y)=>p.Title.localeCompare(y.Title)).map(p=>(p.Title=`${p.Title} [${p.Key}]`,p)))})}catch{}},Ve=({page:v,itemsPerPage:p,sortBy:y})=>{d.value=!0,K.value=v,g.value=y;const O=c.value.find(Z=>Z.uuid==j.value),ve=O==null?void 0:O.layout.Items;let le="",tt="";if(y&&ve&&y.length>=1){const Z=ve.find(ke=>ke.LayoutItemUUID==y[0].key);switch(tt=y[0].order||"asc",Z==null?void 0:Z.MetaField){case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_BADGE_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_DEALER_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_FORM:le="submission.status";break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:le="reference";break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:le="created";break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:le="submission.status";break}switch(Z==null?void 0:Z.UserField){case ee.USER_DATA_SOURCE_DISPLAY_NAME:le="user.display_name";break;case ee.USER_DATA_SOURCE_EMAIL:le="user.email";break;case ee.USER_DATA_SOURCE_FIRST_NAME:le="user.firstname";break;case ee.USER_DATA_SOURCE_HANDLE:le="user.handle";break;case ee.USER_DATA_SOURCE_LAST_NAME:le="user.lastname";break}}try{const Z={Direction:tt,Limit:p,Offset:(v-1)*p,Order:le};O&&O.layout.RequiredRegistrationTags.length>0&&(Z.PanelUUID=O==null?void 0:O.layout.LayoutPanelUUID),(O==null?void 0:O.layout.RequiredFormType)===Se.FORM_TYPE_ACCOMMODATION&&(Z.Accommodation=!0),(O==null?void 0:O.layout.RequiredFormType)===Se.FORM_TYPE_BADGE&&(Z.Badge=!0),(O==null?void 0:O.layout.RequiredFormType)===Se.FORM_TYPE_DEALER&&(Z.Dealer=!0),(O==null?void 0:O.layout.RequiredFormType)===Se.FORM_TYPE_REGISTRATION&&(Z.Registration=!0),Z.GroupUUID=E.value||Ke,Z.TagUUID=S.value||Ke,Z.Email=z.value,Z.Reference=Te.value,T.searchConventionRegistrations(m.value.ConventionUUID,Z).then(ke=>{ke&&(M.value=ke.Total,i.value=ke.Registrations,c.value.forEach(je=>{const bt=je.layout;je.items=i.value.map($=>{const Be=[];let fe;$.Leader?fe=$:fe=$.Primary,Be.push({Name:fe.User.DisplayName,UUID:fe.UserUUID,UserUUID:fe.User.UserUUID,IsLeader:!0,Reference:fe.Reference,Paid:fe.Paid,Total:fe.Total}),Be.push(...fe.Members.map(Ee=>({Name:Ee.User.DisplayName,UUID:Ee.UserUUID,UserUUID:Ee.User.UserUUID,IsLeader:!1,Reference:Ee.Reference,Paid:Ee.Paid,Total:Ee.Total})));const H={};return je.headers.forEach(Ee=>{var at;const F=bt.Items.find(Ne=>Ne.LayoutItemUUID===Ee.key);if(F){if(F.SourceType==="LAYOUT_ITEM_SOURCE_FORM"&&F.SectionField)$.Submissions.forEach(Ne=>{const Me=Ne.Data.find(k=>k.SectionFieldUUID===F.SectionFieldUUID);if(Me){Ee.type===Xt.ACCOMMODATION?H[F.LayoutItemUUID]={Data:Me.Data,Registration:$}:H[F.LayoutItemUUID]=Me.Data;return}});else if(F.SourceType==="LAYOUT_ITEM_SOURCE_USER"&&F.UserField)switch(F.UserField){case ee.USER_DATA_SOURCE_AVATAR:H[F.LayoutItemUUID]=r.GetProfileImageURL($.UserUUID);break;case ee.USER_DATA_SOURCE_DISPLAY_NAME:H[F.LayoutItemUUID]=$.User.DisplayName;break;case ee.USER_DATA_SOURCE_EMAIL:H[F.LayoutItemUUID]=$.User.Additional.Email;break;case ee.USER_DATA_SOURCE_HANDLE:H[F.LayoutItemUUID]=$.User.Handle;break;case ee.USER_DATA_SOURCE_DATE_OF_BIRTH:H[F.LayoutItemUUID]=$.User.Additional.DOB;break;case ee.USER_DATA_SOURCE_FIRST_NAME:H[F.LayoutItemUUID]=$.User.Additional.FirstName;break;case ee.USER_DATA_SOURCE_LAST_NAME:H[F.LayoutItemUUID]=$.User.Additional.LastName;break;case ee.USER_DATA_SOURCE_TELEGRAM:H[F.LayoutItemUUID]="";break}else if(F.SourceType==="LAYOUT_ITEM_SOURCE_META"&&F.MetaField){const Ne=(at=A.value.find(k=>k.Type===Se.FORM_TYPE_REGISTRATION))==null?void 0:at.FormUUID,Me=$.Submissions.find(k=>k.FormUUID===Ne);switch(F.MetaField){case Q.META_DATA_SOURCE_REGISTRATION_ACTIONS:H[F.LayoutItemUUID]=$;break;case Q.META_DATA_SOURCE_REGISTRATION_GROUP:H[F.LayoutItemUUID]=Be;break;case Q.META_DATA_SOURCE_REGISTRATION_REFERENCE:H[F.LayoutItemUUID]=$.Reference;break;case Q.META_DATA_SOURCE_SUBMISSION_DATE:if(Me){const k=new Date(Me.CreatedAt||"");H[F.LayoutItemUUID]=`${k.getFullYear()}-${(k.getMonth()+1).toString().padStart(2,"0")}-${k.getDate().toString().padStart(2,"0")} ${k.getHours().toString().padStart(2,"0")}:${k.getMinutes().toString().padStart(2,"0")}:${k.getSeconds().toString().padStart(2,"0")}`}else{const k=new Date($.CreatedAt||"");H[F.LayoutItemUUID]=`${k.getFullYear()}-${(k.getMonth()+1).toString().padStart(2,"0")}-${k.getDate().toString().padStart(2,"0")} ${k.getHours().toString().padStart(2,"0")}:${k.getMinutes().toString().padStart(2,"0")}:${k.getSeconds().toString().padStart(2,"0")}`}break;case Q.META_DATA_SOURCE_ACCOMMODATION_FORM:H[F.LayoutItemUUID]=$.Submissions.map(k=>{const Y=A.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:Y==null?void 0:Y.Heading,Form:Y,Submission:k,Registration:$}}).filter(k=>{var Y;return((Y=k.Form)==null?void 0:Y.Type)===Se.FORM_TYPE_ACCOMMODATION});break;case Q.META_DATA_SOURCE_BADGE_FORM:H[F.LayoutItemUUID]=$.Submissions.map(k=>{const Y=A.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:Y==null?void 0:Y.Heading,Form:Y,Submission:k,Registration:$}}).filter(k=>{var Y;return((Y=k.Form)==null?void 0:Y.Type)===Se.FORM_TYPE_BADGE});break;case Q.META_DATA_SOURCE_DEALER_FORM:H[F.LayoutItemUUID]=$.Submissions.map(k=>{const Y=A.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:Y==null?void 0:Y.Heading,Form:Y,Submission:k,Registration:$}}).filter(k=>{var Y;return((Y=k.Form)==null?void 0:Y.Type)===Se.FORM_TYPE_DEALER});break;case Q.META_DATA_SOURCE_PAYMENT_STATUS:if($.Paid===0&&$.Total)H[F.LayoutItemUUID]="REQUIRED";else if($.Total>$.Paid)H[F.LayoutItemUUID]="ADDITIONAL_REQUIRED";else{const k=Be.find(Y=>Y.Paid===0&&(Y.Total||0)>0);if(k){$.Total===0&&k.Total===0?H[F.LayoutItemUUID]="NOT_REQUIRED":$.Total===0&&k.Total||$.Total>0&&k.Total===0?H[F.LayoutItemUUID]="MISSING_REQUIRED":$.Paid>=$.Total?H[F.LayoutItemUUID]="AWAITING_PARTNER":H[F.LayoutItemUUID]="ALL_REQUIRED";break}else $.Total===0?H[F.LayoutItemUUID]="NOT_REQUIRED":H[F.LayoutItemUUID]="COMPLETE"}break;case Q.META_DATA_SOURCE_SUBMISSION_STATUS:Pa($.Submissions,A.value),H[F.LayoutItemUUID]=$.Submissions.map(k=>{const Y=A.value.find(ge=>ge.FormUUID===k.FormUUID);return{Heading:Y==null?void 0:Y.Heading,Form:Y,Submission:k,Registration:$}});break}}}}),H})}),d.value=!1)})}catch{}},$e=v=>{V.value=!1,v&&(f.value=v,be())},be=()=>{f.value.Panels.forEach(v=>{v.Items.forEach(p=>{(p.SectionField==null||p.SectionField.Field==null)&&A.value.find(y=>{y.Sections.find(O=>{if(O.Fields){const ve=O.Fields.find(le=>le.SectionFieldUUID===p.SectionFieldUUID);if(ve)return p.SectionField=ve,!0}})})})}),f.value.Panels.length>0&&(c.value=[],f.value.Panels.forEach(v=>{const p={uuid:he(),order:v.Order,name:v.Name,headers:[],items:[],layout:v};v.Items.sort((y,O)=>y.Order>O.Order?1:y.Order==O.Order?0:-1),p.headers=v.Items.map(y=>{var O,ve;return{key:y.LayoutItemUUID,title:y.Label||((ve=(O=y.SectionField)==null?void 0:O.Field)==null?void 0:ve.Label)||"",align:y.Align==="end"?"end":"start",sortable:Mt(y),type:Ot(y),defaultSort:y.DefaultSort}}),c.value.push(p)}),c.value=c.value.sort((v,p)=>v.order>p.order?1:v.order==p.order?0:-1)),(j.value==null||j.value=="")&&c.value.length>0&&(j.value=c.value[0].uuid)};_?T.getConvention(_).then(v=>{v&&(m.value=v,f.value.ConventionID=m.value.ID,f.value.ConventionUUID=m.value.ConventionUUID,ye())}).catch(()=>{n.push("/")}):n.push("/");const Ot=v=>{var p,y;if(v.SourceType===Pe.LAYOUT_ITEM_SOURCE_META)return`${v.SourceType}.${v.MetaField}`;if(v.SourceType===Pe.LAYOUT_ITEM_SOURCE_FORM)return(y=(p=v.SectionField)==null?void 0:p.Field)==null?void 0:y.Type;if(v.SourceType===Pe.LAYOUT_ITEM_SOURCE_USER)return`${v.SourceType}.${v.UserField}`},Mt=v=>{const p=[Q.META_DATA_SOURCE_ACCOMMODATION_FORM,Q.META_DATA_SOURCE_BADGE_FORM,Q.META_DATA_SOURCE_DEALER_FORM,Q.META_DATA_SOURCE_REGISTRATION_FORM,Q.META_DATA_SOURCE_REGISTRATION_REFERENCE,Q.META_DATA_SOURCE_SUBMISSION_DATE,Q.META_DATA_SOURCE_SUBMISSION_STATUS],y=[ee.USER_DATA_SOURCE_DISPLAY_NAME,ee.USER_DATA_SOURCE_EMAIL,ee.USER_DATA_SOURCE_HANDLE,ee.USER_DATA_SOURCE_DATE_OF_BIRTH,ee.USER_DATA_SOURCE_FIRST_NAME,ee.USER_DATA_SOURCE_LAST_NAME];return p.includes(v.MetaField)||y.includes(v.UserField)},ht=v=>{re.value=v,Re.value=!0},Vt=v=>{re.value=v,Ie.value=!0};return ie(Re,v=>{v||(re.value=void 0)}),ie(Ie,v=>{v||(re.value=void 0)}),(v,p)=>(u(),G(Ga,null,{default:a(()=>[t(Dt,{color:"blue-darken-4"},{default:a(()=>[t(Ta,{modelValue:j.value,"onUpdate:modelValue":p[0]||(p[0]=y=>j.value=y),"show-arrows":""},{default:a(()=>[(u(!0),I(P,null,te(c.value,y=>(u(),G(fa,{key:y.uuid,value:y.uuid},{default:a(()=>[w(b(y.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(He),t(oe,{icon:"mdi:mdi-cog-outline",onClick:p[1]||(p[1]=y=>V.value=!0)})]),_:1}),t(Sa,{modelValue:j.value,"onUpdate:modelValue":p[13]||(p[13]=y=>j.value=y),disabled:!0},{default:a(()=>[(u(!0),I(P,null,te(c.value,y=>(u(),G(Ea,{key:y.uuid,value:y.uuid},{default:a(()=>[y.uuid===j.value?(u(),G(Rt,{key:0,class:"pa-2"},{default:a(()=>[t(x(Ka),{"items-per-page":R.value,"onUpdate:itemsPerPage":p[11]||(p[11]=O=>R.value=O),"sort-by":L.value,"onUpdate:sortBy":p[12]||(p[12]=O=>L.value=O),headers:y.headers,"items-length":M.value,items:y.items,"item-value":"LayoutItemUUID",loading:d.value,search:ne.value,"onUpdate:options":Ve},xe({top:a(()=>[t(De,null,{default:a(()=>[t(J,null,{default:a(()=>[t(N,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[t(me,{modelValue:Te.value,"onUpdate:modelValue":p[2]||(p[2]=O=>Te.value=O),label:"Search by Badge",clearable:!0,"hide-details":"","onClick:clear":p[3]||(p[3]=O=>ne.value=Date.now().toString()),onInput:p[4]||(p[4]=O=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[t(me,{modelValue:z.value,"onUpdate:modelValue":p[5]||(p[5]=O=>z.value=O),label:"Search By Email",clearable:!0,"hide-details":"","onClick:clear":p[6]||(p[6]=O=>ne.value=Date.now().toString()),onInput:p[7]||(p[7]=O=>ne.value=Date.now().toString())},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[t(se,{modelValue:E.value,"onUpdate:modelValue":p[8]||(p[8]=O=>E.value=O),label:"Search By Group",clearable:!0,"hide-details":"",items:o.value,"item-value":"GroupUUID","item-title":"Name"},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"12",sm:"6",lg:"3"},{default:a(()=>[t(se,{modelValue:S.value,"onUpdate:modelValue":p[9]||(p[9]=O=>S.value=O),label:"Search By Tag",clearable:!0,"hide-details":"",items:s.value,"item-value":"TagUUID","item-title":"Title"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:2},[te(y.headers,O=>({name:`item.${O.key}`,fn:a(({item:ve})=>[t(Vo,{header:O,item:ve,accommodations:C.value,convention:m.value,extras:B.value,forms:A.value,interests:X.value,tickets:ae.value,venues:W.value,onOpenActions:ht,onOpenPayments:Vt,onReload:p[10]||(p[10]=le=>Ve({page:K.value,itemsPerPage:R.value,sortBy:g.value}))},null,8,["header","item","accommodations","convention","extras","forms","interests","tickets","venues"])])}))]),1032,["items-per-page","sort-by","headers","items-length","items","loading","search"])]),_:2},1024)):q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),V.value?(u(),G(za,{key:0,title:"Edit Layout",modelValue:V.value,"onUpdate:modelValue":p[14]||(p[14]=y=>V.value=y),layout:f.value,onSave:$e},null,8,["modelValue","layout"])):q("",!0),re.value?(u(),I(P,{key:1},[Re.value?(u(),G(En,{key:0,modelValue:Re.value,"onUpdate:modelValue":p[15]||(p[15]=y=>Re.value=y),registration:re.value,"onUpdate:registration":p[16]||(p[16]=y=>re.value=y),accommodations:C.value,convention:m.value,extras:B.value,forms:A.value,interests:X.value,tickets:ae.value,title:"Registration Status & Communications",venues:W.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):Ie.value?(u(),G(fn,{key:1,modelValue:Ie.value,"onUpdate:modelValue":p[17]||(p[17]=y=>Ie.value=y),registration:re.value,"onUpdate:registration":p[18]||(p[18]=y=>re.value=y),accommodations:C.value,convention:m.value,extras:B.value,forms:A.value,interests:X.value,tickets:ae.value,title:"Registration Payments",venues:W.value},null,8,["modelValue","registration","accommodations","convention","extras","forms","interests","tickets","venues"])):q("",!0)],64)):q("",!0)]),_:1}))}});export{tl as default};
