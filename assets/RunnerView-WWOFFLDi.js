import{u as I,m as V,A as N,_ as A}from"./useTokenManager-AyXw1I83.js";import{i as D,V as L,r as n,b as S,n as R,q as g,v as c,f as U,x,A as T,P as O,U as E}from"./index-EEtx7Vrm.js";import{L as M}from"./logout-5QY3pjqc.js";import{a as P,V as w}from"./VRow-YDG6XXxI.js";import{V as B}from"./VBtn-Sbp5vS44.js";import{a as G}from"./VContainer-JlpwwXyg.js";import{a as J}from"./VTable-25tTC2_P.js";import"./VCheckboxBtn-ypmw1sLs.js";import"./VTextField-Vd7g3yoi.js";import"./forwardRefs-27fZV326.js";import"./VAvatar-xxVHRvdu.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-Hzj-s4D4.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-fYnHThMU.js";import"./scopeId-yKB9fHyC.js";import"./createSimpleFunctional-yF5TB9Pi.js";import"./VDialog-0gqYdAGs.js";import"./VToolbar-uAvDC6ck.js";import"./VCard-dBb5CPLZ.js";import"./useDisplayTransactions-eit28dSr.js";import"./VList-pit2wmzO.js";import"./VDivider-b9Uv_N1N.js";import"./VSelect-7BoZVE3K.js";import"./VChip-7U7aVSJK.js";import"./userData-h3TA9gCy.js";import"./canEditRegistrations-A1ez9bSf.js";import"./group-7fhbY6WJ.js";import"./canDo-yWCfI_4r.js";import"./nil-rxyd0N8M.js";import"./VAutocomplete-_0XIW6G6.js";import"./form-0fJbSFPv.js";import"./submission-40fey8Hx.js";import"./v4-yQnnJER4.js";import"./VDataTable-Vnl6p62_.js";import"./DeleteDialog.vue_vue_type_script_setup_true_lang-haVpZ8Tk.js";import"./VTextarea-uSi93-6o.js";import"./VForm-_XDSLKg8.js";import"./VNavigationDrawer-yxgzzFhp.js";const $=D({__name:"RunnerSocket",emits:["data","ready","updating","updated"],setup(k,{emit:y}){const C=O(),u=L(),s=y,i=n(),p=n(),d=n(),r=n(!1),o=I({mode:"host",wsUri:C.getRunnerSocketURL()}),v=V();o.on("authenticated",()=>{r.value=!0,f()}),o.on("auth_failed",()=>{r.value=!1}),o.on("open",()=>{const t=v.getTokenByService("GrazeAPI");o.send(`AUTH ${t==null?void 0:t.AccessToken}`)}),o.on("convention_data",t=>{if(!t)return;const e=t;i.value=e.Convention,s("updated",e),s("ready")}),o.on("joined",()=>{const t={Command:"GET_CURRENT_REGISTRATION",Params:new Map,Data:""};o.JSON(t)}),o.on("runner_data",t=>{if(!t)return;const e=t;if(!(!e.RunnerLayout||!e.Registration)){if(s("data",e),p.value=e.RunnerLayout,d.value=e.Registration,!i.value||e.RunnerLayout.ConventionUUID!==i.value.ConventionUUID){s("updating"),m(e.RunnerLayout.ConventionUUID);return}s("ready")}});const f=()=>{const t={Key:u.params.session||"",Mode:"runner",UserUUID:u.params.user||""},e={Command:"SET_MODE",Params:new Map,Data:JSON.stringify(t)};o.JSON(e)},m=t=>{const a={Command:"GET_CONVENTION_DATA",Params:new Map,Data:JSON.stringify({ConventionUUID:t})};o.JSON(a)};S(()=>{o.destroy()});const _=()=>{M(),E().push("/")};return(t,e)=>r.value?(R(),g(G,{key:0,fluid:!0},{default:c(()=>[U(w,null,{default:c(()=>[U(P,{class:"text-center"},{default:c(()=>[U(B,{"prepend-icon":"mdi:mdi-link-variant-remove",variant:"flat",color:"error",onClick:_},{default:c(()=>[x(" Disconnect ")]),_:1})]),_:1})]),_:1})]),_:1})):T("",!0)}}),ke=D({__name:"RunnerView",emits:["pageTitle"],setup(k,{emit:y}){y("pageTitle","Registration Runner");const u=n([]),s=n(),i=n([]),p=n([]),d=n([]),r=n({ID:0,AdminLayoutUUID:"",ConventionID:0,ConventionUUID:"",Name:"",RunnerLayoutUUID:"",Type:N.ADMIN_LAYOUT_PANELS,Panels:[]}),o=n(),v=n([]),f=n([]),m=n(!1),_=e=>{r.value=e.RunnerLayout,o.value=e.Registration},t=e=>{u.value=e.Accommodations,s.value=e.Convention,i.value=e.Extras,p.value=e.Forms,d.value=e.Interests,v.value=e.Tickets,f.value=e.Venues,r.value&&(m.value=!0)};return(e,a)=>(R(),g(J,null,{default:c(()=>[r.value&&s.value&&o.value?(R(),g(A,{key:0,convention:s.value,tickets:v.value,accommodations:u.value,extras:i.value,venues:f.value,interests:d.value,forms:p.value,layout:r.value,"onUpdate:layout":a[0]||(a[0]=l=>r.value=l),modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=l=>o.value=l)},null,8,["convention","tickets","accommodations","extras","venues","interests","forms","layout","modelValue"])):T("",!0),U($,{onData:_,onReady:a[2]||(a[2]=l=>m.value=!0),onUpdating:a[3]||(a[3]=l=>m.value=!1),onUpdated:t})]),_:1}))}});export{ke as default};
