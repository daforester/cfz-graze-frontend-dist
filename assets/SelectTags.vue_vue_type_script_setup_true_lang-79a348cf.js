import{s as I}from"./index-ba0d422e.js";import{u as O}from"./useGrazeAPI-b16c93a6.js";import{v as $}from"./v4-a960c1f4.js";import{V as D,a as A}from"./VBtn-5721e5b3.js";import{V as x,b as E}from"./VToolbar-baa0422f.js";import{V as F}from"./VSpacer-6d820e44.js";import{V as M}from"./VSheet-139e4d0c.js";import{V as J}from"./VContainer-6c04e36e.js";import{a as P,V as h}from"./VRow-04b1b10c.js";import{V as y}from"./VTextField-81f8a351.js";import{c as q,e as z}from"./VCard-2aaeb758.js";import{d as w,y as f,o as B,b as G,w as s,c as a,e as T,L as C,X as k,Y as R,h as X,k as Y,N as H,F as Q,f as L}from"./index-03259342.js";import{V as W}from"./VAutocomplete-1d926787.js";import{V as Z}from"./VDialog-519f20f5.js";import{a as _,b as ee}from"./VList-9f752953.js";const N="00000000-0000-0000-0000-000000000000",ae=w({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(n,{emit:c}){const u=f(""),t=f("");typeof n.convention=="object"?(u.value=n.convention.ConventionUUID,t.value=n.convention.OrganisationUUID):u.value=n.convention||"",typeof n.organisation=="object"?t.value=n.organisation.OrganisationUUID:t.value.length===0&&(t.value=n.organisation||"");const v=f({ID:0,TagUUID:$(),ConventionID:0,ConventionUUID:u.value||N,OrganisationID:0,OrganisationUUID:t.value||N,Title:"",Key:""}),g=O(),p=()=>{g.saveTag(v.value).then(d=>{d&&(v.value=d,c("save",v.value),c("close"))})};return(d,i)=>(B(),G(z,null,{default:s(()=>[a(E,{dark:"",color:"primary"},{default:s(()=>[a(D,{icon:"",dark:"",onClick:i[0]||(i[0]=m=>c("close"))},{default:s(()=>[a(A,null,{default:s(()=>[T("mdi:mdi-close")]),_:1})]),_:1}),a(x,null,{default:s(()=>[T("Add Tag")]),_:1}),a(F),a(M,null,{default:s(()=>[a(D,{variant:"text",onClick:p},{default:s(()=>[T(" Save ")]),_:1})]),_:1})]),_:1}),a(q,null,{default:s(()=>[a(J,{fluid:""},{default:s(()=>[a(P,null,{default:s(()=>[a(h,{cols:"12"},{default:s(()=>[a(y,{label:C(I).formLabelDisplayName,type:"text",variant:"outlined",modelValue:v.value.Title,"onUpdate:modelValue":i[1]||(i[1]=m=>v.value.Title=m)},null,8,["label","modelValue"])]),_:1}),a(h,{cols:"12"},{default:s(()=>[a(y,{label:C(I).formLabelTagKey,type:"text",variant:"outlined",modelValue:v.value.Key,"onUpdate:modelValue":i[2]||(i[2]=m=>v.value.Key=m)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),le=L("br",null,null,-1),oe=L("br",null,null,-1),Te=w({__name:"SelectTags",props:k({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{}},{modelValue:{required:!0}}),emits:k(["change"],["update:modelValue"]),setup(n,{emit:c}){const u=R(n,"modelValue"),t=f([]),v=O(),g=f([]),p=f([]),d=f(""),i=f(""),m=f(0),V=X(()=>[...g.value,...p.value].map(l=>({title:l.Title,value:t.value.find(e=>e.TagUUID===l.TagUUID)||l})));typeof n.convention=="object"?(d.value=n.convention.ConventionUUID,i.value=n.convention.OrganisationUUID):d.value=n.convention||"",typeof n.organisation=="object"?i.value=n.organisation.OrganisationUUID:i.value.length===0&&(i.value=n.organisation||""),(async()=>{const o=[];d.value&&o.push(v.getConventionTags(d.value)),i.value&&o.push(v.getOrganisationTags(i.value));const l=await Promise.all(o);if(d.value&&i.value?(p.value=l[0].sort((e,r)=>e.Title.localeCompare(r.Title)),g.value=l[1].sort((e,r)=>e.Title.localeCompare(r.Title))):d.value&&l.length==1?p.value=l[0].sort((e,r)=>e.Title.localeCompare(r.Title)):i.value&&l.length==1&&(g.value=l[0].sort((e,r)=>e.Title.localeCompare(r.Title))),Array.isArray(u.value))m.value=2,V.value.forEach(e=>{Array.isArray(u.value)&&u.value.find(b=>b.TagUUID===e.value.TagUUID)&&t.value.push(e.value)});else if(typeof u.value=="string"){m.value=1;try{const e=JSON.parse(u.value);V.value.forEach(r=>{e.find(K=>K.TagUUID===r.value.TagUUID)&&t.value.push(r.value)}),console.log(t.value)}catch{console.log("error")}}})();const U=f(!1),S=()=>{U.value=!0},j=o=>{o.ConventionUUID.length>0?p.value.push(o):o.OrganisationUUID.length>0&&g.value.push(o),t.value.push(o)};return Y(t,()=>{switch(m.value){default:case 2:{u.value=t.value,c("change");break}case 1:{u.value=JSON.stringify(t.value),c("change");break}}}),(o,l)=>(B(),H(Q,null,[le,oe,a(W,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),chips:o.chips,multiple:"",label:o.label||"Tags",variant:o.variant||"solo",hint:o.hint,"persistent-hint":!0,clearable:o.clearable,items:V.value,"item-title":"title","item-value":"value"},{"prepend-item":s(()=>[a(_,{title:"New Tag",onClick:l[0]||(l[0]=e=>S())},{prepend:s(()=>[a(A,{icon:"mdi:mdi-plus"})]),_:1}),a(ee,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),a(Z,{modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value=e),scrollable:!0},{default:s(()=>[a(ae,{convention:o.convention,organisation:o.organisation,onClose:l[2]||(l[2]=e=>U.value=!1),onSave:j},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}});export{N,Te as _};
